var ObjectsUtil={objects:{},parentCalls:{},declare:function(a,c,n){if(ObjectsUtil.objects[a]){return}this.parentCalls[a]={};ObjectsUtil.objects[a]=function(){ObjectsUtil.objects[a].prototype.constructor.apply(this,arguments)};var o=[];for(var h=0;h<c.length;h++){o.push(c[h])}var b=[];for(var h=0;h<o.length;h++){var i=o[h];var g=ObjectsUtil.get(i);if(typeof g!=="function"){continue}var f=g.prototype;var d=f.constructor;if(d){b.push(d)}for(var l in f){if(l!=="constructor"){var j=f[l];if(typeof j==="function"){if(!this.parentCalls[a][l]){this.parentCalls[a][l]=[]}this.parentCalls[a][l].push(j)}else{ObjectsUtil.objects[a].prototype[l]=j}}else{}}}ObjectsUtil.objects[a].prototype.className=a;var m;for(var l in n){if(l==="constructor"){m=n[l]}else{ObjectsUtil.objects[a].prototype[l]=n[l]}}var k=this.parentCalls[a];for(var l in k){if(!ObjectsUtil.objects[a].prototype[l]){var e=k[l];if(e.length>0){ObjectsUtil.objects[a].prototype[l]=e[0]}}}ObjectsUtil.objects[a].prototype.constructor=function(){for(var p=0;p<b.length;p++){b[p].apply(this,arguments)}if(m){m.apply(this,arguments)}}},superCall:function(c,e,b){var d=this.parentCalls[d.className];if(d){for(var a=0;a<d.length;a++){d[a].call(c,b)}}},define:function(b,a){if(ObjectsUtil.objects[b]){return}ObjectsUtil.objects[b]=a;return a},get:function(a){return ObjectsUtil.objects[a]},newInstance:function(d,c){var a=new ObjectsUtil.objects[d](c);if(typeof c!=="string"){for(var b in c){if(a[b]){continue}a[b]=c[b]}}return a},isArray:function(a){return a&&(typeof a=="array"||a instanceof Array)}};(function(){var a=ObjectsUtil.get("util.core.CoreUtil");ObjectsUtil.declare("util.core.Map",[],{values:null,keys:null,constructor:function(){this.values=[];this.keys=[]},put:function(b,d){var c=this.keys.indexOf(b);if(c===-1){this.values.push(d);this.keys.push(b)}else{this.values[c]=d}},get:function(b){return this.values[this.keys.indexOf(b)]},remove:function(b){var c=this.keys.indexOf(b);if(c<0){return}this.values.splice(c,1);this.keys.splice(c,1)},clear:function(){this.values=[];this.keys=[]}})})();(function(){var a=ObjectsUtil.newInstance("util.core.Map");var b=[];ObjectsUtil.define("util.core.Events",{topics:{},suspend:null,connect:function(c,e,d,j){var k=this;var f,i;if(e.addEventListener){f=function(){j.apply(d,arguments)};e.addEventListener(c,f,false);i=function(){e.removeEventListener(c,f,false)}}else{var g=a.get(e);if(!g){g=[];a.put(e,g)}if(!g[c]){g[c]={bridged:e[c],connects:[]};var k=this;e[c]=function(){g[c].bridged.apply(e,arguments);if(!k.suspend){var m=g[c].connects;for(var l=0,n;n=m[l];l++){n.callback.apply(n.context,arguments)}}}}g[c].connects.push({callback:j,context:d});f=j}var h={callback:f,disconnector:i,type:c,object:e,context:d};b.push(h);return h},disconnectAll:function(){while(b.length>0){this.disconnect(b[0],a)}this.topics={}},disconnect:function(h,e){if(!h){return}if(h.object.removeEventListener){h.disconnector()}else{var j=a.get(h.object);if(!j){return}var g=j[h.type];if(!g){return}g=g.connects;if(!g){return}for(var d=0,k;k=g[d];d++){if(k.callback===h.callback){g.splice(g.indexOf(k),1);d=0}}}var f=b.indexOf(h);if(f>-1){b.splice(f,1)}},subscribe:function(c,f,d){if(!this.topics[c]){this.topics[c]=[]}var e={handler:f,context:d};this.topics[c].push(e);return e},unsubscribe:function(c,e){if(!this.topics[c]){return}var d=this.topics[c].indexof(e);if(d>-1){this.topics[c].splice(d,1)}},publish:function(d){var f=this.topics[d];if(!f){return}for(var c=0,e;e=f[c];c++){var g=Array.prototype.slice.call(arguments,1);e.handler.apply(e.context||this,g)}}})})();(function(){ObjectsUtil.define("util.core.UUIDGenerator",{generate:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var a=Math.random()*16|0,b=c==="x"?a:(a&3|8);return b.toString(16)})}})})();(function(){ObjectsUtil.define("util.svg.SVGUtil",{SVG:"http://www.w3.org/2000/svg",syncLineBetweenVertices:function(h,n,A){var z=n.getRootNode();var m=parseFloat(z.getAttribute("height"));var j=n.focalNode;var i=A.focalNode;var q=parseFloat(j.getAttribute("x"));var c=parseFloat(j.getAttribute("y"));var e=parseFloat(j.getAttribute("height"));var s=parseFloat(j.getAttribute("width"));var p=parseFloat(i.getAttribute("x"));var b=parseFloat(i.getAttribute("y"));var d=parseFloat(i.getAttribute("height"));var r=parseFloat(i.getAttribute("width"));var y=q+(s/2);var v=c+(e/2);var x={y:v,x:y};var k={y:b,x:p+(r/2),getRange:function(F,D){var E=p/m;var C=(r/2)*E;var B=p+(r/2);if(Math.abs(F-B)<2){return B}if(F<p+(r/2)){return B-C}else{if(F>p+(r/2)){return B+C}else{return B}}}};var l={y:b+d,x:p+(r/2),getRange:function(F,D){var E=p/m;var C=(r/2)*E;var B=p+(r/2);if(Math.abs(F-B)<2){return B}if(F<p+(r/2)){return B-C}else{if(F>p+(r/2)){return B+C}else{return B}}}};var f={y:b+(d/2),x:p,getRange:function(F,D){var E=b/m;var C=(d/2)*E;var B=b+(d/2);if(Math.abs(D-B)<2){return B}if(D<b+(d/2)){return B-C}else{if(D>b+(d/2)){return B+C}else{return B}}}};var o={y:b+(d/2),x:p+r,getRange:function(F,D){var E=b/m;var C=(d/2)*E;var B=b+(d/2);if(Math.abs(D-B)<2){return B}if(D<b+(d/2)){return B-C}else{if(D>b+(d/2)){return B+C}else{return B}}}};var a=function(C,B){return Math.abs((C.x-B.x))+Math.abs((C.y-B.y))};var w=a(x,k);var u=a(x,l);var g=a(x,f);var t=a(x,o);if(w<u&&w<g&&w<t){h.setAttribute("d","M"+y+","+v+" L"+k.getRange(y,v)+" "+k.y)}else{if(u<w&&u<g&&u<t){h.setAttribute("d","M"+y+","+v+" L"+l.getRange(y,v)+" "+l.y)}else{if(g<w&&g<u&&g<t){h.setAttribute("d","M"+y+","+v+" L"+f.x+" "+f.getRange(y,v))}else{if(t<w&&t<u&&t<g){h.setAttribute("d","M"+y+","+v+" L"+o.x+" "+o.getRange(y,v))}}}}n.parentNode.refreshChild(h)},syncVertixLines:function(a){var c=ObjectsUtil.get("util.svg.SVGUtil");var d=a.getChildren("connector");for(var e=0;b=d[e];e++){var b=d[e];c.syncLineBetweenVertices(b.focalNode,b.source,b.target)}},getConnector:function(a,e){var c=a.getChildren("connector");for(var b=0;b<c.length;b++){var d=c[b];if(d.target===a){if(d.source===e){return d}}else{if(d.source===a){if(d.target===e){return d}}}}return null}})})();(function(){var c=ObjectsUtil.get("util.svg.SVGUtil");var b={};var a={};ObjectsUtil.define("layout.shapes.ShapesRegistry",{register:function(e,d){b[e]=d},draw:function(g,e,f){var d=ObjectsUtil.newInstance(b[g],e,f);if(!a[g]){a[g]={}}a[g][d.id||d.guid]=d;d.draw(e,f);return d},get:function(d,e){return e?a[d][e]:a[d]},destroy:function(d){a[d.guid].destroy();a[d.guid]=undefined},empty:function(){a={}},paint:function(e,d){if(d&&e.args.container){ObjectsUtil.get("util.core.Events").disconnectAll();ObjectsUtil.get("layout.shapes.ShapesRegistry").empty();ObjectsUtil.get("util.core.DomUtil").empty(e.args.container)}this._paint(e)},_paint:function(g,d,e){if(d){g.args.parentNode=d}if(e){g.args.container=e}if(!g.args.id){g.args.id=g.args.name}var f=ShapesRegistry.draw(g.descriptor,g.args,g);return f}})})();(function(){var d=ObjectsUtil.get("util.svg.SVGUtil");var a=ObjectsUtil.get("layout.shapes.ShapesRegistry");var e=40;var c=100000;var b=0.0005;b=0.0005;ObjectsUtil.declare("layout.routers.AutomaticRouter",[],{forcex:null,forcey:null,_layoutInterval:null,graph:null,constructor:function(f){this.graph=f;this.forcex={};this.forcey={}},layout:function(){var f=this;f._doLayout();this._layoutInterval=setInterval(function(){f._doLayout()},100)},_doLayout:function(){var g=this.graph.getChildren("rectangle");for(var i=0;vertix1=g[i];i++){var l=vertix1.name;this.forcex[l]=0;this.forcey[l]=0;for(var j=0;vertix2=g[j];j++){var k=vertix2.name;if(l===k){continue}var q=parseFloat(vertix2.getAttribute("x"))-parseFloat(vertix1.getAttribute("x"));var p=parseFloat(vertix2.getAttribute("y"))-parseFloat(vertix1.getAttribute("y"));var o=Math.pow(q,2)+Math.pow(p,2);this.forcex[l]-=(c/o)*q;this.forcey[l]-=(c/o)*p;if(d.getConnector(vertix1,vertix2)){var f=Math.sqrt(o);this.forcex[l]+=(f-e)*q;this.forcey[l]+=(f-e)*p}}}var h=0;for(var i=0;vertix1=g[i];i++){var l=vertix1.name;var n=this.forcex[l]*b;var m=this.forcey[l]*b;h=h+Math.abs(n)+Math.abs(m);vertix1.setPosition({x:parseFloat(vertix1.getAttribute("x"))+n,y:parseFloat(vertix1.getAttribute("y"))+m})}if(Math.round(h)<40){clearInterval(this._layoutInterval)}}})})();(function(){var d=ObjectsUtil.get("util.svg.SVGUtil");var a=ObjectsUtil.get("layout.shapes.ShapesRegistry");var e=40;var c=100000;var b=0.0005;b=0.0005;ObjectsUtil.declare("layout.routers.HorizontalTreeRouter",[],{forcex:null,forcey:null,graph:null,constructor:function(f){this.graph=f;this.forcex={};this.forcey={}},layout:function(){var f=this;f._doLayout()},_doLayout:function(){var q=[];var n=function(y,E){var A=[];var D=y.getChildren("connector");for(var x=0;x<D.length;x++){var C=D[x];if(C.source===y){var B=C.target;if(E&&q.indexOf(B)>-1){continue}A.push(C.target)}else{if(C.target===y){var z=C.source;if(E&&q.indexOf(z)>-1){continue}A.push(C.source)}}}return A};var f=function(z){var A=z.getChildren("connector");if(A.length<1){return 1}var y=0;for(var x=0;subChild=A[x];x++){y=y+f(subChild)}return y};var s=function(A){var C=A.getChildren("connector");if(C.length<1){return 1}var z=0;for(var y=0;subChild=C[y];y++){var B;if(subChild.source===A){B=subChild.target}else{if(subChild.target===A){B=subChild.source}}if(!B){continue}var x=parseFloat(B.getAttribute("width"));if(x>z){z=x}}return z};var o=function(A,C){if(!C){C=[]}var x=n(A);if(x.length===1){return 1}var z=0;for(var y=0;y<x.length;y++){var B=x[y];if(C.indexOf(B)>-1){continue}C.push(x[y]);z=z+o(x[y],C)}return z};var g=this.graph.getChildren("rectangle");var u=g;u.sort(function(y,x){return f(x)-f(y)});var v=40;var t=30;var r={x:0,y:0};var i=function(J,M,S,N){if(q.indexOf(J)>-1){return}q.push(J);var G=f(J,true);if(N){G--}J.setPosition({x:M,y:S});if(S>r.y){r.y=S}if(M>r.x){r.x=M}var L=n(J,true);var y=L.length;var Q=G*v;var E=S-(Q/2);var H=0;for(var C=0;C<y;C++){var I=L[C];var K=f(I)-1;var R=E;if(C){R=R+v}if(!K){K=1}var B=R+(K*v);var D=(R+B)/2;var F=M+t+parseFloat(J.getAttribute("width"));I.setPosition({x:F,y:D});if(D>r.y){r.y=D}if(F>r.x){r.x=F}E=B-v;H=H+(K||1);q.push(I);var z=n(I,true);var O=F+parseFloat(I.getAttribute("width"))+t;if(z.length===1){i(z[0],O,D,true)}else{if(z.length>=2){var A=R+v/2;var x=(((B-A)/z.length))+v/z.length;for(var P=0;P<z.length;P++){i(z[P],O,A+(x*P),true)}}}}};for(var j=0;j<u.length;j++){var p=u[j];if(q.indexOf(p)>-1){continue}var m=o(p);var w=q.length===0?((m*v)/4):r.y+v;i(p,t,w)}if(!this.graph.height){var h=parseFloat(this.graph.getAttribute("height"));var l=r.y+v;if(l>h){this.graph.setAttribute("height",parseFloat(l))}}if(!this.graph.width){var k=parseFloat(this.graph.getAttribute("width"));var l=r.x+100;if(l>k){this.graph.setAttribute("width",parseFloat(l))}}for(var j=0;j<q.length;j++){var p=q[j];p.parentNode.refreshChild(p.focalNode);d.syncVertixLines(p)}}})})();(function(){var b=0;var a=ObjectsUtil.get("util.core.Events");ObjectsUtil.declare("layout.shapes.AbstractNode",[],{focalNode:null,guid:null,children:null,type:null,parentNode:null,incremntal:null,_incomplete:null,constructor:function(c){this.children=[];this.id=c.id;this.parentNode=c.parentNode;this.incremntal++},getChildren:function(c){return this.children[c||""]||[]},getPosition:function(){return{x:0,y:0,h:0,w:0}},setPosition:function(c,d){},shiftPosition:function(f,e){var c=this.getPosition();for(var d in f){c[d]=(c[d]||0)+f[d]}this.setPosition(c,e)},getSuperContainer:function(){var d=this.container;while(true){var c=d.container;if(c&&c.className){d=c}else{break}}return d},addChild:function(d){this.removeChild(d);var c=d.type||"";if(!this.children[c]){this.children[c]=[]}this.children[c].push(d)},removeChild:function(e){var d=e.type||"";if(!this.children[d]){return}if(!this.children[d]){return}var c=this.children[d].indexOf(e);if(c==-1){return}this.children[d].splice(c,1)},appendChild:function(c){this.focalNode.appendChild(c)},refreshChild:function(c){if(c.parentNode===this.focalNode){this.focalNode.removeChild(c);this.insertBefore(c,this.focalNode.firstChild)}},insertBefore:function(d,c){if(!c){this.appendChild(d)}else{this.focalNode.insertBefore(d,c)}},draw:function(c){},getAttribute:function(c){return this.focalNode.getAttribute(c)},setAttribute:function(c,d){this.focalNode.setAttribute(c,d)},getRootNode:function(){var c=this.parentNode.focalNode;if(c.tagName==="svg"){return c}var d=c.parentNode;while(d){d=d.parentNode;if(d&&d.tagName==="svg"){return d}}return c},handleMove:function(c,d){},destroy:function(){}})})();(function(){var c=ObjectsUtil.get("util.svg.SVGUtil");var b=ObjectsUtil.get("util.core.Events");var e=ObjectsUtil.get("util.core.UUIDGenerator");var g=0;var f="#222";var a="#fff";var d="10px";ObjectsUtil.declare("layout.shapes.RectangleNode",["layout.shapes.AbstractNode"],{focalNode:null,guid:null,name:null,color:null,fontColor:null,rx:null,parentNode:null,strokeWidth:null,_moving:null,type:null,constructor:function(h){this.type="rectangle";this.name=h.name||("Node"+g);this.guid=h.id||this.name;this.color=h.color||f;this.fontColor=h.fontColor||a;this.rx=h.rx||d;this.strokeWidth=h.strokeWidth||1;this.strokeWidth=this.strokeWidth+"px";g++},draw:function(k){var l=parseInt(this.parentNode.getAttribute("width"));var j=parseInt(this.parentNode.getAttribute("height"));this.focalNode=document.createElementNS(c.SVG,"rect");this.focalNode.setAttribute("style","fill: "+this.color+"; stroke-width: "+this.strokeWidth+";");this.focalNode.setAttribute("rx",this.rx);this.parentNode.appendChild(this.focalNode);this.focalNode.name=this.name;this.focalNode.textLabel=document.createElementNS(c.SVG,"text");this.focalNode.textLabel.setAttribute("style","fill: "+this.fontColor+"; stroke-width: 1px;");this.focalNode.textLabel.appendChild(document.createTextNode(this.name));this.parentNode.appendChild(this.focalNode.textLabel);this.focalNode.h=this.focalNode.textLabel.getBBox().height+10;this.focalNode.w=this.focalNode.textLabel.getBBox().width+10;this.focalNode.setAttribute("height",this.focalNode.h+"px");this.focalNode.setAttribute("width",this.focalNode.w+"px");var i=b.connect("mousedown",this.focalNode,this,function(n){this.handleMove(this.focalNode,n)});var i=b.connect("mousedown",this.focalNode.textLabel,this,function(n){this.handleMove(this.focalNode,n)});var h=Math.random()*(l*0.8)+(l*0.1);var m=(Math.random()*(j*0.8))+(j*0.1);this.setPosition({x:h,y:m})},setPosition:function(h){var j=parseFloat(h.x);var i=parseFloat(h.y);this.focalNode.setAttribute("x",j);this.focalNode.setAttribute("y",i);this.focalNode.textLabel.setAttribute("x",j+5+"px");this.focalNode.textLabel.setAttribute("y",i+(2*this.focalNode.h/3)+"px");c.syncVertixLines(this)},handleMove:function(o,h){var k=o.parentNode.getScreenCTM();var i=o.parentNode.createSVGPoint();i.x=h.clientX;i.y=h.clientY;i=i.matrixTransform(k.inverse());var n=parseFloat(i.x)-parseFloat(o.getAttribute("x"));var l=parseFloat(i.y)-parseFloat(o.getAttribute("y"));var j=this.getChildren("rectangle");this._moving=o;var r=b.connect("mousemove",document,this,function(u){var s=o.parentNode.getScreenCTM();var t=o.parentNode.createSVGPoint();t.x=u.clientX;t.y=u.clientY;t=t.matrixTransform(s.inverse());this.setPosition({x:t.x-n,y:t.y-l});this.parentNode.updateArrowMarker()});var q=b.connect("mouseup",document,this,function(){b.disconnect(r);b.disconnect(q);this.parentNode.updateArrowMarker()})}})})();(function(){var a=ObjectsUtil.get("layout.shapes.ShapesRegistry");var c=ObjectsUtil.get("util.svg.SVGUtil");var b="1px";var e="#444";var d=0;ObjectsUtil.declare("layout.shapes.Connector",["layout.shapes.AbstractNode"],{focalNode:null,source:null,target:null,name:null,color:null,rx:null,strokeWidth:null,type:null,constructor:function(f){this.type="connector";this.setSource(f.source);this.setTarget(f.target);this.name=f.name||("Connector"+d);this.guid=f.id||this.source.guid+"_"+this.target.guid+"_"+d;this.strokeWidth=f.strokeWidth||b;this.color=f.color||e;d++},setSource:function(g){var f=a.get("RectangleNode",g);this.source=f;f.addChild(this)},setTarget:function(g){var f=a.get("RectangleNode",g);this.target=f;f.addChild(this)},draw:function(f){this.focalNode=document.createElementNS(c.SVG,"path");this.focalNode.setAttribute("style","stroke: "+this.color+"; stroke-width:"+this.strokeWidth+";");this.parentNode.insertBefore(this.focalNode,this.parentNode.firstChild);this.focalNode.setAttribute("marker-end","url(#Triangle)");return this.focalNode}})})();var ShapesRegistry=ObjectsUtil.get("layout.shapes.ShapesRegistry");(function(){ShapesRegistry.register("Connector","layout.shapes.Connector");ShapesRegistry.register("RectangleNode","layout.shapes.RectangleNode");ShapesRegistry.register("Graph","layout.shape.Graph")})();(function(){var d=ObjectsUtil.get("layout.routers.HorizontalTreeRouter");var b=ObjectsUtil.get("util.core.Events");var c=ObjectsUtil.get("util.svg.SVGUtil");var a=ObjectsUtil.get("layout.shapes.ShapesRegistry");ObjectsUtil.declare("layout.shape.Graph",["layout.shapes.AbstractNode"],{routingObject:null,height:null,width:null,_layoutInterval:null,_moving:null,_defs:null,constructor:function(g){this.height=g.height;this.width=g.width;var e=g.container;var f=g.router;this.router=f||new d(this);this.focalNode=document.getElementById(e);this.updateArrowMarker()},draw:function(e,f){},_paint:function(f){f.args.parentNode=this;if(!f.args.id){f.args.id=f.args.name}f.args.container=this;var e=a.draw(f.descriptor,f.args,f);return e},updateArrowMarker:function(){if(!this._defs){this._defs=document.createElementNS(c.SVG,"defs");var e=document.createElementNS(c.SVG,"marker");e.setAttribute("id","Triangle");e.setAttribute("viewBox","0 0 20 20");e.setAttribute("refX","20");e.setAttribute("refY","10");e.setAttribute("markerUnits","strokeWidth");e.setAttribute("markerWidth","8");e.setAttribute("markerHeight","6");e.setAttribute("orient","auto");var f=document.createElementNS(c.SVG,"path");e.appendChild(f);f.setAttribute("d","M 0 0 L 20 10 L 0 20 z");this._defs.appendChild(e)}else{this.focalNode.removeChild(this._defs)}this.focalNode.appendChild(this._defs)},addRectNode:function(f){f.parentNode=this;var e=a.draw("RectangleNode",f);this.addChild(e)},drawConnector:function(f){f.parentNode=this;var e=a.draw("Connector",f);this.addChild(e)},layout:function(){this.router.layout()}})})();(function(){var a=ObjectsUtil.define("util.core.DomUtil",{empty:function(b){if(!b.tagName){b=document.getElementById(b)}if(!b){return}if(b.canHaveChildren){try{b.innerHTML="";return}catch(c){}}for(var d;d=b.lastChild;){this._empty(d,b)}},_empty:function(c,b){if(c.firstChild){this.empty(c)}if(b){b.removeChild(c);if(c.removeNode){c.removeNode(false)}}},calculateTextSize:function(g,f){var e=document.createElement("span");e.innerHTML=g;e.style.visibility="hidden";var c=this.position(e);if(typeof f==="object"){for(var d in f){e.style[d]=f[d]}}else{e.cssText=f.cssText}var b=document.body;b.appendChild(e);var c=this.position(e);b.removeChild(e);return c},position:function(e,c){var g=ObjectsUtil.get("util.core.CoreUtil");e=this.nodeById(e);var b=this.getFirstParent(e,"body");var f=e.getBoundingClientRect();f={x:f.left,y:f.top,w:f.right-f.left,h:f.bottom-f.top};if(c){var d=this.scrollValue(e);f.x+=d.x;f.y+=d.y}return f},transformValue:function(d){var b=d.getAttribute("transform");if(!b){return{x:0,y:0}}b=b.substring("translate(".length,b.length-1);var c=b.split(",");if(c.length<2){c=b.split(" ")}return{x:parseFloat(c[0]),y:parseFloat(c[1])}},scrollValue:function(c){var i=function(n,l){var j;var k=window["page"+n+"Offset"];if(typeof(k)==="number"){j=k}else{var m="scroll"+l;if(document.body&&document.body[m]){j=document.body[m]}else{if(document.documentElement&&document.documentElement[m]){j=document.documentElement[m]}}}return j};var d=function(){return i("Y","Top")};var b=function(){return i("X","Left")};var g=0,h=0;var f={x:b(),y:d()};var e=c;while(e){if(e!==document.body&&e!==document.documentElement){if(e.scrollTop>0){f.y=f.y+e.scrollTop;break}if(e.scrollLeft>0){f.x=f.x+e.scrollLeft;break}}e=e.parentNode}return f},nodeById:function(d,b){var c=ObjectsUtil.get("util.core.CoreUtil");if(c.checkBrowser("ie")){this.nodeById=function(f,e){if(typeof f!=="string"){return f}return(e||document).getElementById(f)};return this.nodeById(d,b)}this.nodeById=function(j,i){if(typeof j!=="string"){return j}if(!b){b=document}var f=b.getElementById(j);if(f.id==j||(f.attributes&&f.attributes.id&&f.attributes.id.value==j)){return f}var h=b.all[j];if(!h){return}if(!c.isArray(h)){h=[h]}for(var e=0,g;g=h[e];e++){if(g.id==j||(g.attributes&&g.attributes.id&&g.attributes.id.value==j)){return g}}};return this.nodeById(d,b)},transformPoint:function(e,c){var d=ObjectsUtil.get("util.core.DomUtil").getFirstParent(e,"svg");var b=d.getScreenCTM();var f=d.createSVGPoint();f.x=c.x;f.y=c.y;f=f.matrixTransform(b.inverse());c.x=f.x;c.y=f.y},getFirstParent:function(e,c){if(!e||!c){return}c=c.toUpperCase();if(e.tagName.toUpperCase()===c){return e}var d=e.parentNode;var b;while(d){if(d.tagName&&(d.tagName.toUpperCase()===c.toUpperCase())){b=d;break}d=d.parentNode}return b}})})();(function(){var a=ObjectsUtil.define("util.core.CoreUtil",{store:{},toString:{}.toString,_browserSettings:null,clone:function(d){var b={};for(var c in d){b[c]=d[c]}return b},stopEvent:function(b){b.cancelBubble=true;b.preventDefault();b.stopPropagation()},checkBrowser:function(c){var b=this.store[c];if(b!==undefined){return b}b=navigator.userAgent.search(c);this.store[c]=b;return b},browserSettings:function(){if(this._browserSettings){return this._browserSettings}var d=navigator.userAgent;var b;var c=d.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];if(/trident/i.test(c[1])){b=/\brv[ :]+(\d+(\.\d+)?)/g.exec(d)||[];this._browserSettings={browser:"ie",version:b[1]||""};return this._browserSettings}c=c[2]?[c[1],c[2]]:[navigator.appName,navigator.appVersion,"-?"];if((b=d.match(/version\/([\.\d]+)/i))!=null){c[2]=b[1]}this._browserSettings={browser:c[0].toLowerCase(),version:c[1]||""}},version:function(b){var c=this.browserSettings();if(c.browser===b){return parseFloat(c.version)}return 0},isFunction:function(b){return this._is(b,"[object Function]")},isString:function(b){return this._is(b,"[object String]")},isArray:function(b){return this._is(b,"[object Array]")},_is:function(c,b){return this.toString.call(c)===b}})})();(function(){var SVGUtil=ObjectsUtil.get("util.svg.SVGUtil");var Events=ObjectsUtil.get("util.core.Events");var UUIDGenerator=ObjectsUtil.get("util.core.UUIDGenerator");var incremntal=0;var DEFAULT_COLOR="rgb(255,255,255)";var DEFAULT_FONT_COLOR="#fff";var DEFAULT_ROUND_RATIO="10px";var ShapesRegistry=ObjectsUtil.get("layout.shapes.ShapesRegistry");ShapesRegistry.register("StrucutreDiagram","layout.shapes.StrucutreDiagram");ShapesRegistry.register("Part","layout.shapes.Part");ShapesRegistry.register("Port","layout.shapes.Port");ShapesRegistry.register("PartIcon","layout.shapes.PartIcon");ShapesRegistry.register("PortConnector","layout.shapes.PortConnector");ObjectsUtil.declare("layout.shapes.StructureDiagramNode",["layout.shapes.AbstractNode"],{_moveHandle:null,constructor:function(args){this._moveHandle=Events.subscribe("structure.diagram.node.move."+this.id,function(args){var self=this;var visited=[];var updateMoveInformation=function(entry){if(visited.indexOf(entry)>-1){return}visited.push(entry);var position=entry.getPrecisePosition?entry.getPrecisePosition():entry.getPosition();if(!self.parentNode.layoutInformation){self.parentNode.layoutInformation={}}var updatedInfo={x:position.x,y:position.y,h:position.h,w:position.w};self.parentNode.layoutInformation[entry.id]=updatedInfo;var children=entry.getChildren();for(var index=0,child;child=children[index];index++){updateMoveInformation(child)}};updateMoveInformation(this)},this)},destroy:function(){Events.unsubsribe(this._moveHandle)}});var StructureDiagramUtil=ObjectsUtil.define("layout.shapes.diagram.structure..StructureDiagramUtil",{portToPart:function(port,userHandler,otherPort){var CoreUtil=ObjectsUtil.get("util.core.CoreUtil");var portObject=CoreUtil.isString(port)?ShapesRegistry.get("Port",port):port;var part=otherPort||portObject.container;var partPosition=part.getPosition();var portPosition=portObject.getPosition();var deltaRight=parseInt(Math.abs(portPosition.x-(partPosition.x+partPosition.w)+portPosition.w));var deltaLeft=parseInt(Math.abs((portPosition.x-(partPosition.x))+portPosition.w));var deltaTop=parseInt(Math.abs(portPosition.y-(partPosition.y-portPosition.h)));var deltaBottom=parseInt(Math.abs(portPosition.y-(partPosition.y+partPosition.h)+portPosition.h));var handler=function(x,y,direction,portPosition){var isCorner=function(att1,att2){return att1<5&&att2<5};if(port.isPrivate){if(direction==="right"){direction="left";y=y+(2)}else{if(direction==="left"){direction="right";y=y+(2);x=x+(2)}else{if(direction==="top"){direction="bottom";y=y+((portPosition.h/2)+2)}else{if(direction==="bottom"){direction="top";y=y-((portPosition.h/2)+2)}else{direction="right"}}}}}userHandler(x,y,direction,portPosition,(isCorner(deltaBottom,deltaLeft)||isCorner(deltaTop,deltaLeft)||isCorner(deltaBottom,deltaRight)||isCorner(deltaTop,deltaRight)),{deltaRight:deltaRight,deltaLeft:deltaLeft,deltaTop:deltaTop,deltaBottom:deltaBottom})};var side;if(deltaRight<deltaLeft&&deltaRight<=deltaTop&&deltaRight<=deltaBottom){if(partPosition.y-portPosition.h>portPosition.y){return handler(portPosition.x+(portPosition.w/2-2),portPosition.y,"top",portPosition)}else{if((portPosition.y>(partPosition.y+partPosition.h+document.body.scrollTop)-portPosition.h)){return handler(portPosition.x+(portPosition.w/2-2),portPosition.y+(portPosition.h/2+4),"bottom",portPosition)}else{return handler(portPosition.x+(portPosition.w-2),portPosition.y+(portPosition.h/2),"right",portPosition)}}}else{if(deltaLeft<deltaRight&&deltaLeft<=deltaTop&&deltaLeft<=deltaBottom){if(partPosition.y-portPosition.h>portPosition.y){return handler(portPosition.x+(portPosition.w/2-2),portPosition.y,"top",portPosition)}else{if((portPosition.y>(partPosition.y+partPosition.h+document.body.scrollTop)-portPosition.h)){return handler(portPosition.x+(portPosition.w/2-2),portPosition.y+(portPosition.h/2+4),"bottom",portPosition)}else{return handler(portPosition.x+(portPosition.w-2),portPosition.y+(portPosition.h/2),"left",portPosition)}}}else{if(deltaTop<deltaRight&&deltaTop<deltaLeft&&deltaTop<deltaBottom){return handler(portPosition.x+(portPosition.w/2-2),portPosition.y,"top",portPosition)}else{if(deltaBottom<deltaRight&&deltaBottom<deltaLeft&&deltaBottom<deltaTop){return handler(portPosition.x+(portPosition.w/2-2),portPosition.y+(portPosition.h/2+4),"bottom",portPosition)}}}}}});ObjectsUtil.declare("layout.shapes.StrucutreDiagram",["layout.shape.Graph"],{layoutInformation:null,settings:null,constructor:function(args){this.layoutInformation=args.layout},draw:function(args,entry){this.focalNode.style.width="100%";this.focalNode.style.height="3600px";this._incomplete=true;this.settings=entry.args.settings||{};var layout=entry.args.layout;if(this.height){this.setAttribute("height",this.height)}if(this.width){this.setAttribute("width",this.width)}var nodes=args.nodes;if(!nodes){return}var mapByParent={"":{}};var getArray=function(id){var array=mapByParent[id||""];if(array){return array}mapByParent[id]={};return mapByParent[id]};var undefineds=[];var setDetails=function(node){var args=node.args;var id=args.id||args.name;if(id){node.children={};var obj=getArray(args.parent)[args.id||args.name||new Date().getTime()]=node}else{if(undefineds.indexOf(node)===-1){undefineds.push(node)}}};for(var index=0,node;node=nodes[index];index++){setDetails(node)}var search=function(obj,id){for(var att in obj){if(att===id){return obj[id]}var val=search(obj[att].children,id);if(val){return val}}};var pending=[];var putInHirarchy=function(obj){for(var id in obj){if(!id){continue}var subObject=obj[id];var array=search(mapByParent[""],id);if(array){var indexOf=pending.indexOf(id);if(indexOf>-1){pending.splice(indexOf,1)}var contents=mapByParent[id];for(var att in contents){array.children[att]=contents[att]}delete mapByParent[id]}else{var indexOf=pending.indexOf(id);if(indexOf===-1){pending.push(id)}}for(var att in subObject){putInHirarchy(subObject[att].children)}}};putInHirarchy(mapByParent);while(pending.length>0){putInHirarchy(mapByParent)}var CoreUtil=ObjectsUtil.get("util.core.CoreUtil");var mainObject=mapByParent[""];var avoid=[];var flatten=function(obj){for(var att in obj){var current=obj[att];if(avoid.indexOf(current)>-1){continue}if(current.descriptor==="Part"&&!mainObject[att]){mainObject[att]=CoreUtil.clone(current);avoid.push(mainObject[att])}flatten(current.children)}};flatten(mainObject);var prepareArgs=function(originalArgs,parentNode,container,suffixId){var subArgs=CoreUtil.clone(originalArgs,parentNode,container);subArgs.parent=container.id;subArgs.parentNode=parentNode;if(!subArgs.id){subArgs.id=subArgs.name}if(suffixId){subArgs.id=suffixId+"_"+subArgs.id}if(layout){var layoutInfo=layout[subArgs.id];if(layoutInfo){subArgs.x=layoutInfo.x;subArgs.y=layoutInfo.y;subArgs.h=layoutInfo.h;subArgs.w=layoutInfo.w;subArgs.hasLayoutInformation=true}}subArgs.container=container;return subArgs};var rowMargin=20;var columnMargin=20;var horiontalSpace=30;var verticalSpace=15;var columnStart=columnMargin;var rowStart=rowMargin+horiontalSpace;for(var att in mainObject){var current=mainObject[att];var args=prepareArgs(current.args,this,this);var isAutoLayout=false;if(!args.x||!args.y){args.x=rowStart;args.y=columnStart;isAutoLayout=true}if(current.descriptor==="Part"){args.isStructureDiagram=true}var shape=ShapesRegistry.draw(current.descriptor,args);var children=current.children;var margined=false;var parentSet=false;var pending=[];for(var subAtt in children){var subCurrent=children[subAtt];var subShapeArgs=prepareArgs(subCurrent.args,this,shape,att);var subShape=ShapesRegistry.draw(subCurrent.descriptor,subShapeArgs);subShape._incomplete=true;if(!subShapeArgs.hasLayoutInformation){shape.addChild(subShape);parentSet=true}else{parentSet=false}if(subCurrent.descriptor==="Part"||(subCurrent.descriptor==="Port"&&(subCurrent.args.isPrivate==="true"||subCurrent.args.isPrivate===true))){if(!margined){rowStart=rowStart+rowMargin+horiontalSpace;columnStart=columnStart+columnMargin+20;margined=true}var subChildren=subCurrent.children;for(var subSubAtt in subChildren){var subSubCurrent=subChildren[subSubAtt];if(subSubCurrent.descriptor==="Port"){var _args=prepareArgs(subSubCurrent.args,this,subShape,att);var subShape1=ShapesRegistry.draw(subSubCurrent.descriptor,_args);if(!_args.hasLayoutInformation){subShape.addChild(subShape1)}else{pending.push(subShape1)}}}var subPosition=subShape.getPosition();if(subPosition.x+rowStart>650){var containerPosition=shape.getPosition();var currentHeightEnd=(containerPosition.y+containerPosition.h)-20;columnStart=currentHeightEnd+verticalSpace;rowStart=rowMargin+horiontalSpace+rowMargin+horiontalSpace}if(isAutoLayout){subShape.shiftPosition({x:rowStart,y:columnStart})}delete subShape._incomplete;for(var pendingIndex=0,currentPending;currentPending=pending[pendingIndex];pendingIndex++){subShape.addChild(currentPending)}pending=[];subPosition=subShape.getPosition();var containerPosition=shape.getPosition();var end=subPosition.x+subPosition.w;var currentEnd=(containerPosition.x+containerPosition.w)-40;var heightEnd=subPosition.y+subPosition.h;var currentHeightEnd=(containerPosition.y+containerPosition.h)-20;var wDiff=end-currentEnd;var hDiff=heightEnd-currentHeightEnd;if(hDiff>0||wDiff>0){var object={};if(wDiff>0){object.w=wDiff}if(hDiff>0){object.h=hDiff}shape.shiftPosition(object)}rowStart=rowStart+subPosition.w+rowMargin+rowMargin+rowMargin+rowMargin}pending=[];if(!parentSet){shape.addChild(subShape)}delete subShape._incomplete}var containerPosition=shape.getPosition();var currentEnd=(containerPosition.x+containerPosition.h)-40;var containerPosition=shape.getPosition();var currentHeightEnd=(containerPosition.y+containerPosition.h)-20;columnStart=columnMargin+currentHeightEnd+verticalSpace;rowStart=rowMargin+horiontalSpace;this.addChild(shape)}for(var att in mainObject){var part=ShapesRegistry.get("Part",att);for(var uncategoriedIndex=0,uncategoried;uncategoried=undefineds[uncategoriedIndex];uncategoriedIndex++){var args=uncategoried.args;var source=args.sources[0];var target=args.targets[0];var partSource=att+"_"+source;if(!ShapesRegistry.get("Port",partSource)){continue}var partTarget=att+"_"+target;if(!ShapesRegistry.get("Port",partTarget)){continue}var altered=CoreUtil.clone(args);altered.sources=[partSource];altered.part=att;altered.targets=[partTarget];altered.parentNode=this;altered.container=part;ShapesRegistry.draw(uncategoried.descriptor,altered)}}var pos=ObjectsUtil.get("util.core.DomUtil").position(this.focalNode,true);this.focalNode.style.height=(currentHeightEnd+20)+"px";this._incomplete=false;this.refreshBoundaries()},refreshBoundaries:function(){var position=ObjectsUtil.get("util.core.DomUtil").position(this.focalNode,true);var verticalEnd=position.y+position.h;var horizontalEnd=position.x+position.w;var children=this.getChildren("partNode");var maxY=0,maxX=0;for(var index=0,child;child=children[index];index++){if(child.className!=="layout.shapes.Part"){continue}var pos=child.getPosition();var horizontalEnd=pos.x+pos.w;if(horizontalEnd>maxX){maxX=horizontalEnd}var verticalEnd=pos.y+pos.h;if(verticalEnd>maxY){maxY=verticalEnd}}var height=parseFloat(this.focalNode.style.height);if(Math.abs(maxY-height)>1){this.focalNode.style.height=(maxY)+"px"}var width=parseFloat(this.focalNode.style.width);if(Math.abs(maxX-width)>1){this.focalNode.style.width=(maxX)+"px"}}});ObjectsUtil.declare("layout.shapes.Part",["layout.shapes.StructureDiagramNode"],{isStructureDiagram:null,multiplicity:null,children:null,focalNode:null,guid:null,iconPart:null,name:null,parent:null,color:null,fontColor:null,rx:null,parentNode:null,strokeWidth:null,height:null,width:null,yCoord:null,xCoord:null,_moving:null,type:null,constructor:function(args){this.isStructureDiagram=args.isStructureDiagram;this.multiplicity=args.multiplicity;this.type="partNode";this.parent=args.parent;this.children=[];this.name=args.name||("Node"+incremntal);this.guid=args.id||this.name;this.color=args.color||DEFAULT_COLOR;this.fontColor=args.fontColor||DEFAULT_FONT_COLOR;this.rx=args.rx||DEFAULT_ROUND_RATIO;this.strokeWidth=args.strokeWidth||1;this.strokeWidth=this.strokeWidth+"px";incremntal++},addChild:function(child){var CoreUtil=ObjectsUtil.get("util.core.CoreUtil");if(CoreUtil.isArray(child)){for(var index=0,c;c=child[index];index++){this.children.push(c)}}else{this.children.push(child)}this.applyConstraints()},getChildren:function(type,args){if(type){var filtered=[];for(var index=0,child;child=this.children[index];index++){if(child.type===type){var valid=true;if(args){for(var att in args){if(!args[att]?child[att]:args[att]!==child[att]){valid=false;break}}}if(valid){filtered.push(child)}}}return filtered}return this.children},draw:function(args){var settings=this.getSuperContainer().settings;this.part_highlight_color=settings.part_highlight_color||"#5DBCD2";this.part_container_highlight_color=settings.part_container_highlight_color||"#FFFFFF";this.part_container_label_highlight_color=settings.part_container_label_highlight_color||"#e6e6e6";var CoreUtil=ObjectsUtil.get("util.core.CoreUtil");var DomUtil=ObjectsUtil.get("util.core.DomUtil");this.focalNode=document.createElementNS(SVGUtil.SVG,"g");var mouseMoveHandler=Events.connect("mousemove",this.focalNode,this,function(e){if(this.__resizeStarted){return}var self=this;var stopListening=function(){delete self.__resizeStarted;Events.disconnect(self._tempResizeMouseUpHandler);Events.disconnect(self._tempResizeMouseDownHandler);Events.disconnect(self._tempResizeMouseMoveHandler);self.focalNode.style.cursor="";delete self._tempResizeMouseDownHandler};var iseDetected=false;var scrollValue=DomUtil.scrollValue(this.focalNode);var horizontalEnd=this.getPosition().x+this.getPosition().w;var horizontalDiff=(e.clientX+scrollValue.x)-horizontalEnd;if(Math.abs(horizontalDiff)<10){this.focalNode.style.cursor="col-resize";iseDetected=true}else{var verticalEnd=this.getPosition().y+this.getPosition().h;var verticalDiff=(e.clientY+scrollValue.y)-verticalEnd;if(Math.abs(verticalDiff)<10){this.focalNode.style.cursor="row-resize";iseDetected=true}}Events.disconnect(this._tempResizeMouseDownHandler);Events.disconnect(this._tempResizeMouseOutHandler);if(iseDetected){this._tempResizeMouseDownHandler=Events.connect("mousedown",document,this,function(e){if(this.__resizeStarted){stopListening()}var children=this.getChildren();var maxY=0,maxX=0;for(var index=0,child;child=children[index];index++){if(child.className!=="layout.shapes.Part"){continue}var pos=child.getPosition();var horizontalEnd=pos.x+pos.w;if(horizontalEnd>maxX){maxX=horizontalEnd}var verticalEnd=pos.y+pos.h;if(verticalEnd>maxY){maxY=verticalEnd}}Events.disconnect(this._tempResizeMouseOutHandler);CoreUtil.stopEvent(e);this.__resizeStarted=true;this._tempResizeMouseUpHandler=Events.connect("mouseup",document,this,function(e){CoreUtil.stopEvent(e);stopListening()});this._tempResizeMouseMoveHandler=Events.connect("mousemove",document,this,function(e){CoreUtil.stopEvent(e);if(!this._tempResizeMouseDownHandler){stopListening();return}var object={};var scrollValue=DomUtil.scrollValue(this.focalNode);var set=false;if(this._tempResizeMouseDownHandler.verticalDiff){if(e.clientY+scrollValue.y>maxY){object.h=(e.clientY+scrollValue.y)-this.getPosition().y;set=true}}else{if(this._tempResizeMouseDownHandler.horizontalDiff){if(e.clientX+scrollValue.x>maxX){object.w=(e.clientX+scrollValue.x)-this.getPosition().x;set=true}}}if(set){this.setPosition(object)}})});this._tempResizeMouseDownHandler.horizontalDiff=horizontalDiff;this._tempResizeMouseDownHandler.verticalDiff=verticalDiff;this._tempResizeMouseOutHandler=Events.connect("mouseout",this.focalNode,this,function(e){stopListening()})}else{stopListening()}});this.focalNode.setAttribute("style","fill: "+this.color+"; font-family:'sans-serif';");this.parentNode.appendChild(this.focalNode);this.rectNode=document.createElementNS(SVGUtil.SVG,"rect");this.rectNode.setAttribute("style","stroke:#000000;");this.rectNode.setAttribute("fill","#FFFFFF");this.focalNode.appendChild(this.rectNode);this.highlightNode=document.createElementNS(SVGUtil.SVG,"rect");this.highlightNode.setAttribute("style","stroke:#000000;");if(!this.isStructureDiagram){this.highlightNode.setAttribute("fill",this.part_highlight_color)}else{this.highlightNode.setAttribute("fill",this.part_container_highlight_color)}this.focalNode.appendChild(this.highlightNode);this.nameNode=document.createElementNS(SVGUtil.SVG,"text");this.nameNode.setAttribute("style","fill: #000000;  font-family:tahoma; font-size: 10; font-weight:bold");this.nameNode.appendChild(document.createTextNode(args.name));this.focalNode.appendChild(this.nameNode);if(!this.isStructureDiagram){this.iconPart=ShapesRegistry.draw("PartIcon",{parentNode:this.focalNode})}this.setPosition({x:args.x,y:args.y,h:args.h,w:args.w});var mouseDownHandler=Events.connect("mousedown",this.focalNode,this,function(e){if(this._tempResizeMouseDownHandler){return}this.handleMove(this.focalNode,e)});var mouseDownHandler=Events.connect("mousedown",this.highlightNode,this,function(e){if(this._tempResizeMouseDownHandler){return}this.handleMove(this.focalNode,e)})},updatePosition:function(position){var currentPosition=ObjectsUtil.get("util.core.DomUtil").transformValue(this.focalNode);currentPosition.h=parseFloat(this.rectNode.getAttribute("height"));currentPosition.w=parseFloat(this.rectNode.getAttribute("width"));if(position.h){currentPosition.h=currentPosition.h+position.h}if(position.w){currentPosition.w=currentPosition.w+position.w;var children=this.getChildren("portNode");for(var childIndex=0,child;child=children[childIndex];childIndex++){StructureDiagramUtil.portToPart(child,function(x,y,direction,portPosition){if(direction==="right"){var pos=child.getPosition();child.shiftPosition({x:position.w},true)}})}}this.setPosition(currentPosition,true)},shiftPosition:function(shiftObject,args){var position={x:this.xCoord,y:this.yCoord,h:this.height,w:this.width};for(var att in shiftObject){position[att]=(position[att]||0)+shiftObject[att]}this.setPosition(position,args)},setPosition:function(position,restrained){var currentPosition=this.getPosition();var xCoord=parseFloat(position.x)||this.xCoord||0;var yCoord=parseFloat(position.y)||this.yCoord||0;var height=parseFloat(position.h)||this.height||40;var textWidth=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(this.nameNode.childNodes[0].textContent,this.nameNode).w;var width=parseFloat(position.w)||this.width||(textWidth+75);if(height<40){height=40}if(width<(textWidth+75)){width=(textWidth+75)}this.highlightNode.setAttribute("height",20);this.highlightNode.setAttribute("width",width);this.rectNode.setAttribute("height",height);this.rectNode.setAttribute("width",width);if(!this.isStructureDiagram){this.iconPart.setPosition({x:width-25,y:6})}this.focalNode.setAttribute("transform","translate("+xCoord+","+yCoord+")");if(!this.isStructureDiagram&&this.multiplicity==="*"){if(!this.shadowNode){this.shadowNode=document.createElementNS(SVGUtil.SVG,"rect");this.shadowNode.setAttribute("style","stroke:#000000;");this.shadowNode.setAttribute("fill","none");this.focalNode.insertBefore(this.shadowNode,this.focalNode.firstChild)}this.shadowNode.setAttribute("transform","translate("+(3)+","+(-3)+")");this.shadowNode.setAttribute("height",height);this.shadowNode.setAttribute("width",width)}this.nameNode.setAttribute("y","15");if(this.isStructureDiagram){this.nameNode.setAttribute("x","15");if(!this.nameNode.highlight){this.nameNode.highlight=document.createElementNS("http://www.w3.org/2000/svg","rect");this.nameNode.highlight.setAttribute("style","fill:"+this.part_container_label_highlight_color+";");this.nameNode.parentNode.insertBefore(this.nameNode.highlight,this.nameNode);this.nameNode.highlight.border=document.createElementNS(SVGUtil.SVG,"polygon");this.nameNode.highlight.border.setAttribute("style","stroke:black;stroke-width:1;");this.nameNode.parentNode.insertBefore(this.nameNode.highlight.border,this.nameNode)}else{this.nameNode.parentNode.removeChild(this.nameNode.highlight);this.nameNode.parentNode.insertBefore(this.nameNode.highlight,this.nameNode);this.nameNode.parentNode.removeChild(this.nameNode.highlight.border);this.nameNode.parentNode.insertBefore(this.nameNode.highlight.border,this.nameNode)}this.nameNode.highlight.setAttribute("x","1");this.nameNode.highlight.setAttribute("y","1");this.nameNode.highlight.setAttribute("width",textWidth+10);this.nameNode.highlight.setAttribute("height",18);this.nameNode.highlight.border.setAttribute("points",(textWidth+11)+",2 "+(textWidth+11)+",18")}else{this.nameNode.setAttribute("x",(width/2)-(textWidth/2))}if(!restrained){var newPosition=this.getPosition();var shiftX=newPosition.x-currentPosition.x;var shiftY=newPosition.y-currentPosition.y;if(shiftX!==0||shiftY!==0){for(var index=0,child;child=this.children[index];index++){if(child.className==="layout.shapes.Port"||child.className==="layout.shapes.Part"){child.shiftPosition({x:shiftX,y:shiftY})}}}this.applyConstraints()}this.xCoord=xCoord;this.yCoord=yCoord;this.height=height;this.width=width;if(this.container&&this.container.getPrecisePosition){var containerPosition=this.container.getPrecisePosition();var lastEnd=this.yCoord+this.height;var lastWidthEnd=this.xCoord+this.width;var containerEnd=containerPosition.y+containerPosition.h-20;var containerWidthEnd=containerPosition.x+containerPosition.w-20;var hDiff=lastEnd-containerEnd;var wDiff=lastWidthEnd-containerWidthEnd;if(hDiff>0||wDiff>0){var object={};if(hDiff>0){object.h=hDiff+20}if(wDiff>0){object.w=wDiff+20}this.container.shiftPosition(object)}}this.refreshBoundaries()},refreshBoundaries:function(){var superContainer=this.getSuperContainer();if(superContainer._incomplete){return}superContainer.refreshBoundaries()},getPosition:function(){var position=ObjectsUtil.get("util.core.DomUtil").position(this.focalNode,true);var y=this.focalNode.parentNode.parentNode.getBoundingClientRect().top-this.focalNode.parentNode.parentNode.parentNode.getBoundingClientRect().top;position.y=position.y-y;if(this.shadowNode){position.w=position.w-3;position.h=position.h-3}return position},getPrecisePosition:function(){return{h:this.height,w:this.width,y:this.yCoord,x:this.xCoord}},applyConstraints:function(){if(this._incomplete){return}var position=this.getPosition();var alteredPosition=this.getPosition();for(var index=0,child;child=this.children[index];index++){if(child.className==="layout.shapes.Port"){child.applyConstraints()}else{if(child.className==="layout.shapes.Part"){}}}if(alteredPosition.w!==position.w){this.setPosition(alteredPosition,true)}},handleMove:function(vertex,event){var DomUtil=ObjectsUtil.get("util.core.DomUtil");var CoreUtil=ObjectsUtil.get("util.core.CoreUtil");var canvas=DomUtil.getFirstParent(vertex,"svg");var m=vertex.parentNode.getScreenCTM();var p=canvas.createSVGPoint();p.x=event.clientX;p.y=event.clientY;p=p.matrixTransform(m.inverse());var position=this.getPrecisePosition();var deltaX=parseFloat(p.x)-parseFloat(position.x);var deltaY=parseFloat(p.y)-parseFloat(position.y);var originalPosition;if(this.container.getPrecisePosition){originalPosition=this.container.getPrecisePosition()}this._moving=vertex;var disableTextSelection=Events.connect("onselectstart",document,this,function(e){CoreUtil.stopEvent(e)});var mouseMoveHandle=Events.connect("mousemove",document,this,function(e){var self=this;var m=vertex.parentNode.getScreenCTM();var p=canvas.createSVGPoint();p.x=e.clientX;p.y=e.clientY;p=p.matrixTransform(m.inverse());var object={};var position=self.getPrecisePosition();object.y=p.y;object.x=p.x;var containerNewPosition=self.container[self.container.getPrecisePosition?"getPrecisePosition":"getPosition"]();if(object.x-deltaX<containerNewPosition.x){return}if(object.y-deltaY<containerNewPosition.y){return}self.setPosition({x:object.x-deltaX,y:object.y-deltaY});if(originalPosition){var containerNewPosition=self.container.getPrecisePosition();var lastEnd=self.yCoord+self.height;var lastWidthEnd=self.xCoord+self.width;var containerEnd=originalPosition.y+originalPosition.h;var containerWidthEnd=originalPosition.x+originalPosition.w;var hDiff=lastEnd-containerEnd;var wDiff=lastWidthEnd-containerWidthEnd;if(hDiff<0&&wDiff<0){self.container.setPosition(originalPosition)}}});var mouseUpHandle=Events.connect("mouseup",document,this,function(){Events.disconnect(mouseMoveHandle);Events.disconnect(mouseUpHandle);Events.disconnect(disableTextSelection);this._moving=undefined;Events.publish("structure.diagram.node.move."+this.id)});CoreUtil.stopEvent(event)}});var ICON_WIDTH=12;var ICON_HEIGHT=10;ObjectsUtil.declare("layout.shapes.PartIcon",["layout.shapes.AbstractNode"],{draw:function(args){this.iconNode=document.createElementNS(SVGUtil.SVG,"rect");this.iconNode.setAttribute("style","stroke:#000000;");this.iconNode.setAttribute("height",ICON_HEIGHT);this.iconNode.setAttribute("width",ICON_WIDTH);this.iconNode.setAttribute("fill","none");this.parentNode.appendChild(this.iconNode)},setPosition:function(position){var xCoord=parseFloat(position.x)||0;var yCoord=parseFloat(position.y)||0;var margin=2;var separator=1;var partHeight=2;var partWidth=6;this.iconNode.setAttribute("x",xCoord);this.iconNode.setAttribute("y",yCoord);if(!this.iconNodePart1){this.iconNodePart1=document.createElementNS(SVGUtil.SVG,"rect")}else{this.parentNode.removeChild(this.iconNodePart1)}this.iconNodePart1.setAttribute("style","stroke:#000000;");this.iconNodePart1.setAttribute("height",partHeight);this.iconNodePart1.setAttribute("width",partWidth);this.iconNodePart1.setAttribute("y",yCoord+margin);this.iconNodePart1.setAttribute("x",xCoord-(partWidth/2));this.iconNodePart1.setAttribute("fill","#5DBCD2");this.parentNode.appendChild(this.iconNodePart1);if(!this.iconNodePart2){this.iconNodePart2=document.createElementNS(SVGUtil.SVG,"rect")}else{this.parentNode.removeChild(this.iconNodePart2)}this.iconNodePart2.setAttribute("style","stroke:#000000;");this.iconNodePart2.setAttribute("height",partHeight);this.iconNodePart2.setAttribute("width",partWidth);this.iconNodePart2.setAttribute("y",yCoord+margin+partHeight+margin);this.iconNodePart2.setAttribute("x",xCoord-(partWidth/2));this.iconNodePart2.setAttribute("fill","#5DBCD2");this.parentNode.appendChild(this.iconNodePart2)}});var PortSymbols=ObjectsUtil.define("layout.shapes.Port.PortSymbols",{right:function(port){port.symbol=document.createElementNS(SVGUtil.SVG,"polygon");port.symbol.setAttribute("points","8,2 2.5,5 8,8");port.symbol.setAttribute("style","fill:black;stroke:#000000;stroke-width:1");port.containerNode.appendChild(port.symbol)},left:function(port){port.symbol=document.createElementNS(SVGUtil.SVG,"polygon");port.symbol.setAttribute("points","2.5,2 8,5 2.5,8");port.symbol.setAttribute("style","fill:#000000;stroke:#000000;stroke-width:1");port.containerNode.appendChild(port.symbol)},twoArrows:function(port){var drawLine=function(x1,y1,x2,y2){var line1=document.createElementNS(SVGUtil.SVG,"line");line1.setAttribute("x1",x1);line1.setAttribute("y1",y1);line1.setAttribute("x2",x2);line1.setAttribute("y2",y2);line1.setAttribute("style","fill:#000000;stroke:#000000;stroke-width:1");port.containerNode.appendChild(line1)};drawLine("4","2","8.5","4");drawLine("1.5","4","8.5","4");drawLine("1.5","6","8.5","6");drawLine("1.5","6","6","8")},conjugated:function(port){var symbol=PortSymbols._drawCircleSymbol(port,"Conjucated port");symbol.setAttribute("style","stroke: black;")},conjugatedReplicated:function(port){var symbol=PortSymbols._drawCircleSymbol(port,"Conjucated replicated port");symbol.setAttribute("style","stroke: black;");port.set3D()},replicatedEndPort:function(port){PortSymbols.endPort(port,"Replicated end port");port.set3D()},endPort:function(port,title){var symbol=PortSymbols._drawCircleSymbol(port,title||"End port");var currentParentColor=port.focalNode.getAttribute("fill");symbol.setAttribute("style","stroke: "+currentParentColor+";");symbol.setAttribute("fill",currentParentColor);port.focalNode.setAttribute("fill","#000000")},conjucatedReplicatedRelayPort:function(port){var symbol=PortSymbols._drawRectSymbol(port,"Conjucated replicated relay port");symbol.setAttribute("style","stroke: black;");port.set3D()},conjucatedRelayPort:function(port){var symbol=PortSymbols._drawRectSymbol(port,"Conjucated relay port");symbol.setAttribute("style","stroke: black;")},replicatedRelayPort:function(port){PortSymbols.relayPort(port,"Replicated relay port");port.set3D()},relayPort:function(port,title){var symbol=PortSymbols._drawRectSymbol(port,title||"Relay port");symbol.setAttribute("style","stroke: black;");var currentParentColor=port.focalNode.getAttribute("fill");symbol.setAttribute("style","stroke: "+currentParentColor+";");symbol.setAttribute("fill",currentParentColor);port.focalNode.setAttribute("fill","#000000")},_drawCircleSymbol:function(port,title){var circle=document.createElementNS(SVGUtil.SVG,"circle");circle.setAttribute("fill","#000000");circle.setAttribute("r",3);circle.setAttribute("cx",5);circle.setAttribute("cy",5);port.containerNode.appendChild(circle);PortSymbols._appendTooltip(title,port,circle);return circle},_drawRectSymbol:function(port,title){var rect=document.createElementNS(SVGUtil.SVG,"rect");rect.setAttribute("fill","#000000");rect.setAttribute("height",4);rect.setAttribute("width",4);rect.setAttribute("x",3);rect.setAttribute("y",3);port.containerNode.appendChild(rect);PortSymbols._appendTooltip(title,port,rect);return rect},_appendTooltip:function(title,port,element){if(title){element.titleElement=document.createElementNS(SVGUtil.SVG,"title");port.focalNode.appendChild(element.titleElement);element.titleElement.appendChild(document.createTextNode(title));element.titleElement=document.createElementNS(SVGUtil.SVG,"title");element.appendChild(element.titleElement);element.titleElement.appendChild(document.createTextNode(title))}}});var ConnectorSymbols=ObjectsUtil.define("layout.shapes.connector.ConnectorSymbols",{draw:function(connector,args,direction,receive){return ConnectorSymbols._draw(connector,args,direction,receive)},_draw:function(connector,args,direction,receive){if(!connector.connectorSymbol){connector.connectorSymbol=document.createElementNS(SVGUtil.SVG,"g");connector.connectorSymbol.setAttribute("fill","none");var r=5;var delta=4;var title="";if(args.indexOf("provide")>-1){connector.connectorSymbol.path=document.createElementNS(SVGUtil.SVG,"path");connector.connectorSymbol.path.setAttribute("style","stroke: #000000;");connector.connectorSymbol.appendChild(connector.connectorSymbol.path);title="Provide"}if(args.indexOf("require")>-1){connector.connectorSymbol.circle1=document.createElementNS(SVGUtil.SVG,"circle");connector.connectorSymbol.circle1.setAttribute("style","stroke: black;");connector.connectorSymbol.circle1.setAttribute("r",r);connector.connectorSymbol.appendChild(connector.connectorSymbol.circle1);connector.connectorSymbol.setAttribute("fill","white");if(title){title=title+"\\"}title=title+"Require"}if(title){connector.connectorSymbol.title=document.createElementNS(SVGUtil.SVG,"title");connector.connectorSymbol.appendChild(connector.connectorSymbol.title);connector.connectorSymbol.title.appendChild(document.createTextNode(title))}connector.parentNode.appendChild(connector.connectorSymbol)}else{connector.parentNode.removeChild(connector.connectorSymbol);connector.parentNode.appendChild(connector.connectorSymbol)}if(connector.connectorSymbol.path){var r=5;var delta=4;var firstEnd=r+delta;var otherEnd=firstEnd*-1;if(receive){if(direction==="vertical"){var pair1=(otherEnd+",0");var pair2=(firstEnd+",0")}else{var pair1=("0,"+otherEnd);var pair2=("0,"+(firstEnd))}}else{if(direction==="vertical"){var pair2=(otherEnd+",0");var pair1=(firstEnd+",0")}else{var pair2=("0,"+otherEnd);var pair1=("0,"+(firstEnd))}}var pathString="M"+pair1+(" A"+r+","+r)+" 0 0,1 "+pair2;connector.connectorSymbol.path.setAttribute("d",pathString)}return connector.connectorSymbol}});ObjectsUtil.declare("layout.shapes.Port",["layout.shapes.StructureDiagramNode"],{focalNode:null,guid:null,isPrivate:null,connectors:null,name:null,color:null,fontColor:null,rx:null,parentNode:null,strokeWidth:null,_moving:null,type:null,portType:null,constructor:function(args){this.type="portNode";this.isPrivate=(args.isPrivate==="true"||args.isPrivate===true)?true:false;this.multiplicity=args.multiplicity;this.connectors={sources:[],targets:[]};this.portType=args.portType;this.name=args.name||("Node"+incremntal);this.guid=args.id||this.name;this.color=args.color||DEFAULT_COLOR;this.fontColor=args.fontColor||DEFAULT_FONT_COLOR;this.rx=args.rx||DEFAULT_ROUND_RATIO;this.strokeWidth=args.strokeWidth||1;this.strokeWidth=this.strokeWidth+"px";incremntal++},addConnector:function(child,type){var CoreUtil=ObjectsUtil.get("util.core.CoreUtil");if(CoreUtil.isArray(child)){for(var index=0,c;c=child[index];index++){if(this.connectors[type].indexOf(c)>-1){continue}this.connectors[type].push(c)}}else{if(this.connectors[type].indexOf(child)==-1){this.connectors[type].push(child)}}},draw:function(args){var settings=this.getSuperContainer().settings;this.portFillColor=settings.portFillColor||"#FFFFCC";this.containerNode=document.createElementNS(SVGUtil.SVG,"g");this.parentNode.appendChild(this.containerNode);this.focalNode=document.createElementNS(SVGUtil.SVG,"rect");this.focalNode.setAttribute("style","stroke:#000000;");this.focalNode.setAttribute("height","10");this.focalNode.setAttribute("width","10");this.focalNode.setAttribute("fill",this.portFillColor);this.containerNode.appendChild(this.focalNode);var CoreUtil=ObjectsUtil.get("util.core.CoreUtil");var typeSymbol=args.typeSymbol;if(typeSymbol){if(typeSymbol.indexOf("(function")>-1){var typeSymboleEval=eval(typeSymbol);if(CoreUtil.isFunction(typeSymboleEval)){typeSymboleEval(this)}}}else{var portType=args.portType;var mappedFunction=PortSymbols[portType];if(mappedFunction){mappedFunction(this)}}this.labelNode=document.createElementNS(SVGUtil.SVG,"text");this.labelNode.setAttribute("style","fill: #000000;  font-family:tahoma; font-size: 7;  font-weight:bold");var portLabelText=args.name;if(args.multiplicity!==undefined){portLabelText=portLabelText+"["+args.multiplicity+"]"}this.labelNode.appendChild(document.createTextNode(portLabelText));this.parentNode.appendChild(this.labelNode);var partObject=this.container;if(args.x!==undefined&&args.y!==undefined){this.setPosition({x:args.x,y:args.y},true)}else{if(!this.isPrivate){var position=partObject.getPosition();var portPosition=this.getPosition();var children=partObject.getChildren("portNode",{isPrivate:undefined});if(children.length<10){var direction=children.length%10;if(direction===0){var delta=(((position.h/2))/2)-5;var x=position.x-portPosition.w;var y=(position.y+(position.h/2))-portPosition.h-delta}else{if(direction===1){var delta=((position.h/2))/2;var x=position.x-portPosition.w;var y=((position.y+(position.h/2))-portPosition.h)+delta}else{if(direction===2){var delta=((position.w/2))/2;var x=(position.x-portPosition.w)+(position.w/2)-delta;var y=(position.y)-portPosition.h}else{if(direction===3){var x=(position.x-portPosition.w)+(position.w/2);var y=(position.y)-portPosition.h}else{if(direction===4){var delta=((position.w/2))/2;var x=(position.x-portPosition.w)+(position.w/2)+delta;var y=(position.y)-portPosition.h}else{if(direction===5){var delta=((position.h/2))/2;var x=((position.x+position.w)-portPosition.w);var y=((position.y+(position.h/2))-portPosition.h)-delta}else{if(direction===6){var delta=((position.h/2))/2;var x=((position.x+position.w)-portPosition.w);var y=((position.y+(position.h/2))-portPosition.h)+delta}else{if(direction===7){var delta=((position.w/2))/2;var x=((position.x-portPosition.w)+(position.w/2))-delta;var y=(position.y+(position.h))-portPosition.h}else{if(direction===8){var x=(position.x-portPosition.w)+(position.w/2);var y=(position.y+(position.h))-portPosition.h}else{if(direction===9){var delta=((position.w/2))/2;var x=((position.x-portPosition.w)+(position.w/2))+delta;var y=(position.y+(position.h))-portPosition.h}}}}}}}}}}}else{var start=children.length-10;var direction=start%8;var endY=(position.y+position.h)-20;if(direction<6){var byIndex=((parseFloat(direction/2)+((start-direction+1)/3))*portPosition.h);if(!byIndex){byIndex=4}var delta=parseInt(start/8)+byIndex+(portPosition.h*2);var right=direction%2;if(!right){var x=((position.x)-portPosition.w);var y=((position.y+(position.h/2))-portPosition.h)+delta;var diff=y-endY;if(diff>0){partObject.updatePosition({h:diff})}}else{var x=((position.x)-portPosition.w)+position.w}var updatedPosition=partObject.getPosition();var y=((updatedPosition.y+(updatedPosition.h)))-((portPosition.h*2))+4}else{if(direction%2===0){var x=(position.x+position.w)-(portPosition.w/2);var y=position.y-portPosition.h;partObject.updatePosition({w:30})}else{var x=(position.x+position.w)-parseFloat(portPosition.w*3);var y=(position.y+position.h)-portPosition.h}}}for(var childIndex=0,child;child=children[childIndex];childIndex++){child.applyConstraints()}this.setPosition({x:x,y:y})}}this.applyConstraints();var mouseDownHandler=Events.connect("mousedown",this.containerNode,this,function(e){this.handleMove(this.focalNode,e)});var mouseDownHandler=Events.connect("mousedown",this.labelNode,this,function(e){this.handleMove(this.focalNode,e)})},setPosition:function(position,restrained){xCoord=parseFloat(position.x)||0;yCoord=parseFloat(position.y)||0;this.containerNode.setAttribute("transform","translate("+xCoord+","+yCoord+")");if(this.multiplicity==="*"){this.set3D()}var self=this;StructureDiagramUtil.portToPart(this,function(x,y,direction,portPosition){if(direction==="right"){self.labelNode.setAttribute("x",x+1);self.labelNode.setAttribute("y",y-1)}else{if(direction==="top"){var position=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(self.labelNode.childNodes[0].textContent,{fontSize:7,fontFamily:"tahoma",fontWeight:"bold"});self.labelNode.setAttribute("x",x-parseFloat(position.w/2));self.labelNode.setAttribute("y",y-4)}else{if(direction==="left"){var position=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(self.labelNode.childNodes[0].textContent,{fontSize:7,fontFamily:"tahoma",fontWeight:"bold"});self.labelNode.setAttribute("x",parseFloat((x-(portPosition.w))-position.w));self.labelNode.setAttribute("y",y-1)}else{if(direction==="bottom"){var position=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(self.labelNode.childNodes[0].textContent,{fontSize:7,fontFamily:"tahoma",fontWeight:"bold"});self.labelNode.setAttribute("x",x-parseFloat(position.w/2));self.labelNode.setAttribute("y",y+parseFloat(portPosition.h/2))}}}}if(!restrained){self.applyConstraints()}});var parentNode=self.labelNode.parentNode;parentNode.removeChild(self.labelNode);parentNode.appendChild(self.labelNode)},set3D:function(){if(!this.shadowNode){this.shadowNode=document.createElementNS(SVGUtil.SVG,"rect");this.shadowNode.setAttribute("style","stroke:#000000;");this.shadowNode.setAttribute("fill",this.portFillColor||"#FFFFFF");this.containerNode.insertBefore(this.shadowNode,this.containerNode.firstChild)}this.shadowNode.setAttribute("transform","translate("+(1)+","+(-2)+")");this.shadowNode.setAttribute("height",11);this.shadowNode.setAttribute("width",11)},applyConstraints:function(){var part=this.container;if(!part||part._incomplete){return}var CoreUtil=ObjectsUtil.get("util.core.CoreUtil");var childPosition=this.getPosition();var position=part.getPosition();if(this.isPrivate){var changed=false;var maxX=((position.x+position.w)-childPosition.w)-childPosition.w;var minX=position.x+childPosition.w;var maxY=((position.y+position.h)-childPosition.h)-childPosition.h;var minY=position.y+childPosition.h;var newPosition=CoreUtil.clone(childPosition);if(newPosition.x<minX){newPosition.x=minX;changed=true}else{if(newPosition.x>maxX){newPosition.x=maxX;changed=true}}if(newPosition.y<minY){newPosition.y=minY;changed=true}else{if(newPosition.y>maxY){newPosition.y=maxY;changed=true}}if(changed){this.setPosition(newPosition,true)}}else{var enforceY=true;var newPosition=CoreUtil.clone(childPosition);var updateY=function(){var pos1=(position.y)-childPosition.h;var pos2=(position.y+position.h)-childPosition.h;var diff1=Math.abs(newPosition.y-pos1);var diff2=Math.abs(newPosition.y-pos2);if(diff2<=diff1){newPosition.y=pos2}else{newPosition.y=pos1}};if(childPosition.x<position.x-childPosition.w){newPosition.x=position.x-childPosition.w}else{if(childPosition.x>((position.x+position.w)-childPosition.w)){newPosition.x=(position.x+position.w)-childPosition.w}else{var max=(position.x+position.w)-childPosition.w;var min=position.x-childPosition.w;var current=newPosition.x;StructureDiagramUtil.portToPart(this,function(x,y,direction,portPosition,isCorner,deltaInformation){if(isCorner){updateY()}else{if(direction==="bottom"){if(Math.abs(deltaInformation.deltaBottom)>1){newPosition.y=newPosition.y+deltaInformation.deltaBottom}}else{if(direction==="top"){if(Math.abs(deltaInformation.deltaTop)>1){newPosition.y=newPosition.y-deltaInformation.deltaTop}}else{if(direction==="right"){if(Math.abs(deltaInformation.deltaRight)>1){newPosition.x=newPosition.x+deltaInformation.deltaRight}}else{if(direction==="left"){if(Math.abs(deltaInformation.deltaLeft)>1){newPosition.x=newPosition.x-deltaInformation.deltaLeft}}}}}}});enforceY=false}}if(enforceY){var max=(position.y+position.h)-childPosition.h;var min=(position.y)-childPosition.h;var current=childPosition.y-childPosition.h;if(current<min||current>max){updateY()}}var minimuxX=position.x-childPosition.w;var maximumX=(position.x+position.w)-childPosition.w;var minimuxY=position.y-childPosition.h;var maximumY=(position.y+position.h)-childPosition.h;if(newPosition.x<minimuxX){newPosition.x=minimuxX}if(newPosition.x>maximumX){newPosition.x=maximumX}if(newPosition.y<minimuxY){newPosition.y=minimuxY}if(newPosition.y>maximumY){newPosition.y=maximumY}if(parseInt(newPosition.x)!==parseInt(childPosition.x)||parseInt(newPosition.y)!==parseInt(childPosition.y)||parseInt(newPosition.h)!==parseInt(childPosition.h)||parseInt(newPosition.w)!==parseInt(childPosition.w)){this.setPosition(newPosition,true)}}},getPosition:function(){var transform=ObjectsUtil.get("util.core.DomUtil").transformValue(this.containerNode);transform.w=13;transform.h=13;return transform},handleMove:function(vertex,event){var DomUtil=ObjectsUtil.get("util.core.DomUtil");var CoreUtil=ObjectsUtil.get("util.core.CoreUtil");var canvas=DomUtil.getFirstParent(vertex,"svg");var m=vertex.parentNode.getScreenCTM();var p=canvas.createSVGPoint();var scrollValue=DomUtil.scrollValue(vertex);p.x=event.clientX+scrollValue.x;p.y=event.clientY+scrollValue.y;p=p.matrixTransform(m.inverse());var position=this.getPosition();var deltaX=parseFloat(p.x)-parseFloat(position.x);var deltaY=parseFloat(p.y)-parseFloat(position.y);this._moving=vertex;var disableTextSelection=Events.connect("onselectstart",document,this,function(e){CoreUtil.stopEvent(e)});var mouseMoveHandle=Events.connect("mousemove",document,this,function(e){var self=this;var m=vertex.parentNode.getScreenCTM();var p=canvas.createSVGPoint();p.x=e.clientX;p.y=e.clientY;p=p.matrixTransform(m.inverse());var object={};if(this.isPrivate){object.y=p.y;object.x=p.x}else{StructureDiagramUtil.portToPart(this,function(x,y,direction,portPosition,isCorner){if(isCorner){object.y=p.y;object.x=p.x}else{if(direction==="left"||direction==="right"){object.y=p.y}else{object.x=p.x}}})}self.shiftPosition(object);CoreUtil.stopEvent(e)});var mouseUpHandle=Events.connect("mouseup",document,this,function(){Events.disconnect(mouseMoveHandle);Events.disconnect(mouseUpHandle);Events.disconnect(disableTextSelection);this._moving=undefined;Events.publish("structure.diagram.node.move."+this.id)});CoreUtil.stopEvent(event)}});var Events=ObjectsUtil.get("util.core.Events");var incremntal=0;var sources=[];ObjectsUtil.declare("layout.shapes.PortConnector",["layout.shapes.StructureDiagramNode"],{focalNode:null,guid:null,name:null,color:null,fontColor:null,rx:null,parentNode:null,strokeWidth:null,_moving:null,type:null,connectorType:null,constructor:function(args){this.connectorType=args.connectorType;this.type="portConnector";this.name=args.name||("Connector"+incremntal);this.guid=args.id||this.name;this.sources=args.sources;this.targets=args.targets;this.part=args.part;incremntal++;this.test=args.test;this.points=args.points},draw:function(args){var colors=["red","green","blue","brown","black","orange","lime"];var colors=["black","black","black","black","black","black","black","black"];if(sources.indexOf(this.sources[0])===-1){sources.push(this.sources[0])}var color=colors[sources.indexOf(this.sources[0])];this.focalNode=document.createElementNS(SVGUtil.SVG,"polyline");this.focalNode.setAttribute("style","fill:none;stroke:"+color+";stroke-width:1px;");this.parentNode.appendChild(this.focalNode);if(this.points){this.focalNode.setAttribute("points",this.points)}else{this.setPosition();for(var typeIndex=0,type;type=["sources","targets"][typeIndex];typeIndex++){for(var index=0,current;current=this[type][index];index++){var currentPort=ShapesRegistry.get("Port",current);currentPort.addConnector(this,type);Events.connect("setPosition",currentPort,this,function(position){this.setPosition(position)});this.container.applyConstraints()}}}},setPosition:function(position){var positions=[];var properTarget=this["targets"][0];var properSource=this["sources"][0];var targetObject=ShapesRegistry.get("Port",properTarget);var sourceObject=ShapesRegistry.get("Port",properSource);if(targetObject.getPosition().x<sourceObject.getPosition().x){var temp=properSource;properSource=properTarget;properTarget=temp}var handler=function(x,y,direction){positions.push({x:x,y:y,direction:direction})};var adjustPosition=function(object){if(object.direction==="left"){object.x=object.x;object.y=object.y+(5)}else{if(object.direction==="right"){object.x=object.x+(10);object.y=object.y+(5)}else{if(object.direction==="top"){object.x=object.x+5;object.y=object.y}else{if(object.direction==="bottom"){object.y=object.y+10;object.x=object.x+(5)}}}}};var source=ShapesRegistry.get("Port",properSource);var sourcePart=source.container;var sourcePartPosition=sourcePart.getPosition();var sourcePosition=source.getPosition();StructureDiagramUtil.portToPart(properSource,handler);var target=ShapesRegistry.get("Port",properTarget);var targetPart=target.container;var targetPartPosition=targetPart.getPosition();var targetPosition=target.getPosition();StructureDiagramUtil.portToPart(properTarget,handler);var selfConnector=sourcePart===targetPart;var points=[];var pos1=positions[0];if(!positions[0]){return}sourcePosition.direction=pos1.direction;var pos2=positions[1];if(!pos2){return}targetPosition.direction=pos2.direction;var currentSourcePosition=source.getPosition();var currentTargetPosition=target.getPosition();var isInternal=false;var self=this;var revertDirectionForRelayPorts=function(currentPosition,current,other,otherPosition){if(current.isPrivate){if(otherPosition.direction==="left"){currentPosition.direction="right"}else{if(otherPosition.direction==="top"){currentPosition.direction="bottom"}else{if(otherPosition.direction==="bottom"){currentPosition.direction="top"}else{if(otherPosition.direction==="right"){currentPosition.direction="left"}}}}}else{if(current.parent===self.part&&(other.isPrivate||other.parent!==self.part)){if(currentPosition.direction==="left"){currentPosition.direction="right"}else{if(currentPosition.direction==="top"){currentPosition.direction="bottom"}else{if(currentPosition.direction==="bottom"){currentPosition.direction="top"}else{if(currentPosition.direction==="right"){currentPosition.direction="left"}}}}}}};if(source.isPrivate){revertDirectionForRelayPorts(targetPosition,target,source,sourcePosition);revertDirectionForRelayPorts(sourcePosition,source,target,targetPosition)}else{revertDirectionForRelayPorts(sourcePosition,source,target,targetPosition);revertDirectionForRelayPorts(targetPosition,target,source,sourcePosition)}var direction=sourcePosition.direction;var preciseTarget={x:targetPosition.x,y:targetPosition.y,direction:targetPosition.direction};adjustPosition(preciseTarget);var finalDestination={x:preciseTarget.x,y:preciseTarget.y};var preciseStart={x:sourcePosition.x,y:sourcePosition.y,direction:sourcePosition.direction};var moveTo=function(obj){var nextObj={};if(obj.direction==="left"){nextObj.x=obj.x-(10);nextObj.y=obj.y}else{if(obj.direction==="right"){nextObj.x=obj.x+(10);nextObj.y=obj.y}else{if(obj.direction==="top"){nextObj.x=obj.x;nextObj.y=obj.y-(10)}else{if(obj.direction==="bottom"){nextObj.x=obj.x;nextObj.y=obj.y+(10)}}}}nextObj.direction=obj.direction;return nextObj};var points=[];var start={x:sourcePosition.x,y:sourcePosition.y,direction:sourcePosition.direction};adjustPosition(start);points.push(start);var afterStart=moveTo(start);points.push(afterStart);var end={x:targetPosition.x,y:targetPosition.y,direction:targetPosition.direction};adjustPosition(end);var beforeEnd=moveTo(end);points.push({x:beforeEnd.x,y:afterStart.y});points.push(beforeEnd);points.push(end);var detectOverlappedPoints=function(){var length=points.length;for(var index=0;index<length-1;index++){var p1=points[index];var p2=points[index+1];var p3=points[index+2];var compareAtt=function(att){if(!p3){return false}if(p1[att]===p2[att]&&p2[att]===p3[att]){return true}return false};if(compareAtt("y")){var otherDiff=0;if(((sourcePosition.direction==="left")&&(targetPosition.direction==="left"))){var p4=points[index+3];if(p4){var differenceToPart=p4.y-p1.y}else{var differenceToPart=(targetPartPosition.y)-p1.y-(sourcePosition.h*1.5)}}else{if(((sourcePosition.direction==="left")&&(targetPosition.direction==="bottom"))){var differenceToPart=(targetPartPosition.y)-p1.y-(sourcePosition.h*1.5);if(targetPartPosition.x>sourcePartPosition.x&&sourcePartPosition.y<targetPartPosition.y){var otherDiff=(targetPartPosition.x)-p1.x-(sourcePosition.h*1.5)}}else{var differenceToPart=(sourcePartPosition.y+sourcePartPosition.h)-p2.y}}var upatedY=undefined;if(p2.x<p1.x&&p2.x<p3.x){upatedY=p2.y+differenceToPart;points.splice(index+2,0,{x:p2.x+otherDiff,y:upatedY})}else{if(p3.y<p1.y&&p3.y<p2.y){upatedY=p2.y-differenceToPart;points.splice(index+2,0,{x:p1.x,y:upatedY})}}if(upatedY){p3.y=upatedY}}else{if(compareAtt("x")){if((sourcePosition.direction==="bottom"&&targetPosition.direction==="top")){var differenceToPart=(targetPartPosition.x+targetPartPosition.w)-p1.x}else{if(((sourcePosition.direction==="right"||sourcePosition.direction==="bottom")&&(p2.direction==="top"||p2.direction==="bottom"))||(sourcePosition.direction==="top"&&(p3.direction==="bottom"||p3.direction==="top"))){if((targetPart===sourcePart&&(target.isPrivate||source.isPrivate))){var differenceToPart=(targetPosition.x)-p1.x-(sourcePosition.h)}else{var differenceToPart=(targetPartPosition.x)-p1.x-(sourcePosition.h*1.5)}if(sourcePosition.direction==="bottom"&&targetPosition.direction==="bottom"&&sourcePosition.y<targetPosition.y){var p0=points[index-1];if(p0){p0.y=p2.y;p1.y=p2.y}}}else{var differenceToPart=(targetPartPosition.x+targetPartPosition.w)-p1.x}}var upatedY=undefined;if(p2.y<p1.y&&p2.y<p3.y){if(points[index+1].direction===points[index+2].direction&&!points[index+3]&&!(targetPosition.direction==="top")){points.splice(index+1,1)}else{upatedY=p2.x+differenceToPart;points.splice(index+2,0,{x:p3.x,y:p2.y})}}else{if(p2.y>p1.y&&p2.y>p3.y){upatedY=p2.x+differenceToPart;points.splice(index+2,0,{x:p3.x,y:p2.y})}}if(upatedY){p1.x=upatedY;p2.x=upatedY}}}}};detectOverlappedPoints();var removeUnwantedReturns=function(){var lastSimilarPars=[];for(var index=1;index<points.length-5;index++){var p1=points[index];var p2=points[index+1];var p3=points[index+2];var p4=points[index+3];if(p1.x===p2.x&&p3.x===p4.x&&p4.x>p2.x){points[index+1].y=p4.y;points.splice(points.indexOf(p3),1);points.splice(points.indexOf(p4),1);index=1;continue}}};var shortenPath=function(){for(var index=1;index<points.length-3;index++){var point1=points[index];var point2=points[index+1];var point3=points[index+2];if(!((point3.direction==="left"||point3.direction==="top")&&point1.y<point3.y&&(point1.direction==="bottom"))||(point3.direction&&point3.direction===point1.direction)){continue}if(point1.y===point2.y&&point2.x===point3.x){point1.y=point3.y;if(points[index+3]){point3.x=points[index+3].x}points.splice(points.indexOf(point2),1);index=1;continue}}};shortenPath();removeUnwantedReturns();var findLongestLine=function(){var longest={points:[],delta:0};var length=points.length;for(var index=0;index<length-1;index++){var point1=points[index];var point2=points[index+1];var delta1=Math.abs(point2.x-point1.x);var delta2=Math.abs(point2.y-point1.y);var delta=delta1>delta2?delta1:delta2;if(longest.delta<delta){longest={points:[point1,point2],delta:delta}}}return longest.points};var getIntersection=function(line){var line=findLongestLine();var point1=line[0];var point2=line[1];var delta1=Math.abs(point2.x-point1.x);var delta2=Math.abs(point2.y-point1.y);if(delta1>delta2){return{direction:"horiontal",x:point1.x+(delta1/2),y:point1.y}}else{var p1;if(point1.y>point2.y){p1=point1}else{p1=point2}return{direction:"vertical",x:point2.x,y:p1.y-(delta2/2)}}};if(this.connectorType&&this.connectorType.length>0){var symnbolLocation=getIntersection(findLongestLine());var targetAsIs=ShapesRegistry.get("Port",this["targets"][0]);var sourceAsIs=ShapesRegistry.get("Port",this["sources"][0]);var receive;if(targetAsIs.getPosition().x>=sourceAsIs.getPosition().x){receive=false;if(symnbolLocation.direction==="vertical"){symnbolLocation.y=symnbolLocation.y-20}else{symnbolLocation.x=symnbolLocation.x-20}}else{receive=true;if(symnbolLocation.direction==="vertical"){symnbolLocation.y=symnbolLocation.y+20}else{symnbolLocation.yx=symnbolLocation.x+20}}var elem=ConnectorSymbols.draw(this,this.connectorType,symnbolLocation.direction,receive);elem.setAttribute("transform","translate("+symnbolLocation.x+","+symnbolLocation.y+")")}var sourceParent=source.focalNode.parentNode;var targetParent=target.focalNode.parentNode;var sourceParentParent=sourceParent.parentNode;var targetParentParent=targetParent.parentNode;sourceParentParent.removeChild(sourceParent);sourceParentParent.appendChild(sourceParent);targetParentParent.removeChild(targetParent);targetParentParent.appendChild(targetParent);this.focalNode.setAttribute("points",this.arrayToPoints(points))},arrayToPoints:function(points){var pointString="";for(var index=0,current;current=points[index];index++){if(pointString){pointString=pointString+" "}pointString=pointString+current.x+","+current.y}return pointString},getPosition:function(){return{x:parseFloat(this.focalNode.getAttribute("x")),y:parseFloat(this.focalNode.getAttribute("y")),w:13,h:13}}})})();