var Prototype={Version:"1.7.1",Browser:(function(){var e=navigator.userAgent,t=Object.prototype.toString.call(window.opera)=="[object Opera]";return{IE:!!window.attachEvent&&!t,Opera:t,WebKit:e.indexOf("AppleWebKit/")>-1,Gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,MobileSafari:/Apple.*Mobile/.test(e)}})(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:(function(){var e=window.Element||window.HTMLElement;return!!(e&&e.prototype)})(),SpecificElementExtensions:(function(){if(typeof window.HTMLDivElement<"u")return!0;var e=document.createElement("div"),t=document.createElement("form"),n=!1;return e.__proto__&&e.__proto__!==t.__proto__&&(n=!0),e=t=null,n})()},ScriptFragment:"<script[^>]*>([\\S\\s]*?)<\/script\\s*>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(e){return e}};Prototype.Browser.MobileSafari&&(Prototype.BrowserFeatures.SpecificElementExtensions=!1);var Class=(function(){var e=(function(){for(var o in{toString:1})if(o==="toString")return!1;return!0})();function t(){}function n(){var o=null,a=$A(arguments);Object.isFunction(a[0])&&(o=a.shift());function s(){this.initialize.apply(this,arguments)}Object.extend(s,Class.Methods),s.superclass=o,s.subclasses=[],o&&(t.prototype=o.prototype,s.prototype=new t,o.subclasses.push(s));for(var c=0,d=a.length;c<d;c++)s.addMethods(a[c]);return s.prototype.initialize||(s.prototype.initialize=Prototype.emptyFunction),s.prototype.constructor=s,s}function r(o){var a=this.superclass&&this.superclass.prototype,s=Object.keys(o);e&&(o.toString!=Object.prototype.toString&&s.push("toString"),o.valueOf!=Object.prototype.valueOf&&s.push("valueOf"));for(var c=0,d=s.length;c<d;c++){var u=s[c],f=o[u];if(a&&Object.isFunction(f)&&f.argumentNames()[0]=="$super"){var g=f;f=(function(h){return function(){return a[h].apply(this,arguments)}})(u).wrap(g),f.valueOf=(function(h){return function(){return h.valueOf.call(h)}})(g),f.toString=(function(h){return function(){return h.toString.call(h)}})(g)}this.prototype[u]=f}return this}return{create:n,Methods:{addMethods:r}}})();(function(){var e=Object.prototype.toString,t=Object.prototype.hasOwnProperty,n="Null",r="Undefined",o="Boolean",a="Number",s="String",c="Object",d="[object Function]",u="[object Boolean]",f="[object Number]",g="[object String]",h="[object Array]",b="[object Date]",E=window.JSON&&typeof JSON.stringify=="function"&&JSON.stringify(0)==="0"&&typeof JSON.stringify(Prototype.K)>"u",S=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],D=(function(){for(var W in{toString:1})if(W==="toString")return!1;return!0})();function j(W){switch(W){case null:return n;case void 0:return r}var ie=typeof W;switch(ie){case"boolean":return o;case"number":return a;case"string":return s}return c}function p(W,ie){for(var oe in ie)W[oe]=ie[oe];return W}function C(W){try{return Z(W)?"undefined":W===null?"null":W.inspect?W.inspect():String(W)}catch(ie){if(ie instanceof RangeError)return"...";throw ie}}function M(W){return _("",{"":W},[])}function _(W,ie,oe){var K=ie[W];j(K)===c&&typeof K.toJSON=="function"&&(K=K.toJSON(W));var le=e.call(K);switch(le){case f:case u:case g:K=K.valueOf()}switch(K){case null:return"null";case!0:return"true";case!1:return"false"}var he=typeof K;switch(he){case"string":return K.inspect(!0);case"number":return isFinite(K)?String(K):"null";case"object":for(var pe=0,ye=oe.length;pe<ye;pe++)if(oe[pe]===K)throw new TypeError("Cyclic reference to '"+K+"' in object");oe.push(K);var be=[];if(le===h){for(var pe=0,ye=K.length;pe<ye;pe++){var ve=_(pe,K,oe);be.push(typeof ve>"u"?"null":ve)}be="["+be.join(",")+"]"}else{for(var we=Object.keys(K),pe=0,ye=we.length;pe<ye;pe++){var W=we[pe],ve=_(W,K,oe);typeof ve<"u"&&be.push(W.inspect(!0)+":"+ve)}be="{"+be.join(",")+"}"}return oe.pop(),be}}function T(W){return JSON.stringify(W)}function P(W){return $H(W).toQueryString()}function k(W){return W&&W.toHTML?W.toHTML():String.interpret(W)}function U(W){if(j(W)!==c)throw new TypeError;var ie=[];for(var oe in W)t.call(W,oe)&&ie.push(oe);if(D)for(var K=0;oe=S[K];K++)t.call(W,oe)&&ie.push(oe);return ie}function N(W){var ie=[];for(var oe in W)ie.push(W[oe]);return ie}function R(W){return p({},W)}function B(W){return!!(W&&W.nodeType==1)}function H(W){return e.call(W)===h}var I=typeof Array.isArray=="function"&&Array.isArray([])&&!Array.isArray({});I&&(H=Array.isArray);function v(W){return W instanceof Hash}function L(W){return e.call(W)===d}function O(W){return e.call(W)===g}function z(W){return e.call(W)===f}function V(W){return e.call(W)===b}function Z(W){return typeof W>"u"}p(Object,{extend:p,inspect:C,toJSON:E?T:M,toQueryString:P,toHTML:k,keys:Object.keys||U,values:N,clone:R,isElement:B,isArray:H,isHash:v,isFunction:L,isString:O,isNumber:z,isDate:V,isUndefined:Z})})(),Object.extend(Function.prototype,(function(){var e=Array.prototype.slice;function t(h,b){for(var E=h.length,S=b.length;S--;)h[E+S]=b[S];return h}function n(h,b){return h=e.call(h,0),t(h,b)}function r(){var h=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return h.length==1&&!h[0]?[]:h}function o(h){if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;if(!Object.isFunction(this))throw new TypeError("The object is not callable.");var b=function(){},E=this,S=e.call(arguments,1),D=function(){var j=n(S,arguments),p=h,p=this instanceof D?this:h;return E.apply(p,j)};return b.prototype=this.prototype,D.prototype=new b,D}function a(h){var b=this,E=e.call(arguments,1);return function(S){var D=t([S||window.event],E);return b.apply(h,D)}}function s(){if(!arguments.length)return this;var h=this,b=e.call(arguments,0);return function(){var E=n(b,arguments);return h.apply(this,E)}}function c(h){var b=this,E=e.call(arguments,1);return h=h*1e3,window.setTimeout(function(){return b.apply(b,E)},h)}function d(){var h=t([.01],arguments);return this.delay.apply(this,h)}function u(h){var b=this;return function(){var E=t([b.bind(this)],arguments);return h.apply(this,E)}}function f(){if(this._methodized)return this._methodized;var h=this;return this._methodized=function(){var b=t([this],arguments);return h.apply(null,b)}}var g={argumentNames:r,bindAsEventListener:a,curry:s,delay:c,defer:d,wrap:u,methodize:f};return Function.prototype.bind||(g.bind=o),g})()),(function(e){function t(){return this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+"Z"}function n(){return this.toISOString()}e.toISOString||(e.toISOString=t),e.toJSON||(e.toJSON=n)})(Date.prototype),RegExp.prototype.match=RegExp.prototype.test,RegExp.escape=function(e){return String(e).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};var PeriodicalExecuter=Class.create({initialize:function(e,t){this.callback=e,this.frequency=t,this.currentlyExecuting=!1,this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1e3)},execute:function(){this.callback(this)},stop:function(){this.timer&&(clearInterval(this.timer),this.timer=null)},onTimerEvent:function(){if(!this.currentlyExecuting)try{this.currentlyExecuting=!0,this.execute(),this.currentlyExecuting=!1}catch(e){throw this.currentlyExecuting=!1,e}}});Object.extend(String,{interpret:function(e){return e==null?"":String(e)},specialChar:{"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"}}),Object.extend(String.prototype,(function(){var NATIVE_JSON_PARSE_SUPPORT=window.JSON&&typeof JSON.parse=="function"&&JSON.parse('{"test": true}').test;function prepareReplacement(e){if(Object.isFunction(e))return e;var t=new Template(e);return function(n){return t.evaluate(n)}}function gsub(e,t){var n="",r=this,o;if(t=prepareReplacement(t),Object.isString(e)&&(e=RegExp.escape(e)),!(e.length||e.source))return t=t(""),t+r.split("").join(t)+t;for(;r.length>0;)(o=r.match(e))?(n+=r.slice(0,o.index),n+=String.interpret(t(o)),r=r.slice(o.index+o[0].length)):(n+=r,r="");return n}function sub(e,t,n){return t=prepareReplacement(t),n=Object.isUndefined(n)?1:n,this.gsub(e,function(r){return--n<0?r[0]:t(r)})}function scan(e,t){return this.gsub(e,t),String(this)}function truncate(e,t){return e=e||30,t=Object.isUndefined(t)?"...":t,this.length>e?this.slice(0,e-t.length)+t:String(this)}function strip(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}function stripTags(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")}function stripScripts(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")}function extractScripts(){var e=new RegExp(Prototype.ScriptFragment,"img"),t=new RegExp(Prototype.ScriptFragment,"im");return(this.match(e)||[]).map(function(n){return(n.match(t)||["",""])[1]})}function evalScripts(){return this.extractScripts().map(function(script){return eval(script)})}function escapeHTML(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function unescapeHTML(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}function toQueryParams(e){var t=this.strip().match(/([^?#]*)(#.*)?$/);return t?t[1].split(e||"&").inject({},function(n,r){if((r=r.split("="))[0]){var o=decodeURIComponent(r.shift()),a=r.length>1?r.join("="):r[0];a!=null&&(a=decodeURIComponent(a)),o in n?(Object.isArray(n[o])||(n[o]=[n[o]]),n[o].push(a)):n[o]=a}return n}):{}}function toArray(){return this.split("")}function succ(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)}function times(e){return e<1?"":new Array(e+1).join(this)}function camelize(){return this.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})}function capitalize(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()}function underscore(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()}function dasherize(){return this.replace(/_/g,"-")}function inspect(e){var t=this.replace(/[\x00-\x1f\\]/g,function(n){return n in String.specialChar?String.specialChar[n]:"\\u00"+n.charCodeAt().toPaddedString(2,16)});return e?'"'+t.replace(/"/g,'\\"')+'"':"'"+t.replace(/'/g,"\\'")+"'"}function unfilterJSON(e){return this.replace(e||Prototype.JSONFilter,"$1")}function isJSON(){var e=this;return e.blank()?!1:(e=e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@"),e=e.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]"),e=e.replace(/(?:^|:|,)(?:\s*\[)+/g,""),/^[\],:{}\s]*$/.test(e))}function evalJSON(sanitize){var json=this.unfilterJSON(),cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;cx.test(json)&&(json=json.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));try{if(!sanitize||json.isJSON())return eval("("+json+")")}catch(e){}throw new SyntaxError("Badly formed JSON string: "+this.inspect())}function parseJSON(){var e=this.unfilterJSON();return JSON.parse(e)}function include(e){return this.indexOf(e)>-1}function startsWith(e){return this.lastIndexOf(e,0)===0}function endsWith(e){var t=this.length-e.length;return t>=0&&this.indexOf(e,t)===t}function empty(){return this==""}function blank(){return/^\s*$/.test(this)}function interpolate(e,t){return new Template(this,t).evaluate(e)}return{gsub,sub,scan,truncate,strip:String.prototype.trim||strip,stripTags,stripScripts,extractScripts,evalScripts,escapeHTML,unescapeHTML,toQueryParams,parseQuery:toQueryParams,toArray,succ,times,camelize,capitalize,underscore,dasherize,inspect,unfilterJSON,isJSON,evalJSON:NATIVE_JSON_PARSE_SUPPORT?parseJSON:evalJSON,include,startsWith,endsWith,empty,blank,interpolate}})());var Template=Class.create({initialize:function(e,t){this.template=e.toString(),this.pattern=t||Template.Pattern},evaluate:function(e){return e&&Object.isFunction(e.toTemplateReplacements)&&(e=e.toTemplateReplacements()),this.template.gsub(this.pattern,function(t){if(e==null)return t[1]+"";var n=t[1]||"";if(n=="\\")return t[2];var r=e,o=t[3],a=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;if(t=a.exec(o),t==null)return n;for(;t!=null;){var s=t[1].startsWith("[")?t[2].replace(/\\\\]/g,"]"):t[1];if(r=r[s],r==null||t[3]=="")break;o=o.substring(t[3]=="["?t[1].length:t[0].length),t=a.exec(o)}return n+String.interpret(r)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;var $break={},Enumerable=(function(){function e(T,P){try{this._each(T,P)}catch(k){if(k!=$break)throw k}return this}function t(T,P,k){var U=-T,N=[],R=this.toArray();if(T<1)return R;for(;(U+=T)<R.length;)N.push(R.slice(U,U+T));return N.collect(P,k)}function n(T,P){T=T||Prototype.K;var k=!0;return this.each(function(U,N){if(k=k&&!!T.call(P,U,N,this),!k)throw $break},this),k}function r(T,P){T=T||Prototype.K;var k=!1;return this.each(function(U,N){if(k=!!T.call(P,U,N,this))throw $break},this),k}function o(T,P){T=T||Prototype.K;var k=[];return this.each(function(U,N){k.push(T.call(P,U,N,this))},this),k}function a(T,P){var k;return this.each(function(U,N){if(T.call(P,U,N,this))throw k=U,$break},this),k}function s(T,P){var k=[];return this.each(function(U,N){T.call(P,U,N,this)&&k.push(U)},this),k}function c(T,P,k){P=P||Prototype.K;var U=[];return Object.isString(T)&&(T=new RegExp(RegExp.escape(T))),this.each(function(N,R){T.match(N)&&U.push(P.call(k,N,R,this))},this),U}function d(T){if(Object.isFunction(this.indexOf)&&this.indexOf(T)!=-1)return!0;var P=!1;return this.each(function(k){if(k==T)throw P=!0,$break}),P}function u(T,P){return P=Object.isUndefined(P)?null:P,this.eachSlice(T,function(k){for(;k.length<T;)k.push(P);return k})}function f(T,P,k){return this.each(function(U,N){T=P.call(k,T,U,N,this)},this),T}function g(T){var P=$A(arguments).slice(1);return this.map(function(k){return k[T].apply(k,P)})}function h(T,P){T=T||Prototype.K;var k;return this.each(function(U,N){U=T.call(P,U,N,this),(k==null||U>=k)&&(k=U)},this),k}function b(T,P){T=T||Prototype.K;var k;return this.each(function(U,N){U=T.call(P,U,N,this),(k==null||U<k)&&(k=U)},this),k}function E(T,P){T=T||Prototype.K;var k=[],U=[];return this.each(function(N,R){(T.call(P,N,R,this)?k:U).push(N)},this),[k,U]}function S(T){var P=[];return this.each(function(k){P.push(k[T])}),P}function D(T,P){var k=[];return this.each(function(U,N){T.call(P,U,N,this)||k.push(U)},this),k}function j(T,P){return this.map(function(k,U){return{value:k,criteria:T.call(P,k,U,this)}},this).sort(function(k,U){var N=k.criteria,R=U.criteria;return N<R?-1:N>R?1:0}).pluck("value")}function p(){return this.map()}function C(){var T=Prototype.K,P=$A(arguments);Object.isFunction(P.last())&&(T=P.pop());var k=[this].concat(P).map($A);return this.map(function(U,N){return T(k.pluck(N))})}function M(){return this.toArray().length}function _(){return"#<Enumerable:"+this.toArray().inspect()+">"}return{each:e,eachSlice:t,all:n,every:n,any:r,some:r,collect:o,map:o,detect:a,findAll:s,select:s,filter:s,grep:c,include:d,member:d,inGroupsOf:u,inject:f,invoke:g,max:h,min:b,partition:E,pluck:S,reject:D,sortBy:j,toArray:p,entries:p,zip:C,size:M,inspect:_,find:a}})();function $A(e){if(!e)return[];if("toArray"in Object(e))return e.toArray();for(var t=e.length||0,n=new Array(t);t--;)n[t]=e[t];return n}function $w(e){return Object.isString(e)?(e=e.strip(),e?e.split(/\s+/):[]):[]}Array.from=$A,(function(){var e=Array.prototype,t=e.slice,n=e.forEach;function r(R,B){for(var H=0,I=this.length>>>0;H<I;H++)H in this&&R.call(B,this[H],H,this)}n||(n=r);function o(){return this.length=0,this}function a(){return this[0]}function s(){return this[this.length-1]}function c(){return this.select(function(R){return R!=null})}function d(){return this.inject([],function(R,B){return Object.isArray(B)?R.concat(B.flatten()):(R.push(B),R)})}function u(){var R=t.call(arguments,0);return this.select(function(B){return!R.include(B)})}function f(R){return(R===!1?this.toArray():this)._reverse()}function g(R){return this.inject([],function(B,H,I){return(I==0||(R?B.last()!=H:!B.include(H)))&&B.push(H),B})}function h(R){return this.uniq().findAll(function(B){return R.indexOf(B)!==-1})}function b(){return t.call(this,0)}function E(){return this.length}function S(){return"["+this.map(Object.inspect).join(", ")+"]"}function D(R,B){if(this==null)throw new TypeError;var H=Object(this),I=H.length>>>0;if(I===0||(B=Number(B),isNaN(B)?B=0:B!==0&&isFinite(B)&&(B=(B>0?1:-1)*Math.floor(Math.abs(B))),B>I))return-1;for(var v=B>=0?B:Math.max(I-Math.abs(B),0);v<I;v++)if(v in H&&H[v]===R)return v;return-1}function j(R,B){if(this==null)throw new TypeError;var H=Object(this),I=H.length>>>0;if(I===0)return-1;Object.isUndefined(B)?B=I:(B=Number(B),isNaN(B)?B=0:B!==0&&isFinite(B)&&(B=(B>0?1:-1)*Math.floor(Math.abs(B))));for(var v=B>=0?Math.min(B,I-1):I-Math.abs(B);v>=0;v--)if(v in H&&H[v]===R)return v;return-1}function p(R){var B=[],H=t.call(arguments,0),I,v=0;H.unshift(this);for(var L=0,O=H.length;L<O;L++)if(I=H[L],Object.isArray(I)&&!("callee"in I))for(var z=0,V=I.length;z<V;z++)z in I&&(B[v]=I[z]),v++;else B[v++]=I;return B.length=v,B}function C(R){return function(){if(arguments.length===0)return R.call(this,Prototype.K);if(arguments[0]===void 0){var B=t.call(arguments,1);return B.unshift(Prototype.K),R.apply(this,B)}else return R.apply(this,arguments)}}function M(R){if(this==null)throw new TypeError;R=R||Prototype.K;for(var B=Object(this),H=[],I=arguments[1],v=0,L=0,O=B.length>>>0;L<O;L++)L in B&&(H[v]=R.call(I,B[L],L,B)),v++;return H.length=v,H}e.map&&(M=C(Array.prototype.map));function _(R){if(this==null||!Object.isFunction(R))throw new TypeError;for(var B=Object(this),H=[],I=arguments[1],v,L=0,O=B.length>>>0;L<O;L++)L in B&&(v=B[L],R.call(I,v,L,B)&&H.push(v));return H}e.filter&&(_=Array.prototype.filter);function T(R){if(this==null)throw new TypeError;R=R||Prototype.K;for(var B=arguments[1],H=Object(this),I=0,v=H.length>>>0;I<v;I++)if(I in H&&R.call(B,H[I],I,H))return!0;return!1}if(e.some)var T=C(Array.prototype.some);function P(R){if(this==null)throw new TypeError;R=R||Prototype.K;for(var B=arguments[1],H=Object(this),I=0,v=H.length>>>0;I<v;I++)if(I in H&&!R.call(B,H[I],I,H))return!1;return!0}if(e.every)var P=C(Array.prototype.every);var k=e.reduce;function U(R,B){B=B||Prototype.K;var H=arguments[2];return k.call(this,B.bind(H),R)}if(!e.reduce)var U=Enumerable.inject;Object.extend(e,Enumerable),e._reverse||(e._reverse=e.reverse),Object.extend(e,{_each:n,map:M,collect:M,select:_,filter:_,findAll:_,some:T,any:T,every:P,all:P,inject:U,clear:o,first:a,last:s,compact:c,flatten:d,without:u,reverse:f,uniq:g,intersect:h,clone:b,toArray:b,size:E,inspect:S});var N=(function(){return[].concat(arguments)[0][0]!==1})(1,2);N&&(e.concat=p),e.indexOf||(e.indexOf=D),e.lastIndexOf||(e.lastIndexOf=j)})();function $H(e){return new Hash(e)}var Hash=Class.create(Enumerable,(function(){function e(S){this._object=Object.isHash(S)?S.toObject():Object.clone(S)}function t(S,D){for(var j in this._object){var p=this._object[j],C=[j,p];C.key=j,C.value=p,S.call(D,C)}}function n(S,D){return this._object[S]=D}function r(S){if(this._object[S]!==Object.prototype[S])return this._object[S]}function o(S){var D=this._object[S];return delete this._object[S],D}function a(){return Object.clone(this._object)}function s(){return this.pluck("key")}function c(){return this.pluck("value")}function d(S){var D=this.detect(function(j){return j.value===S});return D&&D.key}function u(S){return this.clone().update(S)}function f(S){return new Hash(S).inject(this,function(D,j){return D.set(j.key,j.value),D})}function g(S,j){if(Object.isUndefined(j))return S;var j=String.interpret(j);return j=j.gsub(/(\r)?\n/,`\r
`),j=encodeURIComponent(j),j=j.gsub(/%20/,"+"),S+"="+j}function h(){return this.inject([],function(S,D){var j=encodeURIComponent(D.key),p=D.value;if(p&&typeof p=="object"){if(Object.isArray(p)){for(var C=[],M=0,_=p.length,T;M<_;M++)T=p[M],C.push(g(j,T));return S.concat(C)}}else S.push(g(j,p));return S}).join("&")}function b(){return"#<Hash:{"+this.map(function(S){return S.map(Object.inspect).join(": ")}).join(", ")+"}>"}function E(){return new Hash(this)}return{initialize:e,_each:t,set:n,get:r,unset:o,toObject:a,toTemplateReplacements:a,keys:s,values:c,index:d,merge:u,update:f,toQueryString:h,inspect:b,toJSON:a,clone:E}})());Hash.from=$H,Object.extend(Number.prototype,(function(){function e(){return this.toPaddedString(2,16)}function t(){return this+1}function n(d,u){return $R(0,this,!0).each(d,u),this}function r(d,u){var f=this.toString(u||10);return"0".times(d-f.length)+f}function o(){return Math.abs(this)}function a(){return Math.round(this)}function s(){return Math.ceil(this)}function c(){return Math.floor(this)}return{toColorPart:e,succ:t,times:n,toPaddedString:r,abs:o,round:a,ceil:s,floor:c}})());function $R(e,t,n){return new ObjectRange(e,t,n)}var ObjectRange=Class.create(Enumerable,(function(){function e(r,o,a){this.start=r,this.end=o,this.exclusive=a}function t(r,o){for(var a=this.start;this.include(a);)r.call(o,a),a=a.succ()}function n(r){return r<this.start?!1:this.exclusive?r<this.end:r<=this.end}return{initialize:e,_each:t,include:n}})()),Abstract={},Try={these:function(){for(var e,t=0,n=arguments.length;t<n;t++){var r=arguments[t];try{e=r();break}catch{}}return e}},Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||!1},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(e,t){this.responders._each(e,t)},register:function(e){this.include(e)||this.responders.push(e)},unregister:function(e){this.responders=this.responders.without(e)},dispatch:function(e,t,n,r){this.each(function(o){if(Object.isFunction(o[e]))try{o[e].apply(o,[t,n,r])}catch{}})}},Object.extend(Ajax.Responders,Enumerable),Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}}),Ajax.Base=Class.create({initialize:function(e){this.options={method:"post",asynchronous:!0,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:!0,evalJS:!0},Object.extend(this.options,e||{}),this.options.method=this.options.method.toLowerCase(),Object.isHash(this.options.parameters)&&(this.options.parameters=this.options.parameters.toObject())}}),Ajax.Request=Class.create(Ajax.Base,{_complete:!1,initialize:function(e,t,n){e(n),this.transport=Ajax.getTransport(),this.request(t)},request:function(e){this.url=e,this.method=this.options.method;var t=Object.isString(this.options.parameters)?this.options.parameters:Object.toQueryString(this.options.parameters);["get","post"].include(this.method)||(t+=(t?"&":"")+"_method="+this.method,this.method="post"),t&&this.method==="get"&&(this.url+=(this.url.include("?")?"&":"?")+t),this.parameters=t.toQueryParams();try{var n=new Ajax.Response(this);this.options.onCreate&&this.options.onCreate(n),Ajax.Responders.dispatch("onCreate",this,n),this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous),this.options.asynchronous&&this.respondToReadyState.bind(this).defer(1),this.transport.onreadystatechange=this.onStateChange.bind(this),this.setRequestHeaders(),this.body=this.method=="post"?this.options.postBody||t:null,this.transport.send(this.body),!this.options.asynchronous&&this.transport.overrideMimeType&&this.onStateChange()}catch(r){this.dispatchException(r)}},onStateChange:function(){var e=this.transport.readyState;e>1&&!(e==4&&this._complete)&&this.respondToReadyState(this.transport.readyState)},setRequestHeaders:function(){var e={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if(this.method=="post"&&(e["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:""),this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005&&(e.Connection="close")),typeof this.options.requestHeaders=="object"){var t=this.options.requestHeaders;if(Object.isFunction(t.push))for(var n=0,r=t.length;n<r;n+=2)e[t[n]]=t[n+1];else $H(t).each(function(a){e[a.key]=a.value})}for(var o in e)this.transport.setRequestHeader(o,e[o])},success:function(){var e=this.getStatus();return!e||e>=200&&e<300||e==304},getStatus:function(){try{return this.transport.status===1223?204:this.transport.status||0}catch{return 0}},respondToReadyState:function(e){var t=Ajax.Request.Events[e],n=new Ajax.Response(this);if(t=="Complete"){try{this._complete=!0,(this.options["on"+n.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(n,n.headerJSON)}catch(o){this.dispatchException(o)}var r=n.getHeader("Content-type");(this.options.evalJS=="force"||this.options.evalJS&&this.isSameOrigin()&&r&&r.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))&&this.evalResponse()}try{(this.options["on"+t]||Prototype.emptyFunction)(n,n.headerJSON),Ajax.Responders.dispatch("on"+t,this,n,n.headerJSON)}catch(o){this.dispatchException(o)}t=="Complete"&&(this.transport.onreadystatechange=Prototype.emptyFunction)},isSameOrigin:function(){var e=this.url.match(/^\s*https?:\/\/[^\/]*/);return!e||e[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""})},getHeader:function(e){try{return this.transport.getResponseHeader(e)||null}catch{return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(e){this.dispatchException(e)}},dispatchException:function(e){(this.options.onException||Prototype.emptyFunction)(this,e),Ajax.Responders.dispatch("onException",this,e)}}),Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"],Ajax.Response=Class.create({initialize:function(e){this.request=e;var t=this.transport=e.transport,n=this.readyState=t.readyState;if((n>2&&!Prototype.Browser.IE||n==4)&&(this.status=this.getStatus(),this.statusText=this.getStatusText(),this.responseText=String.interpret(t.responseText),this.headerJSON=this._getHeaderJSON()),n==4){var r=t.responseXML;this.responseXML=Object.isUndefined(r)?null:r,this.responseJSON=this._getResponseJSON()}},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch{return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch{return null}},getResponseHeader:function(e){return this.transport.getResponseHeader(e)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var e=this.getHeader("X-JSON");if(!e)return null;try{e=decodeURIComponent(escape(e))}catch{}try{return e.evalJSON(this.request.options.sanitizeJSON||!this.request.isSameOrigin())}catch(t){this.request.dispatchException(t)}},_getResponseJSON:function(){var e=this.request.options;if(!e.evalJSON||e.evalJSON!="force"&&!(this.getHeader("Content-type")||"").include("application/json")||this.responseText.blank())return null;try{return this.responseText.evalJSON(e.sanitizeJSON||!this.request.isSameOrigin())}catch(t){this.request.dispatchException(t)}}}),Ajax.Updater=Class.create(Ajax.Request,{initialize:function(e,t,n,r){this.container={success:t.success||t,failure:t.failure||(t.success?null:t)},r=Object.clone(r);var o=r.onComplete;r.onComplete=(function(a,s){this.updateContent(a.responseText),Object.isFunction(o)&&o(a,s)}).bind(this),e(n,r)},updateContent:function(e){var t=this.container[this.success()?"success":"failure"],n=this.options;if(n.evalScripts||(e=e.stripScripts()),t=$(t))if(n.insertion)if(Object.isString(n.insertion)){var r={};r[n.insertion]=e,t.insert(r)}else n.insertion(t,e);else t.update(e)}}),Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function(e,t,n,r){e(r),this.onComplete=this.options.onComplete,this.frequency=this.options.frequency||2,this.decay=this.options.decay||1,this.updater={},this.container=t,this.url=n,this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this),this.onTimerEvent()},stop:function(){this.updater.options.onComplete=void 0,clearTimeout(this.timer),(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},updateComplete:function(e){this.options.decay&&(this.decay=e.responseText==this.lastText?this.decay*this.options.decay:1,this.lastText=e.responseText),this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}}),(function(e){var t,n=Array.prototype.slice,r=document.createElement("div");function o(m){if(arguments.length>1){for(var A=0,Q=[],J=arguments.length;A<J;A++)Q.push(o(arguments[A]));return Q}return Object.isString(m)&&(m=document.getElementById(m)),u.extend(m)}e.$=o,e.Node||(e.Node={}),e.Node.ELEMENT_NODE||Object.extend(e.Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12});var a={};function s(m,A){return!(m==="select"||"type"in A)}var c=(function(){try{var m=document.createElement('<input name="x">');return m.tagName.toLowerCase()==="input"&&m.name==="x"}catch{return!1}})(),d=e.Element;function u(m,A){if(A=A||{},m=m.toLowerCase(),c&&A.name)return m="<"+m+' name="'+A.name+'">',delete A.name,u.writeAttribute(document.createElement(m),A);a[m]||(a[m]=u.extend(document.createElement(m)));var Q=s(m,A)?a[m].cloneNode(!1):document.createElement(m);return u.writeAttribute(Q,A)}e.Element=u,Object.extend(e.Element,d||{}),d&&(e.Element.prototype=d.prototype),u.Methods={ByTag:{},Simulated:{}};var f={},g={id:"id",className:"class"};function h(m){m=o(m);var A="<"+m.tagName.toLowerCase(),Q,J;for(var ae in g)Q=g[ae],J=(m[ae]||"").toString(),J&&(A+=" "+Q+"="+J.inspect(!0));return A+">"}f.inspect=h;function b(m){return o(m).style.display!=="none"}function E(m,A){return m=o(m),Object.isUndefined(A)&&(A=!u.visible(m)),u[A?"show":"hide"](m),m}function S(m){return m=o(m),m.style.display="none",m}function D(m){return m=o(m),m.style.display="",m}Object.extend(f,{visible:b,toggle:E,hide:S,show:D});function j(m){return m=o(m),m.parentNode.removeChild(m),m}var p=(function(){var m=document.createElement("select"),A=!0;return m.innerHTML='<option value="test">test</option>',m.options&&m.options[0]&&(A=m.options[0].nodeName.toUpperCase()!=="OPTION"),m=null,A})(),C=(function(){try{var m=document.createElement("table");if(m&&m.tBodies){m.innerHTML="<tbody><tr><td>test</td></tr></tbody>";var A=typeof m.tBodies[0]>"u";return m=null,A}}catch{return!0}})(),M=(function(){try{var m=document.createElement("div");m.innerHTML="<link />";var A=m.childNodes.length===0;return m=null,A}catch{return!0}})(),_=p||C||M,T=(function(){var m=document.createElement("script"),A=!1;try{m.appendChild(document.createTextNode("")),A=!m.firstChild||m.firstChild&&m.firstChild.nodeType!==3}catch{A=!0}return m=null,A})();function P(m,A){m=o(m);for(var Q=m.getElementsByTagName("*"),J=Q.length;J--;)Z(Q[J]);if(A&&A.toElement&&(A=A.toElement()),Object.isElement(A))return m.update().insert(A);A=Object.toHTML(A);var ae=m.tagName.toUpperCase();if(ae==="SCRIPT"&&T)return m.text=A,m;if(_)if(ae in U.tags){for(;m.firstChild;)m.removeChild(m.firstChild);for(var ce=z(ae,A.stripScripts()),J=0,Ae;Ae=ce[J];J++)m.appendChild(Ae)}else if(M&&Object.isString(A)&&A.indexOf("<link")>-1){for(;m.firstChild;)m.removeChild(m.firstChild);for(var ce=z(ae,A.stripScripts(),!0),J=0,Ae;Ae=ce[J];J++)m.appendChild(Ae)}else m.innerHTML=A.stripScripts();else m.innerHTML=A.stripScripts();return A.evalScripts.bind(A).defer(),m}function k(m,A){if(m=o(m),A&&A.toElement)A=A.toElement();else if(!Object.isElement(A)){A=Object.toHTML(A);var Q=m.ownerDocument.createRange();Q.selectNode(m),A.evalScripts.bind(A).defer(),A=Q.createContextualFragment(A.stripScripts())}return m.parentNode.replaceChild(A,m),m}var U={before:function(m,A){m.parentNode.insertBefore(A,m)},top:function(m,A){m.insertBefore(A,m.firstChild)},bottom:function(m,A){m.appendChild(A)},after:function(m,A){m.parentNode.insertBefore(A,m.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}},N=U.tags;Object.extend(N,{THEAD:N.TBODY,TFOOT:N.TBODY,TH:N.TD});function R(m,A){if(m=o(m),A&&A.toElement&&(A=A.toElement()),Object.isElement(A))return m.parentNode.replaceChild(A,m),m;A=Object.toHTML(A);var Q=m.parentNode,J=Q.tagName.toUpperCase();if(J in U.tags){var ae=u.next(m),ce=z(J,A.stripScripts());Q.removeChild(m);var Ae;ae?Ae=function(je){Q.insertBefore(je,ae)}:Ae=function(je){Q.appendChild(je)},ce.each(Ae)}else m.outerHTML=A.stripScripts();return A.evalScripts.bind(A).defer(),m}"outerHTML"in document.documentElement&&(k=R);function B(m){return Object.isUndefined(m)||m===null?!1:!!(Object.isString(m)||Object.isNumber(m)||Object.isElement(m)||m.toElement||m.toHTML)}function H(m,A,Q){Q=Q.toLowerCase();var J=U[Q];if(A&&A.toElement&&(A=A.toElement()),Object.isElement(A))return J(m,A),m;A=Object.toHTML(A);var ae=(Q==="before"||Q==="after"?m.parentNode:m).tagName.toUpperCase(),ce=z(ae,A.stripScripts());(Q==="top"||Q==="after")&&ce.reverse();for(var Ae=0,je;je=ce[Ae];Ae++)J(m,je);A.evalScripts.bind(A).defer()}function I(m,A){m=o(m),B(A)&&(A={bottom:A});for(var Q in A)H(m,A[Q],Q);return m}function v(m,A,Q){return m=o(m),Object.isElement(A)?o(A).writeAttribute(Q||{}):Object.isString(A)?A=new u(A,Q):A=new u("div",A),m.parentNode&&m.parentNode.replaceChild(A,m),A.appendChild(m),A}function L(m){m=o(m);for(var A=m.firstChild;A;){var Q=A.nextSibling;A.nodeType===Node.TEXT_NODE&&!/\S/.test(A.nodeValue)&&m.removeChild(A),A=Q}return m}function O(m){return o(m).innerHTML.blank()}function z(m,A,Q){var J=U.tags[m],ae=r,ce=!!J;if(!ce&&Q&&(ce=!0,J=["","",0]),ce){ae.innerHTML="&#160;"+J[0]+A+J[1],ae.removeChild(ae.firstChild);for(var Ae=J[2];Ae--;)ae=ae.firstChild}else ae.innerHTML=A;return $A(ae.childNodes)}function V(m,A){if(m=o(m)){var Q=m.cloneNode(A);if(!Qe&&(Q._prototypeUID=t,A))for(var J=u.select(Q,"*"),ae=J.length;ae--;)J[ae]._prototypeUID=t;return u.extend(Q)}}function Z(m){var A=_e(m);A&&(u.stopObserving(m),Qe||(m._prototypeUID=t),delete u.Storage[A])}function W(m){for(var A=m.length;A--;)Z(m[A])}function ie(m){for(var A=m.length,Q,J;A--;)Q=m[A],J=_e(Q),delete u.Storage[J],delete Event.cache[J]}Qe&&(W=ie);function oe(m){if(m=o(m)){Z(m);for(var A=m.getElementsByTagName("*"),Q=A.length;Q--;)Z(A[Q]);return null}}Object.extend(f,{remove:j,update:P,replace:k,insert:I,wrap:v,cleanWhitespace:L,empty:O,clone:V,purge:oe});function K(m,A,Q){m=o(m),Q=Q||-1;for(var J=[];(m=m[A])&&(m.nodeType===Node.ELEMENT_NODE&&J.push(u.extend(m)),J.length!==Q););return J}function le(m){return K(m,"parentNode")}function he(m){return u.select(m,"*")}function pe(m){for(m=o(m).firstChild;m&&m.nodeType!==Node.ELEMENT_NODE;)m=m.nextSibling;return o(m)}function ye(m){for(var A=[],Q=o(m).firstChild;Q;)Q.nodeType===Node.ELEMENT_NODE&&A.push(u.extend(Q)),Q=Q.nextSibling;return A}function be(m){return K(m,"previousSibling")}function ve(m){return K(m,"nextSibling")}function we(m){m=o(m);var A=be(m),Q=ve(m);return A.reverse().concat(Q)}function ne(m,A){return m=o(m),Object.isString(A)?Prototype.Selector.match(m,A):A.match(m)}function F(m,A,Q,J){for(m=o(m),Q=Q||0,J=J||0,Object.isNumber(Q)&&(J=Q,Q=null);m=m[A];)if(m.nodeType===1&&!(Q&&!Prototype.Selector.match(m,Q))&&!(--J>=0))return u.extend(m)}function G(m,A,Q){return m=o(m),arguments.length===1?o(m.parentNode):F(m,"parentNode",A,Q)}function Y(m,A,Q){m=o(m),A=A||0,Q=Q||0,Object.isNumber(A)&&(Q=A,A="*");var J=Prototype.Selector.select(A,m)[Q];return u.extend(J)}function ee(m,A,Q){return F(m,"previousSibling",A,Q)}function q(m,A,Q){return F(m,"nextSibling",A,Q)}function X(m){m=o(m);var A=n.call(arguments,1).join(", ");return Prototype.Selector.select(A,m)}function re(m){m=o(m);for(var A=n.call(arguments,1).join(", "),Q=u.siblings(m),J=[],ae=0,ce;ce=Q[ae];ae++)Prototype.Selector.match(ce,A)&&J.push(ce);return J}function te(m,A){for(m=o(m),A=o(A);m=m.parentNode;)if(m===A)return!0;return!1}function ue(m,A){return m=o(m),A=o(A),A.contains?A.contains(m)&&A!==m:te(m,A)}function Ce(m,A){return m=o(m),A=o(A),(m.compareDocumentPosition(A)&8)===8}var ge;r.compareDocumentPosition?ge=Ce:r.contains?ge=ue:ge=te,Object.extend(f,{recursivelyCollect:K,ancestors:le,descendants:he,firstDescendant:pe,immediateDescendants:ye,previousSiblings:be,nextSiblings:ve,siblings:we,match:ne,up:G,down:Y,previous:ee,next:q,select:X,adjacent:re,descendantOf:ge,getElementsBySelector:X,childElements:ye});var Le=1;function Se(m){m=o(m);var A=u.readAttribute(m,"id");if(A)return A;do A="anonymous_element_"+Le++;while(o(A));return u.writeAttribute(m,"id",A),A}function Ee(m,A){return o(m).getAttribute(A)}function de(m,A){m=o(m);var Q=ke.read;return Q.values[A]?Q.values[A](m,A):(Q.names[A]&&(A=Q.names[A]),A.include(":")?!m.attributes||!m.attributes[A]?null:m.attributes[A].value:m.getAttribute(A))}function se(m,A){return A==="title"?m.title:m.getAttribute(A)}var me=(function(){r.setAttribute("onclick",Prototype.emptyFunction);var m=r.getAttribute("onclick"),A=typeof m=="function";return r.removeAttribute("onclick"),A})();me?Ee=de:Prototype.Browser.Opera&&(Ee=se);function Pe(m,A,Q){m=o(m);var J={},ae=ke.write;typeof A=="object"?J=A:J[A]=Object.isUndefined(Q)?!0:Q;for(var ce in J)A=ae.names[ce]||ce,Q=J[ce],ae.values[ce]&&(A=ae.values[ce](m,Q)),Q===!1||Q===null?m.removeAttribute(A):Q===!0?m.setAttribute(A,A):m.setAttribute(A,Q);return m}function fe(m,A){A=ke.has[A]||A;var Q=o(m).getAttributeNode(A);return!!(Q&&Q.specified)}e.Element.Methods.Simulated.hasAttribute=fe;function Te(m){return new u.ClassNames(m)}var Me={};function Je(m){if(Me[m])return Me[m];var A=new RegExp("(^|\\s+)"+m+"(\\s+|$)");return Me[m]=A,A}function Be(m,A){if(m=o(m)){var Q=m.className;return Q.length===0?!1:Q===A?!0:Je(A).test(Q)}}function at(m,A){if(m=o(m))return Be(m,A)||(m.className+=(m.className?" ":"")+A),m}function st(m,A){if(m=o(m))return m.className=m.className.replace(Je(A)," ").strip(),m}function lt(m,A,Q){if(m=o(m)){Object.isUndefined(Q)&&(Q=!Be(m,A));var J=u[Q?"addClassName":"removeClassName"];return J(m,A)}}var ke={},Ie="className",Re="for";r.setAttribute(Ie,"x"),r.className!=="x"&&(r.setAttribute("class","x"),r.className==="x"&&(Ie="class"));var Ue=document.createElement("label");Ue.setAttribute(Re,"x"),Ue.htmlFor!=="x"&&(Ue.setAttribute("htmlFor","x"),Ue.htmlFor==="x"&&(Re="htmlFor")),Ue=null;function ct(m,A){return m.getAttribute(A)}function Ke(m,A){return m.getAttribute(A,2)}function ut(m,A){var Q=m.getAttributeNode(A);return Q?Q.value:""}function He(m,A){return o(m).hasAttribute(A)?A:null}r.onclick=Prototype.emptyFunction;var Xe=r.getAttribute("onclick"),xe;String(Xe).indexOf("{")>-1?xe=function(m,A){var Q=m.getAttribute(A);return Q?(Q=Q.toString(),Q=Q.split("{")[1],Q=Q.split("}")[0],Q.strip()):null}:Xe===""&&(xe=function(m,A){var Q=m.getAttribute(A);return Q?Q.strip():null}),ke.read={names:{class:Ie,className:Ie,for:Re,htmlFor:Re},values:{style:function(m){return m.style.cssText.toLowerCase()},title:function(m){return m.title}}},ke.write={names:{className:"class",htmlFor:"for",cellpadding:"cellPadding",cellspacing:"cellSpacing"},values:{checked:function(m,A){m.checked=!!A},style:function(m,A){m.style.cssText=A||""}}},ke.has={names:{}},Object.extend(ke.write.names,ke.read.names);for(var dt=$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc frameBorder"),Ze=0,Oe;Oe=dt[Ze];Ze++)ke.write.names[Oe.toLowerCase()]=Oe,ke.has.names[Oe.toLowerCase()]=Oe;Object.extend(ke.read.values,{href:Ke,src:Ke,type:ct,action:ut,disabled:He,checked:He,readonly:He,multiple:He,onload:xe,onunload:xe,onclick:xe,ondblclick:xe,onmousedown:xe,onmouseup:xe,onmouseover:xe,onmousemove:xe,onmouseout:xe,onfocus:xe,onblur:xe,onkeypress:xe,onkeydown:xe,onkeyup:xe,onsubmit:xe,onreset:xe,onselect:xe,onchange:xe}),Object.extend(f,{identify:Se,readAttribute:Ee,writeAttribute:Pe,classNames:Te,hasClassName:Be,addClassName:at,removeClassName:st,toggleClassName:lt});function ft(m){return m==="float"||m==="styleFloat"?"cssFloat":m.camelize()}function pt(m){return m==="float"||m==="cssFloat"?"styleFloat":m.camelize()}function ht(m,A){m=o(m);var Q=m.style,J;if(Object.isString(A)){if(Q.cssText+=";"+A,A.include("opacity")){var ae=A.match(/opacity:\s*(\d?\.?\d*)/)[1];u.setOpacity(m,ae)}return m}for(var ce in A)if(ce==="opacity")u.setOpacity(m,A[ce]);else{var Ae=A[ce];(ce==="float"||ce==="cssFloat")&&(ce=Object.isUndefined(Q.styleFloat)?"cssFloat":"styleFloat"),Q[ce]=Ae}return m}function ze(m,A){m=o(m),A=ft(A);var Q=m.style[A];if(!Q||Q==="auto"){var J=document.defaultView.getComputedStyle(m,null);Q=J?J[A]:null}return A==="opacity"?Q?parseFloat(Q):1:Q==="auto"?null:Q}function Tt(m,A){switch(A){case"height":case"width":if(!u.visible(m))return null;var Q=parseInt(ze(m,A),10);return Q!==m["offset"+A.capitalize()]?Q+"px":u.measure(m,A);default:return ze(m,A)}}function gt(m,A){m=o(m),A=pt(A);var Q=m.style[A];return!Q&&m.currentStyle&&(Q=m.currentStyle[A]),A==="opacity"&&!Ge?nt(m):Q==="auto"?(A==="width"||A==="height")&&u.visible(m)?u.measure(m,A)+"px":null:Q}function et(m){return(m||"").replace(/alpha\([^\)]*\)/gi,"")}function mt(m){return m.currentStyle.hasLayout||(m.style.zoom=1),m}var Ge=(function(){return r.style.cssText="opacity:.55",/^0.55/.test(r.style.opacity)})();function tt(m,A){return m=o(m),A==1||A===""?A="":A<1e-5&&(A=0),m.style.opacity=A,m}function vt(m,A){if(Ge)return tt(m,A);m=mt(o(m));var Q=u.getStyle(m,"filter"),J=m.style;return A==1||A===""?(Q=et(Q),Q?J.filter=Q:J.removeAttribute("filter"),m):(A<1e-5&&(A=0),J.filter=et(Q)+"alpha(opacity="+A*100+")",m)}function it(m){return u.getStyle(m,"opacity")}function nt(m){if(Ge)return it(m);var A=u.getStyle(m,"filter");if(A.length===0)return 1;var Q=(A||"").match(/alpha\(opacity=(.*)\)/);return Q[1]?parseFloat(Q[1])/100:1}Object.extend(f,{setStyle:ht,getStyle:ze,setOpacity:tt,getOpacity:it}),"styleFloat"in r.style&&(f.getStyle=gt,f.setOpacity=vt,f.getOpacity=nt);var kt=0;e.Element.Storage={UID:1};function _e(m){return m===window?0:(typeof m._prototypeUID>"u"&&(m._prototypeUID=u.Storage.UID++),m._prototypeUID)}function yt(m){return m===window?0:m==document?1:m.uniqueID}var Qe="uniqueID"in r;Qe&&(_e=yt);function qe(m){if(m=o(m)){var A=_e(m);return u.Storage[A]||(u.Storage[A]=$H()),u.Storage[A]}}function bt(m,A,Q){if(m=o(m)){var J=qe(m);return arguments.length===2?J.update(A):J.set(A,Q),m}}function Ct(m,A,Q){if(m=o(m)){var J=qe(m),ae=J.get(A);return Object.isUndefined(ae)&&(J.set(A,Q),ae=Q),ae}}Object.extend(f,{getStorage:qe,store:bt,retrieve:Ct});var Ve={},De=u.Methods.ByTag,Ne=Prototype.BrowserFeatures;!Ne.ElementExtensions&&"__proto__"in r&&(e.HTMLElement={},e.HTMLElement.prototype=r.__proto__,Ne.ElementExtensions=!0);function xt(m){if(typeof window.Element>"u")return!1;var A=window.Element.prototype;if(A){var Q="_"+(Math.random()+"").slice(2),J=document.createElement(m);A[Q]="x";var ae=J[Q]!=="x";return delete A[Q],J=null,ae}return!1}var wt=xt("object");function Fe(m,A){for(var Q in A){var J=A[Q];Object.isFunction(J)&&!(Q in m)&&(m[Q]=J.methodize())}}var $e={};function rt(m){var A=_e(m);return A in $e}function We(m){if(!m||rt(m)||m.nodeType!==Node.ELEMENT_NODE||m==window)return m;var A=Object.clone(Ve),Q=m.tagName.toUpperCase();return De[Q]&&Object.extend(A,De[Q]),Fe(m,A),$e[_e(m)]=!0,m}function Et(m){if(!m||rt(m))return m;var A=m.tagName;return A&&/^(?:object|applet|embed)$/i.test(A)&&(Fe(m,u.Methods),Fe(m,u.Methods.Simulated),Fe(m,u.Methods.ByTag[A.toUpperCase()])),m}Ne.SpecificElementExtensions&&(We=wt?Et:Prototype.K);function ot(m,A){m=m.toUpperCase(),De[m]||(De[m]={}),Object.extend(De[m],A)}function Ye(m,A,Q){Object.isUndefined(Q)&&(Q=!1);for(var J in A){var ae=A[J];Object.isFunction(ae)&&(!Q||!(J in m))&&(m[J]=ae.methodize())}}function At(m){var A,Q={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};if(Q[m]&&(A="HTML"+Q[m]+"Element"),window[A]||(A="HTML"+m+"Element",window[A])||(A="HTML"+m.capitalize()+"Element",window[A]))return window[A];var J=document.createElement(m),ae=J.__proto__||J.constructor.prototype;return J=null,ae}function St(m){if(arguments.length===0&&Pt(),arguments.length===2){var A=m;m=arguments[1]}if(!A)Object.extend(u.Methods,m||{});else if(Object.isArray(A))for(var Q=0,J;J=A[Q];Q++)ot(J,m);else ot(A,m);var ae=window.HTMLElement?HTMLElement.prototype:u.prototype;if(Ne.ElementExtensions&&(Ye(ae,u.Methods),Ye(ae,u.Methods.Simulated,!0)),Ne.SpecificElementExtensions)for(var J in u.Methods.ByTag){var ce=At(J);Object.isUndefined(ce)||Ye(ce.prototype,De[J])}Object.extend(u,u.Methods),Object.extend(u,u.Methods.Simulated),delete u.ByTag,delete u.Simulated,u.extend.refresh(),a={}}Object.extend(e.Element,{extend:We,addMethods:St}),We===Prototype.K?e.Element.extend.refresh=Prototype.emptyFunction:e.Element.extend.refresh=function(){Prototype.BrowserFeatures.ElementExtensions||(Object.extend(Ve,u.Methods),Object.extend(Ve,u.Methods.Simulated),$e={})};function Pt(){Object.extend(Form,Form.Methods),Object.extend(Form.Element,Form.Element.Methods),Object.extend(u.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods),BUTTON:Object.clone(Form.Element.Methods)})}u.addMethods(f)})(this),(function(){function e(v){var L=v.match(/^(\d+)%?$/i);return L?Number(L[1])/100:null}function t(v,L){v=$(v);var O=v.style[L];if(!O||O==="auto"){var z=document.defaultView.getComputedStyle(v,null);O=z?z[L]:null}return L==="opacity"?O?parseFloat(O):1:O==="auto"?null:O}function n(v,L){var O=v.style[L];return!O&&v.currentStyle&&(O=v.currentStyle[L]),O}function r(v,L){var O=v.offsetWidth,z=o(v,"borderLeftWidth",L)||0,V=o(v,"borderRightWidth",L)||0,Z=o(v,"paddingLeft",L)||0,W=o(v,"paddingRight",L)||0;return O-z-V-Z-W}"currentStyle"in document.documentElement&&(t=n);function o(v,L,O){var z=null;if(Object.isElement(v)&&(z=v,v=t(z,L)),v===null||Object.isUndefined(v))return null;if(/^(?:-)?\d+(\.\d+)?(px)?$/i.test(v))return window.parseFloat(v);var V=v.include("%"),Z=O===document.viewport;if(/\d/.test(v)&&z&&z.runtimeStyle&&!(V&&Z)){var W=z.style.left,ie=z.runtimeStyle.left;return z.runtimeStyle.left=z.currentStyle.left,z.style.left=v||0,v=z.style.pixelLeft,z.style.left=W,z.runtimeStyle.left=ie,v}if(z&&V){O=O||z.parentNode;var oe=e(v),K=null,le=L.include("left")||L.include("right")||L.include("width"),he=L.include("top")||L.include("bottom")||L.include("height");return O===document.viewport?le?K=document.viewport.getWidth():he&&(K=document.viewport.getHeight()):le?K=$(O).measure("width"):he&&(K=$(O).measure("height")),K===null?0:K*oe}return 0}function a(v){return Object.isString(v)&&v.endsWith("px")?v:v+"px"}function s(v){for(;v&&v.parentNode;){var L=v.getStyle("display");if(L==="none")return!1;v=$(v.parentNode)}return!0}var c=Prototype.K;"currentStyle"in document.documentElement&&(c=function(v){return v.currentStyle.hasLayout||(v.style.zoom=1),v});function d(v){return v.include("border")&&(v=v+"-width"),v.camelize()}Element.Layout=Class.create(Hash,{initialize:function(v,L,O){v(),this.element=$(L),Element.Layout.PROPERTIES.each(function(z){this._set(z,null)},this),O&&(this._preComputing=!0,this._begin(),Element.Layout.PROPERTIES.each(this._compute,this),this._end(),this._preComputing=!1)},_set:function(v,L){return Hash.prototype.set.call(this,v,L)},set:function(v,L){throw"Properties of Element.Layout are read-only."},get:function(v,L){var O=v(L);return O===null?this._compute(L):O},_begin:function(){if(!this._isPrepared()){var v=this.element;if(s(v)){this._setPrepared(!0);return}var L={position:v.style.position||"",width:v.style.width||"",visibility:v.style.visibility||"",display:v.style.display||""};v.store("prototype_original_styles",L);var O=t(v,"position"),z=v.offsetWidth;(z===0||z===null)&&(v.style.display="block",z=v.offsetWidth);var V=O==="fixed"?document.viewport:v.parentNode,Z={visibility:"hidden",display:"block"};O!=="fixed"&&(Z.position="absolute"),v.setStyle(Z);var W=v.offsetWidth,ie;if(z&&W===z)ie=r(v,V);else if(O==="absolute"||O==="fixed")ie=r(v,V);else{var oe=v.parentNode,K=$(oe).getLayout();ie=K.get("width")-this.get("margin-left")-this.get("border-left")-this.get("padding-left")-this.get("padding-right")-this.get("border-right")-this.get("margin-right")}v.setStyle({width:ie+"px"}),this._setPrepared(!0)}},_end:function(){var v=this.element,L=v.retrieve("prototype_original_styles");v.store("prototype_original_styles",null),v.setStyle(L),this._setPrepared(!1)},_compute:function(v){var L=Element.Layout.COMPUTATIONS;if(!(v in L))throw"Property not found.";return this._set(v,L[v].call(this,this.element))},_isPrepared:function(){return this.element.retrieve("prototype_element_layout_prepared",!1)},_setPrepared:function(v){return this.element.store("prototype_element_layout_prepared",v)},toObject:function(){var v=$A(arguments),L=v.length===0?Element.Layout.PROPERTIES:v.join(" ").split(" "),O={};return L.each(function(z){if(Element.Layout.PROPERTIES.include(z)){var V=this.get(z);V!=null&&(O[z]=V)}},this),O},toHash:function(){var v=this.toObject.apply(this,arguments);return new Hash(v)},toCSS:function(){var v=$A(arguments),L=v.length===0?Element.Layout.PROPERTIES:v.join(" ").split(" "),O={};return L.each(function(z){if(Element.Layout.PROPERTIES.include(z)&&!Element.Layout.COMPOSITE_PROPERTIES.include(z)){var V=this.get(z);V!=null&&(O[d(z)]=V+"px")}},this),O},inspect:function(){return"#<Element.Layout>"}}),Object.extend(Element.Layout,{PROPERTIES:$w("height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height"),COMPOSITE_PROPERTIES:$w("padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height"),COMPUTATIONS:{height:function(v){this._preComputing||this._begin();var L=this.get("border-box-height");if(L<=0)return this._preComputing||this._end(),0;var O=this.get("border-top"),z=this.get("border-bottom"),V=this.get("padding-top"),Z=this.get("padding-bottom");return this._preComputing||this._end(),L-O-z-V-Z},width:function(v){this._preComputing||this._begin();var L=this.get("border-box-width");if(L<=0)return this._preComputing||this._end(),0;var O=this.get("border-left"),z=this.get("border-right"),V=this.get("padding-left"),Z=this.get("padding-right");return this._preComputing||this._end(),L-O-z-V-Z},"padding-box-height":function(v){var L=this.get("height"),O=this.get("padding-top"),z=this.get("padding-bottom");return L+O+z},"padding-box-width":function(v){var L=this.get("width"),O=this.get("padding-left"),z=this.get("padding-right");return L+O+z},"border-box-height":function(v){this._preComputing||this._begin();var L=v.offsetHeight;return this._preComputing||this._end(),L},"border-box-width":function(v){this._preComputing||this._begin();var L=v.offsetWidth;return this._preComputing||this._end(),L},"margin-box-height":function(v){var L=this.get("border-box-height"),O=this.get("margin-top"),z=this.get("margin-bottom");return L<=0?0:L+O+z},"margin-box-width":function(v){var L=this.get("border-box-width"),O=this.get("margin-left"),z=this.get("margin-right");return L<=0?0:L+O+z},top:function(v){var L=v.positionedOffset();return L.top},bottom:function(v){var L=v.positionedOffset(),O=v.getOffsetParent(),z=O.measure("height"),V=this.get("border-box-height");return z-V-L.top},left:function(v){var L=v.positionedOffset();return L.left},right:function(v){var L=v.positionedOffset(),O=v.getOffsetParent(),z=O.measure("width"),V=this.get("border-box-width");return z-V-L.left},"padding-top":function(v){return o(v,"paddingTop")},"padding-bottom":function(v){return o(v,"paddingBottom")},"padding-left":function(v){return o(v,"paddingLeft")},"padding-right":function(v){return o(v,"paddingRight")},"border-top":function(v){return o(v,"borderTopWidth")},"border-bottom":function(v){return o(v,"borderBottomWidth")},"border-left":function(v){return o(v,"borderLeftWidth")},"border-right":function(v){return o(v,"borderRightWidth")},"margin-top":function(v){return o(v,"marginTop")},"margin-bottom":function(v){return o(v,"marginBottom")},"margin-left":function(v){return o(v,"marginLeft")},"margin-right":function(v){return o(v,"marginRight")}}}),"getBoundingClientRect"in document.documentElement&&Object.extend(Element.Layout.COMPUTATIONS,{right:function(v){var L=c(v.getOffsetParent()),O=v.getBoundingClientRect(),z=L.getBoundingClientRect();return(z.right-O.right).round()},bottom:function(v){var L=c(v.getOffsetParent()),O=v.getBoundingClientRect(),z=L.getBoundingClientRect();return(z.bottom-O.bottom).round()}}),Element.Offset=Class.create({initialize:function(v,L){this.left=v.round(),this.top=L.round(),this[0]=this.left,this[1]=this.top},relativeTo:function(v){return new Element.Offset(this.left-v.left,this.top-v.top)},inspect:function(){return"#<Element.Offset left: #{left} top: #{top}>".interpolate(this)},toString:function(){return"[#{left}, #{top}]".interpolate(this)},toArray:function(){return[this.left,this.top]}});function u(v,L){return new Element.Layout(v,L)}function f(v,L){return $(v).getLayout().get(L)}function g(v){return Element.getDimensions(v).height}function h(v){return Element.getDimensions(v).width}function b(v){v=$(v);var L=Element.getStyle(v,"display");if(L&&L!=="none")return{width:v.offsetWidth,height:v.offsetHeight};var O=v.style,z={visibility:O.visibility,position:O.position,display:O.display},V={visibility:"hidden",display:"block"};z.position!=="fixed"&&(V.position="absolute"),Element.setStyle(v,V);var Z={width:v.offsetWidth,height:v.offsetHeight};return Element.setStyle(v,z),Z}function E(v){if(v=$(v),H(v)||I(v)||R(v)||B(v))return $(document.body);var L=Element.getStyle(v,"display")==="inline";if(!L&&v.offsetParent)return $(v.offsetParent);for(;(v=v.parentNode)&&v!==document.body;)if(Element.getStyle(v,"position")!=="static")return B(v)?$(document.body):$(v);return $(document.body)}function S(v){v=$(v);var L=0,O=0;if(v.parentNode)do L+=v.offsetTop||0,O+=v.offsetLeft||0,v=v.offsetParent;while(v);return new Element.Offset(O,L)}function D(v){v=$(v);var L=v.getLayout(),O=0,z=0;do if(O+=v.offsetTop||0,z+=v.offsetLeft||0,v=v.offsetParent,v){if(R(v))break;var V=Element.getStyle(v,"position");if(V!=="static")break}while(v);return z-=L.get("margin-top"),O-=L.get("margin-left"),new Element.Offset(z,O)}function j(v){var L=0,O=0;do L+=v.scrollTop||0,O+=v.scrollLeft||0,v=v.parentNode;while(v);return new Element.Offset(O,L)}function p(v){var L=0,O=0,z=document.body,V=$(v);do if(L+=V.offsetTop||0,O+=V.offsetLeft||0,V.offsetParent==z&&Element.getStyle(V,"position")=="absolute")break;while(V=V.offsetParent);V=v;do V!=z&&(L-=V.scrollTop||0,O-=V.scrollLeft||0);while(V=V.parentNode);return new Element.Offset(O,L)}function C(v){if(v=$(v),Element.getStyle(v,"position")==="absolute")return v;var L=E(v),O=v.viewportOffset(),z=L.viewportOffset(),V=O.relativeTo(z),Z=v.getLayout();return v.store("prototype_absolutize_original_styles",{left:v.getStyle("left"),top:v.getStyle("top"),width:v.getStyle("width"),height:v.getStyle("height")}),v.setStyle({position:"absolute",top:V.top+"px",left:V.left+"px",width:Z.get("width")+"px",height:Z.get("height")+"px"}),v}function M(v){if(v=$(v),Element.getStyle(v,"position")==="relative")return v;var L=v.retrieve("prototype_absolutize_original_styles");return L&&v.setStyle(L),v}function _(v){v=$(v);var L=Element.cumulativeOffset(v);return window.scrollTo(L.left,L.top),v}function T(v){v=$(v);var L=Element.getStyle(v,"position"),O={};return(L==="static"||!L)&&(O.position="relative",Prototype.Browser.Opera&&(O.top=0,O.left=0),Element.setStyle(v,O),Element.store(v,"prototype_made_positioned",!0)),v}function P(v){v=$(v);var L=Element.getStorage(v),O=L.get("prototype_made_positioned");return O&&(L.unset("prototype_made_positioned"),Element.setStyle(v,{position:"",top:"",bottom:"",left:"",right:""})),v}function k(v){v=$(v);var L=Element.getStorage(v),O=L.get("prototype_made_clipping");if(Object.isUndefined(O)){var z=Element.getStyle(v,"overflow");L.set("prototype_made_clipping",z),z!=="hidden"&&(v.style.overflow="hidden")}return v}function U(v){v=$(v);var L=Element.getStorage(v),O=L.get("prototype_made_clipping");return Object.isUndefined(O)||(L.unset("prototype_made_clipping"),v.style.overflow=O||""),v}function N(v,L,O){O=Object.extend({setLeft:!0,setTop:!0,setWidth:!0,setHeight:!0,offsetTop:0,offsetLeft:0},O||{}),L=$(L),v=$(v);var z,V,Z,W={};if((O.setLeft||O.setTop)&&(z=Element.viewportOffset(L),V=[0,0],Element.getStyle(v,"position")==="absolute")){var ie=Element.getOffsetParent(v);ie!==document.body&&(V=Element.viewportOffset(ie))}return(O.setWidth||O.setHeight)&&(Z=Element.getLayout(L)),O.setLeft&&(W.left=z[0]-V[0]+O.offsetLeft+"px"),O.setTop&&(W.top=z[1]-V[1]+O.offsetTop+"px"),O.setWidth&&(W.width=Z.get("border-box-width")+"px"),O.setHeight&&(W.height=Z.get("border-box-height")+"px"),Element.setStyle(v,W)}Prototype.Browser.IE?(E=E.wrap(function(v,L){if(L=$(L),H(L)||I(L)||R(L)||B(L))return $(document.body);var O=L.getStyle("position");if(O!=="static")return v(L);L.setStyle({position:"relative"});var z=v(L);return L.setStyle({position:O}),z}),D=D.wrap(function(v,L){if(L=$(L),!L.parentNode)return new Element.Offset(0,0);var O=L.getStyle("position");if(O!=="static")return v(L);var z=L.getOffsetParent();z&&z.getStyle("position")==="fixed"&&c(z),L.setStyle({position:"relative"});var V=v(L);return L.setStyle({position:O}),V})):Prototype.Browser.Webkit&&(S=function(v){v=$(v);var L=0,O=0;do{if(L+=v.offsetTop||0,O+=v.offsetLeft||0,v.offsetParent==document.body&&Element.getStyle(v,"position")=="absolute")break;v=v.offsetParent}while(v);return new Element.Offset(O,L)}),Element.addMethods({getLayout:u,measure:f,getWidth:h,getHeight:g,getDimensions:b,getOffsetParent:E,cumulativeOffset:S,positionedOffset:D,cumulativeScrollOffset:j,viewportOffset:p,absolutize:C,relativize:M,scrollTo:_,makePositioned:T,undoPositioned:P,makeClipping:k,undoClipping:U,clonePosition:N});function R(v){return v.nodeName.toUpperCase()==="BODY"}function B(v){return v.nodeName.toUpperCase()==="HTML"}function H(v){return v.nodeType===Node.DOCUMENT_NODE}function I(v){return v!==document.body&&!Element.descendantOf(v,document.body)}"getBoundingClientRect"in document.documentElement&&Element.addMethods({viewportOffset:function(v){if(v=$(v),I(v))return new Element.Offset(0,0);var L=v.getBoundingClientRect(),O=document.documentElement;return new Element.Offset(L.left-O.clientLeft,L.top-O.clientTop)}})})(),(function(){var e=Prototype.Browser.Opera&&window.parseFloat(window.opera.version())<9.5,t=null;function n(){return t||(t=e?document.body:document.documentElement,t)}function r(){return{width:this.getWidth(),height:this.getHeight()}}function o(){return n().clientWidth}function a(){return n().clientHeight}function s(){var c=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,d=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;return new Element.Offset(c,d)}document.viewport={getDimensions:r,getWidth:o,getHeight:a,getScrollOffsets:s}})(),window.$$=function(){var e=$A(arguments).join(", ");return Prototype.Selector.select(e,document)},Prototype.Selector=(function(){function e(){throw new Error('Method "Prototype.Selector.select" must be defined.')}function t(){throw new Error('Method "Prototype.Selector.match" must be defined.')}function n(a,s,c){c=c||0;var d=Prototype.Selector.match,u=a.length,f=0,g;for(g=0;g<u;g++)if(d(a[g],s)&&c==f++)return Element.extend(a[g])}function r(a){for(var s=0,c=a.length;s<c;s++)Element.extend(a[s]);return a}var o=Prototype.K;return{select:e,match:t,find:n,extendElements:Element.extend===o?o:r,extendElement:Element.extend}})();/*!
 * Sizzle CSS Selector Engine
 *  Copyright 2011, The Dojo Foundation
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://sizzlejs.com/
 */(function(){var e=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,t=0,n=Object.prototype.toString,r=!1,o=!0,a=/\\/g,s=/\W/;[0,0].sort(function(){return o=!1,0});var c=function(p,C,M,_){M=M||[],C=C||document;var T=C;if(C.nodeType!==1&&C.nodeType!==9)return[];if(!p||typeof p!="string")return M;var P,k,U,N,R,B,H,I,v=!0,L=c.isXML(C),O=[],z=p;do if(e.exec(""),P=e.exec(z),P&&(z=P[3],O.push(P[1]),P[2])){N=P[3];break}while(P);if(O.length>1&&u.exec(p))if(O.length===2&&d.relative[O[0]])k=j(O[0]+O[1],C);else for(k=d.relative[O[0]]?[C]:c(O.shift(),C);O.length;)p=O.shift(),d.relative[p]&&(p+=O.shift()),k=j(p,k);else if(!_&&O.length>1&&C.nodeType===9&&!L&&d.match.ID.test(O[0])&&!d.match.ID.test(O[O.length-1])&&(R=c.find(O.shift(),C,L),C=R.expr?c.filter(R.expr,R.set)[0]:R.set[0]),C)for(R=_?{expr:O.pop(),set:h(_)}:c.find(O.pop(),O.length===1&&(O[0]==="~"||O[0]==="+")&&C.parentNode?C.parentNode:C,L),k=R.expr?c.filter(R.expr,R.set):R.set,O.length>0?U=h(k):v=!1;O.length;)B=O.pop(),H=B,d.relative[B]?H=O.pop():B="",H==null&&(H=C),d.relative[B](U,H,L);else U=O=[];if(U||(U=k),U||c.error(B||p),n.call(U)==="[object Array]")if(!v)M.push.apply(M,U);else if(C&&C.nodeType===1)for(I=0;U[I]!=null;I++)U[I]&&(U[I]===!0||U[I].nodeType===1&&c.contains(C,U[I]))&&M.push(k[I]);else for(I=0;U[I]!=null;I++)U[I]&&U[I].nodeType===1&&M.push(k[I]);else h(U,M);return N&&(c(N,T,M,_),c.uniqueSort(M)),M};c.uniqueSort=function(p){if(b&&(r=o,p.sort(b),r))for(var C=1;C<p.length;C++)p[C]===p[C-1]&&p.splice(C--,1);return p},c.matches=function(p,C){return c(p,null,null,C)},c.matchesSelector=function(p,C){return c(C,null,null,[p]).length>0},c.find=function(p,C,M){var _;if(!p)return[];for(var T=0,P=d.order.length;T<P;T++){var k,U=d.order[T];if(k=d.leftMatch[U].exec(p)){var N=k[1];if(k.splice(1,1),N.substr(N.length-1)!=="\\"&&(k[1]=(k[1]||"").replace(a,""),_=d.find[U](k,C,M),_!=null)){p=p.replace(d.match[U],"");break}}}return _||(_=typeof C.getElementsByTagName<"u"?C.getElementsByTagName("*"):[]),{set:_,expr:p}},c.filter=function(p,C,M,_){for(var T,P,k=p,U=[],N=C,R=C&&C[0]&&c.isXML(C[0]);p&&C.length;){for(var B in d.filter)if((T=d.leftMatch[B].exec(p))!=null&&T[2]){var H,I,v=d.filter[B],L=T[1];if(P=!1,T.splice(1,1),L.substr(L.length-1)==="\\")continue;if(N===U&&(U=[]),d.preFilter[B]){if(T=d.preFilter[B](T,N,M,U,_,R),!T)P=H=!0;else if(T===!0)continue}if(T){for(var O=0;(I=N[O])!=null;O++)if(I){H=v(I,T,O,N);var z=_^!!H;M&&H!=null?z?P=!0:N[O]=!1:z&&(U.push(I),P=!0)}}if(H!==void 0){if(M||(N=U),p=p.replace(d.match[B],""),!P)return[];break}}if(p===k)if(P==null)c.error(p);else break;k=p}return N},c.error=function(p){throw"Syntax error, unrecognized expression: "+p};var d=c.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{class:"className",for:"htmlFor"},attrHandle:{href:function(p){return p.getAttribute("href")},type:function(p){return p.getAttribute("type")}},relative:{"+":function(p,C){var M=typeof C=="string",_=M&&!s.test(C),T=M&&!_;_&&(C=C.toLowerCase());for(var P=0,k=p.length,U;P<k;P++)if(U=p[P]){for(;(U=U.previousSibling)&&U.nodeType!==1;);p[P]=T||U&&U.nodeName.toLowerCase()===C?U||!1:U===C}T&&c.filter(C,p,!0)},">":function(p,C){var M,_=typeof C=="string",T=0,P=p.length;if(_&&!s.test(C)){for(C=C.toLowerCase();T<P;T++)if(M=p[T],M){var k=M.parentNode;p[T]=k.nodeName.toLowerCase()===C?k:!1}}else{for(;T<P;T++)M=p[T],M&&(p[T]=_?M.parentNode:M.parentNode===C);_&&c.filter(C,p,!0)}},"":function(p,C,M){var _,T=t++,P=D;typeof C=="string"&&!s.test(C)&&(C=C.toLowerCase(),_=C,P=S),P("parentNode",C,T,p,_,M)},"~":function(p,C,M){var _,T=t++,P=D;typeof C=="string"&&!s.test(C)&&(C=C.toLowerCase(),_=C,P=S),P("previousSibling",C,T,p,_,M)}},find:{ID:function(p,C,M){if(typeof C.getElementById<"u"&&!M){var _=C.getElementById(p[1]);return _&&_.parentNode?[_]:[]}},NAME:function(p,C){if(typeof C.getElementsByName<"u"){for(var M=[],_=C.getElementsByName(p[1]),T=0,P=_.length;T<P;T++)_[T].getAttribute("name")===p[1]&&M.push(_[T]);return M.length===0?null:M}},TAG:function(p,C){if(typeof C.getElementsByTagName<"u")return C.getElementsByTagName(p[1])}},preFilter:{CLASS:function(p,C,M,_,T,P){if(p=" "+p[1].replace(a,"")+" ",P)return p;for(var k=0,U;(U=C[k])!=null;k++)U&&(T^(U.className&&(" "+U.className+" ").replace(/[\t\n\r]/g," ").indexOf(p)>=0)?M||_.push(U):M&&(C[k]=!1));return!1},ID:function(p){return p[1].replace(a,"")},TAG:function(p,C){return p[1].replace(a,"").toLowerCase()},CHILD:function(p){if(p[1]==="nth"){p[2]||c.error(p[0]),p[2]=p[2].replace(/^\+|\s*/g,"");var C=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(p[2]==="even"&&"2n"||p[2]==="odd"&&"2n+1"||!/\D/.test(p[2])&&"0n+"+p[2]||p[2]);p[2]=C[1]+(C[2]||1)-0,p[3]=C[3]-0}else p[2]&&c.error(p[0]);return p[0]=t++,p},ATTR:function(p,C,M,_,T,P){var k=p[1]=p[1].replace(a,"");return!P&&d.attrMap[k]&&(p[1]=d.attrMap[k]),p[4]=(p[4]||p[5]||"").replace(a,""),p[2]==="~="&&(p[4]=" "+p[4]+" "),p},PSEUDO:function(p,C,M,_,T){if(p[1]==="not")if((e.exec(p[3])||"").length>1||/^\w/.test(p[3]))p[3]=c(p[3],null,null,C);else{var P=c.filter(p[3],C,M,!0^T);return M||_.push.apply(_,P),!1}else if(d.match.POS.test(p[0])||d.match.CHILD.test(p[0]))return!0;return p},POS:function(p){return p.unshift(!0),p}},filters:{enabled:function(p){return p.disabled===!1&&p.type!=="hidden"},disabled:function(p){return p.disabled===!0},checked:function(p){return p.checked===!0},selected:function(p){return p.parentNode&&p.parentNode.selectedIndex,p.selected===!0},parent:function(p){return!!p.firstChild},empty:function(p){return!p.firstChild},has:function(p,C,M){return!!c(M[3],p).length},header:function(p){return/h\d/i.test(p.nodeName)},text:function(p){var C=p.getAttribute("type"),M=p.type;return p.nodeName.toLowerCase()==="input"&&M==="text"&&(C===M||C===null)},radio:function(p){return p.nodeName.toLowerCase()==="input"&&p.type==="radio"},checkbox:function(p){return p.nodeName.toLowerCase()==="input"&&p.type==="checkbox"},file:function(p){return p.nodeName.toLowerCase()==="input"&&p.type==="file"},password:function(p){return p.nodeName.toLowerCase()==="input"&&p.type==="password"},submit:function(p){var C=p.nodeName.toLowerCase();return(C==="input"||C==="button")&&p.type==="submit"},image:function(p){return p.nodeName.toLowerCase()==="input"&&p.type==="image"},reset:function(p){var C=p.nodeName.toLowerCase();return(C==="input"||C==="button")&&p.type==="reset"},button:function(p){var C=p.nodeName.toLowerCase();return C==="input"&&p.type==="button"||C==="button"},input:function(p){return/input|select|textarea|button/i.test(p.nodeName)},focus:function(p){return p===p.ownerDocument.activeElement}},setFilters:{first:function(p,C){return C===0},last:function(p,C,M,_){return C===_.length-1},even:function(p,C){return C%2===0},odd:function(p,C){return C%2===1},lt:function(p,C,M){return C<M[3]-0},gt:function(p,C,M){return C>M[3]-0},nth:function(p,C,M){return M[3]-0===C},eq:function(p,C,M){return M[3]-0===C}},filter:{PSEUDO:function(p,C,M,_){var T=C[1],P=d.filters[T];if(P)return P(p,M,C,_);if(T==="contains")return(p.textContent||p.innerText||c.getText([p])||"").indexOf(C[3])>=0;if(T==="not"){for(var k=C[3],U=0,N=k.length;U<N;U++)if(k[U]===p)return!1;return!0}else c.error(T)},CHILD:function(p,C){var M=C[1],_=p;switch(M){case"only":case"first":for(;_=_.previousSibling;)if(_.nodeType===1)return!1;if(M==="first")return!0;_=p;case"last":for(;_=_.nextSibling;)if(_.nodeType===1)return!1;return!0;case"nth":var T=C[2],P=C[3];if(T===1&&P===0)return!0;var k=C[0],U=p.parentNode;if(U&&(U.sizcache!==k||!p.nodeIndex)){var N=0;for(_=U.firstChild;_;_=_.nextSibling)_.nodeType===1&&(_.nodeIndex=++N);U.sizcache=k}var R=p.nodeIndex-P;return T===0?R===0:R%T===0&&R/T>=0}},ID:function(p,C){return p.nodeType===1&&p.getAttribute("id")===C},TAG:function(p,C){return C==="*"&&p.nodeType===1||p.nodeName.toLowerCase()===C},CLASS:function(p,C){return(" "+(p.className||p.getAttribute("class"))+" ").indexOf(C)>-1},ATTR:function(p,C){var M=C[1],_=d.attrHandle[M]?d.attrHandle[M](p):p[M]!=null?p[M]:p.getAttribute(M),T=_+"",P=C[2],k=C[4];return _==null?P==="!=":P==="="?T===k:P==="*="?T.indexOf(k)>=0:P==="~="?(" "+T+" ").indexOf(k)>=0:k?P==="!="?T!==k:P==="^="?T.indexOf(k)===0:P==="$="?T.substr(T.length-k.length)===k:P==="|="?T===k||T.substr(0,k.length+1)===k+"-":!1:T&&_!==!1},POS:function(p,C,M,_){var T=C[2],P=d.setFilters[T];if(P)return P(p,M,C,_)}}},u=d.match.POS,f=function(p,C){return"\\"+(C-0+1)};for(var g in d.match)d.match[g]=new RegExp(d.match[g].source+/(?![^\[]*\])(?![^\(]*\))/.source),d.leftMatch[g]=new RegExp(/(^(?:.|\r|\n)*?)/.source+d.match[g].source.replace(/\\(\d+)/g,f));var h=function(p,C){return p=Array.prototype.slice.call(p,0),C?(C.push.apply(C,p),C):p};try{Array.prototype.slice.call(document.documentElement.childNodes,0)[0].nodeType}catch{h=function(C,M){var _=0,T=M||[];if(n.call(C)==="[object Array]")Array.prototype.push.apply(T,C);else if(typeof C.length=="number")for(var P=C.length;_<P;_++)T.push(C[_]);else for(;C[_];_++)T.push(C[_]);return T}}var b,E;document.documentElement.compareDocumentPosition?b=function(p,C){return p===C?(r=!0,0):!p.compareDocumentPosition||!C.compareDocumentPosition?p.compareDocumentPosition?-1:1:p.compareDocumentPosition(C)&4?-1:1}:(b=function(p,C){if(p===C)return r=!0,0;if(p.sourceIndex&&C.sourceIndex)return p.sourceIndex-C.sourceIndex;var M,_,T=[],P=[],k=p.parentNode,U=C.parentNode,N=k;if(k===U)return E(p,C);if(k){if(!U)return 1}else return-1;for(;N;)T.unshift(N),N=N.parentNode;for(N=U;N;)P.unshift(N),N=N.parentNode;M=T.length,_=P.length;for(var R=0;R<M&&R<_;R++)if(T[R]!==P[R])return E(T[R],P[R]);return R===M?E(p,P[R],-1):E(T[R],C,1)},E=function(p,C,M){if(p===C)return M;for(var _=p.nextSibling;_;){if(_===C)return-1;_=_.nextSibling}return 1}),c.getText=function(p){for(var C="",M,_=0;p[_];_++)M=p[_],M.nodeType===3||M.nodeType===4?C+=M.nodeValue:M.nodeType!==8&&(C+=c.getText(M.childNodes));return C},(function(){var p=document.createElement("div"),C="script"+new Date().getTime(),M=document.documentElement;p.innerHTML="<a name='"+C+"'/>",M.insertBefore(p,M.firstChild),document.getElementById(C)&&(d.find.ID=function(_,T,P){if(typeof T.getElementById<"u"&&!P){var k=T.getElementById(_[1]);return k?k.id===_[1]||typeof k.getAttributeNode<"u"&&k.getAttributeNode("id").nodeValue===_[1]?[k]:void 0:[]}},d.filter.ID=function(_,T){var P=typeof _.getAttributeNode<"u"&&_.getAttributeNode("id");return _.nodeType===1&&P&&P.nodeValue===T}),M.removeChild(p),M=p=null})(),(function(){var p=document.createElement("div");p.appendChild(document.createComment("")),p.getElementsByTagName("*").length>0&&(d.find.TAG=function(C,M){var _=M.getElementsByTagName(C[1]);if(C[1]==="*"){for(var T=[],P=0;_[P];P++)_[P].nodeType===1&&T.push(_[P]);_=T}return _}),p.innerHTML="<a href='#'></a>",p.firstChild&&typeof p.firstChild.getAttribute<"u"&&p.firstChild.getAttribute("href")!=="#"&&(d.attrHandle.href=function(C){return C.getAttribute("href",2)}),p=null})(),document.querySelectorAll&&(function(){var p=c,C=document.createElement("div"),M="__sizzle__";if(C.innerHTML="<p class='TEST'></p>",!(C.querySelectorAll&&C.querySelectorAll(".TEST").length===0)){c=function(T,P,k,U){if(P=P||document,!U&&!c.isXML(P)){var N=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(T);if(N&&(P.nodeType===1||P.nodeType===9)){if(N[1])return h(P.getElementsByTagName(T),k);if(N[2]&&d.find.CLASS&&P.getElementsByClassName)return h(P.getElementsByClassName(N[2]),k)}if(P.nodeType===9){if(T==="body"&&P.body)return h([P.body],k);if(N&&N[3]){var R=P.getElementById(N[3]);if(R&&R.parentNode){if(R.id===N[3])return h([R],k)}else return h([],k)}try{return h(P.querySelectorAll(T),k)}catch{}}else if(P.nodeType===1&&P.nodeName.toLowerCase()!=="object"){var B=P,H=P.getAttribute("id"),I=H||M,v=P.parentNode,L=/^\s*[+~]/.test(T);H?I=I.replace(/'/g,"\\$&"):P.setAttribute("id",I),L&&v&&(P=P.parentNode);try{if(!L||v)return h(P.querySelectorAll("[id='"+I+"'] "+T),k)}catch{}finally{H||B.removeAttribute("id")}}}return p(T,P,k,U)};for(var _ in p)c[_]=p[_];C=null}})(),(function(){var p=document.documentElement,C=p.matchesSelector||p.mozMatchesSelector||p.webkitMatchesSelector||p.msMatchesSelector;if(C){var M=!C.call(document.createElement("div"),"div"),_=!1;try{C.call(document.documentElement,"[test!='']:sizzle")}catch{_=!0}c.matchesSelector=function(T,P){if(P=P.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']"),!c.isXML(T))try{if(_||!d.match.PSEUDO.test(P)&&!/!=/.test(P)){var k=C.call(T,P);if(k||!M||T.document&&T.document.nodeType!==11)return k}}catch{}return c(P,null,null,[T]).length>0}}})(),(function(){var p=document.createElement("div");p.innerHTML="<div class='test e'></div><div class='test'></div>",!(!p.getElementsByClassName||p.getElementsByClassName("e").length===0)&&(p.lastChild.className="e",p.getElementsByClassName("e").length!==1&&(d.order.splice(1,0,"CLASS"),d.find.CLASS=function(C,M,_){if(typeof M.getElementsByClassName<"u"&&!_)return M.getElementsByClassName(C[1])},p=null))})();function S(p,C,M,_,T,P){for(var k=0,U=_.length;k<U;k++){var N=_[k];if(N){var R=!1;for(N=N[p];N;){if(N.sizcache===M){R=_[N.sizset];break}if(N.nodeType===1&&!P&&(N.sizcache=M,N.sizset=k),N.nodeName.toLowerCase()===C){R=N;break}N=N[p]}_[k]=R}}}function D(p,C,M,_,T,P){for(var k=0,U=_.length;k<U;k++){var N=_[k];if(N){var R=!1;for(N=N[p];N;){if(N.sizcache===M){R=_[N.sizset];break}if(N.nodeType===1){if(P||(N.sizcache=M,N.sizset=k),typeof C!="string"){if(N===C){R=!0;break}}else if(c.filter(C,[N]).length>0){R=N;break}}N=N[p]}_[k]=R}}}document.documentElement.contains?c.contains=function(p,C){return p!==C&&(p.contains?p.contains(C):!0)}:document.documentElement.compareDocumentPosition?c.contains=function(p,C){return!!(p.compareDocumentPosition(C)&16)}:c.contains=function(){return!1},c.isXML=function(p){var C=(p?p.ownerDocument||p:0).documentElement;return C?C.nodeName!=="HTML":!1};var j=function(p,C){for(var M,_=[],T="",P=C.nodeType?[C]:C;M=d.match.PSEUDO.exec(p);)T+=M[0],p=p.replace(d.match.PSEUDO,"");p=d.relative[p]?p+"*":p;for(var k=0,U=P.length;k<U;k++)c(p,P[k],_);return c.filter(T,_)};window.Sizzle=c})(),Prototype._original_property=window.Sizzle,(function(e){var t=Prototype.Selector.extendElements;function n(o,a){return t(e(o,a||document))}function r(o,a){return e.matches(a,[o]).length==1}Prototype.Selector.engine=e,Prototype.Selector.select=n,Prototype.Selector.match=r})(Sizzle),window.Sizzle=Prototype._original_property,delete Prototype._original_property;var Form={reset:function(e){return e=$(e),e.reset(),e},serializeElements:function(e,t){typeof t!="object"?t={hash:!!t}:Object.isUndefined(t.hash)&&(t.hash=!0);var n,r,o=!1,a=t.submit,s,c;return t.hash?(c={},s=function(d,u,f){return u in d?(Object.isArray(d[u])||(d[u]=[d[u]]),d[u].push(f)):d[u]=f,d}):(c="",s=function(d,u,f){return f=f.gsub(/(\r)?\n/,`\r
`),f=encodeURIComponent(f),f=f.gsub(/%20/,"+"),d+(d?"&":"")+encodeURIComponent(u)+"="+f}),e.inject(c,function(d,u){return!u.disabled&&u.name&&(n=u.name,r=$(u).getValue(),r!=null&&u.type!="file"&&(u.type!="submit"||!o&&a!==!1&&(!a||n==a)&&(o=!0))&&(d=s(d,n,r))),d})}};Form.Methods={serialize:function(e,t){return Form.serializeElements(Form.getElements(e),t)},getElements:function(e){for(var t=$(e).getElementsByTagName("*"),n,r=[],o=Form.Element.Serializers,a=0;n=t[a];a++)o[n.tagName.toLowerCase()]&&r.push(Element.extend(n));return r},getInputs:function(e,t,n){e=$(e);var r=e.getElementsByTagName("input");if(!t&&!n)return $A(r).map(Element.extend);for(var o=0,a=[],s=r.length;o<s;o++){var c=r[o];t&&c.type!=t||n&&c.name!=n||a.push(Element.extend(c))}return a},disable:function(e){return e=$(e),Form.getElements(e).invoke("disable"),e},enable:function(e){return e=$(e),Form.getElements(e).invoke("enable"),e},findFirstElement:function(e){var t=$(e).getElements().findAll(function(r){return r.type!="hidden"&&!r.disabled}),n=t.findAll(function(r){return r.hasAttribute("tabIndex")&&r.tabIndex>=0}).sortBy(function(r){return r.tabIndex}).first();return n||t.find(function(r){return/^(?:input|select|textarea)$/i.test(r.tagName)})},focusFirstElement:function(e){e=$(e);var t=e.findFirstElement();return t&&t.activate(),e},request:function(e,t){e=$(e),t=Object.clone(t||{});var n=t.parameters,r=e.readAttribute("action")||"";return r.blank()&&(r=window.location.href),t.parameters=e.serialize(!0),n&&(Object.isString(n)&&(n=n.toQueryParams()),Object.extend(t.parameters,n)),e.hasAttribute("method")&&!t.method&&(t.method=e.method),new Ajax.Request(r,t)}},Form.Element={focus:function(e){return $(e).focus(),e},select:function(e){return $(e).select(),e}},Form.Element.Methods={serialize:function(e){if(e=$(e),!e.disabled&&e.name){var t=e.getValue();if(t!=null){var n={};return n[e.name]=t,Object.toQueryString(n)}}return""},getValue:function(e){e=$(e);var t=e.tagName.toLowerCase();return Form.Element.Serializers[t](e)},setValue:function(e,t){e=$(e);var n=e.tagName.toLowerCase();return Form.Element.Serializers[n](e,t),e},clear:function(e){return $(e).value="",e},present:function(e){return $(e).value!=""},activate:function(e){e=$(e);try{e.focus(),e.select&&(e.tagName.toLowerCase()!="input"||!/^(?:button|reset|submit)$/i.test(e.type))&&e.select()}catch{}return e},disable:function(e){return e=$(e),e.disabled=!0,e},enable:function(e){return e=$(e),e.disabled=!1,e}};var Field=Form.Element,$F=Form.Element.Methods.getValue;Form.Element.Serializers=(function(){function e(c,d){switch(c.type.toLowerCase()){case"checkbox":case"radio":return t(c,d);default:return n(c,d)}}function t(c,d){if(Object.isUndefined(d))return c.checked?c.value:null;c.checked=!!d}function n(c,d){if(Object.isUndefined(d))return c.value;c.value=d}function r(c,d){if(Object.isUndefined(d))return(c.type==="select-one"?o:a)(c);for(var u,f,g=!Object.isArray(d),h=0,b=c.length;h<b;h++)if(u=c.options[h],f=this.optionValue(u),g){if(f==d){u.selected=!0;return}}else u.selected=d.include(f)}function o(c){var d=c.selectedIndex;return d>=0?s(c.options[d]):null}function a(c){var d,u=c.length;if(!u)return null;for(var f=0,d=[];f<u;f++){var g=c.options[f];g.selected&&d.push(s(g))}return d}function s(c){return Element.hasAttribute(c,"value")?c.value:c.text}return{input:e,inputSelector:t,textarea:n,select:r,selectOne:o,selectMany:a,optionValue:s,button:n}})(),Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function(e,t,n,r){e(r,n),this.element=$(t),this.lastValue=this.getValue()},execute:function(){var e=this.getValue();(Object.isString(this.lastValue)&&Object.isString(e)?this.lastValue!=e:String(this.lastValue)!=String(e))&&(this.callback(this.element,e),this.lastValue=e)}}),Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}}),Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}}),Abstract.EventObserver=Class.create({initialize:function(e,t){this.element=$(e),this.callback=t,this.lastValue=this.getValue(),this.element.tagName.toLowerCase()=="form"?this.registerFormCallbacks():this.registerCallback(this.element)},onElementEvent:function(){var e=this.getValue();this.lastValue!=e&&(this.callback(this.element,e),this.lastValue=e)},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(e){if(e.type)switch(e.type.toLowerCase()){case"checkbox":case"radio":Event.observe(e,"click",this.onElementEvent.bind(this));break;default:Event.observe(e,"change",this.onElementEvent.bind(this));break}}}),Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}}),Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}}),(function(e){var t=document.createElement("div"),n=document.documentElement,r="onmouseenter"in n&&"onmouseleave"in n,o={KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45},a=function(F){return!1};window.attachEvent&&(window.addEventListener?a=function(F){return!(F instanceof window.Event)}:a=function(F){return!0});var s;function c(F,G){return F.which?F.which===G+1:F.button===G}var d={0:1,1:4,2:2};function u(F,G){return F.button===d[G]}function f(F,G){switch(G){case 0:return F.which==1&&!F.metaKey;case 1:return F.which==2||F.which==1&&F.metaKey;case 2:return F.which==3;default:return!1}}window.attachEvent?window.addEventListener?s=function(F,G){return a(F)?u(F,G):c(F,G)}:s=u:Prototype.Browser.WebKit?s=f:s=c;function g(F){return s(F,0)}function h(F){return s(F,1)}function b(F){return s(F,2)}function E(F){return Element.extend(S(F))}function S(F){F=o.extend(F);var G=F.target,Y=F.type,ee=F.currentTarget;return ee&&ee.tagName&&(Y==="load"||Y==="error"||Y==="click"&&ee.tagName.toLowerCase()==="input"&&ee.type==="radio")&&(G=ee),G.nodeType==Node.TEXT_NODE&&(G=G.parentNode),Element.extend(G)}function D(F,G){var Y=S(F),ee=Prototype.Selector.match;if(!G)return Element.extend(Y);for(;Y;){if(Object.isElement(Y)&&ee(Y,G))return Element.extend(Y);Y=Y.parentNode}}function j(F){return{x:p(F),y:C(F)}}function p(F){var G=document.documentElement,Y=document.body||{scrollLeft:0};return F.pageX||F.clientX+(G.scrollLeft||Y.scrollLeft)-(G.clientLeft||0)}function C(F){var G=document.documentElement,Y=document.body||{scrollTop:0};return F.pageY||F.clientY+(G.scrollTop||Y.scrollTop)-(G.clientTop||0)}function M(F){o.extend(F),F.preventDefault(),F.stopPropagation(),F.stopped=!0}o.Methods={isLeftClick:g,isMiddleClick:h,isRightClick:b,element:E,findElement:D,pointer:j,pointerX:p,pointerY:C,stop:M};var _=Object.keys(o.Methods).inject({},function(F,G){return F[G]=o.Methods[G].methodize(),F});if(window.attachEvent){let F=function(G){var Y;switch(G.type){case"mouseover":case"mouseenter":Y=G.fromElement;break;case"mouseout":case"mouseleave":Y=G.toElement;break;default:return null}return Element.extend(Y)};var ne=F,T={stopPropagation:function(){this.cancelBubble=!0},preventDefault:function(){this.returnValue=!1},inspect:function(){return"[object Event]"}};o.extend=function(G,Y){if(!G)return!1;if(!a(G)||G._extendedByPrototype)return G;G._extendedByPrototype=Prototype.emptyFunction;var ee=o.pointer(G);return Object.extend(G,{target:G.srcElement||Y,relatedTarget:F(G),pageX:ee.x,pageY:ee.y}),Object.extend(G,_),Object.extend(G,T),G}}else o.extend=Prototype.K;window.addEventListener&&(o.prototype=window.Event.prototype||document.createEvent("HTMLEvents").__proto__,Object.extend(o.prototype,_));var P={mouseenter:"mouseover",mouseleave:"mouseout"};function k(F){return P[F]||F}r&&(k=Prototype.K);function U(F){return F===window?0:(typeof F._prototypeUID>"u"&&(F._prototypeUID=Element.Storage.UID++),F._prototypeUID)}function N(F){return F===window?0:F==document?1:F.uniqueID}"uniqueID"in t&&(U=N);function R(F){return F.include(":")}o._isCustomEvent=R;function B(F,G){var Y=e.Event.cache;return Object.isUndefined(G)&&(G=U(F)),Y[G]||(Y[G]={element:F}),Y[G]}function H(F,G){Object.isUndefined(G)&&(G=U(F)),delete e.Event.cache[G]}function I(F,G,Y){var ee=B(F);ee[G]||(ee[G]=[]);for(var q=ee[G],X=q.length;X--;)if(q[X].handler===Y)return null;var re=U(F),te=e.Event._createResponder(re,G,Y),ue={responder:te,handler:Y};return q.push(ue),ue}function v(F,G,Y){var ee=B(F),q=ee[G];if(q){for(var X=q.length,re;X--;)if(q[X].handler===Y){re=q[X];break}if(re){var te=q.indexOf(re);return q.splice(te,1),re}}}function L(F,G,Y){F=$(F);var ee=I(F,G,Y);if(ee===null)return F;var q=ee.responder;return R(G)?z(F,G,q):O(F,G,q),F}function O(F,G,Y){var ee=k(G);F.addEventListener?F.addEventListener(ee,Y,!1):F.attachEvent("on"+ee,Y)}function z(F,G,Y){F.addEventListener?F.addEventListener("dataavailable",Y,!1):(F.attachEvent("ondataavailable",Y),F.attachEvent("onlosecapture",Y))}function V(F,G,Y){F=$(F);var ee=!Object.isUndefined(Y),q=!Object.isUndefined(G);if(!q&&!ee)return ie(F),F;if(!ee)return oe(F,G),F;var X=v(F,G,Y);return X&&K(F,G,X.responder),F}function Z(F,G,Y){var ee=k(G);F.removeEventListener?F.removeEventListener(ee,Y,!1):F.detachEvent("on"+ee,Y)}function W(F,G,Y){F.removeEventListener?F.removeEventListener("dataavailable",Y,!1):(F.detachEvent("ondataavailable",Y),F.detachEvent("onlosecapture",Y))}function ie(F){var G=U(F),Y=B(F,G);H(F,G);var ee,q;for(var X in Y)if(X!=="element")for(ee=Y[X],q=ee.length;q--;)K(F,X,ee[q].responder)}function oe(F,G){var Y=B(F),ee=Y[G];if(ee){delete Y[G];for(var q=ee.length;q--;)K(F,G,ee[q].responder)}}function K(F,G,Y){R(G)?W(F,G,Y):Z(F,G,Y)}function le(F){return F!==document?F:document.createEvent&&!F.dispatchEvent?document.documentElement:F}function he(F,G,Y,ee){F=le($(F)),Object.isUndefined(ee)&&(ee=!0),Y=Y||{};var q=be(F,G,Y,ee);return o.extend(q)}function pe(F,G,Y,ee){var q=document.createEvent("HTMLEvents");return q.initEvent("dataavailable",ee,!0),q.eventName=G,q.memo=Y,F.dispatchEvent(q),q}function ye(F,G,Y,ee){var q=document.createEventObject();return q.eventType=ee?"ondataavailable":"onlosecapture",q.eventName=G,q.memo=Y,F.fireEvent(q.eventType,q),q}var be=document.createEvent?pe:ye;o.Handler=Class.create({initialize:function(F,G,Y,ee){this.element=$(F),this.eventName=G,this.selector=Y,this.callback=ee,this.handler=this.handleEvent.bind(this)},start:function(){return o.observe(this.element,this.eventName,this.handler),this},stop:function(){return o.stopObserving(this.element,this.eventName,this.handler),this},handleEvent:function(F){var G=o.findElement(F,this.selector);G&&this.callback.call(this.element,F,G)}});function ve(F,G,Y,ee){return F=$(F),Object.isFunction(Y)&&Object.isUndefined(ee)&&(ee=Y,Y=null),new o.Handler(F,G,Y,ee).start()}Object.extend(o,o.Methods),Object.extend(o,{fire:he,observe:L,stopObserving:V,on:ve}),Element.addMethods({fire:he,observe:L,stopObserving:V,on:ve}),Object.extend(document,{fire:he.methodize(),observe:L.methodize(),stopObserving:V.methodize(),on:ve.methodize(),loaded:!1}),e.Event?Object.extend(window.Event,o):e.Event=o,e.Event.cache={};function we(){e.Event.cache=null}window.attachEvent&&window.attachEvent("onunload",we),t=null,n=null})(this),(function(e){var t=document.documentElement,n="onmouseenter"in t&&"onmouseleave"in t;function r(c){return!n&&(c==="mouseenter"||c==="mouseleave")}function o(c,d,u){return Event._isCustomEvent(d)?a(c,d,u):r(d)?s(c,d,u):function(f){var g=Event.cache[c],h=g.element;Event.extend(f,h),u.call(h,f)}}function a(c,d,u){return function(f){var g=Event.cache[c],h=g.element;if(Object.isUndefined(f.eventName)||f.eventName!==d)return!1;Event.extend(f,h),u.call(h,f)}}function s(c,d,u){return function(f){var g=Event.cache[c],h=g.element;Event.extend(f,h);for(var b=f.relatedTarget;b&&b!==h;)try{b=b.parentNode}catch{b=h}b!==h&&u.call(h,f)}}e.Event._createResponder=o,t=null})(this),(function(e){var t;function n(){document.loaded||(t&&window.clearTimeout(t),document.loaded=!0,document.fire("dom:loaded"))}function r(){document.readyState==="complete"&&(document.detachEvent("onreadystatechange",r),n())}function o(){try{document.documentElement.doScroll("left")}catch{t=o.defer();return}n()}document.addEventListener?document.addEventListener("DOMContentLoaded",n,!1):(document.attachEvent("onreadystatechange",r),window==top&&(t=o.defer())),Event.observe(window,"load",n)})(this),Element.addMethods(),Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;var Insertion={Before:function(e,t){return Element.insert(e,{before:t})},Top:function(e,t){return Element.insert(e,{top:t})},Bottom:function(e,t){return Element.insert(e,{bottom:t})},After:function(e,t){return Element.insert(e,{after:t})}},$continue=new Error('"throw $continue" is deprecated, use "return" instead'),Position={includeScrollOffsets:!1,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0,this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},within:function(e,t,n){return this.includeScrollOffsets?this.withinIncludingScrolloffsets(e,t,n):(this.xcomp=t,this.ycomp=n,this.offset=Element.cumulativeOffset(e),n>=this.offset[1]&&n<this.offset[1]+e.offsetHeight&&t>=this.offset[0]&&t<this.offset[0]+e.offsetWidth)},withinIncludingScrolloffsets:function(e,t,n){var r=Element.cumulativeScrollOffset(e);return this.xcomp=t+r[0]-this.deltaX,this.ycomp=n+r[1]-this.deltaY,this.offset=Element.cumulativeOffset(e),this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+e.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+e.offsetWidth},overlap:function(e,t){if(!e)return 0;if(e=="vertical")return(this.offset[1]+t.offsetHeight-this.ycomp)/t.offsetHeight;if(e=="horizontal")return(this.offset[0]+t.offsetWidth-this.xcomp)/t.offsetWidth},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(e){return Position.prepare(),Element.absolutize(e)},relativize:function(e){return Position.prepare(),Element.relativize(e)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(e,t,n){return n=n||{},Element.clonePosition(t,e,n)}};document.getElementsByClassName||(document.getElementsByClassName=(function(e){function t(n){return n.blank()?null:"[contains(concat(' ', @class, ' '), ' "+n+" ')]"}return e.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(n,r){r=r.toString().strip();var o=/\s/.test(r)?$w(r).map(t).join(""):t(r);return o?document._getElementsByXPath(".//*"+o,n):[]}:function(n,r){r=r.toString().strip();var o=[],a=/\s/.test(r)?$w(r):null;if(!a&&!r)return o;var s=$(n).getElementsByTagName("*");r=" "+r+" ";for(var c=0,d,u;d=s[c];c++)d.className&&(u=" "+d.className+" ")&&(u.include(r)||a&&a.all(function(f){return!f.toString().blank()&&u.include(" "+f+" ")}))&&o.push(Element.extend(d));return o},function(n,r){return $(r||document.body).getElementsByClassName(n)}})(Element.Methods)),Element.ClassNames=Class.create(),Element.ClassNames.prototype={initialize:function(e){this.element=$(e)},_each:function(e,t){this.element.className.split(/\s+/).select(function(n){return n.length>0})._each(e,t)},set:function(e){this.element.className=e},add:function(e){this.include(e)||this.set($A(this).concat(e).join(" "))},remove:function(e){this.include(e)&&this.set($A(this).without(e).join(" "))},toString:function(){return $A(this).join(" ")}},Object.extend(Element.ClassNames.prototype,Enumerable),(function(){window.Selector=Class.create({initialize:function(e){this.expression=e.strip()},findElements:function(e){return Prototype.Selector.select(this.expression,e)},match:function(e){return Prototype.Selector.match(e,this.expression)},toString:function(){return this.expression},inspect:function(){return"#<Selector: "+this.expression+">"}}),Object.extend(Selector,{matchElements:function(e,t){for(var n=Prototype.Selector.match,r=[],o=0,a=e.length;o<a;o++){var s=e[o];n(s,t)&&r.push(Element.extend(s))}return r},findElement:function(e,t,n){n=n||0;for(var r=0,o,a=0,s=e.length;a<s;a++)if(o=e[a],Prototype.Selector.match(o,t)&&n===r++)return Element.extend(o)},findChildElements:function(e,t){var n=t.toArray().join(", ");return Prototype.Selector.select(n,e||document)}})})();function Dom(){}Dom.getEvent=function(t){if(!t)var t=window.event;return t},Dom.getObject=function(e){return e.currentTarget?e.currentTarget:event.srcElement},Dom.removeObject=function(e){e?.parentNode.removeChild(e)},Dom.x=function(e){return e.pageX?e.pageX:e.x},Dom.y=function(e){return e.pageY?e.pageY:e.y},Dom.left=function(e){return e.offsetLeft==0&&e.offsetTop==0?e.style.left.substr(0,e.style.left.length-2):e.offsetLeft},Dom.top=function(e){return e.offsetLeft==0&&e.offsetTop==0?e.style.top.substr(0,e.style.top.length-2):e.offsetTop},Dom.cornerX=function(e){return e.layerX?Dom.x(e)-e.layerX:Dom.x(e)-e.offsetX},Dom.cornerY=function(e){return e.layerY?Dom.y(e)-e.layerY:Dom.y(e)-e.offsetY},Dom.setClass=function(e,t){e.setAttribute("class",t),e.setAttribute("className",t)},Dom.setStyle=function(e,t){e.setAttribute("style",t),e.style.cssText=t},Dom.setDisplay=function(e,t){var n=document.getElementById(e);n!=null&&(n.style.display=t)},Dom.attachEvent=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,!0)},Dom.getElementsByName=function(e,t){var n=document.getElementsByTagName(e),r=new Array;for(i=0,iarr=0;i<n.length;i++)att=n[i].getAttribute("name"),att==t&&(r[iarr]=n[i],iarr++);return r},Dom.is_child_of=function(e,t){if(t!=null)try{for(;t.parentNode;)if((t=t.parentNode)==e)return!0}catch(n){Debugger.log("Unable to ask is_child_of: "+n)}return!1},Dom.divMouseEvent=function(element,event,JavaScript_code){var current_mouse_target=null;event.toElement?current_mouse_target=event.toElement:event.relatedTarget&&(current_mouse_target=event.relatedTarget),!Dom.is_child_of(element,current_mouse_target)&&element!=current_mouse_target&&eval(JavaScript_code)},Ajax=new Object,Ajax.isSending=!1,Ajax.queue=[],Ajax.waitUntilReady=function(){if(!Ajax.isSending&&Ajax.queue.length>0){Ajax.isSending=!0;var e=Ajax.queue[0];e.go(),Ajax.queue.splice(0,1)}Ajax.queue.length>0&&setTimeout("Ajax.waitUntilReady()",100)},Ajax.createHttp=function(){for(var e=0;e<httpFactories.length;e++)try{return httpFactories[e]()}catch{continue}return!1},Ajax.sendRequest=function(e,t,n){var r=new AjaxSender(e,t,n);Ajax.queue.push(r),Ajax.waitUntilReady()},Ajax.defaultAjaxHandle=function(e){var t=e.responseText;alert(t)};var httpFactories=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];function AjaxSender(e,t,n){this.url=e,this.callback=t,this.postData=n,this.go=function(){var r=this.url,o=this.callback,a=this.postData;if(http=Ajax.createHttp(),!!http){var s=a?"POST":"GET";o=o||Ajax.defaultAjaxHandle,http.open(s,r,!0),a&&http.setRequestHeader("Content-type","application/x-www-form-urlencoded"),http.onreadystatechange=function(){http.readyState==4&&(http.status!=200&&http.status!=304||(o(http),Ajax.isSending=!1))},http.readyState!=4&&http.send(a)}}}function roundTo(e,t){var n=Math.pow(10,t);return t>0,Math.round(e/n)*n}String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.ltrim=function(){return this.replace(/^\s+/,"")},String.prototype.rtrim=function(){return this.replace(/\s+$/,"")};function trim(e){return e.replace(/^\s+|\s+$/g,"")}function format(e){for(var t=e,n="";t!=n;){n=t;for(var r=1;r<arguments.length;r++)t=t.replace("{"+(r-1)+"}",arguments[r])}return t}function formatOnce(e){for(var t=e,n=1;n<arguments.length;n++)t=t.replace("{"+(n-1)+"}",arguments[n]);return t}Json=new Object,Json.toObject=function(jsonText){return jsonText==""?null:(eval(format("var data = {0};",jsonText)),data)},Json.toString=function(e,t,n){typeof t>"u"&&(t=null),typeof n>"u"&&(n=!0);var r="";for(var o in e){var a=e[o];if(!((""+a).startsWith("function")||a==null))if(r.length>0&&(r+=","),Json.isObject(a))r+=Json.toString(a,o,!1);else if(Json.isArray(a)){r+=format('"{0}" : [',o);for(var s=0;s<a.length;s++)s>0&&(r+=","),r+=Json.toString(a[s],null,!0);r+="]"}else r+=format('"{0}" : "{1}"',o,e[o])}return t!=null&&(r=format('"{0}" : {{1}}',t,r)),n&&(r=format("{{0}}",r)),r},Json.isObject=function(e){return typeof e=="object"&&!Json.isArray(e)},Json.isArray=function(e){return e.constructor.toString().indexOf("Array")!=-1},Debugger=new Object,Debugger.inspect=function(e){var t="";for(var n in e)(""+e[n]).startsWith("function")||(t+=typeof e+"."+n+"="+e[n]+`
`);alert(t)},Debugger.log=function(e){console.log(e)};/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */eval((function(e,t,n,r,o,a){if(o=function(s){return(s<t?"":o(parseInt(s/t)))+((s=s%t)>35?String.fromCharCode(s+29):s.toString(36))},!"".replace(/^/,String)){for(;n--;)a[o(n)]=r[n]||o(n);r=[function(s){return a[s]}],o=function(){return"\\w+"},n=1}for(;n--;)r[n]&&(e=e.replace(new RegExp("\\b"+o(n)+"\\b","g"),r[n]));return e})(`f(!1o.31){p 31=h(){p l={5S:{"1e-1c":"","73-2E":1,"2a-1P":u,"1I":u,"6T-6S":U,"1F-1P":4,"5F":O,"5x":U,"1q":U,"5v":O,"6i-6p":U,"6J":O},Q:{5D:u,5i:16,5k:16,7P:O,7I:"5L",1b:{4e:"91 1i",3Y:"92 1i",5l:"93 90 6K",6X:"8Z I 8W 1X 8X 6K 8Y",3u:"3u",6h:"?",1u:"31\\n\\n",5Z:"94't 95 7J C: ",7z:"9b 9c't 9a C 2j-2n 99: ",6B:"<!96 2j 97 \\"-//98//8b 8V 1.0 8U//8I\\" \\"2y://7A.7E.7o/8J/86/8b/86-8K.8H\\"><2j 8G=\\"2y://7A.7E.7o/8D/8E\\"><70><8F 2y-8L=\\"8M-8S\\" 5h=\\"2c/2j; 8T=8R-8\\" /><36>8Q 31</36></70><2R 1f=\\"2a-7T:8N,'7h 8O 8P',7h,7L;9d-53:#9e;53:#9D;2a-1P:9E;2c-8i:85;\\"><z 1f=\\"2c-8i:85;5n-4z:9F;\\"><z 1f=\\"2a-7T:9C,9B,9y,8C-7L;2a-1P:9z-9A;\\">31</z><z 1f=\\"2a-1P:.9G;5n-9H:9N;\\"><z>84 2.0.9O (9M 9L 6H)</z><z><a 2q=\\"2y://6a.4a\\" 9I=\\"4P\\" 1f=\\"53:#9J;2c-9K:9x;\\">2y://6a.4a</a></z></z><z>9w I 9k 9l.</z><z>9m 9j-6H 9i 9f.</z></z></2R></2j>"},7j:O},1p:{59:u,3q:u,3o:u,5j:{}},30:{},8a:{9g:/\\/\\*[\\s\\S]*?\\*\\//4M,9h:/\\/\\/.*$/4M,9n:/#.*$/4M,9o:/"(?:\\.|(\\\\\\")|[^\\""\\n])*"/g,9u:/'(?:\\.|(\\\\\\')|[^\\''\\n])*'/g,9v:/"(?:\\.|(\\\\\\")|[^\\""])*"/g,9t:/'(?:\\.|(\\\\\\')|[^\\''])*'/g,3e:/\\w+:\\/\\/[\\w-.\\/?%&=]*/g,9s:{E:/(&1C;|<)\\?=?/g,17:/\\?(&2m;|>)/g},9p:{E:/(&1C;|<)%=?/g,17:/%(&2m;|>)/g},9q:{E:/(&1C;|<)\\s*2n.*?(&2m;|>)/47,17:/(&1C;|<)\\/\\s*2n\\s*(&2m;|>)/47}},1q:{15:h(32){p 38=J.1t("37"),4L=l.1q.77;38.Y="1q";C(p 2N 1X 4L){p 6j=4L[2N],4G=R 6j(32),22=4G.15();32.5E[2N]=4G;f(22==u){1V}f(9r(22)=="9P"){22=l.1q.6C(22,32.1j,2N)}22.Y+="8w "+2N;38.1z(22)}q 38},6C:h(4v,6O,4w){p a=J.1t("a"),5e=a.1f,4F=l.Q,57=4F.5i,5c=4F.5k;a.2q="#"+4w;a.36=4v;a.5P=6O;a.6c=4w;a.1r=4v;f(5z(57)==O){5e.1N=57+"5H"}f(5z(5c)==O){5e.2u=5c+"5H"}a.8q=h(e){8j{l.1q.6f(c,e||1o.6g,c.5P,c.6c)}8m(e){l.B.1u(e.6F)}q O};q a},6f:h(7i,7a,5T,7O,72){p 4Y=l.1p.5j[5T],45;f(4Y==u||(45=4Y.5E[7O])==u){q u}q 45.2h(7i,7a,72)},77:{4e:h(4p){c.15=h(){f(4p.T("5v")!=U){q}q l.Q.1b.4e};c.2h=h(4q,8v,8B){p z=4p.z;4q.71.51(4q);z.Y=z.Y.D("5t","")}},3Y:h(8g){c.15=h(){q l.Q.1b.3Y};c.2h=h(8p,8o,8t){p 33=l.B.3d(8g.5r).D(/</g,"&1C;"),2b=l.B.4y("","4P",8r,8n,"8x=0, 8k=1, 8s=0, 6n=1");33=l.B.2W(33);2b.J.3t("<5L>"+33+"</5L>");2b.J.4N()}},5l:h(4S){p 3x,8y,5M=4S.1j;c.15=h(){p 2A=l.Q;f(2A.5D==u){q u}h 1L(5C){p 5s="";C(p 5A 1X 5C){5s+="<8z 1c='"+5A+"' 1W='"+5C[5A]+"'/>"}q 5s};h 2p(43){p 5p="";C(p 5o 1X 43){5p+=" "+5o+"='"+43[5o]+"'"}q 5p};p 48={1N:2A.5i,2u:2A.5k,1j:5M+"ai",6z:"bu/x-74-79",36:l.Q.1b.5l},46={bl:"bm",bx:"bA",bz:"5P="+5M,bF:"O"},4t=2A.5D,35;f(/aQ/i.1R(61.6b)){35="<8h"+2p({aT:"bd:bf-b9-b5-b4-b7",b8:"2y://ba.be.4a/bb/74/bc/79/b3.b2#84=9,0,0,0"})+2p(48)+">"+1L(46)+1L({aU:4t})+"</8h>"}F{35="<aS"+2p(48)+2p(46)+2p({aR:4t})+"/>"}3x=J.1t("z");3x.1r=35;q 3x};c.2h=h(aV,aW,4R){p 68=4R.b1;6V(68){2J"7C":p 5d=l.B.2W(l.B.3d(4S.5r).D(/&1C;/g,"<").D(/&2m;/g,">").D(/&b0;/g,"&"));f(1o.6e){1o.6e.aZ("2c",5d)}F{q l.B.2W(5d)}2J"aX":l.B.1u(l.Q.1b.6X);2B;2J"aY":l.B.1u(4R.6F);2B}}},bh:h(4I){c.15=h(){q l.Q.1b.3u};c.2h=h(bg,by,bB){p 25=J.1t("bG"),1J=u;f(l.1p.3o!=u){J.2R.51(l.1p.3o)}l.1p.3o=25;25.1f.bC="bE:bD;1N:6m;2u:6m;E:-6l;4z:-6l;";J.2R.1z(25);1J=25.4J.J;6t(1J,1o.J);1J.3t("<z 1e=\\""+4I.z.Y.D("5t","")+" bn\\">"+4I.z.1r+"</z>");1J.4N();25.4J.4A();25.4J.3u();h 6t(6A,6s){p 2S=6s.7M("4K");C(p i=0;i<2S.v;i++){f(2S[i].6r.bk()=="6q"&&/bi\\.12$/.1R(2S[i].2q)){6A.3t("<4K 6z=\\"2c/12\\" 6r=\\"6q\\" 2q=\\""+2S[i].2q+"\\"></4K>")}}}}},bj:h(bo){c.15=h(){q l.Q.1b.6h};c.2h=h(bv,bt){p 2b=l.B.4y("","4P",bq,bs,"6n=0"),1J=2b.J;1J.3t(l.Q.1b.6B);1J.4N();2b.4A()}}}},B:{5m:h(6R){q 6R+3z.aN(3z.aa()*ab).2f()},5u:h(4E,4x){p 3l={},1S;C(1S 1X 4E){3l[1S]=4E[1S]}C(1S 1X 4x){3l[1S]=4x[1S]}q 3l},7w:h(4u){6V(4u){2J"U":q U;2J"O":q O}q 4u},4y:h(3e,6M,4D,4C,2I){p x=(6N.1N-4D)/2,y=(6N.2u-4C)/2;2I+=", E="+x+", 4z="+y+", 1N="+4D+", 2u="+4C;2I=2I.D(/^,/,"");p 4Q=1o.9Q(3e,6M,2I);4Q.4A();q 4Q},78:h(1A,29,23){f(1A.6D){1A["e"+29+23]=23;1A[29+23]=h(){1A["e"+29+23](1o.6g)};1A.6D("a6"+29,1A[29+23])}F{1A.a7(29,23,O)}},1u:h(A){1u(l.Q.1b.1u+A)},4c:h(5a,5Y){p 2k=l.1p.59,3j=u;f(2k==u){2k={};C(p 55 1X l.30){p 3g=l.30[55].ac;f(3g==u){1V}C(p i=0;i<3g.v;i++){2k[3g[i]]=55}}l.1p.59=2k}3j=l.30[2k[5a]];f(3j==u&&5Y!=O){l.B.1u(l.Q.1b.5Z+5a)}q 3j},42:h(A,60){p 2T=A.21("\\n");C(p i=0;i<2T.v;i++){2T[i]=60(2T[i])}q 2T.4h("\\n")},6x:h(){p z=J.1t("z"),3h=J.1t("z"),6d=10,i=1;28(i<=aO){f(i%6d===0){z.1r+=i;i+=(i+"").v}F{z.1r+="&ah;";i++}}3h.Y="5F 2E";3h.1z(z);q 3h},6U:h(A){q A.D(/^[ ]*[\\n]+|[\\n]*[ ]*$/g,"")},7d:h(A){p 3i,4V={},5b=R M("^\\\\[(?<54>(.*?))\\\\]$"),69=R M("(?<1c>[\\\\w-]+)"+"\\\\s*:\\\\s*"+"(?<1W>"+"[\\\\w-%#]+|"+"\\\\[.*?\\\\]|"+"\\".*?\\"|"+"'.*?'"+")\\\\s*;?","g");28((3i=69.N(A))!=u){p 2g=3i.1W.D(/^['"]|['"]$/g,"");f(2g!=u&&5b.1R(2g)){p m=5b.N(2g);2g=m.54.v>0?m.54.21(/\\s*,\\s*/):[]}4V[3i.1c]=2g}q 4V},80:h(A,12){f(A==u||A.v==0||A=="\\n"){q A}A=A.D(/</g,"&1C;");A=A.D(/ {2,}/g,h(m){p 4U="";C(p i=0;i<m.v-1;i++){4U+="&1O;"}q 4U+" "});f(12!=u){A=l.B.42(A,h(2i){f(2i.v==0){q""}p 3k="";2i=2i.D(/^(&1O;| )+/,h(s){3k=s;q""});f(2i.v==0){q 3k}q 3k+"<I 1e=\\""+12+"\\">"+2i+"</I>"})}q A},7f:h(66,67){p 2Z=66.2f();28(2Z.v<67){2Z="0"+2Z}q 2Z},5y:h(){p 3b=J.1t("z"),3f,3a=0,52=J.2R,1j=l.B.5m("5y"),2O="<z 1e=\\"",2Q="</z>",4W="</1T>";3b.1r=2O+"6L\\">"+2O+"26\\">"+2O+"2E\\">"+2O+"5h"+"\\"><1T 1e=\\"7V\\"><1T 1j=\\""+1j+"\\">&1O;"+4W+4W+2Q+2Q+2Q+2Q;52.1z(3b);3f=J.a5(1j);f(/a4/i.1R(61.6b)){p 5Q=1o.9V(3f,u);3a=7l(5Q.9W("1N"))}F{3a=3f.9U}52.51(3b);q 3a},6Q:h(7R,6Y){p 1F="";C(p i=0;i<6Y;i++){1F+=" "}q 7R.D(/\\t/g,1F)},6P:h(2P,41){p 9T=2P.21("\\n"),1F="\\t",5f="";C(p i=0;i<50;i++){5f+="                    "}h 7X(3c,18,7Z){q 3c.1M(0,18)+5f.1M(0,7Z)+3c.1M(18+1,3c.v)};2P=l.B.42(2P,h(20){f(20.1h(1F)==-1){q 20}p 18=0;28((18=20.1h(1F))!=-1){p 7U=41-18%41;20=7X(20,18,7U)}q 20});q 2P},3d:h(A){q(l.Q.7P==U)?A.D(/<br\\s*\\/?>|&1C;br\\s*\\/?&2m;/47,"\\n"):A},3P:h(A){q A.D(/\\s*$/g,"").D(/^\\s*/,"")},2W:h(A){p 1Q=l.B.3d(A).21("\\n"),9X=R 5B(),7S=/^\\s*/,24=9Y;C(p i=0;i<1Q.v&&24>0;i++){p 3V=1Q[i];f(l.B.3P(3V).v==0){1V}p 3S=7S.N(3V);f(3S==u){q A}24=3z.24(3S[0].v,24)}f(24>0){C(p i=0;i<1Q.v;i++){1Q[i]=1Q[i].1M(24)}}q 1Q.4h("\\n")},7B:h(2L,2K){f(2L.H<2K.H){q-1}F{f(2L.H>2K.H){q 1}F{f(2L.v<2K.v){q-1}F{f(2L.v>2K.v){q 1}}}}q 0},2D:h(8d,2G){h 8e(3W,81){q[R l.4i(3W[0],3W.H,81.12)]};p a2=0,3X=u,3y=[],8c=2G.4m?2G.4m:8e;28((3X=2G.3D.N(8d))!=u){3y=3y.2H(8c(3X,2G))}q 3y},6o:h(8f){q 8f.D(l.8a.3e,h(m){q"<a 2q=\\""+m+"\\">"+m+"</a>"})}},1I:h(7c,4l){h 88(4s){p 49=[];C(p i=0;i<4s.v;i++){49.K(4s[i])}q 49};p 3m=4l?[4l]:88(J.7M(l.Q.7I)),7g="1r",2t=u;f(3m.v===0){q}C(p i=0;i<3m.v;i++){p 2F=3m[i],2s=l.B.7d(2F.Y),2Y;2s=l.B.5u(7c,2s);2Y=2s["7J"];f(2Y==u){1V}f(2s["2j-2n"]=="U"){2t=R l.44(2Y)}F{p 4o=l.B.4c(2Y);f(4o){2t=R 4o()}F{1V}}2t.1I(2F[7g],2s);p 2l=2t.z;f(l.Q.7j){2l=J.1t("a0");2l.1W=2t.z.1r;2l.1f.1N="aj";2l.1f.2u="aE"}2F.71.aF(2l,2F)}},aD:h(76){l.B.78(1o,"aC",h(){l.1I(76)})}};l.4i=h(4j,75,12){c.1W=4j;c.H=75;c.v=4j.v;c.12=12};l.4i.Z.2f=h(){q c.1W};l.44=h(4g){p 1H=l.B.4c(4g),4f=R l.30.aA(),aB=u;f(1H==u){q}1H=R 1H();c.4X=4f;f(1H.3K==u){l.B.1u(l.Q.1b.7z+4g);q}4f.4B.K({3D:1H.3K.I,4m:7F});h 39(4d,7G){C(p j=0;j<4d.v;j++){4d[j].H+=7G}};h 7F(14,aH){p 7x=14.I,1E=[],4k=1H.4B,7p=14.H+14.E.v,2X=1H.3K,1n;C(p i=0;i<4k.v;i++){1n=l.B.2D(7x,4k[i]);39(1n,7p);1E=1E.2H(1n)}f(2X.E!=u&&14.E!=u){1n=l.B.2D(14.E,2X.E);39(1n,14.H);1E=1E.2H(1n)}f(2X.17!=u&&14.17!=u){1n=l.B.2D(14.17,2X.17);39(1n,14.H+14[0].aM(14.17));1E=1E.2H(1n)}q 1E}};l.44.Z.1I=h(7u,7t){c.4X.1I(7u,7t);c.z=c.4X.z};l.87=h(){};l.87.Z={T:h(7v,7n){p 5J=c.1L[7v];q l.B.7w(5J==u?7n:5J)},15:h(7y){q J.1t(7y)},7m:h(5G){C(p i=0;i<c.1Y.v;i++){p 2V=c.1Y[i];f(2V===u){1V}f((5G.H>2V.H)&&(5G.H<2V.H+2V.v)){q U}}q O},6v:h(3v,7D){p 2e=[];f(3v!=u){C(p i=0;i<3v.v;i++){2e=2e.2H(l.B.2D(7D,3v[i]))}}2e=2e.aL(l.B.7B);q 2e},6u:h(){C(p i=0;i<c.1Y.v;i++){f(c.7m(c.1Y[i])){c.1Y[i]=u}}},6k:h(2C){p 3w=2C.21(/\\n/g),3s=7l(c.T("73-2E")),7e=(3s+3w.v).2f().v,89=c.T("1I",[]);2C="";C(p i=0;i<3w.v;i++){p 1s=3w[i],2w=/^(&1O;|\\s)+/.N(1s),5w="2E aK"+(i%2==0?1:2),82=l.B.7f(3s+i,7e),83=89.1h((3s+i).2f())!=-1,1D=u;f(2w!=u){1D=2w[0].2f();1s=1s.1M(1D.v);1D=1D.D(/&1O;/g," ");2w=l.1p.3q*1D.v}F{2w=0}1s=l.B.3P(1s);f(1s.v==0){1s="&1O;"}f(83){5w+=" aI"}2C+="<z 1e=\\""+5w+"\\">"+"<I 1e=\\"aJ\\">"+82+".</I>"+"<1T 1e=\\"5h\\">"+(1D!=u?"<I 1e=\\"az\\">"+1D.D(/\\s/g,"&1O;")+"</I>":"")+"<1T 1e=\\"7V\\" 1f=\\"5n-E: "+2w+"5H !aq;\\">"+1s+"</1T>"+"</1T>"+"</z>"}q 2C},6w:h(5N,5K){p 18=0,3n="",3r=l.B.80;C(p i=0;i<5K.v;i++){p 1y=5K[i];f(1y===u||1y.v===0){1V}3n+=3r(5N.1M(18,1y.H-18),"63")+3r(1y.1W,1y.12);18=1y.H+1y.v}3n+=3r(5N.1M(18),"63");q 3n},1I:h(1g,5R){p am=l.Q,3p=l.1p,z,34;c.1L={};c.z=u;c.26=u;c.I=u;c.2d=u;c.5E={};c.1j=l.B.5m("ar");3p.5j[c.1j]=c;f(1g===u){1g=""}f(3p.3q===u){3p.3q=l.B.5y()}c.1L=l.B.5u(l.5S,5R||{});f(c.T("6J")==U){c.1L.1q=c.1L.5x=O}c.z=z=c.15("37");c.26=c.15("37");c.26.Y="26";z.Y="6L";z.1j=c.1j;f(c.T("5v")){z.Y+=" 5t"}f(c.T("5x")==O){z.Y+=" ax"}z.Y+=" "+c.T("1e-1c");z.1f.av=c.T("2a-1P","");c.5r=1g;c.I=l.B.6U(1g).D(/\\r/g," ");34=c.T("1F-1P");c.I=c.T("6T-6S")==U?l.B.6P(c.I,34):l.B.6Q(c.I,34);c.I=l.B.2W(c.I);f(c.T("1q")){c.2d=c.15("37");c.2d.Y="2d";c.2d.1z(l.1q.15(c));z.1z(c.2d)}f(c.T("5F")){z.1z(l.B.6x())}z.1z(c.26);c.1Y=c.6v(c.4B,c.I);c.6u();1g=c.6w(c.I,c.1Y);1g=c.6k(l.B.3P(1g));f(c.T("6i-6p")){1g=l.B.6o(1g)}c.26.1r=1g},au:h(A){A=A.D(/^\\s+|\\s+$/g,"").D(/\\s+/g,"\\\\b|\\\\b");q"\\\\b"+A+"\\\\b"},at:h(2z){c.3K={E:{3D:2z.E,12:"2n"},17:{3D:2z.17,12:"2n"},I:R M("(?<E>"+2z.E.1i+")"+"(?<I>.*?)"+"(?<17>"+2z.17.1i+")","aw")}}};q l}()}f(!5B.1h){5B.Z.1h=h(5V,3J){3J=3z.as(3J||0,0);C(p i=3J;i<c.v;i++){f(c[i]==5V){q i}}q-1}}f(!1o.M){(h(){p 2v={N:V.Z.N,64:5q.Z.64,D:5q.Z.D,21:5q.Z.21},1G={11:/(?:[^\\\\([#\\s.]+|\\\\(?!k<[\\w$]+>|[65]{[^}]+})[\\S\\s]?|\\((?=\\?(?!#|<[\\w$]+>)))+|(\\()(?:\\?(?:(#)[^)]*\\)|<([$\\w]+)>))?|\\\\(?:k<([\\w$]+)>|[65]{([^}]+)})|(\\[\\^?)|([\\S\\s])/g,al:/(?:[^$]+|\\$(?![1-9$&\`']|{[$\\w]+}))+|\\$(?:([1-9]\\d*|[$&\`'])|{([$\\w]+)})/g,3F:/^(?:\\s+|#.*)+/,3R:/^(?:[?*+]|{\\d+(?:,\\d*)?})/,7H:/&&\\[\\^?/g,7q:/]/g},7N=h(5I,7Y,7K){C(p i=7K||0;i<5I.v;i++){f(5I[i]===7Y){q i}}q-1},7k=/()??/.N("")[1]!==3A,3L={};M=h(1d,1U){f(1d 4T V){f(1U!==3A){3G 62("56't 58 an 6G ao 5X V ap ay")}q 1d.3I()}p 1U=1U||"",7s=1U.1h("s")>-1,7r=1U.1h("x")>-1,4b=O,3C=[],13=[],11=1G.11,G,3N,3O,3E,3B;11.L=0;28(G=2v.N.2x(11,1d)){f(G[2]){f(!1G.3R.1R(1d.19(11.L))){13.K("(?:)")}}F{f(G[1]){3C.K(G[3]||u);f(G[3]){4b=U}13.K("(")}F{f(G[4]){3E=7N(3C,G[4]);13.K(3E>-1?"\\\\"+(3E+1)+(5z(1d.5O(11.L))?"":"(?:)"):G[0])}F{f(G[5]){13.K(3L.6Z?3L.6Z.7C(G[5],G[0].5O(1)==="P"):G[0])}F{f(G[6]){f(1d.5O(11.L)==="]"){13.K(G[6]==="["?"(?!)":"[\\\\S\\\\s]");11.L++}F{3N=M.6E("&&"+1d.19(G.H),1G.7H,1G.7q,"",{5W:"\\\\"})[0];13.K(G[6]+3N+"]");11.L+=3N.v+1}}F{f(G[7]){f(7s&&G[7]==="."){13.K("[\\\\S\\\\s]")}F{f(7r&&1G.3F.1R(G[7])){3O=2v.N.2x(1G.3F,1d.19(11.L-1))[0].v;f(!1G.3R.1R(1d.19(11.L-1+3O))){13.K("(?:)")}11.L+=3O-1}F{13.K(G[7])}}}F{13.K(G[0])}}}}}}}3B=V(13.4h(""),2v.D.2x(1U,/[aG]+/g,""));3B.1v={1i:1d,2o:4b?3C:u};q 3B};M.ak=h(1c,o){3L[1c]=o};V.Z.N=h(A){p 1a=2v.N.2x(c,A),1c,i,5g;f(1a){f(7k&&1a.v>1){5g=R V("^"+c.1i+"$(?!\\\\s)",c.3U());2v.D.2x(1a[0],5g,h(){C(i=1;i<7b.v-2;i++){f(7b[i]===3A){1a[i]=3A}}})}f(c.1v&&c.1v.2o){C(i=1;i<1a.v;i++){1c=c.1v.2o[i-1];f(1c){1a[1c]=1a[i]}}}f(c.3H&&c.L>(1a.H+1a[0].v)){c.L--}}q 1a}})()}V.Z.3U=h(){q(c.3H?"g":"")+(c.9Z?"i":"")+(c.6W?"m":"")+(c.3F?"x":"")+(c.a1?"y":"")};V.Z.3I=h(7Q){p 3T=R M(c.1i,(7Q||"")+c.3U());f(c.1v){3T.1v={1i:c.1v.1i,2o:c.1v.2o?c.1v.2o.19(0):u}}q 3T};V.Z.2x=h(a3,A){q c.N(A)};V.Z.9S=h(9R,7W){q c.N(7W[0])};M.3Z=h(4r,4Z){p 40="/"+4r+"/"+(4Z||"");q M.3Z[40]||(M.3Z[40]=R M(4r,4Z))};M.3M=h(A){q A.D(/[-[\\]{}()*+?.\\\\^$|,#\\s]/g,"\\\\$&")};M.6E=h(A,E,W,1k,2M){p 2M=2M||{},2U=2M.5W,X=2M.af,1k=1k||"",4O=1k.1h("g")>-1,6y=1k.1h("i")>-1,5U=1k.1h("m")>-1,4H=1k.1h("y")>-1,1k=1k.D(/y/g,""),E=E 4T V?(E.3H?E:E.3I("g")):R M(E,"g"+1k),W=W 4T V?(W.3H?W:W.3I("g")):R M(W,"g"+1k),1K=[],2r=0,1m=0,1l=0,1x=0,27,1Z,1w,1B,3Q,4n;f(2U){f(2U.v>1){3G ae("56't 58 ag ad 5X 3M 6I")}f(5U){3G 62("56't 58 3M 6I 6G a8 a9 6W aP")}3Q=M.3M(2U);4n=R V("^(?:"+3Q+"[\\\\S\\\\s]|(?:(?!"+E.1i+"|"+W.1i+")[^"+3Q+"])+)+",6y?"i":"")}28(U){E.L=W.L=1l+(2U?(4n.N(A.19(1l))||[""])[0].v:0);1w=E.N(A);1B=W.N(A);f(1w&&1B){f(1w.H<=1B.H){1B=u}F{1w=u}}f(1w||1B){1m=(1w||1B).H;1l=(1w?E:W).L}F{f(!2r){2B}}f(4H&&!2r&&1m>1x){2B}f(1w){f(!2r++){27=1m;1Z=1l}}F{f(1B&&2r){f(!--2r){f(X){f(X[0]&&27>1x){1K.K([X[0],A.19(1x,27),1x,27])}f(X[1]){1K.K([X[1],A.19(27,1Z),27,1Z])}f(X[2]){1K.K([X[2],A.19(1Z,1m),1Z,1m])}f(X[3]){1K.K([X[3],A.19(1m,1l),1m,1l])}}F{1K.K(A.19(1Z,1m))}1x=1l;f(!4O){2B}}}F{E.L=W.L=0;3G b6("bw bp 8l 8u 8A")}}f(1m===1l){1l++}}f(4O&&!4H&&X&&X[0]&&A.v>1x){1K.K([X[0],A.19(1x),1x,A.v])}E.L=W.L=0;q 1K};`,62,725,"||||||||||||this|||if||function||||sh||||var|return||||null|length||||div|str|utils|for|replace|left|else|_109|index|code|document|push|lastIndex|XRegExp|exec|false||config|new||getParam|true|RegExp|_121|vN|className|prototype||part|css|_107|_c3|create||right|pos|slice|_111|strings|name|_101|class|style|_ed|indexOf|source|id|_122|_12d|_12c|_ca|window|vars|toolbar|innerHTML|_e0|createElement|alert|_x|_131|_12e|_ec|appendChild|obj|_132|lt|_e5|_c6|tab|lib|_bd|highlight|doc|_12a|params|substr|width|nbsp|size|_97|test|_4b|span|_102|continue|value|in|matches|_130|_91|split|_8|_57|min|_3c|lines|_12f|while|_56|font|wnd|text|bar|_d7|toString|_6e|execute|_75|html|_5b|_b7|gt|script|captureNames|attributes|href|_12b|_b4|_b1|height|_f8|_e1|call|http|_f4|_28|break|_da|getMatches|line|_b3|_a1|concat|_51|case|m2|m1|_123|_5|_80|_88|_81|body|_40|_62|_124|_d4|unindent|_c9|_b5|_7a|brushes|SyntaxHighlighter|_2|_22|_f2|_32|title|DIV|_3|offsetMatches|_7d|_7b|_8e|fixForBlogger|url|_7c|_5e|_65|_6a|_5c|_76|_4a|_af|_e9|printFrame|_f0|spaceWidth|_ea|_dc|write|print|_d5|_db|_25|_a6|Math|undefined|_10d|_106|regex|_10c|extended|throw|global|addFlags|_f6|htmlScript|_100|escape|cc|len|trim|_133|quantifier|_9d|_116|getNativeFlags|_9c|_a2|_a5|viewSource|cache|key|_89|eachLine|_2c|HtmlScript|_18|_30|gi|_2f|_ad|com|_105|findBrush|_c0|expandSource|_be|_bc|join|Match|_b9|_c7|_ab|func|esc|_b6|_19|_1a|_11b|_ac|swf|_4c|_9|_b|_49|popup|top|focus|regexList|_50|_4f|_48|_e|_7|_129|_38|contentWindow|link|_4|gm|close|_126|_blank|win|_35|_24|instanceof|_73|_6b|_82|xmlBrush|_17|_11c||removeChild|_7e|color|values|_5d|can|_f|supply|discoveredBrushes|_59|_6c|_10|_37|_d|_8c|r2|content|toolbarItemWidth|highlighters|toolbarItemHeight|copyToClipboard|guid|margin|_2e|_2d|String|originalCode|_2a|collapsed|merge|collapse|_e2|gutter|measureSpace|isNaN|_2b|Array|_29|clipboardSwf|toolbarCommands|ruler|_d2|px|_fb|_d0|_e7|pre|_27|_e6|charAt|highlighterId|_83|_ee|defaults|_14|_128|_f5|escapeChar|one|_5a|noBrush|_61|navigator|TypeError|plain|match|pP|_78|_79|_36|_6d|alexgorbatchev|userAgent|commandName|_66|clipboardData|executeCommand|event|help|auto|_6|createDisplayLines|500px|0px|scrollbars|processUrls|links|stylesheet|rel|_3f|copyStyles|removeNestedMatches|findMatches|processMatches|createRuler|_127|type|_3e|aboutDialog|createButton|attachEvent|matchRecursive|message|when|2009|character|light|clipboard|syntaxhighlighter|_4e|screen|_a|processSmartTabs|processTabs|_47|tabs|smart|trimFirstAndLastLines|switch|multiline|copyToClipboardConfirmation|_85|unicode|head|parentNode|_16|first|shockwave|_ba|_b8|items|addEvent|flash|_13|arguments|_aa|parseParams|_dd|padNumber|_b0|Times|_12|debug|_ff|parseInt|isMatchNested|_cf|org|_c8|classRight|_104|_103|_cd|_cc|_ce|toBoolean|_c5|_d1|brushNotHtmlScript|www|matchesSortCallback|get|_d6|w3|process|_c1|classLeft|tagName|brush|_fd|serif|getElementsByTagName|_fa|_15|bloggerMode|_115|_84|_99|family|_93|block|args|insertSpaces|_fc|_90|decorate|_a3|_e3|_e4|version|center|xhtml1|Highlighter|toArray|_de|regexLib|DTD|_a7|_a0|defaultAdd|_a8|_1e|object|align|try|resizable|contains|catch|400|_20|_1f|onclick|750|menubar|_21|unbalanced|_1b|item|location|_26|param|delimiters|_1c|sans|1999|xhtml|meta|xmlns|dtd|EN|TR|transitional|equiv|Content|Georgia|New|Roman|About|utf|Type|charset|Transitional|XHTML|is|your|now|The|to|expand|view|copy|Can|find|DOCTYPE|PUBLIC|W3C|option|configured|Brush|wasn|background|fff|Gorbatchev|multiLineCComments|singleLineCComments|Alex|2004|syntax|highlighter|Copyright|singleLinePerlComments|doubleQuotedString|aspScriptTags|scriptScriptTags|typeof|phpScriptTags|multiLineSingleQuotedString|singleQuotedString|multiLineDoubleQuotedString|JavaScript|none|Helvetica|xx|large|Arial|Geneva|000|1em|3em|75em|bottom|target|0099FF|decoration|01|March|4em|296|string|open|_119|apply|_8a|offsetWidth|getComputedStyle|getPropertyValue|_98|1000|ignoreCase|textarea|sticky|_a4|_117|opera|getElementById|on|addEventListener|using|the|random|1000000|aliases|than|SyntaxError|valueNames|more|middot|_clipboard|70em|addPlugin|replaceVar|_ef|flags|constructing|from|important|highlighter_|max|forHtmlScript|getKeywords|fontSize|sgi|nogutter|another|spaces|Xml|_bf|load|all|30em|replaceChild|sx|_c4|highlighted|number|alt|sort|lastIndexOf|round|150|flag|msie|src|embed|classid|movie|_33|_34|ok|error|setData|amp|command|cab|swflash|96b8|11cf|Error|444553540000|codebase|ae6d|download|pub|cabs|clsid|macromedia|d27cdb6e|_39|printSource|shCore|about|toLowerCase|allowScriptAccess|always|printing|_42|data|500||250|_44|application|_43|subject|wmode|_3a|flashVars|transparent|_3b|cssText|absolute|position|menu|IFRAME".split("|"),0,{}));/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */SyntaxHighlighter.brushes.Alloy=function(){var e="abstract assert assert fact in all else extends module sig String Int one some lone set no ";this.regexList=[{regex:SyntaxHighlighter.regexLib.singleLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.multiLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.doubleQuotedString,css:"string"},{regex:SyntaxHighlighter.regexLib.singleQuotedString,css:"string"},{regex:/\b([\d]+(\.[\d]+)?|0x[a-f0-9]+)\b/gi,css:"value"},{regex:/(?!\@interface\b)\@[\$\w]+\b/g,css:"color1"},{regex:/\@interface\b/g,css:"color2"},{regex:new RegExp(this.getKeywords(e),"gm"),css:"keyword"}],this.forHtmlScript(SyntaxHighlighter.regexLib.aspScriptTags)},SyntaxHighlighter.brushes.Alloy.prototype=new SyntaxHighlighter.Highlighter,SyntaxHighlighter.brushes.Alloy.aliases=["Alloy","alloy","als"];/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */SyntaxHighlighter.brushes.Cpp=function(){var e="ATOM BOOL BOOLEAN BYTE CHAR COLORREF DWORD DWORDLONG DWORD_PTR DWORD32 DWORD64 FLOAT HACCEL HALF_PTR HANDLE HBITMAP HBRUSH HCOLORSPACE HCONV HCONVLIST HCURSOR HDC HDDEDATA HDESK HDROP HDWP HENHMETAFILE HFILE HFONT HGDIOBJ HGLOBAL HHOOK HICON HINSTANCE HKEY HKL HLOCAL HMENU HMETAFILE HMODULE HMONITOR HPALETTE HPEN HRESULT HRGN HRSRC HSZ HWINSTA HWND INT INT_PTR INT32 INT64 LANGID LCID LCTYPE LGRPID LONG LONGLONG LONG_PTR LONG32 LONG64 LPARAM LPBOOL LPBYTE LPCOLORREF LPCSTR LPCTSTR LPCVOID LPCWSTR LPDWORD LPHANDLE LPINT LPLONG LPSTR LPTSTR LPVOID LPWORD LPWSTR LRESULT PBOOL PBOOLEAN PBYTE PCHAR PCSTR PCTSTR PCWSTR PDWORDLONG PDWORD_PTR PDWORD32 PDWORD64 PFLOAT PHALF_PTR PHANDLE PHKEY PINT PINT_PTR PINT32 PINT64 PLCID PLONG PLONGLONG PLONG_PTR PLONG32 PLONG64 POINTER_32 POINTER_64 PSHORT PSIZE_T PSSIZE_T PSTR PTBYTE PTCHAR PTSTR PUCHAR PUHALF_PTR PUINT PUINT_PTR PUINT32 PUINT64 PULONG PULONGLONG PULONG_PTR PULONG32 PULONG64 PUSHORT PVOID PWCHAR PWORD PWSTR SC_HANDLE SC_LOCK SERVICE_STATUS_HANDLE SHORT SIZE_T SSIZE_T TBYTE TCHAR UCHAR UHALF_PTR UINT UINT_PTR UINT32 UINT64 ULONG ULONGLONG ULONG_PTR ULONG32 ULONG64 USHORT USN VOID WCHAR WORD WPARAM WPARAM WPARAM char bool short int __int32 __int64 __int8 __int16 long float double __wchar_t clock_t _complex _dev_t _diskfree_t div_t ldiv_t _exception _EXCEPTION_POINTERS FILE _finddata_t _finddatai64_t _wfinddata_t _wfinddatai64_t __finddata64_t __wfinddata64_t _FPIEEE_RECORD fpos_t _HEAPINFO _HFILE lconv intptr_t jmp_buf mbstate_t _off_t _onexit_t _PNH ptrdiff_t _purecall_handler sig_atomic_t size_t _stat __stat64 _stati64 terminate_function time_t __time64_t _timeb __timeb64 tm uintptr_t _utimbuf va_list wchar_t wctrans_t wctype_t wint_t signed",t="break case catch class const __finally __exception __try const_cast continue private public protected __declspec default delete deprecated dllexport dllimport do dynamic_cast else enum explicit extern if for friend goto inline mutable naked namespace new noinline noreturn nothrow register reinterpret_cast return selectany sizeof static static_cast struct switch template this thread throw true false try typedef typeid typename union using uuid virtual void volatile whcar_t while",n="assert isalnum isalpha iscntrl isdigit isgraph islower isprintispunct isspace isupper isxdigit tolower toupper errno localeconv setlocale acos asin atan atan2 ceil cos cosh exp fabs floor fmod frexp ldexp log log10 modf pow sin sinh sqrt tan tanh jmp_buf longjmp setjmp raise signal sig_atomic_t va_arg va_end va_start clearerr fclose feof ferror fflush fgetc fgetpos fgets fopen fprintf fputc fputs fread freopen fscanf fseek fsetpos ftell fwrite getc getchar gets perror printf putc putchar puts remove rename rewind scanf setbuf setvbuf sprintf sscanf tmpfile tmpnam ungetc vfprintf vprintf vsprintf abort abs atexit atof atoi atol bsearch calloc div exit free getenv labs ldiv malloc mblen mbstowcs mbtowc qsort rand realloc srand strtod strtol strtoul system wcstombs wctomb memchr memcmp memcpy memmove memset strcat strchr strcmp strcoll strcpy strcspn strerror strlen strncat strncmp strncpy strpbrk strrchr strspn strstr strtok strxfrm asctime clock ctime difftime gmtime localtime mktime strftime time";this.regexList=[{regex:SyntaxHighlighter.regexLib.singleLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.multiLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.doubleQuotedString,css:"string"},{regex:SyntaxHighlighter.regexLib.singleQuotedString,css:"string"},{regex:/^ *#.*/gm,css:"preprocessor"},{regex:new RegExp(this.getKeywords(e),"gm"),css:"color1 bold"},{regex:new RegExp(this.getKeywords(n),"gm"),css:"functions bold"},{regex:new RegExp(this.getKeywords(t),"gm"),css:"keyword bold"}]},SyntaxHighlighter.brushes.Cpp.prototype=new SyntaxHighlighter.Highlighter,SyntaxHighlighter.brushes.Cpp.aliases=["cpp","c"];/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */SyntaxHighlighter.brushes.Java=function(){var e="abstract assert boolean break byte case catch char class const continue default do double else enum extends false final finally float for goto if implements import instanceof int interface long native new null package private protected public return short static strictfp super switch synchronized this throw throws true transient try void volatile while";this.regexList=[{regex:SyntaxHighlighter.regexLib.singleLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.multiLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.doubleQuotedString,css:"string"},{regex:SyntaxHighlighter.regexLib.singleQuotedString,css:"string"},{regex:/\b([\d]+(\.[\d]+)?|0x[a-f0-9]+)\b/gi,css:"value"},{regex:/(?!\@interface\b)\@[\$\w]+\b/g,css:"color1"},{regex:/\@interface\b/g,css:"color2"},{regex:new RegExp(this.getKeywords(e),"gm"),css:"keyword"}],this.forHtmlScript(SyntaxHighlighter.regexLib.aspScriptTags)},SyntaxHighlighter.brushes.Java.prototype=new SyntaxHighlighter.Highlighter,SyntaxHighlighter.brushes.Java.aliases=["java"];/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */SyntaxHighlighter.brushes.NuSMV=function(){var e="MODULE IVAR VAR ASSIGN DEFINE TRANS INVARSPEC SPEC CTLSPEC LTLSPEC next init esac case TRUE FALSE main EF AG AX AF EX EG U A E ";this.regexList=[{regex:SyntaxHighlighter.regexLib.singleLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.multiLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.doubleQuotedString,css:"string"},{regex:SyntaxHighlighter.regexLib.singleQuotedString,css:"string"},{regex:/\b([\d]+(\.[\d]+)?|0x[a-f0-9]+)\b/gi,css:"value"},{regex:/(?!\@interface\b)\@[\$\w]+\b/g,css:"color1"},{regex:/\@interface\b/g,css:"color2"},{regex:new RegExp(this.getKeywords(e),"gm"),css:"keyword"}],this.forHtmlScript(SyntaxHighlighter.regexLib.aspScriptTags)},SyntaxHighlighter.brushes.NuSMV.prototype=new SyntaxHighlighter.Highlighter,SyntaxHighlighter.brushes.NuSMV.aliases=["NuSMV","nusmv","smv"];/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */SyntaxHighlighter.brushes.Php=function(){var e="abs acos acosh addcslashes addslashes array_change_key_case array_chunk array_combine array_count_values array_diff array_diff_assoc array_diff_key array_diff_uassoc array_diff_ukey array_fill array_filter array_flip array_intersect array_intersect_assoc array_intersect_key array_intersect_uassoc array_intersect_ukey array_key_exists array_keys array_map array_merge array_merge_recursive array_multisort array_pad array_pop array_product array_push array_rand array_reduce array_reverse array_search array_shift array_slice array_splice array_sum array_udiff array_udiff_assoc array_udiff_uassoc array_uintersect array_uintersect_assoc array_uintersect_uassoc array_unique array_unshift array_values array_walk array_walk_recursive atan atan2 atanh base64_decode base64_encode base_convert basename bcadd bccomp bcdiv bcmod bcmul bindec bindtextdomain bzclose bzcompress bzdecompress bzerrno bzerror bzerrstr bzflush bzopen bzread bzwrite ceil chdir checkdate checkdnsrr chgrp chmod chop chown chr chroot chunk_split class_exists closedir closelog copy cos cosh count count_chars date decbin dechex decoct deg2rad delete ebcdic2ascii echo empty end ereg ereg_replace eregi eregi_replace error_log error_reporting escapeshellarg escapeshellcmd eval exec exit exp explode extension_loaded feof fflush fgetc fgetcsv fgets fgetss file_exists file_get_contents file_put_contents fileatime filectime filegroup fileinode filemtime fileowner fileperms filesize filetype floatval flock floor flush fmod fnmatch fopen fpassthru fprintf fputcsv fputs fread fscanf fseek fsockopen fstat ftell ftok getallheaders getcwd getdate getenv gethostbyaddr gethostbyname gethostbynamel getimagesize getlastmod getmxrr getmygid getmyinode getmypid getmyuid getopt getprotobyname getprotobynumber getrandmax getrusage getservbyname getservbyport gettext gettimeofday gettype glob gmdate gmmktime ini_alter ini_get ini_get_all ini_restore ini_set interface_exists intval ip2long is_a is_array is_bool is_callable is_dir is_double is_executable is_file is_finite is_float is_infinite is_int is_integer is_link is_long is_nan is_null is_numeric is_object is_readable is_real is_resource is_scalar is_soap_fault is_string is_subclass_of is_uploaded_file is_writable is_writeable mkdir mktime nl2br parse_ini_file parse_str parse_url passthru pathinfo readlink realpath rewind rewinddir rmdir round str_ireplace str_pad str_repeat str_replace str_rot13 str_shuffle str_split str_word_count strcasecmp strchr strcmp strcoll strcspn strftime strip_tags stripcslashes stripos stripslashes stristr strlen strnatcasecmp strnatcmp strncasecmp strncmp strpbrk strpos strptime strrchr strrev strripos strrpos strspn strstr strtok strtolower strtotime strtoupper strtr strval substr substr_compare",t="and or xor array as break case cfunction class const continue declare default die do else elseif enddeclare endfor endforeach endif endswitch endwhile extends for foreach function include include_once global if new old_function return static switch use require require_once var while abstract interface public implements extends private protected throw",n="__FILE__ __LINE__ __METHOD__ __FUNCTION__ __CLASS__";this.regexList=[{regex:SyntaxHighlighter.regexLib.singleLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.multiLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.doubleQuotedString,css:"string"},{regex:SyntaxHighlighter.regexLib.singleQuotedString,css:"string"},{regex:/\$\w+/g,css:"variable"},{regex:new RegExp(this.getKeywords(e),"gmi"),css:"functions"},{regex:new RegExp(this.getKeywords(n),"gmi"),css:"constants"},{regex:new RegExp(this.getKeywords(t),"gm"),css:"keyword"}],this.forHtmlScript(SyntaxHighlighter.regexLib.phpScriptTags)},SyntaxHighlighter.brushes.Php.prototype=new SyntaxHighlighter.Highlighter,SyntaxHighlighter.brushes.Php.aliases=["php"];/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */SyntaxHighlighter.brushes.Python=function(){var e="and assert break class continue def del elif else except exec finally for from global if import in is lambda not or pass raise return try yield while",t="__import__ abs all any apply basestring bin bool buffer callable chr classmethod cmp coerce compile complex delattr dict dir divmod enumerate eval execfile file filter float format frozenset getattr globals hasattr hash help hex id input int intern isinstance issubclass iter len list locals long map max min next object oct open ord pow print property range raw_input reduce reload repr reversed round set setattr slice sorted staticmethod str sum super tuple type type unichr unicode vars xrange zip",n="None True False self cls class_";this.regexList=[{regex:SyntaxHighlighter.regexLib.singleLinePerlComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.singleLineCComments,css:"comments"},{regex:/^\s*@\w+/gm,css:"decorator"},{regex:/(['\"]{3})([^\1])*?\1/gm,css:"comments"},{regex:/"(?!")(?:\.|\\\"|[^\""\n])*"/gm,css:"string"},{regex:/'(?!')(?:\.|(\\\')|[^\''\n])*'/gm,css:"string"},{regex:/\+|\-|\*|\/|\%|=|==/gm,css:"keyword"},{regex:/\b\d+\.?\w*/g,css:"value"},{regex:new RegExp(this.getKeywords(t),"gm"),css:"functions"},{regex:new RegExp(this.getKeywords(e),"gm"),css:"keyword"},{regex:new RegExp(this.getKeywords(n),"gm"),css:"color1"}],this.forHtmlScript(SyntaxHighlighter.regexLib.aspScriptTags)},SyntaxHighlighter.brushes.Python.prototype=new SyntaxHighlighter.Highlighter,SyntaxHighlighter.brushes.Python.aliases=["py","python"];/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */SyntaxHighlighter.brushes.Ruby=function(){var e="alias and BEGIN begin break case class def define_method defined do each else elsif END end ensure false for if in module new next nil not or raise redo rescue retry return self super then throw true undef unless until when while yield",t="Array Bignum Binding Class Continuation Dir Exception FalseClass File::Stat File Fixnum Fload Hash Integer IO MatchData Method Module NilClass Numeric Object Proc Range Regexp String Struct::TMS Symbol ThreadGroup Thread Time TrueClass";this.regexList=[{regex:SyntaxHighlighter.regexLib.singleLinePerlComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.doubleQuotedString,css:"string"},{regex:SyntaxHighlighter.regexLib.singleQuotedString,css:"string"},{regex:/\b[A-Z0-9_]+\b/g,css:"constants"},{regex:/:[a-z][A-Za-z0-9_]*/g,css:"color2"},{regex:/(\$|@@|@)\w+/g,css:"variable bold"},{regex:new RegExp(this.getKeywords(e),"gm"),css:"keyword"},{regex:new RegExp(this.getKeywords(t),"gm"),css:"color1"}],this.forHtmlScript(SyntaxHighlighter.regexLib.aspScriptTags)},SyntaxHighlighter.brushes.Ruby.prototype=new SyntaxHighlighter.Highlighter,SyntaxHighlighter.brushes.Ruby.aliases=["ruby","rails","ror"];/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */SyntaxHighlighter.brushes.Sql=function(){var e="abs avg case cast coalesce convert count current_timestamp current_user day isnull left lower month nullif replace right session_user space substring sum system_user upper user year",t="absolute action add after alter as asc at authorization begin bigint binary bit by cascade char character check checkpoint close collate column commit committed connect connection constraint contains continue create cube current current_date current_time cursor database date deallocate dec decimal declare default delete desc distinct double drop dynamic else end end-exec escape except exec execute false fetch first float for force foreign forward free from full function global goto grant group grouping having hour ignore index inner insensitive insert instead int integer intersect into is isolation key last level load local max min minute modify move name national nchar next no numeric of off on only open option order out output partial password precision prepare primary prior privileges procedure public read real references relative repeatable restrict return returns revoke rollback rollup rows rule schema scroll second section select sequence serializable set size smallint static statistics table temp temporary then time timestamp to top transaction translation trigger true truncate uncommitted union unique update values varchar varying view when where with work",n="all and any between cross in join like not null or outer some";this.regexList=[{regex:/--(.*)$/gm,css:"comments"},{regex:SyntaxHighlighter.regexLib.multiLineDoubleQuotedString,css:"string"},{regex:SyntaxHighlighter.regexLib.multiLineSingleQuotedString,css:"string"},{regex:new RegExp(this.getKeywords(e),"gmi"),css:"color2"},{regex:new RegExp(this.getKeywords(n),"gmi"),css:"color1"},{regex:new RegExp(this.getKeywords(t),"gmi"),css:"keyword"}]},SyntaxHighlighter.brushes.Sql.prototype=new SyntaxHighlighter.Highlighter,SyntaxHighlighter.brushes.Sql.aliases=["sql"];/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */SyntaxHighlighter.brushes.Xml=function(){function e(t,n){var r=SyntaxHighlighter.Match,o=t[0],a=new XRegExp("(&lt;|<)[\\s\\/\\?]*(?<name>[:\\w-\\.]+)","xg").exec(o),s=[];if(t.attributes!=null)for(var c,d=new XRegExp(`(?<name> [\\w:\\-\\.]+)\\s*=\\s*(?<value> ".*?"|'.*?'|\\w+)`,"xg");(c=d.exec(o))!=null;)s.push(new r(c.name,t.index+c.index,"color1")),s.push(new r(c.value,t.index+c.index+c[0].indexOf(c.value),"string"));return a!=null&&s.push(new r(a.name,t.index+a[0].indexOf(a.name),"keyword")),s}this.regexList=[{regex:new XRegExp("(\\&lt;|<)\\!\\[[\\w\\s]*?\\[(.|\\s)*?\\]\\](\\&gt;|>)","gm"),css:"color2"},{regex:new XRegExp("(\\&lt;|<)!--\\s*.*?\\s*--(\\&gt;|>)","gm"),css:"comments"},{regex:new XRegExp("(&lt;|<)[\\s\\/\\?]*(\\w+)(?<attributes>.*?)[\\s\\/\\?]*(&gt;|>)","sg"),func:e}]},SyntaxHighlighter.brushes.Xml.prototype=new SyntaxHighlighter.Highlighter,SyntaxHighlighter.brushes.Xml.aliases=["xml","xhtml","xslt","html","xhtml"];var inlineeditor_isIE=navigator.userAgent.toLowerCase().search("msie")!=-1&&navigator.userAgent.toLowerCase().search("opera")==-1,InlineEditor={alreadyInited:!1,addClass:function(e,t){return InlineEditor.jscss("add",e,t)},removeClass:function(e,t){return InlineEditor.jscss("remove",e,t)},checkClass:function(e,t){return InlineEditor.jscss("check",e,t)},swapClass:function(e,t,n){return InlineEditor.jscss("swap",e,t,n)},customEditor:function(e){var t=jQuery("<input/>");return t.attr("id",e.attr("id")+"_editor"),t.val(e.html()=="-- Add More --"?"":e.html()),t.width(e.parent().width()-30),t.height(e.offset().height),t},handleOnClick:function(t){var t=InlineEditor.fixEvent(t),n=jQuery(InlineEditor.findEditableTarget(t.target));if(!(n.hasClass("uneditable")||n.hasClass("editing"))){var r=n.html(),o=null;InlineEditor.elementValue&&(o=InlineEditor.elementValue(n)),o||(o=n.html());var a=null;return InlineEditor.customEditor&&(a=InlineEditor.customEditor(n)),a.focusout(function(s){InlineEditor.handleInputBlur(a,o,r)}),a.keypress(function(s){var c=13;if(s.which==c&&(a.blur(),o=="-- Add More --"&&a.val()!="")){var d=n.attr("id");jQuery("#"+d).click()}}),n.addClass("editing"),n.html(""),n.append(a),a.focusin(),a.select(),!1}},handleInputBlur:function(e,t,n){var r=e.parent(),o=null;if(InlineEditor.editorValue&&(o=InlineEditor.editorValue(e)),o||(o=e.val()==""?t:e.val()),t==o){r.html(n),r.removeClass("editing");return}r.html(o),InlineEditor.elementChanged&&InlineEditor.elementChanged(r,t,o)},jscss:function(e,t,n,r){switch(e){case"swap":t.className=InlineEditor.jscss("check",t,n)?t.className.replace(n,r):t.className.replace(r,n);break;case"add":InlineEditor.jscss("check",t,n)||(t.className+=t.className?" "+n:n);break;case"remove":var o=t.className.match(" "+n)?" "+n:n;t.className=t.className.replace(o,"");break;case"check":return new RegExp("\\b"+n+"\\b").test(t.className)}},fixEvent:function(e){var t=e||window.event;return t.target&&t.target.nodeType==3&&(t.target=t.target.parentNode),inlineeditor_isIE&&t.srcElement&&(t.target=t.srcElement),t},findEditableTarget:function(e){return e.nodeType==1&&e.tagName=="TD"||InlineEditor.checkClass(e,"editable")?e:e.parentNode?InlineEditor.findEditableTarget(e.parentNode):null},addEvent:function(e,t,n,r){if(e.addEventListener)return e.addEventListener(t,n,r),!0;if(e.attachEvent)return e.attachEvent("on"+t,n)},removeEvent:function(e,t,n,r){if(e.removeEventListener)return e.removeEventListener(t,n,r),!0;if(e.detachEvent)return e.detachEvent("on"+t,n)}};DropboxChooser={},DropboxChooser.init=function(){jQuery(".dropbox-button-chooser").each(function(){this.setAttribute("data-link-type","direct"),this.setAttribute("data-extensions",".ump");var e=this;this.addEventListener("DbxChooserSuccess",function(t){DropboxChooser.load(t.files[0].link)},!1)})},DropboxChooser.load=function(e){UmpleSystem.merge(null),Page.showCanvasLoading(!0),Page.showModelLoading(!0),Page.showLayoutLoading(!0),jQuery.get(e).done(function(t){Action.freshLoad=!0,Page.setUmpleCode(t),Page.hideLoading(),TabControl.getCurrentHistory().save(t,"dropboxLoad"),Action.updateUmpleDiagram(),Action.setCaretPosition("0"),Action.updateLineNumberDisplay()}).fail(function(){Page.setFeedbackMessage("Cannot load from the chosen Dropbox file."),Page.hideLoading()})};var DropboxInitializer={};DropboxInitializer.initializeDropbox=function(){jQuery(".dropbox-add-saver").addClass("dropbox-option").append('<li id="ttDropboxSaver"><span class="dropbox-button-saver"></span></li>'),jQuery(".dropbox-add-chooser").addClass("dropbox-option").append('<li id="ttDropboxChooser"><input type="dropbox-chooser" class="dropbox-button-chooser"/></li>'),DropboxChooser.init(),DropboxSaver.init()},DropboxMaster={resetTimeout:2e3},DropboxSaver={},DropboxSaver.init=function(){jQuery(".dropbox-button-saver").each(function(){DropboxSaver.createSaverIn(this)})},DropboxSaver.createSaverIn=function(e){var t=DropboxSaver.getAbsoluteLink(Page.getFilename()),n=Dropbox.createSaveButton({files:[{url:t}],success:function(){window.setTimeout(function(){jQuery(e).children(".dropbox-dropin-btn").remove(),DropboxSaver.createSaverIn(e)},DropboxMaster.resetTimeout)},error:function(r){console.log(r),Page.setFeedbackMessage("Cannot save to the chosen Dropbox location.")}});jQuery(e).append(n)},DropboxSaver.getAbsoluteLink=function(e){var t=document.createElement("a");return t.href=e.replace(/^\.\.\//,""),t.href};var Action=new Object;Action.waiting_time=1500,Action.oldTimeout=null,Action.elementClicked=!1,Action.canCreateByDrag=!0,Action.manualSync=!1,Action.diagramInSync=!0,Action.freshLoad=!1,Action.gentime=new Date().getTime(),Action.savedCanonical="",Action.gdprHidden=!1,Action.update="",Action.neighbors=[];const clientDebuggerFlag=!1;let justUpdatetoSaveLater=!1;Action.setjustUpdatetoSaveLater=function(e){justUpdatetoSaveLater=e};let justUpdatetoSaveLaterForTextCallback=!1;Action.setjustUpdatetoSaveLaterForTextCallback=function(e){justUpdatetoSaveLaterForTextCallback=e},Action.clicked=function(e){Page.clickCount+=1;var t=e.currentTarget,n=t.id.substring(6);if(n=="PhpCode")Action.generateCode("php","Php");else if(n=="RubyCode")Action.generateCode("ruby","Ruby");else if(n=="JavaCode")Action.generateCode("java","Java");else if(n=="RTCppCode")Action.generateCode("rtcpp","RTCpp");else if(n=="AlloyCode")Action.generateCode("alloy","Alloy");else if(n=="NuSMVCode")Action.generateCode("nusmv","NuSMV");else if(n=="CppCode")Action.generateCode("cpp","Cpp");else if(n=="SQLCode")Action.generateCode("sql","Sql");else if(n=="JavaAPIDoc")Action.generateCode("javadoc","javadoc");else if(n=="StateDiagram")Action.generateCode("stateDiagram","stateDiagram");else if(n=="StructureDiagram")Action.generateCode("structureDiagram","structureDiagram");else if(n=="FeatureDiagram")Action.generateCode("featureDiagram","featureDiagram");else if(n=="classDiagram")Action.generateCode("classDiagram","classDiagram");else if(n=="instanceDiagram")Action.generateCode("instanceDiagram","instanceDiagram");else if(n=="entityRelationshipDiagram")Action.generateCode("entityRelationshipDiagram","entityRelationshipDiagram");else if(n=="EcoreCode")Action.generateCode("xml","Ecore");else if(n=="GenerateCode"){var r=$("inputGenerateCode").value.split(":");Action.generateCode(r[0],r[1])}else if(n=="ExecuteCode"){var o=$("inputGenerateCode").value.split(":");Action.executeCode(o[0],o[1])}else if(n=="SimulateCode")Action.simulateCode();else if(n=="StartOver")Action.startOver();else if(n=="ShowRefreshUmpleOnlineCompletely")Action.showRefreshUmpleOnlineCompletely();else if(n=="LoadBlankModel")Action.loadBlankModel();else if(n=="PngImage")Action.pngImage();else if(n=="YumlImage")Action.yumlImage();else if(n=="Jsf")Action.uigu();else if(n=="CopyClip")Action.copyClipboardCode();else if(n=="CopyMix")Action.copyClipboardMixset();else if(n=="Copy")Action.showCodeInSeparateWindow();else if(n=="CopyCommandLine")Action.copyCommandLineCode();else if(n=="CopyEncodedURL")Action.showEncodedURLCodeInSeparateWindow();else if(n=="CopyLocalBrowser")typeof Storage<"u"?(localStorage.setItem("umpleLocalStorage1",Page.getUmpleCode()),Page.setFeedbackMessage("Model saved. Use Load From Browser later to restore.")):Page.setFeedbackMessage("Unable to copy the model to browser storage. An error occurred.");else if(n=="LoadLocalBrowser"){if(typeof Storage<"u"){var a=localStorage.getItem("umpleLocalStorage1");a!=null&&Page.setUmpleCode(a)}}else if(n=="CreateTask")jQuery("#taskArea").css("display","block"),jQuery("#labelTaskName").css("display","block"),jQuery("#taskNameCell").css("display","block"),jQuery("#instructions").css("display","block"),jQuery("#isExperimentCell").css("display","block"),Layout.zoomResize();else if(n=="LoadTask")jQuery("#loadTaskNameArea").css("display","block");else if(n=="LoadThisTask")Action.loadTask(Page.getModel().split("-")[1],!1);else if(n=="RequestLoadTaskURL"){var s=Page.getModel().split("-")[1];Action.copyToClp(window.location.hostname+"/bookmark.php?loadTaskWithURL=1&taskname="+s+"&model="+s)}else if(n=="RequestAllZip"){if(document.getElementById("downloadTaskDirLink")===null){var c=document.createElement("a");c.setAttribute("href","scripts/tab_control.php?downloadTaskUserDir=1&taskid="+Page.getModel()),c.setAttribute("id","downloadTaskDirLink");var d=document.createTextNode("Download ZIP File From Here");c.appendChild(d);var u=document.createElement("LI");u.appendChild(c),document.getElementById("taskSubmenu").appendChild(u)}else document.getElementById("downloadTaskDirLink").setAttribute("href","scripts/tab_control.php?downloadTaskUserDir=1&taskid="+Page.getModel());setTimeout(function(){document.getElementById("downloadTaskDirLink").remove()},3e4)}else if(n=="DownloadFiles"){if(TabControl.useActiveTabTo(TabControl.saveTab)(Page.getUmpleCode()),document.getElementById("downloadLink")===null){var c=document.createElement("a");c.setAttribute("href","scripts/tab_control.php?download=1&&model="+Page.getModel()),c.setAttribute("id","downloadLink");var d=document.createTextNode("Download ZIP File From Here");c.appendChild(d);var u=document.createElement("LI");u.appendChild(c),document.getElementById("saveLoad").appendChild(u)}else document.getElementById("downloadLink").setAttribute("href","scripts/tab_control.php?download=1&&model="+Page.getModel());setTimeout(function(){document.getElementById("downloadLink").remove()},3e4)}else if(n=="Undo")Action.undo();else if(n=="Redo")Action.redo();else if(n=="Reindent"){var f=Page.getRawUmpleCodeCM6().split(`
`),g=Page.codeMirrorEditor6.state.selection.main.head,h=Page.codeMirrorEditor6.state.doc.lineAt(g).number;clientDebuggerFlag&&console.log(h);var b=f[h].match(/^\s*/)[0].length,E=g.ch-b;g.ch=E,Action.reindent(f,g)}else n=="ShowHideTextEditor"?(Layout.showHideTextEditor(),Page.showText=!Page.showText,Page.setShowHideIconState("SHT_button")):n=="ShowHideCanvas"?(Layout.showHideCanvas(),Page.showCanvas=!Page.showCanvas,Page.setShowHideIconState("SHD_button")):n=="ShowEditableClassDiagram"?Action.changeDiagramType({type:"editableClass"}):n=="ShowJointJSClassDiagram"?Action.changeDiagramType({type:"JointJSClass"}):n=="ShowGvClassDiagram"?Action.changeDiagramType({type:"GvClass"}):n=="ShowGvFeatureDiagram"?Action.changeDiagramType({type:"GvFeature"}):n=="ShowGvStateDiagram"?Action.changeDiagramType({type:"GvState"}):n=="ShowStructureDiagram"?Action.changeDiagramType({type:"structure"}):n=="ShowHideLayoutEditor"?Layout.showHideLayoutEditor():n=="ManualSync"?Action.enableManualSync():n=="SyncDiagram"?(Action.processTyping("codeMirrorEditor",!0),Page.codeMirrorEditor6.focus()):n=="PhotoReady"?Action.photoReady():n=="ToggleAttributes"?(Action.toggleAttributes(),Page.setShowHideIconState("SHA_button")):n=="ToggleMethods"?(Action.toggleMethods(),Page.setShowHideIconState("SHM_button")):n=="ToggleActions"?Action.toggleActions():n=="ToggleTraits"?Action.toggleTraits():n=="ToggleTransitionLabels"?Action.toggleTransitionLabels():n=="ToggleGuards"?Action.toggleGuards():n=="ToggleGuardLabels"?Action.toggleGuardLabels():n=="AllowPinch"?Action.allowPinch():n=="ToggleFeatureDependency"?Action.toggleFeatureDependency():n=="StructureLink"?Action.generateStructureDiagramFile():n=="TabsCheckbox"?Action.toggleTabs():n.substr(0,6)=="mixset"?Action.toggleMixsetUseStatement(n.substr(6)):n.substr(0,6)=="filter"?Action.toggleFilterUseStatement(n.substr(6)):n.substr(0,2)=="gv"&&Action.toggleSpecialSuboption(n)},Action.toggleSpecialSuboption=function(e){var t=Page.specialSuboptionsActive.indexOf(e);t!==-1?Page.specialSuboptionsActive.splice(t,1):(Page.specialSuboptionsActive.push(e),Action.deactivateSpecialLayoutAlgorithmsExcept(e)),Action.redrawDiagram()},Action.toggleMixsetUseStatement=function(e){var t=Page.mixsetsActive.indexOf(e);t!==-1?Page.mixsetsActive.splice(t,1):Page.mixsetsActive.push(e),Action.redrawDiagram()},Action.toggleFilterUseStatement=function(e){var t=Page.filtersActive.indexOf(e);t!==-1?Page.filtersActive.splice(t,1):Page.filtersActive.push(e),Action.redrawDiagram()},Action.focusOn=function(e,t){var n="#"+e,r=e=="umpleModelEditorText"||e=="umpleLayoutEditorText"||e=="CodeMirror";e=="CodeMirror"&&(n=".CodeMirror-scroll"),t?(!Page.isPhotoReady()||r)&&(jQuery(n).parent().addClass("focus"),jQuery(n).addClass("visibleFocus"),r&&(Page.shortcutsEnabled=!1,Page.selectedItem!=null&&Page.unselectAllToggleTools(),Action.unselectAll())):(jQuery(n).parent().removeClass("focus"),jQuery(n).removeClass("visibleFocus"),(r||e=="CodeMirror")&&(Page.shortcutsEnabled=!0))},Action.startOver=function(){Page.setUmpleCode(""),UmpleSystem.merge(null),window.location="umple.php"},Action.showRefreshUmpleOnlineCompletely=function(){jQuery("#buttonStartOver").show()},Action.loadBlankModel=function(){UmpleSystem.merge(null),Page.showCanvasLoading(!0),Page.showModelLoading(!0),Page.showLayoutLoading(!0),Ajax.sendRequest("scripts/compiler.php",Action.loadExampleCallback,"exampleCode=")},Action.undo=function(){jQuery("#buttonUndo").hasClass("disabled")||Action.redoOrUndo(!0)},Action.redo=function(){jQuery("#buttonRedo").hasClass("disabled")||Action.redoOrUndo(!1)},Action.dropHandler=function(e){if(Page.setFeedbackMessage("File will be dropped"),e.preventDefault(),e.dataTransfer.items){for(var t=0;t<e.dataTransfer.items.length;t++)if(e.dataTransfer.items[t].kind==="file"){var n=e.dataTransfer.items[t].getAsFile();n.text().then(function(r){Page.setUmpleCode(r)})}}else for(var t=0;t<e.dataTransfer.files.length;t++)e.dataTransfer.files[t].text().then(function(o){Page.setUmpleCode(o)})},Action.dragOverHandler=function(e){e.preventDefault()},Action.getThemePreference=function(){try{var e=document.getElementById("themeModeSelect"),t=localStorage.getItem("umple-theme"),n=e&&/^(light|dark|system)$/.test(e.value)?e.value:/(light|dark|system)$/.test(t)?t:"system";return n==="system"?window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":n}catch{return"light"}},Action.redoOrUndo=function(e){var t="";Action.manualSync&&Action.diagramInSync&&(Action.diagramInSync=!1,Page.enablePaletteItem("buttonSyncDiagram",!0),Page.enableDiagram(!1)),e?t=TabControl.getCurrentHistory().getPreviousVersion():t=TabControl.getCurrentHistory().getNextVersion(),t==History.noChange&&(t="");var n=t.indexOf(Page.modelDelimiter),r="";n==-1?r=t:r=t.substring(0,n);var o=Page.getRawUmpleCodeCM6().replace(Page.modelDelimiter,""),a=Action.findDiff(o,r),s=Action.getCaretPosition();Action.freshLoad=!0,Page.setUmpleCode(t),Action.manualSync||Action.updateLayoutEditorAndDiagram(),Action.setjustUpdatetoSaveLater(!0),setTimeout(function(){a[1]==a[2]?Action.setCaretPosition(s):Action.setCaretPosition(a[3])},300)},Action.findDiff=function(e,t){var n=0,r=e.length,o=t.length,a=r;o<a&&(a=o);for(var s=0;s<a&&e.charAt(s)===t.charAt(s);)s++,e.charAt(s)===`
`&&t.charAt(s)===`
`&&n++;var c=t.substring(s,1);return[r,o,s,n+1]},Action.loadFile=function(){var e=Page.getFilename();e!=""?(Action.setjustUpdatetoSaveLater(!0),Page.getModel().substring(0,8)=="taskroot"?Ajax.sendRequest("scripts/compiler.php",Action.loadFileCallback,format("load=1&isTask=1&filename={0}",e)):Ajax.sendRequest("scripts/compiler.php",Action.loadFileCallback,format("load=1&filename={0}",e))):Action.saveNewFile()},Action.loadFileCallback=function(e){if(Action.freshLoad=!0,!(Object.keys(TabControl.tabs).length>1)){if(Page.setUmpleCode(e.responseText,!0),TabControl.getCurrentHistory().save(e.responseText,"loadFileCallback"),Action.setjustUpdatetoSaveLater(!0),TabControl.tabs[TabControl.getActiveTabId()].nameIsEphemeral){var t=TabControl.extractNameFromCode(e.responseText);t&&TabControl.useActiveTabTo(TabControl.renameTab)(t,!0)}Action.manualSync||(Action.updateUmpleDiagram(),Action.freshLoad=!1)}},Action.loadTask=function(e,t){jQuery("#showInstrcutionsArea").css("display","block"),t?Page.getModel().split("-")[0]=="task"?Ajax.sendRequest("scripts/compiler.php",Action.loadTaskExceptCodeCallback,format("loadTask=1&loadInstructionAsHTML=1&filename={0}",e)):Ajax.sendRequest("scripts/compiler.php",Action.loadTaskExceptCodeCallback,format("loadTask=1&filename={0}",e)):Ajax.sendRequest("bookmark.php",Action.loadTaskBookmark,format("taskname={0}&model={0}",e))},Action.loadTaskBookmark=function(e){e.responseText.split(" ")[0]=="Task"?window.alert("Load Task Failed! "+e.responseText):window.location.href="umple.php?model="+e.responseText},Action.loadTaskCallback=function(e){if(Action.freshLoad=!0,!(Object.keys(TabControl.tabs).length>1)){Action.setjustUpdatetoSaveLater(!0),TabControl.getCurrentHistory().save(e.responseText,"loadTaskCallback");var t=e.responseText.split("task delimiter");if(Page.setUmpleCode(t[0]),TabControl.tabs[TabControl.getActiveTabId()].nameIsEphemeral){var n=TabControl.extractNameFromCode(t[0]);n&&TabControl.useActiveTabTo(TabControl.renameTab)(n,!0)}Action.manualSync||Action.updateUmpleDiagram(),TabControl.useActiveTabTo(TabControl.saveTab)(Page.getUmpleCode()),TabControl.saveActiveTabs(),window.location.href="bookmark.php?taskname="+t[2]+"&model="+t[3]}},Action.loadTaskExceptCodeCallback=function(e){Action.freshLoad=!0,justUpdatetoSaveLater||(TabControl.getCurrentHistory().save(e.responseText,"loadTaskExceptCodeCallback"),Action.setjustUpdatetoSaveLater(!0));var t=e.responseText.split("task delimiter");if(jQuery("#labelInstructions").text('Instructions for task "'+t[2]+'":'),jQuery("#requestorName").val(t[4]),jQuery("#labelInstructions").css("display","block"),jQuery("#taskArea").css("display","block"),Page.getModel().split("-")[0]=="task"?(jQuery("#labelInstructions").text('Instructions for task "'+t[2]+'":               Requestor Name:'+t[4]),jQuery("#labelCompletionURL").css("display","none"),jQuery("#completionURLCell").css("display","none"),jQuery("#labelRequestorName").css("display","none"),jQuery("#requestorName").css("display","none"),jQuery("#instructionsHTML").html(t[1])):(jQuery("#instructions").val(t[1]),jQuery("#instructions").css("display","block"),jQuery("#completionURL").val(t[5]),jQuery("#isExperimentCell").css("display","inline"),jQuery("#isExperiment").prop("checked",t[6]=="true"),jQuery("#instructions").each(function(){this.setAttribute("style","height:"+this.scrollHeight+"px;overflow-y:hidden;")}).on("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"})),TabControl.tabs[TabControl.getActiveTabId()].nameIsEphemeral){var n=TabControl.extractNameFromCode(t[0]);n&&TabControl.useActiveTabTo(TabControl.renameTab)(n,!0)}Layout.zoomResize()},Action.submitLoadTask=function(){var e=jQuery("#inputLoadTaskName").val();if(!/^(\w|\.)+$/.test(e)){window.alert("Task Name can only contain letters(case insensitive), underscores, dots, and digits!");return}Action.loadTask(e,!1)},Action.submitTaskWork=function(){Ajax.sendRequest("task.php",Action.submitTaskWorkCallback,format("submitTaskWork=1&model={0}&responseURL={1}",Page.getModel(),window.location.href))},Action.submitTaskWorkCallback=function(e){window.alert("Successfully submitted Task!");var t=e.responseText.split("task submit delimiter");t[0]==""?window.location.href=t[2]:window.location.href=t[0]+"?task="+t[1]+"&url="+t[2]},Action.launchParticipantURL=function(){var e=Page.getModel().split("-")[1];window.open("bookmark.php?loadTaskWithURL=1&taskname="+e+"&model="+e)},Action.copyParticipantURL=function(){var e=Page.getModel().split("-")[1],t=window.location.hostname+window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/"))+"/bookmark.php?loadTaskWithURL=1&taskname="+e+"&model="+e;Action.copyToClp(t),Page.setFeedbackMessage("Participant URL is in copy buffer: "+t)},Action.openStartFreshWork=function(){var e=confirm("Are you sure to start from fresh?");e&&(window.location.href="/umpleonline/umple.php")},Action.copyToClp=function(e){prenode=document.createElement("PRE"),e=document.createTextNode(e),prenode.appendChild(e);var t=document,n=window,r=t.body;if(r.appendChild(prenode),r.createTextRange){var o=r.createTextRange();o.moveToElementText(e),o.select(),t.execCommand("copy")}else{var o=t.createRange(),a=n.getSelection;o.selectNodeContents(e),a().removeAllRanges(),a().addRange(o),t.execCommand("copy"),a().removeAllRanges()}prenode.remove()},Action.openInstructionInNewTab=function(){jQuery("#buttonReshowInstructions").css("display","inline");var e=window.open("about:blank","_blank");e.document.write(jQuery("#instructionsHTML").html()),e.document.close(),jQuery("#instructionsHTML").css("display","none"),jQuery("#labelInstructions").css("display","none"),jQuery("#buttonHideInstructions").css("display","none"),Layout.zoomResize()},Action.reshowInstructions=function(){jQuery("#instructionsHTML").css("display","block"),jQuery("#labelInstructions").css("display","inline"),jQuery("#buttonReshowInstructions").css("display","none"),jQuery("#buttonHideInstructions").css("display","inline"),Layout.zoomResize()},Action.hideInstructions=function(){jQuery("#instructionsHTML").css("display","none"),jQuery("#labelInstructions").css("display","none"),jQuery("#buttonHideInstructions").css("display","none"),jQuery("#buttonReshowInstructions").css("display","inline"),Layout.zoomResize()},Action.saveNewFile=function(){var e=Page.getUmpleCode(),t=Page.getFilename();t==""&&Ajax.sendRequest("scripts/compiler.php",Action.saveNewFileCallback,format("save=1&&umpleCode={0}",e))},Action.saveNewFileCallback=function(e){Page.setFilename(e.responseText)},Action.changeDiagramType=function(e){var t=!1;if(jQuery(".layoutListItem").hide(),e.type=="editableClass"){if(Page.useEditableClassDiagram)return;Page.useEditableClassDiagram=!0,Page.useJointJSClassDiagram=!1,Page.useGvClassDiagram=!1,Page.useGvStateDiagram=!1,Page.useGvFeatureDiagram=!1,Page.useStructureDiagram=!1,t=!0,jQuery("#buttonShowEditableClassDiagram").prop("checked","checked"),Page.setDiagramTypeIconState("editableClass"),jQuery(".view_opt_class").show(),jQuery(".view_opt_class_palette").show()}else if(e.type=="JointJSClass"){if(Page.useJointJSClassDiagram)return;Page.useEditableClassDiagram=!1,Page.useJointJSClassDiagram=!0,Page.useGvClassDiagram=!1,Page.useGvStateDiagram=!1,Page.useGvFeatureDiagram=!1,Page.useStructureDiagram=!1,t=!0,jQuery("#buttonShowJointJSClassDiagram").prop("checked","checked"),Page.setDiagramTypeIconState("JointJSClass"),jQuery(".view_opt_class").show(),jQuery(".view_opt_class_palette").show()}else if(e.type=="GvClass"){if(Page.useGvClassDiagram)return;Page.useEditableClassDiagram=!1,Page.useJointJSClassDiagram=!1,Page.useGvClassDiagram=!0,Page.useGvStateDiagram=!1,Page.useGvFeatureDiagram=!1,Page.useStructureDiagram=!1,t=!0,jQuery("#buttonShowGvClassDiagram").prop("checked","checked"),Page.setDiagramTypeIconState("GvClass"),jQuery(".view_opt_class").show()}else if(e.type=="GvState"){if(Page.useGvStateDiagram)return;Page.useEditableClassDiagram=!1,Page.useJointJSClassDiagram=!1,Page.useGvClassDiagram=!1,Page.useGvStateDiagram=!0,Page.useStructureDiagram=!1,Page.useGvFeatureDiagram=!1,t=!0,jQuery("#buttonShowGvStateDiagram").prop("checked","checked"),Page.setDiagramTypeIconState("GvState"),jQuery(".view_opt_state").show()}else if(e.type=="GvFeature"){if(Page.useGvFeatureDiagram)return;Page.useEditableClassDiagram=!1,Page.useJointJSClassDiagram=!1,Page.useGvClassDiagram=!1,Page.useGvStateDiagram=!1,Page.useStructureDiagram=!1,Page.useGvFeatureDiagram=!0,t=!0,jQuery("#buttonShowGvFeatureDiagram").prop("checked","checked"),Page.setDiagramTypeIconState("GvFeature"),jQuery(".view_opt_feature").show()}else if(e.type=="structure"){if(Page.useGvStructureDiagram)return;Page.useEditableClassDiagram=!1,Page.useJointJSClassDiagram=!1,Page.useGvClassDiagram=!1,Page.useGvStateDiagram=!1,Page.useStructureDiagram=!0,Page.useGvFeatureDiagram=!1,t=!0,jQuery("#buttonShowStructureDiagram").prop("checked","checked"),Page.setDiagramTypeIconState("structure")}t&&Action.redrawDiagram()},Action.pngImage=function(){var e=Json.toString(UmpleSystem),t=encodeURIComponent(e);window.open("scripts/compiler.php?asImage="+t,"UMLClassDiagram")},Action.yumlImage=function(){var e="#buttonYumlImage";jQuery(e).showLoading(),Action.ajax(Action.yumlImageCallback,"save=1")},Action.yumlImageCallback=function(e){var t=e.responseText,n="#buttonYumlImage";jQuery(n).hideLoading(),window.open("scripts/compiler.php?asYuml="+t,"yumlClassDiagram"),Page.showViewDone()},Action.uigu=function(){var e="#buttonUigu";jQuery(e).showLoading(),Action.ajax(Action.uiguCallback,"save=1")},Action.uiguCallback=function(e){var t=e.responseText,n="#buttonUigu";jQuery(n).hideLoading(),window.open("scripts/compiler.php?asUI="+t,"showUserInterface"),Page.showViewDone()},Action.copyClipboardCode=function(){Action.copyToClp(Page.getUmpleCode()),Page.setFeedbackMessage("Code has been copied to the clipboard")},Action.copyClipboardMixset=function(){Action.copyToClp(Page.copyableMixset),Page.setFeedbackMessage("Mixset with selected diagram filters and options is in clipboard")},Action.copyCommandLineCode=function(){var e=`sh
`;e+=`echo Will compile umple file. Requires umple command to be installed
`,e+=`cd ~/tmp
`,e+=`mkdir testump-$$
`,e+=`cd testump-$$
`,e+=`cat >> test.ump <<ENDUMP
`;var t=`
ENDUMP
`;t+=`umple test.ump -c -
`,t+=`echo Use ctrl-D to exit back to the original shell

`,Action.copyToClp(e+Page.getUmpleCode()+t),Page.setFeedbackMessage("Shell code to compile on command line was copied to clipboard")},Action.showCodeInSeparateWindow=function(){const e=new Date,t=a=>String(a).padStart(2,"0"),o=`// UmpleOnline code as of ${e.getFullYear()+t(e.getMonth()+1)+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())}

`+Page.getUmpleCode();codeWindow=window.open("","UmpleCode","height=700, width=400, left=100, top=100, location=no, status=no, scrollbars=yes"),codeWindow.document.write('<code><pre id="umpleCode">'+o+"</pre></code>"),codeWindow.document.title="Umple raw code",codeWindow.document.close()},Action.showEncodedURLCodeInSeparateWindow=function(){const t=Page.getEncodedURL(),n=t.length;let r="";n>2e3?(r="// WARNING: Encoded URL length ("+n+` characters)
// exceeds recommended limit (2000).
// Use Save & Collaborate for larger models.

`,Page.setFeedbackMessage("Encoded URL too long ("+n+" chars). Use Save & Collaborate instead.")):Page.setFeedbackMessage("Encoded URL generated ("+n+" chars). Ideal for PowerPoint embedding.");const o=r+t;codeWindow=window.open("","UmpleEncodedURL","height=500, width=520, left=100, top=100, location=no, status=no, scrollbars=yes"),codeWindow.document.write('<code><pre id="umpleCode">'+o+"</pre></code>"),codeWindow.document.title="Umple encoded URL",codeWindow.document.close()},Action.simulateCode=function(){simulateButtonSelector="#buttonSimulateCode",jQuery(simulateButtonSelector).showLoading(),Action.ajax(Action.simulateCodeCallback,"language=Simulate")},Action.simulateCodeCallback=function(e){simulateButtonSelector="#buttonSimulateCode",jQuery(simulateButtonSelector).hideLoading();var t=e.responseText;window.open("../umpleonline/simulate.php?model="+t,"umpleSimulator"),Page.showViewDone()},Action.drawInputState=function(e,t,n){var r=document.createElement("div");r.style.zIndex="1000",r.style.border="1px solid #ccc",r.style.backgroundColor="#f8f8f8",r.style.padding="5px",r.style.position="fixed",r.id="promptBox";var o=r.getBoundingClientRect();event.clientX+o.width>window.innerWidth?r.style.right=window.innerWidth-event.clientX+"px":r.style.left=event.clientX+"px",event.clientY+o.height>window.innerHeight?r.style.bottom=window.innerHieght-event.clientY+"px":r.style.top=event.clientY+"px";var a=document.createElement("input");a.type="text",a.style.padding="5px",a.style.borderRadius="3px",a.style.border="1px solid #ccc",a.style.width="200px",a.style.marginLeft="5px";var s=document.createElement("label");s.type="label",s.textContent="Error - Please enter an alphanumeric name beginning with a non-numeric character.",s.style.color="red";var c=function f(g){document.contains(r)&&g.target!=r&&!r.contains(g.target)&&(document.removeEventListener("mousedown",f),r.remove())},d=t.replaceAll("&#10",`
`).replaceAll("&#$quot",'"'),u=document.createElement("label");u.htmlFor="inputLabel",u.style.marginRight="5px",document.addEventListener("mousedown",c),e=="rename"?(clientDebuggerFlag&&console.log("Renaming State ..."),u.appendChild(document.createTextNode("New name for '"+n+"'?")),a.value=n,a.addEventListener("keydown",function(f){if(f.key==="Enter")if(Action.validateAttributeName(a.value)){clientDebuggerFlag&&console.log("Getting code from codemirror editor ...");let g=Page.codeMirrorEditor6.state.doc.toString(),h=new RegExp("(\\W+)("+n+")(\\W+)"),b;for(;(b=g.match(h))!=null;)g=g.substr(0,b.index+b[1].length)+a.value.trim()+g.substr(b.index+b[1].length+b[2].length,g.length-(b.index+b[1].length+b[2].length));clientDebuggerFlag&&console.log("Setting updated code to codemirror editor ..."),Page.setCodeMirror6Text(g),setTimeout('Action.processTyping("newEditor",false)',Action.waiting_time),document.removeEventListener("mousedown",c),clientDebuggerFlag&&console.log("Removing mousedown event ..."),r.remove(),Action.removeContextMenu(),TabControl.getCurrentHistory().save(g,"menuUpdate")}else document.contains(s)||r.appendChild(s)})):e=="substate"?(clientDebuggerFlag&&console.log("Substating state ..."),u.appendChild(document.createTextNode("Name of new substate?")),a.addEventListener("keydown",function(f){if(f.key==="Enter")if(Action.validateAttributeName(a.value)){let g=d.substr(0,d.length-1)+"  "+a.value+"{}}";clientDebuggerFlag&&console.log("Getting original code and adding substate ..."),g=Page.codeMirrorEditor6.state.doc.toString().replace(d,g),clientDebuggerFlag&&console.log("Setting updated code with substate into codemirror editor ..."),Page.setCodeMirror6Text(g),setTimeout('Action.processTyping("newEditor",false)',Action.waiting_time),document.removeEventListener("mousedown",c),clientDebuggerFlag&&console.log("Removing mousedown event ..."),r.remove(),Action.removeContextMenu(),TabControl.getCurrentHistory().save(g,"menuUpdate")}else document.contains(s)||r.appendChild(s)})):e=="transition"&&(clientDebuggerFlag&&console.log("Adding Transition ..."),u.appendChild(document.createTextNode("Condition for new transition?")),a.addEventListener("keydown",function(f){if(f.key==="Enter")if(Action.validateAttributeName(a.value)){var g=t.replaceAll("&#10",`
`).replaceAll("&#$quot",'"');document.removeEventListener("mousedown",c),r.remove(),Action.removeContextMenu(),clientDebuggerFlag&&console.log("Waiting to select target state for transition ...");var h=function(E){let S=E.target;for(;S.parentElement.id!="graph0";)S=S.parentNode;let D=S.outerHTML.substr(S.outerHTML.indexOf("stateClicked(&quot;")+19,S.outerHTML.indexOf('&quot;)"')-(S.outerHTML.indexOf("stateClicked(&quot;")+19));D=D.split("^*^");let j="  "+a.value+" -> "+D[2]+`;
}`,p=g.substr(0,g.length-1)+j;clientDebuggerFlag&&(console.log("New state created ..."),console.log("Replacing original state with new state in the code ...")),Page.setCodeMirror6Text(Page.codeMirrorEditor6.state.doc.toString().replace(g,p)),setTimeout('Action.processTyping("newEditor",false)',Action.waiting_time),TabControl.getCurrentHistory().save(Page.codeMirrorEditor6.state.doc.toString(),"menuUpdate");let C=document.getElementsByClassName("node");for(let M=0;M<C.length;M++)C[M].removeEventListener("mousedown",h);b=document.getElementsByClassName("cluster");for(let M=0;M<C.length;M++)C[M].removeEventListener("mousedown",h)},b=document.getElementsByClassName("node");for(let E=0;E<b.length;E++)b[E].addEventListener("mousedown",h);b=document.getElementsByClassName("cluster");for(let E=0;E<b.length;E++)b[E].addEventListener("mousedown",h)}else document.contains(s)||r.appendChild(s)})),r.appendChild(u),r.appendChild(a),document.body.appendChild(r),a.focus()},Action.deleteState=function(e,t,n,r){let o=r.split(",");clientDebuggerFlag&&console.log("Getting code from codemirror editor ...");let a=Page.codeMirrorEditor6.state.doc.toString();clientDebuggerFlag&&console.log("Deleting State: ",r);let s=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"');a=a.replace(s,"");let c=new RegExp("[^{};]*->\\s*([^\\S\\s]*|\\s*)(\\/\\s*{[^}]*})*([^\\S\\s]*|\\s*)("+o[o.length-1]+")(\\s+\\w+)*\\s*;"),d;for(;(d=a.match(c))!=null;)a=a.substr(0,d.index)+a.substr(d.index+d[0].length,a.length-(d.index+d[0].length));clientDebuggerFlag&&console.log("Setting updated code to codemirror editor ..."),Page.setCodeMirror6Text(a),setTimeout('Action.processTyping("newEditor",false)',Action.waiting_time),TabControl.getCurrentHistory().save(a,"menuUpdate"),Action.removeContextMenu()},Action.drawStateMenu=function(){if(Action.diagramInSync){Action.removeContextMenu();for(var e=event.target;e.parentElement.id!="graph0";)e=e.parentNode;var t=e.outerHTML.substr(e.outerHTML.indexOf("stateClicked(&quot;")+19,e.outerHTML.indexOf('&quot;)"')-(e.outerHTML.indexOf("stateClicked(&quot;")+19));t=t.split("^*^"),t[2]=t[2].split(".");var n=Page.codeMirrorEditor6.state.doc.toString(),r=Action.selectStateInClassCM6(t[0],t[1],t[2][0]);for(let h=1;h<t[2].length;h++)r=Action.selectStateInStateCM6(r.startIndex,r.endIndex,t[2][h]);var o=n.substr(r.startIndex,r.endIndex-r.startIndex);if(typeof o=="string"){var a=document.createElement("customContextMenu"),s=["Rename State","Delete State","Add Substate","Add Transition"],c=o.replaceAll(`
`,"&#10").replaceAll('"',"&#$quot"),d=['Action.drawInputState("rename","'+c+'","'+t[2][t[2].length-1]+'")','Action.deleteState("'+c+'","'+t[0]+'","'+t[1]+'","'+t[2]+'")','Action.drawInputState("substate","'+c+'","'+t[2][t[2].length-1]+'")','Action.drawInputState("transition","'+c+'","'+t[2][t[2].length-1]+'")'];a.style.zIndex="1000",a.style.border="1px solid #ccc",a.style.backgroundColor="#f8f8f8",a.style.padding="5px",a.style.position="fixed";for(var u=0;u<s.length;u++){var f=document.createElement("div");f.style.padding="5px",f.style.borderRadius="3px",f.style.cursor="pointer",f.style.transition="background-color 0.3s",f.textContent=s[u],f.setAttribute("onclick","javascript:"+d[u]),f.addEventListener("mouseover",function(){this.style.backgroundColor="#ddd"}),f.addEventListener("mouseout",function(){this.style.backgroundColor="transparent"}),a.appendChild(f)}var g=a.getBoundingClientRect();event.clientX+g.width>window.innerWidth?a.style.right=window.innerWidth-event.clientX+"px":a.style.left=event.clientX+"px",event.clientY+g.height>window.innerHeight?a.style.bottom=window.innerHieght-event.clientY+"px":a.style.top=event.clientY+"px",document.addEventListener("mousedown",function h(b){var E=document.getElementById("promptBox");b.target!=a&&!a.contains(b.target)&&(E!=null&&b.target!=E&&E.contains(b.target),document.removeEventListener("mousedown",h),Action.removeContextMenu())}),document.body.appendChild(a)}}},Action.displayTransitionMenu=function(e){if(!Action.diagramInSync)return;Action.removeContextMenu();for(var t=e.target;t.parentElement.id!="graph0";)t=t.parentNode;var n=t.outerHTML.substr(t.outerHTML.indexOf("transitionClicked(&quot;")+24,t.outerHTML.indexOf('&quot;)"')-(t.outerHTML.indexOf("transitionClicked(&quot;")+24));n=n.replaceAll("&amp;","&");let r=n.split("*^*"),o=r[3].split(".");dest=r[4].split(".");for(var a=Action.selectStateInClassCM6(r[0],r[1],o[0]),s=1;s<o.length;s++)a=Action.selectStateInStateCM6(a.startIndex,a.endIndex,o[s]);let c=r[2].replaceAll("+","\\+").replaceAll("-","\\-").replaceAll("*","\\*").replaceAll("?","\\?").replaceAll("|","\\|");if(c=c.replace("after","after~`~?:Every`~`?"),r[5]!=""){let U=r[5].trim().replaceAll("+","\\+").replaceAll("-","\\-").replaceAll("*","\\*").replaceAll("?","\\?").replaceAll("|","\\|");c=c+"\\s*[\\s*"+U.trim().slice(1,U.trim().length-1)+"\\s*]"}c=c.replaceAll("]","\\]").replaceAll("[","\\[").replaceAll(")","\\)?").replaceAll("(","\\(?").replaceAll("~`~","(").replaceAll("`~`",")").replaceAll(" ","\\s*").replaceAll(",","\\s*,\\s*").replaceAll("!","\\s*!\\s*").replaceAll("/","\\s*/\\s*"),c=c.replaceAll("&&","&{1,2}");let d=new RegExp(c+".*->","s"),u=Page.codeMirrorEditor6.state.doc.toString().substr(a.startIndex,a.endIndex-a.startIndex).search(d)+a.startIndex,f=Page.codeMirrorEditor6.state.doc.toString().substr(u),g=Action.findEOL(f);if(g.split("->").length-1!==1){Page.setFeedbackMessage(" Please edit this complex transition in the textual code.");return}let h=u+g.length,b=Page.codeMirrorEditor6.state.doc.toString().substring(u,h),E=new RegExp("^(.*?)(\\s*\\[(.*?)\\])?(\\s*\\/\\s*\\{(.*?)\\})?\\s*->\\s*(\\[(.*?)\\])?(\\s*\\/\\s*\\{(.*?)\\})?\\s*(\\w+);?$","s");const S=b.trim().match(E);let D=S[1].trim(),j=S[3]?S[3].trim():S[7]?S[7].trim():null,p=S[5]?S[5].trim():S[9]?S[9].trim():null,C=S[10].trim();j===null&&(j=""),p===null&&(p="");var M=document.createElement("customContextMenu"),_=["Change or Add Event Name","Change or Add Guard","Change or Add Action","Change Destination State","Delete Transition"],T=['Action.modifyTransitionEventName("'+u+'","'+h+'")','Action.modifyTransitionGuard("'+u+'","'+h+'")','Action.modifyTransitionAction("'+u+'","'+h+'")','Action.changeTransition("'+C+'","'+u+'","'+h+'")','Action.deleteTransition("'+u+'","'+h+'")'];M.style.zIndex="1000",M.style.border="1px solid #ccc",M.style.backgroundColor="#f8f8f8",M.style.padding="5px",M.style.position="fixed";for(var s=0;s<_.length;s++){var P=document.createElement("div");P.style.padding="5px",P.style.borderRadius="3px",P.style.cursor="pointer",P.style.transition="background-color 0.3s",P.textContent=_[s],P.setAttribute("onclick","javascript:"+T[s]),P.addEventListener("mouseover",function(){this.style.backgroundColor="#ddd"}),P.addEventListener("mouseout",function(){this.style.backgroundColor="transparent"}),M.appendChild(P)}var k=M.getBoundingClientRect();e.clientX+k.width>window.innerWidth?M.style.right=window.innerWidth-e.clientX+"px":M.style.left=e.clientX+"px",e.clientY+k.height>window.innerHeight?M.style.bottom=window.innerHieght-e.clientY+"px":M.style.top=e.clientY+"px",document.addEventListener("mousedown",function U(N){var R=document.getElementById("promptBox");N.target!=M&&!M.contains(N.target)&&(R!=null&&N.target!=R&&R.contains(N.target),document.removeEventListener("mousedown",U),Action.removeContextMenu())}),document.addEventListener("keydown",function U(N){var R=document.getElementById("promptBox");N.target!=M&&!M.contains(N.target)&&N.key==="Escape"&&(R!=null&&N.target!=R&&R.contains(N.target),document.removeEventListener("keydown",U),Action.removeContextMenu())}),document.body.appendChild(M)},Action.changeTransition=function(e,t,n){let a=Page.codeMirrorEditor6.state.doc.toString().substring(t,n).trim().replace(/;$/,"").split("->");if(a[0]=a[0].trim(),a[1]=a[1].trim(),a.length!=2){console.log("Invalid transition format.");return}var s=document.createElement("div");s.style.zIndex="1000",s.style.border="1px solid #ccc",s.style.backgroundColor="#f8f8f8",s.style.padding="5px",s.style.position="absolute",s.style.left="50%",s.style.top="50%",s.style.transform="translate(-50%, -50%)",s.id="promptBox";var c=document.createElement("input");c.type="text",c.value=a[1],c.style.padding="5px",c.style.margin="5px",c.style.width="200px";var d=document.createElement("button");d.textContent="Change Destination",d.style.padding="5px",d.style.marginLeft="5px",s.appendChild(c),s.appendChild(d),document.body.appendChild(s),c.focus();var u=function f(g){document.contains(s)&&g.target!=s&&!s.contains(g.target)&&(document.removeEventListener("mousedown",f),s.remove())};document.addEventListener("mousedown",u),document.addEventListener("keydown",function(f){f.key==="Escape"&&(s.remove(),document.removeEventListener("keydown",arguments.callee))}),d.addEventListener("click",function(){if(c.value.trim()===""){console.log("Input for new destination state is empty.");return}let f=a[0]+" -> "+a[1].replace(e,c.value.trim())+";",g=Page.codeMirrorEditor6.state.doc.toString(),h=g.substring(0,t),b=g.substring(n),E=h+f+b;Page.setCodeMirror6Text(E),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"changeTransitionDestination"),document.removeEventListener("mousedown",u),s.remove(),Action.selectMatchingText(f)}),c.addEventListener("keydown",function(f){f.key==="Enter"&&(f.preventDefault(),f.stopPropagation(),d.click())})},Action.deleteTransition=function(e,t){let n=Page.codeMirrorEditor6.state.doc.toString().substring(e,t),r=Page.codeMirrorEditor6.state.doc.toString();r=r.replace(n,""),Page.setCodeMirror6Text(r),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate")},Action.modifyTransitionGuard=function(e,t){let n=new RegExp("^(.*?)(\\s*\\[(.*?)\\])?(\\s*\\/\\s*\\{(.*?)\\})?\\s*->\\s*(\\[(.*?)\\])?(\\s*\\/\\s*\\{(.*?)\\})?\\s*(\\w+);?$","s"),r=Page.codeMirrorEditor6.state.doc.toString().substring(e,t);const o=r.trim().match(n);let a=o[1].trim(),s=o[3]?o[3].trim():o[7]?o[7].trim():null,c=o[5]?o[5].trim():o[9]?o[9].trim():null,d=o[10].trim();s===null&&(s=""),c===null&&(c="");var u=document.createElement("div");u.style.zIndex="1000",u.style.border="1px solid #ccc",u.style.backgroundColor="#f8f8f8",u.style.padding="5px",u.style.position="absolute",u.style.left="50%",u.style.top="50%",u.style.transform="translate(-50%, -50%)",u.id="promptBox";var f=document.createElement("input");f.type="text",f.value=s,f.style.padding="5px",f.style.margin="5px",f.style.width="200px";var g=document.createElement("button");g.textContent="Change/Add Guard",g.style.padding="5px",g.style.marginLeft="5px",u.appendChild(f),u.appendChild(g),document.body.appendChild(u),f.focus();var h=function b(E){document.contains(u)&&E.target!=u&&!u.contains(E.target)&&(document.removeEventListener("mousedown",b),u.remove())};document.addEventListener("mousedown",h),document.addEventListener("keydown",function(b){b.key==="Escape"&&(u.remove(),document.removeEventListener("keydown",arguments.callee))}),g.addEventListener("click",function(){let E=r.trim().split("->");if(E[0]=E[0].trim(),E[1]=E[1].trim(),E.length!=2){console.log("Invalid transition format.");return}let S="";if(f.value.trim()===""){if(s===null||s==="")return;pattern=new RegExp("\\[\\s*(.*?)\\s*\\]","g"),S=r.replace(pattern,"")}else s===null||s===""?(c==null||c===""||E[1].includes(c)?E[0]=a+" ["+f.value.trim()+"]":E[0]=a+" ["+f.value.trim()+"] /{"+c+"}",S=E[0]+" -> "+E[1]):S=r.replace(s,f.value.trim());let D=Page.codeMirrorEditor6.state.doc.toString(),j=D.substring(0,e),p=D.substring(t),C=j+S+p;Page.setCodeMirror6Text(C),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"modifyGuard"),document.removeEventListener("mousedown",h),u.remove(),Action.selectMatchingText(S)}),f.addEventListener("keydown",function(b){b.key==="Enter"&&(b.preventDefault(),b.stopPropagation(),g.click())})},Action.modifyTransitionAction=function(e,t){let n=new RegExp("^(.*?)(\\s*\\[(.*?)\\])?(\\s*\\/\\s*\\{(.*?)\\})?\\s*->\\s*(\\[(.*?)\\])?(\\s*\\/\\s*\\{(.*?)\\})?\\s*(\\w+);?$","s"),r=Page.codeMirrorEditor6.state.doc.toString().substring(e,t);const o=r.trim().match(n);let a=o[3]?o[3].trim():o[7]?o[7].trim():null,s=o[5]?o[5].trim():o[9]?o[9].trim():null;a===null&&(a=""),s===null&&(s="");var c=document.createElement("div");c.style.zIndex="1000",c.style.border="1px solid #ccc",c.style.backgroundColor="#f8f8f8",c.style.padding="5px",c.style.position="absolute",c.style.left="50%",c.style.top="50%",c.style.transform="translate(-50%, -50%)",c.id="promptBox";var d=document.createElement("textarea");d.style.width="300px",d.style.height="100px",d.value=s||"";var u=document.createElement("button");u.textContent="Change/Add Action",u.style.padding="5px",u.style.marginLeft="5px",c.appendChild(d),c.appendChild(u),document.body.appendChild(c),d.focus();var f=function g(h){document.contains(c)&&h.target!=c&&!c.contains(h.target)&&(document.removeEventListener("mousedown",g),c.remove())};document.addEventListener("mousedown",f),document.addEventListener("keydown",function(g){g.key==="Escape"&&(c.remove(),document.removeEventListener("keydown",arguments.callee))}),u.addEventListener("click",function(){let h=r.trim().split("->");if(h[0]=h[0].trim(),h[1]=h[1].trim(),h.length!=2){console.log("Invalid transition format.");return}let b="";if(d.value.trim()===""){if(s===null||s==="")return;pattern=new RegExp("/\\s*\\{.*?\\}\\s*->","g"),b=r.replace(pattern," ->")}else s===null||s===""?b=h[0]+"/{"+d.value.trim()+"} -> "+h[1]:b=r.replace(s,d.value.trim());let E=Page.codeMirrorEditor6.state.doc.toString(),S=E.substring(0,e),D=E.substring(t),j=S+b+D;Page.setCodeMirror6Text(j),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"modifyAction"),document.removeEventListener("mousedown",f),c.remove(),Action.selectMatchingText(b)}),input.addEventListener("keydown",function(g){g.key==="Enter"&&(g.preventDefault(),g.stopPropagation(),u.click())})},Action.modifyTransitionEventName=function(e,t){let n=Page.codeMirrorEditor6.state.doc.toString().substring(e,t),r=new RegExp("^(.*?)\\s*(\\[(.*?)\\])?\\s*(\\/\\s*\\{(.*?)\\})?\\s*->\\s*(\\w+);?$","s");const o=n.match(r);let a=o[1].trim(),s=o[3]?o[3].trim():null,c=o[5]?o[5].trim():null,d=o[6].trim();var u=document.createElement("div");u.style.zIndex="1000",u.style.border="1px solid #ccc",u.style.backgroundColor="#f8f8f8",u.style.padding="5px",u.style.position="absolute",u.style.left="50%",u.style.top="50%",u.style.transform="translate(-50%, -50%)",u.id="promptBox";var f=document.createElement("input");f.type="text",f.value=a,f.style.padding="5px",f.style.margin="5px",f.style.width="200px";var g=document.createElement("button");g.textContent="Change/Add Event Name",g.style.padding="5px",g.style.marginLeft="5px",u.appendChild(f),u.appendChild(g),document.body.appendChild(u),f.focus();var h=function b(E){document.contains(u)&&E.target!=u&&!u.contains(E.target)&&(document.removeEventListener("mousedown",b),u.remove())};document.addEventListener("mousedown",h),document.addEventListener("keydown",function(b){b.key==="Escape"&&(u.remove(),document.removeEventListener("keydown",arguments.callee))}),g.addEventListener("click",function(){if(f.value.trim()===""){console.log("Input for new transition condition is empty.");return}let b=n.replace(a,f.value.trim()),E=Page.codeMirrorEditor6.state.doc.toString(),S=E.substring(0,e),D=E.substring(t),j=S+b+D;Page.setCodeMirror6Text(j),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"renameTransition"),document.removeEventListener("mousedown",h),u.remove(),Action.selectMatchingText(b)}),f.addEventListener("keydown",function(b){b.key==="Enter"&&(b.preventDefault(),b.stopPropagation(),g.click())})},Action.removeContextMenu=function(){var e=document.getElementsByTagName("customContextMenu");e.length!=0&&e.item(0).remove()},Action.setColor=function(e,t,n){let r=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"');if(r.includes("displayColor")){let o="displayColor "+n+";",a=new RegExp("displayColor\\s+.*;");o=r.replace(a,o),Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:Page.codeMirrorEditor6.state.doc.toString().replace(r,o)}}),setTimeout(function(){TabControl.getCurrentHistory().save(Page.getUmpleCode(),"setColor")},100)}else{let o="{  displayColor "+n+`;
`;o=r.substr(0,r.indexOf("{"))+o+r.substr(r.indexOf("{")+1,r.length-r.indexOf("{")-1),Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:Page.codeMirrorEditor6.state.doc.toString().replace(r,o)}})}},Action.filterOnOneClass=function(e){var t=e+" 1";Action.setFilterFull(t,!0),jQuery("#filtervalues").val(t),Action.removeContextMenu()},Action.clearFilterOnOneClass=function(e){Page.filterWordsOutput=Page.filterWordsOutput.replace(`${e}!@`,""),Action.setFilterFull(Page.filterWordsOutput.trim(),!0);let t=jQuery("#filtervalues").val();if(t.length-e.length<2)jQuery("#filtervalues").val("*");else{let n=t.replace(e,"");jQuery("#filtervalues").val(n)}Action.removeContextMenu()},Action.hideClass=function(e){Page.filterWordsOutput.includes("*")?Action.setFilterFull(`~${e}`,!0):Action.setFilterFull(Page.filterWordsOutput+"~"+e,!0);var t=jQuery("#filtervalues").val();if(t.includes("*")){let n="~"+e;jQuery("#filtervalues").val(n)}else jQuery("#filtervalues").val(t+" ~"+e);Action.removeContextMenu()},Action.unHideClasses=function(){let e=Action.removeHiddenClasses(Page.filterWordsOutput),t=Action.removeHiddenClasses(jQuery("#filtervalues").val());Action.setFilterFull(e,!0),jQuery("#filtervalues").val(t),Action.removeContextMenu()},Action.removeHiddenClasses=function(e){const t=/~\w+!?@?/g;return e.replace(t,"").replace(/\s+/g,"").trim()},Action.getGvPosition=function(e,t){var n=new RegExp("class[\\s]*"+t+"[\\s]{([\\sa-zA-Z\\:\\.\\,\\;\\-\\_0-9]*)\\s*position ([\\d.]*) ([\\d.]*) ([\\d.]*) ([\\d.]*);([\\sa-zA-Z\\:\\.\\,\\;\\-\\_0-9]*)}","s"),r=e.match(n);if(r==null)return null;var o={all:r[0],assoc1:r[1],x:r[2],y:r[3],width:r[4],height:r[5],assoc2:r[6]};return o},Action.updateGvPosition=function(e,t,n){var r=jQuery("#umpleLayoutEditorText").val(),o=Action.getGvPosition(r,e);if(o==null)return null;var a=o.all,s=o.x,c=o.y,d=o.assoc1,u=o.assoc2;return Action.updateGVPositionBasic(e,t,n,r,a,s,c,d,u,!0)},Action.updateGVPositionBasic=function(e,t,n,r,o,a,s,c,d,u){var f=Math.round(Math.max(Number(a)+t,5)),g=Math.round(Math.max(Number(s)+n,5)),h=o.replace("position "+a+" "+s,"position "+f+" "+g);c!=null&&(h=h.replace(""+c,`
`)),d!=null&&(h=h.replace(""+d,`
`)),Page.setUmplePositioningCode(r.replace(o,h)),u&&(setTimeout(function(){TabControl.getCurrentHistory().save(Page.getUmpleCode(),"moveClass")},100),Action.redrawDiagram())},Action.drawInput=function(e,t,n,r){var o=document.createElement("div");o.style.zIndex="1000",o.style.border="1px solid #ccc",o.style.backgroundColor="#f8f8f8",o.style.padding="5px",o.style.position="fixed",o.id="promptBox";var a=o.getBoundingClientRect();event.clientX+a.width>window.innerWidth?o.style.right=window.innerWidth-event.clientX+"px":o.style.left=event.clientX+"px",event.clientY+a.height>window.innerHeight?o.style.bottom=window.innerHeight-event.clientY+"px":o.style.top=event.clientY+"px";var s=document.createElement("input");s.type="text",s.style.padding="5px",s.style.borderRadius="3px",s.style.border="1px solid #ccc",s.style.width="200px",s.style.marginLeft="5px";var c=document.createElement("label");c.type="label",c.textContent="Error - Please enter an alphanumeric name.",c.style.color="red";var d=function _(T){document.contains(o)&&T.target!=o&&!o.contains(T.target)&&(document.removeEventListener("mousedown",_),o.remove())};if(document.addEventListener("mousedown",d),e=="attri"){var u=document.createElement("select"),f=document.createElement("option");f.value="String",f.text="String";var g=document.createElement("option");g.value="Integer",g.text="Integer";var h=document.createElement("option");h.value="Double",h.text="Double";var b=document.createElement("option");b.value="Float",b.text="Float";var E=document.createElement("option");E.value="Boolean",E.text="Boolean";var S=document.createElement("option");S.value="Date",S.text="Date";var D=document.createElement("option");D.value="Time",D.text="Time",u.add(f),u.add(g),u.add(h),u.add(b),u.add(E),u.add(S),u.add(D),o.appendChild(u);var s=document.createElement("input");s.type="text",s.style.padding="5px",s.style.borderRadius="3px",s.style.border="1px solid #ccc",s.style.width="200px",s.style.marginLeft="5px",s.addEventListener("keydown",function(T){if(T.key==="Enter")if(Action.validateAttributeName(s.value)){let P=t.replaceAll("&#10",`
`).replaceAll("&#$quot",'"'),k;if(s.value.includes(":")){let R=s.value.split(":");k=P.substr(0,P.length-1)+"  "+R[1].trim()+" "+R[0].trim()+`;
}`}else k=P.substr(0,P.length-1)+"  "+u.value+" "+s.value+`;
}`;const U=Page.codeMirrorEditor6.state.doc.length,N=Page.codeMirrorEditor6.state.doc.toString().replace(P,k);Page.codeMirrorEditor6.dispatch({changes:{from:0,to:U,insert:N}}),document.removeEventListener("mousedown",d),o.remove(),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate")}else document.contains(c)||o.appendChild(c)}),o.appendChild(s)}else if(e=="rename"){var j=document.createElement("label");j.htmlFor="replace-all-checkbox",j.style.marginRight="5px",j.appendChild(document.createTextNode("New name for '"+n+"'?")),s.value=n,s.addEventListener("keydown",function(_){if(_.key==="Enter")if(Action.validateAttributeName(s.value)){let P=Page.codeMirrorEditor6.state.doc.toString();P=Action.renameClassAssistant(P,n,s.value.trim()),Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:P}});var T=jQuery("#umpleLayoutEditorText").val();T=Action.renameClassAssistant(T,n,s.value.trim()),Page.setUmplePositioningCode(T),document.removeEventListener("mousedown",d),o.remove(),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate")}else document.contains(c)||o.appendChild(c)}),o.appendChild(j),o.appendChild(s)}else if(e=="subclass")s.addEventListener("keydown",function(_){if(_.key==="Enter")if(Action.validateAttributeName(s.value)){let T=`
class `+s.value+`
{
  isA `+n+`;
}
`;Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:Page.codeMirrorEditor6.state.doc.toString()+T}}),document.removeEventListener("mousedown",d),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate"),o.remove(),Action.removeContextMenu()}else document.contains(c)||o.appendChild(c)}),o.appendChild(s);else if(e=="color"){var p=document.createElement("label");p.textContent="Color - ";var C=document.createElement("span");C.innerHTML="&#8594;",C.style.cursor="pointer",C.fontSize="20px",C.style.paddingLeft="5px",s.style.width="30px",s.style.height="30px",s.type="color";var M=function _(T){T.key==="Enter"&&(document.removeEventListener("keydown",_),Action.setColor(t,n,s.value),o.remove(),Action.removeContextMenu())};document.addEventListener("keydown",M),C.addEventListener("click",function(){Action.setColor(t,n,s.value),document.removeEventListener("keydown",M),o.remove(),Action.removeContextMenu()}),C.addEventListener("mouseover",function(){C.style.color="blue"}),C.addEventListener("mouseout",function(){C.style.color="black"}),o.appendChild(p),o.appendChild(s),o.appendChild(C)}else e=="assoc"&&r.forEach(_=>{var T=document.createElement("p");T.textContent=_,T.style.width="100px",T.style.padding="5px",T.style.borderRadius="3px",T.style.margin="0px",T.style.cursor="pointer",T.onclick=()=>{Action.filterOnOneClass(_),o.remove()},T.addEventListener("mouseover",function(){this.style.backgroundColor="#ddd"}),T.addEventListener("mouseout",function(){this.style.backgroundColor="transparent"}),o.appendChild(T)});document.body.appendChild(o),s.focus()},Action.renameClassAssistant=function(e,t,n){let r=e,o=new RegExp("(\\W+)("+t+")(\\W+)"),a;for(;(a=r.match(o))!=null;)r=r.substr(0,a.index+a[1].length)+n+r.substr(a.index+a[1].length+a[2].length,r.length-(a.index+a[1].length+a[2].length));return r},Action.deleteClass=function(e,t){let n=Page.codeMirrorEditor6.state.doc.toString();n=n.replace(e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"'),"");let r=new RegExp(".*\\s*(-|<)(>|-)\\s*.*\\s*"+t+"(\\s+\\w+)*\\s*;"),o;for(;(o=n.match(r))!=null;)n=n.substr(0,o.index)+n.substr(o.index+o[0].length,n.length-(o.index+o[0].length));for(r=new RegExp(".*"+t+"\\s*(<|-)(>|-)\\s*.*\\s+\\w+;");(o=n.match(r))!=null;)n=n.substr(0,o.index)+n.substr(o.index+o[0].length,n.length-(o.index+o[0].length));if(r=new RegExp("isA\\s+"+t),n.match(r)!=null){let a=new RegExp("isA\\s+(\\w+);"),s;if((s=e.match(a))!=null){let c="isA "+s[1]+";";for(;(o=n.match(r))!=null;)n=n.substr(0,o.index)+c+n.substr(o.index+o[0].length+1,n.length-(o.index+o[0].length+1))}else for(;(o=n.match(r))!=null;)n=n.substr(0,o.index)+n.substr(o.index+o[0].length+1,n.length-(o.index+o[0].length+1))}for(r=new RegExp("associationClass\\s+\\w+\\s*\\n*{(\\n*\\W*\\w*;)*(\\s*CRUD_Value\\s*{(\\s*\\w*\\s*,*)*}\\s*\\n*)*(\\n*\\W*\\w*;)*([\\s|\\t]*[*]\\s+"+t+";)(\\n*\\W*\\w*;)*(\\s*CRUD_Value\\s*{(\\s*\\w*\\s*,*)*}\\s*\\n*)*(\\n*\\W*\\w*)*?}"),o=null;(o=n.match(r))!=null;)n=n.substr(0,o.index)+n.substr(o.index+o[0].length,n.length-(o.index+o[0].length));Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:n}}),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate")},Action.addAssociationGv=function(e,t){var n=document.getElementsByClassName("node"),r=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"');Action.removeContextMenu();for(let o=0;o<n.length;o++)n[o].addEventListener("mousedown",function a(s){for(var c=s.target;c.parentElement.id!="graph0";)c=c.parentNode;c=c.outerHTML.substr(c.outerHTML.indexOf("&nbsp;"),c.outerHTML.indexOf("</text>")-c.outerHTML.indexOf("&nbsp;")).replaceAll("&nbsp;","").trim();let d="  * -> 1 "+c+`;
}
`,u=r.substr(0,r.length-1)+d;Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:Page.codeMirrorEditor6.state.doc.toString().replace(r,u)}}),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate");let f=document.getElementsByClassName("node");for(let g=0;g<f.length;g++)f[g].removeEventListener("mousedown",a)})},Action.getGvClassName=function(e){return Action.getGvClassNameFromNode(e.target)},Action.getGvClassNameFromNode=function(e){for(;e.parentElement.id!="graph0";)e=e.parentNode;return e=e.outerHTML.substr(e.outerHTML.indexOf("&nbsp;"),e.outerHTML.indexOf("</text>")-e.outerHTML.indexOf("&nbsp;")).replaceAll("&nbsp;","").trim(),e},Action.displayMenu=function(e){if(Action.diagramInSync){Action.removeContextMenu();var t=Action.getGvClassName(e),n=Page.codeMirrorEditor6.state.doc.toString(),r=Action.splitStates(n);for(let j=0;j<r.length;j++)(r[j].startsWith("class "+t+"{")||r[j].startsWith("class "+t+" ")||r[j].startsWith("class "+t+`
`))&&(r=r[j]);if(typeof r=="string"){var o=document.createElement("customContextMenu"),a=["Add Attribute","Rename Class","Delete Class","Add Subclass","Add Association","Change Color","Focus on this class","Do not show this class"],s=r.replaceAll(`
`,"&#10").replaceAll('"',"&#$quot"),c=['Action.drawInput("attri","'+s+'","'+t+'")','Action.drawInput("rename","'+s+'","'+t+'")','Action.deleteClass("'+s+'","'+t+'")','Action.drawInput("subclass","'+s+'","'+t+'")','Action.addAssociationGv("'+s+'","'+t+'")','Action.drawInput("color","'+s+'","'+t+'")','Action.filterOnOneClass("'+t+'")','Action.hideClass("'+t+'")'],d=jQuery("#umpleLayoutEditorText").val(),u=[],f=[],g=document.getElementsByClassName("node");for(let j=0;j<g.length;j++){var h=Action.getGvClassNameFromNode(g[j]);u.push(h)}var b=Action.neighbors[t];f=b.filter(j=>!u.includes(j)),f.length>0&&(a.push("Show Associations to:"),c.push('Action.drawInput("assoc",null,null,'+JSON.stringify(f)+")")),Page.filterWordsOutput.length>0&&Page.filterWordsOutput.split("!@").forEach(function(j){j.toLowerCase()==t.toLowerCase()&&(a=a.filter(p=>!p.includes("Focus on this class")),a.push("Remove Focus"),c=c.filter(p=>!p.includes("Action.filterOnOneClass")),c.push('Action.clearFilterOnOneClass("'+t+'")'),a=a.filter(p=>!p.includes("Do not show this class")),c=c.filter(p=>!p.includes("Action.hideClass"))),j.includes("~")&&(a.includes("Unhide Class(es)")||(a.push("Unhide Class(es)"),c.push("Action.unHideClasses()")))}),o.style.zIndex="1000",o.style.border="1px solid #ccc",o.style.backgroundColor="#f8f8f8",o.style.padding="5px",o.style.position="fixed";for(var E=0;E<a.length;E++){var S=document.createElement("div");S.style.padding="5px",S.style.borderRadius="3px",S.style.cursor="pointer",S.style.transition="background-color 0.3s",S.textContent=a[E],S.setAttribute("onclick","javascript:"+c[E]),S.addEventListener("mouseover",function(){this.style.backgroundColor="#ddd"}),S.addEventListener("mouseout",function(){this.style.backgroundColor="transparent"}),o.appendChild(S)}var D=o.getBoundingClientRect();e.clientX+D.width>window.innerWidth?o.style.right=window.innerWidth-e.clientX+"px":o.style.left=e.clientX+"px",e.clientY+D.height>window.innerHeight?o.style.bottom=window.innerHieght-e.clientY+"px":o.style.top=e.clientY+"px",document.addEventListener("mousedown",function j(p){var C=document.getElementById("promptBox");p.target!=o&&!o.contains(p.target)&&(C!=null&&p.target!=C&&C.contains(p.target),document.removeEventListener("mousedown",j),Action.removeContextMenu())}),document.body.appendChild(o)}}},Action.isWithinRadarZone=function(e,t,n,r=100){var o=Action.getGvPosition(e,t),a=Action.getGvClassNameFromNode(n),s=Action.getGvPosition(e,a);const c=Math.abs(s.x-o.x)<=r,d=Math.abs(s.y-o.y)<=r;return c&&d},Action.displayAssociMenu=function(e,t){const n=/Action\.selectAssociation\('([^']+)'\)/,r=t.match(n);let o=Action.selectAssociation(r[1]);var a=r[1].split(",");if(a.length==4)var s=a[1].trim(),c=a[0].trim(),d=a[2].split(" "),u=a[3].split(" ");else var s=a[1].trim(),d=a[2].split(" "),u=a[2].split(" "),c=a[0].trim();var f=new RegExp("(associationClass|class|interface|trait) "+c+"($|\\s|[{])"),g=new RegExp("(class|interface|trait) [A-Za-z]");if(Page.codeMirrorOn){var h=Action.selectItemCM6(f),b=Page.codeMirrorEditor6.state.sliceDoc(h.startIndex,h.endIndex);clientDebuggerFlag&&console.warn("classCode: "+b)}var E=b.replaceAll(`
`,"&#10").replaceAll('"',"&#$quot");let S=1,D=o.startIndex,j=o.endIndex;var p=Page.codeMirrorEditor6.state.sliceDoc(D,j);clientDebuggerFlag&&console.warn("selectedText: "+p),p.includes(d[0].trim())==!1&&(S=3);var C=document.createElement("customContextMenu"),M=S===3?["Alter "+c+" multiplicity","Alter "+c+" role name","Alter "+s+" role name"]:["Alter "+c+" multiplicity","Alter "+c+" role name","Alter "+s+" multiplicity","Alter "+s+" role name","Delete the association"],_=S===3?['Action.modifyMultiplicity("'+E+'","'+p+'","'+u[0]+'","0")','Action.modifyRoleName("'+E+'","'+p+'","'+u[1]+'","'+u[0]+'","0")','Action.modifyRoleName("'+E+'","'+p+'","'+d[1]+'","'+u[0]+'","1")']:['Action.modifyMultiplicity("'+E+'","'+p+'","'+u[0]+'","0")','Action.modifyRoleName("'+E+'","'+p+'","'+u[1]+'","'+u[0]+'","0")','Action.modifyMultiplicity("'+E+'","'+p+'","'+d[0]+'","'+S+'")','Action.modifyRoleName("'+E+'","'+p+'","'+d[1]+'","'+u[0]+'","1")','Action.deleteAssociation("'+E+'","'+p+'")'];C.style.zIndex="1000",C.style.border="1px solid #ccc",C.style.backgroundColor="#f8f8f8",C.style.padding="5px",C.style.position="fixed";for(var T=0;T<M.length;T++){var P=document.createElement("div");P.style.padding="5px",P.style.borderRadius="3px",P.style.cursor="pointer",P.style.transition="background-color 0.3s",P.textContent=M[T],P.setAttribute("onclick","javascript:"+_[T]),P.addEventListener("mouseover",function(){this.style.backgroundColor="#ddd"}),P.addEventListener("mouseout",function(){this.style.backgroundColor="transparent"}),C.appendChild(P)}var k=C.getBoundingClientRect();e.clientX+k.width>window.innerWidth?C.style.right=window.innerWidth-e.clientX+"px":C.style.left=e.clientX+"px",e.clientY+k.height>window.innerHeight?C.style.bottom=window.innerHieght-e.clientY+"px":C.style.top=e.clientY+"px",document.addEventListener("keydown",function U(N){var R=document.getElementById("promptBox");N.target!=C&&!C.contains(N.target)&&N.key==="Escape"&&(R!=null&&N.target!=R&&R.contains(N.target),document.removeEventListener("keydown",U),Action.removeContextMenu())}),document.addEventListener("mousedown",function U(N){var R=document.getElementById("promptBox");N.target!=C&&!C.contains(N.target)&&(R!=null&&N.target!=R&&R.contains(N.target),document.removeEventListener("mousedown",U),Action.removeContextMenu())}),document.body.appendChild(C)},Action.validateMultiplicity=function(e){if(!e)return!1;if(e==="*"||e.match(/^\d+$/))return!0;if(e.match(/^(\d+|\*)\.\.(\d+|\*)$/)){const t=e.split(".."),n=t[0],r=t[1];if(n==="*"||r==="*"){if(n==="0"||n.match(/^\d+$/)&&n!=="0")return!0}else{const o=parseInt(n,10),a=parseInt(r,10);if(o<=a)return!0}}return!1},Action.modifyMultiplicity=function(e,t,n,r){let o=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"');if(r==1)var a=!0;else if(r==3){Page.setFeedbackMessage(" unable to change end multiplicity for associationClass ");return}else var a=!1;var s=document.createElement("div");s.style.zIndex="1000",s.style.border="1px solid #ccc",s.style.backgroundColor="#f8f8f8",s.style.padding="5px",s.style.position="absolute",s.style.left="50%",s.style.top="50%",s.style.transform="translate(-50%, -50%)",s.id="promptBox";var c=document.createElement("input");c.type="text",c.value=n,c.style.padding="5px",c.style.margin="5px",c.style.width="200px";var d=document.createElement("button");d.textContent="Change",d.style.padding="5px",d.style.marginLeft="5px";var u=document.createElement("label");u.type="label",u.style.color="red",u.textContent="Please enter a valid multiplicity format (e.g., '*', '1', '0..1', '1..*', '2..5').",s.appendChild(c),s.appendChild(d),document.body.appendChild(s),c.focus();var f=function g(h){document.contains(s)&&h.target!=s&&!s.contains(h.target)&&(document.removeEventListener("mousedown",g),s.remove())};document.addEventListener("mousedown",f),document.addEventListener("keydown",function(g){g.key==="Escape"&&(s.remove(),document.removeEventListener("keydown",arguments.callee))}),d.addEventListener("click",function(){if(Action.validateMultiplicity(c.value.trim())){var g=n.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&");let h;if(a){const E=t.split(new RegExp(g));E.length===3?h=E[0]+n.trim()+E[1]+c.value.trim()+E[2]:E.length===2&&(h=E[0]+c.value.trim()+E[1])}else h=t.replace(new RegExp(g),c.value.trim());let b=Page.codeMirrorEditor6.state.doc.toString();if(o.includes(t)==!1)b=b.replace(t,h);else{let E=o;E=E.replace(t,h),b=b.replace(o,E)}Page.setCodeMirror6Text(b),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate"),s.remove(),Action.selectMatchingText(h)}else c.focus(),s.appendChild(u)}),c.addEventListener("keydown",function(g){g.key==="Enter"&&(g.preventDefault(),g.stopPropagation(),d.click())})},Action.modifyRoleName=function(e,t,n,r,o){let a=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"');if(o==1)var s=!0;else var s=!1;var c=document.createElement("div");c.style.zIndex="1000",c.style.border="1px solid #ccc",c.style.backgroundColor="#f8f8f8",c.style.padding="5px",c.style.position="absolute",c.style.left="50%",c.style.top="50%",c.style.transform="translate(-50%, -50%)",c.id="promptBox";var d=document.createElement("input");d.type="text",d.value=n,d.style.padding="5px",d.style.margin="5px",d.style.width="200px";var u=document.createElement("button");u.textContent="Change",u.style.padding="5px",u.style.marginLeft="5px";var f=document.createElement("label");f.type="label",f.style.color="red",f.textContent="To add a role name at this end there must be a role name at the other end first",c.appendChild(d),c.appendChild(u),document.body.appendChild(c),d.focus();var g=function h(b){document.contains(c)&&b.target!=c&&!c.contains(b.target)&&(document.removeEventListener("mousedown",h),c.remove())};document.addEventListener("mousedown",g),document.addEventListener("keydown",function(h){h.key==="Escape"&&(c.remove(),document.removeEventListener("keydown",arguments.callee))}),u.addEventListener("click",function(){var h=d.value.trim();if(n==""){var b=/(\s*<-\s*|\s*><\s*|\s*--\s*|\s*->\s*|\s*<@>-\s*|\s*-\s*<@>\s*)/,E=t.split(b),S=E[0].trim(),D,j,p;if(E.length>2){var C=E[2].trim();if(s)if(C.includes("sorted")){var M=C.split("sorted"),_=C.split(";");j=M[0].trim()+" "+h+"sorted"+M[1]}else{var _=C.split(";");j=_[0].trim()+" "+h+";"}else if(a.includes(t)==!1?D=S.trim()+" "+h:D=r.trim()+" "+h,S.includes("sorted")){var T=S.split("sorted");D=r.trim()+" "+h+"sorted"+T[1]}p=s?S+E[1]+j:D+E[1]+C}else if(E=t.split(";")[0].split(" "),s==!1)if(D=r.trim()+" "+h,E.length>2)p=D+" "+E[1].trim()+" "+E[2].trim()+";";else{d.focus(),c.appendChild(f);return}else _=t.split(";"),p=_[0].trim()+" "+h+";"}else p=t.replace(n,h);let P=Page.codeMirrorEditor6.state.doc.toString();if(a.includes(t)==!1)P=P.replace(t,p);else{let k=a;k=k.replace(t,p),P=P.replace(a,k)}Page.setCodeMirror6Text(P),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate"),c.remove(),Action.selectMatchingText(p)}),d.addEventListener("keydown",function(h){h.key==="Enter"&&(h.preventDefault(),h.stopPropagation(),u.click())})},Action.deleteAssociation=function(e,t){let n=Page.codeMirrorEditor6.state.doc.toString(),r=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"');if(r.includes(t)==!1)n=n.replace(t,"");else{let o=r;o=o.replace(t,""),n=n.replace(r,o)}Page.setCodeMirror6Text(n),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate")},Action.displayAttributeMenu=function(e,t,n){if(Action.diagramInSync){Action.removeContextMenu();var r=e.target;for(t=t.trim();r.parentElement.id!="graph0";)r=r.parentNode;r=r.outerHTML.substr(r.outerHTML.indexOf("&nbsp;"),r.outerHTML.indexOf("</text>")-r.outerHTML.indexOf("&nbsp;")).replaceAll("&nbsp;","").trim();var o=Page.codeMirrorEditor6.state.doc.toString(),a=Action.splitStates(o);for(let E=0;E<a.length;E++)(a[E].startsWith("class "+r+"{")||a[E].startsWith("class "+r+" ")||a[E].startsWith("class "+r+`
`))&&(a=a[E]);if(typeof a=="string"){var s=document.createElement("customContextMenu"),c=document.createElement("div");c.textContent="Attribute: "+t+"Type: "+n,c.style.padding="5px",c.style.borderBottom="1px solid #ccc",c.style.fontWeight="bold",s.appendChild(c);var d=["Rename Attribute","Change Type","Delete Attribute"],u=a.replaceAll(`
`,"&#10").replaceAll('"',"&#$quot"),f=['Action.renameAttribute("'+u+'","'+r+'","'+t+'","'+n+'")','Action.changeAttributeType("'+u+'","'+r+'","'+t+'","'+n+'")','Action.deleteAttribute("'+u+'","'+r+'","'+t+'","'+n+'")'];s.style.zIndex="1000",s.style.border="1px solid #ccc",s.style.backgroundColor="#f8f8f8",s.style.padding="5px",s.style.position="fixed";for(var g=0;g<d.length;g++){var h=document.createElement("div");h.style.padding="5px",h.style.borderRadius="3px",h.style.cursor="pointer",h.style.transition="background-color 0.3s",h.textContent=d[g],h.setAttribute("onclick","javascript:"+f[g]),h.addEventListener("mouseover",function(){this.style.backgroundColor="#ddd"}),h.addEventListener("mouseout",function(){this.style.backgroundColor="transparent"}),s.appendChild(h)}var b=s.getBoundingClientRect();e.clientX+b.width>window.innerWidth?s.style.right=window.innerWidth-e.clientX+"px":s.style.left=e.clientX+"px",e.clientY+b.height>window.innerHeight?s.style.bottom=window.innerHeight-e.clientY+"px":s.style.top=e.clientY+"px",document.addEventListener("keydown",function E(S){var D=document.getElementById("promptBox");S.target!=s&&!s.contains(S.target)&&S.key==="Escape"&&(D!=null&&S.target!=D&&D.contains(S.target),document.removeEventListener("keydown",E),Action.removeContextMenu())}),document.addEventListener("mousedown",function E(S){S.target!=s&&!s.contains(S.target)&&(document.removeEventListener("mousedown",E),Action.removeContextMenu())}),document.body.appendChild(s)}}},Action.renameAttribute=function(e,t,n,r){var o=document.createElement("div");o.style.zIndex="1000",o.style.border="1px solid #ccc",o.style.backgroundColor="#f8f8f8",o.style.padding="5px",o.style.position="absolute",o.style.left="50%",o.style.top="50%",o.style.transform="translate(-50%, -50%)",o.id="promptBox";var a=document.createElement("input");a.type="text",a.value=n,a.style.padding="5px",a.style.margin="5px",a.style.width="200px";var s=document.createElement("button");s.textContent="Rename",s.style.padding="5px",s.style.marginLeft="5px",o.appendChild(a),o.appendChild(s),document.body.appendChild(o),a.focus();var c=function d(u){document.contains(o)&&u.target!=o&&!o.contains(u.target)&&(document.removeEventListener("mousedown",d),o.remove())};document.addEventListener("mousedown",c),s.addEventListener("click",function(){if(Action.validateAttributeName(a.value.trim())){let d=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"'),u=d.includes(n+" :"),f=new RegExp("\\b"+n+"\\s*:\\s*\\w+\\s*;\\n?","g"),g=new RegExp("\\b"+n+"\\s*;\\n?","g"),h=u?r+" "+a.value.trim()+`;
`:a.value.trim()+`;
`,b=d;b=b.replace(f,h),b=b.replace(g,h);let E=new RegExp("\\b"+n+"\\b","g");b=b.replace(E,a.value.trim());let S=Page.codeMirrorEditor6.state.doc.toString();S=S.replace(d,b),Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:S}}),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate"),document.removeEventListener("mousedown",c),o.remove()}})},Action.changeAttributeType=function(e,t,n,r){var o=document.createElement("div");o.style.zIndex="1000",o.style.border="1px solid #ccc",o.style.backgroundColor="#f8f8f8",o.style.padding="5px",o.style.position="absolute",o.style.left="50%",o.style.top="50%",o.style.transform="translate(-50%, -50%)",o.id="promptBox";var a=document.createElement("select");["String","Integer","Double","Float","Boolean","Date","Time"].forEach(function(d){var u=document.createElement("option");u.value=d,u.text=d,d===r&&(u.selected=!0),a.appendChild(u)});var s=document.createElement("button");s.textContent="Change Type",s.style.padding="5px",s.style.margin="5px",o.appendChild(a),o.appendChild(s),document.body.appendChild(o),a.focus();var c=function d(u){document.contains(o)&&u.target!=o&&!o.contains(u.target)&&(document.removeEventListener("mousedown",d),o.remove())};document.addEventListener("mousedown",c),s.addEventListener("click",function(){var d=a.options[a.selectedIndex].value;if(d!==r){let u=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"'),f=u;if(r!="String"){let h=new RegExp("\\b"+r+"\\s"+n,"g");f=f.replace(h,d+" "+n)}else{let h=new RegExp("\\b"+r+"\\s"+n,"g"),b=new RegExp("\\b"+n,"g");f=f.replace(h,d+" "+n),f=f.replace(b,d+" "+n)}let g=Page.codeMirrorEditor6.state.doc.toString();g=g.replace(u,f),Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:g}}),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate"),document.removeEventListener("mousedown",c),o.remove()}else document.removeEventListener("mousedown",c),o.remove()})},Action.deleteAttribute=function(e,t,n,r){let o=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"'),a=new RegExp("\\b"+r+"\\s"+n+"\\s*;","g"),s=new RegExp("\\b"+n+"\\s*;\\n?","g"),c=o;c=c.replace(a,""),c=c.replace(s,"");let d=Page.codeMirrorEditor6.state.doc.toString();d=d.replace(o,c),Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:d}}),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate")},Action.classSelected=function(e){var t=Page.selectedClass,n=e;if(t!=null){Page.selectedClass=null,jQuery("#"+t.id).css("background-color","white");for(var r="#"+t.id+"_anchor",o=0;o<8;o++)jQuery(r+o).hide()}if(n!=null){jQuery("#umpleCanvas").addClass("unscrollable"),Page.selectedClass=UmpleSystem.find(n.id),jQuery("#"+n.id).css("background-color","#F3F6FB");for(var r="#"+n.id+"_anchor",a="#"+n.id+"_hover",o=0;o<8;o++)jQuery(r+o).show(),jQuery(a+o).hide()}else jQuery("#umpleCanvas").removeClass("unscrollable")},Action.classHover=function(e,t){var n=e.currentTarget;if(Action.diagramInSync&&!(Page.selectedClass!=null&&Page.selectedClass.id==n.id)){var r=t?"block":"none",o=jQuery("#"+n.id);if(t?o.css("background-color","#F3F6FB"):o.css("background-color","white"),Page.canShowHovers())for(var a=8,s="#"+n.id+"_hover",c=0;c<a;c++)t?jQuery(s+c).show():jQuery(s+c).hide()}},Action.unselectAll=function(){Action.classSelected(null),Action.associationSelected(null),Action.generalizationSelected(null),Action.transitionSelected(null)},Action.classClicked=function(e){if(Action.diagramInSync){Action.focusOn("umpleCanvas",!0),Action.focusOn("umpleModelEditorText",!1),Action.unselectAll(),Action.elementClicked=!0;var t=e.currentTarget;if(Action.selectClass(t.id),Page.selectedItem=="DeleteEntity")DiagramEdit.classDeleted(t.id);else if(Page.selectedItem=="AddAssociation")DiagramEdit.newAssociation==null?(Action.canCreateByDrag=!1,DiagramEdit.createAssociationPartOne(e)):(DiagramEdit.createAssociationPartTwo(e),setTimeout(function(){Action.canCreateByDrag=!0},500));else if(Page.selectedItem=="AddGeneralization")if(DiagramEdit.newGeneralization==null){var n=DiagramEdit.createGeneralizationPartOne(e);n&&(Action.canCreateByDrag=!1)}else DiagramEdit.createGeneralizationPartTwo(e),setTimeout(function(){Action.canCreateByDrag=!0},500);else Action.classSelected(t)}},Action.stateClicked=function(e){if(Action.diagramInSync){Action.focusOn("umpleCanvas",!0),Action.focusOn("umpleModelEditorText",!1);var t=e.split("^*^"),n=t[0],r=t[1],o=t[2].replace("Entry:","").replace("Exit:","");o=o.replace("Exit:",""),Action.unselectAll(),Action.elementClicked=!0;var a=null,s=null;if(o.includes(".")){clientDebuggerFlag&&console.log("stateClicked - nested state case"),o=o.split("."),s=Action.selectStateInClassCM6(n,r,o[0]);for(let c=1;c<o.length;c++)clientDebuggerFlag&&console.log("Iterating states within Identified state ..."),s=Action.selectStateInStateCM6(s.startIndex,s.endIndex,o[c])}else clientDebuggerFlag&&console.log("stateClicked - else - base case"),s=Action.selectStateInClassCM6(n,r,o),clientDebuggerFlag&&console.log("selectionIndiciesCM6: ",s);Action.highlightByIndexCM6(s.startIndex,s.endIndex),Page.selectedItem=="AddTransition"&&(DiagramEdit.newTransition==null?(Action.canCreateByDrag=!1,DiagramEdit.createTransitionPartOne(event)):(DiagramEdit.createTransitionPartTwo(event),setTimeout(function(){Action.canCreateByDrag=!0},500)))}},Action.associationClicked=function(e){if(Action.diagramInSync){Action.elementClicked=!0,Action.unselectAll();var t=e.currentTarget;Action.associationSelected(t)}},Action.transitionClicked=function(e){if(!Action.diagramInSync||typeof e=="string"&&e===null)return;Action.elementClicked=!0,Action.unselectAll();let t=e.split("*^*"),n=t[3].split(".");dest=t[4];var r=Action.selectStateInClassCM6(t[0],t[1],n[0]);dest=t[4].split(".");for(var o=1;o<n.length;o++)r=Action.selectStateInStateCM6(r.startIndex,r.endIndex,n[o]);let a=t[2].replaceAll("+","\\+").replaceAll("-","\\-").replaceAll("*","\\*").replaceAll("?","\\?").replaceAll("|","\\|");if(a=a.replace("after","after~`~?:Every`~`?"),t[5]!=""){let g=t[5].trim().replaceAll("+","\\+").replaceAll("-","\\-").replaceAll("*","\\*").replaceAll("?","\\?").replaceAll("|","\\|");a=a+"\\s*[\\s*"+g.trim().slice(1,g.trim().length-1)+"\\s*]"}a=a.replaceAll("]","\\]").replaceAll("[","\\[").replaceAll(")","\\)?").replaceAll("(","\\(?").replaceAll("~`~","(").replaceAll("`~`",")").replaceAll(" ","\\s*").replaceAll(",","\\s*,\\s*").replaceAll("!","\\s*!\\s*").replaceAll("/","\\s*/\\s*"),a=a.replaceAll("&&","&{1,2}");let s=new RegExp(a+".*->","s"),c=Page.codeMirrorEditor6.state.doc.toString().substr(r.startIndex,r.endIndex-r.startIndex).search(s)+r.startIndex,d=Page.codeMirrorEditor6.state.doc.toString().substr(c),u=Action.findEOL(d),f=c+u.length;Action.highlightByIndexCM6(c,f),u.split("->").length-1!==1&&Page.setFeedbackMessage("Please edit this complex transition in the textual code."),Action.highlightByIndexCM6(c,f)},Action.generalizationClicked=function(e){if(Action.diagramInSync){Action.elementClicked=!0,Action.unselectAll();var t=e.currentTarget;Action.generalizationSelected(t)}},Action.associationHover=function(e,t){if(Action.diagramInSync){var n=e.currentTarget,r=UmpleSystem.findAssociation(n.id);if(n!=null&&Page.canShowHovers())for(var o=2,a="#"+n.id+"_hover",s=0;s<o;s++)t?jQuery(a+s).show():jQuery(a+s).hide()}},Action.transitionHover=function(e,t){if(Action.diagramInSync){var n=e.currentTarget,r=UmpleSystem.findTransition(n.id);if(updateAssociation!=null&&Page.canShowHovers())for(var o=2,a="#"+updateAssociation.id+"_hover",s=0;s<o;s++)t?jQuery(a+s).show():jQuery(a+s).hide()}},Action.generalizationHover=function(e,t){if(Action.diagramInSync){var n=e.currentTarget;if(n!=null&&Page.canShowHovers())for(var r="#"+n.id+"_hover",o=0;o<3;o++)t?jQuery(r+o).show():jQuery(r+o).hide()}},Action.associationSelected=function(e){var t=e!=null,n=null;if(Page.selectedItem=="DeleteEntity"&&e!=null){var r=!1;DiagramEdit.associationDeleted(e.id,r);return}if(e!=null)Page.selectedAssociation=e,n=e;else if(Page.selectedAssociation!=null)n=Page.selectedAssociation,Page.selectedAssociation=null;else return;for(var o=2,a="#"+n.id+"_anchor",s=0;s<o;s++)t?jQuery(a+s).show():jQuery(a+s).hide()},Action.transitionSelected=function(e){var t=e!=null,n=null;if(Page.selectedItem=="DeleteEntity"&&e!=null){var r=!1;DiagramEdit.transitionDeleted(e.id,r);return}if(e!=null)Page.selectedTransition=e,n=e;else if(Page.selectedTransition!=null)n=Page.selectedTransition,Page.selectedTransition=null;else return;for(var o=2,a="#"+n.id+"_anchor",s=0;s<o;s++)t?jQuery(a+s).show():jQuery(a+s).hide()},Action.generalizationSelected=function(e){var t=e!=null,n=null;if(Page.selectedItem=="DeleteEntity"&&e!=null){var r=!1;DiagramEdit.generalizationDeleted(e.id,r);return}if(e!=null)Page.selectedGeneralization=e,n=e;else if(Page.selectedGeneralization!=null)n=Page.selectedGeneralization,Page.selectedGeneralization=null;else return;for(var o=3,a="#"+n.id+"_anchor",s=0;s<o;s++)t?jQuery(a+s).show():jQuery(a+s).hide()},Action.executeCode=function(e,t){var n="#buttonExecuteCode",r=t;jQuery(n).showLoading(),Action.ajax(function(o){Action.executeCodeCallback(o)},format("execute=true&language={0}&languageStyle={1}&model={2}",r,e,Page.getModel()),"true")},Action.generateCode=function(e,t){var n="#buttonGenerateCode",r=t,o;Page.getAdvancedMode()==0&&t==="Cpp"&&(r="Experimental-"+t),t==="StateTables"&&(o=StateTree.colourStateTables),t==="EventSequence"&&(o=StateTree.colourEventSequences),t==="stateDiagram"&&(r=t+"."+$("inputGenerateCode").value.split(":")[1]),jQuery(n).showLoading(),Action.ajax(function(a){Action.generateCodeCallback(a,e,o)},format("language={0}&languageStyle={1}",r,e),"true")},Action.photoReady=function(){var e="#"+Page.umpleCanvasId();Page.isPhotoReady()?jQuery(e).addClass("photoReady"):jQuery(e).removeClass("photoReady"),UmpleSystem.redrawCanvas()},Action.executeCodeCallback=function(e){var t="#buttonExecuteCode";jQuery(t).hideLoading(),Page.showExecutionArea(),Page.hideGeneratedCodeOnly(),Page.showExecutedResponse(e.responseText),window.location.href="#codeExecutionArea"},Action.generateCodeCallback=function(e,t,n){Page.showGeneratedCode(e.responseText,t),Page.hideExecutionArea(),Action.gentime=new Date().getTime(),n!==void 0&&n();var r="#buttonGenerateCode";jQuery(r).hideLoading(),Page.showCodeDone(),window.location.href="#genArea"},Action.classMouseDown=function(e){Action.canCreateByDrag&&(Page.selectedItem=="AddAssociation"&&DiagramEdit.newAssociation==null?DiagramEdit.createAssociationPartOne(e):Page.selectedItem=="AddGeneralization"&&DiagramEdit.newGeneralization==null?DiagramEdit.createGeneralizationPartOne(e):Page.selectedItem=="AddTransition"&&DiagramEdit.newTransition==null&&DiagramEdit.createTransitionPartOne(e))},Action.classMouseUp=function(e){Action.canCreateByDrag&&(Page.selectedItem=="AddAssociation"&&DiagramEdit.newAssociation!=null?DiagramEdit.createAssociationPartTwo(e):Page.selectedItem=="AddGeneralization"&&DiagramEdit.newGeneralization!=null?DiagramEdit.createGeneralizationPartTwo(e):Page.selectedItem=="AddTransition"&&DiagramEdit.newTransition!=null&&DiagramEdit.createTransitionPartTwo(e))},Action.mouseMove=function(e){Page.clickCount=0,Page.selectedItem=="AddClass"&&(DiagramEdit.newClass==null&&(DiagramEdit.newClass=new UmpleClass,DiagramEdit.newClass.name="",DiagramEdit.newClass.id="tempClass"),Action.drawClassOutline(e,DiagramEdit.newClass)),DiagramEdit.newAssociation!=null&&Page.selectedItem=="AddAssociation"&&Action.drawAssociationLine(e,DiagramEdit.newAssociation),DiagramEdit.newTransition!=null&&Page.selectedItem=="AddTransition"&&Action.drawTransitionLine(e,Diagramedit.newTransition),DiagramEdit.newGeneralization!=null&&Page.selectedItem=="AddGeneralization"&&Action.drawGeneralizationLine(e,DiagramEdit.newGeneralization)},Action.drawClassOutline=function(e,t){var n="#"+Page.umpleCanvasId(),r=new UmplePosition(e.pageX,e.pageY+1,0,0),o=r.subtract(UmpleSystem.position());t.position=new UmplePosition(o.x,o.y,UmpleClassFactory.defaultSize.width,UmpleClassFactory.defaultSize.height);var a=t.drawableClassOutline();jQuery(n).append(a);var s="#"+t.id,c=s+"_width",d=s+"_height",u=new Object;u.left=r.x,u.top=r.y,jQuery(s).offset(u),jQuery(c).width(t.position.width),jQuery(d).height(t.position.height)},Action.drawAssociationLine=function(e,t){var n="#"+Page.umpleCanvasId(),r=new UmplePosition(e.pageX,e.pageY,0,0);t.classTwoPosition=r.subtract(UmpleSystem.position()),jQuery(n).append(t.drawable())},Action.drawTransitionLine=function(e,t){var n="#"+Page.umpleCanvasId(),r=new UmplePosition(e.pageX,e.pageY,0,0);t.toStatePosition=r.subtract(UmpleSystem.position()),jQuery(n).append(t.drawable())},Action.drawGeneralizationLine=function(e,t){var n="#"+Page.umpleCanvasId(),r="#"+t.getElementId(),o=UmpleSystem.position(),a=e.pageX-5-o.x,s=e.pageY+5-o.y;t.parentPosition=new UmplePosition(a,s,0,0),jQuery(r).remove(),jQuery(n).append(t.drawable(!1))},Action.umpleCanvasClicked=function(e){if(Action.elementClicked){Action.elementClicked=!1;return}if(Page.selectedItem=="AddClass"){var t=new UmplePosition(Math.floor(e.pageX),Math.floor(e.pageY),0,0);DiagramEdit.addClass(t)}else Page.selectedItem=="AddAssociation"&&DiagramEdit.newAssociation!=null?Page.clickCount>1&&DiagramEdit.removeNewAssociation():Page.selectedItem=="AddTransition"&&DiagramEdit.newTransition!=null?Page.clickCount>1&&DiagramEdit.removeNewTransition():Page.selectedItem=="AddGeneralization"&&DiagramEdit.newGeneralization!=null?Page.clickCount>1&&DiagramEdit.removeNewGeneralization():Action.unselectAll()},Action.directUpdateCommandCallback=function(e){Action.updateUmpleTextCallback(e),Action.redrawDiagram()},Action.updateUmpleTextCallback=function(e){!justUpdatetoSaveLater&&!justUpdatetoSaveLaterForTextCallback&&(TabControl.getCurrentHistory().save(e.responseText,"TextCallback"),Page.setExampleMessage("")),Action.freshLoad=!0,Page.setUmpleCode(e.responseText,Action.update.codeChange),Page.hideLoading(),DiagramEdit.textChangeQueue.length==0?(Action.freshLoad=!1,DiagramEdit.pendingChanges=!1,Action.setjustUpdatetoSaveLater(!1),Action.setjustUpdatetoSaveLaterForTextCallback(!1)):(Action.setjustUpdatetoSaveLater(!0),Action.setjustUpdatetoSaveLaterForTextCallback(!0),DiagramEdit.doTextUpdate())},Action.setExampleType=function e(){jQuery("#itemLoadExamples").hide(),jQuery("#itemLoadExamples2").hide(),jQuery("#itemLoadExamples3").hide(),jQuery("#itemLoadExamples4").hide(),jQuery("#itemLoadExamples5").hide(),jQuery("#itemLoadExamples6").hide(),jQuery("#itemLoadExamples7").hide(),jQuery("#itemLoadExamples8").hide(),Page.getExampleType()=="cdModels"?(jQuery("#itemLoadExamples").show(),jQuery("#defaultExampleOption").prop("selected",!0)):Page.getExampleType()=="smModels"?(jQuery("#itemLoadExamples2").show(),jQuery("#defaultExampleOption2").prop("selected",!0)):Page.getExampleType()=="featureModels"?(jQuery("#itemLoadExamples4").show(),jQuery("#defaultExampleOption4").prop("selected",!0)):Page.getExampleType()=="extra1ModelsAD"?(jQuery("#itemLoadExamples5").show(),jQuery("#defaultExampleOption5").prop("selected",!0)):Page.getExampleType()=="extra1ModelsEL"?(jQuery("#itemLoadExamples6").show(),jQuery("#defaultExampleOption6").prop("selected",!0)):Page.getExampleType()=="extra1ModelsMP"?(jQuery("#itemLoadExamples7").show(),jQuery("#defaultExampleOption7").prop("selected",!0)):Page.getExampleType()=="extra1ModelsQZ"?(jQuery("#itemLoadExamples8").show(),jQuery("#defaultExampleOption8").prop("selected",!0)):(jQuery("#itemLoadExamples3").show(),jQuery("#defaultExampleOption3").prop("selected",!0))},Action.loadExample=function e(){var r=this.dataset.diagramType,t=jQuery(" option:selected",this);if(t.hasClass("openUmprOption")){location.href="http://umple.org/umpr?diagram-type="+r;return}UmpleSystem.merge(null),Page.showCanvasLoading(!0),Page.showModelLoading(!0),Page.showLayoutLoading(!0),Ajax.sendRequest("scripts/compiler.php",Action.loadExampleCallback,"exampleCode="+Page.getSelectedExample());var n=Page.getSelectedExample().slice(0,-4),r="";Page.useGvStateDiagram?r="&diagramtype=state":Page.useGvFeatureDiagram?r="&diagramtype=GvFeature":Page.useStructureDiagram?r="&diagramtype=structure&generateDefault=cpp":r="&diagramtype=GvClass";var o="#buttonLarger",a="#buttonSmaller",s="#"+Page.umpleCanvasId();umpleCanvasWidth=jQuery(s).width(),umpleCanvasHeight=jQuery(s).height();var c=Page.getSelectedExample();if(n.startsWith("https"))var d=n.split("/").pop(),u="?filename="+n.substr(8)+".ump"+r;else var d=n,u="?example="+d+r;setTimeout(function(){Page.setExampleMessage('<a href="'+u+'">URL for '+d+" example</a>")},3e3),jQuery("#inputExample").blur()},Action.loadExampleCallback=function(e){Action.freshLoad=!0,Action.setjustUpdatetoSaveLater(!0),Page.setUmpleCode(e.responseText,function(){Page.hideLoading(),Action.updateUmpleDiagram()}),Action.setCaretPosition("0"),Action.updateLineNumberDisplay(),TabControl.getCurrentHistory().save(e.responseText,"loadExampleCallback")},Action.customSizeTyped=function(){Action.oldTimeout!=null&&clearTimeout(Action.oldTimeout);var e=jQuery("#widthField").val(),t=jQuery("#heightField").val();Action.oldTimeout=setTimeout(function(){Page.setUmpleCanvasSize(e,t)},Action.waiting_time)},Action.moveSelectedClass=function(e,t){e!=null&&(e.position=e.position.add(t),UmpleSystem.updateClass(e),Action.classSelected(e),Action.oldTimeout!=null&&clearTimeout(Action.oldTimeout),Action.oldTimeout=setTimeout(function(){DiagramEdit.classMoved(Page.selectedClass)},1e3))},Action.keyboardShortcut=function(e){if(Page.shortcutsEnabled){var t=e.which;if(t==27){var n=Page.unselectAllToggleTools();n||jQuery(".visibleFocus").blur()}else(t==8||t==46)&&jQuery("#umpleCanvasColumn").hasClass("focus")?Page.selectedClass&&jQuery("#"+Page.selectedClass.id).find("input").length==0?(DiagramEdit.classDeleted(Page.selectedClass.id),e.preventDefault()):Page.selectedAssociation?(DiagramEdit.associationDeleted(Page.selectedAssociation.id),e.preventDefault()):Page.selectedGeneralization&&(DiagramEdit.generalizationDeleted(Page.selectedGeneralization.id),e.preventDefault()):(t==8||t==46)&&jQuery(".umpleClass").is(":focus")?(DiagramEdit.classDeleted(document.activeElement.id),e.preventDefault()):(t==8||t==46)&&(jQuery(".untracedAssociation").is(":focus")||jQuery(".redTracedAssociation").is(":focus"))?(DiagramEdit.associationDeleted(document.activeElement.id),e.preventDefault()):(t==8||t==46)&&jQuery(".umpleGeneralization").is(":focus")&&(DiagramEdit.generalizationDeleted(document.activeElement.id),e.preventDefault())}},Action.getCaretPosition=function(){return Page.codeMirrorEditor6.state.doc.lineAt(Page.codeMirrorEditor6.state.selection.main.head).number},Action.getInputSelectionStart=function(e){var t=0,n,r,o,a,s;return typeof e.selectionStart=="number"&&typeof e.selectionEnd=="number"?(t=e.selectionStart,Page.getAdvancedMode()==2&&Page.setFeedbackMessage("Non-IE browser ")):(Page.getAdvancedMode()==2&&Page.setFeedbackMessage("IE-type browser "),r=document.selection.createRange(),r&&r.parentElement()==e&&(a=e.value.length,n=e.value.replace(/\r\n/g,`
`),o=e.createTextRange(),o.moveToBookmark(r.getBookmark()),s=e.createTextRange(),s.collapse(!1),o.compareEndPoints("StartToEnd",s)>-1?t=a:(t=-o.moveStart("character",-a),t+=n.slice(0,t).split(`
`).length-1))),t},Action.setCaretPosition=function(e){if(isNaN(e-0)){if(e=="gd"&&(jQuery("#gdprtext").show(),Action.gdprHidden=!1),e=="av"){document.getElementById("advancedMode").value=1,Page.setFeedbackMessage("");return}if(e=="db"){document.getElementById("advancedMode").value=2,Page.setFeedbackMessage("Debug Mode");return}if(e.substr(0,4)=="clws"){e.substr(4,1)=="+"?(Page.setFeedbackMessage("Collaboration logging Enabled"),Collab.websocketLogging(0)):e.substr(4,1)=="-"?(Page.setFeedbackMessage("Collaboration logging disabled"),Collab.websocketLogging(-1)):e.substr(4,2)=="tq"?(Page.setFeedbackMessage("Ten seconds to timeout the client"),Collab.clientSetTimeout(10)):e.substr(4,2)=="tn"?(Page.setFeedbackMessage("Turn the timeout back to normal"),Collab.clientSetTimeout(-1)):e.substr(4,2)=="tx"&&(Page.setFeedbackMessage("Disabled the timeout"),Collab.clientSetTimeout(0));return}if(e=="sp"&&existSCookie("surveyCookie")==null&&window.localStorage.getItem("surveyShown")==null&&(document.getElementById("styleTip")!=null&&(document.getElementById("styleTip").innerHTML=""),window.randomSurveyRoll=1,window.surveyData.EditsBeforePrompt=1,timeSurveyUp=!1,clearTimeout(timeSurvey),timeSurvey=setTimeout(function(){timeSurveyUp=!0},1e4),displayedText=!1,displayedText||(beforeInstance=TabControl.getCurrentHistory().currentIndex,document.addEventListener("mouseover",function(){TabControl.getCurrentHistory().currentIndex-beforeInstance>=1&&!displayedText&&timeSurveyUp&&(displaySurvey(),this.removeEventListener("mouseover",arguments.callee))}))),e=="sc"){let c=new Date;c.setTime(c.getTime()-1e3),document.cookie="surveyCookie=done; expires="+c.toUTCString()+"; path=/;",window.localStorage.removeItem("surveyShown"),document.addEventListener("mouseover",function(){}),setCookieBeforeClose("off")}if(e=="tc"){Page.setFeedbackMessage("Clearing tip cookies");let c=new Date;c.setTime(c.getTime()-1e3),window.localStorage.removeItem("first_time"),document.cookie="tipCookie=done; expires="+c.toUTCString()+"; path=/;"}if(e.substr(0,2)=="cm"){e.substr(2,1)=="0"&&Page.codeMirrorOn?(Page.setFeedbackMessage("Turning code mirroring off"),Page.codeMirrorEditor.toTextArea(),Page.codeMirrorOn=!1,jQuery("#linenum").val("0")):e.substr(2,1)=="1"&&!Page.codeMirrorOn&&(Page.initCodeMirrorEditor(),jQuery("#linenum").val("0"));return}if(e.substr(0,2)=="bp"){Action.promptAndExecuteTest();return}else{Action.selectMatchingText(e)||(Page.setFeedbackMessage('Line number or word "'+e+'" not located'),setTimeout(function(){Page.setFeedbackMessage("")},3e3));return}}if(Page.codeMirrorOn){if(Page.codeMirrorEditor6.focus(),e>=1){e=Math.min(e,Page.codeMirrorEditor6.state.doc.lines);const c=Page.codeMirrorEditor6.state.doc.line(e).from;Page.codeMirrorEditor6.dispatch({selection:{anchor:c},scrollIntoView:!0})}return}var t=document.getElementById("umpleModelEditorText"),n=0,r=-1;if(e<1)r=0;else{for(var o=Page.getRawUmpleCodeCM6(),a=0;a<o.length;a++)if(o.charAt(a)==`
`&&(e--,e==1&&(n=a+1),e==0)){r=a;break}r==-1&&(r=o.length,e!=1&&(n=r))}if(t.setSelectionRange)t.focus(),t.setSelectionRange(n,r);else if(t.createTextRange){var s=t.createTextRange();s.collapse(!0),s.moveEnd("character",r),s.moveStart("character",n),s.select()}},Action.promptAndExecuteTest=function(){var e=prompt("Umpleonline test prompt. Enter command e.g. 'ac Classname' to add a class",""),t=e.substr(2,99).strip().split(" ");if(e.substr(0,1)=="a"){if(e.substr(1,1)=="c"){if(t.length>=1){Action.directAddClass(t[0]);return}}else if(e.substr(1,1)=="a"){if(t.length>=2){Action.directAddAttribute(t[0],t[1]);return}}else Page.setFeedbackMessage("Syntax error in test add command");Page.setFeedbackMessage("Syntax error in test command")}},Action.setFilterFull=function(e,t){Page.filterWordsOutput="";var n=e.split(" ").filter(r=>r.trim()!=="");n.forEach(function(r){var o=r;r.startsWith("gvseparator=")&&(o=r.replace(".","@@@")),Page.filterWordsOutput+=o+"!@"}),t&&Action.redrawDiagram()},Action.setFilter=function(e){return Action.setFilterFull(e,!0)},Action.directAddClass=function(e){var t=Json.toString({position:{x:"10",y:"10",width:"109",height:"41"},name:e});Page.setFeedbackMessage("Adding class "+e),Action.setjustUpdatetoSaveLater(!1),Action.ajax(Action.directUpdateCommandCallback,format("action=addClass&actionCode={0}",t))},Action.directAddAttribute=function(e,t){Page.setFeedbackMessage("((when written) Adding to class "+e+" attribute "+t)},Action.selectMatchingText=function(e){if(Page.codeMirrorOn){const t=new cm6.SearchCursor(Page.codeMirrorEditor6.state.doc,e);return t.next()?(Page.codeMirrorEditor6.dispatch({selection:{anchor:t.value.from,head:t.value.to}}),!0):!1}return!1},Action.selectItemCM6=function(e){if(Page.codeMirrorOn){var t=Page.codeMirrorEditor6.state.doc.toString();let r=Action.splitStates(t),o=null;for(let c=0;c<r.length;c++)if(r[c].search(e)==0){o=r[c];break}let a=0,s=0;try{a=t.indexOf(o),s=a+o.length}catch{console.log("Please wait a little more for diagram updates, and try again.")}var n={startIndex:a,endIndex:s};return n}},Action.selectMethod=function(e,t,n){var r=new RegExp(n+" "+t+" "+e+"(\\s|[(])"),o=new RegExp("(public|protected|private|class) [A-Za-z]"),a=Action.selectItemCM6(r);Action.highlightByIndexCM6(a.startIndex,a.endIndex)},Action.selectAssociation=function(e){var t=e.split(","),n=t[0],r=new RegExp("(associationClass|class|interface|trait) "+n+"($|\\s|[{])"),o=new RegExp("(class|interface|trait) [A-Za-z]");if(Page.codeMirrorOn)var a=Action.selectItemCM6(r),s=Page.codeMirrorEditor6.state.sliceDoc(a.startIndex,a.endIndex);var c,d;if(t.length>3){if(t[2].trim().includes(" ")){var u=t[2].split(" ");c=t[3].trim(),u.length==2?d=u[0].trim()+" "+t[1].trim()+" "+u[1].trim():d=u[0].trim()+" "+t[1].trim()}else c=t[3].trim(),d=t[2].trim()+" "+t[1].trim();var f=c.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),g=d.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),h=f+"(?:\\s+sorted\\s+{.*?})?(\\s*<-\\s*|\\s*><\\s*|\\s*--\\s*|\\s*->\\s*|\\s*<@>\\-\\s*|\\s*-\\<@>\\s*)"+g+"(?:\\s+sorted\\s+{.*?})?\\s*;",b=new RegExp(h,"g"),E=Page.codeMirrorEditor6.state.doc.toString(),S=s.match(b);if(S)return startIndex=E.indexOf(s)+s.indexOf(S[0]),endIndex=startIndex+S[0].length,Action.highlightByIndexCM6(startIndex,endIndex),{startIndex,endIndex};if(g.startsWith("1")){d=g.substring(2).trim(),g=d.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),h=f+"\\s+"+g+"\\s*;",b=new RegExp(h,"g"),S=s.match(b),S==null&&(h=f+"\\s+.*?"+g+"\\s*;",b=new RegExp(h,"g"),S=s.match(b));try{startIndex=E.indexOf(s)+s.indexOf(S[0]),endIndex=startIndex+S[0].length}catch{console.log("Please wait a little more for diagram updates, and try again.")}return Action.highlightByIndexCM6(startIndex,endIndex),{startIndex,endIndex}}else{if(f.trim().includes(" ")){var D=f.split(" ");f=D[0].trim()+" "+n+" "+D[1].trim()}else f+=" "+n;h=f+"(\\s*<-\\s*|\\s*><\\s*|\\s*--\\s*|\\s*->\\s*|\\s*<@>\\-\\s*|\\s*-\\<@>\\s*)"+g+"\\s*;",b=new RegExp(h,"g"),S=E.match(b),S==null&&(h=f+"\\s+.*?"+g+"\\s*;",b=new RegExp(h,"g"),S=E.match(b));try{startIndex=E.indexOf(S[0]),endIndex=startIndex+S[0].length}catch{console.log("Please wait a little more for diagram updates, and try again.")}return Action.highlightByIndexCM6(startIndex,endIndex),{startIndex,endIndex}}}else{var u=t[2].split(" ");c=u[0].trim(),d=u[1].trim();var f=c.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),g=d.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),h=f+".*?"+g+"\\s*;",b=new RegExp(h,"g"),E=Page.codeMirrorEditor6.state.doc.toString(),S=s.match(b);if(S)return startIndex=E.indexOf(s)+s.indexOf(S[0]),endIndex=startIndex+S[0].length,Action.highlightByIndexCM6(startIndex,endIndex),{startIndex,endIndex}}},Action.selectClass=function(e){var t=new RegExp("(associationClass|class|interface|trait) "+e+"($|\\s|[{])"),n=new RegExp("(class|interface|trait) [A-Za-z]"),r=Action.selectItemCM6(t);Action.highlightByIndexCM6(r.startIndex,r.endIndex)},Action.selectState=function(e){var t=new RegExp("(class|interface|trait) "+e+"($|\\s|[{])"),n=new RegExp("(class|interface|trait) [A-Za-z]"),r=Action.selectItemCM6(t);Action.highlightByIndexCM6(r.startIndex,r.endIndex)},Action.splitStates=function(e){let t=[],n="",r=0,o=!1,a=!1;for(var s in e){let c=e.charAt(s);a&&c!=`
`&&c!=" "&&(a=!1,c!="{"&&(n="")),c=="/"&&e.charAt(parseInt(s)+1)=="/"&&(o=!0),c==`
`&&o&&(o=!1),c=="{"&&!o?(n=n+c,r++):c=="}"&&!o?(n=n+c,r--,r==0&&(t.push(n.trim()),n="")):c==`
`&&r==0?(a=!0,n=n+`
`):c==" "&&r==0&&n==""||(n=n+c)}return t},Action.indexToPos=function(e,t){for(var n=0,r=0,o="",a=0;a<e;a++){let s=t.charAt(a);s==`
`?(r++,o=""):o=o+s}return n=o.length,output={line:r,ch:n},output},Action.selectStateInClassCM6=function(e,t,n){if(Page.codeMirrorOn){var r=Page.codeMirrorEditor6.state.doc.toString();let a=Action.splitStates(r),s=null,c=new RegExp("(?:class|queued)\\s+"+e,"");for(let u=0;u<a.length;u++)if(a[u].search(c)==0){s=a[u];break}a=Action.splitStates(s.substr(s.indexOf("{")+1));let d=null;for(let u=0;u<a.length;u++){let f=new RegExp("(?:queued\\s*)?"+t);if(a[u].search(f)==0){d=a[u];break}}if(a=Action.splitStates(d.substr(d.indexOf("{")+1)),a!=null){let u=a,f=null;for(let b=0;b<u.length;b++)if(u[b].search(n)==0){f=u[b];break}let g=r.indexOf(s),h=g+s.length;g=r.substr(g,h).indexOf(d)+g,h=g+d.length,g=r.substr(g,h).indexOf(f)+g,h=g+f.length;var o={startIndex:g,endIndex:g+f.length};return o}else console.log("No matching state found with regex:"+c)}else console.log("No matching class and state machine found for class: "+e+" and sm "+t);return null},Action.selectStateInStateCM6=function(e,t,n){var r=Page.codeMirrorEditor6.state.doc.toString().substr(e,t-e);let o=Action.splitStates(r.substr(r.indexOf("{")+1));var a=null;for(let u=0;u<o.length;u++)if(o[u].startsWith(n)){a=o[u];break}let s=r.indexOf(a)+e,c=s+a.length;return{startIndex:s,endIndex:c}},Action.highlightByIndex=function(e,t){Page.codeMirrorEditor.setSelection(Action.indexToPos(e,Page.codeMirrorEditor.getValue()),Action.indexToPos(t,Page.codeMirrorEditor.getValue()))},Action.highlightByIndexCM6=function(e,t){let n=Action.indexToPos(e,Page.codeMirrorEditor6.state.doc.toString()),r=Page.codeMirrorEditor6.state.doc.line(n.line+1).from,o=Action.indexToPos(t,Page.codeMirrorEditor6.state.doc.toString()),a=Math.min(o.line+2,Page.codeMirrorEditor6.state.doc.lines),s=Page.codeMirrorEditor6.state.doc.line(a).from;Page.codeMirrorEditor6.dispatch({selection:cm6.EditorSelection.create([cm6.EditorSelection.range(s,r)]),scrollIntoView:!0})},Action.findEOL=function(e){let t="",n="",r=0,o=!1;for(var a in e){let s=e.charAt(a);if(s=="{")r++,n=n+s;else if(s=="}")r--,n=n+s;else if(s==";"&&r==0){t=n+";";break}else n=n+s}return t},Action.delayedFocus=function(e){var t=document.getElementById("umpleModelEditorText");setTimeout(function(){t.focus()},e)},Action.updateLineNumberDisplay=function(){jQuery("#linenum").val(Action.getCaretPosition())},Action.umpleTyped=function(e){clientDebuggerFlag&&console.log("Inside Action.umpleTyped()..."),Page.getAdvancedMode()=="2"&&Page.catFeedbackMessage("["+e.keyCode+"] "),Action.updateLineNumberDisplay();var t=e.keyCode;if(!(t>=33&&t<=40)){var n=e.target.id;Action.umpleTypingActivity(n)}},Action.umpleCodeMirrorCursorActivity=function(){var e=Page.codeMirrorEditor6.state.selection.main.head,t=Page.codeMirrorEditor6.state.doc.lineAt(e);jQuery("#linenum").val(t.number)},Action.umpleCodeMirrorTypingActivity=function(e){clientDebuggerFlag&&console.log("Inside Action.umpleCodeMirrorTypingActivity..."),Action.freshLoad==!1?(Action.umpleTypingActivity(e),e=="codeMirrorEditor"&&Page.codeMirrorEditor.save()):(Action.freshLoad=!1,Action.setjustUpdatetoSaveLaterForTextCallback(!1))},Action.trimMultipleNonPrintingAndComments=function(e){return e=Action.removeComments(e),e=e.replace(/[^\x21-\x7E]+/g," "),e=e.replace(/^\s+|\s+$/g,""),e},Action.removeComments=function(e){var t="_"+ +new Date,n=[],r=0;return e.replace(/(['"])(\\\1|.)+?\1/g,function(o){return n[r]=o,t+""+r++}).replace(/([^\/])(\/(?!\*|\/)(\\\/|.)+?\/[gim]{0,3})/g,function(o,a,s){return n[r]=s,a+(t+"")+r++}).replace(/\/\/.*?\/?\*.+?(?=\n|\r|$)|\/\*[\s\S]*?\/\/[\s\S]*?\*\//g," ").replace(/\/\/.+?(?=\n|\r|$)|\/\*[\s\S]+?\*\//g," ").replace(RegExp("\\/\\*[\\s\\S]+"+t+"\\d+","g")," ").replace(RegExp(t+"(\\d+)","g"),function(o,a){return n[a]})},Action.umpleTypingActivity=function(e){clientDebuggerFlag&&console.log("Inside Action.umpleTypingActivity()..."),Action.manualSync&&Action.diagramInSync&&(jQuery("#umpleCanvasColumn").is(":visible")&&Page.enablePaletteItem("buttonSyncDiagram",!0),Action.diagramInSync=!1,Page.enableDiagram(!1)),Action.oldTimeout!=null&&clearTimeout(Action.oldTimeout),e=="diagramEdit"?Action.oldTimeout=setTimeout('Action.processTyping("'+e+'",false)',500):Action.oldTimeout=setTimeout('Action.processTyping("'+e+'",false)',Action.waiting_time)},Action.processTyping=function(e,t,n){if(clientDebuggerFlag&&console.log("Inside Action.processTyping ...",e),document.getElementById("newEditor").value=Page.codeMirrorEditor6.state.doc.toString(),e!="diagramEdit"?Action.setjustUpdatetoSaveLaterForTextCallback(!0):Action.setjustUpdatetoSaveLaterForTextCallback(!1),!Action.manualSync||t)if(Action.diagramInSync=!0,e=="umpleModelEditorText"||e=="codeMirrorEditor"||e=="newEditor"){Action.updateLayoutEditorAndDiagram(e);var r=document.getElementById("downloadLink");r!==null&&r.remove(),Page.enablePaletteItem("buttonSyncDiagram",!1)}else e=="diagramEdit"&&Action.ajax(Action.updateFromDiagramCallback,Action.getLanguage());e!="diagramEdit"&&(justUpdatetoSaveLater?(e=="umpleModelEditorText"||e=="codeMirrorEditor"||e=="newEditor")&&Action.setjustUpdatetoSaveLater(!1):TabControl.getCurrentHistory().save(Page.getUmpleCode(),"processTyping"),Page.setExampleMessage(""))},Action.updateCurrentUmpleTextBeingEdited=function(e){Page.currentUmpleTextBeingEdited=e,jQuery("#umpleModelEditorText").val(e),Page.setCodeMirror6Text(e)},Action.updateLayoutEditorAndDiagram=function(e){Action.ajax(Action.updateUmpleLayoutEditor,"language=Json",e)},Action.updateUmpleLayoutEditor=function(e){var t=e.responseText.split("URL_SPLIT"),n=t[0],r=t[1];(r==null||r==null)&&(r=e.responseText),Page.showLayoutLoading(),Action.ajax(Action.updateUmpleLayoutEditorCallback,format("action=addPositioning&actionCode={0}",r))},Action.updateUmpleLayoutEditorCallback=function(e){var t=e.responseText,n=Page.splitUmpleCode(t)[1];Page.setUmplePositioningCode(n),Page.hideLoading(),Action.updateUmpleDiagramForce(!0)},Action.updateUmpleDiagram=function(){return Action.updateUmpleDiagramForce(!0)},Action.updateUmpleDiagramForce=function(e){var t=Action.trimMultipleNonPrintingAndComments(Page.getUmpleCode());!e&&t==Action.savedCanonical||(Action.savedCanonical=t,Page.showCanvasLoading(),Action.ajax(Action.updateUmpleDiagramCallback,Action.getLanguage()))},Action.updateUmpleDiagramCallback=function(response){var theCanvas=jQuery("#umpleCanvas"),canvasX=Math.round(theCanvas.offset().left),canvasY=Math.round(theCanvas.offset().top),diagramCode="",errorMessage="";if(diagramCode=Action.getDiagramCode(response.responseText),errorMessage=Action.getErrorCode(response.responseText),Page.hideExecutionArea(),diagramCode==null||diagramCode==""||diagramCode=="null")Page.enableDiagram(!1),Action.diagramInSync=!1,Page.setFeedbackMessage('<a href="#errorClick">See message.</a> To fix: edit model or click undo');else{Page.enableDiagram(!0),Action.diagramInSync||(Action.diagramInSync=!0),Page.setFeedbackMessage(""),Page.hideGeneratedCode();var dynamicCheckboxItems=Page.getUmpleCode().match(/(((?<!(\/\/.*))(mixset))|((?<!(\/\/.*))(filter)))\s+[a-zA-Z1-9-_]+/g);dynamicCheckboxItems==null&&(dynamicCheckboxItems=new Array),dynamicCheckboxItems.push("gvmanual","gvdot","gvsfdp","gvcirco","gvortho");var spanToInjectItem=document.getElementById("ShowMFDynamicArea");if(spanToInjectItem.innerHTML="",!(dynamicCheckboxItems==null||dynamicCheckboxItems.length==0)){var boxesToActivate=new Array;dynamicCheckboxItems.forEach(function(e){var t=e.replace(/\s/g,""),n='<li id="tt'+t+'" class="layoutListItem view_opt_class">                <input id="button'+t+'" class="checkbox" type="checkbox"/>                <a id="label'+t+'" class="buttonExtend">'+e+"</a>              </li>";spanToInjectItem.innerHTML+=n,boxesToActivate.push(t)}),Page.mixsetsActive=Page.mixsetsActive.filter(function(e){return boxesToActivate.includes("mixset"+e)}),Page.filtersActive=Page.filtersActive.filter(function(e){return boxesToActivate.includes("filter"+e)}),Page.specialSuboptionsActive=Page.specialSuboptionsActive.filter(function(e){return boxesToActivate.includes(e)}),boxesToActivate.forEach(function(e){Page.initHighlighter("button"+e);var t=!1;(e.substr(0,6)=="mixset"&&Page.mixsetsActive.includes(e.substr(6))||e.substr(0,6)=="filter"&&Page.filtersActive.includes(e.substr(6))||e.substr(0,2)=="gv"&&Page.specialSuboptionsActive.includes(e))&&(t=!0),jQuery("#button"+e).prop("checked",t),Page.initAction("button"+e),Page.initLabel("label"+e),ToolTips.setATooltipBasic(ToolTips.dynamicTooltips,"tt"+e,"right"),jQuery("#tt"+e).show()})}if(Page.useEditableClassDiagram){var newSystem=Json.toObject(diagramCode);UmpleSystem.merge(newSystem),UmpleSystem.update(),Page.readOnly&&jQuery("span.editable").addClass("uneditable")}else if(Page.useJointJSClassDiagram){var model=JSON.parse(diagramCode.replace(new RegExp('} { "name": "',"gi"),'}, { "name": "')),umpleCanvas=jQuery("#umpleCanvas"),paper=JJSdiagram.initJJSDiagram(umpleCanvas,model),MouseWheelHandler=function(e){var t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));if(e.altKey===!0){var n=paper.options.height,r=paper.options.width,o=1+Math.abs(t)/(t*10);paper.setDimensions(r*o,n*o),JJSdiagram.paper&&JJSdiagram.paper.setDimensions(jQuery("#umpleCanvas")[0].clientWidth,jQuery("#umpleCanvas")[0].clientHeight)}},paperHolder=document.getElementById("umpleCanvas");paperHolder.addEventListener?(paperHolder.addEventListener("mousewheel",MouseWheelHandler,!1),paperHolder.addEventListener("DOMMouseScroll",MouseWheelHandler,!1)):paperHolder.attachEvent("onmousewheel",MouseWheelHandler),jQuery("#jjsPaper").click(function(){Action.focusOn(Page.umpleCanvasId(),!0)})}else if(Page.useGvClassDiagram||Page.useGvStateDiagram||Page.useGvFeatureDiagram){if(theCanvas.html(format("{0}",diagramCode)),theCanvas.children().first().attr("id","svgCanvas"),Page.useGvClassDiagram&&Page.isGvManual()){var algoWasRemoved=Action.deactivateSpecialLayoutAlgorithmsExcept(null),positioningCode=jQuery("#umpleLayoutEditorText").val(),elems=document.getElementsByClassName("node"),posMap=new Array,minUmpleLeft=9999999,minUmpleTop=9999999,minRectLeft=9999999,minRectTop=9999999;for(let u=0;u<elems.length;u++){var currentClassForPos=Action.getGvClassNameFromNode(elems[u]),umplePosOfCurrentClass=Action.getGvPosition(positioningCode,currentClassForPos);if(umplePosOfCurrentClass!=null){var theRect=Action.getRectFromSvgNode(elems[u],canvasX,canvasY),rectLeft=theRect.left,rectTop=theRect.top,rectCentreX=theRect.centreX,rectCentreY=theRect.centreY,uLeft=umplePosOfCurrentClass.x,uTop=umplePosOfCurrentClass.y;posMap.push({className:currentClassForPos,fullUmplePosOfCurrentClass:umplePosOfCurrentClass.all,left:uLeft,umpleX:Number(umplePosOfCurrentClass.x)+Number(umplePosOfCurrentClass.width)/2,rectCentreX,top:uTop,umpleY:Number(umplePosOfCurrentClass.y)+Number(umplePosOfCurrentClass.height)/2,rectCentreY,associationPos1:umplePosOfCurrentClass.assoc1,associationPos2:umplePosOfCurrentClass.assoc2}),minUmpleLeft=Math.min(minUmpleLeft,uLeft),minUmpleTop=Math.min(minUmpleTop,uTop),minRectLeft=Math.min(minRectLeft,rectLeft),minRectTop=Math.min(minRectTop,rectTop)}}let c=minUmpleLeft-minRectLeft,d=minUmpleTop-minRectTop;var nodesMoved=0;posMap.forEach(function(u){var g=Math.round(u.rectCentreX+c-u.umpleX),h=Math.round(u.rectCentreY+d-u.umpleY);(Math.abs(g)>10||Math.abs(h)>10)&&(nodesMoved++,Action.updateGVPositionBasic(u.className,g,h,positioningCode,u.fullUmplePosOfCurrentClass,u.left,u.top,u.associationPos1,u.associationPos2,!1))}),algoWasRemoved&&TabControl.getCurrentHistory().save(Page.getUmpleCode(),"moveClass")}const t=Page.getUmpleCode().split(`
`),n={};let r=null;const o=/^class\s+(\w+)/,a=/\s*(--\*|--|\*--\*|->|<-)\s*/,s=/^isA\s+([A-Za-z0-9_,\s]+);?/;for(let c=0;c<t.length;c++){const d=t[c].trim();if(d.includes("//$?[End_of_model]$?"))break;const u=d.match(o);if(u){r=u[1],n[r]||(n[r]=[]);continue}if(!r)continue;const f=d.match(s);if(f){const h=f[1].split(",").map(b=>b.trim().replace(/[^a-zA-Z0-9_]/g,""));n[r].push(...h);continue}const g=d.split(a);if(g.length>=3){const b=g[2].trim().split(/\s+/),S=(b.length>1?b[1]:b[0]).replace(/[^a-zA-Z0-9_]/g,"");S&&n[r].push(S)}}for(const[c,d]of Object.entries(n))for(const u of d)n[u]||(n[u]=[]),n[u].includes(c)||n[u].push(c);Action.neighbors=n,Action.setupPinch()}else Page.useStructureDiagram&&(jQuery("#umpleCanvas").html('<svg id="svgCanvas"></svg>'),eval(diagramCode))}if(errorMessage!=""&&Page.showGeneratedCode(errorMessage,"diagramUpdate"),Page.hideLoading(),Page.useGvClassDiagram){allowNodeMovement=!0,Page.isGvManual()||(allowNodeMovement=!1);var elems=document.getElementsByClassName("node");for(let t=0;t<elems.length;t++){let n=elems[t];n.addEventListener("contextmenu",function(r){r.preventDefault(),Action.displayMenu(r)}),n.addEventListener("dblclick",function(r){r.preventDefault(),Action.displayMenu(r)}),n.addEventListener("mousedown",function(r){r.preventDefault();let o=0,a=0,s=!1;Page.selectedGvClass=Action.getGvClassName(r),Page.initialMouseDownX=r.clientX,Page.initialMouseDownY=r.clientY;let c=Page.initialMouseDownX,d=Page.initialMouseDownY,u=Action.getRectFromSvgNode(n,canvasX,canvasY),f=u.top,g=u.left;function h(E){E.preventDefault();let S=E.clientX,D=E.clientY;u=Action.getRectFromSvgNode(n,canvasX,canvasY),f=u.top,g=u.left;let j=S-c,p=D-d;o+=j,a+=p,allowNodeMovement&&(s||Math.abs(o+a)>10)&&(n.setAttribute("transform"," translate("+o+","+a+")"),s=!0),c=S,d=D,allowNodeMovement||Page.setFeedbackMessage("To enable moving of classes in G mode, set gvmanual in the Show and Hide menu")}function b(E){allowNodeMovement&&s&&(o!=0||o!=0)&&Action.updateGvPosition(Page.selectedGvClass,o,a),document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",b)}document.addEventListener("mousemove",h),document.addEventListener("mouseup",b)});var attributeAnchors=elems[t].getElementsByTagName("a");for(let r=1;r<attributeAnchors.length;r++){let o=attributeAnchors[r].getAttribute("xlink:title"),[a,s]=o.split(" ");attributeAnchors[r].addEventListener("dblclick",function(c){c.preventDefault(),Action.displayAttributeMenu(c,s,a)}),attributeAnchors[r].addEventListener("contextmenu",function(c){c.preventDefault(),c.stopPropagation(),Action.displayAttributeMenu(c,s,a)})}}var associationElems=document.getElementsByClassName("edge");for(let t=0;t<associationElems.length;t++){var associationAnchors=associationElems[t].getElementsByTagName("a");for(let n=0;n<associationAnchors.length;n++){let r=associationAnchors[n].getAttribute("xlink:href");associationAnchors[n].addEventListener("dblclick",function(o){o.preventDefault(),Action.displayAssociMenu(o,r)}),associationAnchors[n].addEventListener("contextmenu",function(o){o.preventDefault(),Action.displayAssociMenu(o,r)})}}}if(Page.useGvStateDiagram){var elems=document.getElementsByClassName("node");for(let t=0;t<elems.length;t++)elems[t].addEventListener("contextmenu",function(n){n.preventDefault(),Action.drawStateMenu(n)}),elems[t].addEventListener("dblclick",function(n){n.preventDefault(),Action.drawStateMenu(n)});elems=document.getElementsByClassName("cluster");for(let t=0;t<elems.length;t++)elems[t].addEventListener("contextmenu",function(n){n.preventDefault(),Action.drawStateMenu(n)}),elems[t].addEventListener("dblclick",function(n){n.preventDefault(),Action.drawStateMenu(n)});var transitionElems=document.getElementsByClassName("edge");for(let t=0;t<transitionElems.length;t++)transitionElems[t].addEventListener("dblclick",function(n){n.preventDefault(),Action.displayTransitionMenu(n)}),transitionElems[t].addEventListener("contextmenu",function(n){n.preventDefault(),Action.displayTransitionMenu(n)})}},Action.deactivateSpecialLayoutAlgorithmsExcept=function(e){var t=new Array,n=!1;return t.push("gvdot","gvsfdp","gvcirco"),e!=null&&!t.includes(e)?!1:(t.forEach(function(r){if(e==null||r!=e){jQuery("#button"+r).prop("checked",!1);var o=Page.specialSuboptionsActive.indexOf(r);o!==-1&&(Page.specialSuboptionsActive.splice(o,1),n=!0)}}),n)},Action.getRectFromSvgNode=function(e,t,n){var r=e.getBoundingClientRect();return{left:Math.round(r.left-t),top:Math.round(r.top-n),centreX:Math.round(r.left-t+Math.abs(r.width/2)),centreY:Math.round(r.top-n+Math.abs(r.height/2))}},Action.updateFromDiagramCallback=function(e){var t="",n="";t=Action.getDiagramCode(e.responseText),n=Action.getErrorCode(e.responseText),(t==null||t==""||t=="null")&&Action.diagramInSync?(Page.enableDiagram(!1),Action.diagramInSync=!1,Page.setFeedbackMessage('<a href="#errorClick">See message.</a> To fix: edit model or click undo')):(Page.enableDiagram(!0),Action.diagramInSync=!0),n!=""?(Action.lastCompilerErrorHtml=n,Page.showGeneratedCode(n,"diagramUpdate")):Action.lastCompilerErrorHtml=""},Action.getDiagramCode=function(e){var t="";if(Page.useEditableClassDiagram||Page.useJointJSClassDiagram)t=e.split("URL_SPLIT")[1],t=="null"&&(t="");else if(Page.useGvClassDiagram||Page.useGvStateDiagram||Page.useGvFeatureDiagram){var n=e.split("<svg width=");n.length>1&&n[1].length>100&&(t="<svg width="+n[1],t=t.replace(/<\/svg>$/,""))}else Page.useStructureDiagram&&(t=e.split("<p>URL_SPLIT")[1],t=t.replace(/##CANVAS_ID##/g,"svgCanvas"),t=jQuery("<div/>").html(t).text());return t},Action.getErrorCode=function(e){var t="";if(Page.useEditableClassDiagram||Page.useStructureDiagram)t=e.split("URL_SPLIT")[0],t=="<p>"&&(t="");else if(Page.useGvClassDiagram||Page.useGvStateDiagram||Page.useGvFeatureDiagram){var n=e.split("<svg width=")[0],r=n.split("errorRow");r.length>1&&(t=n.split("<\/script>&nbsp;")[0])}return t},Action.classResizing=function(e,t){var n=e.target.id,r=UmpleSystem.find(n),o="#"+n,a=Math.round(jQuery(o).width()),s=Math.round(jQuery(o).height());UmpleSystem.updatingSize(r,a,s)},Action.associationSnap=function(e,t,n){var r=jQuery(n).prop("id"),o=r.substr(0,r.lastIndexOf("_")),a=r.substr(r.lastIndexOf("_")+6+1),s=UmpleSystem.findAssociation(o),c=s.getClass(a),d=UmpleClassFactory.perimeterPosition(c,new UmplePosition(e,t,0,0),UmpleSystem.position());return[d.x,d.y]},Action.associationSnapClassReady=function(e,t,n){var r=UmpleClassFactory.perimeterPosition(n,new UmplePosition(e,t,0,0),UmpleSystem.position());return[r.x,r.y]},Action.updateMovedAssociation=function(e,t){jQuery(e).show();var n=jQuery(e).offset(),r=jQuery(e).prop("id");jQuery(e).hide();var o=Math.round(n.left),a=Math.round(n.top),s=Action.associationSnap(o,a,e),c=new UmplePosition(s[0],s[1],0,0);r.endsWith("_anchor0")?t.setOffsetOnePosition(c):t.setOffsetTwoPosition(c),UmpleSystem.redrawAssociation(t),Action.associationSelected(null)},Action.validateAttributeName=function(e){return e.length!=0&&(e.match(/^[_a-zA-Z0-9]+$/)||e.match(/^[_a-zA-Z0-9]+[\u0020]*:[\u0020]*[_a-zA-Z0-9]+(\[\])?$/))},Action.validateMethodName=function(e){return e.length!=0&&e.match(/^[-+#]?\s*[_a-zA-Z0-9]+\s*\(([_a-zA-Z0-9]+(\[\])?(,\s*[_a-zA-Z0-9]+(\[\])?)*)?\)(\s*:\s*[_a-zA-Z0-9]+(\[\])?)?$/)},Action.toggleAttributes=function(){Page.showAttributes=!Page.showAttributes,Action.redrawDiagram()},Action.toggleMethods=function(){Page.showMethods=!Page.showMethods,Action.redrawDiagram()},Action.toggleActions=function(){Page.showActions=!Page.showActions,Action.redrawDiagram()},Action.toggleTransitionLabels=function(){Page.showTransitionLabels=!Page.showTransitionLabels,Action.redrawDiagram()},Action.toggleGuards=function(){Page.showGuards=!Page.showGuards,Action.redrawDiagram()},Action.toggleGuardLabels=function(){Page.showGuardLabels=!Page.showGuardLabels,Action.redrawDiagram()},Action.allowPinch=function(){Page.allowPinch=!Page.allowPinch,Action.redrawDiagram()},Action.toggleFeatureDependency=function(){Page.showFeatureDependency=!Page.showFeatureDependency,Action.redrawDiagram()},Action.toggleTraits=function(){Page.showTraits=!Page.showTraits,Action.redrawDiagram()},Action.redrawDiagram=function(){UmpleSystem.merge(null);var e=jQuery("#umpleCanvas");e.html(""),Action.manualSync||(Action.updateUmpleDiagram(),Action.diagramInSync=!0),Action.manualSync&&!Action.diagramInSync&&Page.enablePaletteItem("buttonSyncDiagram",!0),(!Action.manualSync||Action.diagramInSync)&&(Page.enableCheckBoxItem("buttonPhotoReady","ttPhotoReady",!0),Page.enableCheckBoxItem("buttonManualSync","ttManualSync",!0),Page.enablePaletteItem("buttonAddClass",!0),Page.enablePaletteItem("buttonAddAssociation",!0),Page.enablePaletteItem("buttonAddTransition",!0),Page.enablePaletteItem("buttonAddGeneralization",!0),Page.enablePaletteItem("buttonDeleteEntity",!0),Page.initToggleTool("buttonAddClass"),Page.initToggleTool("buttonAddAssociation"),Page.initToggleTool("buttonAddTransition"),Page.initToggleTool("buttonAddGeneralization"),Page.initToggleTool("buttonDeleteEntity"))},InlineEditor.elementChanged=function(e,t,n){var r=e.attr("name"),o=e.attr("id");if(r=="className"){var a=o.substr(0,o.length-5);DiagramEdit.classNameChanged(a,t,n)}else if(r=="attributeEdit"){var s=o.substr(o.lastIndexOf("_")+1),a=o.substr(0,o.length-11-s.length);DiagramEdit.attributeNameChanged(a,s,t,n)}else if(r=="methodEdit"){var s=o.substr(o.lastIndexOf("_")+1),a=o.substr(0,o.length-8-s.length);DiagramEdit.methodChanged(a,s,t,n)}else if(r=="attributeNew"){var a=o.substr(0,o.length-13);DiagramEdit.attributeNew(a,n)}else if(r=="methodNew"){var a=o.substr(0,o.length-10);DiagramEdit.methodNew(a,n)}},Action.enableManualSync=function(e){var t=jQuery("#buttonManualSync"),n=jQuery("#buttonSyncDiagram");e==null&&(e=t.is(":checked")),e?Action.manualSync=!0:(Action.manualSync=!1,Action.processTyping("umpleModelEditorText",!0),Page.enablePaletteItem("buttonSyncDiagram",!1))},Action.generateStructureDiagramFile=function(){var e=Page.getFilename().slice(0,-9)+"structureDiagram.svg",t=jQuery("#innerGeneratedCodeRow").html().slice(4,-1);t=format('<svg xmlns="http://www.w3.org/2000/svg" {0}>',t),jQuery("#buttonStructureLink").showLoading(),Ajax.sendRequest("scripts/compiler.php",Action.generateStructureDiagramFileCallback,format("save=1&filename={0}&svgContent={1}",e,t))},Action.generateStructureDiagramFileCallback=function(e){jQuery("#buttonStructureLink").hideLoading(),Page.toggleStructureDiagramLink(!0,e.responseText)},Action.ajax=function(e,t,n,d,o){var a=null;a=Page.getUmpleCode();var s=encodeURIComponent(a),c=Page.getFilename(),d="true";TabControl.useActiveTabTo(TabControl.saveTab)(s),t=t+"&theme="+Action.getThemePreference();var u=TabControl.getActiveTabId(),f=o?e:function(g){var h=TabControl.getActiveTabId();if(h!==u){Page.hideLoading();return}e(g)};Ajax.sendRequest("scripts/compiler.php",f,format("{0}&error={3}&umpleCode={1}&filename={2}",t,s,c,d))},navigator.appVersion.indexOf("Mac")!=-1?(jQuery(document).ready(function(){jQuery("#undosmall").html("[cmd+z]"),jQuery("#redosmall").html("[cmd+shift+z]")}),Mousetrap.bind(["command+z"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Action.undo(),e.preventDefault()}),Mousetrap.bind(["command+shift+z"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Action.redo(),e.preventDefault()})):(jQuery(document).ready(function(){jQuery("#undosmall").html("[ctrl+z]"),jQuery("#redosmall").html("[ctrl+y]")}),Mousetrap.bind(["ctrl+z"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Action.undo(),e.preventDefault()}),Mousetrap.bind(["ctrl+y"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Action.redo(),e.preventDefault()})),Mousetrap.bind(["up"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(0,-5,0,0)),!1}),Mousetrap.bind(["shift+up"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(0,-1,0,0)),!1}),Mousetrap.bind(["down"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(0,5,0,0)),!1}),Mousetrap.bind(["shift+down"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(0,1,0,0)),!1}),Mousetrap.bind(["left"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(-5,0,0,0)),!1}),Mousetrap.bind(["shift+left"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(-1,0,0,0)),!1}),Mousetrap.bind(["right"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(5,0,0,0)),!1}),Mousetrap.bind(["shift+right"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(1,0,0,0)),!1}),Mousetrap.bind(["ctrl+e"],function(e){return Page.clickShowEditableClassDiagram(),!1}),Mousetrap.bind(["ctrl+j"],function(e){return Page.clickShowJointJSClassDiagram(),!1}),Mousetrap.bind(["ctrl+g"],function(e){return Page.clickShowGvClassDiagram(),!1}),Mousetrap.bind(["ctrl+s"],function(e){return Page.clickShowGvStateDiagram(),!1}),Mousetrap.bind(["ctrl+l"],function(e){return Page.clickShowStructureDiagram(),!1}),Mousetrap.bind(["ctrl+t","ctrl+alt+shift+t"],function(e){return Page.clickShowHideText(),!1}),Mousetrap.bind(["ctrl+d"],function(e){return Page.clickShowHideCanvas(),!1}),Mousetrap.bind(["ctrl+n","ctrl+alt+n"],function(e){return Page.clickShowHideMenu(),!1}),Mousetrap.bind(["shift+ctrl+a"],function(e){return Page.clickToggleAttributes(),!1}),Mousetrap.bind(["ctrl+m"],function(e){return Page.clickToggleMethods(),!1}),Mousetrap.bind(["ctrl+r"],function(e){return Page.clickToggleTraits(),!1}),Mousetrap.bind(["ctrl+i"],function(e){return Page.clickToggleTransitionLabels(),!1}),Mousetrap.bind(["ctrl+k"],function(e){return Page.clickToggleGuardLabels(),!1}),Mousetrap.bind(["ctrl+b"],function(e){return Action.promptAndExecuteTest(),!1}),Mousetrap.bind(["ctrl+o"],function(e){return Action.copyCommandLineCode(),!1}),Mousetrap.bind(["g"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Page.selectedAssociation==null&&Page.selectedGeneralization==null&&(Page.selectedClass==null||Page.selectedClass&&jQuery("#"+Page.selectedClass.id).find("input").length==0)&&jQuery("#buttonAddGeneralization").click()}),Mousetrap.bind(["a"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Page.selectedAssociation==null&&Page.selectedGeneralization==null&&(Page.selectedClass==null||Page.selectedClass&&jQuery("#"+Page.selectedClass.id).find("input").length==0)&&jQuery("#buttonAddAssociation").click()}),Mousetrap.bind(["c"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Page.selectedAssociation==null&&Page.selectedGeneralization==null&&(Page.selectedClass==null||Page.selectedClass&&jQuery("#"+Page.selectedClass.id).find("input").length==0)&&jQuery("#buttonAddClass").click()}),Action.toggleTabsCheckbox=function(e){$("inputGenerateCode").value.split(":")[1]=="TextUml"&&(e="TextUml"),e=="java"||e=="php"||e=="cpp"||e=="python"||e=="ruby"||e=="sql"?(jQuery("#ttTabsCheckbox").show(),jQuery("#tabRow").show(),($("inputGenerateCode").value.split(":")[1]=="USE"||$("inputGenerateCode").value.split(":")[1]=="UmpleSelf"||$("inputGenerateCode").value.split(":")[1]=="Json")&&(jQuery("#ttTabsCheckbox").hide(),jQuery("#tabRow").hide())):(jQuery("#ttTabsCheckbox").hide(),jQuery("#tabRow").hide(),jQuery("#buttonTabsCheckbox").is(":checked")&&jQuery("#buttonTabsCheckbox").click())},Action.toggleTabs=function(){jQuery("#buttonTabsCheckbox").is(":checked")?(jQuery("#tabRow").show(),jQuery("#innerGeneratedCodeRow").hide(),jQuery("#tabButton1").click()):(jQuery("#tabRow").hide(),jQuery("#innerGeneratedCodeRow").show(),jQuery("#innerGeneratedCodeRow").nextAll().hide())},Action.generateTabsCode=function(e){var t=[],n=0,r="",o=[],a="",s=!1;for(e.split("URL_SPLIT")[1].split(`
`).forEach(function(c){c.indexOf("//%%")>=0||c.indexOf("# %%")>=0?(n++,strFileName=c.slice(14),strFileName=strFileName.substr(0,strFileName.indexOf(" ")),o[n]=strFileName,jQuery("#generatedCodeRow").append("<div id='innerGeneratedCodeRow"+n+"'></div>"),t[n]="",s=!0):s?s=!1:t[n]+=c+`
`}),i=1;i<=n;i++)jQuery("#tabRow").append("<button type='button' id='tabButton"+i+"'>"+o[i]+"</button>"),jQuery("#tabButton"+i).click({code:t[i],tabnumber:i},showTab)},Action.getLanguage=function(){var e="";if(Page.useEditableClassDiagram?e="language=Json":Page.useJointJSClassDiagram?e="language=JsonMixed":Page.useGvClassDiagram?Page.showTraits?e="language=traitDiagram":e="language=classDiagram":Page.useGvStateDiagram?e="language=stateDiagram":Page.useStructureDiagram&&(e="language=StructureDiagram"),Page.useGvStateDiagram&&(Page.showActions||(e=e+".hideactions"),Page.showTransitionLabels&&(e=e+".showtransitionlabels"),Page.showGuards||(e=e+".hideguards"),Page.showGuardLabels&&(e=e+".showguardlabels"),e=e+"."+$("inputGenerateCode").value.split(":")[1]),Page.useGvClassDiagram&&(Page.showMethods&&(e=e+".showmethods"),Page.showAttributes||(e=e+".hideattributes")),Page.useGvFeatureDiagram&&(e="language=featureDiagram",Page.showFeatureDependency&&(e=e+".showFeatureDependency")),copyableMixset="",Page.filterWordsOutput!=""){e=e+".!@FW!@"+Page.filterWordsOutput;var t="";Page.filterWordsOutput.split("!@").forEach(function(r){r!=""&&(isNaN(r)?r.substr(0,2)=="gv"?r.substr(0,11)=="gvseparator"?copyableMixset+='  suboption "'+r.replace("@@@","")+`";
`:copyableMixset+='  suboption "'+r+`";
`:r.substr(0,6)=="filter"?copyableMixset+="  filter {includeFilter "+r.substr(6)+`;}
`:r.substr(0,6)=="mixset"?copyableMixset+="  use "+r.substr(6)+`;
`:t+=" include "+r+";":t+="  hops { association "+r+";} ")}),t!=""&&(copyableMixset+="  filter {"+t+`}
`)}Page.filtersActive.forEach(function(r){e=e+".filter"+r,copyableMixset+="  filter {includeFilter "+r+`;}
`}),Page.mixsetsActive.forEach(function(r){e=e+".mixset"+r,copyableMixset+="  use "+r+`;
`}),Page.specialSuboptionsActive.forEach(function(r){e=e+"."+r,copyableMixset+='  suboption "'+r+`";
`});var n=Math.floor(Math.random()*899+100);return Page.copyableMixset=`// The following was generated from the show and hide options
// Rename the mixset and paste into the code so you can invoke it at any time
mixset M`+n+` {
`+copyableMixset+"}",e};function showTab(e){jQuery("#innerGeneratedCodeRow").nextAll().hide(),jQuery("#innerGeneratedCodeRow"+e.data.tabnumber).show(),Page.showGeneratedCode(e.data.code,$("inputGenerateCode").value.split(":")[0],e.data.tabnumber),jQuery("#innerGeneratedCodeRow").hide()}Action.hidegdpr=function(){jQuery("#gdprtext").hide(),Action.gdprHidden=!0},Action.reindent=function(e,t){for(var n="",r="",o=e.length,a=!1,s=!0,c=0,d=-1,u=0;u<o;u++){for(var f=e[u].trim(),g=f.indexOf('"'),h=f.indexOf('"',g+1);g!=-1&&h!=-1;)f=f.slice(0,g)+f.slice(h+1,f.length),g=f.indexOf('"'),h=f.indexOf('"',g+1);if(f.indexOf("//")!=-1&&(f=f.substr(0,f.indexOf("//")).trim()),a)if(f.indexOf("*/")!=-1)f=f.substr(f.indexOf("*/")+2).trim(),a=!1;else{u!=e.length-1?r+=e[u]+`
`:r+=e[u];continue}else f.indexOf("/*")!=-1&&(f.indexOf("*/")==-1?(a=!0,f=f.substr(0,f.indexOf("/*")).trim()):f=f.substr(0,f.indexOf("/*"))+f.substr(f.indexOf("*/")+2).trim());var b=f.indexOf("{"),E=f.indexOf("}"),S=f.indexOf(";");if(S!=-1&&S!=f.length-1&&f.substr(S+1).trim().charAt(0)!="}"){e.splice(u+1,0,f.substr(S+1)),u<=t.line&&t.line++,e[u]=e[u].substr(0,e[u].match(/^\s*/)[0].length+S+1),Action.reindent(e,t);return}var D=b!=-1&&E!=-1&&E-b<40&&f.substr(0,E).indexOf("{",b+1)==-1;if(D){if(E!=f.length-1){e.splice(u+1,0,f.substr(E+1)),u<=t.line&&t.line++,e[u]=e[u].substr(0,e[u].match(/^\s*/)[0].length+E+1),Action.reindent(e,t);return}s?e[u]=n+e[u].trim():f.slice(-1)=="{"?s=!0:(e[u]=n+e[u].match(/^\s*/)[0].substr(c)+e[u].trim(),f.indexOf(";")==f.length-1&&(s=!0))}else{if(b!=-1&&b!=f.length-1){e.splice(u+1,0,f.substr(b+1)),e[u]=e[u].substr(0,e[u].match(/^\s*/)[0].length+b+1),u<=t.line&&t.line++,Action.reindent(e,t);return}if(E!=-1&&f.length>1){E==0?(e.splice(u+1,0,f.substr(1)),e[u]="}",u<=t.line&&t.line++):(e.splice(u+1,0,"}"),u<=t.line&&t.line++,E!=f.length-1&&(e.splice(u+2,0,f.substr(E+1)),u<=t.line&&t.line++),e[u]=e[u].substr(0,e[u].match(/^\s*/)[0].length+E)),Action.reindent(e,t);return}s&&f.indexOf(";")!=f.length-1&&f.slice(-1)!="{"&&f.slice(-1)!="}"&&f.slice(-2)!="||"&&(s=!1,c=e[u].match(/^\s*/)[0].length),E!=-1&&(n=n.substr(2)),s?e[u]=n+e[u].trim():f.slice(-1)=="{"||f.slice(-2)=="||"&&f.slice(-1)=="}"?(s=!0,e[u]=n+e[u].trim()):(e[u]=n+e[u].match(/^\s*/)[0].substr(c)+e[u].trim(),f.indexOf(";")==f.length-1&&(s=!0)),b!=-1&&(n+="  ")}u!=e.length-1?r+=e[u]+`
`:r+=e[u]}Page.codeMirrorOn&&Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:r}}),Action.updateCurrentUmpleTextBeingEdited(r);var j=Page.getRawUmpleCodeCM6().split(`
`)[Page.codeMirrorEditor6.state.doc.lineAt(Page.codeMirrorEditor6.state.selection.main.head).number],p=j.match(/^\s*/)[0].length;if(t.ch>=j.trim().length)Page.codeMirrorEditor6.dispatch({selection:{anchor:t.line,head:j.trim().length+p}});else if(t.ch>=0)Page.codeMirrorEditor6.dispatch({selection:{anchor:t.line,head:t.ch+p}});else{const C=Page.codeMirrorEditor6.state.selection.main.head;Page.codeMirrorEditor6.dispatch({selection:{anchor:C,head:C}})}Page.codeMirrorEditor6.focus()},DiagramEdit=new Object,DiagramEdit.textChangeQueue=[],DiagramEdit.pendingChanges=!1,DiagramEdit.newClass=null,DiagramEdit.newAssociation=null,DiagramEdit.newTransition=null,DiagramEdit.newGeneralization=null,DiagramEdit.updateUmpleText=function(e){DiagramEdit.textChangeQueue.length==0&&!DiagramEdit.pendingChanges?(DiagramEdit.pendingChanges=!0,DiagramEdit.textChangeQueue.push(e),DiagramEdit.doTextUpdate()):DiagramEdit.textChangeQueue.push(e),Action.umpleTypingActivity("diagramEdit")},DiagramEdit.doTextUpdate=function(){update=DiagramEdit.textChangeQueue.shift(),Action.update=update,update.codeChange&&Page.hideGeneratedCode(),Action.ajax(Action.updateUmpleTextCallback,update.actionCode)},DiagramEdit.addClass=function(e){Action.setjustUpdatetoSaveLater(!1),DiagramEdit.removeNewClass();var t=UmpleSystem.createClass(e),n=Json.toString(t);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=addClass&actionCode={0}",n),codeChange:!0})},DiagramEdit.addAssociation=function(e){Action.setjustUpdatetoSaveLater(!1),DiagramEdit.removeNewAssociation();var t=UmpleSystem.createAssociation(e.classOneId,e.classTwoId,e.classOnePosition.add(UmpleSystem.position()),e.classTwoPosition.add(UmpleSystem.position())),n=Json.toString(t);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=addAssociation&actionCode={0}",n),codeChange:!0})},DiagramEdit.addTransition=function(e){Action.setjustUpdatetoSaveLater(!1),DiagramEdit.removeNewTransition();var t=UmpleSystem.createTransition(e.fromStateId,e.toStateId),n=Json.toString(t);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=addTransition&actionCode={0}",n),codeChange:!0})},DiagramEdit.addGeneralization=function(e){Action.setjustUpdatetoSaveLater(!1),DiagramEdit.removeNewGeneralization(),UmpleSystem.createGeneralization(e.childId,e.parentId);var t=Json.toString(e);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=addGeneralization&actionCode={0}",t),codeChange:!0})},DiagramEdit.createAssociationPartOne=function(e){var t=new UmplePosition(e.pageX,e.pageY,0,0),n=UmpleSystem.position(),r=t.x-n.x,o=t.y-n.y;Action.classSelected(e.currentTarget),DiagramEdit.newAssociation=new UmpleAssociation,DiagramEdit.newAssociation.classOneId=e.currentTarget.id,DiagramEdit.newAssociation.classOnePosition=new UmplePosition(r,o,0,0)},DiagramEdit.createAssociationPartTwo=function(e){var t=new UmplePosition(e.pageX,e.pageY,0,0);Action.classSelected(e.currentTarget),DiagramEdit.newAssociation.classOneId<=e.currentTarget.id?(DiagramEdit.newAssociation.classTwoId=e.currentTarget.id,DiagramEdit.newAssociation.classTwoPosition=t.subtract(UmpleSystem.position())):(DiagramEdit.newAssociation.classTwoId=DiagramEdit.newAssociation.classOneId,DiagramEdit.newAssociation.classTwoPosition=DiagramEdit.newAssociation.classOnePosition,DiagramEdit.newAssociation.classOneId=e.currentTarget.id,DiagramEdit.newAssociation.classOnePosition=t.subtract(UmpleSystem.position())),DiagramEdit.addAssociation(DiagramEdit.newAssociation)},DiagramEdit.createTransitionPartOne=function(e){var t=new UmplePosition(e.pageX,e.pageY,0,0),n=UmpleSystem.position(),r=t.x-n.x,o=t.y-n.y;Action.classSelected(e.currentTarget),DiagramEdit.newTransition=new UmpleTransition,DiagramEdit.newTransition.fromStatePosition=e.currentTarget.id,DiagramEdit.newTransition.toStatePosition=new UmplePosition(r,o,0,0),DiagramEdit.newTransition.eventName="event1"},DiagramEdit.createTransitionPartTwo=function(e){var t=new UmplePosition(e.pageX,e.pageY,0,0);Action.classSelected(e.currentTarget),DiagramEdit.newTransition.toStateId=e.currentTarget.id,DiagramEdit.newTransition.toStatePosition=t.subtract(UmpleSystem.position()),DiagramEdit.addTransition(DiagramEdit.newTransition)},DiagramEdit.createGeneralizationPartOne=function(e){var t=UmpleSystem.find(e.currentTarget.id);if(t.extendsClass!=null)return!1;Action.classSelected(e.currentTarget),DiagramEdit.newGeneralization=new UmpleGeneralization,DiagramEdit.newGeneralization.childId=e.currentTarget.id,umpleSystem=UmpleSystem.position(),childPositionX=Dom.x(e)-umpleSystem.x,childPositionY=Dom.y(e)-umpleSystem.y,DiagramEdit.newGeneralization.childPosition=new UmplePosition(childPositionX,childPositionY,0,0)},DiagramEdit.createGeneralizationPartTwo=function(e){Action.classSelected(e.currentTarget),DiagramEdit.newGeneralization.parentId=e.currentTarget.id,DiagramEdit.newGeneralization.parentPosition=new UmplePosition(Dom.x(e),Dom.y(e),0,0),DiagramEdit.addGeneralization(DiagramEdit.newGeneralization)},DiagramEdit.classMoved=function(e){Action.setjustUpdatetoSaveLater(!1);var t=UmpleSystem.find(e.id),n=jQuery("#"+t.id);newPositionX=Math.floor(n.offset().left),newPositionY=Math.floor(n.offset().top),UmpleSystem.updatePosition(t,newPositionX,newPositionY);var r=Json.toString(t),o=Page.getUmpleCode();Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",r),codeChange:!1}),Action.classSelected(e),UmpleSystem.trimOverlappingAssociations(t)},DiagramEdit.classResized=function(e,t){Action.setjustUpdatetoSaveLater(!1);var n=e.target,r=n.id,o=UmpleSystem.find(r);UmpleSystem.updateClass(o),UmpleSystem.redrawGeneralizationsTo(o,g);for(var a=0;a<UmpleSystem.umpleAssociations.length;a++){var s=UmpleSystem.umpleAssociations[a];if(s.contains(o)){var c=s.classOneId==o.id,d=c?s.offsetOnePosition:s.offsetTwoPosition,u=c?"_anchor0":"_anchor1",f="#"+s.id+u,g=!0;DiagramEdit.associationMoved(f,g)}}var h=Json.toString(o),b=Page.getUmpleCode();Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",h),codeChange:!1}),Action.classSelected(n)},DiagramEdit.associationMoved=function(e,t){Action.setjustUpdatetoSaveLater(!1),DiagramEdit.newAssociation!=null&&DiagramEdit.removeNewAssociation(),t==null&&(t=!1);var n=jQuery(e).attr("id"),r=n.substr(0,n.length-8),o=UmpleSystem.findAssociation(r);Action.updateMovedAssociation(e,o);var a=Json.toString(o);Page.showLayoutLoading(),DiagramEdit.updateUmpleText({codeChange:!1,actionCode:format("action=editAssociation&actionCode={0}",a)})},DiagramEdit.regularAssociationMoving=function(e){if(DiagramEdit.newAssociation==null){var t=jQuery(e).attr("id"),n=t.substr(0,t.length-8),r=UmpleSystem.findAssociation(n),o=new UmpleAssociation;t.endsWith("_anchor0")?(o.classOneId=r.classTwoId,o.classOnePosition=r.classTwoPosition,o.offsetOnePosition=r.offsetTwoPosition):(o.classOneId=r.classOneId,o.classOnePosition=r.classOnePosition,o.offsetOnePosition=r.offsetOnePosition),DiagramEdit.newAssociation=o}var a=jQuery(e).offset(),s=Action.associationSnap(Math.round(a.left),Math.round(a.top),e),c=new UmplePosition(s[0],s[1]);DiagramEdit.newAssociation.classTwoPosition=c.subtract(UmpleSystem.position()),DiagramEdit.newAssociation.offsetTwoPosition=new UmplePosition(0,0,0,0);var d="#"+Page.umpleCanvasId();jQuery(d).append(DiagramEdit.newAssociation.drawable())},DiagramEdit.reflexiveAssociationMoving=function(e){var t=jQuery(e).attr("id"),n=t.substr(0,t.length-8),r=UmpleSystem.findAssociation(n);DiagramEdit.newAssociation==null&&(DiagramEdit.newAssociation=new UmpleAssociation,DiagramEdit.newAssociation.classOneId=r.classOneId,DiagramEdit.newAssociation.classTwoId=r.classTwoId,DiagramEdit.newAssociation.classOnePosition=r.classOnePosition,DiagramEdit.newAssociation.classTwoPosition=r.classTwoPosition,DiagramEdit.newAssociation.offsetOnePosition=r.offsetOnePosition,DiagramEdit.newAssociation.offsetTwoPosition=r.offsetTwoPosition,DiagramEdit.newAssociation.id=DiagramEdit.newAssociation.getElementId());var o=jQuery(e).offset(),a=Action.associationSnap(Math.round(o.left),Math.round(o.top),e),s=new UmplePosition(a[0],a[1],0,0),c=s.subtract(UmpleSystem.position());c.x=c.x-DiagramEdit.newAssociation.classOnePosition.x,c.y=c.y-DiagramEdit.newAssociation.classOnePosition.y,t.endsWith("_anchor0")?DiagramEdit.newAssociation.offsetOnePosition=c:DiagramEdit.newAssociation.offsetTwoPosition=c;var d="#"+Page.umpleCanvasId();jQuery(d).append(DiagramEdit.newAssociation.drawableReflexive())},DiagramEdit.classNameChanged=function(e,t,n){if(Action.setjustUpdatetoSaveLater(!1),n.length=!n.match(/^[_a-zA-Z0-9]+$/)){Action.updateUmpleDiagram();var r="Class names must be alphanumeric. &lt;"+n.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")+"&gt is not valid.";setTimeout(function(){Page.setFeedbackMessage(r)},2e3),setTimeout(function(){Page.setFeedbackMessage("")},1e4)}else{var o=UmpleSystem.renameClass(e,t,n);o.position.width=UmpleClassFactory.defaultSize.width;var a=Json.toString(o);delete o.oldname,Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",a),codeChange:!0})}},DiagramEdit.attributeNameChanged=function(e,t,n,r){if(Action.setjustUpdatetoSaveLater(!1),!Action.validateAttributeName(r))Action.updateUmpleDiagram(),setTimeout(function(){Page.setFeedbackMessage("UML Attributes must be alphanumeric with an optional type after a colon. &lt;"+r.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")+"&gt is not valid.")},2e3),setTimeout(function(){Page.setFeedbackMessage("")},1e4);else{var o=UmpleSystem.find(e);o.attributes[t].set(r),UmpleSystem.redraw(o);var a=Json.toString(o);Page.showModelLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",a),codeChange:!0}),o.resetAttribute(t)}},DiagramEdit.attributeNew=function(e,t){if(Action.setjustUpdatetoSaveLater(!1),!Action.validateAttributeName(t))Action.updateUmpleDiagram(),setTimeout(function(){Page.setFeedbackMessage("UML Attributes must be alphanumeric with an optional type after a colon. &lt;"+t.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")+"&gt is not valid.")},2e3),setTimeout(function(){Page.setFeedbackMessage("")},1e4);else{var n=UmpleSystem.find(e),r=n.addAttribute(t),o=Json.toString(n);Page.showModelLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",o),codeChange:!0}),n.resetAttribute(r),UmpleSystem.updateClass(n),UmpleSystem.redrawGeneralizationsTo(n),UmpleSystem.trimOverlappingAssociations(n),UmpleSystem.update()}},DiagramEdit.classDeleted=function(e){Action.setjustUpdatetoSaveLater(!1);for(var t=!0,n=UmpleSystem.find(e),r=[],o=[],a=0;a<UmpleSystem.umpleAssociations.length;a++){var s=UmpleSystem.umpleAssociations[a];s.contains(n)&&r.push(s.id)}for(var a=0;a<UmpleSystem.umpleClasses.length;a++){var c=UmpleSystem.umpleClasses[a];c.extendsClass==n.id&&o.push(c.id+"_generalization")}for(var a=0;a<r.length;a++)DiagramEdit.associationDeleted(r[a],t);for(var a=0;a<o.length;a++)DiagramEdit.generalizationDeleted(o[a],t);var d=UmpleSystem.removeClass(e),u=Json.toString(d);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=removeClass&actionCode={0}",u),codeChange:!0})},DiagramEdit.methodNew=function(e,t){if(Action.setjustUpdatetoSaveLater(!1),!Action.validateMethodName(t))Action.updateUmpleDiagram(),setTimeout(function(){Page.setFeedbackMessage("Invalid UML Method. &lt;"+t.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")+"&gt is not valid.")},2e3),setTimeout(function(){Page.setFeedbackMessage("")},1e4);else{var n=UmpleSystem.find(e),r=n.addMethod(t),o=Json.toString(n);Page.showModelLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",o),codeChange:!0}),n.resetMethod(r),UmpleSystem.updateClass(n),UmpleSystem.redrawGeneralizationsTo(n),UmpleSystem.trimOverlappingAssociations(n),UmpleSystem.update()}},DiagramEdit.methodChanged=function(e,t,n,r){if(Action.setjustUpdatetoSaveLater(!1),!Action.validateMethodName(r))Action.updateUmpleDiagram(),setTimeout(function(){Page.setFeedbackMessage("Invalid UML Method. &lt;"+r.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")+"&gt is not valid.")},2e3),setTimeout(function(){Page.setFeedbackMessage("")},1e4);else{var o=UmpleSystem.find(e);o.methods[t].set(r),UmpleSystem.redraw(o);var a=Json.toString(o);Page.showModelLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",a),codeChange:!0}),o.resetMethod(t)}},DiagramEdit.methodDelete=function(e,t){Action.setjustUpdatetoSaveLater(!1);var n=UmpleSystem.find(e);n.removeMethod(t);var r=jQuery("#"+n.id);n.position.width=UmpleClassFactory.defaultSize.width;var o=Json.toString(n);Page.showModelLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",o),codeChange:!0}),n.resetMethod(t),UmpleSystem.updateClass(n),UmpleSystem.redrawGeneralizationsTo(n),UmpleSystem.trimOverlappingAssociations(n),UmpleSystem.update()},DiagramEdit.attributeDelete=function(e,t){Action.setjustUpdatetoSaveLater(!1);var n=UmpleSystem.find(e);n.removeAttribute(t);var r=jQuery("#"+n.id);n.position.width=UmpleClassFactory.defaultSize.width;var o=Json.toString(n);Page.showModelLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",o),codeChange:!0}),n.resetAttribute(t),UmpleSystem.updateClass(n),UmpleSystem.redrawGeneralizationsTo(n),UmpleSystem.trimOverlappingAssociations(n),UmpleSystem.update()},DiagramEdit.associationDeleted=function(e,t){Action.setjustUpdatetoSaveLater(!1),t==null&&(t=!1);var n=UmpleSystem.removeAssociation(e),r=Json.toString(n);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=removeAssociation&actionCode={0}",r),codeChange:!0})},DiagramEdit.transitionDeleted=function(e,t){Action.setjustUpdatetoSaveLater(!1),t==null&&(t=!1);var n=UmpleSystem.removeTransition(e),r=Json.toString(n);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=removeTransition&actionCode={0}",r),codeChange:!0})},DiagramEdit.generalizationDeleted=function(e,t){Action.setjustUpdatetoSaveLater(!1),t==null&&(t=!1);var n=UmpleSystem.removeGeneralization(e),r=Json.toString(n);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=removeGeneralization&actionCode={0}",r),codeChange:!0})},DiagramEdit.removeNewClass=function(){if(DiagramEdit.newClass!=null){var e="#"+DiagramEdit.newClass.id;return DiagramEdit.newClass=null,jQuery(e).remove(),!0}return!1},DiagramEdit.removeNewAssociation=function(){if(DiagramEdit.newAssociation!=null){var e="#"+DiagramEdit.newAssociation.getElementId();return jQuery(e).remove(),DiagramEdit.newAssociation=null,!0}return!1},DiagramEdit.removeNewTransition=function(){if(DiagramEdit.newTransition!=null){var e="#"+DiagramEdit.newTransition.getElementId();return jQuery(e).remove(),DiagramEdit.newTransition=null,!0}return!1},DiagramEdit.removeNewGeneralization=function(){if(DiagramEdit.newGeneralization!=null){var e="#"+DiagramEdit.newGeneralization.getElementId();return jQuery(e).remove(),DiagramEdit.newGeneralization=null,!0}return!1},UmpleAssociationFactory=new Object,UmpleAssociationFactory.create=function(e){var t=new UmpleAssociation;return t.id=e.id,t.classOneId=e.classOneId,t.classTwoId=e.classTwoId,t.offsetOnePosition=UmplePositionFactory.copy(e.offsetOnePosition),t.offsetTwoPosition=UmplePositionFactory.copy(e.offsetTwoPosition),t.multiplicityOne=e.multiplicityOne,t.multiplicityTwo=e.multiplicityTwo,t.name=e.name,t.roleOne=e.roleOne,t.roleTwo=e.roleTwo,t.isSymmetricReflexive=e.isSymmetricReflexive=="true"||e.isSymmetricReflexive==!0,t.isLeftNavigable=e.isLeftNavigable=="true"||e.isLeftNavigable==!0,t.isRightNavigable=e.isRightNavigable=="true"||e.isRightNavigable==!0,t.isLeftComposition=e.isLeftComposition=="true"||e.isLeftComposition==!0,t.isRightComposition=e.isRightComposition=="true"||e.isRightComposition==!0,t.color=e.isTraced,t};function UmpleAssociation(){this.id,this.classOneId,this.classTwoId,this.classOnePosition=null,this.classTwoPosition=null,this.offsetOnePosition=null,this.offsetTwoPosition=null,this.multiplicityOne="",this.multiplicityTwo="",this.name="",this.roleOne="",this.roleTwo="",this.isSymmetricReflexive=!1,this.isLeftNavigable=!0,this.isRightNavigable=!0,this.isLeftComposition=!1,this.isRightComposition=!1,this.color="black",this.setClasses=function(e,t){this.classOneId=e,this.classTwoId=t},this.setDefaultMultiplicities=function(){this.multiplicityOne="*",this.multiplicityTwo="*"},this.setDefaultRoles=function(){this.classOneId==this.classTwoId&&(this.roleTwo="roleName")},this.setRoles=function(e,t){this.roleOne=e,this.roleTwo=t},this.setName=function(e){this.name=e},this.getName=function(){return this.name==null||this.name==""?this.deriveName():this.name},this.deriveName=function(){var e="",t=this.classOneId,n=this.classTwoId;return this.roleOne==null||this.roleOne===""||(t=this.classOneId+":"+this.roleOne),this.roleTwo==null||this.roleTwo===""||(n=this.classTwoId+":"+this.roleTwo),this.classOneId<=this.classTwoId?e=t+"__"+n:e=n+"__"+t,e},this.getElementId=function(){return this.id==null?"newassociation":this.id},this.getClass=function(e){return e==0?UmpleSystem.find(this.classOneId):UmpleSystem.find(this.classTwoId)},this.setOffsetOnePosition=function(e){var t=UmpleSystem.find(this.classOneId);this.classOnePosition=t.position,this.offsetOnePosition=e.subtract(t.position).subtract(UmpleSystem.position()),this.offsetOnePosition.width=0,this.offsetOnePosition.height=0},this.setOffsetTwoPosition=function(e){var t=UmpleSystem.find(this.classTwoId);this.classTwoPosition=t.position,this.offsetTwoPosition=e.subtract(t.position).subtract(UmpleSystem.position()),this.offsetTwoPosition.width=0,this.offsetTwoPosition.height=0},this.trimOverlap=function(){for(var e=new UmpleLine(this.offsetOnePosition.add(this.classOnePosition),this.offsetTwoPosition.add(this.classTwoPosition)),t=UmpleSystem.find(this.classOneId).borderLines(),n=UmpleSystem.find(this.classTwoId).borderLines(),r=this.offsetOnePosition.add(this.classOnePosition),o=this.offsetTwoPosition.add(this.classTwoPosition),a=[],s=[],c=0;c<t.length;c++)intersection=e.intersection(t[c]),intersection!=null&&a.push(intersection);for(var c=0;c<n.length;c++)intersection=e.intersection(n[c]),intersection!=null&&s.push(intersection);for(var d=new UmpleLine(r,o),u=new UmpleLine(d.pointOne,d.pointTwo),c=0;c<a.length;c++)u.pointOne=a[c],u.length()<d.length()&&(d=new UmpleLine(u.pointOne,u.pointTwo));for(var u=new UmpleLine(d.pointOne,d.pointTwo),c=0;c<s.length;c++)u.pointTwo=s[c],u.length()<d.length()&&(d=new UmpleLine(u.pointOne,u.pointTwo));this.setOffsetOnePosition(d.pointOne.add(UmpleSystem.position())),this.setOffsetTwoPosition(d.pointTwo.add(UmpleSystem.position()))},this.adjustReflexiveEndpoints=function(){var e=this.offsetOnePosition,t=this.offsetTwoPosition,n=UmpleSystem.find(this.classOneId).borderLines();this.snapToClosestEdge(e,n),this.snapToClosestEdge(t,n)},this.snapToClosestEdge=function(e,t){var n=!0,r=!0,o=e.x+this.classOnePosition.x,a=e.y+this.classOnePosition.y,s=a-t[0].pointOne.y,c=o-t[1].pointOne.x;s>t[2].pointOne.y-a&&(n=!1,s=t[2].pointOne.y-a),c>t[3].pointOne.x-o&&(r=!1,c=t[3].pointOne.x-o),s<=c?n?e.y=0:e.y=this.classOnePosition.height:r?e.x=0:e.x=this.classOnePosition.width},this.drawable=function(){return this.id==null?associationDiv=this.drawableTemp():this.isReflexive()?associationDiv=this.drawableReflexive():this.isComposition()?associationDiv=this.drawableComposition():this.isBidirectional()?associationDiv=this.drawableBidirectional():associationDiv=this.drawableUnidirectional(),associationDiv},this.drawableTemp=function(){var e="#"+this.getElementId();jQuery(e).remove();var t=this.createBaseJQueryObject();t.addClass("umpleAssociationTemp"),t.attr("id","newassociation");var n=new UmpleLine(this.classOnePosition.add(this.offsetOnePosition),this.classTwoPosition.add(this.offsetTwoPosition));return t.append(n.drawable()),t},this.drawableBidirectional=function(){var e="#"+this.id;jQuery(e).remove();var t=this.createBaseJQueryObject();this.color=="red"?t.addClass("redTracedAssociation"):t.addClass("untracedAssociation"),t.attr("id",this.id),t.attr("tabindex",2);var n=UmpleSystem.find(this.classOneId),r=UmpleSystem.find(this.classTwoId);if(n==null||n==null||r==null||r==null)return t;this.classOnePosition=n.position,this.classTwoPosition=r.position;var o=this.classOnePosition.add(this.offsetOnePosition),a=this.classTwoPosition.add(this.offsetTwoPosition),s=new UmpleLine(o.add(UmpleClassFactory.offsetError),a.add(UmpleClassFactory.offsetError));this.isComposition()||t.append(s.drawable());var c="",d=-3;c+=this.anchorDivHtml("hover",0,o.x+d,o.y+d),c+=this.anchorDivHtml("anchor",0,o.x+d,o.y+d),c+=this.anchorDivHtml("hover",1,a.x+d,a.y+d),c+=this.anchorDivHtml("anchor",1,a.x+d,a.y+d);var u=o.slopeAngle(a),f=this.multiplicityPosition(!0),g=this.multiplicityPosition(!1),h=this.multiplicityDivHtml("one",this.multiplicityOne,f.x,f.y),b=this.multiplicityDivHtml("two",this.multiplicityTwo,g.x,g.y);if(this.roleOne!=""){roleOnePosition=this.rolePosition(!0);var E=this.roleDivHtml("one",this.roleOne,roleOnePosition.x,roleOnePosition.y)}else E="";if(this.roleTwo!=""){roleTwoPosition=this.rolePosition(!1);var S=this.roleDivHtml("two",this.roleTwo,roleTwoPosition.x,roleTwoPosition.y)}else S="";return currentHtml=t.html(),t.html(h+b+E+S+c+currentHtml),t},this.drawableUnidirectional=function(){var e=this.drawableBidirectional(),t=null;this.isLeftNavigable?(t=this.classOnePosition.add(this.offsetOnePosition),otherEnd=this.classTwoPosition.add(this.offsetTwoPosition)):(t=this.classTwoPosition.add(this.offsetTwoPosition),otherEnd=this.classOnePosition.add(this.offsetOnePosition));var n=t.slopeAngle360(otherEnd),r=n+30,o=n-30,a=10,s=t.travelForward(a,r),c=t.travelForward(a,o),d=new UmpleLine(t.add(UmpleClassFactory.offsetError),s.add(UmpleClassFactory.offsetError)),u=new UmpleLine(t.add(UmpleClassFactory.offsetError),c.add(UmpleClassFactory.offsetError));return e.append(d.drawable()),e.append(u.drawable()),e},this.drawableComposition=function(){var e=this.drawableBidirectional(),t=null;this.isLeftComposition?(t=this.classOnePosition.add(this.offsetOnePosition),otherEnd=this.classTwoPosition.add(this.offsetTwoPosition)):(t=this.classTwoPosition.add(this.offsetTwoPosition),otherEnd=this.classOnePosition.add(this.offsetOnePosition));var n=t.slopeAngle360(otherEnd),r=n+30,o=n-30,a=8,s=t.travelForward(a,r),c=t.travelForward(a,o),d=s.travelForward(a,o),u=new UmpleLine(t.add(UmpleClassFactory.offsetError),s.add(UmpleClassFactory.offsetError)),f=new UmpleLine(t.add(UmpleClassFactory.offsetError),c.add(UmpleClassFactory.offsetError)),g=new UmpleLine(s.add(UmpleClassFactory.offsetError),d.add(UmpleClassFactory.offsetError)),h=new UmpleLine(c.add(UmpleClassFactory.offsetError),d.add(UmpleClassFactory.offsetError));e.append(u.drawable()),e.append(f.drawable()),e.append(g.drawable()),e.append(h.drawable());var b=new UmpleLine(d.add(UmpleClassFactory.offsetError),otherEnd.add(UmpleClassFactory.offsetError));e.append(b.drawable());var E=4,S=t.travelForward(E,r),D=t.travelForward(E,o),j=s.travelForward(E,o),p=c.travelForward(E,r),C=new UmpleLine(t.add(UmpleClassFactory.offsetError),j.add(UmpleClassFactory.offsetError)),M=new UmpleLine(t.add(UmpleClassFactory.offsetError),p.add(UmpleClassFactory.offsetError)),_=new UmpleLine(t.add(UmpleClassFactory.offsetError),d.add(UmpleClassFactory.offsetError)),T=new UmpleLine(s.add(UmpleClassFactory.offsetError),p.add(UmpleClassFactory.offsetError)),P=new UmpleLine(s.add(UmpleClassFactory.offsetError),D.add(UmpleClassFactory.offsetError)),k=new UmpleLine(s.add(UmpleClassFactory.offsetError),c.add(UmpleClassFactory.offsetError)),U=new UmpleLine(c.add(UmpleClassFactory.offsetError),S.add(UmpleClassFactory.offsetError)),N=new UmpleLine(c.add(UmpleClassFactory.offsetError),j.add(UmpleClassFactory.offsetError)),R=new UmpleLine(d.add(UmpleClassFactory.offsetError),S.add(UmpleClassFactory.offsetError)),B=new UmpleLine(d.add(UmpleClassFactory.offsetError),D.add(UmpleClassFactory.offsetError)),H=new UmpleLine(S.add(UmpleClassFactory.offsetError),D.add(UmpleClassFactory.offsetError)),I=new UmpleLine(S.add(UmpleClassFactory.offsetError),j.add(UmpleClassFactory.offsetError)),v=new UmpleLine(S.add(UmpleClassFactory.offsetError),p.add(UmpleClassFactory.offsetError)),L=new UmpleLine(D.add(UmpleClassFactory.offsetError),j.add(UmpleClassFactory.offsetError)),O=new UmpleLine(D.add(UmpleClassFactory.offsetError),p.add(UmpleClassFactory.offsetError)),z=new UmpleLine(j.add(UmpleClassFactory.offsetError),p.add(UmpleClassFactory.offsetError));return e.append(C.drawable()),e.append(M.drawable()),e.append(_.drawable()),e.append(T.drawable()),e.append(P.drawable()),e.append(k.drawable()),e.append(U.drawable()),e.append(N.drawable()),e.append(R.drawable()),e.append(B.drawable()),e.append(H.drawable()),e.append(I.drawable()),e.append(v.drawable()),e.append(L.drawable()),e.append(O.drawable()),e.append(z.drawable()),e},this.drawableReflexive=function(){var e="#"+this.id;jQuery(e).remove();var t=this.createBaseJQueryObject();this.color=="red"?t.addClass("redTracedAssociation"):t.addClass("untracedAssociation"),t.attr("id",this.id),t.attr("tabindex",2);var n=UmpleSystem.find(this.classOneId);this.classOnePosition=n.position,this.classTwoPosition=n.position;var r=n.position.height,o=n.position.width,a=15,s=this.whichWall(!0);factorX=s=="West"?-1:s=="South"?0:s=="East"?1:0,factorY=s=="West"?0:s=="South"?1:s=="East"?0:-1;var c=this.offsetOnePosition.add(this.classOnePosition),d=this.offsetOnePosition.add(this.classOnePosition).add(new UmplePosition(a*factorX,a*factorY,0,0));s=="South"&&(c.y=c.y-1);var u=new UmpleLine(c,d),f=this.whichWall(!1);factorX=f=="West"?-1:f=="South"?0:f=="East"?1:0,factorY=f=="West"?0:f=="South"?1:f=="East"?0:-1;var g=this.offsetTwoPosition.add(this.classTwoPosition),h=this.offsetTwoPosition.add(this.classTwoPosition).add(new UmplePosition(a*factorX,a*factorY,0,0)),b=new UmpleLine(g,h);t.append(u.drawable()),t.append(b.drawable());var E=new UmplePosition(0,0,0,0);if(s==f){var S=new UmpleLine(d,h);s=="North"||s=="South"?this.isSymmetricReflexive&&(E.x=(d.x+h.x)/2,E.y=d.y):this.isSymmetricReflexive&&(E.x=d.x,E.y=(d.y+h.y)/2),t.append(S.drawable())}else if(this.offsetOnePosition.wallsAreAdjacent(s,f)){var D=new UmplePosition(0,0,0,0),j=s=="West"||f=="West",p=s=="North"||f=="North";j?D.x=this.classOnePosition.x-a:D.x=this.classOnePosition.x+o+a,p?D.y=this.classOnePosition.y-a:D.y=this.classOnePosition.y+r+a;var C=new UmpleLine(d,D),M=new UmpleLine(h,D);t.append(C.drawable()),t.append(M.drawable()),this.isSymmetricReflexive&&E.set(D.x,D.y)}else{var _=new UmplePosition(0,0,0,0),T=new UmplePosition(0,0,0,0),P,k,U,N,R;s=="South"||f=="South"?(_.x=this.classOnePosition.x-a,_.y=this.classOnePosition.y-a,T.x=_.x,T.y=this.classOnePosition.y+r+a,f=="South"?(N=d,R=h):(N=h,R=d),this.isSymmetricReflexive&&(E.x=_.x,E.y=(_.y+T.y)/2)):(_.x=this.classOnePosition.x-a,_.y=this.classOnePosition.y+r+a,T.x=this.classOnePosition.x+o+a,T.y=_.y,f=="East"?(N=d,R=h):(N=h,R=d),this.isSymmetricReflexive&&(E.x=(_.x+T.x)/2,E.y=_.y)),P=new UmpleLine(N,_),k=new UmpleLine(_,T),U=new UmpleLine(T,R),t.append(P.drawable()),t.append(k.drawable()),t.append(U.drawable())}if(!this.isSymmetricReflexive){var B=new UmplePosition(0,0,0,0);s=="North"||s=="South"?(E.x=d.x,E.y=(c.y+d.y)/2):(E.x=(c.x+d.x)/2,E.y=d.y),f=="North"||f=="South"?(B.x=h.x,B.y=(g.y+h.y)/2):(B.x=(g.x+h.x)/2,B.y=h.y)}var H="",I=c,v=g,L=3;if(H+=this.anchorDivHtml("hover",0,I.x-L,I.y-L),H+=this.anchorDivHtml("anchor",0,I.x-L,I.y-L),H+=this.anchorDivHtml("hover",1,v.x-L,v.y-L),H+=this.anchorDivHtml("anchor",1,v.x-L,v.y-L),this.isSymmetricReflexive)var O=UmplePositionFactory.copy(this.centerMultiplicityPosition(E)),z=this.adjustRolePosition(E,!0),V=this.roleDivHtml("center",this.roleOne,z.x,z.y),Z=this.multiplicityDivHtml("center",this.multiplicityOne,O.x,O.y);else var W=UmplePositionFactory.copy(this.reflexiveMultiplicityPosition(E,B,!0)),ie=UmplePositionFactory.copy(this.reflexiveMultiplicityPosition(B,E,!1)),oe=this.adjustRolePosition(E,!0),K=this.adjustRolePosition(B,!1),V=this.roleDivHtml("one",this.roleOne,oe.x,oe.y)+this.roleDivHtml("two",this.roleTwo,K.x,K.y),Z=this.multiplicityDivHtml("one",this.multiplicityOne,W.x,W.y)+this.multiplicityDivHtml("two",this.multiplicityTwo,ie.x,ie.y);if(this.id==null)return t.attr("id","newassociation"),t;var le=t.html();return t.html(Z+V+H+le),t},this.isReflexive=function(){return this.classOneId==this.classTwoId||this.isSymmetricReflexive},this.isBidirectional=function(){return this.isRightNavigable==null||this.isLeftNavigable==null?!0:this.isRightNavigable&&this.isLeftNavigable},this.isComposition=function(){return this.isRightComposition||this.isLeftComposition},this.endHasArrow=function(e){return e?this.isLeftNavigable:this.isRightNavigable},this.contains=function(e){return e.id==this.classOneId||e.id==this.classTwoId},this.anchorDivHtml=function(e,t,n,r){return format('<div id="{0}_{1}{2}" class="{1}" name="{1}" style="left: {3}px; top: {4}px; cursor: pointer; display: none;"><img name="image" src="./scripts/_.gif"/></div>',this.id,e,t,n,r)},this.multiplicityDivHtml=function(e,t,n,r,o){return(o==null||o=="undefined")&&(o=""),format('<div id="{0}_{1}" class="multiplicity" name="{1}" style="left: {2}px; top: {3}px; cursor: pointer;">{4}&nbsp;&nbsp;{5}</div>',this.id,e,n,r,t,o)},this.roleDivHtml=function(e,t,n,r){return e=="one"?idExtension="roleOne":e=="two"?idExtension="roleTwo":e=="center"?idExtension="role":idExtension="",format('<div id="{0}_{1}" class="role" name="{1}" style="left: {2}px; top: {3}px; cursor: pointer;">{4}</div>',this.id,idExtension,n,r,t)},this.whichWall=function(e){if(e)var t=this.classOnePosition,n=this.offsetOnePosition;else var t=this.classTwoPosition,n=this.offsetTwoPosition;var r=1;return n.x==0?"West":n.y==0?"North":Math.abs(n.x-t.width)<=r?"East":"South"},this.multiplicityPosition=function(e){if(e)var t=this.classOnePosition.add(this.offsetOnePosition),n=this.classTwoPosition.add(this.offsetTwoPosition),r=this.multiplicityOne;else var t=this.classTwoPosition.add(this.offsetTwoPosition),n=this.classOnePosition.add(this.offsetOnePosition),r=this.multiplicityTwo;var o=this.whichWall(e),a=r=="*"?new UmplePosition(0,10,0,0):new UmplePosition(0,16,0,0),s=new UmplePosition(5*r.length+1,0,0,0),c=3;(!this.isBidirectional()&&this.endHasArrow(e)||this.isComposition())&&(c+=5);var d=t.slopeAngle360(n);if(o=="North")if(d<90){var u=(180-d)/2+d,f=t.travelForward(c,u);f=f.subtract(s),f=f.subtract(a)}else{var u=d/2,f=t.travelForward(c,u);f=f.subtract(a)}else if(o=="East")if(d>=0&&d<=90)var u=(d+90)/2+270,f=t.travelForward(c,u);else{var u=((360-d+90)/2+d)%360,f=t.travelForward(c,u);f=f.subtract(a)}else if(o=="South")if(d<=270)var u=(360-d)/2+d,f=t.travelForward(c,u),g=f;else{var u=(d-180)/2+180,f=t.travelForward(c,u),g=f;f=f.subtract(s)}else if(d<=180){var u=(270-d)/2+d,f=t.travelForward(c,u);f=f.subtract(s)}else{var u=(d-90)/2+90,f=t.travelForward(c,u);f=f.subtract(a),f=f.subtract(s)}return f},this.centerMultiplicityPosition=function(e){var t=this.whichWall(!0),n=this.whichWall(!1),r=1,o=5;return e.width=5*this.multiplicityOne.length+o+6*this.roleOne.length,e.height=16,t=="West"&&n=="West"||t=="North"&&n=="South"||t=="South"&&n=="North"?(e.x-=e.width+r,e.y-=e.height/2):t=="East"&&n=="East"?(e.x+=r,e.y-=e.height/2):t=="North"||n=="North"?(e.y-=r+e.height,e.x-=e.width/2):(e.y+=r,e.x-=e.width/2),e},this.reflexiveMultiplicityPosition=function(e,t,n){var r=5,o=1;if(n)var a=this.whichWall(!0),s=this.whichWall(!1),c=this.multiplicityOne.length,d=this.roleOne.length;else var a=this.whichWall(!1),s=this.whichWall(!0),c=this.multiplicityTwo.length,d=this.roleTwo.length;return e.width=5*c+r+6*d,e.height=16,a=="North"?(e.y-=e.height/2,s=="North"&&e.x<t.x||s=="East"?e.x-=e.width+o:e.x+=o):a=="East"?s=="East"&&e.y<t.y||s=="South"||s=="West"?e.y-=e.height:e.y+=o:a=="South"?(e.y-=e.height/2,s=="South"&&e.x<t.x||s=="East"?e.x-=e.width+o:e.x+=o):a=="West"&&(e.x-=e.width,s=="West"&&e.y<t.y||s=="East"||s=="South"?e.y-=e.height:e.y+=o),e},this.rolePosition=function(e){var t=e?this.multiplicityOne:this.multiplicityTwo,n=e?this.roleOne:this.roleTwo,r=e?this.classOnePosition.add(this.offsetOnePosition):this.classTwoPosition.add(this.offsetTwoPosition),o=e?this.classTwoPosition.add(this.offsetTwoPosition):this.classOnePosition.add(this.offsetOnePosition),a=new UmplePosition(5*t.length,0,0,0),s=new UmplePosition(6*n.length,0,0,0,0),c=new UmplePosition(0,16,0,0),d=c,u=new UmplePosition(5,0,0,0),f=this.multiplicityPosition(e),g=this.whichWall(e),h=r.slopeAngle360(o);return g=="North"?(h<90?rolePosition=f.subtract(s).subtract(a):rolePosition=f.add(a).add(u),t=="*"&&(rolePosition=rolePosition.subtract(new UmplePosition(0,6,0,0)))):g=="East"||g=="South"&&h<=270?rolePosition=f.add(a).add(u):rolePosition=f.subtract(s).subtract(a),rolePosition},this.adjustRolePosition=function(e,t){var n=t?this.multiplicityOne.length:this.multiplicityTwo.length;return e.x+=5*n+6,e},this.createBaseJQueryObject=function(){return jQuery(format("<div class='{0}'></div>",this.getName()))}}UmpleAttributeFactory=new Object,UmpleAttributeFactory.create=function(e){var t=e.type,n=e.name,r=e.traceColor;r==""&&(r="black");var o=new UmpleAttribute(t,n,r);return o};function UmpleAttribute(e,t,n){this.type=e,this.name=t,this.textColor=n,(this.aColor===""||this.aColor===void 0)&&(this.aColor="black"),this.set=function(r){this.textColor="black";var o=this.type!=""&&this.name!="";o&&(this.oldType=this.type,this.oldName=this.name);var a=r.split(":");a.length<2?(this.type="String",this.name=r):(this.name=a[0].trim(),this.type=a[1].trim()),o||(this.newType=this.type,this.newName=this.name)},this.copy=function(){return new UmpleAttribute(this.type,this.name,this.textColor)}}UmpleClassFactory=new Object,UmpleClassFactory.defaultSize=new UmplePosition(0,0,109,41),UmpleClassFactory.offsetError=new UmplePosition(0,0,0,0),UmpleClassFactory.create=function(e){var t=new UmpleClass;t.id=e.id,t.name=e.name,t.isInterface=e.isInterface,t.isAbstract=e.isAbstract,t.displayColor=e.displayColor,t.displayColor==""&&(t.displayColor="transparent"),t.position.x=e.position.x,t.position.y=e.position.y,t.position.width=e.position.width,t.position.height=e.position.height,t.extendsClass=e.extendsClass;for(var n=0;n<e.attributes.length;n++)e.attributes[n].modifier!="const"&&t.attributes.push(UmpleAttributeFactory.create(e.attributes[n]));for(var n=0;n<e.methods.length;n++)t.methods.push(UmpleMethodFactory.create(e.methods[n]));if(e.implementedInterfaces!=null)for(var n=0;n<e.implementedInterfaces.length;n++)t.interfaces[n]=e.implementedInterfaces[n].interfacesName+"";return t},UmpleClassFactory.perimeterPosition=function(e,t,n){typeof n>"u"&&(n=new UmplePosition(0,0,0,0));var r=t.x,o=t.y,a=0,s=n.x+e.position.x+a,c=s+e.position.width,d=n.y+e.position.y+a,u=d+e.position.height,f=r<s?s:r>c?c:r,g=o<d?d:o>u?u:o,h=r-s,b=c-r,E=o-d,S=u-o,D=Math.min(h,b),j=Math.min(E,S);return D<j?f=h<b?s:c:j<D&&(g=E<S?d:u),new UmplePosition(Math.round(f),Math.round(g),0,0)};function UmpleClass(){this.id,this.name,this.isInterface,this.isAbstract,this.displayColor="transparent",this.position=new UmplePosition(0,0,109,41),this.attributes=[],this.methods=[],this.interfaces=[],this.extendsClass,this.addAttribute=function(e){var t=new UmpleAttribute("","","");return t.set(e),this.attributes.push(t),this.attributes.length-1},this.removeAttribute=function(e){var t=this.attributes[e];t.deleteType=t.type,t.deleteName=t.name},this.resetAttribute=function(e){this.attributes[e].deleteName!=null?this.attributes.splice(e,1):this.attributes[e]=this.attributes[e].copy()},this.resetMethod=function(e){this.methods[e].deleteName!=null?this.methods.splice(e,1):this.methods[e]=this.methods[e].copy()},this.addMethod=function(e){var t=new UmpleMethod("","","","");return t.set(e),this.methods.push(t),this.methods.length-1},this.removeMethod=function(e){var t=this.methods[e];t.deleteType=t.type,t.deleteVisibility=t.visibility,t.deleteName=t.name,t.deleteParameters=t.parameters},this.setExtendsClass=function(e){this.extendsClass=e},this.removeExtendsClass=function(){this.extendsClass=null},this.borderLines=function(){var e=jQuery("#"+this.id),t=e.width(),n=e.height(),r=this.position,o=this.position.add(new UmplePosition(t,0,0,0)),a=this.position.add(new UmplePosition(0,n,0,0)),s=this.position.add(new UmplePosition(t,n,0,0));return borders=[],borders.push(new UmpleLine(r,o)),borders.push(new UmpleLine(r,a)),borders.push(new UmpleLine(a,s)),borders.push(new UmpleLine(o,s)),borders},this.drawable=function(){var e=this.drawClass(),t=this.drawGeneralization(),n=[e,t];return n},this.drawClass=function(){var e="#"+this.id,t=jQuery(e).get();t==null||t==null||t==""?(classDiv=jQuery("<div></div>"),classDiv.addClass("umpleClass"),classDiv.attr("tabindex",2)):(classDiv=jQuery(t),removalSel=format("div#{0} .classTable,div#{0} .umpleAttribute,div#{0} .umpleAttributeNew,div#{0} .anchor, div#{0} .hover",this.id),jQuery(removalSel).remove()),classDiv.attr("id",this.id);var n=-3.5,r=-3,o="",a="",s="";if(this.attributes.length>0)for(var c=0;c<this.attributes.length;c++){var d=this.attributes[c],u="";d.textColor!="black"&&(u=format("style='color:{0}'",d.textColor)),Page.isPhotoReady()?o+=format('<div class="umpleAttribute" {3}>{0} : {1}</div>',d.name,d.type,u):o+=format('<div class="umpleAttribute" {5}><span id="{2}_attribute_{3}" name="attributeEdit" class="editable editableDoubleClick">{0} : {1}</span> <img src="scripts/delete2.jpg" onclick="DiagramEdit.attributeDelete({4}{2}{4},{4}{3}{4})" /></div>',d.name,d.type,this.id,c,"'",u)}if(this.methods.length>0)for(var c=0;c<this.methods.length;c++){var f=this.methods[c],g="";f.visibility=="public"?g="+ ":f.visibility=="private"?g="- ":f.visibility=="protected"?g="# ":g="+ ";var h=f.type==""?"void":f.type;Page.isPhotoReady()?f.isAbstract=="true"?a+=format('<div class="umpleMethod">{3}<span style="font-style:italic">{1}({2}) </span> : {0} </div>',h,f.name,f.parameters,g):a+=format('<div class="umpleMethod">{3}{1}({2}) : {0} </div>',h,f.name,f.parameters,g):f.isAbstract=="true"?a+=format('<div class="umpleMethod"><span id="{4}_method_{5}" name="methodEdit" class="editable editableDoubleClick">{3}<span style="font-style:italic">{1}({2})</span> : {0} </span> <img src="scripts/delete2.jpg" onclick="DiagramEdit.methodDelete({6}{4}{6},{6}{5}{6})" /></div>',h,f.name,f.parameters,g,this.id,c,"'"):a+=format('<div class="umpleMethod"><span id="{4}_method_{5}" name="methodEdit" class="editable editableDoubleClick">{3}{1}({2}) : {0} </span> <img src="scripts/delete2.jpg" onclick="DiagramEdit.methodDelete({6}{4}{6},{6}{5}{6})" /></div>',h,f.name,f.parameters,g,this.id,c,"'")}o+=format('<div class="umpleAttributeNew"><span id="{0}_newAttribute" name="attributeNew" class="editable editableSingleClick">{1}</span></div>',this.id,Page.isPhotoReady()?"&nbsp;":"-- Add More --"),a+=format('<div class="umpleMethodNew"><span id="{0}_newMethod" name="methodNew" class="editable editableSingleClick">{1}</span></div>',this.id,Page.isPhotoReady()?"&nbsp;":"-- Add More --"),Page.isPhotoReady(),rowspan=3,Page.showAttributes&&(rowspan+=1),Page.showMethods&&(rowspan+=1),s+=format('<table bgcolor="'+this.displayColor+'" class="classTable" border="0">',this.id)+format('  <tr class="height">    <td rowspan="{2}"> <img id="{0}_height" src="scripts/_.gif" style="width:0px;height:{1}px;display:block;"  />    </td>  </tr>',this.id,this.position.height,rowspan)+'  <tr class="classArea">    <td > <img src="scripts/class.png" title="Class" /> ',Page.isPhotoReady()?this.isInterface=="true"?s+=format('<span>&#171interface&#187<span><br><span id="{0}_name" name="className">{1}</span>',this.id,this.name):this.isAbstract=="true"?s+=format('<span>&#171abstract&#187<span><br><span id="{0}_name" name="className">{1}</span>',this.id,this.name):s+=format('<span id="{0}_name" name="className">{1}</span>',this.id,this.name):this.isInterface=="true"?s+=format('<span>&#171interface&#187<span><br><span id="{0}_name" name="className" class="editable editableDoubleClick">{1}</span>',this.id,this.name):this.isAbstract=="true"?s+=format('<span>&#171abstract&#187<span><br><span id="{0}_name" name="className" class="editable editableDoubleClick">{1}</span>',this.id,this.name):s+=format('<span id="{0}_name" name="className" class="editable editableDoubleClick" >{1}</span>',this.id,this.name),s+="</td> </tr>",Page.showAttributes==!0&&(s+=format('  <tr class="attributeArea">    <td class="attributes">{0}    </td>  </tr>',o)),Page.showMethods==!0&&(s+=format('  <tr class="methodArea">    <td class="methods">{0}    </td>  </tr>',a)),s+=format('  <tr class="width">    <td> <img id="{0}_width" src="scripts/_.gif" style="width:{1}px;height:0px;display:block;"  />    </td>  </tr>',this.id,this.position.width),s+="</table>";var b=classDiv.html();return classDiv.html(s+b),classDiv},this.drawableClassOutline=function(){var e="#tempClass",t=jQuery(e).get();t==null||t==null||t==""?(t=jQuery("<div></div>"),t.addClass("umpleClass"),t.attr("id",this.id)):t=jQuery(e);var n='<table class="classTable" "border="0">'+format('  <tr class="height">    <td rowspan="4"> <img id="{0}_height" src="scripts/_.gif" style="width:0px;height:{1}px;display:block;"  />    </td>  </tr>',this.id,this.position.height)+'  <tr class="classArea">    <td> <img src="scripts/class.png" title="Class" /> '+format('      <span id="{0}_name" name="className" >{1}</span>',this.id,this.name)+'    </td>  </tr>  <tr class="attributeArea">    <td class="attributes">    </td>  </tr>  <tr class="width">'+format('    <td> <img id="{0}_width" src="scripts/_.gif" style="width:{1}px;height:0px;display:block;"  />    </td>  </tr>',this.id,this.position.width)+"</table>";return t.html(n),t},this.drawGeneralization=function(){var e=null,t=[],n=UmpleSystem.find(this.extendsClass);if(n==null&&this.interfaces.length==0)return null;if(n!=null&&(e=new UmpleGeneralization,e.childId=this.id,e.parentId=n.id,e.childPosition=this.position,e.parentPosition=n.position,t[0]=e.drawable()),this.interfaces.length>0)for(var r=null,o=0;o<this.interfaces.length;o++)r=UmpleSystem.find(this.interfaces[o]),r!=null&&(e=new UmpleGeneralization,e.childId=this.id,e.parentId=r.id,e.childPosition=this.position,e.parentPosition=r.position,t[o+1]=e.drawable());return t},this.anchorDivHtml=function(e,t){return format('<div id="{0}_{1}{2}" class="{3}" name="{4}" style="top: 0px; left: 0px; cursor:{5}; display: none;"><img name="image" src="./scripts/_.gif"/></div>',this.id,e,t,e,e,"move")}}function UmpleGeneralization(){this.parentId=null,this.childId=null,this.parentPosition=null,this.childPosition=null,this.id=null,this.setClasses=function(e,t){this.childId=e,this.parentId=t},this.setChildId=function(e){this.childId=e},this.setParentId=function(e){this.parentId=e},this.getElementId=function(){return this.id==null?"newgeneralization":this.id},this.getChildId=function(){return this.childId},this.getParentId=function(){return this.parentId},this.drawable=function(e){if(e==null&&(e=!0),this.childId==null||this.childId==null)return null;var t="#"+this.childId+"_generalization";jQuery(t).remove();var n=jQuery("<div></div>"),r=e?this.childId+"_generalization":"newgeneralization",o="umpleGeneralization";n.attr("id",r),n.attr("tabindex",2),n.addClass(o);var a=new UmplePosition(0,10,0,0),U=new UmplePosition(15,0,0,0),s=new UmplePosition(0,22,0,0),c=this.childPosition,d=new UmplePosition(this.childPosition.width/2,0,0,0),u=this.parentPosition,f=new UmplePosition(this.parentPosition.width/2,this.parentPosition.height,0,0);f=f.add(a).add(s),u=u.add(f),c=c.add(d);var g=this.childPosition.x,h=this.childPosition.x+this.childPosition.width,b=this.childPosition.y+this.childPosition.height,E=this.childPosition.y,S=!0;u.y>E&&(u.y<b?Math.abs(u.x-h)<Math.abs(u.x-g)?(c=c.add(new UmplePosition(this.childPosition.width/2,0,0,0)),c.y=u.y,S=!1):(c=c.subtract(new UmplePosition(this.childPosition.width/2,0,0,0)),c.y=u.y,S=!1):c=c.add(new UmplePosition(0,this.childPosition.height,0,0)));var D=new UmplePosition(c.x,u.y);if(S){var j=new UmpleLine(D.add(UmpleClassFactory.offsetError),u.add(UmpleClassFactory.offsetError)),p=new UmpleLine(c.add(UmpleClassFactory.offsetError),D.add(UmpleClassFactory.offsetError));n.append(j.drawable())}else var p=new UmpleLine(c.add(UmpleClassFactory.offsetError),u.add(UmpleClassFactory.offsetError));n.append(p.drawable());var C=u,M=u.subtract(s),_=new UmpleLine(C.add(UmpleClassFactory.offsetError),M.add(UmpleClassFactory.offsetError));n.append(_.drawable());var T=M.subtract(new UmplePosition(U.x/2,0,0,0)),P=T.add(U),k=M.subtract(a),U=new UmpleLine(T.add(UmpleClassFactory.offsetError),P.add(UmpleClassFactory.offsetError)),N=new UmpleLine(T.add(UmpleClassFactory.offsetError),k.add(UmpleClassFactory.offsetError)),R=new UmpleLine(P.add(UmpleClassFactory.offsetError),k.add(UmpleClassFactory.offsetError));n.append(U.drawable()),n.append(R.drawable()),n.append(N.drawable());var B="",H=n.html();return n.html(B+H),n},this.anchorDivHtml=function(e,t,n,r){return format('<div id="{0}_{1}{2}" class="{1}" name="{1}" style="left: {3}px; top: {4}px; cursor: pointer; display: none;"><img name="image" src="./scripts/_.gif"/></div>',this.childId+"_generalization",e,t,n,r)}}History=new Object,History.versionCount=9999,History.noChange="//$?[No_Change]$?",History.getInstance=function(e){var t=new Object;return t.id=e,t.currentIndex=-1,t.oldestAvailableIndex=0,t.newestAvailableIndex=0,t.firstSave=!0,t.undoButton=!1,t.redoButton=!1,t.getNextVersion=function(){return History.getNextVersion(t)},t.getPreviousVersion=function(){return History.getPreviousVersion(t)},t.save=function(n,r){return History.save(t,n,r)},t.distanceBetween=function(n,r){return History.distanceBetween(t,n,r)},t.setButtons=function(){return History.setButtons(t)},t.getVersion=function(n){return History.getVersion(t,n)},t.setVersion=function(n,r){return History.setVersion(t,n,r)},t},History.setButtons=function(e){History.enableButtonUndo(e,e.undoButton),History.enableButtonRedo(e,e.redoButton)},History.enableButtonUndo=function(e,t){e.undoButton=t,Page.enablePaletteItem("buttonUndo",t)},History.enableButtonRedo=function(e,t){e.redoButton=t,Page.enablePaletteItem("buttonRedo",t)},History.getNextVersion=function(e){History.enableButtonUndo(e,!0);var t;return!e.FirstSave&&e.newestAvailableIndex!=e.currentIndex?(e.currentIndex=History.incrementIndex(e.currentIndex),t=e.getVersion(e.currentIndex),t==null&&(t=History.noChange)):t=History.noChange,e.newestAvailableIndex==e.currentIndex&&History.enableButtonRedo(e,!1),t},History.getPreviousVersion=function(e){var t;return!e.FirstSave&&e.oldestAvailableIndex!=e.currentIndex?(e.currentIndex=History.decrementIndex(e.currentIndex),t=e.getVersion(e.currentIndex),t==null?t=History.noChange:History.enableButtonRedo(e,!0)):t=History.noChange,e.oldestAvailableIndex==e.currentIndex&&History.enableButtonUndo(e,!1),t},History.save=function(e,t,n){if(e.getVersion(e.currentIndex)!=t){e.firstSave||(History.enableButtonRedo(e,!1),History.enableButtonUndo(e,!0));var r=e.distanceBetween(e.oldestAvailableIndex,e.currentIndex);r==e.versionCount-1&&(e.oldestAvailableIndex=History.incrementIndex(e.oldestAvailableIndex)),e.currentIndex=History.incrementIndex(e.currentIndex),e.newestAvailableIndex=e.currentIndex,e.setVersion(e.currentIndex,t),e.firstSave&&(e.firstSave=!1)}},History.decrementIndex=function(e){var t;return e==0?t=History.versionCount-1:t=e-1,t},History.incrementIndex=function(e){var t=(e+1)%History.versionCount;return t},History.getVersion=function(e,t){var n="#textEditorColumn",r=e.id+"version"+t;return jQuery(n).data(r)},History.setVersion=function(e,t,n){var r="#textEditorColumn",o=e.id+"version"+t;return jQuery(r).data(o,n)},History.distanceBetween=function(e,t,n){if(e.currentIndex==-1)return 0;for(var r=0,o=t;o!=n;)o=History.incrementIndex(o),r+=1;return r};var Layout={};Layout.isTextVisible=!0,Layout.isDiagramVisible=!0,Layout.isPaletteVisible=!0,Layout.isLayoutVisible=!1,Layout.layoutHandler=null,Layout.isInSmallScreenMode=!1,Layout.screenThresholdWidth=945;var canvasHandle="#umpleCanvasColumn",editorHandle="#textEditorColumn",modelEditorHandle="#newEditor",paletteHandle="#paletteColumn",layoutEditorHandle="#bottomTextEditor";Layout.init=function(){Layout.errorMessageSpace=jQuery(".spacer").outerHeight(),Layout.errorMessageSpace===null&&(Layout.errorMessageSpace=0);var e=this.checkLayoutNeeded();e.layoutType==="large"?(this.layoutHandler=new LargeScreenManager,this.isInSmallScreenMode=!1):e.layoutType==="small"&&(this.layoutHandler=new SmallScreenManager,this.isInSmallScreenMode=!0),this.layoutHandler.transition(!0),jQuery(window).bind("resize",function(t){jQuery(t.target).hasClass("ui-resizable")||Layout.zoomResize()})},Layout.checkLayoutNeeded=function(){return jQuery(window).innerWidth()>jQuery(window).innerHeight()&&!(jQuery("body").innerWidth()<580&&jQuery("body").innerHeight()<580)?{layoutType:"large"}:{layoutType:"small"}},Layout.initPaletteSize=function(){this.layoutHandler.initPaletteSize()},Layout.initUmpleCanvasSize=function(){this.layoutHandler.initUmpleCanvasSize()},Layout.initUmpleTextAreaSize=function(){this.layoutHandler.initUmpleTextAreaSize()},Layout.setTextEditorSize=function(e,t){this.layoutHandler.setTextEditorSize(e,t)},Layout.setUmpleCanvasSize=function(e,t){this.layoutHandler.setUmpleCanvasSize(e,t)},Layout.adjustTextEditorHeight=function(e){this.isLayoutVisible?(jQuery(modelEditorHandle).outerHeight(e*.7),Page.codeMirrorOn&&this.resizeCodeMirrorEditor(e*.7),jQuery(layoutEditorHandle).outerHeight(e*.3)):(jQuery(modelEditorHandle).outerHeight(e),Page.codeMirrorOn&&this.resizeCodeMirrorEditor(e)),jQuery(editorHandle).height(e)},Layout.resizeCodeMirrorEditor=function(e){Page.codeMirrorOn&&(Page.codeMirrorEditor6.dom.style.height=e+"px")},Layout.showHideLayoutEditor=function(e){var t=jQuery(layoutEditorHandle),n=jQuery(editorHandle).height();e==null&&(e=!this.isLayoutVisible),e?(Layout.isLayoutVisible=!0,t.show()):(Layout.isLayoutVisible=!1,t.hide()),this.adjustTextEditorHeight(n)},Layout.showHideTextEditor=function(e){var t=jQuery(editorHandle),n=jQuery("#buttonShowHideLayoutEditor"),r=jQuery(".layoutListItem");e==null&&(e=!this.isTextVisible),e?(t.show(),this.isTextVisible=!0,n.prop("disabled",!1),n.css("cursor","pointer"),r.css("color","Black"),jQuery("#linetext").show(),Page.setUmpleCode(Page.getUmpleCode())):(t.hide(),this.isTextVisible=!1,n.prop("disabled",!0),n.css("cursor","not-allowed"),r.css("color","DimGray"),jQuery("#linetext").hide()),this.layoutHandler.showHideResizableAdjustment(),this.layoutHandler.showHideResize()},Layout.showHideCanvas=function(e){var t=jQuery(canvasHandle);e==null&&(e=!this.isDiagramVisible),e?(t.show(),this.isDiagramVisible=!0,Action.manualSync=jQuery("#buttonManualSync").prop("checked"),jQuery("#buttonShowHideCanvas").prop("checked",!0),Action.manualSync||(Action.updateUmpleDiagram(),Action.diagramInSync=!0,Page.enableDiagram(!0)),Action.manualSync&&!Action.diagramInSync&&Page.enablePaletteItem("buttonSyncDiagram",!0),(!Action.manualSync||Action.diagramInSync)&&(Page.enableCheckBoxItem("buttonPhotoReady","ttPhotoReady",!0),Page.enableCheckBoxItem("buttonManualSync","ttManualSync",!0),Page.enablePaletteItem("buttonAddClass",!0),Page.enablePaletteItem("buttonAddAssociation",!0),Page.enablePaletteItem("buttonAddTransition",!0),Page.enablePaletteItem("buttonAddGeneralization",!0),Page.enablePaletteItem("buttonDeleteEntity",!0),Page.initToggleTool("buttonAddClass"),Page.initToggleTool("buttonAddAssociation"),Page.initToggleTool("buttonAddTransition"),Page.initToggleTool("buttonAddGeneralization"),Page.initToggleTool("buttonDeleteEntity"))):(t.hide(),this.isDiagramVisible=!1,Action.manualSync=!0,jQuery("#buttonShowHideCanvas").prop("checked",!1),Page.enableCheckBoxItem("buttonPhotoReady","ttPhotoReady",!1),Page.enableCheckBoxItem("buttonManualSync","ttManualSync",!1),Page.enablePaletteItem("buttonAddClass",!1),Page.enablePaletteItem("buttonAddAssociation",!1),Page.enablePaletteItem("buttonAddTransition",!1),Page.enablePaletteItem("buttonAddGeneralization",!1),Page.enablePaletteItem("buttonDeleteEntity",!1),Page.enablePaletteItem("buttonSyncDiagram",!1),Page.removeToggleTool("buttonAddClass"),Page.removeToggleTool("buttonAddAssociation"),Page.removeToggleTool("buttonAddTransition"),Page.removeToggleTool("buttonAddGeneralization"),Page.removeToggleTool("buttonDeleteEntity")),this.layoutHandler.showHideResizableAdjustment(),this.layoutHandler.showHideResize()},Layout.showHideMenu=function(e){var t=jQuery("#paletteColumn");e==null&&(e=!this.isPaletteVisible),e?(Layout.isPaletteVisible=!0,t.show()):(Layout.isPaletteVisible=!1,t.hide()),this.layoutHandler.showHideResizableAdjustment(),this.layoutHandler.showHideResize()},Layout.zoomResize=function(){var e=this.checkLayoutNeeded();e.layoutType==="large"?this.isInSmallScreenMode&&this.toggleSmallScreenMode():e.layoutType==="small"&&(this.isInSmallScreenMode||this.toggleSmallScreenMode()),this.layoutHandler.adjustAfterWindowResize()},Layout.toggleSmallScreenMode=function(){this.isInSmallScreenMode?(this.isInSmallScreenMode=!1,this.layoutHandler=new LargeScreenManager):(this.isInSmallScreenMode=!0,this.layoutHandler=new SmallScreenManager),this.layoutHandler.transition(!1)},Layout.verticallyResizing=function(e,t){this.layoutHandler.verticallyResizing(e,t)},Layout.verticallyResized=function(e,t){this.layoutHandler.verticallyResized(e,t)},Layout.editorResizing=function(e,t){this.layoutHandler.editorResizing(e,t)},Layout.editorResized=function(e,t){this.layoutHandler.editorResized(e,t)},Layout.canvasResizing=function(e,t){this.layoutHandler.canvasResizing(e,t)},Layout.canvasResized=function(e,t){this.layoutHandler.canvasResized(e,t)},Layout.calculateMainHeight=function(){return jQuery(paletteHandle).outerHeight()};function LargeScreenManager(){this.transition=function(e){if(!e){try{jQuery(editorHandle).resizable("destroy")}catch{}try{jQuery(paletteHandle).resizable("destroy")}catch{}try{jQuery(canvasHandle).resizable("destroy")}catch{}jQuery(editorHandle).removeClass("smallScreenEditor smallScreenEditorNoMargin"),jQuery(canvasHandle).removeClass("smallScreenCanvas smallScreenCanvasNoEditor smallScreenCanvasNoEditorNoPalette")}this.adjustMarginSpace(),this.heightFactor=1,this.minCanvasSize=new UmplePosition(0,0,420,50),this.minEditorSize=new UmplePosition(0,0,284,0);var t=jQuery("body").outerWidth(!0)-this.marginSpace-jQuery(paletteHandle).outerWidth()-this.minCanvasSize.width,n=jQuery("body").outerWidth(!0)-this.marginSpace-jQuery(paletteHandle).outerWidth()-this.minEditorSize.width;this.maxEditorSize=new UmplePosition(0,0,t,0),this.maxCanvasSize=new UmplePosition(0,0,n,0),this.initEditorResizable(),this.initCanvasResizable(),this.initVerticalResizable()},this.initUmpleCanvasSize=function(){this.initCanvasResizable(),this.setUmpleCanvasSize(this.minCanvasSize.width)},this.initUmpleTextAreaSize=function(){this.initEditorResizable(),this.setTextEditorSize(508,void 0),this.adjustAfterWindowResize()},this.initPaletteSize=function(){jQuery("#paletteColumn").height(this.calculateHeight()),jQuery("#palette").accordion("refresh"),this.initVerticalResizable()},this.setTextEditorSize=function(e,t){var n=jQuery(editorHandle);e==null&&(e=n.outerWidth()),t==null&&(t=Layout.calculateMainHeight()),e<this.minEditorSize.width?e=this.minEditorSize.width:Layout.isDiagramVisible||(e=e),n.outerWidth(e),Layout.adjustTextEditorHeight(t),Layout.isDiagramVisible&&this.setUmpleCanvasSize(this.calculateLeftoverWidth()+jQuery(canvasHandle).outerWidth(),void 0)},this.setUmpleCanvasSize=function(e,t){var n=jQuery(canvasHandle);e==null&&(e=n.outerWidth()),t==null&&(t=Layout.calculateMainHeight()),e<this.minCanvasSize.width&&(e=this.minCanvasSize.width),t<this.minCanvasSize.height&&(t=this.minCanvasSize.height),e>this.maxCanvasSize.width&&Layout.isTextVisible&&(e=this.maxCanvasSize.width),n.outerWidth(e),n.height(t),jQuery("#palette").accordion("refresh")},this.showHideResize=function(){this.adjustMarginSpace(),this.adjustMaxSizes(),Layout.isDiagramVisible&&!Layout.isTextVisible?this.setUmpleCanvasSize(this.calculateLeftoverWidth()+jQuery(canvasHandle).outerWidth(),void 0):Layout.isTextVisible&&this.setTextEditorSize(this.calculateLeftoverWidth()+jQuery(editorHandle).outerWidth(),void 0)},this.showHideResizableAdjustment=function(){if(!Layout.isDiagramVisible||!Layout.isTextVisible){try{jQuery(canvasHandle).resizable("destroy")}catch{}try{jQuery(editorHandle).resizable("destroy")}catch{}}else Layout.isDiagramVisible&&Layout.isTextVisible&&(this.initCanvasResizable(),this.initEditorResizable());if(jQuery(editorHandle).outerWidth()<this.minEditorSize.width||jQuery(canvasHandle).outerWidth()<this.minCanvasSize.width){try{jQuery(canvasHandle).resizable("destroy")}catch{}try{jQuery(editorHandle).resizable("destroy")}catch{}}else this.initCanvasResizable(),this.initEditorResizable();this.adjustMaxSizes()},this.adjustMaxSizes=function(){if(Layout.isDiagramVisible&&Layout.isTextVisible){var e=jQuery("body").outerWidth(!0)-this.marginSpace;Layout.isDiagramVisible&&(e-=this.minCanvasSize.width),Layout.isPaletteVisible&&(e-=jQuery(paletteHandle).outerWidth());var t=jQuery("body").outerWidth(!0)-this.marginSpace;Layout.isTextVisible&&(t-=this.minEditorSize.width),Layout.isPaletteVisible&&(t-=jQuery(paletteHandle).outerWidth()),this.maxEditorSize=new UmplePosition(0,0,e,0),this.maxCanvasSize=new UmplePosition(0,0,t,0),jQuery(editorHandle).outerWidth()>this.minEditorSize.width&&jQuery(canvasHandle).outerWidth()>this.minCanvasSize.width&&(jQuery(editorHandle).resizable("option","maxWidth",this.maxEditorSize.width),jQuery(canvasHandle).resizable("option","maxWidth",this.maxCanvasSize.width))}Action.setupPinch()},this.adjustAfterWindowResize=function(){this.adjustMaxSizes(),jQuery("#paletteColumn").height(this.calculateHeight()),jQuery("#palette").accordion("refresh");var e=this.calculateLeftoverWidth();jQuery(canvasHandle).outerWidth()<this.minCanvasSize.width&&jQuery(canvasHandle).outerWidth()+e>=this.minCanvasSize.width&&e>0||jQuery(canvasHandle).outerWidth()+e<=this.minCanvasSize.width&&e>0?this.setTextEditorSize(jQuery(editorHandle).outerWidth(),void 0):this.setTextEditorSize(e+jQuery(editorHandle).outerWidth(),void 0),this.showHideResizableAdjustment()},this.initVerticalResizable=function(){jQuery("#mainApplication").resizable({resize:function(e,t){Layout.verticallyResizing(e,t)},stop:function(e,t){Layout.verticallyResized(e,t)},autoHide:!0,minHeight:this.minCanvasSize.height,handles:"s"})},this.initEditorResizable=function(){!Layout.isTextVisible||!Layout.isDiagramVisible||jQuery(editorHandle).resizable({start:function(e,t){Layout.savedStartingWidth=jQuery(canvasHandle).outerWidth()},resize:function(e,t){Layout.editorResizing(e,t)},stop:function(e,t){Layout.editorResized(e,t)},autoHide:!0,minWidth:this.minEditorSize.width,maxWidth:this.maxEditorSize.width,handles:"e"})},this.initCanvasResizable=function(){if(!(!Layout.isTextVisible||!Layout.isDiagramVisible)){var e=jQuery(canvasHandle);e.resizable({start:function(t,n){Layout.savedStartingWidth=jQuery(editorHandle).outerWidth()},resize:function(t,n){Layout.canvasResizing(t,n)},stop:function(t,n){Layout.canvasResized(t,n)},autoHide:!0,minWidth:this.minCanvasSize.width,maxWidth:this.maxCanvasSize.width,handles:"w"})}},this.verticallyResizing=function(e,t){var n=t.size.height;jQuery(paletteHandle).outerHeight(n),jQuery(editorHandle).outerHeight(n),jQuery(canvasHandle).outerHeight(n),Layout.adjustTextEditorHeight(n),jQuery("#palette").accordion("refresh")},this.verticallyResized=function(e,t){this.heightFactor=jQuery("#mainApplication").outerHeight()/(jQuery(window).innerHeight()-jQuery("#header").outerHeight()-jQuery("#topLine").outerHeight()-parseInt(jQuery("body").css("marginBottom"))-parseInt(jQuery("body").css("marginTop"))),this.setTextEditorSize(void 0,t.size.height),jQuery("#mainApplication").css("height","auto")},this.editorResizing=function(e,t){var n=t.size.width,r=t.originalSize.width-n;jQuery(canvasHandle).outerWidth(Layout.savedStartingWidth+r),jQuery(modelEditorHandle).width(n),jQuery(layoutEditorHandle).width(n)},this.editorResized=function(e,t){var n=t.size.width;jQuery(modelEditorHandle).css("width","auto"),jQuery(layoutEditorHandle).css("width","auto"),this.setTextEditorSize(n,void 0),delete Layout.savedStartingWidth},this.canvasResizing=function(e,t){var n=t.size.width;jQuery(canvasHandle).outerWidth(n);var r=n-t.originalSize.width;jQuery(editorHandle).width(Layout.savedStartingWidth-r),jQuery(modelEditorHandle).width(Layout.savedStartingWidth-r),jQuery(layoutEditorHandle).width(Layout.savedStartingWidth-r),jQuery(canvasHandle).css("left","0px"),Action.setupPinch()},this.canvasResized=function(e,t){var n=t.size.width;jQuery(modelEditorHandle).css("width","auto"),jQuery(layoutEditorHandle).css("width","auto"),this.setTextEditorSize(this.calculateLeftoverWidth()+jQuery(editorHandle).outerWidth(),void 0),delete this.savedStartingWidth},this.adjustMarginSpace=function(){jQuery(editorHandle).removeClass("largeScreenEditor largeScreenEditorNoMargin"),jQuery(canvasHandle).removeClass("largeScreenCanvas largeScreenCanvasNoMargin"),Layout.isTextVisible?Layout.isDiagramVisible&&Layout.isPaletteVisible?(jQuery(editorHandle).addClass("largeScreenEditor"),jQuery(canvasHandle).addClass("largeScreenCanvas")):Layout.isDiagramVisible||Layout.isPaletteVisible?(jQuery(editorHandle).addClass("largeScreenEditor"),jQuery(canvasHandle).addClass("largeScreenCanvasNoMargin")):(jQuery(editorHandle).addClass("largeScreenEditorNoMargin"),jQuery(canvasHandle).addClass("largeScreenCanvasNoMargin")):(jQuery(editorHandle).addClass("largeScreenEditorNoMargin"),Layout.isDiagramVisible&&Layout.isPaletteVisible?jQuery(canvasHandle).addClass("largeScreenCanvas"):jQuery(canvasHandle).addClass("largeScreenCanvasNoMargin")),this.marginSpace=parseInt(jQuery("body").css("marginLeft"))+parseInt(jQuery("body").css("marginRight"))+1+parseInt(jQuery(canvasHandle).css("marginLeft"))+parseInt(jQuery(editorHandle).css("marginRight"))},this.calculateLeftoverWidth=function(){var e=jQuery("body").outerWidth(!0)-this.marginSpace;return Layout.isTextVisible&&(e-=jQuery(editorHandle).outerWidth()),Layout.isDiagramVisible&&(e-=jQuery(canvasHandle).outerWidth()),Layout.isPaletteVisible&&(e-=jQuery(paletteHandle).outerWidth()),e},this.calculateHeight=function(){var e=TabControl.isHidden()?0:jQuery("#tabControl").outerHeight(),t=jQuery("#taskArea").css("display")=="none"?0:jQuery("#taskArea").outerHeight();t>jQuery(window).innerHeight()/2&&(t=0);var n=(jQuery(window).innerHeight()-jQuery("#header").outerHeight()-jQuery("#topLine").outerHeight()-e-parseInt(jQuery("body").css("marginBottom"))-parseInt(jQuery("body").css("marginTop"))-Layout.errorMessageSpace)*this.heightFactor-t;return n<this.minCanvasSize.height?this.minCanvasSize.height:n}}function SmallScreenManager(){this.transition=function(e){if(!e){try{jQuery(editorHandle).resizable("destroy")}catch{}try{jQuery(canvasHandle).resizable("destroy")}catch{}try{jQuery("#mainApplication").resizable("destroy")}catch{}jQuery(editorHandle).removeClass("largeScreenEditor largeScreenEditorNoMargin"),jQuery(canvasHandle).removeClass("largeScreenCanvas largeScreenCanvasNoMargin")}this.adjustMarginSpace(),this.minCanvasSize=new UmplePosition(0,0,420,50),this.minEditorSize=new UmplePosition(0,0,284,0),this.initEditorResizable(),this.initCanvasResizable(),this.initPaletteResizable()},this.initUmpleCanvasSize=function(){this.setUmpleCanvasSize(void 0,this.calculateHeight()),this.initCanvasResizable(),this.initPaletteResizable(),Layout.isDiagramVisible==!1&&Layout.showHideCanvas(!1)},this.initUmpleTextAreaSize=function(){this.setTextEditorSize(),this.initEditorResizable()},this.initPaletteSize=function(){jQuery("#paletteColumn").outerHeight(this.calculateHeight()),jQuery("#palette").accordion("refresh")},this.setTextEditorSize=function(n,t){var n=this.calculateLeftoverWidth();Layout.isPaletteVisible,jQuery(editorHandle).outerWidth(n),t!=null?Layout.adjustTextEditorHeight(t):Layout.adjustTextEditorHeight(this.calculateHeight())},this.setUmpleCanvasSize=function(e,t){Layout.isTextVisible?jQuery(canvasHandle).outerWidth(jQuery("body").width()):jQuery(canvasHandle).outerWidth(this.calculateLeftoverWidth()),t!=null&&jQuery(canvasHandle).outerHeight(t)},this.showHideResize=function(){var e=void 0;this.adjustMarginSpace(),Layout.isTextVisible?this.setTextEditorSize(void 0,jQuery(paletteHandle).outerHeight()):e=jQuery(paletteHandle).outerHeight(),jQuery("#palette").accordion("refresh"),this.pairResizables(),this.setUmpleCanvasSize(void 0,e)},this.showHideResizableAdjustment=function(){},this.adjustAfterWindowResize=function(){jQuery("#paletteColumn").outerHeight(this.calculateHeight()),jQuery("#palette").accordion("refresh"),this.setTextEditorSize(),this.setUmpleCanvasSize(void 0,this.calculateHeight())},this.initEditorResizable=function(){jQuery(editorHandle).resizable({autoHide:!0,minHeight:30,handles:"s"}),this.pairResizables()},this.initPaletteResizable=function(){jQuery(paletteHandle).resizable({autoHide:!0,minHeight:30,handles:"s"}),this.pairResizables()},this.initCanvasResizable=function(){jQuery(canvasHandle).resizable({autoHide:!0,minHeight:30,handles:"s"}),this.pairResizables()},this.verticallyResizing=function(e,t){jQuery(paletteHandle).outerHeight(t.size.height),jQuery("#palette").accordion("refresh")},this.verticallyResized=function(e,t){},this.editorResizing=function(e,t){Layout.adjustTextEditorHeight(t.size.height)},this.editorResized=function(e,t){},this.canvasResizing=function(e,t){jQuery(canvasHandle).outerHeight(t.size.height)},this.canvasResized=function(e,t){},this.adjustMarginSpace=function(){jQuery(canvasHandle).removeClass("smallScreenCanvas smallScreenCanvasNoEditor smallScreenCanvasNoEditorNoPalette"),jQuery(editorHandle).removeClass("smallScreenEditor smallScreenEditorNoMargin"),Layout.isTextVisible?(jQuery(canvasHandle).addClass("smallScreenCanvas"),Layout.isPaletteVisible?jQuery(editorHandle).addClass("smallScreenEditor"):jQuery(editorHandle).addClass("smallScreenEditorNoMargin")):(jQuery(editorHandle).addClass("smallScreenEditorNoMargin"),Layout.isPaletteVisible&&Layout.isDiagramVisible?jQuery(canvasHandle).addClass("smallScreenCanvasNoEditor"):jQuery(canvasHandle).addClass("smallScreenCanvasNoEditorNoPalette")),this.marginSpace=parseInt(jQuery("body").css("marginLeft"))+parseInt(jQuery("body").css("marginRight"))+1+parseInt(jQuery(editorHandle).css("marginRight"))+parseInt(jQuery(canvasHandle).css("marginLeft"))},this.calculateLeftoverWidth=function(){return Layout.isPaletteVisible?jQuery("body").outerWidth(!0)-this.marginSpace-jQuery(paletteHandle).outerWidth():jQuery("body").outerWidth(!0)-this.marginSpace},this.calculateHeight=function(){var e=TabControl.isHidden()?0:jQuery("#tabControl").outerHeight(),t=jQuery("#taskArea").css("display")=="none"?0:jQuery("#taskArea").outerHeight();t>jQuery(window).innerHeight()/2&&(t=0);var n=(jQuery(window).innerHeight()-jQuery("#header").outerHeight(!0)-2*jQuery("#topLine").outerHeight(!0)-e-Layout.errorMessageSpace)/2-t;return n},this.pairResizables=function(){if(!(!jQuery(editorHandle).is(".ui-resizable")||!jQuery(paletteHandle).is(".ui-resizable")||!jQuery(canvasHandle).is(".ui-resizable"))){if(Layout.isTextVisible)var e=function(s,c){Layout.editorResizing(s,c),Layout.verticallyResizing(s,c)},t=e,n=function(s,c){Layout.canvasResizing(s,c)},r=function(s,c){Layout.editorResized(s,c),Layout.verticallyResized(s,c)},o=r,a=function(s,c){Layout.canvasResized(s,c)};else var e=function(h,b){Layout.editorResizing(h,b)},n=function(h,b){Layout.canvasResizing(h,b),Layout.verticallyResizing(h,b)},t=n,r=function(h,b){Layout.editorResized(h,b)},a=function(h,b){Layout.canvasResized(h,b),Layout.verticallyResized(h,b)},o=a;jQuery(editorHandle).resizable("option","resize",e),jQuery(editorHandle).resizable("option","stop",r),jQuery(paletteHandle).resizable("option","resize",t),jQuery(paletteHandle).resizable("option","stop",o),jQuery(canvasHandle).resizable("option","resize",n),jQuery(canvasHandle).resizable("option","stop",a)}}}function UmpleLine(e,t){this.pointOne=e,this.pointTwo=t,this.drawable=function(n){var r=jQuery("<div class='umpleLine'></div>"),o=UmplePositionFactory.copy(this.pointOne),a=UmplePositionFactory.copy(this.pointTwo);typeof n<"u"&&(o.x=o.x+n.x,o.y=o.y+n.y,a.x=a.x+n.x,a.y=a.y+n.y);var s=0;if(o.y==a.y){var c=o.x<a.x?o:a,d=Math.abs(a.x-o.x);return r.append(this.createConnector(c.x,c.y,d,1)),r.append(this.createSelector(c.x,c.y,d,6)),r}else if(o.x==a.x){var c=o.y<a.y?o:a,u=Math.abs(a.y-o.y);return r.append(this.createConnector(c.x,c.y,1,u)),r.append(this.createSelector(c.x,c.y,6,u)),r}var f=this.slope(),g=a.x>o.x?1:-1,h=g*f;Math.abs(f)>1&&(h=a.y>o.y?1:-1,g=h*(1/f));for(var b=0,E=o.y,S=o.x;(S<=a.x&&g>0||S>=a.x&&g<0)&&!(b++>1e3);S+=g)r.append(this.createConnector(S,E,1,1)),r.append(this.createSelector(S,E,6,6)),E+=h,s++;return r},this.slope=function(){return slope=(this.pointTwo.y-this.pointOne.y)/(this.pointTwo.x-this.pointOne.x),slope},this.length=function(){var n=this.pointTwo.x-this.pointOne.x,r=this.pointTwo.y-this.pointOne.y,o=Math.sqrt(Math.pow(n,2)+Math.pow(r,2));return Math.round(o)},this.createConnector=function(n,r,o,a){var s=jQuery("<div></div>");return s.addClass("umpleAssociation"),s.attr("name",this.startId),s.css({position:"absolute",left:n,top:r,width:o,height:a}),s},this.createSelector=function(n,r,o,a){var s=jQuery("<div></div>");return s.addClass("umpleAssociationSelector"),s.attr("name",this.startId),s.css({position:"absolute",left:n,top:r,width:o,height:a}),s},this.intersection=function(n){var r=this.pointOne.x,o=this.pointOne.y,a=this.pointTwo.x,s=this.pointTwo.y,c=n.pointOne.x,d=n.pointOne.y,u=n.pointTwo.x,f=n.pointTwo.y,g=this.slope(),h=n.slope(),b=null,E=null,S=null,D=null,j=!1;if(g==h)return null;g==1/0||g==-1/0?(D=d-h*c,b=r,E=h*b+D,j=!0):(h==1/0||h==-1/0)&&(S=o-g*r,b=c,E=g*b+S,j=!0),j||(S=o-g*r,D=d-h*c,b=(D-S)/(g-h),E=g*b+S);var p=a>r?a:r,C=u>c?u:c,M=s>o?s:o,_=f>d?f:d,T=p==a?r:a,P=C==u?c:u,k=M==s?o:s,U=_==f?d:f;return b<T||b<P||b>p||b>C||E<k||E<U||E>M||E>_?null:(b=Math.round(b),E=Math.round(E),new UmplePosition(b,E,0,0))}}UmpleMethodFactory=new Object,UmpleMethodFactory.create=function(e){var t=new UmpleMethod(e.visibility,e.isAbstract,e.type,e.name,e.parameters);return t};function UmpleMethod(e,t,n,r,o){this.visibility=e,this.isAbstract=t,this.type=n,this.name=r,this.parameters=typeof o=="string"?o.split(","):o,this.set=function(a){var s=this.name!="";s&&(this.oldVisibility=this.visibility,this.oldType=this.type,this.oldName=this.name,this.oldParameters=this.parameters),a=a.trim();var c=a.charAt(0);c=="+"?(this.visibility="public",a=a.substr(1)):c=="-"?(this.visibility="private",a=a.substr(1)):c=="#"?(this.visibility="protected",a=a.substr(1)):this.visibility="public";var d=a.split(":");if(d.length<2)this.type="void",this.name=a.substring(0,a.indexOf("(")).trim(),this.parameters=a.match("\\((.*)\\)")[1].replace(/\s+/g,"").split(",");else{var u=d[0].trim();this.type=d[1].trim(),this.name=u.substring(0,u.indexOf("(")).trim(),this.parameters=u.match("\\((.*)\\)")[1].replace(/\s+/g,"").split(",")}s||(this.newVisibility=this.visibility,this.newType=this.type,this.newName=this.name,this.newParameters=this.parameters)},this.copy=function(){return new UmpleMethod(this.visibility,this.type,this.name,this.parameters)}}Page=new Object,Page.currentUmpleTextBeingEdited="",Page.selectedItem=null,Page.selectedClass=null,Page.selectedAssociation=null,Page.selectedTransition=null,Page.selectedGeneralization=null,Page.canEditTask=!1,Page.canCreateTask=!0,Page.codeEffect=null,Page.clickCount=0,Page.repeatToolItem=!1,Page.shortcutsEnabled=!0,Page.diagramSyncNeededAppend=!1,Page.modelDelimiter="//$?[End_of_model]$?",Page.codeMirrorOn=!1,Page.codeMirrorEditor=null,Page.codeMirrorEditor6=null,Page.hLine=null,Page.modelLoadingCount=0,Page.layoutLoadingCount=0,Page.canvasLoadingCount=0,Page.onLoadingCompleteCallbacks=[],Page.readOnly=!1,Page.useEditableClassDiagram=!0,Page.useGvClassDiagram=!1,Page.useGvStateDiagram=!1,Page.useGvFeatureDiagram=!1,Page.showFeatureDependency=!1,Page.useStructureDiagram=!1,Page.useFeatureDiagram=!1,Page.showAttributes=!0,Page.showMethods=!1,Page.filterWordsOutput="",Page.mixsetsActive=new Array,Page.filtersActive=new Array,Page.copyableMixset="",Page.specialSuboptionsActive=new Array,Page.showActions=!0,Page.showText=!0,Page.showCanvas=!0,Page.showTraits=!1,Page.showTransitionLabels=!1,Page.showGuardLabels=!1,Page.showGuards=!0,Page.modifiedDiagrams=!1,Page.allowPinch=!1,Page.initialMouseDownX=0,Page.initialMouseDownY=0,Page.selectedGvClass="",Page.blahblah=function(e){console.log("In blah blah "+e)},Page.isGvManual=function(){return Page.specialSuboptionsActive.includes("gvmanual")},Page.init=function(e,t,n,r,o,a,s,c,d,u,f){performance.navigation.type==2&&location.reload(!0),Page.canEditTask=d,Page.canCreateTask=u,Layout.isDiagramVisible=e,Layout.isTextVisible=t,Layout.isPaletteVisible=n,Layout.isLayoutVisible=o,Page.readOnly=r,TabControl.init(),jQuery(".layoutListItem").hide(),a.toLowerCase()=="gvstate"||a.toLowerCase()=="state"?(Page.useGvStateDiagram=!0,Page.useEditableClassDiagram=!1,Page.setDiagramTypeIconState("GvState"),Page.useGvFeatureDiagram=!1,jQuery(".view_opt_state").show()):a.toLowerCase()=="gvclass"?(Page.useGvClassDiagram=!0,Page.useEditableClassDiagram=!1,Page.setDiagramTypeIconState("GvClass"),Page.useGvFeatureDiagram=!1,jQuery(".view_opt_class").show()):a.toLowerCase()=="gvclasstrait"?(Page.useGvClassDiagram=!0,Page.useEditableClassDiagram=!1,Page.setDiagramTypeIconState("GvClass"),Page.useGvFeatureDiagram=!1,Page.showTraits=!0,jQuery(".view_opt_class").show()):a.toLowerCase()=="gvfeature"?(Page.useGvFeatureDiagram=!0,Page.useEditableClassDiagram=!1,Page.useGvStateDiagram=!1,Page.useStructureDiagram=!1,Page.setDiagramTypeIconState("GvFeature"),jQuery(".view_opt_feature").show()):a.toLowerCase()=="structurediagram"?(Page.useStructureDiagram=!0,Page.useEditableClassDiagram=!1,Page.setDiagramTypeIconState("structureDiagram"),Page.useGvFeatureDiagram=!1):(jQuery(".view_opt_class").show(),jQuery(".view_opt_class_palette").show()),f!=""&&(f.includes("gvmanual")&&(Page.specialSuboptionsActive.push("gvmanual"),f=f.replace("gvmanual","")),f.includes("gvdot")?(Page.specialSuboptionsActive.push("gvdot"),f=f.replace("gvdot","")):f.includes("gvsfdp")?(Page.specialSuboptionsActive.push("gvsfdp"),f=f.replace("gvsfdp","")):f.includes("gvortho")&&(Page.specialSuboptionsActive.push("gvortho"),f=f.replace("gvortho","")),jQuery("#filtervalues").val(f),Action.setFilterFull(f,!1)),jQuery.noConflict(),jQuery(document).keydown(function(g){Action.keyboardShortcut(g)}),Layout.init(),Page.initPaletteArea(),Page.initCanvasArea(),Page.initUmpleTextArea(),Page.initSourceCodeArea(),Page.initCodeExecutionArea(),jQuery(document).ready(function(){DropboxInitializer.initializeDropbox(),ToolTips.initTooltips(),window.AiSettings&&window.AiSettings.init&&window.AiSettings.init()}),Page.readOnly&&jQuery("#"+Page.umpleCanvasId()).addClass("photoReady"),Action.loadFile(),c&&Action.loadTask(jQuery("#model").val().split("-")[1],!0),jQuery(s).prop("selected",!0)},Page.initPaletteArea=function(){var e="#palette",t=e+" *";jQuery(e).accordion({heightStyle:"fill",fillSpace:!0,active:1,collapsible:!0}),jQuery(t).addClass("unselectable"),Layout.initPaletteSize(),Page.initJQueryButton("buttonGenerateCode"),Page.initJQueryButton("buttonExecuteCode"),Page.initJQueryButton("buttonStartOver"),Page.initJQueryButton("buttonShowRefreshUmpleOnlineCompletely"),Page.initJQueryButton("buttonLoadBlankModel"),Page.initHighlighter("buttonAddClass"),Page.initHighlighter("buttonAddAssociation"),Page.initHighlighter("buttonAddTransition"),Page.initHighlighter("buttonAddGeneralization"),Page.initHighlighter("buttonDeleteEntity"),Page.initHighlighter("buttonPngImage"),Page.initHighlighter("buttonYumlImage"),Page.initHighlighter("buttonSimulateCode"),Page.initHighlighter("buttonUigu"),Page.initHighlighter("buttonCopyClip"),Page.initHighlighter("buttonCopyMix"),Page.initHighlighter("buttonCollabFork"),Page.initHighlighter("buttonCopy"),Page.initHighlighter("buttonCopyEncodedURL"),Page.initHighlighter("buttonCopyCommandLine"),Page.initHighlighter("buttonCopyLocalBrowser"),Page.initHighlighter("buttonLoadLocalBrowser"),Page.canEditTask&&(Page.initHighlighter("buttonRequestAllZip"),Page.initHighlighter("buttonRequestLoadTaskURL")),Page.canCreateTask&&Page.initHighlighter("buttonCreateTask"),Page.initHighlighter("buttonLoadTask"),Page.initHighlighter("buttonDownloadFiles"),Page.initHighlighter("buttonSmaller"),Page.initHighlighter("buttonLarger"),Page.initHighlighter("buttonSyncCode"),Page.initHighlighter("buttonSyncDiagram"),Page.initHighlighter("buttonToggleMethods"),Page.initHighlighter("buttonToggleAttributes"),Page.initHighlighter("buttonToggleActions"),Page.initHighlighter("buttonToggleTransitionLabels"),Page.initHighlighter("buttonToggleGuards"),Page.initHighlighter("buttonToggleGuardLabels"),Page.initHighlighter("buttonToggleTraits"),Page.initHighlighter("buttonToggleFeatureDependency"),Page.initHighlighter("buttonallowPinch"),Page.initHighlighter("buttonReindent"),Page.initToggleTool("buttonAddClass"),Page.initToggleTool("buttonAddAssociation"),Page.initToggleTool("buttonAddTransition"),Page.initToggleTool("buttonAddGeneralization"),Page.initToggleTool("buttonDeleteEntity"),Page.initAction("buttonPngImage"),Page.initAction("buttonYumlImage"),Page.initAction("buttonPhpCode"),Page.initAction("buttonEcoreCode"),Page.initAction("buttonJavaCode"),Page.initAction("buttonJavaAPIDoc"),Page.initAction("buttonRubyCode"),Page.initAction("buttonAlloyCode"),Page.initAction("buttonNuSMVCode"),Page.initAction("buttonSqlCode"),Page.initAction("buttonCppCode"),Page.initAction("buttonPhotoReady"),Page.initAction("buttonSimulateCode"),Page.initAction("buttonShowHideTextEditor"),Page.initAction("buttonShowHideCanvas"),Page.initAction("buttonShowEditableClassDiagram"),Page.initAction("buttonShowJointJSClassDiagram"),Page.initAction("buttonShowGvClassDiagram"),Page.initAction("buttonShowGvStateDiagram"),Page.initAction("buttonShowGvFeatureDiagram"),Page.initAction("buttonShowStructureDiagram"),Page.initAction("buttonShowHideLayoutEditor"),Page.initAction("buttonManualSync"),Page.initAction("buttonCopyClip"),Page.initAction("buttonCopyMix"),Page.initAction("buttonCollabFork"),Page.initAction("buttonCopy"),Page.initAction("buttonCopyEncodedURL"),Page.initAction("buttonCopyCommandLine"),Page.initAction("buttonCopyLocalBrowser"),Page.initAction("buttonLoadLocalBrowser"),Page.canEditTask&&(Page.initAction("buttonRequestAllZip"),Page.initAction("buttonRequestLoadTaskURL")),Page.canCreateTask&&Page.initAction("buttonCreateTask"),Page.initAction("buttonLoadTask"),Page.initAction("buttonDownloadFiles"),Page.initAction("buttonUndo"),Page.initAction("buttonRedo"),Page.initAction("buttonReindent"),Page.initAction("buttonUigu"),Page.initAction("buttonStartOver"),Page.initAction("buttonShowRefreshUmpleOnlineCompletely"),Page.initAction("buttonLoadBlankModel"),Page.initAction("buttonGenerateCode"),Page.initAction("buttonExecuteCode"),Page.initAction("buttonTabsCheckbox"),Page.initAction("buttonSmaller"),Page.initAction("buttonLarger"),Page.initAction("buttonSyncCode"),Page.initAction("buttonSyncDiagram"),Page.initAction("buttonToggleMethods"),Page.initAction("buttonToggleAttributes"),Page.initAction("buttonToggleActions"),Page.initAction("buttonToggleTraits"),Page.initAction("buttonToggleFeatureDependency"),Page.initAction("buttonToggleTransitionLabels"),Page.initAction("buttonToggleGuards"),Page.initAction("buttonToggleGuardLabels"),Page.initAction("buttonAllowPinch"),Page.initLabels(),Page.enablePaletteItem("buttonUndo",!1),Page.enablePaletteItem("buttonRedo",!1),Page.enablePaletteItem("buttonSyncDiagram",!1),Page.enablePaletteItem("buttonAddTransition",!1),jQuery("#genstatus").hide(),jQuery("#buttonViewComplete").hide(),Page.initExamples(),Page.initOptions(),Page.readOnly&&(jQuery("#mainDrawMenu").hide(),jQuery(".layoutListItem").hide(),jQuery("#preferencesTitle").hide(),jQuery("#ttPhotoReady").hide(),jQuery("#ttManualSync").hide(),jQuery("#canvasSizeTitle").hide(),jQuery("#buttonSmaller").hide(),jQuery("#buttonLarger").hide(),jQuery("#menuBookmarkable").hide()),(Page.readOnly||!Layout.isPaletteVisible)&&jQuery("#topBookmarkable").hide(),Layout.isPaletteVisible||jQuery("#paletteColumn").hide(),Layout.isTextVisible||(Page.readOnly?jQuery("#topLine").hide():jQuery("#linetext").hide()),jQuery("#inputGenerateCode").on("change",function(){this.value.split(":")[1]==="Java"||this.value.split(":")[1]==="Python"?jQuery("#buttonExecuteCode").show():jQuery("#buttonExecuteCode").hide()})},Page.initOptions=function(){jQuery("#buttonShowHideLayoutEditor").prop("checked",Layout.isLayoutVisible),jQuery("#buttonShowHideTextEditor").prop("checked",Layout.isTextVisible),jQuery("#buttonShowHideCanvas").prop("checked",Layout.isDiagramVisible),jQuery("#buttonTabsCheckbox").prop("checked",!1),jQuery("#tabRow").hide(),jQuery("#ttTabsCheckbox").hide(),jQuery("#buttonToggleAttributes").prop("checked",!0),jQuery("#buttonToggleActions").prop("checked",!0),jQuery("#buttonToggleTransitionLabels").prop("checked",!1),jQuery("#buttonToggleGuards").prop("checked",!0),jQuery("#buttonToggleGuardLabels").prop("checked",!1),jQuery("#buttonToggleTraits").prop("checked",Page.showTraits),jQuery("#buttonToggleFeatureDependency").prop("checked",!1),jQuery("#buttonAllowPinch").prop("checked",!1),Page.useEditableClassDiagram&&jQuery("#buttonShowEditableClassDiagram").prop("checked",!0),Page.useJointJSClassDiagram&&jQuery("#buttonShowJointJSClassDiagram").prop("checked",!0),Page.useGvClassDiagram&&jQuery("#buttonShowGvClassDiagram").prop("checked",!0),Page.useGvFeatureDiagram&&jQuery("#buttonShowGvFeatureDiagram").prop("checked",!0),Page.useGvStateDiagram&&jQuery("#buttonShowGvStateDiagram").prop("checked",!0),Page.useStructureDiagram&&jQuery("#buttonShowStructureDiagram").prop("checked",!0),jQuery("#buttonPhotoReady").prop("checked",!1),jQuery("#buttonManualSync").prop("checked",!1),jQuery("#buttonShowHideTextEditor").prop("disabled",!1),jQuery("#buttonShowHideCanvas").prop("disabled",!1),jQuery("#buttonPhotoReady").prop("disabled",!1),jQuery("#buttonManualSync").prop("disabled",!1)},Page.initHighlighter=function(e){var t="#"+e;jQuery(t).mouseover(function(){Page.highlightItem(e)}),jQuery(t).mouseout(function(){Page.unhighlightItem(e)})},Page.removeHighlighter=function(e){var t="#"+e;jQuery(t).unbind("mouseover"),jQuery(t).unbind("mouseout")},Page.enableCheckBoxItem=function(e,t,n){var r=jQuery("#"+t),o=jQuery("#"+e);n?(o.prop("disabled",!1),o.css("cursor","pointer"),r.css("color","Black")):(o.prop("disabled",!0),o.css("cursor","not-allowed"),r.css("color","Silver"))},Page.enablePaletteItem=function(e,t){var n=jQuery("#"+e),r=!n.hasClass("disabled");r!=t&&(t?(n.removeClass(),n.prop("disabled",!0),Page.initHighlighter(e)):(n.removeClass(),n.addClass("disabled"),n.prop("disabled",!1),Page.removeHighlighter(e)))},Page.initToggleTool=function(e){var t=jQuery("#"+e);t.unbind().click(function(){Page.toggleToolItem(e,!1)}),t.dblclick(function(){Page.toggleToolItem(e,!0)})},Page.removeToggleTool=function(e){var t=jQuery("#"+e);t.unbind("click"),t.unbind("dblclick")},Page.initJQueryButton=function(e){var t="#"+e,n=jQuery(t).attr("value");jQuery(t).button({label:n,className:"jQuery-palette-button"})},Page.initAction=function(e){var t="#"+e;jQuery(t).click(Action.clicked)},Page.initLabels=function(){for(var e=jQuery(".buttonExtend"),t=0,n=e.length;t<n;t++)Page.initLabel(jQuery(e[t]).prop("id"))},Page.initLabel=function(e){var t="#"+e;jQuery(t).click((function(n){return function(){jQuery("#"+jQuery(n).prop("id").replace("label","button")).trigger("click")}})(t))},Page.initUmpleTextArea=function(){var e=jQuery("#newEditor"),t=jQuery("#umpleLayoutEditorText");e.keyup(function(n){Action.freshLoad=!1,Action.umpleTyped(n)}),e.mousedown(function(){setTimeout('jQuery("#linenum").val(Action.getCaretPosition())',25)}),t.keyup(function(n){Action.freshLoad=!1,Action.setjustUpdateNowtoSaveLater(!1),Action.umpleCodeMirrorTypingActivity("layoutEditor")}),e.focusin(function(){Action.focusOn("umpleModelEditorText",!0)}),t.focus(function(){Action.focusOn("umpleLayoutEditorText",!0)}),e.focusout(function(){Action.focusOn("umpleModelEditorText",!1)}),t.blur(function(){Action.focusOn("umpleLayoutEditorText",!1)}),Page.initCodeMirrorEditor(),Layout.initUmpleTextAreaSize(),Layout.isTextVisible||Layout.showHideTextEditor(!1),Layout.isLayoutVisible||Layout.showHideLayoutEditor(!1)},Page.initCodeMirrorEditor=function(){const e=[{key:"Ctrl-E",run:function(){Page.clickShowEditableClassDiagram()}},{key:"Ctrl-J",run:function(){Page.clickShowJointJSClassDiagram()}},{key:"Ctrl-G",run:function(){Page.clickShowGvClassDiagram()}},{key:"Ctrl-S",run:function(){Page.clickShowGvStateDiagram()}},{key:"Ctrl-L",run:function(){Page.clickShowStructureDiagram()}},{key:"Ctrl-T",run:function(){Page.clickShowHideText()}},{key:"Shift-Ctrl-Alt-T",run:function(){Page.clickShowHideText()}},{key:"Ctrl-D",run:function(){Page.clickShowHideCanvas()}},{key:"Ctrl-N",run:function(){Page.clickShowHideMenu()}},{key:"trl-Alt-N",run:function(){Page.clickShowHideMenu()}},{key:"Ctrl-Shift-=",run:function(){Page.clickButtonlarger()}},{key:"Ctrl-Shift--",run:function(){Page.clickButtonSmaller()}},{key:"Shift-Ctrl-A",run:function(){Page.clickToggleAttributes()}},{key:"Ctrl-M",run:function(){Page.clickToggleMethods()}},{key:"Ctrl-R",run:function(){Page.clickToggleTraits()}},{key:"Ctrl-I",run:function(){Page.clickToggleTransitionLabels()}},{key:"Ctrl-K",run:function(){Page.clickToggleGuardLabels()}},{key:"Ctrl-O",run:function(){Page.copyCommandLineCode()}},{key:"Ctrl-B",run:function(){Page.promptAndExecuteTest()}},{key:"Esc",run:function(n){n.getInputField().blur()}}],t=cm6.createEditorState(document.getElementById("newEditor").value,{extensions:[]});Page.codeMirrorEditor6=cm6.createEditorView(t,document.getElementById("newEditor")),Page.codeMirrorEditor6.dispatch({effects:cm6.StateEffect.appendConfig.of(cm6.changeListenerPlugin)}),Page.readOnly&&Page.codeMirrorEditor6.dispatch({effects:cm6.editableCompartment.reconfigure(cm6.EditorView.editable.of(!1))}),Page.setCodeMirror6Text=function(n){Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:n}})},Page.codeMirrorEditor6.dom.addEventListener("mousedown",function(){Action.umpleCodeMirrorCursorActivity()}),Page.codeMirrorOn=!0},Page.setDiagramTypeIconState=function(e){for(buttonList=["ECD_button","GCD_button","SD_button"],i=0,l=buttonList.length;i<l;++i)document.getElementById(buttonList[i]).className="button2";switch(e){case"editableClass":document.getElementById("ECD_button").className="button2 active";break;case"GvClass":document.getElementById("GCD_button").className="button2 active";break;case"GvState":document.getElementById("SD_button").className="button2 active";break}},Page.setShowHideIconState=function(e){switch(e){case"SHT_button":Page.showText?document.getElementById(e).className="button2 active":document.getElementById(e).className="button2";break;case"SHD_button":Page.showCanvas?document.getElementById(e).className="button2 active":document.getElementById(e).className="button2";break;case"SHA_button":Page.showAttributes?document.getElementById(e).className="button2 active":document.getElementById(e).className="button2";break;case"SHM_button":Page.showMethods?document.getElementById(e).className="button2 active":document.getElementById(e).className="button2";break}},Page.clickShowEditableClassDiagram=function(){jQuery("#buttonShowEditableClassDiagram").trigger("click")},Page.clickShowJointJSClassDiagram=function(){jQuery("#buttonShowJointJSClassDiagram").trigger("click")},Page.clickShowGvClassDiagram=function(){jQuery("#buttonShowGvClassDiagram").trigger("click")},Page.clickShowGvStateDiagram=function(){jQuery("#buttonShowGvStateDiagram").trigger("click")},Page.clickShowGvFeatureDiagram=function(){jQuery("#buttonShowGvFeatureDiagram").trigger("click")},Page.clickShowStructureDiagram=function(){jQuery("#buttonShowStructureDiagram").trigger("click")},Page.clickShowHideText=function(){jQuery("#buttonShowHideTextEditor").trigger("click")},Page.clickShowHideCanvas=function(){jQuery("#buttonShowHideCanvas").trigger("click")},Page.clickShowHideMenu=function(){Layout.showHideMenu()},Page.clickButtonlarger=function(){jQuery("#buttonLarger").trigger("click")},Page.clickButtonSmaller=function(){jQuery("#buttonSmaller").trigger("click")},Page.clickToggleAttributes=function(){jQuery("#buttonToggleAttributes").trigger("click")},Page.clickToggleMethods=function(){jQuery("#buttonToggleMethods").trigger("click")},Page.clickToggleTraits=function(){jQuery("#buttonToggleTraits").trigger("click")},Page.clickToggleFeatureDependency=function(){jQuery("#buttonToggleFeatureDependency").trigger("click")},Page.clickToggleTransitionLabels=function(){jQuery("#buttonToggleTransitionLabels").trigger("click")},Page.clickToggleGuardLabels=function(){jQuery("#buttonToggleGuards").trigger("click")},Page.clickToggleGuardLabels=function(){jQuery("#buttonToggleGuardLabels").trigger("click")},Page.clickAllowPinch=function(){jQuery("#buttonAllowPinch").trigger("click")},Page.isPhotoReady=function(){if(Page.readOnly)return!0;var e="#buttonPhotoReady";return jQuery(e).prop("checked")},Page.initSourceCodeArea=function(){SyntaxHighlighter.config.clipboardSwf="scripts/clipboard.swf";var e="#generatedCodeRow";jQuery(e).hide()},Page.initCodeExecutionArea=function(){var e="#codeExecutionArea";jQuery(e).hide()},Page.showExecutionArea=function(){var e="#codeExecutionArea";jQuery(e).show()},Page.hideExecutionArea=function(){var e="#codeExecutionArea";jQuery(e).hide()},Page.hideGeneratedCode=function(){jQuery("#generatedCodeRow").hide(),jQuery("#innerGeneratedCodeRow").hide(),Page.useStructureDiagram||jQuery("#svgCanvas").hide()},Page.hideGeneratedCodeOnly=function(){jQuery("#generatedCodeRow").hide(),jQuery("#innerGeneratedCodeRow").hide()},Page.initCanvasArea=function(){var e=jQuery("#umpleCanvas");Layout.initUmpleCanvasSize(),e.click(function(t){Action.umpleCanvasClicked(t)}),e.mousemove(Action.mouseMove),e.focus(function(){Action.focusOn(Page.umpleCanvasId(),!0)}),e.blur(function(){Action.focusOn(Page.umpleCanvasId(),!1)}),e.delegate("[class$='editableDoubleClick']","dblclick",InlineEditor.handleOnClick),e.delegate("[class$='editableSingleClick']","click",InlineEditor.handleOnClick),Layout.isDiagramVisible||Layout.showHideCanvas(!1)},Page.setExamples=function(e){var t=e+".ump";jQuery("#inputExample").change(Action.loadExample),jQuery("#inputExample option").each(function(){if(this.value==t||this.value.startsWith("http")&&this.value.endsWith(t)){jQuery('#inputExample option[value = "'+t+'"]').attr("selected",!0);return}}),jQuery("#inputExampleType").change(Action.setExampleType),jQuery("#inputExample2").change(Action.loadExample),jQuery("#inputExample2 option").each(function(){if(this.value==t||this.value.startsWith("http")&&this.value.endsWith(t)){jQuery('#inputExample2 option[value = "'+t+'"]').attr("selected",!0);return}}),jQuery("#inputExample3").change(Action.loadExample),jQuery("#inputExample3 option").each(function(){if(this.value==t||this.value.startsWith("http")&&this.value.endsWith(t)){jQuery('#inputExample3 option[value = "'+t+'"]').attr("selected",!0);return}}),jQuery("#inputExample4").change(Action.loadExample),jQuery("#inputExample4 option").each(function(){if(this.value==t||this.value.startsWith("http")&&this.value.endsWith(t)){jQuery('#inputExample4 option[value = "'+t+'"]').attr("selected",!0);return}}),jQuery("#inputExample5").change(Action.loadExample),jQuery("#inputExample5 option").each(function(){if(this.value==t||this.value.startsWith("http")&&this.value.endsWith(t)){jQuery('#inputExample5 option[value = "extraExamples1/'+t+'"]').attr("selected",!0);return}})},Page.initExamples=function(){jQuery("#inputExample").change(Action.loadExample),jQuery("#defaultExampleOption").attr("selected",!0),jQuery("#inputExampleType").change(Action.setExampleType),jQuery("#inputExample2").change(Action.loadExample),jQuery("#defaultExampleOption2").attr("selected",!0),jQuery("#inputExample3").change(Action.loadExample),jQuery("#defaultExampleOption3").attr("selected",!0),jQuery("#inputExample4").change(Action.loadExample),jQuery("#defaultExampleOption4").attr("selected",!0),jQuery("#inputExample5").change(Action.loadExample),jQuery("#defaultExampleOption5").attr("selected",!0),jQuery("#inputExample6").change(Action.loadExample),jQuery("#defaultExampleOption6").attr("selected",!0),jQuery("#inputExample7").change(Action.loadExample),jQuery("#defaultExampleOption7").attr("selected",!0),jQuery("#inputExample8").change(Action.loadExample),jQuery("#defaultExampleOption8").attr("selected",!0),Page.useStructureDiagram?(jQuery("#structureModels").prop("selected",!0),jQuery("#itemLoadExamples").hide(),jQuery("#itemLoadExamples2").hide(),jQuery("#itemLoadExamples4").hide(),jQuery("#itemLoadExamples5").hide(),jQuery("#itemLoadExamples6").hide(),jQuery("#itemLoadExamples7").hide(),jQuery("#itemLoadExamples8").hide()):Page.useGvStateDiagram?(jQuery("#smModels").prop("selected",!0),jQuery("#itemLoadExamples").hide(),jQuery("#itemLoadExamples3").hide(),jQuery("#itemLoadExamples4").hide(),jQuery("#itemLoadExamples5").hide(),jQuery("#itemLoadExamples6").hide(),jQuery("#itemLoadExamples7").hide(),jQuery("#itemLoadExamples8").hide()):Page.useGvFeatureDiagram?(jQuery("#featureModels").prop("selected",!0),jQuery("#itemLoadExamples").hide(),jQuery("#itemLoadExamples2").hide(),jQuery("#itemLoadExamples3").hide(),jQuery("#itemLoadExamples5").hide(),jQuery("#itemLoadExamples6").hide(),jQuery("#itemLoadExamples7").hide(),jQuery("#itemLoadExamples8").hide()):(jQuery("#cdModels").prop("selected",!0),jQuery("#itemLoadExamples2").hide(),jQuery("#itemLoadExamples3").hide(),jQuery("#itemLoadExamples4").hide(),jQuery("#itemLoadExamples5").hide(),jQuery("#itemLoadExamples6").hide(),jQuery("#itemLoadExamples7").hide(),jQuery("#itemLoadExamples8").hide())},Page.highlightItem=function(e){var t="#"+e;jQuery(t).addClass("highlight")},Page.unhighlightItem=function(e){var t="#"+e;jQuery(t).removeClass("highlight")},Page.enableDiagram=function(e){Page.enableEditDragAndResize(e),Page.enablePaletteItem("buttonAddClass",e),Page.enablePaletteItem("buttonAddAssociation",e),Page.enablePaletteItem("buttonAddGeneralization",e),Page.enablePaletteItem("buttonDeleteEntity",e),Page.showDiagramSyncNeeded(!e)},Page.enableTransition=function(e){Page.enablePaletteItem("buttonAddTransition",e),Page.enablePaletteItem("buttonAddAssociation",!e)},Page.enableEditDragAndResize=function(e){e?(jQuery("span.editable").removeClass("uneditable"),jQuery("div.umpleClass").removeClass("unselectable"),jQuery("div.umpleClass.ui-draggable").draggable({disabled:!1})):(jQuery("span.editable").addClass("uneditable"),jQuery("div.umpleClass").addClass("unselectable"),jQuery("div.umpleClass.ui-draggable").draggable({disabled:!0}),jQuery(":text").blur())},Page.toggleToolItem=function(e,t){t==null&&(t=!1),Page.repeatToolItem=t;var n=e.substring(6),r=n!=Page.selectedItem;r?Page.selectToggleTool(n):Page.unselectAllToggleTools()},Page.unselectAllToggleTools=function(){var e=!1,t=!1;t=DiagramEdit.removeNewClass(),t&&(e=!0),t=DiagramEdit.removeNewAssociation(),t&&(e=!0),t=DiagramEdit.removeNewTransition(),t&&(e=!0),t=DiagramEdit.removeNewGeneralization(),t&&(e=!0);var n="ul.toggle li.selected";return jQuery(n).removeClass("selected highlight"),setTimeout("Page.enableEditDragAndResize(true);",500),Page.selectedItem=null,Page.repeatToolItem=!1,e},Page.selectToggleTool=function(e){Page.selectedItem!=null&&(DiagramEdit.removeNewClass(),DiagramEdit.removeNewAssociation(),DiagramEdit.removeNewTransition(),DiagramEdit.removeNewGeneralization()),Page.enableEditDragAndResize(!1),Page.selectedItem=e,Action.unselectAll();var t=format("ul.toggle li.selected"),n="#button"+e;jQuery(t).removeClass("selected highlight"),jQuery(n).addClass("selected")},Page.canShowHovers=function(){return Page.selectedItem==null||Page.selectedItem=="DeleteEntity"},Page.getRawUmpleCode=function(){return document.getElementById("umpleModelEditorText").value},Page.getRawUmpleCodeCM6=function(){return Page.codeMirrorEditor6.state.doc.toString()},Page.getUmpleCode=function(){var e=Page.getRawUmpleCodeCM6().replace(Page.modelDelimiter,""),t=jQuery("#umpleLayoutEditorText").val().replace(Page.modelDelimiter,"");t!==""&&!t.includes("namespace -;")&&(t=`

namespace -;
`+t);var n=e+Page.modelDelimiter+t;return n},Page.getEncodedURL=function(){var e=window.location.href.split("?")[0];return e.substr(0,37)=="https://cruise.umple.org/umpleonline/"&&(e="http://try.umple.org/"),e+"?text="+encodeURIComponent(Page.getUmpleCode())},Page.splitUmpleCode=function(e){var t=e.indexOf(Page.modelDelimiter);if(t==-1)n=e,r="";else{e=e.replace(Page.modelDelimiter,"");var n=e.substr(0,t),r=e.substr(t,e.length)}var o=[n,r];return o},Page.setUmpleCode=function(e,t){var n=Page.splitUmpleCode(e);jQuery("#umpleLayoutEditorText").val(n[1]),Page.codeMirrorOn&&(typeof t=="boolean"&&t==!1||Page.setCodeMirror6Text(n[0])),Action.updateCurrentUmpleTextBeingEdited(n[0]),typeof t=="function"&&t()},Page.setUmplePositioningCode=function(e){jQuery("#umpleLayoutEditorText").val(e)},Page.umpleCanvasId=function(){return"umpleCanvas"},Page.createBookmark=function(){TabControl.useActiveTabTo(TabControl.saveTab)(Page.getUmpleCode()),TabControl.saveActiveTabs(),window.location.href="bookmark.php?model="+Page.getModel()},Page.createBookmarkFork=function(){TabControl.useActiveTabTo(TabControl.saveTab)(Page.getUmpleCode()),TabControl.saveActiveTabs(),window.location.href="bookmark.php?model="+Page.getModel()+"&forkSoMakeTmpOnly"},Page.createTask=function(){var e=jQuery("#taskName").val();if(!/^(\w|\.)+$/.test(e)){window.alert("Task Name can only contain letters(case insensitive), underscores, dots, and digits!");return}var n=jQuery("#requestorName").val(),r=jQuery("#instructions"),o=jQuery("#completionURL").val(),a=jQuery("#isExperiment").is(":checked");TabControl.useActiveTabTo(TabControl.saveTab)(Page.getUmpleCode()),TabControl.saveActiveTabs(),Ajax.sendRequest("task.php",Page.createTaskCallback,format("taskName={0}&instructions={1}&model={2}&requestorName={3}&completionURL={4}&isExperiment={5}",e,r.val(),Page.getModel(),n,o,a))},Page.createTaskCallback=function(e){e.responseText.split(" ")[0]=="Task"?window.alert("Not able to create a task with that name. "+e.responseText):window.location.href="umple.php?task=1&model="+e.responseText},Page.editTask=function(){var e=jQuery("#instructions"),t=jQuery("#model").val().split("-")[1],n=jQuery("#requestorName").val(),r=jQuery("#completionURL").val(),o=jQuery("#isExperiment").is(":checked");TabControl.useActiveTabTo(TabControl.saveTab)(Page.getUmpleCode()),TabControl.saveActiveTabs(),Ajax.sendRequest("task.php",Page.editTaskCallback,"edit=1&taskName="+t+"&instructions="+e.val()+"&model="+Page.getModel()+"&requestorName="+n+"&completionURL="+r+"&isExperiment="+o)},Page.editTaskCallback=function(e){Page.setFeedbackMessage("Changes saved")},Page.cancelTaskResponse=function(){var e=confirm("Are you sure to cancel this task response?");e&&(window.location.href="task.php?cancelTaskResponse=1&model="+Page.getModel())},Page.hideTask=function(){jQuery("#taskArea").css("display","none"),jQuery("#labelTaskName").css("display","none"),jQuery("#taskNameCell").css("display","none"),jQuery("#instructions").css("display","none"),jQuery("#isExperimentCell").css("display","none"),jQuery("#isExperiment").attr("checked",!1),Layout.zoomResize()},Page.cancelTask=function(){if(jQuery("#completionURL").val()!=""||jQuery("#taskName").val()!=""||jQuery("#requestorName").val()!=""||jQuery("#instructions").val()!=""){var e=confirm("Are you sure you want to end the task creation process?");e&&(jQuery("#taskName").val(""),jQuery("#requestorName").val(""),jQuery("#completionURL").val(""),jQuery("#instructions").val(""),Page.hideTask())}else Page.hideTask()},Page.endTaskEdit=function(){var e=confirm("Are you sure you want to end the task editing process?");e&&Page.hideTask()},Page.toggleTabs=function(){TabControl.isHidden()?TabControl.showTabs():TabControl.hideTabs(),Layout.layoutHandler.adjustAfterWindowResize()},Page.showDiagramSyncNeeded=function(e){var t=jQuery("#umpleCanvas"),n='<div id="syncNeededMessage" class="syncNeededMessage unselectable">Diagram is out of synchronization with the text due to selecting Manual Sync or an error in the text that has caused the compiler to produce no output. </div>';e&&!Page.diagramSyncNeededAppend?(t.append(n),Page.diagramSyncNeededAppend=!0,Page.readOnly=!0,UmpleSystem.redrawCanvas()):!e&&Page.diagramSyncNeededAppend&&(jQuery("#syncNeededMessage").remove(),Page.diagramSyncNeededAppend=!1,Page.readOnly=!1,UmpleSystem.redrawCanvas())},Page.hideLoading=function(){var e="#newEditor",t="#bottomTextEditor",n="#"+Page.umpleCanvasId();Page.modelLoadingCount>0&&Page.modelLoadingCount--,Page.layoutLoadingCount>0&&Page.layoutLoadingCount--,Page.canvasLoadingCount>0&&Page.canvasLoadingCount--,Page.modelLoadingCount===0&&jQuery(e).hideLoading(),Page.layoutLoadingCount===0&&jQuery(t).hideLoading(),Page.canvasLoadingCount===0&&jQuery(n).hideLoading(),Page.modelLoadingCount===0&&Page.layoutLoadingCount===0&&Page.canvasLoadingCount===0&&jQuery(".bookmarkableUrl").removeClass("disabled")},Page.showModelLoading=function(){var e=jQuery("#newEditor");Page.modelLoadingCount==0&&(jQuery("#textEditorColumn").is(":visible")&&e.showLoading(),jQuery(".bookmarkableUrl").addClass("disabled")),Page.modelLoadingCount++},Page.showLayoutLoading=function(){var e=jQuery("#bottomTextEditor");Page.layoutLoadingCount==0&&(jQuery(".bookmarkableUrl").addClass("disabled"),e.is(":visible")&&e.showLoading()),Page.layoutLoadingCount++},Page.showCanvasLoading=function(){var e=jQuery("#umpleCanvas");Page.canvasLoadingCount==0&&(jQuery(".bookmarkableUrl").addClass("disabled"),e.is(":visible")&&e.showLoading()),Page.canvasLoadingCount++},Page.resetCanvasSize=function(){Page.setUmpleCanvasSize(Layout.minCanvasSize.width,Layout.minCanvasSize.height)},Page.getSelectedExample=function(){var e="",t=Page.getExampleType(),n=t;if(t.substring(0,5)=="extra"&&(t="cdModels"),t=="cdModels"){var r=!0,o="inputExample";n=="extra1ModelsAD"?(o="inputExample5",r=!0):n=="extra1ModelsEL"?(o="inputExample6",r=!0):n=="extra1ModelsMP"?(o="inputExample7",r=!0):n=="extra1ModelsQZ"&&(o="inputExample8",r=!0),e=jQuery("#"+o+" option:selected").val(),r?Page.useGvClassDiagram||(jQuery("#buttonShowGvClassDiagram").attr("checked",!0),Action.changeDiagramType({type:"GvClass"})):Page.useEditableClassDiagram||Page.useGvClassDiagram||(jQuery("#buttonShowEditableClassDiagram").attr("checked",!0),Action.changeDiagramType({type:"editableClass"}))}else t=="featureModels"?(e=jQuery("#inputExample4 option:selected").val(),Page.useGvFeatureDiagram||(jQuery("#buttonShowGvFeatureDiagram").attr("checked",!0),Action.changeDiagramType({type:"GvFeature"}))):t=="smModels"?(e=jQuery("#inputExample2 option:selected").val(),!Page.useGvStateDiagram&&!Page.useJointJSClassDiagram&&(jQuery("#buttonShowGvStateDiagram").attr("checked",!0),Action.changeDiagramType({type:"GvState"}))):(e=jQuery("#inputExample3 option:selected").val(),Page.useStructureDiagram||(jQuery("#buttonShowStructureDiagram").attr("checked",!0),Action.changeDiagramType({type:"structure"})));return e},Page.getExampleType=function(){var e=jQuery("#exampleType option:selected").val();return e},Page.showCodeDone=function(){var e="#genstatus";jQuery(e).show(),setTimeout(function(){jQuery(e).hide()},2e3)},Page.showViewDone=function(){var e="#buttonViewComplete";jQuery(e).dialog({closeOnEscape:!0,hide:"puff",height:100,width:250}),setTimeout(function(){jQuery(e).dialog("close")},2e3)},Page.showExecutedResponse=function(e){jQuery("#executionMessage").html(e)},Page.showGeneratedCode=function(code,language,tabnumber){typeof tabnumber>"u"&&(tabnumber=""),Action.toggleTabsCheckbox(language),Page.applyGeneratedCodeAreaStyles(language);var errorMarkup=Page.getErrorMarkup(code,language),generatedMarkup=Page.getGeneratedMarkup(code,language);if(tabnumber==""?jQuery("#downloadArea").html(errorMarkup):jQuery("#messageArea").html(errorMarkup),language=="diagramUpdate"){const e=tabnumber==""?jQuery("#downloadArea"):jQuery("#messageArea");typeof AiFix<"u"&&AiFix.decorateErrorOutput&&typeof AiApi<"u"&&AiApi.isVerified&&AiApi.isVerified()&&AiFix.decorateErrorOutput(e.get(0),errorMarkup)}if(language=="java"||language=="php"||language=="cpp"||language=="ruby"||language=="python"||language=="xml"||language=="sql"||language=="alloy"||language=="nusmv")jQuery("#innerGeneratedCodeRow"+tabnumber).html(formatOnce('<pre class="brush: {1};">{0}</pre>',generatedMarkup,language)),SyntaxHighlighter.highlight("code"),tabnumber==""&&(jQuery("#innerGeneratedCodeRow").nextAll().remove(),jQuery("#tabRow").html(""),Action.generateTabsCode(code),Action.toggleTabs());else if(language=="structureDiagram"){eval(generatedMarkup);var downloadLink='<div id="diagramLinkContainer"></div>';errorMarkup=downloadLink+errorMarkup,errorMarkup!=""&&jQuery("#messageArea").html(errorMarkup),Page.toggleStructureDiagramLink(!1)}else jQuery("#innerGeneratedCodeRow"+tabnumber).html(generatedMarkup)},Page.applyGeneratedCodeAreaStyles=function(e){var t=jQuery("#generatedCodeRow");t.show(),jQuery("#innerGeneratedCodeRow").show(),e=="diagramUpdate"?(t.removeClass("generatedCode"),t.removeClass("generatedDiagram")):e=="stateDiagram"||e=="classDiagram"||e=="structureDiagram"?(t.removeClass("generatedCode"),t.addClass("generatedDiagram"),e=="structureDiagram"&&jQuery("#innerGeneratedCodeRow").html('<svg id="generatedSVGCanvas"></svg>')):(t.removeClass("generatedDiagram"),t.addClass("generatedCode"))},Page.getErrorMarkup=function(e,t){var n="";if(t=="classDiagram"||t=="stateDiagram")n=e.split("<svg xmlns=")[0],n=n.replace(/&nbsp;\s*$/,"");else if(t=="javadoc"||t=="yumlDiagram")n=e.split("<iframe ")[0];else if(t=="diagramUpdate")n=e.replace(/<p>[\s\S]*/,"");else{var r=e.split("<p>URL_SPLIT");r.length>1&&(n=r[0])}return n},Page.getGeneratedMarkup=function(e,t){var n="";if(t=="classDiagram"||t=="stateDiagram")n=e.split("<svg width=")[1],n="<svg width="+n,n=n.replace(/<\/svg>$/,"");else if(t=="javadoc"||t=="yumlDiagram")n=e.split("<iframe ")[1],n="<iframe "+n;else if(t!="diagramUpdate")if(t=="structureDiagram")n=e.split("<p>URL_SPLIT")[1],n=n.replace(/##CANVAS_ID##/g,"generatedSVGCanvas"),n=jQuery("<div/>").html(n).text();else{var r=e.split("<p>URL_SPLIT");n=r.length>1?r[1]:e}return n},Page.toggleStructureDiagramLink=function(e,t){linkContainer=jQuery("#diagramLinkContainer"),e?(linkContainer.html(format("<a href='{0}' target='_blank' id='structureLink'>Download the SVG for the following</a>",t)),jQuery("#structureLink").on("click",function(n){Page.toggleStructureDiagramLink(!1)})):(linkContainer.html('<div id="buttonStructureLink" value="Generate SVG"></div>'),Page.initJQueryButton("buttonStructureLink"),Page.initAction("buttonStructureLink"))},Page.setFilename=function(e){jQuery("#filename").val(e)},Page.setFeedbackMessage=function(e){document.getElementById("feedbackMessage").innerHTML=e},Page.setExampleMessage=function(e){document.getElementById("exampleMessage").innerHTML=e},Page.getFeedbackMessage=function(){return document.getElementById("feedbackMessage").innerHTML},Page.catFeedbackMessage=function(e){var t=document.getElementById("feedbackMessage").innerHTML;document.getElementById("feedbackMessage").innerHTML=t+e},Page.getFilename=function(){return jQuery("#filename").val()},Page.getAdvancedMode=function(){return document.getElementById("advancedMode").value},Page.getModel=function(){return jQuery("#model").val()},jQuery.fn.selectRange=function(e,t){return this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(e,t);else if(this.createTextRange){var n=this.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select()}})},Page.isBookmarkURL=function(){const e=window.location.href,t=e.substring(e.indexOf("?model=")+1);return!!(e.includes("model")&&t.length!=0)},UmplePositionFactory=new Object,UmplePositionFactory.copy=function(e){return new UmplePosition(e.x,e.y,e.width,e.height)};function UmplePosition(e,t,n,r){this.x=e,this.y=t,this.width=n,this.height=r,this.set=function(o,a){this.x=o,this.y=a},this.subtract=function(o){return new UmplePosition(this.x-o.x,this.y-o.y,this.width-o.width,this.height-o.height)},this.add=function(o){return o==null?UmplePositionFactory.copy(this):new UmplePosition(this.x+o.x,this.y+o.y,this.width+o.width,this.height+o.height)},this.slopeAngle=function(o){return this.slopeAngleAndQuadrant(o)[0]},this.quadrant=function(o){return this.slopeAngleAndQuadrant(o)[1]},this.equalsIgnoreSize=function(o){return!(this.x!=o.x||this.y!=o.y)},this.slopeAngleAndQuadrant=function(o){var a=o.y-this.y,s=this.x-o.x,c=a/s,d=Math.atan(c)*180/3.14159,u=a>=0&&s>=0,f=a>=0&&s<0,g=a<0&&s>=0,h=a<0&&s<0,b=u?"top-right":f?"top-left":g?"bottom-right":"bottom-left";return[d,b]},this.slopeAngle360=function(o){var a;if(this.y==o.y)return this.x>o.x?180:0;var s=o.y-this.y,c=o.x-this.x,d=c/s;return o.y<this.y?a=90+Math.atan(d)*180/3.14159:a=270+Math.atan(d)*180/3.14159,Math.round(a)},this.travelForward=function(o,a){var s=new UmplePosition(0,0,0,0),c=0,d=0;return a>=0&&a<90?(c=Math.cos(a*3.14159/180)*o,d=Math.sin(a*3.14159/180)*o,s.x=this.x+c,s.y=this.y-d):a>=90&&a<180?(a-=90,c=Math.sin(a*3.14159/180)*o,d=Math.cos(a*3.14159/180)*o,s.x=this.x-c,s.y=this.y-d):a>=180&&a<270?(a-=180,c=Math.cos(a*3.14159/180)*o,d=Math.sin(a*3.14159/180)*o,s.x=this.x-c,s.y=this.y+d):(a-=270,c=Math.sin(a*3.14159/180)*o,d=Math.cos(a*3.14159/180)*o,s.x=this.x+c,s.y=this.y+d),s.x=Math.round(s.x),s.y=Math.round(s.y),s},this.wallsAreAdjacent=function(o,a){return!(o==a||o=="West"&&a=="East"||o=="East"&&a=="West"||o=="North"&&a=="South"||o=="South"&&a=="North")},this.areAnglesSimilar=function(o,a){var s=3;return Math.abs(o-a)<=s},this.toString=function(){return"("+this.x+","+this.y+","+this.width+","+this.height+")"}}jQuery(document).ready(function(){var e="filecode=",t="VIEW=",n="DIAGRAM=",r="PREF=",o=document.cookie.split(";"),a=null;jQuery("#restorecode").hide();for(var s=0;s<o.length;s++){var c=o[s].trim();c.indexOf(e)==0?a=c.substring(e.length,c.length):c.indexOf(t)==0?t=c.substring(t.length,c.length):c.indexOf(n)==0?n=c.substring(n.length,c.length):c.indexOf(r)!=-1&&(r=c.substring(r.length,c.length))}r.indexOf("g")!=-1&&Action.hidegdpr(),a!=null&&a.length!=0&&(jQuery("#restorecode").show(),setTimeout(function(){jQuery("#restorecode").hide()},3e4),jQuery("#restorecode").click(function(){jQuery("#restorecode").hide(),Page.setFilename(a),Action.loadFile(),t.indexOf("d")!=-1?jQuery("#buttonShowHideCanvas").prop("checked")||jQuery("#buttonShowHideCanvas").trigger("click"):jQuery("#buttonShowHideCanvas").prop("checked")&&jQuery("#buttonShowHideCanvas").trigger("click"),t.indexOf("t")!=-1?jQuery("#buttonShowHideTextEditor").prop("checked")||jQuery("#buttonShowHideTextEditor").trigger("click"):jQuery("#buttonShowHideTextEditor").prop("checked")&&jQuery("#buttonShowHideTextEditor").trigger("click"),t.indexOf("l")!=-1?jQuery("#buttonShowHideLayoutEditor").prop("checked")||jQuery("#buttonShowHideLayoutEditor").trigger("click"):jQuery("#buttonShowHideLayoutEditor").prop("checked")&&jQuery("#buttonShowHideLayoutEditor").trigger("click"),t.indexOf("a")!=-1?jQuery("#buttonToggleAttributes").prop("checked")||jQuery("#buttonToggleAttributes").trigger("click"):jQuery("#buttonToggleAttributes").prop("checked")&&jQuery("#buttonToggleAttributes").trigger("click"),t.indexOf("m")!=-1?jQuery("#buttonToggleMethods").prop("checked")||jQuery("#buttonToggleMethods").trigger("click"):jQuery("#buttonToggleMethods").prop("checked")&&jQuery("#buttonToggleMethods").trigger("click"),n.indexOf("e")!=-1?jQuery("#buttonShowEditableClassDiagram").prop("checked")||jQuery("#buttonShowEditableClassDiagram").trigger("click"):n.indexOf("c")!=-1?jQuery("#buttonShowGvClassDiagram").prop("checked")||jQuery("#buttonShowGvClassDiagram").trigger("click"):n.indexOf("s")!=-1&&(jQuery("#buttonShowGvStateDiagram").prop("checked")||jQuery("#buttonShowGvStateDiagram").trigger("click")),r.indexOf("p")!=-1?jQuery("#buttonPhotoReady").prop("checked")||jQuery("#buttonPhotoReady").trigger("click"):jQuery("#buttonPhotoReady").prop("checked")&&jQuery("#buttonPhotoReady").trigger("click"),r.indexOf("s")!=-1?jQuery("#buttonManualSync").prop("checked")||jQuery("#buttonManualSync").trigger("click"):jQuery("#buttonManualSync").prop("checked")&&jQuery("#buttonManualSync").trigger("click")}))}),window.onbeforeunload=function(e){var t=new Date;t.setTime(t.getTime()+720*60*60*1e3),Page.getUmpleCode()!=="//$?[End_of_model]$?"&&(document.cookie="filecode="+Page.getFilename()+";expires="+t.toGMTString()+";",cookie_view="VIEW=",jQuery("#buttonShowHideCanvas").prop("checked")&&(cookie_view+="d"),jQuery("#buttonShowHideTextEditor").prop("checked")&&(cookie_view+="t"),jQuery("#buttonShowHideLayoutEditor").prop("checked")&&(cookie_view+="l"),jQuery("#buttonToggleAttributes").prop("checked")&&(cookie_view+="a"),jQuery("#buttonToggleMethods").prop("checked")&&(cookie_view+="m"),jQuery("#buttonToggleTransitionLabel").prop("checked")&&(cookie_view+="r"),jQuery("#buttonToggleGuardLabel").prop("checked")&&(cookie_view+="g"),cookie_view+=";expires="+t.toGMTString()+";",document.cookie=cookie_view,cookie_diagram="DIAGRAM=",jQuery("#buttonShowEditableClassDiagram").prop("checked")?cookie_diagram+="e":jQuery("#buttonShowGvClassDiagram").prop("checked")?cookie_diagram+="c":jQuery("#buttonShowGvStateDiagram").prop("checked")&&(cookie_diagram+="s"),cookie_diagram+=";expires="+t.toGMTString()+";",document.cookie=cookie_diagram),cookie_pref="PREF=",Action.gdprHidden&&(cookie_pref+="g"),jQuery("#buttonPhotoReady").prop("checked")&&(cookie_pref+="p"),jQuery("#buttonManualSync").prop("checked")&&(cookie_pref+="s"),cookie_pref+=";expires="+t.toGMTString()+";",document.cookie=cookie_pref};function existSCookie(e){return document.cookie.match("(^|;)\\s*"+e+"\\s*=\\s*([^;]+)")}function setCookieBeforeClose(e){e=="on"?window.onbeforeunload=function(){window.randomSurveyRoll!=1?setSurveyCookie(60):notToday?setSurveyCookie(1):clickedForMoreSurvey==!1&&clickedStartSurvey==!1?setSurveyCookie(15):clickedForMoreSurvey==!0&&clickedStartSurvey==!1?setSurveyCookie(30):setSurveyCookie(60)}:window.onbeforeunload=function(){}}function groupHideToday(){hideRecruitementMessage(),document.getElementById("surveyMessage")!=null&&(document.getElementById("mainSurveySpan").removeChild(document.getElementById("surveyMessage")),document.getElementById("mainSurveySpan").removeChild(document.getElementById("surveyExtra"))),notToday=!0}var clickedForMoreSurvey=!1,clickedStartSurvey=!1,displayedText=!1,notToday=!1,timeSurveyUp=!1;if(existSCookie("surveyCookie")==null&&window.surveyData!=null){if(window.randomSurveyRoll==1){var surveySeen=window.localStorage.getItem("surveyShown");if(surveySeen==null||surveySeen!=window.surveyData.SurveyURL){timeSurvey&&clearTimeout(timeSurvey);var timeSurvey=setTimeout(function(){timeSurveyUp=!0},window.surveyData.MinutesBeforePrompt*60*1e3),beforeInstance=TabControl.getCurrentHistory().currentIndex;displayedText||document.addEventListener("mouseover",function(){TabControl.getCurrentHistory().currentIndex-beforeInstance>window.surveyData.EditsBeforePrompt&&!displayedText&&timeSurveyUp&&(displaySurvey(),this.removeEventListener("mouseover",arguments.callee))})}}setCookieBeforeClose("on")}function setSurveyCookie(e){let t=new Date(Date.now()+e*24*60*60*1e3);document.cookie="surveyCookie=done; expires="+t.toUTCString()+"; path=/;"}function displaySurvey(){displayedText=!0;var e=document.getElementById("mainSurveySpan");if(!e.contains(document.getElementById("surveyMessage"))){var t=document.createElement("span");t.innerHTML='<span><a href="'+window.surveyData.SurveyURL+'" target="umplesurvey" onmouseover="showRecruitementMessage()">'+window.surveyData.InvitationalMessage+"</a></span><br/>",t.id="surveyMessage",e.appendChild(t);var n=document.createElement("span");n.innerHTML=window.surveyData.RecruitmentText+'<div id="surveyPopUp"><span class="linkToSurvey" onclick="countClicked()"><a href="'+window.surveyData.SurveyURL+'" target="umplesurvey"class="linkToSurvey">Start Survey</a></span><span onclick="groupHideToday()" class="linkToNotSurvey">Not Today</span></div>',n.id="surveyExtra",e.appendChild(n),n.addEventListener("mouseleave",function(){hideRecruitementMessage()}),t.addEventListener("click",function(){countClicked()}),sendToSurveyLog("SurveyRequested")}}function showRecruitementMessage(){clickedForMoreSurvey=!0,document.getElementById("surveyExtra").classList.contains("fade-in")||(document.getElementById("surveyExtra").classList.remove("fade-outInst"),document.getElementById("surveyExtra").classList.add("fade-in"))}function hideRecruitementMessage(){document.getElementById("surveyExtra").classList.contains("fade-outInst")||(document.getElementById("surveyExtra").classList.remove("fade-in"),document.getElementById("surveyExtra").classList.add("fade-outInst"))}function countClicked(){window.localStorage.setItem("surveyShown",window.surveyData.surveyURL),clickedStartSurvey=!0,sendToSurveyLog("SurveyClicked")}function sendToSurveyLog(e){console.log("processing");let t=new Date(Date.now()).toString();e=="SurveyRequested"&&jQuery.ajax({url:"umple.php",method:"POST",data:{surveyLogInfo:`
`+e+" "+t},dataType:"html"}).done(function(){console.log("Success: Files sent!")}).fail(function(){console.log("An error occurred, the files couldn't be sent!")}),e=="SurveyClicked"&&jQuery.ajax({url:"umple.php",method:"POST",data:{surveyLogInfo2:`
`+e+" "+t},dataType:"html"}).done(function(){console.log("Success: Files sent!")}).fail(function(){console.log("An error occurred, the files couldn't be sent!")})}UmpleSystem=new Object,UmpleSystem.umpleClasses=[],UmpleSystem.umpleAssociations=[],UmpleSystem.umpleTransitions=[],UmpleSystem.position=function(){var e=jQuery("#umpleCanvas"),t=Math.ceil(e.offset().left-e.scrollLeft()),n=Math.ceil(e.offset().top-e.scrollTop()),r=new UmplePosition(t,n,0,0);return r},UmpleSystem.findIn=function(e,t){if(e==null)return null;for(var n=0;n<e.length;n++){var r=e[n];if(r.id==t)return r}return null},UmpleSystem.find=function(e){return UmpleSystem.findIn(this.umpleClasses,e)},UmpleSystem.findAssociation=function(e){var t=UmpleSystem.findIn(this.umpleAssociations,e);return t},UmpleSystem.createAssociation=function(e,t,n,r){var o=new UmpleAssociation;return o.id=this.nextAssociationId(),o.setClasses(e,t),o.setOffsetOnePosition(n),o.setOffsetTwoPosition(r),o.setDefaultMultiplicities(),o.setDefaultRoles(),o.setName(o.getName()),e==t?o.adjustReflexiveEndpoints():o.trimOverlap(),this.addAssociation(o)},UmpleSystem.createTransition=function(e,t){var n=new UmpleTransition;return n.id=this.nextTransitionId(),n.setStates(fromStateId,toStateId),n.setDefaultEvent(),n.setName(n.getName()),this.addTransition(n)},UmpleSystem.createGeneralization=function(e,t){var n=UmpleSystem.find(e);n.extendsClass=t,UmpleSystem.updateClass(n)},UmpleSystem.addAssociation=function(e){this.umpleAssociations.push(e);var t=this.redrawAssociation(e);return e},UmpleSystem.addTransition=function(e){this.umpleTransitions.push(e);var t=this.redrawTransition(e);return e},UmpleSystem.createClass=function(e){var t=new UmpleClass;t.id=this.nextId("NewClass"),t.name=t.id,t.position.set(e.x-UmpleSystem.position().x,e.y-UmpleSystem.position().y,UmpleClassFactory.defaultSize.width,UmpleClassFactory.defaultSize.height);var n=this.addClass(t);return UmpleSystem.redrawGeneralizationsTo(n),n},UmpleSystem.addClass=function(e){this.umpleClasses.push(e),this.updateClass(e);var t=jQuery("#"+e.id);return t.click(Action.classClicked),t.mouseover(function(n){Action.classHover(n,!0)}),t.mouseout(function(n){Action.classHover(n,!1)}),t.mousedown(function(n){setTimeout(function(){Action.classMouseDown(n)},400)}),t.mouseup(function(n){Action.classMouseUp(n)}),Page.readOnly||t.draggable({containment:"parent",stop:function(n,r){DiagramEdit.classMoved(n.target)}}),jQuery(".ui-icon-gripsmall-diagonal-se").removeClass("ui-icon-gripsmall-diagonal-se"),e},UmpleSystem.replaceClass=function(e){for(var t=0;t<this.umpleClasses.length;t++){var n=this.umpleClasses[t];if(n.id==e.id){var r="#"+n.id,o=r+"_generalization",a=jQuery(r).get(),s=jQuery(o).get();jQuery(a).attr("id",e.id),s!=null&&(jQuery(s).attr("id",e.id+"_generalization"),jQuery(s).remove()),this.umpleClasses[t]=e,this.updateClass(this.umpleClasses[t]);return}}},UmpleSystem.renameClass=function(e,t,n){var r=UmpleSystem.find(e),o="#"+e,a=o+"_generalization";n=this.nextId(n),r.id=n,r.name=n,r.oldname=t,jQuery(o).attr("id",r.id),jQuery(a).get()!=null&&jQuery(a).attr("id",r.id+"_generalization");for(var s=0;s<this.umpleAssociations.length;s++){var c=this.umpleAssociations[s];c.classOneId==t&&(c.classOneId=r.id),c.classTwoId==t&&(c.classTwoId=r.id)}for(var s=0;s<this.umpleClasses.length;s++){var d=this.umpleClasses[s];d.extendsClass==t&&(d.extendsClass=n,this.updateClass(d))}return UmpleSystem.updateClass(r),r},UmpleSystem.replaceAssociation=function(e){for(var t=0;t<this.umpleAssociations.length;t++){var n=this.umpleAssociations[t];n.id==e.id&&(this.umpleAssociations[t]=e,index=t)}this.redrawAssociation(e)},UmpleSystem.updatePosition=function(e,t,n){e.position.x=t-UmpleSystem.position().x,e.position.y=n-UmpleSystem.position().y,UmpleSystem.redrawAssociationsFor(e),UmpleSystem.redrawGeneralizationsTo(e),UmpleSystem.updateClass(e)},UmpleSystem.updateClass=function(e){var t=e.drawable(),n=t[0],r=t[1],o=jQuery("#"+Page.umpleCanvasId()),a=jQuery("#"+e.id);if(o.append(n),r!=null)for(var s=0;s<r.length;s++)o.append(r[s]);UmpleSystem.redraw(e);var c=2,d=!1;a.width()>e.position.width+c&&(e.position.width=a.width(),d=!0),a.height()>e.position.height+c&&(e.position.height=a.height(),d=!0),d&&UmpleSystem.redraw(e),jQuery(".ui-icon-gripsmall-diagonal-se").removeClass("ui-icon-gripsmall-diagonal-se")},UmpleSystem.redrawAssociationsFor=function(e){for(var t=0;t<this.umpleAssociations.length;t++){var n=this.umpleAssociations[t];n.contains(e)&&UmpleSystem.redrawAssociation(n)}},UmpleSystem.redrawAssociation=function(e){var t="#"+e.id,n="#"+Page.umpleCanvasId(),r=null;return r=e.drawable(),jQuery(n).append(r),Page.isPhotoReady()||(jQuery(t).click(Action.associationClicked),jQuery(t).mouseover(function(o){Action.associationHover(o,!0)}),jQuery(t).mouseout(function(o){Action.associationHover(o,!1)}),UmpleSystem.setDragableAssociationAnchor(e,0),UmpleSystem.setDragableAssociationAnchor(e,1)),r},UmpleSystem.redrawTransition=function(e){var t="#"+e.id,n="#"+Page.umpleCanvasId(),r=null;return r=e.drawable(),jQuery(n).append(r),Page.isPhotoReady()||jQuery(t).click(Action.transitionClicked),r},UmpleSystem.redrawGeneralizationsTo=function(e){for(var t=0;t<this.umpleClasses.length;t++){var n=this.umpleClasses[t];if(n.extendsClass==e.id)this.updateClass(n);else if(n.interfaces.length>0)for(var r=0;r<n.interfaces.length;r++)n.interfaces[r]==e.id&&this.updateClass(n)}},UmpleSystem.update=function(){for(var e=0;e<this.umpleClasses.length;++e){var t=this.umpleClasses[e];t.position.height=28,Page.showAttributes&&(t.position.height+=17*t.attributes.size()),Page.showMethods&&(t.position.height+=17*t.methods.size()),UmpleSystem.updateClass(t)}for(var e=0;e<this.umpleAssociations.length;++e){var n=UmpleSystem.find(this.umpleAssociations[e].classOneId),r=this.umpleAssociations[e].offsetOnePosition.x+n.position.x+UmpleSystem.position().x,o=this.umpleAssociations[e].offsetOnePosition.y+n.position.y+UmpleSystem.position().y,a=Action.associationSnapClassReady(r,o,n),s=UmpleSystem.find(this.umpleAssociations[e].classTwoId);r=this.umpleAssociations[e].offsetTwoPosition.x+s.position.x+UmpleSystem.position().x,o=this.umpleAssociations[e].offsetTwoPosition.y+s.position.y+UmpleSystem.position().y;var c=Action.associationSnapClassReady(r,o,s),d=new UmplePosition(a[0],a[1],0,0),u=new UmplePosition(c[0],c[1],0,0);this.umpleAssociations[e].setOffsetOnePosition(d),this.umpleAssociations[e].setOffsetTwoPosition(u),UmpleSystem.redrawAssociation(this.umpleAssociations[e])}for(var e=0;e<this.umpleClasses.length;++e)UmpleSystem.trimOverlappingAssociations(this.umpleClasses[e])},UmpleSystem.redraw=function(e){var t=e.position.x+UmpleSystem.position().x,n=e.position.y+UmpleSystem.position().y,r="#"+e.id,o=r+"_generalization",a=r+"_width",s=r+"_height",c=new Object;if(c.top=n,c.left=t,jQuery(r).offset(c),jQuery(a).width(e.position.width),jQuery(s).height(e.position.height),!Page.isPhotoReady()){var d=jQuery(o).get();d!=null&&(jQuery(o).click(Action.generalizationClicked),jQuery(o).mouseover(function(u){Action.generalizationHover(u,!0)}),jQuery(o).mouseout(function(u){Action.generalizationHover(u,!1)}))}this.redrawAssociationsFor(e)},UmpleSystem.trimOverlappingAssociations=function(e){Page.showLayoutLoading();for(var t=0;t<UmpleSystem.umpleAssociations.length;t++){var n=UmpleSystem.umpleAssociations[t];if(n.contains(e)){var r=UmplePositionFactory.copy(n.offsetOnePosition),o=UmplePositionFactory.copy(n.offsetTwoPosition);if(n.isReflexive())n.adjustReflexiveEndpoints();else if(!r.equalsIgnoreSize(n.offsetOnePosition)||!o.equalsIgnoreSize(n.offsetTwoPosition)){Page.showLayoutLoading(),UmpleSystem.redrawAssociation(n);var a=Json.toString(n);DiagramEdit.updateUmpleText({actionCode:format("action=editAssociation&actionCode={0}",a),codeChange:!1})}}}UmpleSystem.umpleAssociations.length==0&&Action.setjustUpdatetoSaveLater(!1),Page.hideLoading()},UmpleSystem.updateAnchor=function(e,t){var n="#"+e.id,r=n+"_anchor"+t,o=n+"_hover"+t,a="";switch(t){case 0:a="left top";break;case 1:a="left center";break;case 2:a="left bottom";break;case 3:a="center bottom";break;case 4:a="right bottom";break;case 5:a="right center";break;case 6:a="right top";break;case 7:a="center top";break}jQuery(r).show(),jQuery(o).show(),jQuery(r).position({my:"center",at:a,of:n}),jQuery(o).position({my:"center",at:a,of:n}),jQuery(r).hide(),jQuery(o).hide()},UmpleSystem.setDragableAssociationAnchor=function(e,t){if(!Page.readOnly)if(e.isReflexive()){var n="#"+e.id+"_anchor"+t,r=t==0?e.classOneId:e.classTwoId;jQuery(n).draggable({drag:function(o,a){DiagramEdit.reflexiveAssociationMoving("#"+o.target.id)},stop:function(o,a){DiagramEdit.associationMoved("#"+o.target.id)},cursor:"pointer",snap:"#"+r,snapTolerance:5,containment:"#"+r,zIndex:1})}else{var n="#"+e.id+"_anchor"+t,r=t==0?e.classOneId:e.classTwoId;jQuery(n).draggable({drag:function(s,c){DiagramEdit.regularAssociationMoving("#"+s.target.id)},stop:function(s,c){DiagramEdit.associationMoved("#"+s.target.id)},cursor:"pointer",snap:"#"+r,snapTolerance:5,containment:"#"+r,zIndex:1})}},UmpleSystem.updatingSize=function(e,t,n){e.position.width=t,e.position.height=n,UmpleSystem.redraw(e)},UmpleSystem.removeClass=function(e){for(var t=0;t<this.umpleClasses.length;t++){var n=this.umpleClasses[t];if(n.id==e){this.umpleClasses.splice(t,1);var r="#"+e,o=r+"_generalization";return jQuery(r).remove(),jQuery(o).remove(),n}}return null},UmpleSystem.removeAssociation=function(e){for(var t=0;t<this.umpleAssociations.length;t++){var n=this.umpleAssociations[t];if(n.id==e){this.umpleAssociations.splice(t,1);var r="#"+e;return jQuery(r).remove(),n}}return null},UmpleSystem.removeTransition=function(e){for(var t=0;t<this.umpleAssociations.length;t++){var n=this.umpleAssociations[t];if(n==e){this.umpleTransitions.splice(t,1);var r="#"+e;return jQuery(r).remove(),n}}return null},UmpleSystem.removeGeneralization=function(e){var t="#"+e;jQuery(t).remove();var n=e.replace("_generalization",""),r=UmpleSystem.find(n);r.extendsClass=null;var o=new UmpleGeneralization;return o.childId=r.id,o.parentId=r.extendsClass,o},UmpleSystem.redrawCanvas=function(){UmpleSystem.merge(UmpleSystem)},UmpleSystem.merge=function(e){UmpleSystem.mergeClasses(e),UmpleSystem.mergeAssociations(e)},UmpleSystem.mergeClasses=function(e){if(e==null){for(;this.umpleClasses.length>0;)this.removeClass(this.umpleClasses[0].id);return}for(var t=0;t<this.umpleClasses.length;t++){var n=this.umpleClasses[t],r=this.findIn(e.umpleClasses,n.id);r==null?(t-=1,this.removeClass(n.id)):this.replaceClass(UmpleClassFactory.create(r))}for(var t=0;t<e.umpleClasses.length;t++){var r=e.umpleClasses[t],o=this.find(r.id);o==null&&this.addClass(UmpleClassFactory.create(r))}for(var t=0;t<this.umpleClasses.length;t++){var n=this.umpleClasses[t];(n.extendsClass!=null||n.interfaces.length>0)&&this.updateClass(n)}},UmpleSystem.mergeAssociations=function(e){if(e==null){for(;this.umpleAssociations.length>0;)this.removeAssociation(this.umpleAssociations[0].id);return}for(var t=0;t<this.umpleAssociations.length;t++){var n=this.umpleAssociations[t],r=this.findIn(e.umpleAssociations,n.id);r==null?(t-=1,this.removeAssociation(n.id)):this.replaceAssociation(UmpleAssociationFactory.create(r))}for(var t=0;t<e.umpleAssociations.length;t++){var o=this.findAssociation(e.umpleAssociations[t].id);if(o==null){var r=UmpleAssociationFactory.create(e.umpleAssociations[t]);this.addAssociation(r)}}},UmpleSystem.nextId=function(e){var t="umpleElement_",n=t+"0";typeof e<"u"&&(t=e,n=e);for(var r=!1,o=0;o<100&&!r;){o>0&&(n=t+o),r=!0;for(var a=0;a<this.umpleClasses.length;a++)if(this.umpleClasses[a].id==n){r=!1,o+=1;break}if(r)return n}return""},UmpleSystem.nextAssociationId=function(e){var t="umpleAssociation_",n=t+"0";typeof e<"u"&&(t=e,n=e);for(var r=!1,o=0;o<100&&!r;){o>0&&(n=t+o),r=!0;for(var a=0;a<this.umpleAssociations.length;a++)if(this.umpleAssociations[a].id==n){r=!1,o+=1;break}if(r)return n}return""},UmpleSystem.nextTransitionId=function(e){var t="umpleTransition_",n=t+"0";typeof e<"u"&&(t=e,n=e);for(var r=!1,o=0;o<100&&!r;){o>0&&(n=t+o),r=!0;for(var a=0;a<this.umpleTransitions.length;a++)if(this.umpleTransitions[a].id==n){r=!1,o+=1;break}if(r)return n}return""},TabControl=new Object,TabControl.maxTabs=10,TabControl.maxNameLength=32,TabControl.defaultTabName="Untitled",TabControl.showHideKey="showUmpleTabs",TabControl.requestQueue=[],TabControl.remoteDelim="%NAME:CONTENT:DELIM%",TabControl.illegalNameRegxp=/[\/\?<>\\:\*\|":]/g,TabControl.controlNameRegxp=/[\x00-\x1f\x80-\x9f]/g,TabControl.reservedNameRegxp=/^\.+$/,TabControl.windowsReservedNameRegxp=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,TabControl.windowsTrailingRegxp=/[\. ]+$/,TabControl.nameReplacement="_",TabControl.init=function(){jQuery("#tabs").sortable({axis:"x",helper:"clone",items:"li:not(.unsortable)",update:TabControl.saveActiveTabs}),jQuery.fn.selectText=function(){var e=document,t=this[0];if(e.body.createTextRange){var n=document.body.createTextRange();n.moveToElementText(t),n.select()}else if(window.getSelection){var r=window.getSelection(),n=document.createRange();n.selectNodeContents(t),r.removeAllRanges(),r.addRange(n)}},TabControl.reset(),localStorage[TabControl.showHideKey]||TabControl.hideTabs(),TabControl.loadAllTabs()},TabControl.showTabs=function(){jQuery("#toggleTabsButton").html("Hide Tabs"),jQuery("#tabControl").show(),localStorage[TabControl.showHideKey]=!0},TabControl.hideTabs=function(){jQuery("#toggleTabsButton").html("Show Tabs"),jQuery("#tabControl").hide(),delete localStorage[TabControl.showHideKey]},TabControl.saveActiveTabs=function(){var e=[];jQuery(".tabname").each(function(){e.push(jQuery(this).text())}),TabControl.addToRequestQueue("scripts/tab_control.php",function(t){},format("index=1&&model={0}&&orderedTabNames={1}",Page.getModel(),encodeURIComponent(JSON.stringify(e))))},TabControl.getActiveTabId=function(){return TabControl.activeTab?TabControl.activeTab.id:null},TabControl.isHidden=function(){return jQuery("#tabControl").is(":hidden")},TabControl.reset=function(){TabControl.activeTab=null,TabControl.tabs={},TabControl.nextTabId=1,TabControl.requestQueue=[],TabControl.queuedTabs=0,TabControl.reservedNames={model:!0}},TabControl.sanitizeName=function(e){var t=e.replace(TabControl.illegalNameRegxp,TabControl.nameReplacement).replace(TabControl.controlNameRegxp,TabControl.nameReplacement).replace(TabControl.reservedNameRegxp,TabControl.nameReplacement).replace(TabControl.windowsReservedNameRegxp,TabControl.nameReplacement).replace(TabControl.windowsTrailingNameRegxp,TabControl.nameReplacement);return t},TabControl.findNextAvailableTabName=function(e){for(var t=e,n=2;TabControl.reservedNames.hasOwnProperty(t);)t=e+n++;return t},TabControl.extractNameFromCode=function(e){var t=/class[\s]*([a-zA-Z_$][a-zA-Z_$0-9]*)[\s]*{/g,n=t.exec(e);if(n)return n[1]},TabControl.createTab=function(e,t,n){if(!(Page.readOnly&&e=="afterTabControlInit")&&(e=="afterTabControlInit"&&(e=null),Object.keys(TabControl.tabs).length!=TabControl.maxTabs)){var r=TabControl.nextTabId++,o=e||TabControl.defaultTabName;if(t!=null){if(!e){var a=TabControl.extractNameFromCode(t);a&&(o=a)}}else t=Page.modelDelimiter;var s=TabControl.findNextAvailableTabName(o);TabControl.tabs[r]={name:s,id:r,history:History.getInstance(r),nameIsEphemeral:e==null},TabControl.reservedNames[s]=!0,TabControl.saveTab(r,t);var c=jQuery("#createTabBtn"),d=jQuery('<li id="tab'+r+'" class=""><a class="tabname" title="Double-click to rename tab" id="tabName'+r+`" href="javascript:TabControl.selectTab('`+r+`');">`+s+`</a><button class="tabbtn" onclick="javascript:TabControl.deleteTab('`+r+`');">&times;</button></li>`);d.insertBefore(c),Object.keys(TabControl.tabs).length==TabControl.maxTabs&&c.hide();var u=TabControl.getTabNameDiv(r);handleNameEdit=function(){u.attr("contentEditable",!1),window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty();var f=u.text(),g=TabControl.tabs[r].name;if(f!==g){var h=!1;TabControl.sanitizeName(f)!==f?alert("The name contains invalid characters. Please try again."):f.length===0||f.length>TabControl.maxNameLength?alert("Name must be between 1 and "+TabControl.maxNameLength+" characters long. Please try again."):TabControl.reservedNames.hasOwnProperty(f)?alert("This name is already in use. Please try again."):h=!0,h?(u.text(f),TabControl.renameTab(r,f)):(u.text(g),u.selectText(),u.attr("contentEditable",!0))}},u.bind("dblclick",function(){u.attr("contentEditable",!0),u.focus(),u.selectText()}).blur(handleNameEdit).keypress(function(f){var g=13,h=8;f.which==g&&u.blur(),f.which!=h&&u.text().length>=TabControl.maxNameLength&&f.preventDefault()}),n||TabControl.saveActiveTabs(),TabControl.selectTab(r)}},TabControl.saveTab=function(e,t){var n=TabControl.getTabFilename(TabControl.tabs[e].name),r=Page.getModel();localStorage[n]=t,String(Page.getFilename()).indexOf("tasks")!==-1&&(n="tasks/"+n,r="tasks/"+r);var o=t.replace(/&/g,"%26").replace(/\+/g,"%2B");TabControl.addToRequestQueue("scripts/compiler.php",TabControl.saveTabCallback(e),format("save=1&&lock=1&&model={2}&&umpleCode={0}&&filename={1}",o,n,r))},TabControl.saveTabCallback=function(e){return function(t){TabControl.tabs[e]&&(TabControl.tabs[e].filename=t.responseText)}},TabControl.selectTab=function(e){if(TabControl.activeTab){if(e==TabControl.activeTab.id)return;var t=TabControl.getTabDiv(TabControl.activeTab.id);t.removeClass("selected"),TabControl.saveTab(TabControl.activeTab.id,Page.getUmpleCode())}TabControl.activeTab=TabControl.tabs[e];var n=TabControl.getTabDiv(e);n.addClass("selected"),TabControl.getCurrentHistory().setButtons();var r=TabControl.getTabFilename(TabControl.activeTab.name);Page.setUmpleCode(localStorage[r]),Action.setCaretPosition(0),Action.updateLineNumberDisplay(),Object.keys(TabControl.tabs).length>1&&setTimeout('Action.processTyping("newEditor",false)',Action.waiting_time)},TabControl.loadAllTabs=function(){TabControl.addToRequestQueue("scripts/tab_control.php",TabControl.loadAllTabsCallback,format("list=1&&model={0}",Page.getModel()))},TabControl.loadAllTabsCallback=function(e){var t=e.responseText.split("<br />"),n=!1;t.map(function(r){if(r){var o=r.split(TabControl.remoteDelim),a=o[0],s=o[1];!a||a==="model"||(n||(TabControl.hideTabs(),n=!0),TabControl.createTab(a,s,!0))}}),n?TabControl.showTabs():TabControl.createTab(null,Page.getUmpleCode())},TabControl.deleteTab=function(e){if(!Page.readOnly&&Object.keys(TabControl.tabs).length>1){var r=TabControl.getTabNameDiv(e),t=confirm("Are you sure you want to remove the file "+r.text()+".ump from the model? If you answer OK, the code will be deleted; this cannot be undone, so consider answering Cancel and saving it first.");if(!t)return;var n=e==TabControl.activeTab.id;TabControl.getTabDiv(e).remove();var r=TabControl.tabs[e].name,o=TabControl.tabs[e].filename;delete TabControl.reservedNames[r],delete TabControl.tabs[e],delete localStorage[o];var a=jQuery("#createTabBtn");a.show(),TabControl.addToRequestQueue("scripts/tab_control.php",function(s){},format("delete=1&&model={0}&&name={1}",Page.getModel(),r)),n&&(TabControl.activeTab=null,TabControl.selectTab(Object.keys(TabControl.tabs)[0])),TabControl.saveActiveTabs()}},TabControl.renameTab=function(e,t,n){if(!Page.readOnly&&!TabControl.reservedNames.hasOwnProperty(t)){var r=TabControl.tabs[e].name;if(r!=t){var o=TabControl.getTabFilename(r),a=TabControl.getTabFilename(t);localStorage[a]=localStorage[o],delete localStorage[o],n&&TabControl.getTabNameDiv(e).text(t),TabControl.tabs[e].nameIsEphemeral=!1,TabControl.addToRequestQueue("scripts/tab_control.php",TabControl.renameTabCallback(e,t),format("rename=1&&model={0}&&oldname={1}&&newname={2}",Page.getModel(),r,t)),TabControl.saveActiveTabs()}}},TabControl.renameTabCallback=function(e,t){return function(n){delete TabControl.reservedNames[TabControl.tabs[e].name],TabControl.reservedNames[t]=!0,TabControl.tabs[e].name=t}},TabControl.getTabFilename=function(e){return format("{0}/{1}.ump",Page.getModel(),e)},TabControl.getTabNameDiv=function(e){return jQuery("#tabName"+e)},TabControl.getTabDiv=function(e){return jQuery("#tab"+e)},TabControl.addToRequestQueue=function(e,t,n){var r={endpoint:e,callback:TabControl.getQueuedCallback(t),parameters:n};TabControl.requestQueue.push(r),TabControl.requestQueue.length===1&&(jQuery(".bookmarkableUrl").addClass("disabled"),Ajax.sendRequest(r.endpoint,TabControl.getQueuedHeadCallback(r.callback),r.parameters))},TabControl.getQueuedHeadCallback=function(e){return function(t){TabControl.requestQueue.shift(),e(t)}},TabControl.getQueuedCallback=function(e){return function(t){var n=TabControl.requestQueue.shift();e(t),n?n.hasOwnProperty("endpoint")?Ajax.sendRequest(n.endpoint,n.callback,n.parameters):n.callback():Page.modelLoadingCount===0&&Page.layoutLoadingCount===0&&Page.canvasLoadingCount===0&&jQuery(".bookmarkableUrl").removeClass("disabled")}},TabControl.addCallbackToRequestQueue=function(e){var t={callback:TabControl.getQueuedCallback(e)};TabControl.requestQueue.push(t),TabControl.requestQueue.length===1&&(jQuery(".bookmarkableUrl").addClass("disabled"),TabControl.getQueuedHeadCallback(t.callback()))},TabControl.getCurrentHistory=function(){return TabControl.activeTab?TabControl.tabs[TabControl.activeTab.id].history:History.getInstance()},TabControl.useActiveTabTo=function(e){return TabControl.activeTab?e.bind(null,TabControl.activeTab.id):function(){}};var ToolTips={},undo,redo,toggleTextEditor;navigator.appVersion.indexOf("Mac")!=-1?(undo="cmd-z",redo="cmd-shift-z",toggleTextEditor="ctrl-t"):(undo="ctrl-z",redo="ctrl-y",toggleTextEditor="ctrl-alt-shift-t"),ToolTips.tooltipEntries={ttSaveBookmark:["li","Click to bookmark this model"],ttSaveModel:["li","Click to save this model for ongoing editing.<br/><br/>After clicking this, you will need to use your browser's functionality to copy or bookmark the newly-created semi-permanent URL.<br/><br/>As you make further edits at the new URL, they will be instantly saved. You will be able to come back any time to continue editing.<br/><br/>The URL and its model will continue to be available for up to a year from the last time you edited it.<br/><br/>Do not use the new URL as a safe backup: If you (or anyone else who you give the URL) modifies or deletes the text, then your work would be lost. <br/><br/>The following describes BETA capabilities. Please report any issues:<br/><br/>You can share the URL with others, or open multiple tabs with it by yourself. As you type the text will change simultaneously in all open tabs."],buttonCopyClip:["li","Click to copy the code to the clipboard<br/><br/>After doing this you can paste the result into a .ump file on your computer. Note that this will copy diagram layout information which is normally hidden, as well as the Umple text."],buttonCopy:["li","Click to open a popup showing the current Umple code (including layout), with a timestamp header for reference."],buttonCopyCommandLine:["li","Click to copy a script to execute your model on the Linux or Mac command line.<br/><br/>After doing this, paste the result into a terminal.<br/><br/>The script will create a new directory under ~/tmp, create the umple file there as test.ump. compile the Umple and resulting Java (and suggest for you how to run the Java if there is a main program present).<br/><br/>Before doing this you need to install the Java development environment and an 'umple' script using a tool such as homebrew. The Umple script should run 'java -jar umple.jar' with a .ump file as an argument  </br><b>Shortcut: [ctrl-o]</b>"],buttonCopyEncodedURL:["li","Click to view a URL encoded with this model.<br/><br/>This only works for small models (about 5 classes or less).<br/><br/>This is ideal for embedding small examples directly in presentation slides (e.g., PowerPoint), or for sharing a quick reproducible model link."],buttonCopyLocalBrowser:["li","Click to save the Umple text from the current tab in your browser local storage for later reloading using Load from Browser below.<br/><br/>This can be useful to transfer text to a different browser tab, or temporarily stash some work you may want to come back to. But it should not be used for a permanent backup."],buttonLoadLocalBrowser:["li","Click to load the Umple text from what you had previously saved in this browser (above).<br/><br/>This operation can be undone."],buttonDownloadFiles:["li","Click to download your entire model, one .ump file per Umple tab.<br/><br/>This is a two-step process. After you click this, the zip file will be created and a link will appear below; you must click on that link to actually complete the download.<br/><br/>This is the best way to safely back up your work to your own computer."],buttonCreateTask:["li","Create a modeling task for participants to try.</br>You will be able to give them some instructions. The model currently appearing here will be their starting point. The instructions could be requirements to model, or changes to make. This can be for an experiment or a course assignment."],buttonLoadTask:["li","Load a model and a set of instructions that have been created by someone running an experiment or a teacher of a course. You need to enter the task name that the person gave you."],buttonRequestAllZip:["li","Create a zip file to download, containing all submissions for this task."],ttDropboxSaver:["li","Click to save your model to dropbox"],ttAiStatus:["li","Click to configure AI settings including provider selection, API key, and model selection.<br/><br/>Free models (e.g., on OpenRouter) are shown at the top of the model list. You need to set up your AI provider and verify your API key before using AI features."],ttGenerateFromReq:["li","Generate Umple code from requirements defined in your code editor.<br/><br/>1. Define requirements in your Umple code using <code>req ID { text }</code> syntax.<br/>2. Click to open a dialog showing all parsed requirements.<br/>3. Select which requirements to use for code generation.<br/>4. AI generates Umple code (class diagrams or state machines) with <code>implementsReq</code> tags linking back to your selected requirements.<br/><br/>See https://cruise.umple.org/umple/Requirements.html for syntax details.<br/><br/><b>Estimated Token Usage:</b><br/>\u2022 Initial generation: ~2,000 tokens<br/>\u2022 Each self-correction pass: ~1,800 tokens<br/><br/><i>Note: Actual usage varies with requirement text length and the model you use. Reasoning models (e.g., o1, o3) may consume significantly more tokens due to internal reasoning processes.</i><br/><br/>You must configure your AI settings first."],ttExplain:["li","Get an AI-powered explanation of your current Umple code.<br/><br/><b>Estimated Token Usage:</b><br/>\u2022 Initial explanation: ~600 tokens<br/>\u2022 Each follow-up question: ~700 tokens<br/><br/><i>Note: Actual usage varies with code size and the model you use. Reasoning models (e.g., o1, o3) may consume significantly more tokens due to internal reasoning processes.</i><br/><br/>You must configure your AI settings first."],ttShowRefreshUmpleCompletely:["li","Click to erase your work and completely restart UmpleOnline.<br/><br/>Use this only if UmpleOnline gets into a state where things seem messed up. After doing this you will NOT be able to use the undo command to restore the model. The text and diagrams will be permanently erased. You should select 'Download Files' above first to back up your work.<br/><br/>For safety, this is a two-step process: A confirmation link will appear below that you must click on after you click on this."],ttLoadBlankModel:["li","Click to load a blank model.<br/><br/>This can be undone using the undo command in Tools. This is the best way to start new work, but you may want to download your files first (above) to back them up."],ttDropboxChooser:["li","Click to load an example from dropbox"],buttonAddClass:["li","Click the diagram to add a class </br><b>Shortcut: [c]</b>"],buttonAddAssociation:["li","Click on two classes to create an association </br><b>Shortcut: [a]</b>"],buttonAddGeneralization:["li","Click on two classes to create a generalization </br><b>Shortcut: [g]</b>"],buttonDeleteEntity:["li","Click on a class, association, or generalization to delete that entity </br><b>Shortcut: [DEL]</b>"],buttonUndo:["li","Click to undo the most recent action </br><b>Shortcut: ["+undo+"]</b>"],buttonRedo:["li","Click to redo the most recent undone action </br><b>Shortcut: ["+redo+"]</b>"],buttonReindent:["li","Click this to adjust the text so that blocks marked by { and } have their contents indented by 2 spaces"],buttonSyncDiagram:["li","Click to sync the diagram and the text"],ttGeneratedCodeType:["li","Choose the language or diagram to generate"],ttGenerateCode:["li","Click this button to generate the above code or diagram"],ttExecuteCode:["li","Click this button to execute the above code"],ttShowHideCanvas:["li","Show/Hide the diagram </br><b>Shortcut: [ctrl+d]</b>"],ttShowHideTextEditor:["li","Show/Hide the text editor </br><b>Shortcut: ["+toggleTextEditor+"]"],ttShowHideLayoutEditor:["li","Show/Hide the layout editor"],ttToggleAttributes:["li","Show/Hide attributes in class diagrams </br><b>Shortcut: [shift+ctrl+a]</b>"],ttToggleMethods:["li","Show/Hide methods in class diagrams </br><b>Shortcut: [ctrl+m]</b>"],ttToggleTraits:["li","Show/Hide traits; when selected any traits and their relationships are explicitly shown; when unselected, traits are merged into their client classes </br><b>Shortcut: [ctrl+r]</b>"],ttToggleActions:["li","Show/Hide actions in state diagrams (hide to simplify)"],ttToggleGuards:["li","Show/Hide guards in state diagrams (hide to simplify)"],ttToggleTransitionLabels:["li","Show/Hide transition labels in state diagrams (t1, t2 etc.) to allow reference"],ttToggleGuardLabels:["li","Show/Hide guard labels on the state diagrams (g1, g2 etc.) to allow reference"],SHT_button:["a","Show/Hide the text editor - <b>"+toggleTextEditor+"</b>"],SHD_button:["a","Show/hide diagram pane on right - <b> ctrl-D</b>"],SHA_button:["a","Show/hide attributes in class diagrams - <b>shift-ctrl-A</b>"],SHM_button:["a","Show/hide methods in class diagrams - <b>ctrl-M</b>"],filtervalues:["input","You can choose to display a subset of classes by naming them, separated by spaces.<br/><br/>You can use glob wildcards to specify patterns matching several classes.<br/><br/> So * matches any number of characters in a class name and ? matches any single character.<br/><br/> Preceding a pattern with a ~ indicates to skip classes matching the pattern.<br/><br/> Superclasses of any selected classes will always also appear (even if ~ is used)<br/><br/> The above is a shortcut for including a filter directive in the code.<br/><br/> using the notation filter {include Classpattern;}<br/><br/> Filters in the code will take precedence.<br/><br/> No class pattern starting with 'gv' can be used as these match the suboptions below.<br/><br/>You can also use an integer such as 1 or 2 to also add classees that are connected by an association 1 or 2 (or any number of ) hops away from selected classes.<br/><br/>You can also widen (or narrow) the spacing of nodes by using an expression like gvseparator=1.7 , where 1.0 is the default spacing."],buttonCopyMix:["li","Click on this to add Umple mixset code to the copy buffer that you can then paste into the code. The code will contain instructions to filter and lay out the code with the gv options and the filter text above. The mixset will have a randomly generated name which you should rename to something meaningful. Then you will see the mixset appear in the options above so you can switch it on and off as often as you like."],ttShowEditableClassDiagram:["li","Display a graphically editable class diagram </br><b>Shortcut: [ctrl+e]</b>"],ttShowJointJSClassDiagram:["li","Display a graphically editable class diagram displayed using joint.js </br><b>Shortcut: [ctrl+j]</b>"],ttShowGvClassDiagram:["li","Display a class diagram rendered using GraphViz </br><b>Shortcut: [ctrl+g]</b>"],ttShowGvStateDiagram:["li","Display a state diagram rendered using GraphViz</br><b>Shortcut: [ctrl+s]</b>"],ttShowStructureDiagram:["li","Display a graphically editable composite structure diagram </br><b>Shortcut: [ctrl+l]</b>"],ttShowGvFeatureDiagram:["li","Display a feature diagram rendered using GraphViz </br>"],ECD_button:["a","Class diagram where the user can Edit the layout - <b>ctrl-E</b>"],GCD_button:["a","Graphviz Class diagram (the default as of 2026), automatically laid out - editable using a contextual menu (double-click or right-click to display it) when pointing to a class, association or attribute - <b>ctrl-G</b>"],SD_button:["a","State diagram - editable using a contextual menu (double-click or right-click to display it) when pointing to  a state or transition  - <b>ctrl-S</b>"],GenJavaButton:["a","Generate Java from this Umple model ... To generate other outputs such as Python, C++, PhP, ER Diagrams and Formal Methods, use the Generate menu in Tools"],topBookmarkable:["a","Click to copy the URL and save it so you can come back to it later.<br/> <br/>You can do this just so you remember the location of your model.<br/><br/>The following describes BETA capabilities. Please report any issues: <br/><br/> You can also share the URL with other people to collaborate in real time on a model.<br/> <br/>When more than one person is working on a model, a collaborator who has stopped editing may time out after a while and would then have to reconnect. Before reconnecting the model would temporarily be read-only for them."],collabDisconnect:["a","You can disconnect from your collaboration session with this button."],ttSaveNCollab:["a","Click to save this model for ongoing editing.<br/><br/>After clicking this, you will need to use your browser's functionality to copy or bookmark the newly-created semi-permanent URL.<br/><br/>As you make further edits at the new URL, they will be instantly saved. You will be able to come back any time to continue editing.<br/><br/>The URL and its model will continue to be available for up to a year from the last time you edited it.<br/><br/>Do not use the new URL as a safe backup: If you (or anyone else who you give the URL) modifies or deletes the text, then your work would be lost. <br/><br/>The following describes BETA capabilities. Please report any issues:  <br/><br/>You can share the URL with others, or open multiple tabs with it by yourself. As you type, the text will change simultaneously in all open browsers or browser tabs."],ttPhotoReady:["li","Remove editing handles from diagram"],ttManualSync:["li","Stop the diagram from syncing automatically"],ttAllowPinch:["li","When active on GraphViz diagrams, this allows two-fingered gestures to zoom the diagram in or out to make it have any desired resolution and size (but prevents the entire browser from being zoomed in this manner)"],ttYumlImage:["li","Generate a class diagram using Yuml in another window"]},ToolTips.dropDownTooltips={exampleType:["li","Choose an example type to load"],itemLoadExamples:["li","Choose a class diagram example to load. * means executable, since it has a main program"],itemLoadExamples2:["li","Choose a state diagram example to load. * means executable, since it has a main program"],itemLoadExamples3:["li","Choose a composite structure diagram example to load"]},ToolTips.dynamicTooltips={ttgvortho:["li","Display class association lines with right-angle junctions rather than spline curves"],ttmixset:["li","Activate the code contained in this named mixset"],ttfilter:["li","Activate the named filter to show only the selected classes"],ttgvmanual:["li","Allow manual editing of Graphviz class diagram layout. You can drag items."],ttgvdot:["li","Lay out the class diagram in the default way, which tries to arrange classes in a hierarchical manner. If gvmanual is also active, this will become the default manual layout"],ttgvsfdp:["li","Lay out the class diagram using a force-directed algorithm. If gvmanual is also active, this will become the default manual layout"],ttgvcirco:["li","Lay out the class diagram using an algorithm that tries to arrange classes in circles. If gvmanual is also active, this will become the default manual layout"]},ToolTips.setATooltip=function(e,t,n,r){var o=document.querySelector(":root"),a=s=e[n];if(typeof a>"u"){console.log("Tooltip ID not defined: "+n);return}var s=a[1],c=Math.max(3.5,s.length/10)+"s";jQuery("#"+t).tooltip({items:a[0],content:s,show:{delay:1e3},open:function(d,u){o.style.setProperty("--tooltipDwellTime",c)},position:r})},ToolTips.setATooltipBasic=function(e,t,n){var r=t;t.substring(0,8)=="ttmixset"?r="ttmixset":t.substring(0,8)=="ttfilter"&&(r="ttfilter");var o;n=="above"?o={my:"center+15% bottom",at:"top",of:"#"+t}:n=="below"?o={my:"left top+10",of:"#"+t}:o={my:"right",at:"left",of:"#"+t},ToolTips.setATooltip(e,t,r,o)},ToolTips.initTooltips=function(){for(var e in this.tooltipEntries)e=="SD_button"||e=="GCD_button"||e=="ECD_button"||e=="SHT_button"||e=="SHD_button"||e=="SHA_button"||e=="SHM_button"||e=="GenJavaButton"||e=="ttSaveNCollab"||e=="collabDisconnect"||e=="topBookmarkable"?ToolTips.setATooltipBasic(this.tooltipEntries,e,"below"):ToolTips.setATooltipBasic(this.tooltipEntries,e,"left");for(e in this.dropDownTooltips)ToolTips.setATooltipBasic(this.dropDownTooltips,e,"above");jQuery(document).tooltip({show:{delay:1e3}})},UmpleTransitionFactory=new Object,UmpleTransitionFactory.create=function(e){var t=new UmpleTransition;return t.id=e.id,t.fromStateId=e.fromStateId,t.toStateId=e.toStateId,t.name=e.name,t.eventName=e.eventName,t};function UmpleTransition(){this.id=null,this.fromStatePosition=null,this.toStatePosition=null,this.fromStateId,this.toStateId,this.name="",this.eventName="",this.color="black",this.setStates=function(e,t){this.fromStateId=e,this.toStateId=t},this.setDefaultEvent=function(){this.eventName="event1"},this.setName=function(e){this.name=e},this.getName=function(){return this.name},this.getElementId=function(){return this.id==null?"newtransition":this.id},this.getState=function(e){return e==0?UmpleSystem.find(this.fromStateId):UmpleSystem.find(this.toStateId)}}const FinishReason={STOP:"stop",LENGTH:"length",TOOL_CALLS:"tool_calls",CONTENT_FILTER:"content_filter",FUNCTION_CALL:"function_call"},AiConstants={FinishReason};window.AiConstants=AiConstants;const AiMarkdownUtils=(()=>{"use strict";const e={codeBlock:/```(\w+)?\s*([\s\S]*?)```/g,inlineCode:/`([^`]+)`/g,bold:/\*\*([^*]+)\*\*/g,italic:/\*([^*]+)\*/g,lineBreak:/\n/g,header:/^(#{1,6})\s+(.+)$/gm},t=/^\s*\|?\s*:?-+:?\s*(?:\|\s*:?-+:?\s*)*\|?\s*$/,n=/^\s*\|.*\|\s*$/;function r(u){return n.test(u)}function o(u){return t.test(u)?u.split("|").map(g=>g.trim()).filter(g=>g.length>0).every(g=>/^:?-{3,}:?$/.test(g)):!1}function a(u){return u.split("|").map(f=>f.trim()).filter((f,g,h)=>f.length>0?!0:!(g===0||g===h.length-1))}function s(u){return u.replace(e.inlineCode,"<code>$1</code>").replace(e.bold,"<strong>$1</strong>").replace(e.italic,"<em>$1</em>")}function c(u){if(u.length<2)return u.join("<br/>");const f=a(u[0]),g=f.length;let h='<div class="ai-md-table-wrap"><table class="ai-md-table"><thead><tr>';f.forEach(b=>{h+=`<th>${s(b)}</th>`}),h+="</tr></thead><tbody>";for(let b=2;b<u.length;b++){const E=a(u[b]);for(;E.length<g;)E.push("");E.length>g&&(E.length=g),h+="<tr>",E.forEach(S=>{h+=`<td>${s(S)}</td>`}),h+="</tr>"}return h+="</tbody></table></div>",h}function d(u){const f=u.split(`
`),g=[];let h=0;for(;h<f.length;){const b=f[h];if(r(b)&&h+1<f.length&&o(f[h+1])){const E=[f[h],f[h+1]];for(h+=2;h<f.length&&r(f[h]);)E.push(f[h]),h++;g.push(c(E))}else g.push(b),h++}return g.join(`
`)}return{render(u){if(!u)return"";let f=this.escapeHtml(u);const g=[];return f=f.replace(e.codeBlock,(h,b,E)=>{const S=`\0CODE_BLOCK_${g.length}\0`;return g.push(`<pre><code>${E}</code></pre>`),S}),f=d(f),f=f.replace(e.header,(h,b,E)=>{const S=b.length;return`<h${S}>${E.trim()}</h${S}>`}).replace(e.inlineCode,"<code>$1</code>").replace(e.bold,"<strong>$1</strong>").replace(e.italic,"<em>$1</em>").replace(e.lineBreak,"<br/>"),g.forEach((h,b)=>{f=f.replace(`\0CODE_BLOCK_${b}\0`,h)}),f},escapeHtml(u){if(typeof AiTextUtils<"u"&&AiTextUtils.escapeHtml)return AiTextUtils.escapeHtml(u);const f=document.createElement("div");return f.textContent=u,f.innerHTML}}})(),AiPromptUtils=(()=>{"use strict";function e(o){return String(o||"").trim().toLowerCase().replace(/[^a-z0-9_-]+/g,"_").replace(/^_+/,"").replace(/_+$/,"")||"section"}function t(o){return o==null?"":Array.isArray(o)?o.filter(Boolean).map(String).join(`
`):String(o)}function n(o,a,{trimContent:s=!0,allowEmpty:c=!1}={}){const d=e(o);let u=t(a);return s&&(u=u.trim()),!c&&!u?"":`<${d}>
${u}
</${d}>`}function r(o,{separator:a=`

`}={}){return(o||[]).filter(Boolean).join(a)}return{normalizeTagName:e,block:n,joinBlocks:r}})();var _aiGlobal=typeof window<"u"?window:globalThis,AiProviderUtils=_aiGlobal.AiProviderUtils||{_compareIntArrays(e,t){const n=Array.isArray(e)?e:[],r=Array.isArray(t)?t:[],o=Math.max(n.length,r.length);for(let a=0;a<o;a++){const s=n[a]??0,c=r[a]??0;if(s!==c)return s-c}return 0},_parseDotVersionAfterPrefix(e,t){const n=String(e||"").toLowerCase();if(!n.startsWith(t))return null;const o=n.slice(t.length).match(/^(\d+(?:\.\d+){0,3})/);return o?o[1].split(".").map(a=>Number.parseInt(a,10)):null},_parseGptCodexVersion(e){const n=String(e||"").toLowerCase().match(/^gpt-([\d.]+)-codex$/);return n?n[1].split(".").map(o=>Number.parseInt(o,10)):null},extractModelProvider(e){if(!e||typeof e!="string")return"unknown";const t=e.split("/");return t.length<2?"unknown":t[0].toLowerCase()},_pickLatestModelId(e,t=null){const n=(e||[]).filter(Boolean);if(n.length===0)return null;const r=n.find(s=>String(s).toLowerCase().endsWith("-latest"));if(r)return r;if(typeof t=="function"){let s=null,c=null;if(n.forEach(d=>{const u=t(d);u&&(!s||this._compareIntArrays(u,c)>0)&&(s=d,c=u)}),s)return s}let o=n[0],a=null;return n.forEach(s=>{const c=String(s).match(/(\d{8})/),d=c?Number.parseInt(c[1],10):null;d&&(!a||d>a)&&(a=d,o=s)}),o},filterModelsForProvider(e,t){if(!Array.isArray(t)||t.length===0)return t;const n=t.map(o=>o.value).filter(Boolean),r=o=>{const a=new Set((o||[]).filter(Boolean)),s=t.filter(c=>a.has(c.value));return s.length>0?s:t};switch(e){case"openai":{const o=n.filter(b=>/^gpt-\d+(?:\.\d+){0,3}$/i.test(b)),a=n.filter(b=>/^gpt-\d+(?:\.\d+){0,3}-mini$/i.test(b)),s=n.filter(b=>/^gpt-\d+(?:\.\d+){0,3}-nano$/i.test(b)),c=n.filter(b=>/^gpt-[\d.]+-codex(?!-mini|-nano|-lite)$/i.test(b)),d=b=>this._parseDotVersionAfterPrefix(b,"gpt-"),u=this._pickLatestModelId(o,d),f=this._pickLatestModelId(a,d),g=this._pickLatestModelId(s,d),h=this._pickLatestModelId(c,b=>this._parseGptCodexVersion(b));return r([u,f,g,h])}case"google":{const o=n.filter(u=>/(^|-)flash($|-)/i.test(u)&&!/(^|-)flash-lite($|-)/i.test(u)),a=n.filter(u=>/(^|-)pro($|-)/i.test(u)),s=u=>this._parseDotVersionAfterPrefix(u,"gemini-"),c=this._pickLatestModelId(o,s),d=this._pickLatestModelId(a,s);return r([c,d])}case"openrouter":return t;default:return t}},contentToText(e){if(e==null)return"";if(typeof e=="string")return e;if(Array.isArray(e))return e.map(t=>typeof t=="string"?t:!t||typeof t!="object"?"":typeof t.text=="string"?t.text:t.text&&typeof t.text=="object"&&typeof t.text.value=="string"?t.text.value:"").join("");if(typeof e=="object"){if(typeof e.text=="string")return e.text;if(e.text&&typeof e.text=="object"&&typeof e.text.value=="string")return e.text.value}return String(e)},usesMaxCompletionTokens(e){if(!e)return!1;const t=String(e).toLowerCase();return/gpt-?5/.test(t)||/\bo[13](-|$)/.test(t)||t.includes("/o1")||t.includes("/o3")||t.includes("/gpt-5")||t.includes("/gpt5")},groupModelsByProvider(e){const t={};return e.forEach(n=>{const r=n.modelProvider||"unknown";t[r]||(t[r]=[]),t[r].push(n)}),t},normalizeUsage(e,t=null){const n=c=>{const d=Number(c);return Number.isFinite(d)?d:null},r=n(e?.prompt_tokens??e?.input_tokens),o=n(e?.completion_tokens??e?.output_tokens);let a=n(e?.total_tokens);a==null&&Number.isFinite(r)&&Number.isFinite(o)&&(a=r+o);const s=n(e?.cost??t?.cost??t?.usage?.cost);return{inputTokens:r,outputTokens:o,totalTokens:a,costUsd:s}}};_aiGlobal.AiProviderUtils=AiProviderUtils;const AiStreamUtils=(()=>{"use strict";function e(n){try{return n?.abort?.(),!0}catch{return!1}}function t({onRender:n,onFirstChunk:r=null,updateIntervalMs:o=120}={}){let a="",s=null,c=!1;const d=()=>{typeof n=="function"&&n(a)},u=()=>{s||(s=setTimeout(()=>{s=null,d()},o))};return{append(f){c||(c=!0,typeof r=="function"&&r()),a+=String(f??""),u()},setText(f){a=String(f??""),u()},getText(){return a},hasContent(){return!!String(a||"").trim()},flush({force:f=!1}={}){s&&(clearTimeout(s),s=null),(f||String(a||"").trim())&&d()},clearTimer(){s&&(clearTimeout(s),s=null)}}}return{abort:e,createBufferedTextRenderer:t}})(),AiTextUtils={normalizeNewlines(e){return String(e||"").replace(/\r\n/g,`
`)},stripHtmlToText(e){const t=String(e||"").replace(/<script[\s\S]*?<\/script>/gi,"").replace(/<style[\s\S]*?<\/style>/gi,""),n=document.createElement("div");return n.innerHTML=t,(n.textContent||n.innerText||"").trim()},computeLineNumberAtIndex(e,t){const n=Math.max(0,Math.min(Number(t)||0,String(e||"").length));return this.normalizeNewlines(String(e||"").slice(0,n)).split(`
`).length-1},computePrefix(e,t){const r=(this.normalizeNewlines(e.slice(0,t)).match(/\n*$/)||[""])[0].length,o=Math.max(2-r,0);return`
`.repeat(o)},computeSuffix(e,t){const r=(this.normalizeNewlines(e.slice(t)).match(/^\n*/)||[""])[0].length,o=Math.max(2-r,0);return`
`.repeat(o)},escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML},truncate(e,t,n="..."){const r=String(e||"");return r.length<=t?r:r.slice(0,t-n.length)+n},getLinesAround(e,t,n=2){const o=this.normalizeNewlines(String(e||"")).split(`
`),a=Math.max(0,Math.min(Number(t)||0,o.length-1)),s=Math.max(0,a-n),c=Math.min(o.length-1,a+n),d=[];for(let u=s;u<=c;u++){const f=o[u]||"",g=this.truncate(f,80,"...");d.push(`${u+1}: ${g}`)}return d.join(`
`)},extractUmpleCode(e){const t=String(e||""),n=t.match(/```(?:umple)?\s*([\s\S]*?)```/);if(n)return n[1].trim();const r=t.match(/(?:class|interface|trait|association)\s+\w+/);if(r){const o=t.indexOf(r[0]);return t.substring(o).trim()}return t.trim()},parseCodeBlocks(e){const t=String(e||""),n=[],r=/```(\w+)?\s*([\s\S]*?)```/g;let o;for(;(o=r.exec(t))!==null;)n.push({language:(o[1]||"").trim().toLowerCase(),code:o[2].trim()});return n}},AiConfig={providers:{openai:{name:"OpenAI",baseURL:"https://api.openai.com/v1"},google:{name:"Google Gemini",baseURL:"https://generativelanguage.googleapis.com/v1beta/openai",defaultHeaders:{"x-stainless-arch":null,"x-stainless-lang":null,"x-stainless-os":null,"x-stainless-package-version":null,"x-stainless-retry-count":null,"x-stainless-runtime":null,"x-stainless-runtime-version":null,"x-stainless-timeout":null}},openrouter:{name:"OpenRouter",baseURL:"https://openrouter.ai/api/v1",defaultHeaders:{"HTTP-Referer":typeof window<"u"?window.location.origin:"","X-Title":"UmpleOnline"}}},defaults:{maxTokens:1e4},getProviderConfig(e){return this.providers[e]||null},getGenerationParams(e={}){return{maxTokens:e.maxTokens??this.defaults.maxTokens}}},AiErrors={types:{NETWORK_ERROR:"NETWORK_ERROR",CONFIGURATION_ERROR:"CONFIGURATION_ERROR",API_ERROR:"API_ERROR",VALIDATION_ERROR:"VALIDATION_ERROR",PROMPT_LOAD_ERROR:"PROMPT_LOAD_ERROR"},messages:{NO_PROVIDER:"Please select an AI provider",NO_API_KEY:"Please configure your AI API key",NO_MODEL:"Please select a model",PROVIDER_NOT_CONFIGURED:"Provider not configured",API_KEY_NOT_CONFIGURED:"API key not configured",MODEL_NOT_CONFIGURED:"Model not configured",NETWORK_ERROR:"Network error - please check your connection",PROVIDER_REQUIRED:"Provider is required",VERIFICATION_FAILED:"API key verification failed"},createError(e,t,n={}){const r=new Error(t);return r.type=e,r.details=n,r.isAiError=!0,r},extractErrorMessage(e,t="An error occurred"){return e?.error?typeof e.error=="object"?e.error.message||t:e.error:t},_extractErrorDataLike(e){if(!e||typeof e!="object")return null;const t=[e,e.error,e.response,e.body,e.data].filter(Boolean);for(const n of t)if(!(!n||typeof n!="object")){if(n.error)return n;if(typeof n.message=="string"||Number.isFinite(n.code)||n.metadata)return{error:n}}return null},normalizeApiError(e,{provider:t=null,model:n=null}={}){const r=this._extractErrorDataLike(e),o=Number.isFinite(e?.status)?e.status:null,a=Number.isFinite(e?.code)?e.code:null,s=Number.isFinite(r?.error?.code)?r.error.code:null,c=o??a??s??null,d=r?.error&&typeof r.error=="object"?r.error.metadata:null,u=d?.provider_name||null,f=d?.is_byok,g=typeof d?.raw=="string"?d.raw:null,h=t&&typeof AiConfig<"u"&&AiConfig.getProviderConfig?.(t)?.name||t,b=this.extractErrorMessage(r,e?.message||"API request failed"),E=c===429||/rate.?limit/i.test(String(b||"")+" "+String(g||"")),S=c===401||c===403;let D=b;if(E){if(D=`Rate limited${u?` (${u})`:""}. Please retry shortly.`,t==="openrouter"&&f===!1){const p=g?g.match(/https?:\/\/\S+/):null,C=p?p[0]:"https://openrouter.ai/settings/integrations";D+=` If this keeps happening, add your own OpenRouter integration key: ${C}`}}else S?D="Authentication failed. Please check your API key.":c&&c>=500&&(D="Provider error. Please retry shortly.");return{status:c,provider:t,providerDisplayName:h,model:n,upstreamProviderName:u,isRateLimited:E,isAuthError:S,isByok:f,raw:g,baseMessage:b,userMessage:D}},toApiError(e,{provider:t=null,model:n=null,operation:r=null}={}){if(!e)return this.createError(this.types.API_ERROR,"API request failed",{provider:t,model:n,operation:r});if(e?.isAiError)return e;const o=this.normalizeApiError(e,{provider:t,model:n});return this.createError(this.types.API_ERROR,o.userMessage||o.baseMessage||e.message||"API request failed",{...o,operation:r})},createConfigurationError(e){const t=this.messages[e]||e;return this.createError(this.types.CONFIGURATION_ERROR,t,{messageKey:e})},createApiError(e,t,n="API request failed"){const r=this.extractErrorMessage(t,`${n}: ${e?.status||"unknown"}`);return this.createError(this.types.API_ERROR,r,{status:e?.status,errorData:t})},createValidationError(e){return this.createError(this.types.VALIDATION_ERROR,e)},createPromptLoadError(e,t){return this.createError(this.types.PROMPT_LOAD_ERROR,`Failed to load prompt (${t}): ${e}`,{url:e,status:t})}},AiStorage={STORAGE_KEY_PROVIDER_DATA:"umpleAiProviderData",STORAGE_KEY_PROVIDER:"umpleAiProvider",_withStorage(e,t){try{return typeof Storage>"u"?null:e()}catch(n){return n.name==="QuotaExceededError"||n.name==="NS_ERROR_DOM_QUOTA_REACHED"?console.warn("localStorage quota exceeded:",t):n.name==="SecurityError"||n.code===18||console.error(t,n),null}},_sanitizeProviderDataMap(e){if(!e||typeof e!="object")return{};const t={};return Object.entries(e).forEach(([n,r])=>{if(!n||!r||typeof r!="object")return;const o={};if(r.apiKey&&(o.apiKey=String(r.apiKey).trim()),r.model&&(o.model=String(r.model).trim()),r.verified===!0&&(o.verified=!0),r.usage&&typeof r.usage=="object"){const a={},s=b=>{const E=Number(b);return Number.isFinite(E)?E:null},c=s(r.usage.requests),d=s(r.usage.inputTokens),u=s(r.usage.outputTokens),f=s(r.usage.totalTokens),g=s(r.usage.costUsd),h=r.usage.lastUsedAt?String(r.usage.lastUsedAt):"";c!=null&&(a.requests=Math.max(0,Math.floor(c))),d!=null&&(a.inputTokens=Math.max(0,Math.floor(d))),u!=null&&(a.outputTokens=Math.max(0,Math.floor(u))),f!=null&&(a.totalTokens=Math.max(0,Math.floor(f))),g!=null&&(a.costUsd=Math.max(0,g)),h&&(a.lastUsedAt=h),Object.keys(a).length>0&&(o.usage=a)}(o.apiKey||o.model||o.verified)&&(t[n]=o)}),t},getProviderDataMap(){return this._withStorage(()=>{const e=localStorage.getItem(this.STORAGE_KEY_PROVIDER_DATA);if(e)try{return this._sanitizeProviderDataMap(JSON.parse(e))}catch{return{}}return{}},"Error retrieving provider data map:")??{}},saveProviderDataMap(e){return this._withStorage(()=>{const t=this._sanitizeProviderDataMap(e);return Object.keys(t).length>0?localStorage.setItem(this.STORAGE_KEY_PROVIDER_DATA,JSON.stringify(t)):localStorage.removeItem(this.STORAGE_KEY_PROVIDER_DATA),!0},"Error saving provider data map:")??!1},getAllUsage(){const e=this.getProviderDataMap(),t={};return Object.entries(e).forEach(([n,r])=>{r.usage&&(t[n]=r.usage)}),t},recordUsage(e,t={}){if(!e)return!1;const n=t&&typeof t=="object"?t:{},r=b=>{const E=Number(b);return Number.isFinite(E)?E:null},o=this.getProviderDataMap(),a=o[e]||{},s=a.usage||{},c=r(n.requests),d=r(n.inputTokens),u=r(n.outputTokens);let f=r(n.totalTokens);const g=r(n.costUsd);f==null&&Number.isFinite(d)&&Number.isFinite(u)&&(f=d+u),s.requests=Math.max(0,Math.floor((s.requests||0)+(c??1))),d!=null&&(s.inputTokens=Math.max(0,Math.floor((s.inputTokens||0)+d))),u!=null&&(s.outputTokens=Math.max(0,Math.floor((s.outputTokens||0)+u))),f!=null&&(s.totalTokens=Math.max(0,Math.floor((s.totalTokens||0)+f))),g!=null&&(s.costUsd=Math.max(0,(s.costUsd||0)+g)),s.lastUsedAt=new Date().toISOString(),a.usage=s,o[e]=a;const h=this.saveProviderDataMap(o);return h&&typeof window<"u"&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("aiUsageUpdated",{detail:{provider:e}})),h},resetUsage(e=null){const t=this.getProviderDataMap();if(e){const n=t[e];return n&&(delete n.usage,t[e]=n),this.saveProviderDataMap(t)}return Object.keys(t).forEach(n=>{t[n]&&delete t[n].usage}),this.saveProviderDataMap(t)},saveApiKey(e,t){if(!e)throw AiErrors.createValidationError("Provider is required to save API key");const n=t?.trim(),r=this.getProviderDataMap(),o=r[e]||{};return n?o.apiKey=n:delete o.apiKey,r[e]=o,this.saveProviderDataMap(r)},getApiKey(e){return e&&this.getProviderDataMap()[e]?.apiKey||""},saveProvider(e){return this._withStorage(()=>(e?localStorage.setItem(this.STORAGE_KEY_PROVIDER,e):localStorage.removeItem(this.STORAGE_KEY_PROVIDER),!0),"Error saving provider:")??!1},getProvider(){return this._withStorage(()=>localStorage.getItem(this.STORAGE_KEY_PROVIDER)||"","Error retrieving provider:")??""},saveModel(e,t=null){const n=t||this.getProvider();if(!n)throw AiErrors.createValidationError("Provider is required to save model");const r=e?.trim();return this._withStorage(()=>{const o=this.getProviderDataMap(),a=o[n]||{};return r?a.model=r:delete a.model,o[n]=a,this.saveProviderDataMap(o)},"Error saving model:")??!1},getModel(e=null){const t=e||this.getProvider();return t?this._withStorage(()=>this.getProviderDataMap()[t]?.model||"","Error retrieving model:")??"":""},isVerified(e=null){const t=e||this.getProvider();return t?this._withStorage(()=>this.getProviderDataMap()[t]?.verified===!0,"Error checking verification status:")??!1:!1},setVerified(e,t=null){const n=t||this.getProvider();return n?this._withStorage(()=>{const r=this.getProviderDataMap(),o=r[n]||{};return e?o.verified=!0:delete o.verified,r[n]=o,this.saveProviderDataMap(r)},"Error setting verification status:")??!1:!1}},AiProviderAdapters={_clients:new Map,_getClient(e,t){const n=AiConfig.getProviderConfig(e);if(!n)throw AiErrors.createConfigurationError("PROVIDER_NOT_CONFIGURED");const r=`${e}:${t}`;if(!this._clients.has(r)){const o={apiKey:t,baseURL:n.baseURL,dangerouslyAllowBrowser:!0};n.defaultHeaders&&(o.defaultHeaders=n.defaultHeaders),this._clients.set(r,new OpenAI(o))}return this._clients.get(r)},async _retryIfEmptyReasoningOnly(e,t,n,r){const o=n?.choices?.[0]?.message?.content,a=n?.choices?.[0]?.finish_reason,s=n?.usage?.completion_tokens,c=n?.usage?.completion_tokens_details?.reasoning_tokens;if(!((o===""||o==null)&&a===AiConstants.FinishReason.LENGTH&&Number.isFinite(s)&&Number.isFinite(c)&&s>0&&c>=s))return n;const u={...t},f=AiProviderUtils.usesMaxCompletionTokens(r),g=Number(f?t.max_completion_tokens:t.max_tokens)||0,h=g>0?g*2:16e3;return f?u.max_completion_tokens=h:u.max_tokens=h,e.chat.completions.create(u)},_recordUsage(e,t,n=null){const r=AiProviderUtils.normalizeUsage(t,n);AiStorage.recordUsage(e,{requests:1,inputTokens:r.inputTokens,outputTokens:r.outputTokens,totalTokens:r.totalTokens,costUsd:r.costUsd})},async verifyKey(e,t){if(!e)return{valid:!1,error:"Provider not selected"};if(!t)return{valid:!1,error:"API key not provided"};try{if(e==="openrouter"){const r=await fetch("https://openrouter.ai/api/v1/key",{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(!r.ok){const o=await r.json().catch(()=>({}));return{valid:!1,error:AiErrors.extractErrorMessage(o,`Verification failed: ${r.status}`)}}return{valid:!0}}return await this._getClient(e,t).models.list(),{valid:!0}}catch(n){return console.error("Error verifying API key:",n),{valid:!1,error:n.message||"Verification failed"}}},async fetchModels(e,t){if(!t)throw AiErrors.createConfigurationError("NO_API_KEY");const n=this._getClient(e,t);let r;return e==="openrouter"?r=await n.models.list({category:"programming"}):r=await n.models.list(),{ok:!0,json:()=>Promise.resolve({data:r.data})}},parseModelsResponse(e,t){const n=[];return(t.data||[]).forEach(o=>{if(o.id){const a={value:o.id,label:o.id};e==="openrouter"&&(a.modelProvider=AiProviderUtils.extractModelProvider(o.id)),o.pricing&&(a.pricing={input:o.pricing.prompt*1e6,output:o.pricing.completion*1e6}),n.push(a)}}),AiProviderUtils.filterModelsForProvider(e,n)},async chat(e,t,n,r,o="",a={}){const s=this._getClient(e,t),c=AiConfig.getGenerationParams(a),d=[];o&&d.push({role:"system",content:o}),d.push({role:"user",content:r});const u={model:n,messages:d};AiProviderUtils.usesMaxCompletionTokens(n)?u.max_completion_tokens=c.maxTokens:u.max_tokens=c.maxTokens;try{let f=await s.chat.completions.create(u);this._recordUsage(e,f?.usage,f);const g=await this._retryIfEmptyReasoningOnly(s,u,f,n);g!==f&&(f=g,this._recordUsage(e,f?.usage,f));const h=f.choices?.[0]?.message?.content;return AiProviderUtils.contentToText(h)}catch(f){throw AiErrors.toApiError(f,{provider:e,model:n,operation:"chat"})}},chatStream(e,t,n,r,o="",a={},s={}){const c=new AbortController,d=this._getClient(e,t),u=AiConfig.getGenerationParams(a),f=s?.onDelta,g=s?.onTruncated,h=(async()=>{try{const b=[];o&&b.push({role:"system",content:o}),b.push({role:"user",content:r});const E={model:n,messages:b,stream:!0,stream_options:{include_usage:!0}};AiProviderUtils.usesMaxCompletionTokens(n)?E.max_completion_tokens=u.maxTokens:E.max_tokens=u.maxTokens;const S=await d.chat.completions.create(E,{signal:c.signal});let D="",j=null,p=null;for await(const C of S){if(c.signal.aborted)break;const M=C.choices?.[0];M?.finish_reason&&(j=M.finish_reason);const T=M?.delta?.content??"",P=AiProviderUtils.contentToText(T);P&&(D+=P,f?.(P)),C?.usage&&(p=C.usage)}return!c.signal.aborted&&j===AiConstants.FinishReason.LENGTH&&g?.(),c.signal.aborted||(p?this._recordUsage(e,p,null):AiStorage.recordUsage(e,{requests:1})),D}catch(b){throw c.signal.aborted&&b?.name==="AbortError"?b:AiErrors.toApiError(b,{provider:e,model:n,operation:"chatStream"})}})();return{abort:()=>c.abort(),done:h}}},AiApi={STORAGE_KEY_PROVIDER_DATA:AiStorage.STORAGE_KEY_PROVIDER_DATA,STORAGE_KEY_PROVIDER:AiStorage.STORAGE_KEY_PROVIDER,saveApiKey(e,t){return AiStorage.saveApiKey(e,t)},getApiKey(e=null){const t=e||this.getProvider();return t?AiStorage.getApiKey(t):""},saveProvider(e){return AiStorage.saveProvider(e)},getProvider(){return AiStorage.getProvider()},saveModel(e,t=null){return AiStorage.saveModel(e,t)},getModel(e=!1,t=null){const n=t||this.getProvider();return n?AiStorage.getModel(n):""},isVerified(e=null){return AiStorage.isVerified(e)},setVerified(e,t=null){return AiStorage.setVerified(e,t)},async verifyKey(e,t){return AiProviderAdapters.verifyKey(e,t)},async fetchModels(e,t){return AiProviderAdapters.fetchModels(e,t)},parseModelsResponse(e,t){return AiProviderAdapters.parseModelsResponse(e,t)},async chat(e,t="",n={}){const r=this.getProvider(),o=this.getApiKey(r),a=this.getModel();if(!r)throw AiErrors.createConfigurationError("PROVIDER_NOT_CONFIGURED");if(!o)throw AiErrors.createConfigurationError("API_KEY_NOT_CONFIGURED");if(!a)throw AiErrors.createConfigurationError("MODEL_NOT_CONFIGURED");return AiProviderAdapters.chat(r,o,a,e,t,n)},chatStream(e,t="",n={},r={}){const o=this.getProvider(),a=this.getApiKey(o),s=this.getModel();if(!o)throw AiErrors.createConfigurationError("PROVIDER_NOT_CONFIGURED");if(!a)throw AiErrors.createConfigurationError("API_KEY_NOT_CONFIGURED");if(!s)throw AiErrors.createConfigurationError("MODEL_NOT_CONFIGURED");return AiProviderAdapters.chatStream(o,a,s,e,t,n,r)}},AiConfigValidation={checkApiConfig(e={}){const{requireVerified:t=!0}=e,n=AiApi.getProvider();return n?AiApi.getApiKey(n)?AiApi.getModel()?t&&!AiStorage.isVerified(n)?{configured:!1,message:"Please verify your API key first."}:{configured:!0}:{configured:!1,message:"Please verify your API key and select a model in the AI section."}:{configured:!1,message:"Please configure your AI API key in the AI section first."}:{configured:!1,message:"Please select an AI provider in the AI section first."}},checkProvider(){const e=AiApi.getProvider();return e?{ready:!0,provider:e}:{ready:!1,message:"Please select an AI provider."}},checkApiKey(){const e=this.checkProvider();if(!e.ready)return e;const t=e.provider,n=AiApi.getApiKey(t);return n?{ready:!0,apiKey:n}:{ready:!1,message:"Please configure your API key."}},checkModel(){const e=this.checkApiKey();if(!e.ready)return e;const t=AiApi.getModel();return t?{ready:!0,model:t}:{ready:!1,message:"Please select a model."}}},AiCompilerService={getCompilerLanguage(){return"Json"},getSelfCorrectionMaxPasses(){return 10},parseCompilerIssuesFromErrorHtml(e){const t=String(e||"");if(!t.trim())return[];const n=[];try{const s=document.createElement("div");s.innerHTML=t;const c=s.querySelector("#errorRow");if(c){const d=Array.from(c.querySelectorAll("font")),u=f=>{let g=f.nextSibling;for(;g;){if(g.nodeType===1){const h=g.tagName.toLowerCase();if(h==="i"){const b=g.querySelector("a");if(b)return b}if(h==="font")break}g=g.nextSibling}return null};if(d.forEach(f=>{const g=String(f.textContent||"").replace(/\s+/g," ").trim(),h=g.startsWith("Warning")?"Warning":g.startsWith("Error")?"Error":"Unknown",b=f.querySelector("a"),S=String(b?.textContent||"").match(/(\d+)/),D=S?parseInt(S[1],10):null;let j=g;const p=j.indexOf(":");p>=0&&(j=j.slice(p+1).trim()),j=j.replace(/\.$/,"").trim();const C=u(f),_=String(C?.textContent||"").match(/\(([^)]+)\)/),T=_?_[1].trim():"";(h!=="Unknown"||j)&&n.push({severity:h,line:D,message:j,errorCode:T})}),n.length>0)return n}}catch(s){typeof console<"u"&&console.warn&&console.warn("AiCompilerService: HTML parsing failed, falling back to text parsing",s?.message||s)}const r=AiTextUtils.stripHtmlToText(t),o=/\b(Error|Warning)\s+on\s+line\s+(\d+)\s*:\s*([\s\S]*?)\.(?:\s*More information\s*\(([^)]+)\))?/g;let a;for(;(a=o.exec(r))!==null;)n.push({severity:a[1],line:parseInt(a[2],10),message:(a[3]||"").trim(),errorCode:(a[4]||"").trim()});return n.length===0&&/\b(Error|Warning)\b/i.test(r)&&n.push({severity:"Unknown",line:null,message:r,errorCode:""}),n},getIssueKey(e){const t=(e?.severity||"").trim(),n=(e?.errorCode||"").trim(),r=(e?.message||"").trim();return`${t}|${n}|${r}`},formatIssuesForLog(e){return(e||[]).map(t=>{const n=t.errorCode?` (${t.errorCode})`:"",r=Number.isFinite(t.line)?t.line:"?";return`- ${t.severity} on line ${r}${n}: ${t.message}`}).join(`
`)},async compileUmpleWithServer(e){const t=this.getCompilerLanguage(),n=typeof Page<"u"&&Page.getFilename&&Page.getFilename()||"",r=typeof Action<"u"&&Action.getThemePreference?Action.getThemePreference():"system",o=[`language=${encodeURIComponent(t)}`,"error=true",`umpleCode=${encodeURIComponent(String(e||""))}`,`filename=${encodeURIComponent(n)}`,`theme=${encodeURIComponent(r)}`].join("&");return new Promise((a,s)=>{if(typeof Ajax>"u"||!Ajax.sendRequest){s(new Error("Ajax subsystem not available"));return}Ajax.sendRequest("scripts/compiler.php",c=>{try{const d=String(c?.responseText||""),u=d.indexOf("URL_SPLIT"),f=(u>=0?d.slice(0,u):d).trim(),g=this.parseCompilerIssuesFromErrorHtml(f);a({errorHtml:f,issues:g})}catch(d){s(d)}},o)})}},AiPrompting=(()=>{"use strict";const e=`You are an expert in Umple (https://cruise.umple.org/umple/): its textual modeling syntax for classes, associations, and state machines.

Rules:
- Do not invent Umple syntax or project context.
- If something is ambiguous, choose the simplest valid Umple and note assumptions inside Umple comments.
- Follow the output contract exactly.
- When the user prompt includes tagged sections like <tag> ... </tag>, read each section only from its opening tag to its matching closing tag and do not merge content across blocks.
- Never name attributes identical to the class name.`,t='Umple quick reference (non-exhaustive):\n\n- Classes: `class Name { Type a; Type a = default; method(p){ ... } isA Super, I, Trait; }`\n- Interfaces/Traits: `interface I { Type m(p); }`  `trait T { ... }`  `class C { isA I, T; }`\n- Enums: `enum E { A, B }`\n- Associations: `1 -- * Other;`  `* role -- 0..1 Other otherRole;`  `1 -> * Other;`  `association { 1 A -> * B; }`\n- Multiplicity: `1`  `0..1`  `*`  `1..*`  `m..n`\n- Constraints: `[booleanExpr]` on model/attr/assoc/transition\n- State machines: `sm { S1 { e -> S2; } }`  `state { initial { -> S1; } S1 { e -> S2; } }`  `status { S1 { e(p) [g] / { a; } -> S2; } }`\n- State actions: `entry / { ... }`  `exit / { ... }`  `do { ... }`\n- Auto-transition: `S { -> Next; }`\n- Timed transitions: `after(msExpr) -> Next;`  `afterEvery(msExpr) -> State;`\n- Orthogonal regions: `Composite { R1 { ... } || R2 { ... } }`\n- Reusable SM: `statemachine SM { ... }`  `class C { st as SM; }`\n- Requirements: `req R1 { text }`  `implementsReq R1, R2;`\n- Composition/features: `use "file.ump";`  `use Mixset;`  `use !Mixset;`  `require MixsetA;`  `generate Target;`\n',n=Object.create(null),r=Object.create(null);function o(c){const u=String(c||"").replace(/^\uFEFF/,"").split(/\r?\n/);for(;u.length>0&&!u[u.length-1].trim();)u.pop();for(;u.length>0&&/^```+\s*$/.test(u[u.length-1].trim());)u.pop();return u.join(`
`).trim()}function a(c){const d=String(c||"").trim();return d?typeof fetch=="function"?fetch(d).then(u=>{if(!u.ok)throw AiErrors.createPromptLoadError(d,u.status);return u.text()}).then(o):new Promise((u,f)=>{try{const g=new XMLHttpRequest;g.open("GET",d,!0),g.onreadystatechange=()=>{g.readyState===4&&(g.status>=200&&g.status<300?u(o(g.responseText)):f(AiErrors.createPromptLoadError(d,g.status)))},g.send(null)}catch(g){f(g)}}):Promise.reject(new Error("Prompt URL is empty"))}function s(c){const d=String(c||"").trim();return d?n[d]?Promise.resolve(n[d]):(r[d]||(r[d]=a(d).then(u=>(n[d]=u,delete r[d],u)).catch(u=>{throw delete r[d],u})),r[d]):Promise.reject(new Error("Prompt URL is empty"))}return{getBaseSystemPrompt(){return e},getUmpleCheatSheet(){return t},getPromptText(c){return s(c)}}})(),AiSettingsView={elements:{},modelRestoreInProgress:!1,_clearChildren(e){if(e)for(;e.firstChild;)e.removeChild(e.firstChild)},_setSelectSingleOption(e,t){if(!e)return;this._clearChildren(e);const n=document.createElement("option");n.value="",n.textContent=(t??"").toString(),e.appendChild(n)},_getElement(e,t){return this.elements[t]||(this.elements[t]=document.getElementById(e)),this.elements[t]},getElement(e,t){return this._getElement(e,t)},initElements(){return this._getElement("selectAiProvider","providerSelect"),this._getElement("aiProviderLink","providerLink"),this._getElement("selectAiModel","modelSelect"),this._getElement("inputAiApiKey","inputField"),this._getElement("apiKeyStatus","statusDiv"),this._getElement("aiUsageSummary","usageSummary"),this._getElement("buttonResetAiUsage","resetUsageButton"),this.elements},setStatusMessage(e,t=""){const n=this._getElement("apiKeyStatus","statusDiv");if(!n)return;const r=(e??"").toString();if(n.textContent=r,n.className="ai-key-status-message",!r){n.classList.add("is-hidden");return}t&&n.classList.add(`ai-status-message--${t}`)},clearStatus(){const e=this._getElement("apiKeyStatus","statusDiv");e&&(e.textContent="",e.className="ai-key-status-message is-hidden")},showModelSelection(){const e=document.getElementById("ttAiModel");e&&e.classList.remove("is-hidden")},hideModelSelection(){const e=document.getElementById("ttAiModel");e&&e.classList.add("is-hidden")},updateStatusIndicator(e){const t=document.getElementById("aiStatusIndicator"),n=document.getElementById("aiStatusText");if(!t||!n)return;const{provider:r,apiKey:o,model:a,verified:s}=e;r&&o&&a&&s?(t.className="ai-status-indicator ready",t.title=`AI Ready - ${r} - ${a}`,n.textContent=a,n.title=`${r} - ${a}`):r&&o&&s?(t.className="ai-status-indicator ready",t.title="AI configured (select model)",n.textContent="Select model",n.title=r):r&&o?(t.className="ai-status-indicator not-ready",t.title="API key not verified",n.textContent="Verify key",n.title=""):(t.className="ai-status-indicator not-ready",t.title="AI not configured",n.textContent="Not configured",n.title="")},showSettingsModal(){const e=document.getElementById("aiSettingsModal");e&&e.classList.remove("is-hidden")},hideSettingsModal(){const e=document.getElementById("aiSettingsModal");e&&e.classList.add("is-hidden")},setModelsLoading(){const e=this._getElement("selectAiModel","modelSelect");e&&(this._setSelectSingleOption(e,"Loading models..."),e.disabled=!0)},setModelsError(e){const t=this._getElement("selectAiModel","modelSelect");t&&(this._setSelectSingleOption(t,e),t.disabled=!1)},setModelsOptions(e){const t=this._getElement("selectAiModel","modelSelect");if(!t)return;if(e.length===0){this._setSelectSingleOption(t,"No models available"),t.disabled=!1,this.updateModelCostDisplay(null);return}this._modelsData=new Map(e.map(s=>[s.value,s]));const n=e.some(s=>s.modelProvider),r=s=>{if(!s.pricing)return!1;const c=s.pricing.input,d=s.pricing.output;return c===0&&d===0};this._clearChildren(t);const o=document.createDocumentFragment(),a=(s,c,d=null)=>{const u=document.createElement("option");u.value=c.value,u.textContent=(d??c.label??"").toString(),s.appendChild(u)};if(n){const s=e.filter(f=>r(f)),c=e.filter(f=>!r(f));s.sort((f,g)=>f.label.localeCompare(g.label));const d=AiProviderUtils.groupModelsByProvider(c);Object.keys(d).forEach(f=>{d[f].sort((g,h)=>g.label.localeCompare(h.label))});const u=Object.keys(d).sort((f,g)=>f==="unknown"?1:g==="unknown"?-1:f.localeCompare(g));if(s.length>0){const f=document.createElement("optgroup");f.label=`\u{1F193} Free Models (${s.length})`,s.forEach(g=>a(f,g)),o.appendChild(f)}u.forEach(f=>{const g=d[f],h=g.length,b=document.createElement("optgroup");b.label=`${f} (${h})`,g.forEach(E=>a(b,E)),o.appendChild(b)})}else{const s=e.filter(u=>r(u)),c=e.filter(u=>!r(u));s.sort((u,f)=>u.label.localeCompare(f.label)),c.sort((u,f)=>u.label.localeCompare(f.label)),[...s,...c].forEach(u=>{const g=r(u)?`\u{1F193} ${u.label}`:u.label;a(o,u,g)})}t.appendChild(o),t.disabled=!1,this._modelChangeListener||(this._modelChangeListener=!0,t.addEventListener("change",()=>this._onModelChange())),this._onModelChange()},updateModelCostDisplay(e){let t=document.getElementById("aiModelCostDisplay");if(!e){t&&t.remove();return}const r=this._modelsData?.get(e)?.pricing;let o="\u2014",a="\u2014";r&&(o=this._formatPricing(r.input),a=this._formatPricing(r.output));const s=`<div id="aiModelCostDisplay" class="ai-model-cost">$${o}/M input tokens $${a}/M output tokens</div>`;if(t)t.outerHTML=s;else{const c=document.getElementById("ttAiModel");c&&c.insertAdjacentHTML("beforeend",s)}},_formatPricing(e){return Number.isFinite(e)?e.toFixed(2):"\u2014"},_onModelChange(){const e=this._getElement("selectAiModel","modelSelect");e&&this.updateModelCostDisplay(e.value)},restoreSavedModel(e,t,n=0){const r=this._getElement("selectAiModel","modelSelect");if(!r||this.modelRestoreInProgress)return;if(!(r.options.length>0&&r.options[0].value!==""&&!r.options[0].text.includes("Loading")&&!r.options[0].text.includes("Error")&&!r.options[0].text.includes("No models"))){this.modelRestoreInProgress=!0,n<10?setTimeout(()=>{this.modelRestoreInProgress=!1,this.restoreSavedModel(e,t,n+1)},200):this.modelRestoreInProgress=!1;return}const a=e(!1);if(a){if(Array.from(r.options).some(d=>d.value===a)){r.value=a,this.updateModelCostDisplay(r.value);return}console.warn(`Saved model "${a}" not found in available models`)}const s=r.value||r.options[0]?.value||"";s&&(r.value=s,t(s),this.updateModelCostDisplay(r.value))},toggleApiKeyVisibility(){const e=this._getElement("inputAiApiKey","inputField"),t=document.getElementById("toggleApiKeyVisibility");if(!e)return;const n=e.type==="password";e.type=n?"text":"password",t&&t.classList.toggle("visible",n)},setProviderValue(e){const t=this._getElement("selectAiProvider","providerSelect");t&&(t.value=e)},setApiKeyValue(e){const t=this._getElement("inputAiApiKey","inputField");t&&(t.value=e)},_formatNumber(e){return Number.isFinite(e)?Math.round(e).toLocaleString():"\u2014"},_formatTokens(e){if(!Number.isFinite(e))return"\u2014";const t=e/1e3;return t<1?`${Math.round(e)} tokens`:t<1e3?`${t.toFixed(1)}K`:`${(t/1e3).toFixed(2)}M`},_formatCost(e){return Number.isFinite(e)?`$${e.toFixed(4)}`:"\u2014"},_getProviderLabel(e){return(typeof AiConfig<"u"?AiConfig.getProviderConfig(e):null)?.name||e},_getProviderLinkInfo(e){const t="Get API Key";return{openai:{label:t,url:"https://platform.openai.com/"},google:{label:t,url:"https://aistudio.google.com/apikey"},openrouter:{label:t,url:"https://openrouter.ai/"}}[e]||null},updateProviderLink(e){const t=this._getElement("aiProviderLink","providerLink");if(!t)return;const n=this._getProviderLinkInfo(e);if(!n){t.classList.add("is-hidden"),t.removeAttribute("href"),t.textContent="",t.setAttribute("tabindex","-1"),t.removeAttribute("title");return}t.textContent=n.label,t.href=n.url,t.title=n.url,t.classList.remove("is-hidden"),t.setAttribute("tabindex","0")},renderUsage(e,t){const n=this._getElement("aiUsageSummary","usageSummary"),r=this._getElement("buttonResetAiUsage","resetUsageButton");if(!n)return;const o=n.closest(".ai-usage-section");if(!t){o&&o.classList.add("is-hidden"),n.innerHTML="",r&&r.classList.add("is-hidden");return}const a=e?.[t]||{},s=Number.isFinite(a.requests)||Number.isFinite(a.totalTokens);if(!Number.isFinite(a.costUsd)){o&&o.classList.add("is-hidden"),n.innerHTML="",r&&r.classList.add("is-hidden");return}if(!s){o&&o.classList.add("is-hidden"),n.innerHTML="",r&&r.classList.add("is-hidden");return}o&&o.classList.remove("is-hidden"),r&&r.classList.remove("is-hidden");const d=this._formatTokens(a.totalTokens),u=this._formatTokens(a.inputTokens),f=this._formatTokens(a.outputTokens),g=this._formatNumber(a.requests),h=this._formatCost(a.costUsd);n.innerHTML=`
      <div class="ai-usage-primary">
        ${d} \xB7 ${g} req \xB7 ${h}
      </div>
      <div class="ai-usage-secondary">
        \u21B3 In: ${u} / Out: ${f}
      </div>
    `}},AiSettings={elements:{},_initialized:!1,_usageListenerBound:!1,_bindOnce(e,t,n,r){e&&(e.dataset[t]||(e.dataset[t]="1",e.addEventListener(n,r)))},init(){this.elements=AiSettingsView.initElements(),this._initialized||(this._initialized=!0,this.loadPreferences());const e=document.getElementById("buttonAiSettings");if(e){const u=f=>{f.preventDefault(),this.showSettingsModal()};this._bindOnce(e,"aiBoundOpenSettings","click",u),this._bindOnce(e,"aiBoundOpenSettingsKeypress","keypress",f=>{(f.key==="Enter"||f.key===" ")&&u(f)})}const t=document.getElementById("btnCloseAiSettings");if(t){const u=f=>{f.preventDefault(),this.hideSettingsModal()};this._bindOnce(t,"aiBoundCloseSettings","click",u),this._bindOnce(t,"aiBoundCloseSettingsKeypress","keypress",f=>{(f.key==="Enter"||f.key===" ")&&u(f)})}const n=document.getElementById("aiSettingsModal");if(n){const u=n.querySelector(".dialog-overlay");u&&this._bindOnce(u,"aiBoundOverlayClose","click",()=>this.hideSettingsModal())}const r=this.elements.providerSelect;r&&this._bindOnce(r,"aiBoundProviderChange","change",()=>{const u=r.value,f=this.elements.inputField;AiApi.saveProvider(u),this.clearStatus(),AiSettingsView.updateProviderLink(u);const g=AiApi.getApiKey(u);if(f&&(f.value=g,g?(f.placeholder="",f.classList.remove("api-key-empty-hint")):(f.placeholder="Enter your API key",f.classList.add("api-key-empty-hint"))),g&&AiApi.isVerified(u)){this.loadModels(u,g,h=>{h?AiSettingsView.showModelSelection():(AiSettingsView.hideModelSelection(),AiApi.setVerified(!1,u)),this.updateStatusIndicator(),this.refreshUsage()});return}AiSettingsView.hideModelSelection(),AiApi.setVerified(!1,u),this.updateStatusIndicator(),this.refreshUsage()});const o=this.elements.modelSelect;o&&this._bindOnce(o,"aiBoundModelChange","change",()=>{const u=this.elements.providerSelect?.value||AiApi.getProvider(),f=o.value;f?AiApi.saveModel(f,u):AiApi.saveModel("",u),this.clearStatus(),this.updateStatusIndicator()});const a=this.elements.inputField;a&&(this._bindOnce(a,"aiBoundApiKeyBlur","blur",()=>{const u=this.elements.providerSelect?.value||AiApi.getProvider();if(!u)return;const f=a.value.trim();a.value=f,AiApi.saveApiKey(u,f),f?(a.placeholder="",a.classList.remove("api-key-empty-hint")):(a.placeholder="Enter your API key",a.classList.add("api-key-empty-hint")),AiApi.setVerified(!1,u),AiSettingsView.hideModelSelection(),this.clearStatus(),this.updateStatusIndicator()}),this._bindOnce(a,"aiBoundApiKeyKeypress","keypress",u=>{u.key==="Enter"&&(u.preventDefault(),this.verifyApiKey())}));const s=document.getElementById("buttonVerifyApiKey");if(s){const u=f=>{f.preventDefault(),this.verifyApiKey()};this._bindOnce(s,"aiBoundVerifyClick","click",u),this._bindOnce(s,"aiBoundVerifyKeypress","keypress",f=>{(f.key==="Enter"||f.key===" ")&&u(f)})}const c=document.getElementById("toggleApiKeyVisibility");c&&a&&(this._bindOnce(c,"aiBoundToggleVisibilityClick","click",()=>{this.toggleApiKeyVisibility()}),this._bindOnce(c,"aiBoundToggleVisibilityKeypress","keypress",u=>{(u.key==="Enter"||u.key===" ")&&(u.preventDefault(),this.toggleApiKeyVisibility())}));const d=this.elements.resetUsageButton;if(d){const u=f=>{f.preventDefault(),AiStorage.resetUsage(),this.refreshUsage()};this._bindOnce(d,"aiBoundResetUsage","click",u),this._bindOnce(d,"aiBoundResetUsageKeypress","keypress",f=>{(f.key==="Enter"||f.key===" ")&&u(f)})}!this._usageListenerBound&&typeof window<"u"&&(this._usageListenerBound=!0,window.addEventListener("aiUsageUpdated",()=>{const u=document.getElementById("aiSettingsModal");u&&!u.classList.contains("is-hidden")&&this.refreshUsage()}))},updateStatus(e,t){AiSettingsView.setStatusMessage(e,t)},clearStatus(){AiSettingsView.clearStatus()},updateStatusIndicator(){const e=AiApi.getProvider(),t=AiApi.getApiKey(e),n=AiApi.getModel(!1,e),r=AiApi.isVerified(e);AiSettingsView.updateStatusIndicator({provider:e,apiKey:t,model:n,verified:r})},showSettingsModal(){AiSettingsView.showSettingsModal(),this.loadPreferences(),setTimeout(()=>this.restoreSavedModel(),100),this.refreshUsage(),this.updateStatusIndicator()},hideSettingsModal(){AiSettingsView.hideSettingsModal(),this.updateStatusIndicator()},restoreSavedModel(e=null){const t=e||AiApi.getProvider();AiSettingsView.restoreSavedModel(()=>AiApi.getModel(!1,t),n=>AiApi.saveModel(n,t))},async loadModels(e,t,n){AiSettingsView.setModelsLoading();try{const r=await AiApi.fetchModels(e,t);if(!r.ok){const s=await r.json().catch(()=>({}));if(r.status===401||r.status===403){const c=AiErrors.extractErrorMessage(s,"Enter API key to load models");AiSettingsView.setModelsError(c),n?.(!1);return}throw AiErrors.createApiError(r,s,"Failed to fetch models")}const o=await r.json(),a=AiApi.parseModelsResponse(e,o);AiSettingsView.setModelsOptions(a),this.restoreSavedModel(e),n?.(!0)}catch(r){console.error("Error loading models:",r);const o=r.message?`Error: ${r.message}`:"Error loading models";AiSettingsView.setModelsError(o),n?.(!1)}},loadPreferences(){let e=AiApi.getProvider();e||(e="openrouter",AiApi.saveProvider(e));const t=AiApi.getApiKey(e);AiSettingsView.setProviderValue(e),AiSettingsView.setApiKeyValue(t),AiSettingsView.updateProviderLink(e),AiApi.isVerified(e)&&t&&e?this.loadModels(e,t,r=>{r&&AiSettingsView.showModelSelection(),this.updateStatusIndicator()}):(AiSettingsView.hideModelSelection(),this.updateStatusIndicator()),this.refreshUsage()},async verifyApiKey(){const e=AiSettingsView.getElement("selectAiProvider","providerSelect"),t=AiSettingsView.getElement("inputAiApiKey","inputField");if(!e||!t){this.updateStatus("UI elements not found","error");return}const n=e.value,r=t.value.trim();if(!n){this.updateStatus("Please select a provider first","error");return}if(!r){this.updateStatus("Please enter an API key","error");return}AiApi.saveApiKey(n,r),AiApi.saveProvider(n),this.updateStatus("Verifying API key...","success"),AiSettingsView.hideModelSelection();const o=await AiApi.verifyKey(n,r);o.valid?this.loadModels(n,r,a=>{a?(this.updateStatus("Success!","success"),AiSettingsView.showModelSelection(),AiApi.setVerified(!0,n),setTimeout(()=>this.updateStatusIndicator(),100)):(this.updateStatus("Failed to load models after verification.","error"),AiApi.setVerified(!1,n),this.updateStatusIndicator())}):(this.updateStatus(`API key verification failed: ${o.error}`,"error"),AiApi.setVerified(!1,n),this.updateStatusIndicator())},toggleApiKeyVisibility(){AiSettingsView.toggleApiKeyVisibility()},refreshUsage(){const e=AiStorage.getAllUsage(),t=this.elements.providerSelect?.value||AiApi.getProvider();AiSettingsView.renderUsage(e,t)}};window.AiSettings=AiSettings;const RequirementsPromptBuilder=(()=>{"use strict";const e=typeof AiPromptUtils<"u"?AiPromptUtils:null,t=(H,I,v)=>e&&e.block?e.block(H,I,v):String(I||"").trim(),n=(H,I)=>e&&e.joinBlocks?e.joinBlocks(H,I):(H||[]).filter(Boolean).join(`

`),r={requirements:{url:"scripts/ai/prompts/requirement_guidance_prompt.md",blockTitle:"how_to_use_requirements_in_umple"},statemachine:{url:"scripts/ai/prompts/state_machine_guidance_prompt.md",blockTitle:"how_to_model_state_machines_in_umple"},classdiagram:{url:"scripts/ai/prompts/class_diagram_guidance_prompt.md",blockTitle:"how_to_model_class_diagrams_in_umple"},statemachine_system:{url:"scripts/ai/prompts/state_machine_system_prompt.md",blockTitle:"state_machine_critical_rules"},classdiagram_system:{url:"scripts/ai/prompts/class_diagram_system_prompt.md",blockTitle:"class_diagram_critical_rules"}},o=Object.create(null),a=Object.create(null);function s(H){return String(o[H]||"").trim()}function c(H){return H==="statemachine"?["statemachine"]:H==="classdiagram"?["classdiagram"]:[]}function d(H){return H==="statemachine"?["statemachine_system"]:H==="classdiagram"?["classdiagram_system"]:[]}function u(H){return c(H).map(v=>{const L=r[v];if(!L)return"";const O=s(v);return O?t(L.blockTitle,O):""}).filter(Boolean)}function f(H){return d(H).map(v=>{const L=r[v];if(!L)return"";const O=s(v);return O?t(L.blockTitle,O):""}).filter(Boolean)}function g(H){if(String(o[H]||"").trim())return Promise.resolve(o[H]);if(a[H])return a[H];const I=r[H],v=typeof AiPrompting<"u"&&AiPrompting.getPromptText?AiPrompting.getPromptText:null;return I?v?(a[H]=v(I.url).then(L=>(o[H]=L,delete a[H],L)).catch(L=>{throw delete a[H],L}),a[H]):Promise.reject(new Error("AiPrompting.getPromptText is not available")):Promise.reject(new Error(`Unknown guidance key: ${H}`))}async function h(H){const I=["requirements",...c(H),...d(H)];await Promise.all(I.map(v=>g(v)))}async function b(H){const I=["requirements",...c(H),...d(H)];await Promise.all(I.map(v=>g(v)))}function E(H){return(H||[]).map(I=>`Requirement ${I.id}:
${(I.text||"").trim()}`).join(`

`)}function S(H,I=[]){const v=typeof AiPrompting<"u"&&AiPrompting.getBaseSystemPrompt?AiPrompting.getBaseSystemPrompt():"You are an expert in Umple modeling language.";return n([t("system",v,{allowEmpty:!0}),...f(H),...u(H),t("umple_quick_reference",j(),{allowEmpty:!0}),t("output_contract",P({generationType:H,expectedRequirementIds:I})),t("directive","Your job is to generate ONLY valid Umple code.")])}function D(H){const I=typeof AiPrompting<"u"&&AiPrompting.getBaseSystemPrompt?AiPrompting.getBaseSystemPrompt():"You are an expert in Umple modeling language.";return n([t("system",I,{allowEmpty:!0}),t("role","You are debugging Umple code. Your task is to FIX compiler errors in a generated block so it compiles cleanly when inserted into the user's existing model."),...f(H),...u(H),t("umple_quick_reference",j(),{allowEmpty:!0}),t("repair_strategy",["1. Analyze the compiler error message carefully","2. Identify the root cause of the error in the code block"].join(`
`))])}function j(){return typeof AiPrompting<"u"&&AiPrompting.getUmpleCheatSheet?AiPrompting.getUmpleCheatSheet():""}function p(H){return H==="classdiagram"?"Generate Umple for a class diagram (classes, attributes, associations).":"Generate Umple for a state machine (states, events, transitions, guards/actions if relevant)."}function C(H){return H==="statemachine"?"- Include at least one class with a state machine using Umple syntax (state/status/sm/flow are acceptable if valid).":H==="classdiagram"?"- Include classes/attributes and associations if implied by the requirements.":""}function M(H,I="initial"){const v=(H||[]).join(", ");return I==="repair"&&!v?"- If requirement IDs are provided, include implementsReq for them.":`- You ${I==="repair"?"need to":"MUST"} include implementsReq for: ${v} (on the generated class(es) and/or association/sm as appropriate).`}function _(){return["- Output ONLY Umple code.",'- Output EXACTLY ONE fenced code block with language "umple":',"  ```umple","  ...","  ```","- No prose before or after the code block."]}function T(){return["- Do NOT re-output any req { ... } blocks.","- Do NOT re-output the user's existing model; output ONLY the new model elements to insert.","- Do NOT output position blocks, diagram layout, or @@@skip* directives unless explicitly requested.","- If you must assume something, add a single-line comment inside the code: // Assumption: ..."]}function P({generationType:H,expectedRequirementIds:I}){return[..._(),M(I,"initial"),C(H),...T()].filter(Boolean).join(`
`)}function k({generationType:H,expectedRequirementIds:I}){return[..._(),M(I,"repair"),C(H),"- Do NOT re-output any req { ... } blocks.","- Do NOT repeat the user's existing code; output ONLY the corrected generated block.","- Do NOT change or reference line-numbered edits in the user's original code; fix only the generated block.","- If you must assume something, add a single-line comment inside the code: // Assumption: ..."].filter(Boolean).join(`
`)}function U(H){const I=String(H||"");if(!I.trim())return["Response is empty"];const v=typeof AiTextUtils<"u"&&AiTextUtils.parseCodeBlocks?AiTextUtils.parseCodeBlocks(I):[],L=v.length>0?v:[],O=[];if(L.length!==1)O.push(`Expected exactly one fenced code block, found ${L.length}.`);else{const V=L[0].language;(!V||V!=="umple")&&O.push(`Code block language must be "umple" (found "${V||"none"}").`)}return I.replace(/```[\s\S]*?```/g,"").trim()&&O.push("Response contains text outside the code block."),O}function N(H){const I=(H.match(/\{/g)||[]).length,v=(H.match(/\}/g)||[]).length;return I===v}function R(H,I){const v=(I||[]).filter(Boolean);if(v.length===0)return[];const L=[],O=H.split(`
`).filter(z=>z.includes("implementsReq"));return v.forEach(z=>{const V=new RegExp(`\\b${z.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}\\b`);O.some(W=>V.test(W))||L.push(`Missing implementsReq for requirement ${z}`)}),L}function B(H,I){const v=[];return/\b(class|association)\b/.test(H)||v.push("No class or association definition found"),I==="statemachine"&&(/\b(sm|state|status|flow)\s*\{/.test(H)||v.push("No state machine block found (expected state/status/sm/flow)")),v}return{preloadGuidance(H){return h(H)},preloadRepairGuidance(H){return b(H)},validateGeneratedUmple({code:H,expectedRequirementIds:I=[],generationType:v}={}){const L=[],O=(H||"").trim();return O?(N(O)||L.push("Unbalanced braces in generated code"),L.push(...B(O,v)),L.push(...R(O,I)),{valid:L.length===0,errors:L}):{valid:!1,errors:["Generated code is empty"]}},validateResponseFormat(H){return U(H)},getValidationAsCompilerErrors({code:H,expectedRequirementIds:I=[],generationType:v}={}){const L=this.validateGeneratedUmple({code:H,expectedRequirementIds:I,generationType:v});return L.valid?[]:L.errors.map(O=>({severity:"Error",errorCode:"VALIDATION_ERROR",message:O,line:1,isPseudoError:!0}))},buildGeneration(H,I){const v=(H||[]).map(z=>z.id).filter(Boolean),L=E(H);return{prompt:n([t("task",p(I)),t("requirements",L,{allowEmpty:!0}),t("how_to_use_requirements_in_umple",s("requirements"),{allowEmpty:!0}),t("output_contract",P({generationType:I,expectedRequirementIds:v}))]),systemPrompt:S(I,v),expectedRequirementIds:v}},repair_buildGeneration({generationType:H,requirements:I,originalCode:v,invalidBlock:L,compilerIssuesText:O}={}){const z=(I||[]).map(le=>le.id).filter(Boolean),V=E(I),Z=(v||"").trim(),W=Z.length>8e3?`${Z.slice(0,8e3)}

// Assumption: Original model truncated for prompt size.`:Z,ie=(O||"").trim(),oe=ie?`Errors (compiler and validation) with code snippets:
${ie}`:"- (No details provided)";return{prompt:n([t("task",`You are debugging Umple code. Follow this workflow:

1. Read the current_generated_block_to_fix
2. Read the compiler_issues_errors_warnings
3. Read the troubleshooting information
4. Read the requirements and output_contract
5. Generate corrected block that satisfies all constraints`),t("compiler_issues_errors_warnings",oe),t("current_generated_block_to_fix",`\`\`\`umple
${(L||"").trim()}
\`\`\``),t("original_model_read_only_context",`\`\`\`umple
${W}
\`\`\``),t("requirements",V,{allowEmpty:!0}),t("output_contract",k({generationType:H,expectedRequirementIds:z}))]),systemPrompt:D(H),expectedRequirementIds:z}}}})(),RequirementsDialog={getRequirementsOutputArea(){return document.getElementById("requirementsOutputArea")},clearRequirementsOutput(){const e=this.getRequirementsOutputArea();e&&(e.value="")},appendRequirementsOutput(e){const t=this.getRequirementsOutputArea();if(!t)return;const n=String(e||"");t.value=t.value?`${t.value}
${n}`:n,t.scrollTop=t.scrollHeight},setStatusMessage(e,t,n,r="#3383bb"){if(e)if(e.style.display="block",e.style.color=r,e.textContent="",t){const o=document.createElement("span");o.className="ai-status-label",o.textContent=t,e.appendChild(o),e.appendChild(document.createTextNode(` ${n}`))}else e.textContent=n},createSingleRequirementUI(e){const t=document.createElement("div");t.className="requirement-selection";const n=document.createElement("h4");n.textContent="Requirement:",t.appendChild(n);const r=document.createElement("div");r.className="requirement-display";const o=document.createElement("strong");o.textContent=e.id,r.appendChild(o);const a=document.createElement("div");return a.className="requirement-text",a.textContent=e.text,r.appendChild(a),t.appendChild(r),t},createMultipleRequirementUI(e){const t=document.createElement("div");t.className="requirement-selection";const n=document.createElement("h4");n.textContent="Select Requirements:",t.appendChild(n);const r=document.createElement("div");r.className="requirement-mode";const o=document.createElement("label"),a=document.createElement("input");a.type="radio",a.name="reqMode",a.value="all",a.checked=!0,o.appendChild(a),o.appendChild(document.createTextNode(" All Requirements (recommended for comprehensive generation)")),r.appendChild(o);const s=document.createElement("label"),c=document.createElement("input");c.type="radio",c.name="reqMode",c.value="multiple",s.appendChild(c),s.appendChild(document.createTextNode(" Select Specific Requirements")),r.appendChild(s),t.appendChild(r);const d=document.createElement("div");d.id="multipleReqSelection",d.className="multiple-req-selection",d.style.display="none",e.forEach(h=>{const b=document.createElement("label");b.className="requirement-checkbox";const E=document.createElement("input");E.type="checkbox",E.value=h.id,E.className="req-checkbox",b.appendChild(E);const S=document.createElement("span");S.className="requirement-summary";const D=document.createElement("strong");D.textContent=h.id,S.appendChild(D);const j=h.text.substring(0,100)+(h.text.length>100?"...":"");S.appendChild(document.createTextNode(`: ${j}`)),b.appendChild(S),d.appendChild(b)}),t.appendChild(d);const u=document.createElement("div");u.id="selectedReqDisplay",u.className="selected-req-display";const f=document.createElement("strong");f.textContent="Selected Requirements:",u.appendChild(f);const g=document.createElement("div");return g.id="selectedReqText",g.textContent=`All requirements (${e.length})`,u.appendChild(g),t.appendChild(u),t},updateSelectedDisplay(e,t){const n=document.getElementById("selectedReqText"),r=e.querySelectorAll(".req-checkbox:checked"),o=Array.from(r).map(a=>a.value);if(o.length===0)n.textContent="No requirements selected";else{const a=t.filter(s=>o.includes(s.id));n.textContent=a.map(s=>`${s.id}: ${s.text}`).join(`

`)}},getSelectedRequirements(e,t){if((e.querySelector('input[name="reqMode"]:checked')?.value||"all")==="all")return t;{const r=e.querySelectorAll(".req-checkbox:checked"),o=Array.from(r).map(a=>a.value);return t.filter(a=>o.includes(a.id))}},createDialog(e){const t=document.getElementById("aiRequirementsDialog");t&&t.remove();const n=document.createElement("div");n.id="aiRequirementsDialog",n.className="ai-requirements-dialog";const r=document.createElement("div");r.className="dialog-overlay",n.appendChild(r);const o=document.createElement("div");o.className="dialog-content";const a=document.createElement("h3");a.textContent="Generate from Requirements",o.appendChild(a);const s=e.length===1?this.createSingleRequirementUI(e[0]):this.createMultipleRequirementUI(e);o.appendChild(s);const c=document.createElement("div");c.className="generation-type";const d=document.createElement("h4");d.textContent="Select Generation Type:",c.appendChild(d);const u=document.createElement("label"),f=document.createElement("input");f.type="radio",f.name="genType",f.value="statemachine",f.checked=!0,u.appendChild(f),u.appendChild(document.createTextNode(" State Machine")),c.appendChild(u);const g=document.createElement("label"),h=document.createElement("input");h.type="radio",h.name="genType",h.value="classdiagram",g.appendChild(h),g.appendChild(document.createTextNode(" Class Diagram")),c.appendChild(g),o.appendChild(c);const b=document.createElement("div");b.id="generatedCodeContainer",b.style.display="none";const E=document.createElement("h4");E.textContent="Generated Umple Code:",b.appendChild(E);const S=document.createElement("textarea");S.id="generatedCodeArea",S.readOnly=!0,b.appendChild(S),o.appendChild(b);const D=document.createElement("div");D.id="requirementsOutputContainer",D.style.display="none";const j=document.createElement("h4");j.textContent="Log:",D.appendChild(j);const p=document.createElement("textarea");p.id="requirementsOutputArea",p.readOnly=!0,D.appendChild(p),o.appendChild(D);const C=document.createElement("div");C.className="dialog-buttons";const M=document.createElement("div");M.id="btnGenerate",M.className="jQuery-palette-button unselectable ui-button ui-corner-all ui-widget",M.tabIndex=0,M.setAttribute("role","button"),M.textContent="Generate",C.appendChild(M);const _=document.createElement("div");_.id="btnStop",_.className="jQuery-palette-button unselectable ui-button ui-corner-all ui-widget",_.tabIndex=0,_.setAttribute("role","button"),_.style.display="none",_.textContent="Stop",C.appendChild(_);const T=document.createElement("div");T.id="btnInsert",T.className="jQuery-palette-button unselectable ui-button ui-corner-all ui-widget",T.tabIndex=0,T.setAttribute("role","button"),T.style.display="none",T.textContent="Insert to Editor",C.appendChild(T);const P=document.createElement("div");P.id="btnCancel",P.className="jQuery-palette-button unselectable ui-button ui-corner-all ui-widget",P.tabIndex=0,P.setAttribute("role","button"),P.textContent="Cancel",C.appendChild(P);const k=document.createElement("div");return k.id="statusMessage",k.className="status-message",k.style.display="none",o.appendChild(k),o.appendChild(C),n.appendChild(o),document.body.appendChild(n),n},setupDialogEvents(e,t,n){e.querySelectorAll('input[name="reqMode"]').forEach(E=>{E.addEventListener("change",S=>{const D=S.target.value,j=document.getElementById("multipleReqSelection"),p=document.getElementById("selectedReqText");D==="all"?(j.style.display="none",p.textContent=`All requirements (${t.length})`):D==="multiple"&&(j.style.display="block",this.updateSelectedDisplay(e,t))})}),e.querySelectorAll(".req-checkbox").forEach(E=>{E.addEventListener("change",()=>{this.updateSelectedDisplay(e,t)})});const a=document.getElementById("btnGenerate"),s=E=>{E.preventDefault(),n.onGenerate&&n.onGenerate()};a.addEventListener("click",s),a.addEventListener("keypress",E=>{(E.key==="Enter"||E.key===" ")&&s(E)});const c=document.getElementById("btnStop"),d=E=>{E.preventDefault(),n.onStop&&n.onStop()};c.addEventListener("click",d),c.addEventListener("keypress",E=>{(E.key==="Enter"||E.key===" ")&&d(E)});const u=document.getElementById("btnInsert"),f=E=>{E.preventDefault(),n.onInsert&&n.onInsert()};u.addEventListener("click",f),u.addEventListener("keypress",E=>{(E.key==="Enter"||E.key===" ")&&f(E)});const g=document.getElementById("btnCancel"),h=E=>{E.preventDefault(),n.onCancel&&n.onCancel()};g.addEventListener("click",h),g.addEventListener("keypress",E=>{(E.key==="Enter"||E.key===" ")&&h(E)}),e.querySelector(".dialog-overlay").addEventListener("click",()=>{n.onCancel&&n.onCancel()})}},RequirementsSelfCorrection={getInsertionPos(e){const t=typeof Page<"u"&&Page.modelDelimiter?Page.modelDelimiter:null,n=t?e.indexOf(t):-1,r=n>=0?n:e.length,o=e.slice(0,r),a=/req\s+(\w+(?:[-_]\w+)*)\s*\{[^}]*\}/gs;let s=-1,c;for(;(c=a.exec(o))!==null;)s=c.index+c[0].length;return s>=0?s:r},buildMergedCode(e,t){const n=this.getInsertionPos(e),r=String(t||"").trim(),o=AiTextUtils.computePrefix(e,n),a=AiTextUtils.computeSuffix(e,n),s=o+r+a,c=e.slice(0,n)+s+e.slice(n),d=n+o.length,u=d+r.length;return{insertPos:n,insertText:s,mergedText:c,highlightFrom:d,highlightTo:u,codeText:r}},async run({originalCode:e,generatedBlock:t,requirements:n,generationType:r,systemPrompt:o,expectedRequirementIds:a,log:s=null,setStatus:c=null,shouldStop:d=null,setActiveStream:u=null,onRepairTextReset:f=null,onRepairTextUpdate:g=null,onStreamDelta:h}={}){const b=typeof s=="function"?s:()=>{},E=typeof c=="function"?c:()=>{},S=typeof d=="function"?d:()=>!1,D=typeof u=="function"?u:()=>{},j=typeof f=="function"?f:()=>{},p=typeof g=="function"?g:()=>{},C=AiCompilerService.getSelfCorrectionMaxPasses();let M=String(t||"").trim();if(!M)return{block:M};let _=null;try{_=await AiCompilerService.compileUmpleWithServer(e),_.issues.length>0?(b("Baseline compile: the original model already has issues:"),b(AiCompilerService.formatIssuesForLog(_.issues))):b("Baseline compile: no issues in original model.")}catch(N){b(`Baseline compile failed: ${N.message}`)}const T=new Set,P=String(M||"").trim();P&&T.add(P);let k=null,U=0;if(typeof RequirementsPromptBuilder<"u"&&RequirementsPromptBuilder.preloadRepairGuidance)try{await RequirementsPromptBuilder.preloadRepairGuidance(r)}catch(N){b(`Repair guidance preload failed (continuing anyway): ${N.message}`)}for(let N=1;N<=C;N++){if(S()){b(`
Self-correction stopped by user at pass ${N}.`);break}E("Compiler",`Self-correction pass ${N}/${C}: compiling...`),b(`
Self-correction pass ${N}: compiling merged model...`);const R=this.buildMergedCode(e,M),B=AiTextUtils.computeLineNumberAtIndex(R.mergedText,R.highlightFrom),H=AiTextUtils.computeLineNumberAtIndex(R.mergedText,R.highlightTo),I=R.mergedText;let v;try{v=await AiCompilerService.compileUmpleWithServer(I)}catch(ne){b(`Compile failed: ${ne.message}`);break}const L=v.issues||[];if(typeof RequirementsPromptBuilder<"u"&&RequirementsPromptBuilder.getValidationAsCompilerErrors){const ne=RequirementsPromptBuilder.getValidationAsCompilerErrors({code:M,expectedRequirementIds:a||[],generationType:r});ne.length>0&&(b(`Validation issues found: ${ne.map(F=>F.message).join(", ")}`),L.unshift(...ne))}const O=L.filter(ne=>ne.severity==="Error");if(O.length===0){const ne=L.filter(F=>F.severity==="Warning").length;return b(ne>0?`Compiler reports no errors (${ne} warning(s) ignored for self-correction).`:"Compiler reports no errors."),{block:M}}const z=_?.issues||[],V=z.length>0?new Set(z.map(ne=>AiCompilerService.getIssueKey(ne))):new Set,Z=V.size>0?O.filter(ne=>!V.has(AiCompilerService.getIssueKey(ne))):O;if(V.size>0&&b(`Baseline issues: ${z.length}`),V.size>0&&Z.length===0)return b("Only baseline errors remain; stopping self-correction."),{block:M};const W=Z.length>0?Z:O,ie=W.filter(ne=>Number.isFinite(ne.line)&&ne.line>=B&&ne.line<=H),oe=ie.length>0?ie:W,K=oe.map(ne=>AiCompilerService.getIssueKey(ne)).join("||");if(K&&K===k?U+=1:(U=0,k=K),U>=3){b("Compiler issues did not change after 3 repair attempts; stopping self-correction.");break}const le=O.filter(ne=>ne.errorCode==="VALIDATION_ERROR").length,he=O.length-le,pe=[];he>0&&pe.push(`${he} compiler`),le>0&&pe.push(`${le} validation`),b(`Found ${pe.join(" + ")} error(s) in merged model.`),ie.length>0?b(`Focusing on ${ie.length} issue(s) within the inserted block (lines ${B}-${H}).`):b("No issues were located within the inserted block line range; attempting to fix by adjusting the generated block anyway."),b(AiCompilerService.formatIssuesForLog(oe));const ye=oe.map(ne=>{const F=ne.errorCode?` (${ne.errorCode})`:"",G=Number.isFinite(ne.line)?ne.line:"?",Y=Number.isFinite(ne.line)&&ne.line>=B&&ne.line<=H?ne.line-B+1:null,ee=Number.isFinite(Y)?` (block line ${Y})`:"";let q=`- ${ne.severity}${F} on merged line ${G}${ee}: ${ne.message}`;if(Number.isFinite(ne.line)&&I){const X=AiTextUtils.getLinesAround(I,ne.line-1,2);X&&(q+=`
  snippet:
${X.split(`
`).map(re=>"  "+re).join(`
`)}`)}return q}).join(`
`),be=typeof RequirementsPromptBuilder<"u"&&RequirementsPromptBuilder.repair_buildGeneration?RequirementsPromptBuilder.repair_buildGeneration({generationType:r,requirements:n,originalCode:e,invalidBlock:M,compilerIssuesText:ye}):{prompt:`Fix the following Umple block so that it compiles with the original model without errors.

Original model:

\`\`\`umple
${e}
\`\`\`

Block to fix:

\`\`\`umple
${M}
\`\`\`

Compiler issues:
${ye}

Output ONLY the corrected block as a single \`\`\`umple\`\`\` code block.`,systemPrompt:o};E("LLM",`Repairing errors (compiler + validation) in block (pass ${N}/${C})...`),b("Asking AI to repair the generated block...");let ve;try{j("Repairing generated block...");const ne=AiStreamUtils.createBufferedTextRenderer({updateIntervalMs:40,onRender:G=>{p(G)}}),F=AiApi.chatStream(be.prompt,be.systemPrompt,{},{onDelta:G=>{ne.append(G),h&&h(G)}});if(D(F),ve=await F.done,ne.flush({force:!0}),D(null),S()){b(`
Self-correction stopped by user.`);break}}catch(ne){if(D(null),ne?.name==="AbortError"||S()){b(`
Self-correction stopped by user.`);break}b(`AI repair failed: ${ne.message}`);break}const we=String(AiTextUtils.extractUmpleCode(ve)||"").trim();if(!we){b("AI repair produced empty output; stopping.");break}if(we.trim()===String(M||"").trim()){b("AI repair repeated the current output; stopping.");break}if(T.has(we)){b("AI repair repeated an earlier output; stopping.");break}M=we,T.add(we),b("Retrying compile with repaired block...")}return b("Self-correction stopped before reaching a clean compile."),{block:M}}},AiRequirements={activeStream:null,parseRequirements(e){const t=[],n=/req\s+(\w+(?:[-_]\w+)*)\s*\{([^}]*)\}/gs;let r;for(;(r=n.exec(e))!==null;){const o=r[1].trim(),a=r[2].trim();o&&a&&t.push({id:o,text:a})}return t},abortActiveStream(){AiStreamUtils?.abort?.(this.activeStream),this.activeStream=null},checkApiConfig(){return AiConfigValidation.checkApiConfig({requireVerified:!0})},buildPrompt(e,t){if(typeof RequirementsPromptBuilder<"u"&&RequirementsPromptBuilder.buildGeneration)return RequirementsPromptBuilder.buildGeneration(e,t).prompt;const n=e.map(r=>`Requirement ${r.id}:
${r.text}`).join(`

`);return typeof AiPromptUtils<"u"&&AiPromptUtils.block&&AiPromptUtils.joinBlocks?AiPromptUtils.joinBlocks([AiPromptUtils.block("task","Generate ONLY Umple code based on the following requirement(s)."),AiPromptUtils.block("requirements",n,{allowEmpty:!0}),AiPromptUtils.block("output_contract",["- Output ONLY Umple code.",'- Output EXACTLY ONE fenced code block with language "umple":',"  ```umple","  ...","  ```","- No prose before or after the code block."].join(`
`))]):`Generate ONLY Umple code based on the following requirement(s).

Requirements:
${n}

Umple code:`},extractUmpleCode(e){return AiTextUtils.extractUmpleCode(e)},SYSTEM_PROMPT:(()=>{const e=typeof AiPrompting<"u"&&AiPrompting.getBaseSystemPrompt?AiPrompting.getBaseSystemPrompt():"You are an expert in Umple modeling language.",t="Your job is to generate ONLY valid Umple code.";return typeof AiPromptUtils<"u"&&AiPromptUtils.block&&AiPromptUtils.joinBlocks?AiPromptUtils.joinBlocks([AiPromptUtils.block("system",e,{allowEmpty:!0}),AiPromptUtils.block("directive",t)]):`${e}

${t}`})(),showDialog(){const e=Page.codeMirrorEditor6?.state.doc.toString()||"",t=this.parseRequirements(e);if(t.length===0){alert(`No requirements found in your Umple code.

See https://cruise.umple.org/umple/Requirements.html for more information.`);return}const n=this.checkApiConfig();if(!n.configured){typeof AiSettings<"u"&&AiSettings.showSettingsModal&&AiSettings.showSettingsModal(),alert(n.message);return}const r=RequirementsDialog.createDialog(t);RequirementsDialog.setupDialogEvents(r,t,{onGenerate:()=>this.handleGenerate(r,t),onStop:()=>this.handleStop(r),onInsert:()=>this.handleInsert(r),onCancel:()=>{this.abortActiveStream(),r.remove()}})},async handleGenerate(e,t){const n=document.getElementById("statusMessage"),r=document.getElementById("btnGenerate"),o=document.getElementById("btnStop"),a=document.getElementById("btnInsert"),s=document.getElementById("generatedCodeContainer"),c=document.getElementById("generatedCodeArea"),d=document.getElementById("requirementsOutputContainer"),u=RequirementsDialog.getSelectedRequirements(e,t);if(u.length===0){RequirementsDialog.setStatusMessage(n,"Error","Please select at least one requirement","#DD0033");return}const f=e.querySelector('input[name="genType"]:checked')?.value||"statemachine",g=this.checkApiConfig();if(!g.configured){RequirementsDialog.setStatusMessage(n,"Error",g.message,"#DD0033");return}r.classList.add("disabled"),r.textContent="Generating...",o.style.display="inline-block",RequirementsDialog.setStatusMessage(n,"LLM","Generating Umple code from requirements..."),d&&(d.style.display="block"),RequirementsDialog.clearRequirementsOutput(),RequirementsDialog.appendRequirementsOutput(`Generation type: ${f}`),e.generationContext={selectedReqs:u,genType:f,generation:null,umpleCode:""};let h=!1;try{if(typeof RequirementsPromptBuilder<"u"&&RequirementsPromptBuilder.preloadGuidance){const p=f==="classdiagram"?"class diagrams":"state machines";RequirementsDialog.appendRequirementsOutput(`Reading guidance on requirements and ${p}...`),await RequirementsPromptBuilder.preloadGuidance(f)}const b=typeof RequirementsPromptBuilder<"u"&&RequirementsPromptBuilder.buildGeneration?RequirementsPromptBuilder.buildGeneration(u,f):{prompt:this.buildPrompt(u,f),systemPrompt:this.SYSTEM_PROMPT,expectedRequirementIds:u.map(p=>p.id)};e.generationContext.generation=b,RequirementsDialog.setStatusMessage(n,"LLM",`Generating ${f==="classdiagram"?"class diagram":"state machine"}...`),RequirementsDialog.appendRequirementsOutput(`Generating ${f==="classdiagram"?"class diagram":"state machine"}...`),c.value="",s.style.display="block",a.style.display="none";const E=AiStreamUtils.createBufferedTextRenderer({updateIntervalMs:40,onRender:p=>{c.value=p,c.scrollTop=c.scrollHeight}});this.activeStream=AiApi.chatStream(b.prompt,b.systemPrompt,{},{onDelta:p=>{E.append(p)},onTruncated:()=>{h=!0}});const S=await this.activeStream.done;if(this.activeStream=null,E.flush({force:!0}),RequirementsDialog.appendRequirementsOutput("Generated initial Umple block from AI."),h){e.stopped=!0,RequirementsDialog.setStatusMessage(n,"LLM","Generation stopped: AI output was truncated due to token limit. Try selecting fewer requirements, shortening requirement text, or using a larger model.","#DD0033"),c.value=S||"",s.style.display="block",a.style.display=S&&S.trim()?"inline-block":"none";return}let D=S||"";if(typeof RequirementsPromptBuilder<"u"&&RequirementsPromptBuilder.validateResponseFormat){const p=RequirementsPromptBuilder.validateResponseFormat(D);if(p.length>0&&!e.stopped){RequirementsDialog.appendRequirementsOutput(`Output contract violations: ${p.join("; ")}`),RequirementsDialog.setStatusMessage(n,"LLM","Repairing output format..."),RequirementsDialog.appendRequirementsOutput("Attempting format-only repair..."),c.value="",c.placeholder="Repairing output format...",s.style.display="block";const C=Page.codeMirrorEditor6?.state.doc.toString()||"",M=this.extractUmpleCode(D),_=p.map(U=>`- Validation Error: ${U}`).join(`
`),T=typeof RequirementsPromptBuilder<"u"&&RequirementsPromptBuilder.repair_buildGeneration?RequirementsPromptBuilder.repair_buildGeneration({generationType:f,requirements:u,originalCode:C,invalidBlock:M,compilerIssuesText:_}):{prompt:`Fix the output format: ${_}

Output ONLY a single \`\`\`umple\`\`\` code block with valid Umple code.`,systemPrompt:b.systemPrompt},P=AiStreamUtils.createBufferedTextRenderer({updateIntervalMs:40,onRender:U=>{c.value=U,c.scrollTop=c.scrollHeight}});this.activeStream=AiApi.chatStream(T.prompt,T.systemPrompt,{},{onDelta:U=>{P.append(U)}}),D=await this.activeStream.done,this.activeStream=null,P.flush({force:!0}),RequirementsDialog.appendRequirementsOutput("Output format repair completed.");const k=RequirementsPromptBuilder.validateResponseFormat(D);k.length>0&&RequirementsDialog.appendRequirementsOutput(`Output contract still violated: ${k.join("; ")}`)}}e.generationContext.umpleCode=this.extractUmpleCode(D);let j=e.generationContext.umpleCode;if(!e.stopped){RequirementsDialog.setStatusMessage(n,"Compiler","Running self-correction (compiler + validation)..."),RequirementsDialog.appendRequirementsOutput("Running self-correction (compiler + validation)..."),c.value="",c.placeholder="Self-correction in progress...";const p=Page.codeMirrorEditor6?.state.doc.toString()||"";try{const C=await RequirementsSelfCorrection.run({originalCode:p,generatedBlock:j,requirements:u,generationType:f,systemPrompt:b.systemPrompt,expectedRequirementIds:b.expectedRequirementIds,log:M=>RequirementsDialog.appendRequirementsOutput(M),setStatus:(M,_,T)=>RequirementsDialog.setStatusMessage(n,M,_,T),shouldStop:()=>!!e.stopped,setActiveStream:M=>{this.activeStream=M},onRepairTextReset:M=>{c.value="",c.placeholder=M||""},onRepairTextUpdate:M=>{c.value=M,c.scrollTop=c.scrollHeight}});C&&typeof C.block=="string"&&C.block.trim()&&(j=C.block.trim(),e.generationContext.umpleCode=j)}catch(C){RequirementsDialog.appendRequirementsOutput(`Self-correction failed: ${C.message}`)}}if(c.placeholder="",c.value=j,s.style.display="block",a.style.display="inline-block",n.style.color!=="#DD0033"){const p=e.stopped?"Generation stopped. Partial code generated! Review and click 'Insert to Editor' to add it to your model.":"Code generated successfully! Review and click 'Insert to Editor' to add it to your model.";RequirementsDialog.setStatusMessage(n,"LLM",p)}}catch(b){if(b?.name==="AbortError"){RequirementsDialog.appendRequirementsOutput(`
Generation stopped by user.`);return}console.error("Error generating code:",b),RequirementsDialog.setStatusMessage(n,"Error",`Error: ${b.message}`,"#DD0033")}finally{r.classList.remove("disabled"),r.textContent="Generate",o.style.display="none",e.stopped=!1,e.generationContext=null}},async handleStop(e){const t=document.getElementById("statusMessage"),n=document.getElementById("btnGenerate"),r=document.getElementById("btnStop"),o=document.getElementById("btnInsert"),a=document.getElementById("generatedCodeContainer"),s=document.getElementById("generatedCodeArea");e.stopped=!0,this.abortActiveStream(),RequirementsDialog.setStatusMessage(t,"LLM","Stopping generation...");try{const c=e.generationContext;if(!c){RequirementsDialog.setStatusMessage(t,"LLM","No generation in progress.","#DD0033");return}let d=c.umpleCode||"";const u=s?.value||"";if(!d.trim()&&u.trim()){const f=this.extractUmpleCode(u);d=f&&f.trim()?f:u}d.trim()?(RequirementsDialog.appendRequirementsOutput("Applying partial generated code..."),s.value=d,a.style.display="block",o.style.display="inline-block",RequirementsDialog.setStatusMessage(t,"LLM","Generation stopped. Partial code generated! Review and click 'Insert to Editor' to add it to your model.")):RequirementsDialog.setStatusMessage(t,"LLM","Generation stopped before any code was generated.","#DD0033")}catch(c){console.error("Error stopping generation:",c),RequirementsDialog.setStatusMessage(t,"Error",`Error stopping: ${c.message}`,"#DD0033")}finally{n.classList.remove("disabled"),n.textContent="Generate",r.style.display="none",e.generationContext=null}},handleInsert(e){const n=document.getElementById("generatedCodeArea").value;if(n){if(!Page.codeMirrorEditor6){alert("Editor not initialized");return}const r=e?.querySelector('input[name="genType"]:checked')?.value||"statemachine",o=Page.codeMirrorEditor6.state.doc.toString(),a=RequirementsSelfCorrection.buildMergedCode(o,n),s=3e3;Page.codeMirrorEditor6.dispatch({changes:{from:a.insertPos,to:a.insertPos,insert:a.insertText},selection:a.highlightTo>a.highlightFrom?{anchor:a.highlightFrom,head:a.highlightTo}:{anchor:a.insertPos+a.insertText.length},scrollIntoView:!0}),Page.codeMirrorEditor6.focus();const c=Page.codeMirrorEditor6.state.doc.toString();TabControl.getCurrentHistory().save(c,"aiGeneration"),typeof Action<"u"&&typeof Action.changeDiagramType=="function"&&(r==="statemachine"?Action.changeDiagramType({type:"GvState"}):r==="classdiagram"&&Action.changeDiagramType({type:"GvClass"})),setTimeout(()=>{const d=Page.codeMirrorEditor6;if(!d)return;const u=d.state.selection.main;u.from===a.highlightFrom&&u.to===a.highlightTo&&d.dispatch({selection:{anchor:a.highlightFrom}})},s),e.remove()}}},ExplainPromptBuilder=(()=>{"use strict";const e=typeof AiPromptUtils<"u"?AiPromptUtils:null,t=(d,u,f)=>e&&e.block?e.block(d,u,f):String(u||"").trim(),n=(d,u)=>e&&e.joinBlocks?e.joinBlocks(d,u):(d||[]).filter(Boolean).join(`

`),r=typeof AiMarkdownUtils<"u"?AiMarkdownUtils:null,o=50,a=(()=>{const d=typeof AiPrompting<"u"&&AiPrompting.getBaseSystemPrompt?AiPrompting.getBaseSystemPrompt():"You are an expert in Umple (https://cruise.umple.org/umple/): its textual modeling syntax, class/state-machine/traits/aspects, associations & multiplicities, constraints, generation targets (Java/PHP/\u2026 as supported by Umple), and common Umple patterns.";return n([t("system",d,{allowEmpty:!0}),t("directive","Your job is to explain any Umple snippet (or mixed Umple + generated code) clearly and accurately."),t("goals",["- Preserve correctness: be precise and accurate, do not invent features"]),t("rules",["- Your audience are familiar with modeling and have basic coding background","- Be precise and accurate in your explanations","- Do not assume missing context","- Keep output concise but complete","- Use markdown syntax (level 2 headings `##` for all section titles)","- Only summary-style content should have bullet points; avoid bullet points in most cases"])])})(),s=n([t("task","Explain the following Umple code."),t("response_structure_follow_strictly",["1. ## Summary: A one-sentence summary of what the snippet models/does","2. ## Walkthrough: Explain the Umple code in plain language, and provide a high-level workflow explanation.","3. Use level 2 headings (`## Title`) for all section titles in your response"]),t("code_to_explain","```umple\n{{code}}\n```"),t("your_response","Provide your explanation following the structure above.")]),c=n([t("conversation_history","{{conversationHistory}}",{allowEmpty:!0}),t("user_question","{{userQuestion}}"),t("instructions",["Answer based on the original Umple code and previous explanation. Be precise and accurate. Reference specific code elements."])]);return{getSystemPrompt(){return a},buildInitialPrompt(d){return s.replace(/\{\{code\}\}/g,d)},buildFollowUpPrompt(d,u){const f=this.formatConversationHistory(d);return c.replace(/\{\{conversationHistory\}\}/g,f).replace(/\{\{userQuestion\}\}/g,u)},formatExplanation(d){return r&&typeof r.render=="function"?r.render(d):d||""},validateExplanation(d){const u=this.collectValidationErrors(d);return{valid:u.length===0,errors:u}},formatConversationHistory(d){return d.map(u=>`${u.role}: ${u.content}`).join(`

`)},collectValidationErrors(d){const u=[];return!d||d.trim().length===0?(u.push("Explanation is empty"),u):(d.length<o&&u.push("Explanation seems too short to be useful"),u)}}})(),AiExplain={conversationHistory:[],activeStream:null,thinkingInterval:null,isMinimized:!1,checkApiConfig(){return AiConfigValidation.checkApiConfig({requireVerified:!0})},resetConversation(){this.conversationHistory=[],this.updateExplainButtonIndicator()},hasOngoingConversation(){return this.conversationHistory.length>0},updateExplainButtonIndicator(){const e=document.getElementById("buttonExplain");if(!e)return;let t=document.getElementById("explainButtonIndicator");this.hasOngoingConversation()?t||(t=document.createElement("span"),t.id="explainButtonIndicator",t.className="explain-button-indicator",t.textContent="\u25CF",t.title="Ongoing conversation",e.appendChild(t)):t&&t.remove()},abortActiveStream(){AiStreamUtils?.abort?.(this.activeStream),this.activeStream=null,this.stopThinkingAnimation()},startThinkingAnimation(e){if(!e)return;this.stopThinkingAnimation();let t=0;const n=()=>{t=t%3+1,e.textContent="thinking"+".".repeat(t)};n(),this.thinkingInterval=setInterval(n,500)},stopThinkingAnimation(){this.thinkingInterval&&(clearInterval(this.thinkingInterval),this.thinkingInterval=null)},addToHistory(e,t){this.conversationHistory.push({role:e,content:t}),this.conversationHistory.length>10&&(this.conversationHistory=this.conversationHistory.slice(-10)),this.updateExplainButtonIndicator()},async showDialog(){const e=document.getElementById("aiExplainDialog");if(e&&this.isMinimized){this.restoreDialog();return}if(e&&!this.isMinimized)return;const t=Page.codeMirrorEditor6?.state.doc.toString()||"";if(!t.trim()){alert("No code in the editor to explain. Please enter some Umple code first.");return}const n=this.checkApiConfig();if(!n.configured){typeof AiSettings<"u"&&AiSettings.showSettingsModal&&AiSettings.showSettingsModal(),alert(n.message);return}this.createDialog(),this.hasOngoingConversation()||this.resetConversation(),await this.performExplanation(t)},createDialog(){const e=document.getElementById("aiExplainDialog");e&&e.remove();const t=document.createElement("div");t.id="aiExplainDialog",t.className="ai-explain-dialog";const n=document.createElement("div");n.className="dialog-overlay",t.appendChild(n);const r=document.createElement("div");r.className="dialog-content";const o=document.createElement("div");o.className="ai-explain-header";const a=document.createElement("h3");a.textContent="Explain Code",o.appendChild(a);const s=document.createElement("button");s.id="btnMinimizeExplain",s.className="ai-explain-minimize-btn",s.innerHTML="&#8211;",s.setAttribute("aria-label","Minimize dialog"),o.appendChild(s);const c=document.createElement("span");c.className="ai-explain-tooltip",c.textContent="Minimize (conversation will be saved)",s.appendChild(c),r.appendChild(o);const d=document.createElement("div");d.id="explainStatusMessage",d.className="status-message",d.textContent="",r.appendChild(d);const u=document.createElement("div");u.id="explanationContainer",u.className="explanation-container";const f=document.createElement("div");f.id="explanationText",f.className="explanation-text",u.appendChild(f),r.appendChild(u);const g=document.createElement("div");g.id="followUpContainer",g.className="followup-container",g.style.display="none";const h=document.createElement("input");h.type="text",h.id="followUpInput",h.className="followup-input",h.placeholder="Ask a follow-up question...",g.appendChild(h),r.appendChild(g);const b=document.createElement("div");b.className="dialog-buttons";const E=document.createElement("div");E.id="btnNewConversation",E.className="jQuery-palette-button unselectable ui-button ui-corner-all ui-widget",E.tabIndex=0,E.setAttribute("role","button"),E.style.display="none",E.textContent="New Conversation",b.appendChild(E);const S=document.createElement("div");S.id="btnAsk",S.className="jQuery-palette-button unselectable ui-button ui-corner-all ui-widget",S.tabIndex=0,S.setAttribute("role","button"),S.style.display="none",S.textContent="Ask",b.appendChild(S);const D=document.createElement("div");D.id="btnCancel",D.className="jQuery-palette-button unselectable ui-button ui-corner-all ui-widget",D.tabIndex=0,D.setAttribute("role","button"),D.textContent="Close",b.appendChild(D),r.appendChild(b),t.appendChild(r),document.body.appendChild(t),this.setupDialogEvents(t)},minimizeDialog(){const e=document.getElementById("aiExplainDialog");e&&(this.isMinimized=!0,e.style.display="none",typeof AiController<"u"&&AiController.updateStatus&&AiController.updateStatus("Explanation minimized. Click Explain to resume."))},restoreDialog(){const e=document.getElementById("aiExplainDialog");if(!e)return;e.style.display="",this.isMinimized=!1;const t=document.getElementById("followUpContainer"),n=document.getElementById("followUpInput");n&&t&&t.style.display!=="none"&&n.focus()},setupDialogEvents(e){const t=document.getElementById("btnMinimizeExplain");if(t&&!t.dataset.aiEventsBound){t.dataset.aiEventsBound="true";const c=d=>{d.preventDefault(),this.minimizeDialog()};t.addEventListener("click",c)}const n=document.getElementById("btnAsk");if(n&&!n.dataset.aiEventsBound){n.dataset.aiEventsBound="true";const c=d=>{d.preventDefault(),this.handleFollowUp(e)};n.addEventListener("click",c),n.addEventListener("keydown",d=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),c(d))})}const r=document.getElementById("followUpInput");r&&!r.dataset.aiEventsBound&&(r.dataset.aiEventsBound="true",r.addEventListener("keypress",c=>{c.key==="Enter"&&(c.preventDefault(),this.handleFollowUp(e))}));const o=document.getElementById("btnNewConversation");if(o&&!o.dataset.aiEventsBound){o.dataset.aiEventsBound="true";const c=d=>{d.preventDefault(),this.abortActiveStream(),this.isMinimized=!1,this.resetConversation(),e.remove(),this.showDialog()};o.addEventListener("click",c),o.addEventListener("keydown",d=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),c(d))})}const a=document.getElementById("btnCancel");if(a&&!a.dataset.aiEventsBound){a.dataset.aiEventsBound="true";const c=d=>{d.preventDefault(),this.abortActiveStream(),this.isMinimized=!1,this.resetConversation(),e.remove()};a.addEventListener("click",c),a.addEventListener("keydown",d=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),c(d))})}const s=e.querySelector(".dialog-overlay");s&&!s.dataset.aiEventsBound&&(s.dataset.aiEventsBound="true",s.addEventListener("click",()=>{this.abortActiveStream(),this.isMinimized=!1,this.resetConversation(),e.remove()}))},async performExplanation(e){const t=document.getElementById("explainStatusMessage"),n=document.getElementById("explanationContainer"),r=document.getElementById("explanationText"),o=document.getElementById("followUpContainer"),a=document.getElementById("btnAsk"),s=document.getElementById("btnNewConversation"),c=document.getElementById("followUpInput");t.textContent="Analyzing your code...",t.className="status-message ai-status--info",this.abortActiveStream(),r.textContent="",this.startThinkingAnimation(r);const d=AiStreamUtils.createBufferedTextRenderer({onFirstChunk:()=>this.stopThinkingAnimation(),onRender:u=>{r&&(r.innerHTML=ExplainPromptBuilder.formatExplanation(u))},updateIntervalMs:120});try{const u=ExplainPromptBuilder.buildInitialPrompt(e),f=ExplainPromptBuilder.getSystemPrompt();this.activeStream=AiApi.chatStream(u,f,{},{onDelta:b=>{d.append(b)}});const g=await this.activeStream.done;this.activeStream=null,this.stopThinkingAnimation(),d.clearTimer();const h=ExplainPromptBuilder.validateExplanation(g);h.valid||console.warn("Explanation validation warnings:",h.errors),this.addToHistory("assistant",g),r.innerHTML=ExplainPromptBuilder.formatExplanation(g),o.style.display="block",c.style.display="block",a.style.display="inline-block",s.style.display="inline-block",t.textContent="",t.className="status-message",c.focus()}catch(u){if(u?.name==="AbortError"){this.stopThinkingAnimation(),d.hasContent()||(r.textContent="stopped");return}this.stopThinkingAnimation(),d.hasContent()||(r.textContent=""),console.error("Error explaining code:",u),t.textContent=`Error: ${u.message}`,t.className="status-message ai-status--error"}finally{d.flush()}},async handleFollowUp(e){const t=document.getElementById("explainStatusMessage"),n=document.getElementById("btnAsk"),r=document.getElementById("followUpInput"),o=document.getElementById("explanationText"),a=r.value.trim();if(!a){t.textContent="Please enter a question",t.className="status-message ai-status--error";return}n.classList.add("disabled"),n.textContent="Asking...",r.disabled=!0,t.textContent="Getting answer...",t.className="status-message ai-status--info",this.abortActiveStream();let s=null,c=null;try{this.addToHistory("user",a);const d=ExplainPromptBuilder.buildFollowUpPrompt(this.conversationHistory,a),u=ExplainPromptBuilder.getSystemPrompt(),f=document.createElement("div");f.className="followup-qa";const g=document.createElement("div");g.className="followup-question";const h=document.createElement("strong");h.textContent="You:",g.appendChild(h),g.appendChild(document.createTextNode(` ${a}`));const b=document.createElement("div");b.className="followup-answer";const E=document.createElement("div");E.className="followup-answer-content",E.textContent="",c=E,b.appendChild(E),s=AiStreamUtils.createBufferedTextRenderer({onFirstChunk:()=>this.stopThinkingAnimation(),onRender:D=>{E&&(E.innerHTML=ExplainPromptBuilder.formatExplanation(D),o&&(o.scrollTop=o.scrollHeight))},updateIntervalMs:120}),f.appendChild(g),f.appendChild(b),o.appendChild(f),o.appendChild(document.createElement("hr")),o.scrollTop=o.scrollHeight,this.startThinkingAnimation(E),this.activeStream=AiApi.chatStream(d,u,{},{onDelta:D=>{s?.append(D)}});const S=await this.activeStream.done;this.activeStream=null,this.stopThinkingAnimation(),s?.clearTimer(),this.addToHistory("assistant",S),E.innerHTML=ExplainPromptBuilder.formatExplanation(S),o.scrollTop=o.scrollHeight,r.value="",t.textContent="",t.className="status-message",r.focus()}catch(d){if(d?.name==="AbortError"){this.stopThinkingAnimation(),!s?.hasContent()&&c&&(c.textContent="stopped");return}this.stopThinkingAnimation(),!s?.hasContent()&&c&&(c.textContent=""),console.error("Error asking follow-up:",d),t.textContent=`Error: ${d.message}`,t.className="status-message ai-status--error"}finally{s?.flush(),n.classList.remove("disabled"),n.textContent="Ask",r.disabled=!1}}},FixPromptBuilder=(()=>{"use strict";const e=typeof AiPromptUtils<"u"?AiPromptUtils:null,t=(j,p,C)=>e&&e.block?e.block(j,p,C):String(p||"").trim(),n=(j,p)=>e&&e.joinBlocks?e.joinBlocks(j,p):(j||[]).filter(Boolean).join(`

`),r={url:"scripts/ai/prompts/fix_guidance_prompt.md",blockTitle:"umple_compiler_error_diagnosis_and_fix_guidance"},o=Object.create(null),a=Object.create(null);function s(){return String(o.fix||"").trim()}function c(){if(String(o.fix||"").trim())return Promise.resolve(o.fix);if(a.fix)return a.fix;const j=typeof AiPrompting<"u"&&AiPrompting.getPromptText?AiPrompting.getPromptText:null;return j?(a.fix=j(r.url).then(p=>(o.fix=p,delete a.fix,p)).catch(p=>{throw delete a.fix,p}),a.fix):Promise.reject(new Error("AiPrompting.getPromptText is not available"))}async function d(){return c()}function u(j){const p=Number.isFinite(j?.line)?j.line:"?";return[`- severity: ${j?.severity||""}`,`- line: ${p}`,`- errorCode: ${j?.errorCode||""}`,`- message: ${j?.message||""}`].join(`
`)}function f(j){return j||"(no context available)"}function g(j,p){const C=u(j),M=f(j?.context||"");return n([t("task",["Provide a short, concise description of how to fix this Umple compiler issue.","First check for simple typos (misspellings, missing punctuation, or incorrect identifiers)."]),t("compiler_issue",C),t("local_context_line_numbers_included",M),t(r.blockTitle,s()),t("umple_quick_reference",b()),t("output_contract_follow_strictly",["- Output 1-2 short sentences, plain text only.","- Do NOT output code or bullet points.","- Do NOT mention that you are an AI model.","- When referencing lines, use only: 'line N' or 'lines N-M' (N/M are numbers).","- If it looks like a typo, mention the likely typo fix first.","- Keep it actionable and specific to the error."])])}function h(){const j=typeof AiPrompting<"u"&&AiPrompting.getBaseSystemPrompt?AiPrompting.getBaseSystemPrompt():"You are an expert in Umple modeling language.";return n([t("system",j,{allowEmpty:!0}),t("directive","Give concise, actionable fix guidance."),t("output_format",["1. Examine the overall REPL correctness (such as typos or similar errors)","2. Scan the issue-related errors, where the issue represents the compiler output errors","",s()])])}function b(){return typeof AiPrompting<"u"&&AiPrompting.getUmpleCheatSheet?AiPrompting.getUmpleCheatSheet():""}function E(j){let p=String(j||"").trim();return p=p.replace(/^[\-*]\s+/g,""),p=p.replace(/```[\s\S]*?```/g,"").trim(),p=p.replace(/\s+/g," "),p}function S(j){return D(j).replace(/\bline(s)?\s+(\d+)(\s*[-]\s*(\d+))?/gi,(C,M,_)=>`<a href="javascript:Action.setCaretPosition(${_});Action.updateLineNumberDisplay();">${C}</a>`)}function D(j){return String(j||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}return{preloadGuidance(){return d()},buildGuidancePrompt(j,p){const C=g(j,p),M=h();return{prompt:C,systemPrompt:M}},getSystemPrompt(){return h()},cleanGuidanceText(j){return E(j)},formatGuidanceHtml(j){return S(j)}}})(),AiFix={activeRequest:null,issueCache:[],highlightEffect:null,highlightField:null,highlightHandler:null,checkApiConfig(){return AiConfigValidation.checkApiConfig({requireVerified:!0})},abortActiveRequest(){AiStreamUtils?.abort?.(this.activeRequest),this.activeRequest=null},decorateErrorOutput(e,t){if(!e)return;const n=String(t||"");if(!n.trim())return;const r=e.querySelector("#errorRow");if(!r)return;const o=AiCompilerService.parseCompilerIssuesFromErrorHtml(n);this.issueCache=o||[];const a=this.groupIssueNodes(r);a.length&&(r.innerHTML="",a.forEach((s,c)=>{const d=this.issueCache[c]||null,u=document.createElement("div");u.className="ai-fix-issue",u.dataset.issueIndex=String(c);const f=document.createElement("button");f.type="button",f.className="ai-fix-icon",f.title="AI fix guidance",f.innerHTML='<svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 10h3v-3l-3.5 -3.5a6 6 0 0 1 8 8l6 6a2 2 0 0 1 -3 3l-6 -6a6 6 0 0 1 -8 -8l3.5 3.5" /></svg>',f.addEventListener("click",b=>{b.preventDefault(),b.stopPropagation(),this.handleFixClick(u,d,n)});const g=document.createElement("div");g.className="ai-fix-issue-header";const h=document.createElement("span");h.className="ai-fix-issue-content",s.forEach(b=>h.appendChild(b)),g.appendChild(f),g.appendChild(h),u.appendChild(g),r.appendChild(u)}))},groupIssueNodes(e){const t=Array.from(e.childNodes),n=[];let r=[];return t.forEach(o=>{if(o.nodeType===1&&o.tagName.toLowerCase()==="br"){r.length&&(n.push(r),r=[]);return}o.nodeType===3&&!String(o.textContent||"").trim()||r.push(o)}),r.length&&n.push(r),n},async handleFixClick(e,t,n){if(!e)return;const r=this.checkApiConfig();if(!r.configured){typeof AiSettings<"u"&&AiSettings.showSettingsModal&&AiSettings.showSettingsModal(),alert(r.message);return}this.goToIssue(t);const o=this.ensureSubBulletContainer(e,!0),a=this.runBasicScan(Page.codeMirrorEditor6?.state.doc.toString()||"");a.issues.length>0&&(this.appendSubBullet(o,`Scan: ${a.issues.join("; ")}`),this.appendSubBullet(o,`Stats: lines ${a.stats.lines}, non-empty ${a.stats.nonEmptyLines}, chars ${a.stats.chars}`));const s=this.appendSubBullet(o,"Generating fix guidance\u2026",!0);try{this.abortActiveRequest();const c=t||{};c.context=this.getIssueContext(t),await FixPromptBuilder.preloadGuidance();const{prompt:d,systemPrompt:u}=FixPromptBuilder.buildGuidancePrompt(c,n),f=AiStreamUtils.createBufferedTextRenderer({updateIntervalMs:120,onRender:E=>{s.textContent=`- ${E}`}});this.activeRequest=AiApi.chatStream(d,u,{maxTokens:500},{onDelta:E=>{f.append(E)}});const g=await this.activeRequest.done;f.flush({force:!0});const h=FixPromptBuilder.cleanGuidanceText(g),b=FixPromptBuilder.formatGuidanceHtml(h||"No guidance produced.");s.innerHTML=`- ${b}`,s.classList.remove("ai-fix-sub-bullet-pending")}catch(c){if(c?.name==="AbortError"){s.textContent="- Stopped.";return}s.textContent=`- Error: ${c?.message||c}`,s.classList.remove("ai-fix-sub-bullet-pending")}finally{this.activeRequest=null}},ensureSubBulletContainer(e,t=!1){let n=e.querySelector(".ai-fix-sub-bullets");return n&&t&&(n.remove(),n=null),n||(n=document.createElement("div"),n.className="ai-fix-sub-bullets",e.appendChild(n),n)},appendSubBullet(e,t,n=!1){const r=document.createElement("div");return r.className="ai-fix-sub-bullet-item",n&&r.classList.add("ai-fix-sub-bullet-pending"),r.textContent=`- ${t}`,e.appendChild(r),r},runBasicScan(e){const t=[],n={lines:0,nonEmptyLines:0,chars:0},r=String(e||""),o=r.split(/\r?\n/);n.lines=o.length,n.nonEmptyLines=o.filter(g=>g.trim()).length,n.chars=r.length;const a=(r.match(/\{/g)||[]).length-(r.match(/\}/g)||[]).length,s=(r.match(/\(/g)||[]).length-(r.match(/\)/g)||[]).length,c=(r.match(/\[/g)||[]).length-(r.match(/\]/g)||[]).length;return a!==0&&t.push(`Unbalanced braces ({ vs }): ${a>0?"missing }":"missing {"}`),s!==0&&t.push(`Unbalanced parentheses (( vs )): ${s>0?"missing )":"missing ("}`),c!==0&&t.push(`Unbalanced brackets ([ vs ]): ${c>0?"missing ]":"missing ["}`),(r.match(/(?<!\\)"/g)||[]).length%2!==0&&t.push("Unclosed double quote detected"),(r.match(/(?<!\\)'/g)||[]).length%2!==0&&t.push("Unclosed single quote detected"),o.some(g=>/^\s*class\s*(\{|$)/.test(g))&&t.push("Class declaration missing a name"),{issues:t,stats:n}},goToIssue(e){if(!Page.codeMirrorEditor6||!e||!Number.isFinite(e.line))return;this.ensureHighlightExtension();const t=Page.codeMirrorEditor6,n=t.state.doc,r=Math.max(1,Math.min(e.line,n.lines)),o=n.line(r),a=[];typeof cm6<"u"&&cm6.EditorView&&cm6.EditorView.scrollIntoView&&a.push(cm6.EditorView.scrollIntoView(o.from,{y:"center"})),this.highlightEffect&&a.push(this.highlightEffect.of(o.from)),t.dispatch({selection:{anchor:o.from,head:o.to},effects:a}),t.focus()},ensureHighlightExtension(){if(this.highlightEffect||!Page.codeMirrorEditor6||typeof cm6>"u"||!cm6.StateEffect||!cm6.StateField||!cm6.Decoration||!cm6.EditorView)return;const e=cm6.StateEffect.define({map:(n,r)=>n==null?null:r.mapPos(n)}),t=cm6.StateField.define({create(){return null},update(n,r){for(const o of r.effects)o.is(e)&&(n=o.value);return n!=null&&r.docChanged&&(n=r.changes.mapPos(n)),n},provide:n=>cm6.EditorView.decorations.from(n,r=>r==null?cm6.Decoration.none:cm6.Decoration.set([cm6.Decoration.line({class:"ai-fix-highlight-line"}).range(r)]))});Page.codeMirrorEditor6.dispatch({effects:cm6.StateEffect.appendConfig.of([t])}),this.highlightEffect=e,this.highlightField=t,this.highlightHandler||(this.highlightHandler=n=>{const r=Page.codeMirrorEditor6;if(!r||!this.highlightField||!this.highlightEffect)return;const o=r.state.field(this.highlightField,!1);if(o==null)return;const a=r.posAtCoords({x:n.clientX,y:n.clientY});if(a==null)return;r.state.doc.lineAt(a).from===o&&r.dispatch({effects:this.highlightEffect.of(null)})},Page.codeMirrorEditor6.dom.addEventListener("mousedown",this.highlightHandler))},getIssueContext(e){if(!Page.codeMirrorEditor6||!e||!Number.isFinite(e.line))return"";const t=Page.codeMirrorEditor6.state.doc,n=Math.max(1,Math.min(e.line,t.lines)),r=[];for(let o=1;o<=t.lines;o++){const a=t.line(o);r.push(`${o}: ${a.text}`)}return r.join(`
`)}};var ObjectsUtil={objects:{},parentCalls:{},declare:function(e,t,n){if(!ObjectsUtil.objects[e]){this.parentCalls[e]={},ObjectsUtil.objects[e]=function(){ObjectsUtil.objects[e].prototype.constructor.apply(this,arguments)};for(var r=[],o=0;o<t.length;o++)r.push(t[o]);for(var a=[],o=0;o<r.length;o++){var s=r[o],c=ObjectsUtil.get(s);if(typeof c=="function"){var d=c.prototype,u=d.constructor;u&&a.push(u);for(var f in d)if(f!=="constructor"){var g=d[f];typeof g=="function"?(this.parentCalls[e][f]||(this.parentCalls[e][f]=[]),this.parentCalls[e][f].push(g)):ObjectsUtil.objects[e].prototype[f]=g}}}ObjectsUtil.objects[e].prototype.className=e;var h;for(var f in n)f==="constructor"?h=n[f]:ObjectsUtil.objects[e].prototype[f]=n[f];var b=this.parentCalls[e];for(var f in b)if(!ObjectsUtil.objects[e].prototype[f]){var E=b[f];E.length>0&&(ObjectsUtil.objects[e].prototype[f]=E[0])}ObjectsUtil.objects[e].prototype.constructor=function(){for(var S=0;S<a.length;S++)a[S].apply(this,arguments);h&&h.apply(this,arguments)}}},superCall:function(e,t,n){var r=this.parentCalls[r.className];if(r)for(var o=0;o<r.length;o++)r[o].call(e,n)},define:function(e,t){if(!ObjectsUtil.objects[e])return ObjectsUtil.objects[e]=t,t},get:function(e){return ObjectsUtil.objects[e]},newInstance:function(e,t){var n=new ObjectsUtil.objects[e](t);if(typeof t!="string")for(var r in t)n[r]||(n[r]=t[r]);return n},isArray:function(e){return e&&e instanceof Array}};(function(){var e=ObjectsUtil.get("util.core.CoreUtil");ObjectsUtil.declare("util.core.Map",[],{values:null,keys:null,constructor:function(){this.values=[],this.keys=[]},put:function(t,n){var r=this.keys.indexOf(t);r===-1?(this.values.push(n),this.keys.push(t)):this.values[r]=n},get:function(t){return this.values[this.keys.indexOf(t)]},remove:function(t){var n=this.keys.indexOf(t);n<0||(this.values.splice(n,1),this.keys.splice(n,1))},clear:function(){this.values=[],this.keys=[]}})})(),(function(){var e=ObjectsUtil.newInstance("util.core.Map"),t=[];ObjectsUtil.define("util.core.Events",{topics:{},suspend:null,connect:function(n,r,o,a){var s=this,c,d;if(r.addEventListener)c=function(){a.apply(o,arguments)},r.addEventListener(n,c,!1),d=function(){r.removeEventListener(n,c,!1)};else{var u=e.get(r);if(u||(u=[],e.put(r,u)),!u[n]){u[n]={bridged:r[n],connects:[]};var s=this;r[n]=function(){if(u[n].bridged.apply(r,arguments),!s.suspend)for(var h=u[n].connects,b=0,E;E=h[b];b++)E.callback.apply(E.context,arguments)}}u[n].connects.push({callback:a,context:o}),c=a}var f={callback:c,disconnector:d,type:n,object:r,context:o};return t.push(f),f},disconnectAll:function(){for(;t.length>0;)this.disconnect(t[0],e);this.topics={}},disconnect:function(n,r){if(n){if(n.object.removeEventListener)n.disconnector();else{var o=e.get(n.object);if(!o)return;var a=o[n.type];if(!a||(a=a.connects,!a))return;for(var s=0,c;c=a[s];s++)c.callback===n.callback&&(a.splice(a.indexOf(c),1),s=0)}var d=t.indexOf(n);d>-1&&t.splice(d,1)}},subscribe:function(n,r,o){this.topics[n]||(this.topics[n]=[]);var a={handler:r,context:o};return this.topics[n].push(a),a},unsubscribe:function(n,r){if(this.topics[n]){var o=this.topics[n].indexof(r);o>-1&&this.topics[n].splice(o,1)}},publish:function(n){var r=this.topics[n];if(r)for(var o=0,a;a=r[o];o++){var s=Array.prototype.slice.call(arguments,1);a.handler.apply(a.context||this,s)}}})})(),(function(){ObjectsUtil.define("util.core.UUIDGenerator",{generate:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e==="x"?t:t&3|8;return n.toString(16)})}})})(),(function(){ObjectsUtil.define("util.svg.SVGUtil",{SVG:"http://www.w3.org/2000/svg",syncLineBetweenVertices:function(e,t,n){var r=t.getRootNode(),o=parseFloat(r.getAttribute("height")),a=t.focalNode,s=n.focalNode,c=parseFloat(a.getAttribute("x")),d=parseFloat(a.getAttribute("y")),u=parseFloat(a.getAttribute("height")),f=parseFloat(a.getAttribute("width")),g=parseFloat(s.getAttribute("x")),h=parseFloat(s.getAttribute("y")),b=parseFloat(s.getAttribute("height")),E=parseFloat(s.getAttribute("width")),S=c+f/2,D=d+u/2,j={y:D,x:S},p={y:h,x:g+E/2,getRange:function(R,B){var H=g/o,I=E/2*H,v=g+E/2;return Math.abs(R-v)<2?v:R<g+E/2?v-I:R>g+E/2?v+I:v}},C={y:h+b,x:g+E/2,getRange:function(R,B){var H=g/o,I=E/2*H,v=g+E/2;return Math.abs(R-v)<2?v:R<g+E/2?v-I:R>g+E/2?v+I:v}},M={y:h+b/2,x:g,getRange:function(R,B){var H=h/o,I=b/2*H,v=h+b/2;return Math.abs(B-v)<2?v:B<h+b/2?v-I:B>h+b/2?v+I:v}},_={y:h+b/2,x:g+E,getRange:function(R,B){var H=h/o,I=b/2*H,v=h+b/2;return Math.abs(B-v)<2?v:B<h+b/2?v-I:B>h+b/2?v+I:v}},T=function(R,B){return Math.abs(R.x-B.x)+Math.abs(R.y-B.y)},P=T(j,p),k=T(j,C),U=T(j,M),N=T(j,_);P<k&&P<U&&P<N?e.setAttribute("d","M"+S+","+D+" L"+p.getRange(S,D)+" "+p.y):k<P&&k<U&&k<N?e.setAttribute("d","M"+S+","+D+" L"+C.getRange(S,D)+" "+C.y):U<P&&U<k&&U<N?e.setAttribute("d","M"+S+","+D+" L"+M.x+" "+M.getRange(S,D)):N<P&&N<k&&N<U&&e.setAttribute("d","M"+S+","+D+" L"+_.x+" "+_.getRange(S,D)),t.parentNode.refreshChild(e)},syncVertixLines:function(e){for(var t=ObjectsUtil.get("util.svg.SVGUtil"),n=e.getChildren("connector"),r=0;o=n[r];r++){var o=n[r];t.syncLineBetweenVertices(o.focalNode,o.source,o.target)}},getConnector:function(e,t){for(var n=e.getChildren("connector"),r=0;r<n.length;r++){var o=n[r];if(o.target===e){if(o.source===t)return o}else if(o.source===e&&o.target===t)return o}return null}})})(),(function(){var e=ObjectsUtil.get("util.svg.SVGUtil"),t={},n={};ObjectsUtil.define("layout.shapes.ShapesRegistry",{register:function(r,o){t[r]=o},draw:function(r,o,a){var s=ObjectsUtil.newInstance(t[r],o,a);return n[r]||(n[r]={}),n[r][s.id||s.guid]=s,s.draw(o,a),s},get:function(r,o){return o?n[r][o]:n[r]},getAndGroup:function(r,o){var a=this.get(r,o),s={};for(var c in a){var d=a[c];if(d){var u=d.parent;u&&(s[u]||(s[u]={}),s[u][c]=d)}}return s},destroy:function(r){n[r.guid].destroy(),n[r.guid]=void 0},empty:function(){n={}},showMessage:function(r,o){var a=document.getElementById(r);if(a){ObjectsUtil.get("util.core.Events").disconnectAll(),ObjectsUtil.get("layout.shapes.ShapesRegistry").empty(),ObjectsUtil.get("util.core.DomUtil").empty(a);var s=ObjectsUtil.get("util.svg.SVGUtil"),c=a.descriptionMessage||document.createElementNS(s.SVG,"text");c.setAttribute("x",20),c.setAttribute("y",20),c.setAttribute("style","fill: #000000;  font-family:tahoma; font-size: 16;  font-weight:bold"),c.appendChild(document.createTextNode(o)),a.appendChild(c);var d=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(o,c);a.style.width=d.w+120+"px",a.style.height=d.h+5+"px",a.style.border="none",a.descriptionMessage=c}},paint:function(r,o){o&&r.args.container&&(ObjectsUtil.get("util.core.Events").disconnectAll(),ObjectsUtil.get("layout.shapes.ShapesRegistry").empty(),ObjectsUtil.get("util.core.DomUtil").empty(r.args.container)),this._paint(r)},_paint:function(r,o,a){o&&(r.args.parentNode=o),a&&(r.args.container=a),r.args.id||(r.args.id=r.args.name);var s=ShapesRegistry.draw(r.descriptor,r.args,r);return s}})})(),(function(){var e=ObjectsUtil.get("util.svg.SVGUtil"),t=ObjectsUtil.get("layout.shapes.ShapesRegistry"),n=40,r=1e5,o=5e-4;o=5e-4,ObjectsUtil.declare("layout.routers.AutomaticRouter",[],{forcex:null,forcey:null,_layoutInterval:null,graph:null,constructor:function(a){this.graph=a,this.forcex={},this.forcey={}},layout:function(){var a=this;a._doLayout(),this._layoutInterval=setInterval(function(){a._doLayout()},100)},_doLayout:function(){for(var a=this.graph.getChildren("rectangle"),s=0;vertix1=a[s];s++){var c=vertix1.name;this.forcex[c]=0,this.forcey[c]=0;for(var d=0;vertix2=a[d];d++){var u=vertix2.name;if(c!==u){var f=parseFloat(vertix2.getAttribute("x"))-parseFloat(vertix1.getAttribute("x")),g=parseFloat(vertix2.getAttribute("y"))-parseFloat(vertix1.getAttribute("y")),h=Math.pow(f,2)+Math.pow(g,2);if(this.forcex[c]-=r/h*f,this.forcey[c]-=r/h*g,e.getConnector(vertix1,vertix2)){var b=Math.sqrt(h);this.forcex[c]+=(b-n)*f,this.forcey[c]+=(b-n)*g}}}}for(var E=0,s=0;vertix1=a[s];s++){var c=vertix1.name,S=this.forcex[c]*o,D=this.forcey[c]*o;E=E+Math.abs(S)+Math.abs(D),vertix1.setPosition({x:parseFloat(vertix1.getAttribute("x"))+S,y:parseFloat(vertix1.getAttribute("y"))+D})}Math.round(E)<40&&clearInterval(this._layoutInterval)}})})(),(function(){var e=ObjectsUtil.get("util.svg.SVGUtil"),t=ObjectsUtil.get("layout.shapes.ShapesRegistry"),n=40,r=1e5,o=5e-4;o=5e-4,ObjectsUtil.declare("layout.routers.HorizontalTreeRouter",[],{forcex:null,forcey:null,graph:null,constructor:function(a){this.graph=a,this.forcex={},this.forcey={}},layout:function(){var a=this;a._doLayout()},_doLayout:function(){var a=[],s=function(P,k){for(var U=[],N=P.getChildren("connector"),R=0;R<N.length;R++){var B=N[R];if(B.source===P){var H=B.target;if(k&&a.indexOf(H)>-1)continue;U.push(B.target)}else if(B.target===P){var I=B.source;if(k&&a.indexOf(I)>-1)continue;U.push(B.source)}}return U},c=function(P){var k=P.getChildren("connector");if(k.length<1)return 1;for(var U=0,N=0;subChild=k[N];N++)U=U+c(subChild);return U},d=function(P){var k=P.getChildren("connector");if(k.length<1)return 1;for(var U=0,N=0;subChild=k[N];N++){var R;if(subChild.source===P?R=subChild.target:subChild.target===P&&(R=subChild.source),!!R){var B=parseFloat(R.getAttribute("width"));B>U&&(U=B)}}return U},u=function(P,k){k||(k=[]);var U=s(P);if(U.length===1)return 1;for(var N=0,R=0;R<U.length;R++){var B=U[R];k.indexOf(B)>-1||(k.push(U[R]),N=N+u(U[R],k))}return N},f=this.graph.getChildren("rectangle"),g=f;g.sort(function(P,k){return c(k)-c(P)});for(var h=40,b=30,E={x:0,y:0},S=function(P,k,U,N){if(!(a.indexOf(P)>-1)){a.push(P);var R=c(P,!0);N&&R--,P.setPosition({x:k,y:U}),U>E.y&&(E.y=U),k>E.x&&(E.x=k);for(var B=s(P,!0),H=B.length,I=R*h,v=U-I/2,L=0,O=0;O<H;O++){var z=B[O],V=c(z)-1,Z=v;O&&(Z=Z+h),V||(V=1);var W=Z+V*h,ie=(Z+W)/2,oe=k+b+parseFloat(P.getAttribute("width"));z.setPosition({x:oe,y:ie}),ie>E.y&&(E.y=ie),oe>E.x&&(E.x=oe),v=W-h,L=L+(V||1),a.push(z);var K=s(z,!0),le=oe+parseFloat(z.getAttribute("width"))+b;if(K.length===1)S(K[0],le,ie,!0);else if(K.length>=2)for(var he=Z+h/2,pe=(W-he)/K.length+h/K.length,ye=0;ye<K.length;ye++)S(K[ye],le,he+pe*ye,!0)}}},D=0;D<g.length;D++){var j=g[D];if(!(a.indexOf(j)>-1)){var p=u(j),C=a.length===0?p*h/4:E.y+h;S(j,b,C)}}if(!this.graph.height){var M=parseFloat(this.graph.getAttribute("height")),_=E.y+h;_>M&&this.graph.setAttribute("height",parseFloat(_))}if(!this.graph.width){var T=parseFloat(this.graph.getAttribute("width")),_=E.x+100;_>T&&this.graph.setAttribute("width",parseFloat(_))}for(var D=0;D<a.length;D++){var j=a[D];j.parentNode.refreshChild(j.focalNode),e.syncVertixLines(j)}}})})(),(function(){var e=0,t=ObjectsUtil.get("util.core.Events");ObjectsUtil.declare("layout.shapes.AbstractNode",[],{focalNode:null,guid:null,children:null,type:null,parentNode:null,incremntal:null,_incomplete:null,constructor:function(n){this.children=[],this.id=n.id,this.parentNode=n.parentNode,this.incremntal++},getChildren:function(n){return this.children[n||""]||[]},getPosition:function(){return{x:0,y:0,h:0,w:0}},setPosition:function(n,r){},shiftPosition:function(n,r){var o=this.getPosition();for(var a in n)o[a]=(o[a]||0)+n[a];this.setPosition(o,r)},getSuperContainer:function(){for(var n=this.container;;){var r=n.container;if(r&&r.className)n=r;else break}return n},addChild:function(n){this.removeChild(n);var r=n.type||"";this.children[r]||(this.children[r]=[]),this.children[r].push(n)},removeChild:function(n){var r=n.type||"";if(this.children[r]&&this.children[r]){var o=this.children[r].indexOf(n);o!=-1&&this.children[r].splice(o,1)}},appendChild:function(n){this.focalNode.appendChild(n)},refreshChild:function(n){n.parentNode===this.focalNode&&(this.focalNode.removeChild(n),this.insertBefore(n,this.focalNode.firstChild))},insertBefore:function(n,r){r?this.focalNode.insertBefore(n,r):this.appendChild(n)},draw:function(n){},getAttribute:function(n){return this.focalNode.getAttribute(n)},setAttribute:function(n,r){this.focalNode.setAttribute(n,r)},getRootNode:function(){var n=this.parentNode.focalNode;if(n.tagName==="svg")return n;for(var r=n.parentNode;r;)if(r=r.parentNode,r&&r.tagName==="svg")return r;return n},handleMove:function(n,r){},destroy:function(){}})})(),(function(){var e=ObjectsUtil.get("util.svg.SVGUtil"),t=ObjectsUtil.get("util.core.Events"),n=ObjectsUtil.get("util.core.UUIDGenerator"),r=0,o="#222",a="#fff",s="10px";ObjectsUtil.declare("layout.shapes.RectangleNode",["layout.shapes.AbstractNode"],{focalNode:null,guid:null,name:null,color:null,fontColor:null,rx:null,parentNode:null,strokeWidth:null,_moving:null,type:null,constructor:function(c){this.type="rectangle",this.name=c.name||"Node"+r,this.guid=c.id||this.name,this.color=c.color||o,this.fontColor=c.fontColor||a,this.rx=c.rx||s,this.strokeWidth=c.strokeWidth||1,this.strokeWidth=this.strokeWidth+"px",r++},draw:function(c){var d=parseInt(this.parentNode.getAttribute("width")),u=parseInt(this.parentNode.getAttribute("height"));this.focalNode=document.createElementNS(e.SVG,"rect"),this.focalNode.setAttribute("style","fill: "+this.color+"; stroke-width: "+this.strokeWidth+";"),this.focalNode.setAttribute("rx",this.rx),this.parentNode.appendChild(this.focalNode),this.focalNode.name=this.name,this.focalNode.textLabel=document.createElementNS(e.SVG,"text"),this.focalNode.textLabel.setAttribute("style","fill: "+this.fontColor+"; stroke-width: 1px;"),this.focalNode.textLabel.appendChild(document.createTextNode(this.name)),this.parentNode.appendChild(this.focalNode.textLabel),this.focalNode.h=this.focalNode.textLabel.getBBox().height+10,this.focalNode.w=this.focalNode.textLabel.getBBox().width+10,this.focalNode.setAttribute("height",this.focalNode.h+"px"),this.focalNode.setAttribute("width",this.focalNode.w+"px");var f=t.connect("mousedown",this.focalNode,this,function(b){this.handleMove(this.focalNode,b)}),f=t.connect("mousedown",this.focalNode.textLabel,this,function(b){this.handleMove(this.focalNode,b)}),g=Math.random()*(d*.8)+d*.1,h=Math.random()*(u*.8)+u*.1;this.setPosition({x:g,y:h})},setPosition:function(c){var d=parseFloat(c.x),u=parseFloat(c.y);this.focalNode.setAttribute("x",d),this.focalNode.setAttribute("y",u),this.focalNode.textLabel.setAttribute("x",d+5+"px"),this.focalNode.textLabel.setAttribute("y",u+2*this.focalNode.h/3+"px"),e.syncVertixLines(this)},handleMove:function(c,d){var u=c.parentNode.getScreenCTM(),f=c.parentNode.createSVGPoint();f.x=d.clientX,f.y=d.clientY,f=f.matrixTransform(u.inverse());var g=parseFloat(f.x)-parseFloat(c.getAttribute("x")),h=parseFloat(f.y)-parseFloat(c.getAttribute("y")),b=this.getChildren("rectangle");this._moving=c;var E=t.connect("mousemove",document,this,function(D){var j=c.parentNode.getScreenCTM(),p=c.parentNode.createSVGPoint();p.x=D.clientX,p.y=D.clientY,p=p.matrixTransform(j.inverse()),this.setPosition({x:p.x-g,y:p.y-h}),this.parentNode.updateArrowMarker()}),S=t.connect("mouseup",document,this,function(){t.disconnect(E),t.disconnect(S),this.parentNode.updateArrowMarker()})}})})(),(function(){var e=ObjectsUtil.get("layout.shapes.ShapesRegistry"),t=ObjectsUtil.get("util.svg.SVGUtil"),n="1px",r="#444",o=0;ObjectsUtil.declare("layout.shapes.Connector",["layout.shapes.AbstractNode"],{focalNode:null,source:null,target:null,name:null,color:null,rx:null,strokeWidth:null,type:null,constructor:function(a){this.type="connector",this.setSource(a.source),this.setTarget(a.target),this.name=a.name||"Connector"+o,this.guid=a.id||this.source.guid+"_"+this.target.guid+"_"+o,this.strokeWidth=a.strokeWidth||n,this.color=a.color||r,o++},setSource:function(a){var s=e.get("RectangleNode",a);this.source=s,s.addChild(this)},setTarget:function(a){var s=e.get("RectangleNode",a);this.target=s,s.addChild(this)},draw:function(a){return this.focalNode=document.createElementNS(t.SVG,"path"),this.focalNode.setAttribute("style","stroke: "+this.color+"; stroke-width:"+this.strokeWidth+";"),this.parentNode.insertBefore(this.focalNode,this.parentNode.firstChild),this.focalNode.setAttribute("marker-end","url(#Triangle)"),this.focalNode}})})();var ShapesRegistry=ObjectsUtil.get("layout.shapes.ShapesRegistry");(function(){ShapesRegistry.register("Connector","layout.shapes.Connector"),ShapesRegistry.register("RectangleNode","layout.shapes.RectangleNode"),ShapesRegistry.register("Graph","layout.shape.Graph")})(),(function(){var e=ObjectsUtil.get("layout.routers.HorizontalTreeRouter"),t=ObjectsUtil.get("util.core.Events"),n=ObjectsUtil.get("util.svg.SVGUtil"),r=ObjectsUtil.get("layout.shapes.ShapesRegistry");ObjectsUtil.declare("layout.shape.Graph",["layout.shapes.AbstractNode"],{routingObject:null,height:null,width:null,_layoutInterval:null,_moving:null,_defs:null,constructor:function(o){this.height=o.height,this.width=o.width;var a=o.container,s=o.router;this.router=s||new e(this),this.focalNode=document.getElementById(a),this.updateArrowMarker()},draw:function(o,a){},_paint:function(o){o.args.parentNode=this,o.args.id||(o.args.id=o.args.name),o.args.container=this;var a=r.draw(o.descriptor,o.args,o);return a},updateArrowMarker:function(){if(this._defs)this.focalNode.removeChild(this._defs);else{this._defs=document.createElementNS(n.SVG,"defs");var o=document.createElementNS(n.SVG,"marker");o.setAttribute("id","Triangle"),o.setAttribute("viewBox","0 0 20 20"),o.setAttribute("refX","20"),o.setAttribute("refY","10"),o.setAttribute("markerUnits","strokeWidth"),o.setAttribute("markerWidth","8"),o.setAttribute("markerHeight","6"),o.setAttribute("orient","auto");var a=document.createElementNS(n.SVG,"path");o.appendChild(a),a.setAttribute("d","M 0 0 L 20 10 L 0 20 z"),this._defs.appendChild(o)}this.focalNode.appendChild(this._defs)},addRectNode:function(o){o.parentNode=this;var a=r.draw("RectangleNode",o);this.addChild(a)},drawConnector:function(o){o.parentNode=this;var a=r.draw("Connector",o);this.addChild(a)},layout:function(){this.router.layout()}})})(),(function(){var e=ObjectsUtil.define("util.core.DomUtil",{empty:function(t){if(t.tagName||(t=document.getElementById(t)),!!t){if(t.canHaveChildren)try{t.innerHTML="";return}catch{}for(var n;n=t.lastChild;)this._empty(n,t)}},_empty:function(t,n){t.firstChild&&this.empty(t),n&&(n.removeChild(t),t.removeNode&&t.removeNode(!1))},calculateTextSize:function(t,n){var r=document.createElement("span");r.innerHTML=t,r.style.visibility="hidden";var s=this.position(r);if(typeof n=="object"&&!n.parentNode)for(var o in n)r.style[o]=n[o];else r.style.fontSize=window.getComputedStyle(n,null).getPropertyValue("font-size"),r.style.fontFamily=window.getComputedStyle(n,null).getPropertyValue("font-family"),r.style.fontWeight=window.getComputedStyle(n,null).getPropertyValue("font-weight");var a=document.body;a.appendChild(r);var s=this.position(r);return a.removeChild(r),s},position:function(t,n){var r=ObjectsUtil.get("util.core.CoreUtil");t=this.nodeById(t);var o=this.getFirstParent(t,"body"),a=t.getBoundingClientRect();if(a={x:a.left,y:a.top,w:a.right-a.left,h:a.bottom-a.top},n){var s=this.scrollValue(t);a.x+=s.x,a.y+=s.y}return a},transformValue:function(t){var n=t.getAttribute("transform");if(!n)return{x:0,y:0};n=n.substring(10,n.length-1);var r=n.split(",");return r.length<2&&(r=n.split(" ")),{x:parseFloat(r[0]),y:parseFloat(r[1])}},scrollValue:function(t){for(var n=function(u,f){var g,h=window["page"+u+"Offset"];if(typeof h=="number")g=h;else{var b="scroll"+f;document.body&&document.body[b]?g=document.body[b]:document.documentElement&&document.documentElement[b]&&(g=document.documentElement[b])}return g},r=function(){return n("Y","Top")},o=function(){return n("X","Left")},a=0,s=0,c={x:o(),y:r()},d=t;d;){if(d!==document.body&&d!==document.documentElement){if(d.scrollTop>0){c.y=c.y+d.scrollTop;break}if(d.scrollLeft>0){c.x=c.x+d.scrollLeft;break}}d=d.parentNode}return c},nodeById:function(t,n){var r=ObjectsUtil.get("util.core.CoreUtil");return r.checkBrowser("ie")?(this.nodeById=function(o,a){return typeof o!="string"?o:(a||document).getElementById(o)},this.nodeById(t,n)):(this.nodeById=function(o,a){if(typeof o!="string")return o;n||(n=document);var s=n.getElementById(o);if(s.id==o||s.attributes&&s.attributes.id&&s.attributes.id.value==o)return s;var c=n.all[o];if(c){r.isArray(c)||(c=[c]);for(var d=0,u;u=c[d];d++)if(u.id==o||u.attributes&&u.attributes.id&&u.attributes.id.value==o)return u}},this.nodeById(t,n))},transformPoint:function(t,n){var r=ObjectsUtil.get("util.core.DomUtil").getFirstParent(t,"svg"),o=r.getScreenCTM(),a=r.createSVGPoint();a.x=n.x,a.y=n.y,a=a.matrixTransform(o.inverse()),n.x=a.x,n.y=a.y},getFirstParent:function(t,n){if(!(!t||!n)){if(n=n.toUpperCase(),t.tagName.toUpperCase()===n)return t;for(var r=t.parentNode,o;r;){if(r.tagName&&r.tagName.toUpperCase()===n.toUpperCase()){o=r;break}r=r.parentNode}return o}}})})(),(function(){var e=ObjectsUtil.define("util.core.CoreUtil",{store:{},toString:{}.toString,_browserSettings:null,clone:function(t){var n={};for(var r in t)n[r]=t[r];return n},stopEvent:function(t){t.cancelBubble=!0,t.preventDefault(),t.stopPropagation()},checkBrowser:function(t){var n=this.store[t];return n!==void 0||(n=navigator.userAgent.search(t),this.store[t]=n),n},browserSettings:function(){if(this._browserSettings)return this._browserSettings;var t=navigator.userAgent,n,r=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];if(/trident/i.test(r[1]))return n=/\brv[ :]+(\d+(\.\d+)?)/g.exec(t)||[],this._browserSettings={browser:"ie",version:n[1]||""},this._browserSettings;r=r[2]?[r[1],r[2]]:[navigator.appName,navigator.appVersion,"-?"],(n=t.match(/version\/([\.\d]+)/i))!=null&&(r[2]=n[1]),this._browserSettings={browser:r[0].toLowerCase(),version:r[1]||""}},version:function(t){var n=this.browserSettings();return n.browser===t?parseFloat(n.version):0},isFunction:function(t){return this._is(t,"[object Function]")},isString:function(t){return this._is(t,"[object String]")},isArray:function(t){return this._is(t,"[object Array]")},_is:function(t,n){return this.toString.call(t)===n}})})(),(function(){var SVGUtil=ObjectsUtil.get("util.svg.SVGUtil"),Events=ObjectsUtil.get("util.core.Events"),UUIDGenerator=ObjectsUtil.get("util.core.UUIDGenerator"),incremntal=0,DEFAULT_COLOR="rgb(255,255,255)",DEFAULT_FONT_COLOR="#fff",DEFAULT_ROUND_RATIO="10px",ShapesRegistry=ObjectsUtil.get("layout.shapes.ShapesRegistry");ShapesRegistry.register("StrucutreDiagram","layout.shapes.StrucutreDiagram"),ShapesRegistry.register("Part","layout.shapes.Part"),ShapesRegistry.register("Port","layout.shapes.Port"),ShapesRegistry.register("PartIcon","layout.shapes.PartIcon"),ShapesRegistry.register("PortConnector","layout.shapes.PortConnector"),ObjectsUtil.declare("layout.shapes.StructureDiagramNode",["layout.shapes.AbstractNode"],{_moveHandle:null,constructor:function(e){this._moveHandle=Events.subscribe("structure.diagram.node.move."+this.id,function(t){var n=this,r=[],o=function(a){if(!(r.indexOf(a)>-1)){r.push(a);var s=a.getPrecisePosition?a.getPrecisePosition():a.getPosition();n.parentNode.layoutInformation||(n.parentNode.layoutInformation={});var c={x:s.x,y:s.y,h:s.h,w:s.w};n.parentNode.layoutInformation[a.id]=c;for(var d=a.getChildren(),u=0,f;f=d[u];u++)o(f)}};o(this)},this)},destroy:function(){Events.unsubsribe(this._moveHandle)}});var StructureDiagramUtil=ObjectsUtil.define("layout.shapes.diagram.structure..StructureDiagramUtil",{portToPart:function(e,t,n){var r=ObjectsUtil.get("util.core.CoreUtil"),o=r.isString(e)?ShapesRegistry.get("Port",e):e,a=n||o.container,s=a.getPosition(),c=o.getPosition(),d=parseInt(Math.abs(c.x-(s.x+s.w)+c.w)),u=parseInt(Math.abs(c.x-s.x+c.w)),f=parseInt(Math.abs(c.y-(s.y-c.h))),g=parseInt(Math.abs(c.y-(s.y+s.h)+c.h)),h=function(E,S,D,j){var p=function(C,M){return C<5&&M<5};e.isPrivate&&(D==="right"?(D="left",S=S+2):D==="left"?(D="right",S=S+2,E=E+2):D==="top"?(D="bottom",S=S+(j.h/2+2)):D==="bottom"?(D="top",S=S-(j.h/2+2)):D="right"),t(E,S,D,j,p(g,u)||p(f,u)||p(g,d)||p(f,d),{deltaRight:d,deltaLeft:u,deltaTop:f,deltaBottom:g})},b;if(d<u&&d<=f&&d<=g)return s.y-c.h>c.y?h(c.x+(c.w/2-2),c.y,"top",c):c.y>s.y+s.h+document.body.scrollTop-c.h?h(c.x+(c.w/2-2),c.y+(c.h/2+4),"bottom",c):h(c.x+(c.w-2),c.y+c.h/2,"right",c);if(u<d&&u<=f&&u<=g)return s.y-c.h>c.y?h(c.x+(c.w/2-2),c.y,"top",c):c.y>s.y+s.h+document.body.scrollTop-c.h?h(c.x+(c.w/2-2),c.y+(c.h/2+4),"bottom",c):h(c.x+(c.w-2),c.y+c.h/2,"left",c);if(f<d&&f<u&&f<g)return h(c.x+(c.w/2-2),c.y,"top",c);if(g<d&&g<u&&g<f)return h(c.x+(c.w/2-2),c.y+(c.h/2+4),"bottom",c)}});ObjectsUtil.declare("layout.shapes.StrucutreDiagram",["layout.shape.Graph"],{layoutInformation:null,settings:null,constructor:function(e){this.layoutInformation=e.layout},draw:function(e,t){this.focalNode.style.width="100%",this.focalNode.style.height="3600px",this._incomplete=!0,this.settings=t.args.settings||{};var n=t.args.layout;this.height&&this.setAttribute("height",this.height),this.width&&this.setAttribute("width",this.width);var r=e.nodes;if(r){for(var o={"":{}},a=function(de){var se=o[de||""];return se||(o[de]={},o[de])},s=[],c=function(de){var se=de.args,me=se.id||se.name;if(me){de.children={};var Pe=a(se.parent)[se.id||se.name||new Date().getTime()]=de}else s.indexOf(de)===-1&&s.push(de)},d=0,u;u=r[d];d++)c(u);var f=function(de,se){for(var me in de){if(me===se)return de[se];var Pe=f(de[me].children,se);if(Pe)return Pe}},g=[],h=function(de){for(var se in de)if(se){var me=de[se],Pe=f(o[""],se);if(Pe){var fe=g.indexOf(se);fe>-1&&g.splice(fe,1);var Te=o[se];for(var Me in Te)Pe.children[Me]=Te[Me];delete o[se]}else{var fe=g.indexOf(se);fe===-1&&g.push(se)}for(var Me in me)h(me[Me].children)}};for(h(o);g.length>0;)h(o);var b=ObjectsUtil.get("util.core.CoreUtil"),E=o[""],S=[],D=function(de){for(var se in de){var me=de[se];S.indexOf(me)>-1||(me.descriptor==="Part"&&!E[se]&&(E[se]=b.clone(me),S.push(E[se])),D(me.children))}};D(E);var j={},j=function(de){for(var se in de)if(!j[se]){j[se]=se;var me=de[se];j(me);var Pe=me.children;for(var fe in Pe){var Te=de[fe];if(Te){j(Te);e:{for(var Me in E[fe].children){me.children[fe].children=E[fe].children;break e}for(var Me in me.children[fe].children){E[fe].children=me.children[fe].children;break e}}}}}};j(E);var p=function(de,se,me,Pe){var fe=b.clone(de,se,me);if(fe.parent=me.id,fe.parentNode=se,fe.id||(fe.id=fe.name),Pe&&(fe.id=Pe+"_"+fe.id),n){var Te=n[fe.id];Te&&(fe.x=Te.x,fe.y=Te.y,fe.h=Te.h,fe.w=Te.w,fe.hasLayoutInformation=!0)}return fe.container=me,fe},C=20,M=20,_=30,T=30,P=M,k=C+_,U=!0;for(var N in E){var R=E[N],e=p(R.args,this,this);!e.x||!e.y?(U||(P=P+M+20),e.x=k,e.y=P,U=!0):U=!1,R.descriptor==="Part"&&(e.isStructureDiagram=!0);var B=ShapesRegistry.draw(R.descriptor,e),H=R.children,I=!1,v=!1,g=[];for(var L in H){var O=H[L],z=p(O.args,this,B,N),V=ShapesRegistry.draw(O.descriptor,z);if(V._incomplete=!0,z.hasLayoutInformation?v=!1:(B.addChild(V),v=!0),O.descriptor==="Part"||O.descriptor==="Port"&&(O.args.isPrivate==="true"||O.args.isPrivate===!0)){I||(k=k+C+_,P=P+M+20,I=!0);var Z=O.children;for(var W in Z){var ie=Z[W];if(ie.descriptor==="Port"){var oe=p(ie.args,this,V,N),K=ShapesRegistry.draw(ie.descriptor,oe);oe.hasLayoutInformation?g.push(K):V.addChild(K)}}var le=V.getPosition();if(le.x+k>650){var G=B.getPosition(),Y=G.y+G.h-20;P=Y+T,k=C+_+C+_}U&&V.shiftPosition({x:k,y:P}),delete V._incomplete;for(var he=0,pe;pe=g[he];he++)V.addChild(pe);g=[],le=V.getPosition();var G=B.getPosition(),ye=le.x+le.w,F=G.x+G.w-40,be=le.y+le.h,Y=G.y+G.h-20,ve=ye-F,we=be-Y;if(we>0||ve>0){var ne={};ve>0&&(ne.w=ve),we>0&&(ne.h=we),B.shiftPosition(ne)}k=k+le.w+C+C+C+C}g=[],v||B.addChild(V),delete V._incomplete}var G=B.getPosition(),F=G.x+G.h-40,G=B.getPosition(),Y=G.y+G.h-20;P=M+Y+T,k=C+_,this.addChild(B)}for(var N in E)for(var ee=ShapesRegistry.get("Part",N),q=0,X;X=s[q];q++){var e=X.args,re=e.sources[0],te=e.targets[0],ue=N+"_"+re;if(ShapesRegistry.get("Port",ue)){var Ce=N+"_"+te;if(ShapesRegistry.get("Port",Ce)){var ge=b.clone(e);ge.sources=[ue],ge.part=N,ge.targets=[Ce],ge.parentNode=this,ge.container=ee,ShapesRegistry.draw(X.descriptor,ge)}}}var Le=ObjectsUtil.get("util.core.DomUtil").position(this.focalNode,!0);this.focalNode.style.height=Y+20+"px",this._incomplete=!1,this.refreshBoundaries();var Se=ShapesRegistry.get("Part"),Ee=ShapesRegistry.getAndGroup("Part");this.adjustShapes(n||{},Ee,Se)}},adjustShapes:function(e,t,n,r){var o=[];for(var a in n){var s=n[a],c=s.getPosition(),d=this._adjustShapes(n[a],e,o,r);if(d&&(d=d-5,s.shiftPosition({x:-(r?d-r:d)})),t){var u=t[s.name];for(var f in u){var g=u[f],h=g.getPosition();for(var b in u)if(b!==f){var E=u[b],S=E.getPosition();if(!(S.x>h.x||Math.abs(S.y-h.y)>50)){for(var D=S.x+S.w,j=0,p;p=E.children[j];j++)if(p.className==="layout.shapes.Port"){var C=parseFloat(p.labelNode.getAttribute("x")),M=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(p.labelNode.childNodes[0].textContent+"...",p.labelNode).w,_=C+M;_>D&&(D=_)}var T=this._adjustShapes(g,e,[],D);T!=h.x&&(T=D-T,g.shiftPosition({x:T}))}}}}}},_adjustShapes:function(e,t,n,r,o){if(!(t[e.id]||n.indexOf(e)>-1)){n.push(e);for(var a=e.getPosition(),s=r||0,c=0,d;d=e.children[c];c++)if(d.className==="layout.shapes.Port"){var u=parseFloat(d.labelNode.getAttribute("x"));u<s&&(s=u)}else if(d.className==="layout.shapes.Part"){var f=this._adjustShapes(d,t,n);if(f<s){var g=d.getPosition();g.x=g.x-f,d.setPosition(g)}}return s}},refreshBoundaries:function(){for(var e=ObjectsUtil.get("util.core.DomUtil").position(this.focalNode,!0),t=e.y+e.h,n=e.x+e.w,r=this.getChildren("partNode"),o=0,a=0,s=0,c;c=r[s];s++)if(c.className==="layout.shapes.Part"){var d=c.getPosition(),n=d.x+d.w;n>a&&(a=n),t=d.y+d.h+20,t>o&&(o=t);var t=d.y+d.h;t>o&&(o=t);for(var u=c.getChildren(),f=0,g;g=u[f];f++){if(g.labelNode){var h=ObjectsUtil.get("util.core.DomUtil").position(g.labelNode);n=h.x+h.w,n>a&&(a=n),t=h.y+h.h,t>o&&(o=t)}for(var b=g.getChildren(),E=0,S;S=b[E];E++)S.labelNode&&(h=ObjectsUtil.get("util.core.DomUtil").position(S.labelNode),n=h.x+h.w,n>a&&(a=n),t=h.y+h.h,t>o&&(o=t))}}var D=parseFloat(this.focalNode.style.height);Math.abs(o-D)>1&&(this.focalNode.style.height=o+10+"px");var j=parseFloat(this.focalNode.style.width);Math.abs(a-j)>1&&(this.focalNode.style.width=a+10+"px")}}),ObjectsUtil.declare("layout.shapes.Part",["layout.shapes.StructureDiagramNode"],{isStructureDiagram:null,multiplicity:null,children:null,focalNode:null,guid:null,iconPart:null,name:null,parent:null,color:null,fontColor:null,rx:null,parentNode:null,strokeWidth:null,height:null,width:null,yCoord:null,xCoord:null,_moving:null,type:null,constructor:function(e){this.isStructureDiagram=e.isStructureDiagram,this.multiplicity=e.multiplicity,this.type="partNode",this.parent=e.parent,this.children=[],this.name=e.name||"Node"+incremntal,this.guid=e.id||this.name,this.color=e.color||DEFAULT_COLOR,this.fontColor=e.fontColor||DEFAULT_FONT_COLOR,this.rx=e.rx||DEFAULT_ROUND_RATIO,this.strokeWidth=e.strokeWidth||1,this.strokeWidth=this.strokeWidth+"px",incremntal++},addChild:function(e){var t=ObjectsUtil.get("util.core.CoreUtil");if(t.isArray(e))for(var n=0,r;r=e[n];n++)this.children.push(r);else this.children.push(e);this.applyConstraints()},getChildren:function(e,t){if(e){for(var n=[],r=0,o;o=this.children[r];r++)if(o.type===e){var a=!0;if(t){for(var s in t)if(t[s]?t[s]!==o[s]:o[s]){a=!1;break}}a&&n.push(o)}return n}return this.children},draw:function(e){var t=this.getSuperContainer().settings;this.part_highlight_color=t.part_highlight_color||"#5DBCD2",this.part_container_highlight_color=t.part_container_highlight_color||"#FFFFFF",this.part_container_label_highlight_color=t.part_container_label_highlight_color||"#e6e6e6";var n=ObjectsUtil.get("util.core.CoreUtil"),r=ObjectsUtil.get("util.core.DomUtil");this.focalNode=document.createElementNS(SVGUtil.SVG,"g");var o=Events.connect("mousemove",this.focalNode,this,function(s){if(!this.__resizeStarted){var c=this,d=function(){delete c.__resizeStarted,Events.disconnect(c._tempResizeMouseUpHandler),Events.disconnect(c._tempResizeMouseDownHandler),Events.disconnect(c._tempResizeMouseMoveHandler),c.focalNode.style.cursor="",delete c._tempResizeMouseDownHandler},u=!1,f=r.position(this.focalNode),g=f.x+f.w,h=s.clientX-g;if(Math.abs(h)<10)this.focalNode.style.cursor="col-resize",u=!0;else{var b=f.y+f.h,E=s.clientY-b;Math.abs(E)<10&&(this.focalNode.style.cursor="row-resize",u=!0)}Events.disconnect(this._tempResizeMouseDownHandler),Events.disconnect(this._tempResizeMouseOutHandler),u?(this._tempResizeMouseDownHandler=Events.connect("mousedown",document,this,function(S){this.__resizeStarted&&d(),Events.disconnect(this._tempResizeMouseOutHandler),n.stopEvent(S),this.__resizeStarted=!0,this._tempResizeMouseUpHandler=Events.connect("mouseup",document,this,function(D){n.stopEvent(D),d(),this.getSuperContainer().refreshBoundaries()}),this._tempResizeMouseMoveHandler=Events.connect("mousemove",document,this,function(D){if(n.stopEvent(D),!this._tempResizeMouseDownHandler){d();return}for(var j=this.getChildren(),p=0,C=0,M=0,_;_=j[M];M++)if(_.className==="layout.shapes.Part"){var T=r.position(_.focalNode),P=T.x+T.w;P>C&&(C=P);var k=T.y+T.h;k>p&&(p=k)}var U={},N=r.position(this.focalNode),R=!1;this._tempResizeMouseDownHandler.verticalDiff?D.clientY>p&&(U.h=D.clientY-N.y,R=!0):this._tempResizeMouseDownHandler.horizontalDiff&&D.clientX>C&&(U.w=D.clientX-N.x,R=!0),R&&this.setPosition(U)})}),this._tempResizeMouseDownHandler.horizontalDiff=h,this._tempResizeMouseDownHandler.verticalDiff=E,this._tempResizeMouseOutHandler=Events.connect("mouseout",this.focalNode,this,function(S){d()})):d()}});this.focalNode.setAttribute("style","fill: "+this.color+"; font-family:'sans-serif';"),this.parentNode.appendChild(this.focalNode),this.rectNode=document.createElementNS(SVGUtil.SVG,"rect"),this.rectNode.setAttribute("style","stroke:#000000;"),this.rectNode.setAttribute("fill","#FFFFFF"),this.focalNode.appendChild(this.rectNode),this.highlightNode=document.createElementNS(SVGUtil.SVG,"rect"),this.highlightNode.setAttribute("style","stroke:#000000;"),this.isStructureDiagram?this.highlightNode.setAttribute("fill",this.part_container_highlight_color):this.highlightNode.setAttribute("fill",this.part_highlight_color),this.focalNode.appendChild(this.highlightNode),this.nameNode=document.createElementNS(SVGUtil.SVG,"text"),this.nameNode.setAttribute("style","fill: #000000;  font-family:tahoma; font-size: 10; font-weight:bold"),this.nameNode.appendChild(document.createTextNode(e.name)),this.focalNode.appendChild(this.nameNode),this.isStructureDiagram||(this.iconPart=ShapesRegistry.draw("PartIcon",{parentNode:this.focalNode})),this.setPosition({x:e.x,y:e.y,h:e.h,w:e.w});var a=Events.connect("mousedown",this.focalNode,this,function(s){this._tempResizeMouseDownHandler||this.handleMove(this.focalNode,s)}),a=Events.connect("mousedown",this.highlightNode,this,function(s){this._tempResizeMouseDownHandler||this.handleMove(this.focalNode,s)})},updatePosition:function(e){var t=ObjectsUtil.get("util.core.DomUtil").transformValue(this.focalNode);if(t.h=parseFloat(this.rectNode.getAttribute("height")),t.w=parseFloat(this.rectNode.getAttribute("width")),e.h&&(t.h=t.h+e.h),e.w){t.w=t.w+e.w;for(var n=this.getChildren("portNode"),r=0,o;o=n[r];r++)StructureDiagramUtil.portToPart(o,function(a,s,c,d){if(c==="right"){var u=o.getPosition();o.shiftPosition({x:e.w},!0)}})}this.setPosition(t,!0)},shiftPosition:function(e,t){var n={x:this.xCoord,y:this.yCoord,h:this.height,w:this.width};for(var r in e)n[r]=(n[r]||0)+e[r];this.setPosition(n,t)},setPosition:function(e,t){var n=ObjectsUtil.get("util.core.CoreUtil"),r=this.getPosition(),o=parseFloat(e.x)||this.xCoord||0,a=parseFloat(e.y)||this.yCoord||0,s=parseFloat(e.h)||this.height||40,c=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(this.nameNode.childNodes[0].textContent+"...",this.nameNode).w,d=parseFloat(e.w)||this.width||c+75;if(s<40&&(s=40),d<c+75&&(d=c+75),this.highlightNode.setAttribute("height",20),this.highlightNode.setAttribute("width",d),this.rectNode.setAttribute("height",s),this.rectNode.setAttribute("width",d),this.isStructureDiagram||this.iconPart.setPosition({x:d-25,y:6}),this.focalNode.setAttribute("transform","translate("+o+","+a+")"),!this.isStructureDiagram&&this.multiplicity==="*"&&(this.shadowNode||(this.shadowNode=document.createElementNS(SVGUtil.SVG,"rect"),this.shadowNode.setAttribute("style","stroke:#000000;"),this.shadowNode.setAttribute("fill","none"),this.focalNode.insertBefore(this.shadowNode,this.focalNode.firstChild)),this.shadowNode.setAttribute("transform","translate(3,-3)"),this.shadowNode.setAttribute("height",s),this.shadowNode.setAttribute("width",d)),this.nameNode.setAttribute("y","15"),this.isStructureDiagram){this.nameNode.setAttribute("x","15"),this.nameNode.highlight?(this.nameNode.parentNode.removeChild(this.nameNode.highlight),this.nameNode.parentNode.insertBefore(this.nameNode.highlight,this.nameNode),this.nameNode.parentNode.removeChild(this.nameNode.highlight.border),this.nameNode.parentNode.insertBefore(this.nameNode.highlight.border,this.nameNode)):(this.nameNode.highlight=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.nameNode.highlight.setAttribute("style","fill:"+this.part_container_label_highlight_color+";"),this.nameNode.parentNode.insertBefore(this.nameNode.highlight,this.nameNode),this.nameNode.highlight.border=document.createElementNS(SVGUtil.SVG,"polygon"),this.nameNode.highlight.border.setAttribute("style","stroke:black;stroke-width:1;"),this.nameNode.parentNode.insertBefore(this.nameNode.highlight.border,this.nameNode)),this.nameNode.highlight.setAttribute("x","1"),this.nameNode.highlight.setAttribute("y","1"),this.nameNode.highlight.setAttribute("width",c+10),this.nameNode.highlight.setAttribute("height",18);var u=0,f=0;!n.browserSettings()||n.browserSettings().browser!=="chrome"?(u=2,f=18):(u=0,f=20),this.nameNode.highlight.border.setAttribute("points",c+11+","+u+" "+(c+11)+","+f)}else this.nameNode.setAttribute("x",d/2-c/2);if(!t){var g=this.getPosition(),h=g.x-r.x,b=g.y-r.y;if(h!==0||b!==0)for(var E=0,S;S=this.children[E];E++)(S.className==="layout.shapes.Port"||S.className==="layout.shapes.Part")&&S.shiftPosition({x:h,y:b});this.applyConstraints()}if(this.xCoord=o,this.yCoord=a,this.height=s,this.width=d,this.container&&this.container.getPrecisePosition){var D=this.container.getPrecisePosition(),j=this.yCoord+this.height,p=this.xCoord+this.width,C=D.y+D.h-20,M=D.x+D.w-20,_=j-C,T=p-M;if(_>0||T>0){var P={},k=!1;_>0&&(P.h=_+20,k=!0),T>10&&(P.w=T+20,k=!0),k&&this.container.shiftPosition(P)}}this.refreshBoundaries()},refreshBoundaries:function(){var e=this.getSuperContainer();e._incomplete||e.refreshBoundaries()},getPosition:function(){var e=ObjectsUtil.get("util.core.DomUtil"),t=e.position(this.focalNode,!0),n=this.focalNode.getBoundingClientRect(),r=this.focalNode.parentNode.parentNode.getBoundingClientRect();t.x=n.left-r.left,t.y=n.top-r.top,t.y=t.y+8-parseInt(window.getComputedStyle(this.focalNode.parentNode.parentNode,null).getPropertyValue("padding-top")),t.x=t.x+8-parseInt(window.getComputedStyle(this.focalNode.parentNode.parentNode,null).getPropertyValue("padding-left"));var o=e.getFirstParent(this.focalNode,"svg").parentNode,a=o.scrollLeft,s=o.scrollTop;return t.x=t.x+(a||0),t.y=t.y+(s||0),this.shadowNode&&(t.w=t.w-3,t.h=t.h-3),t},getPrecisePosition:function(){return{h:this.height,w:this.width,y:this.yCoord,x:this.xCoord}},applyConstraints:function(){if(!this._incomplete){for(var e=this.getPosition(),t=this.getPosition(),n=0,r=0,o;o=this.children[r];r++)o.className==="layout.shapes.Port"?o.applyConstraints():o.className;t.w!==e.w&&this.setPosition(t,!0)}},handleMove:function(e,t){var n=ObjectsUtil.get("util.core.DomUtil"),r=ObjectsUtil.get("util.core.CoreUtil"),o=n.getFirstParent(e,"svg"),a=e.parentNode.getScreenCTM(),s=o.createSVGPoint();s.x=t.clientX,s.y=t.clientY,s=s.matrixTransform(a.inverse());var c=this.getPrecisePosition(),d=parseFloat(s.x)-parseFloat(c.x),u=parseFloat(s.y)-parseFloat(c.y),f;this.container.getPrecisePosition&&(f=this.container.getPrecisePosition()),this._moving=e;var g=Events.connect("onselectstart",document,this,function(E){r.stopEvent(E)}),h=Events.connect("mousemove",document,this,function(E){var S=this,D=e.parentNode.getScreenCTM(),j=o.createSVGPoint();j.x=E.clientX,j.y=E.clientY,j=j.matrixTransform(D.inverse());var p={},C=S.getPrecisePosition();p.y=j.y,p.x=j.x;var M=S.container[S.container.getPrecisePosition?"getPrecisePosition":"getPosition"]();if(!(p.x-d<M.x)&&!(p.y-u<M.y)&&(S.setPosition({x:p.x-d,y:p.y-u}),f)){var M=S.container.getPrecisePosition(),_=S.yCoord+S.height,T=S.xCoord+S.width,P=f.y+f.h,k=f.x+f.w,U=_-P,N=T-k;U<0&&N<0&&S.container.setPosition(f)}}),b=Events.connect("mouseup",document,this,function(){Events.disconnect(h),Events.disconnect(b),Events.disconnect(g),this._moving=void 0,this.getSuperContainer().refreshBoundaries(),Events.publish("structure.diagram.node.move."+this.id)});r.stopEvent(t)}});var ICON_WIDTH=12,ICON_HEIGHT=10;ObjectsUtil.declare("layout.shapes.PartIcon",["layout.shapes.AbstractNode"],{draw:function(e){this.iconNode=document.createElementNS(SVGUtil.SVG,"rect"),this.iconNode.setAttribute("style","stroke:#000000;"),this.iconNode.setAttribute("height",ICON_HEIGHT),this.iconNode.setAttribute("width",ICON_WIDTH),this.iconNode.setAttribute("fill","none"),this.parentNode.appendChild(this.iconNode)},setPosition:function(e){var t=parseFloat(e.x)||0,n=parseFloat(e.y)||0,r=2,o=1,a=2,s=6;this.iconNode.setAttribute("x",t),this.iconNode.setAttribute("y",n),this.iconNodePart1?this.parentNode.removeChild(this.iconNodePart1):this.iconNodePart1=document.createElementNS(SVGUtil.SVG,"rect"),this.iconNodePart1.setAttribute("style","stroke:#000000;"),this.iconNodePart1.setAttribute("height",a),this.iconNodePart1.setAttribute("width",s),this.iconNodePart1.setAttribute("y",n+r),this.iconNodePart1.setAttribute("x",t-s/2),this.iconNodePart1.setAttribute("fill","#5DBCD2"),this.parentNode.appendChild(this.iconNodePart1),this.iconNodePart2?this.parentNode.removeChild(this.iconNodePart2):this.iconNodePart2=document.createElementNS(SVGUtil.SVG,"rect"),this.iconNodePart2.setAttribute("style","stroke:#000000;"),this.iconNodePart2.setAttribute("height",a),this.iconNodePart2.setAttribute("width",s),this.iconNodePart2.setAttribute("y",n+r+a+r),this.iconNodePart2.setAttribute("x",t-s/2),this.iconNodePart2.setAttribute("fill","#5DBCD2"),this.parentNode.appendChild(this.iconNodePart2)}});var PortSymbols=ObjectsUtil.define("layout.shapes.Port.PortSymbols",{right:function(e){e.symbol=document.createElementNS(SVGUtil.SVG,"polygon"),e.symbol.setAttribute("points","8,2 2.5,5 8,8"),e.symbol.setAttribute("style","fill:black;stroke:#000000;stroke-width:1"),e.containerNode.appendChild(e.symbol)},left:function(e){e.symbol=document.createElementNS(SVGUtil.SVG,"polygon"),e.symbol.setAttribute("points","2.5,2 8,5 2.5,8"),e.symbol.setAttribute("style","fill:#000000;stroke:#000000;stroke-width:1"),e.containerNode.appendChild(e.symbol)},twoArrows:function(e){var t=function(n,r,o,a){var s=document.createElementNS(SVGUtil.SVG,"line");s.setAttribute("x1",n),s.setAttribute("y1",r),s.setAttribute("x2",o),s.setAttribute("y2",a),s.setAttribute("style","fill:#000000;stroke:#000000;stroke-width:1"),e.containerNode.appendChild(s)};t("4","2","8.5","4"),t("1.5","4","8.5","4"),t("1.5","6","8.5","6"),t("1.5","6","6","8")},conjugated:function(e){var t=PortSymbols._drawCircleSymbol(e,"Conjucated port");t.setAttribute("style","stroke: black;")},conjugatedReplicated:function(e){var t=PortSymbols._drawCircleSymbol(e,"Conjucated replicated port");t.setAttribute("style","stroke: black;"),e.set3D()},replicatedEndPort:function(e){PortSymbols.endPort(e,"Replicated end port"),e.set3D()},endPort:function(e,t){var n=PortSymbols._drawCircleSymbol(e,t||"End port"),r=e.focalNode.getAttribute("fill");n.setAttribute("style","stroke: "+r+";"),n.setAttribute("fill",r),e.focalNode.setAttribute("fill","#000000")},conjucatedReplicatedRelayPort:function(e){var t=PortSymbols._drawRectSymbol(e,"Conjucated replicated relay port");t.setAttribute("style","stroke: black;"),e.set3D()},conjucatedRelayPort:function(e){var t=PortSymbols._drawRectSymbol(e,"Conjucated relay port");t.setAttribute("style","stroke: black;")},replicatedRelayPort:function(e){PortSymbols.relayPort(e,"Replicated relay port"),e.set3D()},relayPort:function(e,t){var n=PortSymbols._drawRectSymbol(e,t||"Relay port");n.setAttribute("style","stroke: black;");var r=e.focalNode.getAttribute("fill");n.setAttribute("style","stroke: "+r+";"),n.setAttribute("fill",r),e.focalNode.setAttribute("fill","#000000")},_drawCircleSymbol:function(e,t){var n=document.createElementNS(SVGUtil.SVG,"circle");return n.setAttribute("fill","#000000"),n.setAttribute("r",3),n.setAttribute("cx",5),n.setAttribute("cy",5),e.containerNode.appendChild(n),PortSymbols._appendTooltip(t,e,n),n},_drawRectSymbol:function(e,t){var n=document.createElementNS(SVGUtil.SVG,"rect");return n.setAttribute("fill","#000000"),n.setAttribute("height",4),n.setAttribute("width",4),n.setAttribute("x",3),n.setAttribute("y",3),e.containerNode.appendChild(n),PortSymbols._appendTooltip(t,e,n),n},_appendTooltip:function(e,t,n){e&&(n.titleElement=document.createElementNS(SVGUtil.SVG,"title"),t.focalNode.appendChild(n.titleElement),n.titleElement.appendChild(document.createTextNode(e)),n.titleElement=document.createElementNS(SVGUtil.SVG,"title"),n.appendChild(n.titleElement),n.titleElement.appendChild(document.createTextNode(e)))}}),ConnectorSymbols=ObjectsUtil.define("layout.shapes.connector.ConnectorSymbols",{draw:function(e,t,n,r){return ConnectorSymbols._draw(e,t,n,r)},_draw:function(e,t,n,r){if(e.connectorSymbol)e.parentNode.removeChild(e.connectorSymbol),e.parentNode.appendChild(e.connectorSymbol);else{e.connectorSymbol=document.createElementNS(SVGUtil.SVG,"g"),e.connectorSymbol.setAttribute("fill","none");var o=5,a=4,s="";t.indexOf("provide")>-1&&(e.connectorSymbol.path=document.createElementNS(SVGUtil.SVG,"path"),e.connectorSymbol.path.setAttribute("style","stroke: #000000;"),e.connectorSymbol.appendChild(e.connectorSymbol.path),s="Provide"),t.indexOf("require")>-1&&(e.connectorSymbol.circle1=document.createElementNS(SVGUtil.SVG,"circle"),e.connectorSymbol.circle1.setAttribute("style","stroke: black;"),e.connectorSymbol.circle1.setAttribute("r",o),e.connectorSymbol.appendChild(e.connectorSymbol.circle1),e.connectorSymbol.setAttribute("fill","white"),s&&(s=s+"\\"),s=s+"Require"),s&&(e.connectorSymbol.title=document.createElementNS(SVGUtil.SVG,"title"),e.connectorSymbol.appendChild(e.connectorSymbol.title),e.connectorSymbol.title.appendChild(document.createTextNode(s))),e.parentNode.appendChild(e.connectorSymbol)}if(e.connectorSymbol.path){var o=5,a=4,c=o+a,d=c*-1;if(r)if(n==="vertical")var u=d+",0",f=c+",0";else var u="0,"+d,f="0,"+c;else if(n==="vertical")var f=d+",0",u=c+",0";else var f="0,"+d,u="0,"+c;var g="M"+u+(" A"+o+","+o)+" 0 0,1 "+f;e.connectorSymbol.path.setAttribute("d",g)}return e.connectorSymbol}}),LABEL_FONT_SETTINGS={fontSize:10,fontFamily:"arial, serif",fontWeight:"normal"};ObjectsUtil.declare("layout.shapes.Port",["layout.shapes.StructureDiagramNode"],{focalNode:null,guid:null,isPrivate:null,connectors:null,name:null,color:null,fontColor:null,rx:null,parentNode:null,strokeWidth:null,_moving:null,type:null,portType:null,constructor:function(e){this.type="portNode",this.isPrivate=e.isPrivate==="true"||e.isPrivate===!0,this.multiplicity=e.multiplicity,this.connectors={sources:[],targets:[]},this.portType=e.portType,this.name=e.name||"Node"+incremntal,this.guid=e.id||this.name,this.color=e.color||DEFAULT_COLOR,this.fontColor=e.fontColor||DEFAULT_FONT_COLOR,this.rx=e.rx||DEFAULT_ROUND_RATIO,this.strokeWidth=e.strokeWidth||1,this.strokeWidth=this.strokeWidth+"px",incremntal++},addConnector:function(e,t){var n=ObjectsUtil.get("util.core.CoreUtil");if(n.isArray(e))for(var r=0,o;o=e[r];r++)this.connectors[t].indexOf(o)>-1||this.connectors[t].push(o);else this.connectors[t].indexOf(e)==-1&&this.connectors[t].push(e)},draw:function(args){var settings=this.getSuperContainer().settings;this.portFillColor=settings.portFillColor||"#FFFFCC",this.containerNode=document.createElementNS(SVGUtil.SVG,"g"),this.parentNode.appendChild(this.containerNode),this.focalNode=document.createElementNS(SVGUtil.SVG,"rect"),this.focalNode.setAttribute("style","stroke:#000000;"),this.focalNode.setAttribute("height","10"),this.focalNode.setAttribute("width","10"),this.focalNode.setAttribute("fill",this.portFillColor),this.containerNode.appendChild(this.focalNode);var CoreUtil=ObjectsUtil.get("util.core.CoreUtil"),DomUtil=ObjectsUtil.get("util.core.DomUtil"),typeSymbol=args.typeSymbol;if(typeSymbol){if(typeSymbol.indexOf("(function")>-1){var typeSymboleEval=eval(typeSymbol);CoreUtil.isFunction(typeSymboleEval)&&typeSymboleEval(this)}}else{var portType=args.portType,mappedFunction=PortSymbols[portType];mappedFunction&&mappedFunction(this)}this.labelNode=document.createElementNS(SVGUtil.SVG,"text"),this.labelNode.setAttribute("style","fill: #000000;  font-family:"+LABEL_FONT_SETTINGS.fontFamily+"; font-size: "+LABEL_FONT_SETTINGS.fontSize+";  font-weight:"+LABEL_FONT_SETTINGS.fontWeight+";");var portLabelText=args.name;args.multiplicity!==void 0&&(portLabelText=portLabelText+"["+args.multiplicity+"]"),this.labelNode.appendChild(document.createTextNode(portLabelText)),this.parentNode.appendChild(this.labelNode);var partObject=this.container;if(args.x!==void 0&&args.y!==void 0)this.setPosition({x:args.x,y:args.y},!0);else if(!this.isPrivate){for(var x,y,delta,position=partObject.getPosition(),portPosition=this.getPosition(),children=partObject.getChildren("portNode",{isPrivate:void 0}),adjustedLength=children.length,w=this.getPosition().w,direction=children.length%10,partMax=position.x+position.w,index=0,child;child=children[index];index++)StructureDiagramUtil.portToPart(child,function(e,t,n,r){if(!(n==="right"||n==="left")){var o=DomUtil.calculateTextSize(child.labelNode.childNodes[0].textContent,child.labelNode).w,a=child.getPosition(),s=child.getPosition().x,c=s+o/2;if(!(partMax<c+a.w*2||partMax<s+a.w*2)){var d=o/2+w/2,u=position.w/6;d>position.w/5-15&&direction++,d>position.w/4&&direction++}}});var self=this;if(direction<10){var directionFinder=function(e,t){e===0?(delta=position.h/2/2-5,x=position.x-portPosition.w,y=position.y+position.h/2-portPosition.h-delta):e===1?(delta=position.h/2/2,x=position.x-portPosition.w,y=position.y+position.h/2-portPosition.h+delta):e===2?(delta=position.w/2/2,x=position.x-portPosition.w+position.w/2-delta,y=position.y-portPosition.h):e===3?(x=position.x-portPosition.w+position.w/2,y=position.y-portPosition.h):e===4?(delta=position.w/2/2,x=position.x-portPosition.w+position.w/2+delta,y=position.y-portPosition.h):e===5?(delta=position.h/2/2,x=position.x+position.w-portPosition.w,y=position.y+position.h/2-portPosition.h-delta):e===6?(delta=position.h/2/2,x=position.x+position.w-portPosition.w,y=position.y+position.h/2-portPosition.h+delta):e===7?(delta=position.w/2/2,x=position.x-portPosition.w+position.w/2-delta,y=position.y+position.h-portPosition.h):e===8?(x=position.x-portPosition.w+position.w/2,y=position.y+position.h-portPosition.h):e===9&&(delta=position.w/2/2,x=position.x-portPosition.w+position.w/2+delta,y=position.y+position.h-portPosition.h)};directionFinder(direction)}else{var start=children.length-10,direction=start%8,endY=position.y+position.h-20;if(direction<6){var byIndex=(parseFloat(direction/2)+(start-direction+1)/3)*portPosition.h;byIndex||(byIndex=4);var delta=parseInt(start/8)+byIndex+portPosition.h*2,right=direction%2;if(right)var x=position.x-portPosition.w+position.w;else{var x=position.x-portPosition.w,y=position.y+position.h/2-portPosition.h+delta,diff=y-endY;diff>0&&partObject.updatePosition({h:diff})}var updatedPosition=partObject.getPosition(),y=updatedPosition.y+updatedPosition.h-portPosition.h*2+4}else if(direction%2===0){var x=position.x+position.w-portPosition.w/2,y=position.y-portPosition.h;partObject.updatePosition({w:30})}else var x=position.x+position.w-parseFloat(portPosition.w*3),y=position.y+position.h-portPosition.h}for(var childIndex=0,child;child=children[childIndex];childIndex++)child.applyConstraints();this.setPosition({x,y})}this.applyConstraints();var mouseDownHandler=Events.connect("mousedown",this.containerNode,this,function(e){this.handleMove(this.focalNode,e)}),mouseDownHandler=Events.connect("mousedown",this.labelNode,this,function(e){this.handleMove(this.focalNode,e)})},setPosition:function(e,t){xCoord=parseFloat(e.x)||0,yCoord=parseFloat(e.y)||0,this.containerNode.setAttribute("transform","translate("+xCoord+","+yCoord+")"),this.multiplicity==="*"&&this.set3D();var n=this;StructureDiagramUtil.portToPart(this,function(o,a,s,c){if(s==="right")n.labelNode.setAttribute("x",o+2),n.labelNode.setAttribute("y",a-1);else if(s==="top"){var d=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(n.labelNode.childNodes[0].textContent,n.focalNode);n.labelNode.setAttribute("x",o-parseFloat(d.w/2)),n.labelNode.setAttribute("y",a-parseFloat(c.h/2))}else if(s==="left"){var d=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(n.labelNode.childNodes[0].textContent,n.labelNode);n.labelNode.setAttribute("x",parseFloat(o-(d.w+c.w))),n.labelNode.setAttribute("y",a)}else if(s==="bottom"){var d=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(n.labelNode.childNodes[0].textContent,n.focalNode);n.labelNode.setAttribute("x",o-parseFloat(d.w/2)),n.labelNode.setAttribute("y",a+parseFloat(c.h))}t||n.applyConstraints()});var r=n.labelNode.parentNode;r.removeChild(n.labelNode),r.appendChild(n.labelNode)},set3D:function(){this.shadowNode||(this.shadowNode=document.createElementNS(SVGUtil.SVG,"rect"),this.shadowNode.setAttribute("style","stroke:#000000;"),this.shadowNode.setAttribute("fill",this.portFillColor||"#FFFFFF"),this.containerNode.insertBefore(this.shadowNode,this.containerNode.firstChild)),this.shadowNode.setAttribute("transform","translate(1,-2)"),this.shadowNode.setAttribute("height",11),this.shadowNode.setAttribute("width",11)},applyConstraints:function(){var e=this.container;if(!(!e||e._incomplete)){var t=ObjectsUtil.get("util.core.CoreUtil"),n=this.getPosition(),r=e.getPosition();if(this.isPrivate){var o=!1,a=r.x+r.w-n.w-n.w,s=r.x+n.w,c=r.y+r.h-n.h-n.h,d=r.y+n.h,u=t.clone(n);u.x<s?(u.x=s,o=!0):u.x>a&&(u.x=a,o=!0),u.y<d?(u.y=d,o=!0):u.y>c&&(u.y=c,o=!0),o&&this.setPosition(u,!0)}else{var f=!0,u=t.clone(n),g=function(){var M=r.y-n.h,_=r.y+r.h-n.h,T=Math.abs(u.y-M),P=Math.abs(u.y-_);P<=T?u.y=_:u.y=M};if(n.x<r.x-n.w)u.x=r.x-n.w;else if(n.x>r.x+r.w-n.w)u.x=r.x+r.w-n.w;else{var h=r.x+r.w-n.w,b=r.x-n.w,E=u.x;StructureDiagramUtil.portToPart(this,function(M,_,T,P,k,U){k?g():T==="bottom"?Math.abs(U.deltaBottom)>1&&(u.y=u.y+U.deltaBottom):T==="top"?Math.abs(U.deltaTop)>1&&(u.y=u.y-U.deltaTop):T==="right"?Math.abs(U.deltaRight)>1&&(u.x=u.x+U.deltaRight):T==="left"&&Math.abs(U.deltaLeft)>1&&(u.x=u.x-U.deltaLeft)}),f=!1}if(f){var h=r.y+r.h-n.h,b=r.y-n.h,E=n.y-n.h;(E<b||E>h)&&g()}var S=r.x-n.w,D=r.x+r.w-n.w,j=r.y-n.h,p=r.y+r.h-n.h;u.x<S&&(u.x=S),u.x>D&&(u.x=D),u.y<j&&(u.y=j),u.y>p&&(u.y=p),(parseInt(u.x)!==parseInt(n.x)||parseInt(u.y)!==parseInt(n.y)||parseInt(u.h)!==parseInt(n.h)||parseInt(u.w)!==parseInt(n.w))&&this.setPosition(u,!0)}}},getPosition:function(){var e=ObjectsUtil.get("util.core.DomUtil").transformValue(this.containerNode);return e.w=13,e.h=13,e},handleMove:function(e,t){var n=ObjectsUtil.get("util.core.DomUtil"),r=ObjectsUtil.get("util.core.CoreUtil"),o=n.getFirstParent(e,"svg"),a=e.parentNode.getScreenCTM(),s=o.createSVGPoint(),c=n.scrollValue(e);s.x=t.clientX+c.x,s.y=t.clientY+c.y,s=s.matrixTransform(a.inverse());var d=this.getPosition(),u=parseFloat(s.x)-parseFloat(d.x),f=parseFloat(s.y)-parseFloat(d.y);this._moving=e;var g=Events.connect("onselectstart",document,this,function(E){r.stopEvent(E)}),h=Events.connect("mousemove",document,this,function(E){var S=this,D=e.parentNode.getScreenCTM(),j=o.createSVGPoint();j.x=E.clientX,j.y=E.clientY,j=j.matrixTransform(D.inverse());var p={};this.isPrivate?(p.y=j.y,p.x=j.x):StructureDiagramUtil.portToPart(this,function(C,M,_,T,P){P?(p.y=j.y,p.x=j.x):_==="left"||_==="right"?p.y=j.y:p.x=j.x}),S.shiftPosition(p),r.stopEvent(E)}),b=Events.connect("mouseup",document,this,function(){Events.disconnect(h),Events.disconnect(b),Events.disconnect(g),this._moving=void 0,this.getSuperContainer().refreshBoundaries(),Events.publish("structure.diagram.node.move."+this.id)});r.stopEvent(t)}});var Events=ObjectsUtil.get("util.core.Events"),incremntal=0,sources=[];ObjectsUtil.declare("layout.shapes.PortConnector",["layout.shapes.StructureDiagramNode"],{focalNode:null,guid:null,name:null,color:null,fontColor:null,rx:null,parentNode:null,strokeWidth:null,_moving:null,type:null,connectorType:null,constructor:function(e){this.connectorType=e.connectorType,this.type="portConnector",this.name=e.name||"Connector"+incremntal,this.guid=e.id||this.name,this.sources=e.sources,this.targets=e.targets,this.part=e.part,incremntal++,this.points=e.points},draw:function(e){var t=["red","green","blue","brown","black","orange","lime"],t=["black","black","black","black","black","black","black","black"];sources.indexOf(this.sources[0])===-1&&sources.push(this.sources[0]);var n=t[sources.indexOf(this.sources[0])];if(this.focalNode=document.createElementNS(SVGUtil.SVG,"polyline"),this.focalNode.setAttribute("style","fill:none;stroke:"+n+";stroke-width:1px;"),this.parentNode.appendChild(this.focalNode),this.points)this.focalNode.setAttribute("points",this.points);else{this.setPosition();for(var r=0,o;o=["sources","targets"][r];r++)for(var a=0,s;s=this[o][a];a++){var c=ShapesRegistry.get("Port",s);c.addConnector(this,o),Events.connect("setPosition",c,this,function(d){this.setPosition(d)}),this.container.applyConstraints()}}},setPosition:function(e){if(this.sources[0]===this.targets[0])return this.focalNode.setAttribute("points","");var t=[],n=this.targets[0],r=this.sources[0],o=ShapesRegistry.get("Port",n),a=ShapesRegistry.get("Port",r);if(o.getPosition().x<a.getPosition().x){var s=r;r=n,n=s}var c=function(q,X,re){t.push({x:q,y:X,direction:re})},d=function(q){q.direction==="left"?(q.x=q.x,q.y=q.y+5):q.direction==="right"?(q.x=q.x+10,q.y=q.y+5):q.direction==="top"?(q.x=q.x+5,q.y=q.y):q.direction==="bottom"&&(q.y=q.y+10,q.x=q.x+5)},u=ShapesRegistry.get("Port",r),f=u.container,g=f.getPosition(),h=u.getPosition();StructureDiagramUtil.portToPart(r,c);var b=ShapesRegistry.get("Port",n),E=b.container,S=E.getPosition(),D=b.getPosition();StructureDiagramUtil.portToPart(n,c);var j=f===E,I=[],p=t[0];if(t[0]){h.direction=p.direction;var C=t[1];if(C){D.direction=C.direction;var M=u.getPosition(),_=b.getPosition(),T=!1,P=this,k=function(q,X,re,te){X.isPrivate?te.direction==="left"?q.direction="right":te.direction==="top"?q.direction="bottom":te.direction==="bottom"?q.direction="top":te.direction==="right"&&(q.direction="left"):X.parent===P.part&&(re.isPrivate||re.parent!==P.part)&&(q.direction==="left"?q.direction="right":q.direction==="top"?q.direction="bottom":q.direction==="bottom"?q.direction="top":q.direction==="right"&&(q.direction="left"))};u.isPrivate?(k(D,b,u,h),k(h,u,b,D)):(k(h,u,b,D),k(D,b,u,h));var U=h.direction,N={x:D.x,y:D.y,direction:D.direction};d(N);var R={x:N.x,y:N.y},B={x:h.x,y:h.y,direction:h.direction},H=function(q){var X={};return q.direction==="left"?(X.x=q.x-10,X.y=q.y):q.direction==="right"?(X.x=q.x+10,X.y=q.y):q.direction==="top"?(X.x=q.x,X.y=q.y-10):q.direction==="bottom"&&(X.x=q.x,X.y=q.y+10),X.direction=q.direction,X},I=[],v={x:h.x,y:h.y,direction:h.direction};d(v),I.push(v);var L=H(v);I.push(L);var O={x:D.x,y:D.y,direction:D.direction};d(O);var z=H(O);I.push({x:z.x,y:L.y}),I.push(z),I.push(O);var V=function(){for(var q=I.length,X=0;X<q-1;X++){var re=I[X],te=I[X+1],ue=I[X+2],Ce=function(se){return ue?re[se]===te[se]&&te[se]===ue[se]:!1};if(Ce("y")){var ge=0;if(h.direction==="left"&&D.direction==="left"){var Le=I[X+3];if(Le)var Se=Le.y-re.y;else var Se=S.y-re.y-h.h*1.5}else if(h.direction==="left"&&D.direction==="bottom"){var Se=S.y-re.y-h.h*1.5;if(S.x>g.x&&g.y<S.y)var ge=S.x-re.x-h.h*1.5}else var Se=g.y+g.h-te.y;var Ee=void 0;te.x<re.x&&te.x<ue.x?(Ee=te.y+Se,I.splice(X+2,0,{x:te.x+ge,y:Ee})):ue.y<re.y&&ue.y<te.y&&(Ee=te.y-Se,I.splice(X+2,0,{x:re.x,y:Ee})),Ee&&(ue.y=Ee)}else if(Ce("x")){if(h.direction==="bottom"&&D.direction==="top")var Se=S.x+S.w-re.x;else if((h.direction==="right"||h.direction==="bottom")&&(te.direction==="top"||te.direction==="bottom")||h.direction==="top"&&(ue.direction==="bottom"||ue.direction==="top")){if(E===f&&(b.isPrivate||u.isPrivate))var Se=D.x-re.x-h.h;else var Se=S.x-re.x-h.h*1.5;if(h.direction==="bottom"&&D.direction==="bottom"&&h.y<D.y){var de=I[X-1];de&&(de.y=te.y,re.y=te.y)}}else var Se=S.x+S.w-re.x;var Ee=void 0;te.y<re.y&&te.y<ue.y?I[X+1].direction===I[X+2].direction&&!I[X+3]&&D.direction!=="top"?I.splice(X+1,1):(Ee=te.x+Se,I.splice(X+2,0,{x:ue.x,y:te.y})):te.y>re.y&&te.y>ue.y&&(Ee=te.x+Se,I.splice(X+2,0,{x:ue.x,y:te.y})),Ee&&(re.x=Ee,te.x=Ee)}}};V();var Z=function(){for(var q=[],X=1;X<I.length-5;X++){var re=I[X],te=I[X+1],ue=I[X+2],Ce=I[X+3];if(re.x===te.x&&ue.x===Ce.x&&Ce.x>te.x){I[X+1].y=Ce.y,I.splice(I.indexOf(ue),1),I.splice(I.indexOf(Ce),1),X=1;continue}}},W=function(){for(var q=1;q<I.length-3;q++){var X=I[q],re=I[q+1],te=I[q+2];if(!(!((te.direction==="left"||te.direction==="top")&&X.y<te.y&&X.direction==="bottom")||te.direction&&te.direction===X.direction)&&X.y===re.y&&re.x===te.x){X.y=te.y,I[q+3]&&(te.x=I[q+3].x),I.splice(I.indexOf(re),1),q=1;continue}}};W(),Z();var ie=function(){for(var q={points:[],delta:0},X=I.length,re=0;re<X-1;re++){var te=I[re],ue=I[re+1],Ce=Math.abs(ue.x-te.x),ge=Math.abs(ue.y-te.y),Le=Ce>ge?Ce:ge;q.delta<Le&&(q={points:[te,ue],delta:Le})}return q.points},oe=function(X){var X=ie(),re=X[0],te=X[1],ue=Math.abs(te.x-re.x),Ce=Math.abs(te.y-re.y);if(ue>Ce)return{direction:"horiontal",x:re.x+ue/2,y:re.y};var ge;return re.y>te.y?ge=re:ge=te,{direction:"vertical",x:te.x,y:ge.y-Ce/2}};if(this.connectorType&&this.connectorType.length>0){var K=oe(ie()),le=ShapesRegistry.get("Port",this.targets[0]),he=ShapesRegistry.get("Port",this.sources[0]),pe;le.getPosition().x>=he.getPosition().x?(pe=!1,K.direction==="vertical"?K.y=K.y-20:K.x=K.x-20):(pe=!0,K.direction==="vertical"?K.y=K.y+20:K.yx=K.x+20);var ye=ConnectorSymbols.draw(this,this.connectorType,K.direction,pe);ye.setAttribute("transform","translate("+K.x+","+K.y+")")}var be=u.focalNode.parentNode,ve=b.focalNode.parentNode,we=be.parentNode,ne=ve.parentNode;we.removeChild(be),we.appendChild(be),ne.removeChild(ve),ne.appendChild(ve),this.focalNode.setAttribute("points",this.arrayToPoints(I));for(var F=[],G=u.connectors.sources.concat(u.connectors.targets).concat(b.connectors.sources).concat(b.connectors.sources),Y=0,ee;ee=G[Y];Y++)F[ee.name]||(F[ee.name]=ee);this.adjustOverlappedConnectors(F)}}},adjustOverlappedConnectors:function(e){var t=e||ShapesRegistry.get("PortConnector"),n={};for(var r in t){var o=t[r];if(o.getAttribute){var a=[];n[o.name]={connector:o,connectorPoints:a};for(var s=o.getAttribute("points").split(" "),c=0,d;d=s[c];c++){var u=d.split(",");a.push({x:parseFloat(u[0]),y:parseFloat(u[1])})}}}var f=0,g={},h=[],b=ObjectsUtil.newInstance("util.core.Map");for(var r in n){var E=n[r],S=E.connector,a=E.connectorPoints;for(var D in n){f++;var j=n[D],p=j.connector;if(p!==S){var C=j.connectorPoints,M=p.targets[0];g[M]===void 0?g[M]=0:h.indexOf(p)===-1&&g[M]++,h.push(p);var _=b.get(p);_||(_=(g[M]%2?2:-2)*Math.round(g[M]/2),b.put(p,_));for(var T=[C[0],C[1]],P=!1,c=0;c<C.length-1;c++)for(var k=C[c],U=C[c+1],N=[k.x,U.x],R=[k.y,U.y],B,H,I=0;I<a.length-1;I++){var v=a[I],L=a[I+1],O=function(ne,F){for(var G=1,Y=3,ee=3,q=C[c][ne]+Y*G,X=!1;!X;)e:{for(var re in n)for(var te=n[re],ue=te.connectorPoints,Ce=0,ge;ge=ue[Ce];Ce++)if(ge[ne]===q&&(Math.abs(ge[F]-C[c][F])<25||Math.abs(ge[F]-C[c+1][F])<25)){G<1&&(Y<.1?(Y=ee+1,ee++):Y=Y/2),G=G*-1,q=C[c][ne]+Y*G;break e}X=!0;break}return q},B=v.x===k.x&&L.x===U.x&&v.x===U.x&&(L.y===U.y||Math.abs(k.y-v.y)<=3),H=v.y===k.y&&L.y===U.y&&v.y===U.y&&(L.x===U.x||Math.abs(k.x-v.x)<=3);if(B){var z=O("x","y");j.alteredx=!0,C[c].x=z,C[c+1].x=z,p.movedHorizontally=!0,P=!0}else if(H){var z=O("y","x");j.alteredy=!0,C[c].y=z,C[c+1].y=z,p.movedVertically=!0,P=!0}}for(var c=0;c<C.length-2;c++){var V=C[c],Z=C[c+1],W=C[c+2];(Z.y<V.y&&Z.y<W.y&&V.x===Z.x&&Z.x===W.x||Z.x<V.x&&Z.x<W.x&&V.y===Z.y&&Z.y===W.y)&&(C.splice(c+1,1),c=0)}for(var c=0;c<C.length-1;c++){var V=C[c],Z=C[c+1],W=C[c+2];if(Z.x!=V.x&&Math.abs(Z.x-V.x)<7)Z.x=V.x,c=-1,P=!0;else if(Z.y-V.y&&Math.abs(Z.y-V.y)<7)Z.y=V.y,c=0,P=!0;else if(c>4)break}if(P){for(var T="",ie=0,oe;oe=C[ie];ie++){var K=C[ie-1],le=C[ie-2];T&&(T=T+" ");var he=oe;K&&le&&oe.x!==K.x&&oe.y!==K.y&&(le.x==K.x?he.x=le.x:le.y==K.y&&(he.y=le.y)),T=T+he.x+","+he.y}p.setAttribute("points",T)}}}}},arrayToPoints:function(e){for(var t="",n=0,r;r=e[n];n++)t&&(t=t+" "),t=t+r.x+","+r.y;return t},getPosition:function(){return{x:parseFloat(this.focalNode.getAttribute("x")),y:parseFloat(this.focalNode.getAttribute("y")),w:13,h:13}}})})();var StateTree={};function StateNode(e,t){this.parent=e,this.id=t,this.activeColour=null,this.passiveColor=null}StateNode.prototype.getParent=function(){return this.parent},StateNode.prototype.getRoot=function(){for(var e=this,t=null;e!==null;)t=e,e=e.getParent();return t},StateNode.prototype.getId=function(){return this.id},StateNode.prototype.getDepth=function(){for(var e=this,t=0;e!==null;)e=e.getParent(),t++;return t};function StateColourer(e,t){this.numShades=e,this.numColours=t,this.cachedColours=this.baseColours.slice()}StateColourer.prototype.passiveColour="999999",StateColourer.prototype.baseColours=["CC99A2","9AAFAF","FFFF7F","98FB98","9DD6D6","D2AB6F","B19CD9"],StateColourer.prototype.getBasePassiveColour=function(){for(var e=this.passiveColour,t=0;t<5-this.numShades&&t<3;t++)e=this.lighten(e);return e},StateColourer.prototype.getBaseColour=function(e){var t;e<this.cachedColours.length?t=this.cachedColours[e]:(e=e%this.cachedColours.length,t=this.modifyColour(this.cachedColours[e]),this.cachedColours[e]=t);for(var n=0;n<5-this.numShades&&n<3;n++)t=this.lighten(t);return t},StateColourer.prototype.getLightenAmount=function(){return 15},StateColourer.prototype.getModifyAmount=function(){return 20},StateColourer.prototype.modifyColour=function(t){var t=this.createColour(t),n,r;return t.red>t.blue?t.red>t.green?(t.red-=this.getModifyAmount(),t.blue>t.green?t.green+=this.getModifyAmount():t.blue+=this.getModifyAmount()):(t.green-=this.getModifyAmount(),t.blue+=this.getModifyAmount()):t.blue>t.green?(t.blue-=this.getModifyAmount(),t.red>t.green?t.green+=this.getModifyAmount():t.red+=this.getModifyAmount()):(t.blue-=this.getModifyAmount(),t.red+=this.getModifyAmount()),t.toHex()},StateColourer.prototype.lighten=function(t){var t=this.createColour(t),n=this.getLightenAmount();return t.modifyRed(n),t.modifyBlue(n),t.modifyGreen(n),t.toHex()},StateColourer.prototype.createColour=function(e){var t=parseInt(e,16),n=t>>16,r=t>>8&255,o=t&255;return new Colour(n,r,o)};function Colour(e,t,n){this.red=e,this.blue=t,this.green=n}Colour.prototype.modifyRed=function(e){this.red+=e,this.red>255?this.red=255:this.red<0&&(this.red=0)},Colour.prototype.modifyBlue=function(e){this.blue+=e,this.blue>255?this.blue=255:this.blue<0&&(this.blue=0)},Colour.prototype.modifyGreen=function(e){this.green+=e,this.green>255?this.green=255:this.green<0&&(this.green=0)},Colour.prototype.modifyByName=function(e,t){if(e!=="red"&&e!=="blue"&&e!=="green")throw"Not a valid colour name"},Colour.prototype.toHex=function(){var e=this.green|this.blue<<8|this.red<<16;return e.toString(16)};function StateTable(e,t){this.table=e,this.stateTree=t}StateTable.prototype.readTable=function(){for(var e=this.table.find("tr"),t=0,n=1;n<e.length;n++){var r=jQuery(e[n]).find("td")[0];this.stateTree.stateNodes.push(this.stateTree.createState(jQuery(r),t++))}},StateTable.prototype.colour=function(){var e=this.table.find("tr"),t,n,r;if(this.stateTree.type==="state"){t=jQuery(e[0]).find("td");for(var o=1;o<t.length;o++)jQuery(t[o]).css("background-color","#"+this.stateTree.stateNodes[o-1].activeColour)}for(var o=1;o<e.length;o++){n=this.stateTree.stateNodes[o-1],t=jQuery(e[o]).find("td"),r=jQuery(t[0]),r.css("background-color","#"+n.activeColour);for(var a=1;a<t.length;a++)r=jQuery(t[a]),r.text().match(/^\s$/)?r.css("background-color","#"+n.passiveColour):r.css("background-color","#"+n.activeColour)}};function EventSequence(e,t,n){this.headerTable=e,this.bodyTable=t,this.stateTree=n}EventSequence.prototype.readTable=function(){for(var e=jQuery(this.headerTable).find("td"),t=0,n=1;n<e.length;n++)this.stateTree.stateNodes.push(this.stateTree.createState(jQuery(e[n]),t++))},EventSequence.prototype.colour=function(){var e,t,n,r;e=jQuery(this.headerTable).find("td");for(var o=1;o<e.length;o++)n=this.stateTree.stateNodes[o-1],jQuery(e[o]).css("background-color","#"+n.activeColour);e=jQuery(this.bodyTable).find("tr");for(var o=1;o<e.length;o++){n=this.stateTree.stateNodes[o-1],t=jQuery(e[o]).find("td");for(var a=0;a<t.length;a++)r=jQuery(t[a]),r.text().match(/^\s$/)?r.css("background-color","#"+n.passiveColour):r.css("background-color","#"+n.activeColour)}},StateTree.init=function(e,t){StateTree.stateNodes=[],e.hasClass("event-statetable")?(StateTree.type="event",StateTree.handler=new StateTable(e,this)):e.hasClass("state-statetable")?(StateTree.type="state",StateTree.handler=new StateTable(e,this)):e.hasClass("event-sequence-grid")?(StateTree.type="eventSequence",StateTree.handler=new EventSequence(e.find("table")[0],e.find("table")[1],this)):(console.log("Unknown state table type"),StateTree.type="unknown")},StateTree.createState=function(e,t){var n=parseInt(e.attr("data-parent")),r=StateTree.stateNodes[n];return isNaN(n)&&(r=null),new StateNode(r,t)},StateTree.maxDepth=function(){for(var e=0,t,n=0;n<StateTree.stateNodes.length;n++)t=StateTree.stateNodes[n].getDepth(),t>e&&(e=t);return e},StateTree.numStateFamilies=function(){numStateFamilies=0;for(var e=0;e<StateTree.stateNodes.length;e++)StateTree.stateNodes[e].getParent()===null&&numStateFamilies++;return numStateFamilies},StateTree.readTable=function(){StateTree.handler.readTable()},StateTree.assignStateColours=function(){for(var e=new StateColourer(StateTree.maxDepth(),StateTree.numStateFamilies()),t=0,n,r=0;r<StateTree.stateNodes.length;r++)n=StateTree.stateNodes[r],n.getParent()===null?(n.passiveColour=e.getBasePassiveColour(),n.activeColour=e.getBaseColour(t++)):(n.passiveColour=e.lighten(n.getParent().passiveColour),n.activeColour=e.lighten(n.getParent().activeColour))},StateTree.colour=function(){StateTree.assignStateColours(),StateTree.handler.colour()},StateTree.colourStateTables=function(){jQuery(document).ready(function(){jQuery(".statetable").each(function(){StateTree.init(jQuery(this)),StateTree.readTable(),StateTree.colour()})})},StateTree.colourEventSequences=function(){jQuery(document).ready(function(){jQuery(".event-sequence-grid").each(function(){StateTree.init(jQuery(this)),StateTree.readTable(),StateTree.colour()})})};
