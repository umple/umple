var Prototype={Version:"1.7.1",Browser:(function(){var e=navigator.userAgent,t=Object.prototype.toString.call(window.opera)=="[object Opera]";return{IE:!!window.attachEvent&&!t,Opera:t,WebKit:e.indexOf("AppleWebKit/")>-1,Gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,MobileSafari:/Apple.*Mobile/.test(e)}})(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:(function(){var e=window.Element||window.HTMLElement;return!!(e&&e.prototype)})(),SpecificElementExtensions:(function(){if(typeof window.HTMLDivElement<"u")return!0;var e=document.createElement("div"),t=document.createElement("form"),n=!1;return e.__proto__&&e.__proto__!==t.__proto__&&(n=!0),e=t=null,n})()},ScriptFragment:"<script[^>]*>([\\S\\s]*?)<\/script\\s*>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(e){return e}};Prototype.Browser.MobileSafari&&(Prototype.BrowserFeatures.SpecificElementExtensions=!1);var Class=(function(){var e=(function(){for(var o in{toString:1})if(o==="toString")return!1;return!0})();function t(){}function n(){var o=null,a=$A(arguments);Object.isFunction(a[0])&&(o=a.shift());function s(){this.initialize.apply(this,arguments)}Object.extend(s,Class.Methods),s.superclass=o,s.subclasses=[],o&&(t.prototype=o.prototype,s.prototype=new t,o.subclasses.push(s));for(var c=0,d=a.length;c<d;c++)s.addMethods(a[c]);return s.prototype.initialize||(s.prototype.initialize=Prototype.emptyFunction),s.prototype.constructor=s,s}function r(o){var a=this.superclass&&this.superclass.prototype,s=Object.keys(o);e&&(o.toString!=Object.prototype.toString&&s.push("toString"),o.valueOf!=Object.prototype.valueOf&&s.push("valueOf"));for(var c=0,d=s.length;c<d;c++){var u=s[c],f=o[u];if(a&&Object.isFunction(f)&&f.argumentNames()[0]=="$super"){var v=f;f=(function(h){return function(){return a[h].apply(this,arguments)}})(u).wrap(v),f.valueOf=(function(h){return function(){return h.valueOf.call(h)}})(v),f.toString=(function(h){return function(){return h.toString.call(h)}})(v)}this.prototype[u]=f}return this}return{create:n,Methods:{addMethods:r}}})();(function(){var e=Object.prototype.toString,t=Object.prototype.hasOwnProperty,n="Null",r="Undefined",o="Boolean",a="Number",s="String",c="Object",d="[object Function]",u="[object Boolean]",f="[object Number]",v="[object String]",h="[object Array]",C="[object Date]",A=window.JSON&&typeof JSON.stringify=="function"&&JSON.stringify(0)==="0"&&typeof JSON.stringify(Prototype.K)>"u",T=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],j=(function(){for(var W in{toString:1})if(W==="toString")return!1;return!0})();function N(W){switch(W){case null:return n;case void 0:return r}var Y=typeof W;switch(Y){case"boolean":return o;case"number":return a;case"string":return s}return c}function p(W,Y){for(var ne in Y)W[ne]=Y[ne];return W}function b(W){try{return ee(W)?"undefined":W===null?"null":W.inspect?W.inspect():String(W)}catch(Y){if(Y instanceof RangeError)return"...";throw Y}}function _(W){return L("",{"":W},[])}function L(W,Y,ne){var X=Y[W];N(X)===c&&typeof X.toJSON=="function"&&(X=X.toJSON(W));var se=e.call(X);switch(se){case f:case u:case v:X=X.valueOf()}switch(X){case null:return"null";case!0:return"true";case!1:return"false"}var fe=typeof X;switch(fe){case"string":return X.inspect(!0);case"number":return isFinite(X)?String(X):"null";case"object":for(var pe=0,me=ne.length;pe<me;pe++)if(ne[pe]===X)throw new TypeError("Cyclic reference to '"+X+"' in object");ne.push(X);var ye=[];if(se===h){for(var pe=0,me=X.length;pe<me;pe++){var be=L(pe,X,ne);ye.push(typeof be>"u"?"null":be)}ye="["+ye.join(",")+"]"}else{for(var Ee=Object.keys(X),pe=0,me=Ee.length;pe<me;pe++){var W=Ee[pe],be=L(W,X,ne);typeof be<"u"&&ye.push(W.inspect(!0)+":"+be)}ye="{"+ye.join(",")+"}"}return ne.pop(),ye}}function P(W){return JSON.stringify(W)}function S(W){return $H(W).toQueryString()}function k(W){return W&&W.toHTML?W.toHTML():String.interpret(W)}function O(W){if(N(W)!==c)throw new TypeError;var Y=[];for(var ne in W)t.call(W,ne)&&Y.push(ne);if(j)for(var X=0;ne=T[X];X++)t.call(W,ne)&&Y.push(ne);return Y}function R(W){var Y=[];for(var ne in W)Y.push(W[ne]);return Y}function I(W){return p({},W)}function F(W){return!!(W&&W.nodeType==1)}function V(W){return e.call(W)===h}var D=typeof Array.isArray=="function"&&Array.isArray([])&&!Array.isArray({});D&&(V=Array.isArray);function m(W){return W instanceof Hash}function M(W){return e.call(W)===d}function U(W){return e.call(W)===v}function z(W){return e.call(W)===f}function q(W){return e.call(W)===C}function ee(W){return typeof W>"u"}p(Object,{extend:p,inspect:b,toJSON:A?P:_,toQueryString:S,toHTML:k,keys:Object.keys||O,values:R,clone:I,isElement:F,isArray:V,isHash:m,isFunction:M,isString:U,isNumber:z,isDate:q,isUndefined:ee})})(),Object.extend(Function.prototype,(function(){var e=Array.prototype.slice;function t(h,C){for(var A=h.length,T=C.length;T--;)h[A+T]=C[T];return h}function n(h,C){return h=e.call(h,0),t(h,C)}function r(){var h=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return h.length==1&&!h[0]?[]:h}function o(h){if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;if(!Object.isFunction(this))throw new TypeError("The object is not callable.");var C=function(){},A=this,T=e.call(arguments,1),j=function(){var N=n(T,arguments),p=h,p=this instanceof j?this:h;return A.apply(p,N)};return C.prototype=this.prototype,j.prototype=new C,j}function a(h){var C=this,A=e.call(arguments,1);return function(T){var j=t([T||window.event],A);return C.apply(h,j)}}function s(){if(!arguments.length)return this;var h=this,C=e.call(arguments,0);return function(){var A=n(C,arguments);return h.apply(this,A)}}function c(h){var C=this,A=e.call(arguments,1);return h=h*1e3,window.setTimeout(function(){return C.apply(C,A)},h)}function d(){var h=t([.01],arguments);return this.delay.apply(this,h)}function u(h){var C=this;return function(){var A=t([C.bind(this)],arguments);return h.apply(this,A)}}function f(){if(this._methodized)return this._methodized;var h=this;return this._methodized=function(){var C=t([this],arguments);return h.apply(null,C)}}var v={argumentNames:r,bindAsEventListener:a,curry:s,delay:c,defer:d,wrap:u,methodize:f};return Function.prototype.bind||(v.bind=o),v})()),(function(e){function t(){return this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+"Z"}function n(){return this.toISOString()}e.toISOString||(e.toISOString=t),e.toJSON||(e.toJSON=n)})(Date.prototype),RegExp.prototype.match=RegExp.prototype.test,RegExp.escape=function(e){return String(e).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};var PeriodicalExecuter=Class.create({initialize:function(e,t){this.callback=e,this.frequency=t,this.currentlyExecuting=!1,this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1e3)},execute:function(){this.callback(this)},stop:function(){this.timer&&(clearInterval(this.timer),this.timer=null)},onTimerEvent:function(){if(!this.currentlyExecuting)try{this.currentlyExecuting=!0,this.execute(),this.currentlyExecuting=!1}catch(e){throw this.currentlyExecuting=!1,e}}});Object.extend(String,{interpret:function(e){return e==null?"":String(e)},specialChar:{"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"}}),Object.extend(String.prototype,(function(){var NATIVE_JSON_PARSE_SUPPORT=window.JSON&&typeof JSON.parse=="function"&&JSON.parse('{"test": true}').test;function prepareReplacement(e){if(Object.isFunction(e))return e;var t=new Template(e);return function(n){return t.evaluate(n)}}function gsub(e,t){var n="",r=this,o;if(t=prepareReplacement(t),Object.isString(e)&&(e=RegExp.escape(e)),!(e.length||e.source))return t=t(""),t+r.split("").join(t)+t;for(;r.length>0;)(o=r.match(e))?(n+=r.slice(0,o.index),n+=String.interpret(t(o)),r=r.slice(o.index+o[0].length)):(n+=r,r="");return n}function sub(e,t,n){return t=prepareReplacement(t),n=Object.isUndefined(n)?1:n,this.gsub(e,function(r){return--n<0?r[0]:t(r)})}function scan(e,t){return this.gsub(e,t),String(this)}function truncate(e,t){return e=e||30,t=Object.isUndefined(t)?"...":t,this.length>e?this.slice(0,e-t.length)+t:String(this)}function strip(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}function stripTags(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")}function stripScripts(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")}function extractScripts(){var e=new RegExp(Prototype.ScriptFragment,"img"),t=new RegExp(Prototype.ScriptFragment,"im");return(this.match(e)||[]).map(function(n){return(n.match(t)||["",""])[1]})}function evalScripts(){return this.extractScripts().map(function(script){return eval(script)})}function escapeHTML(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function unescapeHTML(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}function toQueryParams(e){var t=this.strip().match(/([^?#]*)(#.*)?$/);return t?t[1].split(e||"&").inject({},function(n,r){if((r=r.split("="))[0]){var o=decodeURIComponent(r.shift()),a=r.length>1?r.join("="):r[0];a!=null&&(a=decodeURIComponent(a)),o in n?(Object.isArray(n[o])||(n[o]=[n[o]]),n[o].push(a)):n[o]=a}return n}):{}}function toArray(){return this.split("")}function succ(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)}function times(e){return e<1?"":new Array(e+1).join(this)}function camelize(){return this.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})}function capitalize(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()}function underscore(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()}function dasherize(){return this.replace(/_/g,"-")}function inspect(e){var t=this.replace(/[\x00-\x1f\\]/g,function(n){return n in String.specialChar?String.specialChar[n]:"\\u00"+n.charCodeAt().toPaddedString(2,16)});return e?'"'+t.replace(/"/g,'\\"')+'"':"'"+t.replace(/'/g,"\\'")+"'"}function unfilterJSON(e){return this.replace(e||Prototype.JSONFilter,"$1")}function isJSON(){var e=this;return e.blank()?!1:(e=e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@"),e=e.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]"),e=e.replace(/(?:^|:|,)(?:\s*\[)+/g,""),/^[\],:{}\s]*$/.test(e))}function evalJSON(sanitize){var json=this.unfilterJSON(),cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;cx.test(json)&&(json=json.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));try{if(!sanitize||json.isJSON())return eval("("+json+")")}catch(e){}throw new SyntaxError("Badly formed JSON string: "+this.inspect())}function parseJSON(){var e=this.unfilterJSON();return JSON.parse(e)}function include(e){return this.indexOf(e)>-1}function startsWith(e){return this.lastIndexOf(e,0)===0}function endsWith(e){var t=this.length-e.length;return t>=0&&this.indexOf(e,t)===t}function empty(){return this==""}function blank(){return/^\s*$/.test(this)}function interpolate(e,t){return new Template(this,t).evaluate(e)}return{gsub,sub,scan,truncate,strip:String.prototype.trim||strip,stripTags,stripScripts,extractScripts,evalScripts,escapeHTML,unescapeHTML,toQueryParams,parseQuery:toQueryParams,toArray,succ,times,camelize,capitalize,underscore,dasherize,inspect,unfilterJSON,isJSON,evalJSON:NATIVE_JSON_PARSE_SUPPORT?parseJSON:evalJSON,include,startsWith,endsWith,empty,blank,interpolate}})());var Template=Class.create({initialize:function(e,t){this.template=e.toString(),this.pattern=t||Template.Pattern},evaluate:function(e){return e&&Object.isFunction(e.toTemplateReplacements)&&(e=e.toTemplateReplacements()),this.template.gsub(this.pattern,function(t){if(e==null)return t[1]+"";var n=t[1]||"";if(n=="\\")return t[2];var r=e,o=t[3],a=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;if(t=a.exec(o),t==null)return n;for(;t!=null;){var s=t[1].startsWith("[")?t[2].replace(/\\\\]/g,"]"):t[1];if(r=r[s],r==null||t[3]=="")break;o=o.substring(t[3]=="["?t[1].length:t[0].length),t=a.exec(o)}return n+String.interpret(r)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;var $break={},Enumerable=(function(){function e(P,S){try{this._each(P,S)}catch(k){if(k!=$break)throw k}return this}function t(P,S,k){var O=-P,R=[],I=this.toArray();if(P<1)return I;for(;(O+=P)<I.length;)R.push(I.slice(O,O+P));return R.collect(S,k)}function n(P,S){P=P||Prototype.K;var k=!0;return this.each(function(O,R){if(k=k&&!!P.call(S,O,R,this),!k)throw $break},this),k}function r(P,S){P=P||Prototype.K;var k=!1;return this.each(function(O,R){if(k=!!P.call(S,O,R,this))throw $break},this),k}function o(P,S){P=P||Prototype.K;var k=[];return this.each(function(O,R){k.push(P.call(S,O,R,this))},this),k}function a(P,S){var k;return this.each(function(O,R){if(P.call(S,O,R,this))throw k=O,$break},this),k}function s(P,S){var k=[];return this.each(function(O,R){P.call(S,O,R,this)&&k.push(O)},this),k}function c(P,S,k){S=S||Prototype.K;var O=[];return Object.isString(P)&&(P=new RegExp(RegExp.escape(P))),this.each(function(R,I){P.match(R)&&O.push(S.call(k,R,I,this))},this),O}function d(P){if(Object.isFunction(this.indexOf)&&this.indexOf(P)!=-1)return!0;var S=!1;return this.each(function(k){if(k==P)throw S=!0,$break}),S}function u(P,S){return S=Object.isUndefined(S)?null:S,this.eachSlice(P,function(k){for(;k.length<P;)k.push(S);return k})}function f(P,S,k){return this.each(function(O,R){P=S.call(k,P,O,R,this)},this),P}function v(P){var S=$A(arguments).slice(1);return this.map(function(k){return k[P].apply(k,S)})}function h(P,S){P=P||Prototype.K;var k;return this.each(function(O,R){O=P.call(S,O,R,this),(k==null||O>=k)&&(k=O)},this),k}function C(P,S){P=P||Prototype.K;var k;return this.each(function(O,R){O=P.call(S,O,R,this),(k==null||O<k)&&(k=O)},this),k}function A(P,S){P=P||Prototype.K;var k=[],O=[];return this.each(function(R,I){(P.call(S,R,I,this)?k:O).push(R)},this),[k,O]}function T(P){var S=[];return this.each(function(k){S.push(k[P])}),S}function j(P,S){var k=[];return this.each(function(O,R){P.call(S,O,R,this)||k.push(O)},this),k}function N(P,S){return this.map(function(k,O){return{value:k,criteria:P.call(S,k,O,this)}},this).sort(function(k,O){var R=k.criteria,I=O.criteria;return R<I?-1:R>I?1:0}).pluck("value")}function p(){return this.map()}function b(){var P=Prototype.K,S=$A(arguments);Object.isFunction(S.last())&&(P=S.pop());var k=[this].concat(S).map($A);return this.map(function(O,R){return P(k.pluck(R))})}function _(){return this.toArray().length}function L(){return"#<Enumerable:"+this.toArray().inspect()+">"}return{each:e,eachSlice:t,all:n,every:n,any:r,some:r,collect:o,map:o,detect:a,findAll:s,select:s,filter:s,grep:c,include:d,member:d,inGroupsOf:u,inject:f,invoke:v,max:h,min:C,partition:A,pluck:T,reject:j,sortBy:N,toArray:p,entries:p,zip:b,size:_,inspect:L,find:a}})();function $A(e){if(!e)return[];if("toArray"in Object(e))return e.toArray();for(var t=e.length||0,n=new Array(t);t--;)n[t]=e[t];return n}function $w(e){return Object.isString(e)?(e=e.strip(),e?e.split(/\s+/):[]):[]}Array.from=$A,(function(){var e=Array.prototype,t=e.slice,n=e.forEach;function r(I,F){for(var V=0,D=this.length>>>0;V<D;V++)V in this&&I.call(F,this[V],V,this)}n||(n=r);function o(){return this.length=0,this}function a(){return this[0]}function s(){return this[this.length-1]}function c(){return this.select(function(I){return I!=null})}function d(){return this.inject([],function(I,F){return Object.isArray(F)?I.concat(F.flatten()):(I.push(F),I)})}function u(){var I=t.call(arguments,0);return this.select(function(F){return!I.include(F)})}function f(I){return(I===!1?this.toArray():this)._reverse()}function v(I){return this.inject([],function(F,V,D){return(D==0||(I?F.last()!=V:!F.include(V)))&&F.push(V),F})}function h(I){return this.uniq().findAll(function(F){return I.indexOf(F)!==-1})}function C(){return t.call(this,0)}function A(){return this.length}function T(){return"["+this.map(Object.inspect).join(", ")+"]"}function j(I,F){if(this==null)throw new TypeError;var V=Object(this),D=V.length>>>0;if(D===0||(F=Number(F),isNaN(F)?F=0:F!==0&&isFinite(F)&&(F=(F>0?1:-1)*Math.floor(Math.abs(F))),F>D))return-1;for(var m=F>=0?F:Math.max(D-Math.abs(F),0);m<D;m++)if(m in V&&V[m]===I)return m;return-1}function N(I,F){if(this==null)throw new TypeError;var V=Object(this),D=V.length>>>0;if(D===0)return-1;Object.isUndefined(F)?F=D:(F=Number(F),isNaN(F)?F=0:F!==0&&isFinite(F)&&(F=(F>0?1:-1)*Math.floor(Math.abs(F))));for(var m=F>=0?Math.min(F,D-1):D-Math.abs(F);m>=0;m--)if(m in V&&V[m]===I)return m;return-1}function p(I){var F=[],V=t.call(arguments,0),D,m=0;V.unshift(this);for(var M=0,U=V.length;M<U;M++)if(D=V[M],Object.isArray(D)&&!("callee"in D))for(var z=0,q=D.length;z<q;z++)z in D&&(F[m]=D[z]),m++;else F[m++]=D;return F.length=m,F}function b(I){return function(){if(arguments.length===0)return I.call(this,Prototype.K);if(arguments[0]===void 0){var F=t.call(arguments,1);return F.unshift(Prototype.K),I.apply(this,F)}else return I.apply(this,arguments)}}function _(I){if(this==null)throw new TypeError;I=I||Prototype.K;for(var F=Object(this),V=[],D=arguments[1],m=0,M=0,U=F.length>>>0;M<U;M++)M in F&&(V[m]=I.call(D,F[M],M,F)),m++;return V.length=m,V}e.map&&(_=b(Array.prototype.map));function L(I){if(this==null||!Object.isFunction(I))throw new TypeError;for(var F=Object(this),V=[],D=arguments[1],m,M=0,U=F.length>>>0;M<U;M++)M in F&&(m=F[M],I.call(D,m,M,F)&&V.push(m));return V}e.filter&&(L=Array.prototype.filter);function P(I){if(this==null)throw new TypeError;I=I||Prototype.K;for(var F=arguments[1],V=Object(this),D=0,m=V.length>>>0;D<m;D++)if(D in V&&I.call(F,V[D],D,V))return!0;return!1}if(e.some)var P=b(Array.prototype.some);function S(I){if(this==null)throw new TypeError;I=I||Prototype.K;for(var F=arguments[1],V=Object(this),D=0,m=V.length>>>0;D<m;D++)if(D in V&&!I.call(F,V[D],D,V))return!1;return!0}if(e.every)var S=b(Array.prototype.every);var k=e.reduce;function O(I,F){F=F||Prototype.K;var V=arguments[2];return k.call(this,F.bind(V),I)}if(!e.reduce)var O=Enumerable.inject;Object.extend(e,Enumerable),e._reverse||(e._reverse=e.reverse),Object.extend(e,{_each:n,map:_,collect:_,select:L,filter:L,findAll:L,some:P,any:P,every:S,all:S,inject:O,clear:o,first:a,last:s,compact:c,flatten:d,without:u,reverse:f,uniq:v,intersect:h,clone:C,toArray:C,size:A,inspect:T});var R=(function(){return[].concat(arguments)[0][0]!==1})(1,2);R&&(e.concat=p),e.indexOf||(e.indexOf=j),e.lastIndexOf||(e.lastIndexOf=N)})();function $H(e){return new Hash(e)}var Hash=Class.create(Enumerable,(function(){function e(T){this._object=Object.isHash(T)?T.toObject():Object.clone(T)}function t(T,j){for(var N in this._object){var p=this._object[N],b=[N,p];b.key=N,b.value=p,T.call(j,b)}}function n(T,j){return this._object[T]=j}function r(T){if(this._object[T]!==Object.prototype[T])return this._object[T]}function o(T){var j=this._object[T];return delete this._object[T],j}function a(){return Object.clone(this._object)}function s(){return this.pluck("key")}function c(){return this.pluck("value")}function d(T){var j=this.detect(function(N){return N.value===T});return j&&j.key}function u(T){return this.clone().update(T)}function f(T){return new Hash(T).inject(this,function(j,N){return j.set(N.key,N.value),j})}function v(T,N){if(Object.isUndefined(N))return T;var N=String.interpret(N);return N=N.gsub(/(\r)?\n/,`\r
`),N=encodeURIComponent(N),N=N.gsub(/%20/,"+"),T+"="+N}function h(){return this.inject([],function(T,j){var N=encodeURIComponent(j.key),p=j.value;if(p&&typeof p=="object"){if(Object.isArray(p)){for(var b=[],_=0,L=p.length,P;_<L;_++)P=p[_],b.push(v(N,P));return T.concat(b)}}else T.push(v(N,p));return T}).join("&")}function C(){return"#<Hash:{"+this.map(function(T){return T.map(Object.inspect).join(": ")}).join(", ")+"}>"}function A(){return new Hash(this)}return{initialize:e,_each:t,set:n,get:r,unset:o,toObject:a,toTemplateReplacements:a,keys:s,values:c,index:d,merge:u,update:f,toQueryString:h,inspect:C,toJSON:a,clone:A}})());Hash.from=$H,Object.extend(Number.prototype,(function(){function e(){return this.toPaddedString(2,16)}function t(){return this+1}function n(d,u){return $R(0,this,!0).each(d,u),this}function r(d,u){var f=this.toString(u||10);return"0".times(d-f.length)+f}function o(){return Math.abs(this)}function a(){return Math.round(this)}function s(){return Math.ceil(this)}function c(){return Math.floor(this)}return{toColorPart:e,succ:t,times:n,toPaddedString:r,abs:o,round:a,ceil:s,floor:c}})());function $R(e,t,n){return new ObjectRange(e,t,n)}var ObjectRange=Class.create(Enumerable,(function(){function e(r,o,a){this.start=r,this.end=o,this.exclusive=a}function t(r,o){for(var a=this.start;this.include(a);)r.call(o,a),a=a.succ()}function n(r){return r<this.start?!1:this.exclusive?r<this.end:r<=this.end}return{initialize:e,_each:t,include:n}})()),Abstract={},Try={these:function(){for(var e,t=0,n=arguments.length;t<n;t++){var r=arguments[t];try{e=r();break}catch{}}return e}},Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||!1},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(e,t){this.responders._each(e,t)},register:function(e){this.include(e)||this.responders.push(e)},unregister:function(e){this.responders=this.responders.without(e)},dispatch:function(e,t,n,r){this.each(function(o){if(Object.isFunction(o[e]))try{o[e].apply(o,[t,n,r])}catch{}})}},Object.extend(Ajax.Responders,Enumerable),Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}}),Ajax.Base=Class.create({initialize:function(e){this.options={method:"post",asynchronous:!0,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:!0,evalJS:!0},Object.extend(this.options,e||{}),this.options.method=this.options.method.toLowerCase(),Object.isHash(this.options.parameters)&&(this.options.parameters=this.options.parameters.toObject())}}),Ajax.Request=Class.create(Ajax.Base,{_complete:!1,initialize:function(e,t,n){e(n),this.transport=Ajax.getTransport(),this.request(t)},request:function(e){this.url=e,this.method=this.options.method;var t=Object.isString(this.options.parameters)?this.options.parameters:Object.toQueryString(this.options.parameters);["get","post"].include(this.method)||(t+=(t?"&":"")+"_method="+this.method,this.method="post"),t&&this.method==="get"&&(this.url+=(this.url.include("?")?"&":"?")+t),this.parameters=t.toQueryParams();try{var n=new Ajax.Response(this);this.options.onCreate&&this.options.onCreate(n),Ajax.Responders.dispatch("onCreate",this,n),this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous),this.options.asynchronous&&this.respondToReadyState.bind(this).defer(1),this.transport.onreadystatechange=this.onStateChange.bind(this),this.setRequestHeaders(),this.body=this.method=="post"?this.options.postBody||t:null,this.transport.send(this.body),!this.options.asynchronous&&this.transport.overrideMimeType&&this.onStateChange()}catch(r){this.dispatchException(r)}},onStateChange:function(){var e=this.transport.readyState;e>1&&!(e==4&&this._complete)&&this.respondToReadyState(this.transport.readyState)},setRequestHeaders:function(){var e={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if(this.method=="post"&&(e["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:""),this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005&&(e.Connection="close")),typeof this.options.requestHeaders=="object"){var t=this.options.requestHeaders;if(Object.isFunction(t.push))for(var n=0,r=t.length;n<r;n+=2)e[t[n]]=t[n+1];else $H(t).each(function(a){e[a.key]=a.value})}for(var o in e)this.transport.setRequestHeader(o,e[o])},success:function(){var e=this.getStatus();return!e||e>=200&&e<300||e==304},getStatus:function(){try{return this.transport.status===1223?204:this.transport.status||0}catch{return 0}},respondToReadyState:function(e){var t=Ajax.Request.Events[e],n=new Ajax.Response(this);if(t=="Complete"){try{this._complete=!0,(this.options["on"+n.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(n,n.headerJSON)}catch(o){this.dispatchException(o)}var r=n.getHeader("Content-type");(this.options.evalJS=="force"||this.options.evalJS&&this.isSameOrigin()&&r&&r.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))&&this.evalResponse()}try{(this.options["on"+t]||Prototype.emptyFunction)(n,n.headerJSON),Ajax.Responders.dispatch("on"+t,this,n,n.headerJSON)}catch(o){this.dispatchException(o)}t=="Complete"&&(this.transport.onreadystatechange=Prototype.emptyFunction)},isSameOrigin:function(){var e=this.url.match(/^\s*https?:\/\/[^\/]*/);return!e||e[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""})},getHeader:function(e){try{return this.transport.getResponseHeader(e)||null}catch{return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(e){this.dispatchException(e)}},dispatchException:function(e){(this.options.onException||Prototype.emptyFunction)(this,e),Ajax.Responders.dispatch("onException",this,e)}}),Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"],Ajax.Response=Class.create({initialize:function(e){this.request=e;var t=this.transport=e.transport,n=this.readyState=t.readyState;if((n>2&&!Prototype.Browser.IE||n==4)&&(this.status=this.getStatus(),this.statusText=this.getStatusText(),this.responseText=String.interpret(t.responseText),this.headerJSON=this._getHeaderJSON()),n==4){var r=t.responseXML;this.responseXML=Object.isUndefined(r)?null:r,this.responseJSON=this._getResponseJSON()}},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch{return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch{return null}},getResponseHeader:function(e){return this.transport.getResponseHeader(e)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var e=this.getHeader("X-JSON");if(!e)return null;try{e=decodeURIComponent(escape(e))}catch{}try{return e.evalJSON(this.request.options.sanitizeJSON||!this.request.isSameOrigin())}catch(t){this.request.dispatchException(t)}},_getResponseJSON:function(){var e=this.request.options;if(!e.evalJSON||e.evalJSON!="force"&&!(this.getHeader("Content-type")||"").include("application/json")||this.responseText.blank())return null;try{return this.responseText.evalJSON(e.sanitizeJSON||!this.request.isSameOrigin())}catch(t){this.request.dispatchException(t)}}}),Ajax.Updater=Class.create(Ajax.Request,{initialize:function(e,t,n,r){this.container={success:t.success||t,failure:t.failure||(t.success?null:t)},r=Object.clone(r);var o=r.onComplete;r.onComplete=(function(a,s){this.updateContent(a.responseText),Object.isFunction(o)&&o(a,s)}).bind(this),e(n,r)},updateContent:function(e){var t=this.container[this.success()?"success":"failure"],n=this.options;if(n.evalScripts||(e=e.stripScripts()),t=$(t))if(n.insertion)if(Object.isString(n.insertion)){var r={};r[n.insertion]=e,t.insert(r)}else n.insertion(t,e);else t.update(e)}}),Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function(e,t,n,r){e(r),this.onComplete=this.options.onComplete,this.frequency=this.options.frequency||2,this.decay=this.options.decay||1,this.updater={},this.container=t,this.url=n,this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this),this.onTimerEvent()},stop:function(){this.updater.options.onComplete=void 0,clearTimeout(this.timer),(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},updateComplete:function(e){this.options.decay&&(this.decay=e.responseText==this.lastText?this.decay*this.options.decay:1,this.lastText=e.responseText),this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}}),(function(e){var t,n=Array.prototype.slice,r=document.createElement("div");function o(g){if(arguments.length>1){for(var E=0,H=[],K=arguments.length;E<K;E++)H.push(o(arguments[E]));return H}return Object.isString(g)&&(g=document.getElementById(g)),u.extend(g)}e.$=o,e.Node||(e.Node={}),e.Node.ELEMENT_NODE||Object.extend(e.Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12});var a={};function s(g,E){return!(g==="select"||"type"in E)}var c=(function(){try{var g=document.createElement('<input name="x">');return g.tagName.toLowerCase()==="input"&&g.name==="x"}catch{return!1}})(),d=e.Element;function u(g,E){if(E=E||{},g=g.toLowerCase(),c&&E.name)return g="<"+g+' name="'+E.name+'">',delete E.name,u.writeAttribute(document.createElement(g),E);a[g]||(a[g]=u.extend(document.createElement(g)));var H=s(g,E)?a[g].cloneNode(!1):document.createElement(g);return u.writeAttribute(H,E)}e.Element=u,Object.extend(e.Element,d||{}),d&&(e.Element.prototype=d.prototype),u.Methods={ByTag:{},Simulated:{}};var f={},v={id:"id",className:"class"};function h(g){g=o(g);var E="<"+g.tagName.toLowerCase(),H,K;for(var oe in v)H=v[oe],K=(g[oe]||"").toString(),K&&(E+=" "+H+"="+K.inspect(!0));return E+">"}f.inspect=h;function C(g){return o(g).style.display!=="none"}function A(g,E){return g=o(g),Object.isUndefined(E)&&(E=!u.visible(g)),u[E?"show":"hide"](g),g}function T(g){return g=o(g),g.style.display="none",g}function j(g){return g=o(g),g.style.display="",g}Object.extend(f,{visible:C,toggle:A,hide:T,show:j});function N(g){return g=o(g),g.parentNode.removeChild(g),g}var p=(function(){var g=document.createElement("select"),E=!0;return g.innerHTML='<option value="test">test</option>',g.options&&g.options[0]&&(E=g.options[0].nodeName.toUpperCase()!=="OPTION"),g=null,E})(),b=(function(){try{var g=document.createElement("table");if(g&&g.tBodies){g.innerHTML="<tbody><tr><td>test</td></tr></tbody>";var E=typeof g.tBodies[0]>"u";return g=null,E}}catch{return!0}})(),_=(function(){try{var g=document.createElement("div");g.innerHTML="<link />";var E=g.childNodes.length===0;return g=null,E}catch{return!0}})(),L=p||b||_,P=(function(){var g=document.createElement("script"),E=!1;try{g.appendChild(document.createTextNode("")),E=!g.firstChild||g.firstChild&&g.firstChild.nodeType!==3}catch{E=!0}return g=null,E})();function S(g,E){g=o(g);for(var H=g.getElementsByTagName("*"),K=H.length;K--;)ee(H[K]);if(E&&E.toElement&&(E=E.toElement()),Object.isElement(E))return g.update().insert(E);E=Object.toHTML(E);var oe=g.tagName.toUpperCase();if(oe==="SCRIPT"&&P)return g.text=E,g;if(L)if(oe in O.tags){for(;g.firstChild;)g.removeChild(g.firstChild);for(var le=z(oe,E.stripScripts()),K=0,xe;xe=le[K];K++)g.appendChild(xe)}else if(_&&Object.isString(E)&&E.indexOf("<link")>-1){for(;g.firstChild;)g.removeChild(g.firstChild);for(var le=z(oe,E.stripScripts(),!0),K=0,xe;xe=le[K];K++)g.appendChild(xe)}else g.innerHTML=E.stripScripts();else g.innerHTML=E.stripScripts();return E.evalScripts.bind(E).defer(),g}function k(g,E){if(g=o(g),E&&E.toElement)E=E.toElement();else if(!Object.isElement(E)){E=Object.toHTML(E);var H=g.ownerDocument.createRange();H.selectNode(g),E.evalScripts.bind(E).defer(),E=H.createContextualFragment(E.stripScripts())}return g.parentNode.replaceChild(E,g),g}var O={before:function(g,E){g.parentNode.insertBefore(E,g)},top:function(g,E){g.insertBefore(E,g.firstChild)},bottom:function(g,E){g.appendChild(E)},after:function(g,E){g.parentNode.insertBefore(E,g.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}},R=O.tags;Object.extend(R,{THEAD:R.TBODY,TFOOT:R.TBODY,TH:R.TD});function I(g,E){if(g=o(g),E&&E.toElement&&(E=E.toElement()),Object.isElement(E))return g.parentNode.replaceChild(E,g),g;E=Object.toHTML(E);var H=g.parentNode,K=H.tagName.toUpperCase();if(K in O.tags){var oe=u.next(g),le=z(K,E.stripScripts());H.removeChild(g);var xe;oe?xe=function(je){H.insertBefore(je,oe)}:xe=function(je){H.appendChild(je)},le.each(xe)}else g.outerHTML=E.stripScripts();return E.evalScripts.bind(E).defer(),g}"outerHTML"in document.documentElement&&(k=I);function F(g){return Object.isUndefined(g)||g===null?!1:!!(Object.isString(g)||Object.isNumber(g)||Object.isElement(g)||g.toElement||g.toHTML)}function V(g,E,H){H=H.toLowerCase();var K=O[H];if(E&&E.toElement&&(E=E.toElement()),Object.isElement(E))return K(g,E),g;E=Object.toHTML(E);var oe=(H==="before"||H==="after"?g.parentNode:g).tagName.toUpperCase(),le=z(oe,E.stripScripts());(H==="top"||H==="after")&&le.reverse();for(var xe=0,je;je=le[xe];xe++)K(g,je);E.evalScripts.bind(E).defer()}function D(g,E){g=o(g),F(E)&&(E={bottom:E});for(var H in E)V(g,E[H],H);return g}function m(g,E,H){return g=o(g),Object.isElement(E)?o(E).writeAttribute(H||{}):Object.isString(E)?E=new u(E,H):E=new u("div",E),g.parentNode&&g.parentNode.replaceChild(E,g),E.appendChild(g),E}function M(g){g=o(g);for(var E=g.firstChild;E;){var H=E.nextSibling;E.nodeType===Node.TEXT_NODE&&!/\S/.test(E.nodeValue)&&g.removeChild(E),E=H}return g}function U(g){return o(g).innerHTML.blank()}function z(g,E,H){var K=O.tags[g],oe=r,le=!!K;if(!le&&H&&(le=!0,K=["","",0]),le){oe.innerHTML="&#160;"+K[0]+E+K[1],oe.removeChild(oe.firstChild);for(var xe=K[2];xe--;)oe=oe.firstChild}else oe.innerHTML=E;return $A(oe.childNodes)}function q(g,E){if(g=o(g)){var H=g.cloneNode(E);if(!Qe&&(H._prototypeUID=t,E))for(var K=u.select(H,"*"),oe=K.length;oe--;)K[oe]._prototypeUID=t;return u.extend(H)}}function ee(g){var E=_e(g);E&&(u.stopObserving(g),Qe||(g._prototypeUID=t),delete u.Storage[E])}function W(g){for(var E=g.length;E--;)ee(g[E])}function Y(g){for(var E=g.length,H,K;E--;)H=g[E],K=_e(H),delete u.Storage[K],delete Event.cache[K]}Qe&&(W=Y);function ne(g){if(g=o(g)){ee(g);for(var E=g.getElementsByTagName("*"),H=E.length;H--;)ee(E[H]);return null}}Object.extend(f,{remove:N,update:S,replace:k,insert:D,wrap:m,cleanWhitespace:M,empty:U,clone:q,purge:ne});function X(g,E,H){g=o(g),H=H||-1;for(var K=[];(g=g[E])&&(g.nodeType===Node.ELEMENT_NODE&&K.push(u.extend(g)),K.length!==H););return K}function se(g){return X(g,"parentNode")}function fe(g){return u.select(g,"*")}function pe(g){for(g=o(g).firstChild;g&&g.nodeType!==Node.ELEMENT_NODE;)g=g.nextSibling;return o(g)}function me(g){for(var E=[],H=o(g).firstChild;H;)H.nodeType===Node.ELEMENT_NODE&&E.push(u.extend(H)),H=H.nextSibling;return E}function ye(g){return X(g,"previousSibling")}function be(g){return X(g,"nextSibling")}function Ee(g){g=o(g);var E=ye(g),H=be(g);return E.reverse().concat(H)}function Se(g,E){return g=o(g),Object.isString(E)?Prototype.Selector.match(g,E):E.match(g)}function Q(g,E,H,K){for(g=o(g),H=H||0,K=K||0,Object.isNumber(H)&&(K=H,H=null);g=g[E];)if(g.nodeType===1&&!(H&&!Prototype.Selector.match(g,H))&&!(--K>=0))return u.extend(g)}function B(g,E,H){return g=o(g),arguments.length===1?o(g.parentNode):Q(g,"parentNode",E,H)}function J(g,E,H){g=o(g),E=E||0,H=H||0,Object.isNumber(E)&&(H=E,E="*");var K=Prototype.Selector.select(E,g)[H];return u.extend(K)}function te(g,E,H){return Q(g,"previousSibling",E,H)}function G(g,E,H){return Q(g,"nextSibling",E,H)}function Z(g){g=o(g);var E=n.call(arguments,1).join(", ");return Prototype.Selector.select(E,g)}function re(g){g=o(g);for(var E=n.call(arguments,1).join(", "),H=u.siblings(g),K=[],oe=0,le;le=H[oe];oe++)Prototype.Selector.match(le,E)&&K.push(le);return K}function ie(g,E){for(g=o(g),E=o(E);g=g.parentNode;)if(g===E)return!0;return!1}function ce(g,E){return g=o(g),E=o(E),E.contains?E.contains(g)&&E!==g:ie(g,E)}function ve(g,E){return g=o(g),E=o(E),(g.compareDocumentPosition(E)&8)===8}var he;r.compareDocumentPosition?he=ve:r.contains?he=ce:he=ie,Object.extend(f,{recursivelyCollect:X,ancestors:se,descendants:fe,firstDescendant:pe,immediateDescendants:me,previousSiblings:ye,nextSiblings:be,siblings:Ee,match:Se,up:B,down:J,previous:te,next:G,select:Z,adjacent:re,descendantOf:he,getElementsBySelector:Z,childElements:me});var Le=1;function Ae(g){g=o(g);var E=u.readAttribute(g,"id");if(E)return E;do E="anonymous_element_"+Le++;while(o(E));return u.writeAttribute(g,"id",E),E}function we(g,E){return o(g).getAttribute(E)}function ue(g,E){g=o(g);var H=ke.read;return H.values[E]?H.values[E](g,E):(H.names[E]&&(E=H.names[E]),E.include(":")?!g.attributes||!g.attributes[E]?null:g.attributes[E].value:g.getAttribute(E))}function ae(g,E){return E==="title"?g.title:g.getAttribute(E)}var ge=(function(){r.setAttribute("onclick",Prototype.emptyFunction);var g=r.getAttribute("onclick"),E=typeof g=="function";return r.removeAttribute("onclick"),E})();ge?we=ue:Prototype.Browser.Opera&&(we=ae);function Pe(g,E,H){g=o(g);var K={},oe=ke.write;typeof E=="object"?K=E:K[E]=Object.isUndefined(H)?!0:H;for(var le in K)E=oe.names[le]||le,H=K[le],oe.values[le]&&(E=oe.values[le](g,H)),H===!1||H===null?g.removeAttribute(E):H===!0?g.setAttribute(E,E):g.setAttribute(E,H);return g}function de(g,E){E=ke.has[E]||E;var H=o(g).getAttributeNode(E);return!!(H&&H.specified)}e.Element.Methods.Simulated.hasAttribute=de;function Te(g){return new u.ClassNames(g)}var Me={};function Je(g){if(Me[g])return Me[g];var E=new RegExp("(^|\\s+)"+g+"(\\s+|$)");return Me[g]=E,E}function ze(g,E){if(g=o(g)){var H=g.className;return H.length===0?!1:H===E?!0:Je(E).test(H)}}function at(g,E){if(g=o(g))return ze(g,E)||(g.className+=(g.className?" ":"")+E),g}function st(g,E){if(g=o(g))return g.className=g.className.replace(Je(E)," ").strip(),g}function lt(g,E,H){if(g=o(g)){Object.isUndefined(H)&&(H=!ze(g,E));var K=u[H?"addClassName":"removeClassName"];return K(g,E)}}var ke={},Re="className",Ie="for";r.setAttribute(Re,"x"),r.className!=="x"&&(r.setAttribute("class","x"),r.className==="x"&&(Re="class"));var Oe=document.createElement("label");Oe.setAttribute(Ie,"x"),Oe.htmlFor!=="x"&&(Oe.setAttribute("htmlFor","x"),Oe.htmlFor==="x"&&(Ie="htmlFor")),Oe=null;function ct(g,E){return g.getAttribute(E)}function Ke(g,E){return g.getAttribute(E,2)}function ut(g,E){var H=g.getAttributeNode(E);return H?H.value:""}function He(g,E){return o(g).hasAttribute(E)?E:null}r.onclick=Prototype.emptyFunction;var Xe=r.getAttribute("onclick"),Ce;String(Xe).indexOf("{")>-1?Ce=function(g,E){var H=g.getAttribute(E);return H?(H=H.toString(),H=H.split("{")[1],H=H.split("}")[0],H.strip()):null}:Xe===""&&(Ce=function(g,E){var H=g.getAttribute(E);return H?H.strip():null}),ke.read={names:{class:Re,className:Re,for:Ie,htmlFor:Ie},values:{style:function(g){return g.style.cssText.toLowerCase()},title:function(g){return g.title}}},ke.write={names:{className:"class",htmlFor:"for",cellpadding:"cellPadding",cellspacing:"cellSpacing"},values:{checked:function(g,E){g.checked=!!E},style:function(g,E){g.style.cssText=E||""}}},ke.has={names:{}},Object.extend(ke.write.names,ke.read.names);for(var dt=$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc frameBorder"),Ze=0,Ue;Ue=dt[Ze];Ze++)ke.write.names[Ue.toLowerCase()]=Ue,ke.has.names[Ue.toLowerCase()]=Ue;Object.extend(ke.read.values,{href:Ke,src:Ke,type:ct,action:ut,disabled:He,checked:He,readonly:He,multiple:He,onload:Ce,onunload:Ce,onclick:Ce,ondblclick:Ce,onmousedown:Ce,onmouseup:Ce,onmouseover:Ce,onmousemove:Ce,onmouseout:Ce,onfocus:Ce,onblur:Ce,onkeypress:Ce,onkeydown:Ce,onkeyup:Ce,onsubmit:Ce,onreset:Ce,onselect:Ce,onchange:Ce}),Object.extend(f,{identify:Ae,readAttribute:we,writeAttribute:Pe,classNames:Te,hasClassName:ze,addClassName:at,removeClassName:st,toggleClassName:lt});function ft(g){return g==="float"||g==="styleFloat"?"cssFloat":g.camelize()}function pt(g){return g==="float"||g==="cssFloat"?"styleFloat":g.camelize()}function ht(g,E){g=o(g);var H=g.style,K;if(Object.isString(E)){if(H.cssText+=";"+E,E.include("opacity")){var oe=E.match(/opacity:\s*(\d?\.?\d*)/)[1];u.setOpacity(g,oe)}return g}for(var le in E)if(le==="opacity")u.setOpacity(g,E[le]);else{var xe=E[le];(le==="float"||le==="cssFloat")&&(le=Object.isUndefined(H.styleFloat)?"cssFloat":"styleFloat"),H[le]=xe}return g}function Be(g,E){g=o(g),E=ft(E);var H=g.style[E];if(!H||H==="auto"){var K=document.defaultView.getComputedStyle(g,null);H=K?K[E]:null}return E==="opacity"?H?parseFloat(H):1:H==="auto"?null:H}function Tt(g,E){switch(E){case"height":case"width":if(!u.visible(g))return null;var H=parseInt(Be(g,E),10);return H!==g["offset"+E.capitalize()]?H+"px":u.measure(g,E);default:return Be(g,E)}}function gt(g,E){g=o(g),E=pt(E);var H=g.style[E];return!H&&g.currentStyle&&(H=g.currentStyle[E]),E==="opacity"&&!Ge?nt(g):H==="auto"?(E==="width"||E==="height")&&u.visible(g)?u.measure(g,E)+"px":null:H}function et(g){return(g||"").replace(/alpha\([^\)]*\)/gi,"")}function mt(g){return g.currentStyle.hasLayout||(g.style.zoom=1),g}var Ge=(function(){return r.style.cssText="opacity:.55",/^0.55/.test(r.style.opacity)})();function tt(g,E){return g=o(g),E==1||E===""?E="":E<1e-5&&(E=0),g.style.opacity=E,g}function vt(g,E){if(Ge)return tt(g,E);g=mt(o(g));var H=u.getStyle(g,"filter"),K=g.style;return E==1||E===""?(H=et(H),H?K.filter=H:K.removeAttribute("filter"),g):(E<1e-5&&(E=0),K.filter=et(H)+"alpha(opacity="+E*100+")",g)}function it(g){return u.getStyle(g,"opacity")}function nt(g){if(Ge)return it(g);var E=u.getStyle(g,"filter");if(E.length===0)return 1;var H=(E||"").match(/alpha\(opacity=(.*)\)/);return H[1]?parseFloat(H[1])/100:1}Object.extend(f,{setStyle:ht,getStyle:Be,setOpacity:tt,getOpacity:it}),"styleFloat"in r.style&&(f.getStyle=gt,f.setOpacity=vt,f.getOpacity=nt);var kt=0;e.Element.Storage={UID:1};function _e(g){return g===window?0:(typeof g._prototypeUID>"u"&&(g._prototypeUID=u.Storage.UID++),g._prototypeUID)}function yt(g){return g===window?0:g==document?1:g.uniqueID}var Qe="uniqueID"in r;Qe&&(_e=yt);function qe(g){if(g=o(g)){var E=_e(g);return u.Storage[E]||(u.Storage[E]=$H()),u.Storage[E]}}function bt(g,E,H){if(g=o(g)){var K=qe(g);return arguments.length===2?K.update(E):K.set(E,H),g}}function Ct(g,E,H){if(g=o(g)){var K=qe(g),oe=K.get(E);return Object.isUndefined(oe)&&(K.set(E,H),oe=H),oe}}Object.extend(f,{getStorage:qe,store:bt,retrieve:Ct});var Ve={},De=u.Methods.ByTag,Ne=Prototype.BrowserFeatures;!Ne.ElementExtensions&&"__proto__"in r&&(e.HTMLElement={},e.HTMLElement.prototype=r.__proto__,Ne.ElementExtensions=!0);function wt(g){if(typeof window.Element>"u")return!1;var E=window.Element.prototype;if(E){var H="_"+(Math.random()+"").slice(2),K=document.createElement(g);E[H]="x";var oe=K[H]!=="x";return delete E[H],K=null,oe}return!1}var xt=wt("object");function Fe(g,E){for(var H in E){var K=E[H];Object.isFunction(K)&&!(H in g)&&(g[H]=K.methodize())}}var $e={};function rt(g){var E=_e(g);return E in $e}function We(g){if(!g||rt(g)||g.nodeType!==Node.ELEMENT_NODE||g==window)return g;var E=Object.clone(Ve),H=g.tagName.toUpperCase();return De[H]&&Object.extend(E,De[H]),Fe(g,E),$e[_e(g)]=!0,g}function At(g){if(!g||rt(g))return g;var E=g.tagName;return E&&/^(?:object|applet|embed)$/i.test(E)&&(Fe(g,u.Methods),Fe(g,u.Methods.Simulated),Fe(g,u.Methods.ByTag[E.toUpperCase()])),g}Ne.SpecificElementExtensions&&(We=xt?At:Prototype.K);function ot(g,E){g=g.toUpperCase(),De[g]||(De[g]={}),Object.extend(De[g],E)}function Ye(g,E,H){Object.isUndefined(H)&&(H=!1);for(var K in E){var oe=E[K];Object.isFunction(oe)&&(!H||!(K in g))&&(g[K]=oe.methodize())}}function Et(g){var E,H={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};if(H[g]&&(E="HTML"+H[g]+"Element"),window[E]||(E="HTML"+g+"Element",window[E])||(E="HTML"+g.capitalize()+"Element",window[E]))return window[E];var K=document.createElement(g),oe=K.__proto__||K.constructor.prototype;return K=null,oe}function St(g){if(arguments.length===0&&Pt(),arguments.length===2){var E=g;g=arguments[1]}if(!E)Object.extend(u.Methods,g||{});else if(Object.isArray(E))for(var H=0,K;K=E[H];H++)ot(K,g);else ot(E,g);var oe=window.HTMLElement?HTMLElement.prototype:u.prototype;if(Ne.ElementExtensions&&(Ye(oe,u.Methods),Ye(oe,u.Methods.Simulated,!0)),Ne.SpecificElementExtensions)for(var K in u.Methods.ByTag){var le=Et(K);Object.isUndefined(le)||Ye(le.prototype,De[K])}Object.extend(u,u.Methods),Object.extend(u,u.Methods.Simulated),delete u.ByTag,delete u.Simulated,u.extend.refresh(),a={}}Object.extend(e.Element,{extend:We,addMethods:St}),We===Prototype.K?e.Element.extend.refresh=Prototype.emptyFunction:e.Element.extend.refresh=function(){Prototype.BrowserFeatures.ElementExtensions||(Object.extend(Ve,u.Methods),Object.extend(Ve,u.Methods.Simulated),$e={})};function Pt(){Object.extend(Form,Form.Methods),Object.extend(Form.Element,Form.Element.Methods),Object.extend(u.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods),BUTTON:Object.clone(Form.Element.Methods)})}u.addMethods(f)})(this),(function(){function e(m){var M=m.match(/^(\d+)%?$/i);return M?Number(M[1])/100:null}function t(m,M){m=$(m);var U=m.style[M];if(!U||U==="auto"){var z=document.defaultView.getComputedStyle(m,null);U=z?z[M]:null}return M==="opacity"?U?parseFloat(U):1:U==="auto"?null:U}function n(m,M){var U=m.style[M];return!U&&m.currentStyle&&(U=m.currentStyle[M]),U}function r(m,M){var U=m.offsetWidth,z=o(m,"borderLeftWidth",M)||0,q=o(m,"borderRightWidth",M)||0,ee=o(m,"paddingLeft",M)||0,W=o(m,"paddingRight",M)||0;return U-z-q-ee-W}"currentStyle"in document.documentElement&&(t=n);function o(m,M,U){var z=null;if(Object.isElement(m)&&(z=m,m=t(z,M)),m===null||Object.isUndefined(m))return null;if(/^(?:-)?\d+(\.\d+)?(px)?$/i.test(m))return window.parseFloat(m);var q=m.include("%"),ee=U===document.viewport;if(/\d/.test(m)&&z&&z.runtimeStyle&&!(q&&ee)){var W=z.style.left,Y=z.runtimeStyle.left;return z.runtimeStyle.left=z.currentStyle.left,z.style.left=m||0,m=z.style.pixelLeft,z.style.left=W,z.runtimeStyle.left=Y,m}if(z&&q){U=U||z.parentNode;var ne=e(m),X=null,se=M.include("left")||M.include("right")||M.include("width"),fe=M.include("top")||M.include("bottom")||M.include("height");return U===document.viewport?se?X=document.viewport.getWidth():fe&&(X=document.viewport.getHeight()):se?X=$(U).measure("width"):fe&&(X=$(U).measure("height")),X===null?0:X*ne}return 0}function a(m){return Object.isString(m)&&m.endsWith("px")?m:m+"px"}function s(m){for(;m&&m.parentNode;){var M=m.getStyle("display");if(M==="none")return!1;m=$(m.parentNode)}return!0}var c=Prototype.K;"currentStyle"in document.documentElement&&(c=function(m){return m.currentStyle.hasLayout||(m.style.zoom=1),m});function d(m){return m.include("border")&&(m=m+"-width"),m.camelize()}Element.Layout=Class.create(Hash,{initialize:function(m,M,U){m(),this.element=$(M),Element.Layout.PROPERTIES.each(function(z){this._set(z,null)},this),U&&(this._preComputing=!0,this._begin(),Element.Layout.PROPERTIES.each(this._compute,this),this._end(),this._preComputing=!1)},_set:function(m,M){return Hash.prototype.set.call(this,m,M)},set:function(m,M){throw"Properties of Element.Layout are read-only."},get:function(m,M){var U=m(M);return U===null?this._compute(M):U},_begin:function(){if(!this._isPrepared()){var m=this.element;if(s(m)){this._setPrepared(!0);return}var M={position:m.style.position||"",width:m.style.width||"",visibility:m.style.visibility||"",display:m.style.display||""};m.store("prototype_original_styles",M);var U=t(m,"position"),z=m.offsetWidth;(z===0||z===null)&&(m.style.display="block",z=m.offsetWidth);var q=U==="fixed"?document.viewport:m.parentNode,ee={visibility:"hidden",display:"block"};U!=="fixed"&&(ee.position="absolute"),m.setStyle(ee);var W=m.offsetWidth,Y;if(z&&W===z)Y=r(m,q);else if(U==="absolute"||U==="fixed")Y=r(m,q);else{var ne=m.parentNode,X=$(ne).getLayout();Y=X.get("width")-this.get("margin-left")-this.get("border-left")-this.get("padding-left")-this.get("padding-right")-this.get("border-right")-this.get("margin-right")}m.setStyle({width:Y+"px"}),this._setPrepared(!0)}},_end:function(){var m=this.element,M=m.retrieve("prototype_original_styles");m.store("prototype_original_styles",null),m.setStyle(M),this._setPrepared(!1)},_compute:function(m){var M=Element.Layout.COMPUTATIONS;if(!(m in M))throw"Property not found.";return this._set(m,M[m].call(this,this.element))},_isPrepared:function(){return this.element.retrieve("prototype_element_layout_prepared",!1)},_setPrepared:function(m){return this.element.store("prototype_element_layout_prepared",m)},toObject:function(){var m=$A(arguments),M=m.length===0?Element.Layout.PROPERTIES:m.join(" ").split(" "),U={};return M.each(function(z){if(Element.Layout.PROPERTIES.include(z)){var q=this.get(z);q!=null&&(U[z]=q)}},this),U},toHash:function(){var m=this.toObject.apply(this,arguments);return new Hash(m)},toCSS:function(){var m=$A(arguments),M=m.length===0?Element.Layout.PROPERTIES:m.join(" ").split(" "),U={};return M.each(function(z){if(Element.Layout.PROPERTIES.include(z)&&!Element.Layout.COMPOSITE_PROPERTIES.include(z)){var q=this.get(z);q!=null&&(U[d(z)]=q+"px")}},this),U},inspect:function(){return"#<Element.Layout>"}}),Object.extend(Element.Layout,{PROPERTIES:$w("height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height"),COMPOSITE_PROPERTIES:$w("padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height"),COMPUTATIONS:{height:function(m){this._preComputing||this._begin();var M=this.get("border-box-height");if(M<=0)return this._preComputing||this._end(),0;var U=this.get("border-top"),z=this.get("border-bottom"),q=this.get("padding-top"),ee=this.get("padding-bottom");return this._preComputing||this._end(),M-U-z-q-ee},width:function(m){this._preComputing||this._begin();var M=this.get("border-box-width");if(M<=0)return this._preComputing||this._end(),0;var U=this.get("border-left"),z=this.get("border-right"),q=this.get("padding-left"),ee=this.get("padding-right");return this._preComputing||this._end(),M-U-z-q-ee},"padding-box-height":function(m){var M=this.get("height"),U=this.get("padding-top"),z=this.get("padding-bottom");return M+U+z},"padding-box-width":function(m){var M=this.get("width"),U=this.get("padding-left"),z=this.get("padding-right");return M+U+z},"border-box-height":function(m){this._preComputing||this._begin();var M=m.offsetHeight;return this._preComputing||this._end(),M},"border-box-width":function(m){this._preComputing||this._begin();var M=m.offsetWidth;return this._preComputing||this._end(),M},"margin-box-height":function(m){var M=this.get("border-box-height"),U=this.get("margin-top"),z=this.get("margin-bottom");return M<=0?0:M+U+z},"margin-box-width":function(m){var M=this.get("border-box-width"),U=this.get("margin-left"),z=this.get("margin-right");return M<=0?0:M+U+z},top:function(m){var M=m.positionedOffset();return M.top},bottom:function(m){var M=m.positionedOffset(),U=m.getOffsetParent(),z=U.measure("height"),q=this.get("border-box-height");return z-q-M.top},left:function(m){var M=m.positionedOffset();return M.left},right:function(m){var M=m.positionedOffset(),U=m.getOffsetParent(),z=U.measure("width"),q=this.get("border-box-width");return z-q-M.left},"padding-top":function(m){return o(m,"paddingTop")},"padding-bottom":function(m){return o(m,"paddingBottom")},"padding-left":function(m){return o(m,"paddingLeft")},"padding-right":function(m){return o(m,"paddingRight")},"border-top":function(m){return o(m,"borderTopWidth")},"border-bottom":function(m){return o(m,"borderBottomWidth")},"border-left":function(m){return o(m,"borderLeftWidth")},"border-right":function(m){return o(m,"borderRightWidth")},"margin-top":function(m){return o(m,"marginTop")},"margin-bottom":function(m){return o(m,"marginBottom")},"margin-left":function(m){return o(m,"marginLeft")},"margin-right":function(m){return o(m,"marginRight")}}}),"getBoundingClientRect"in document.documentElement&&Object.extend(Element.Layout.COMPUTATIONS,{right:function(m){var M=c(m.getOffsetParent()),U=m.getBoundingClientRect(),z=M.getBoundingClientRect();return(z.right-U.right).round()},bottom:function(m){var M=c(m.getOffsetParent()),U=m.getBoundingClientRect(),z=M.getBoundingClientRect();return(z.bottom-U.bottom).round()}}),Element.Offset=Class.create({initialize:function(m,M){this.left=m.round(),this.top=M.round(),this[0]=this.left,this[1]=this.top},relativeTo:function(m){return new Element.Offset(this.left-m.left,this.top-m.top)},inspect:function(){return"#<Element.Offset left: #{left} top: #{top}>".interpolate(this)},toString:function(){return"[#{left}, #{top}]".interpolate(this)},toArray:function(){return[this.left,this.top]}});function u(m,M){return new Element.Layout(m,M)}function f(m,M){return $(m).getLayout().get(M)}function v(m){return Element.getDimensions(m).height}function h(m){return Element.getDimensions(m).width}function C(m){m=$(m);var M=Element.getStyle(m,"display");if(M&&M!=="none")return{width:m.offsetWidth,height:m.offsetHeight};var U=m.style,z={visibility:U.visibility,position:U.position,display:U.display},q={visibility:"hidden",display:"block"};z.position!=="fixed"&&(q.position="absolute"),Element.setStyle(m,q);var ee={width:m.offsetWidth,height:m.offsetHeight};return Element.setStyle(m,z),ee}function A(m){if(m=$(m),V(m)||D(m)||I(m)||F(m))return $(document.body);var M=Element.getStyle(m,"display")==="inline";if(!M&&m.offsetParent)return $(m.offsetParent);for(;(m=m.parentNode)&&m!==document.body;)if(Element.getStyle(m,"position")!=="static")return F(m)?$(document.body):$(m);return $(document.body)}function T(m){m=$(m);var M=0,U=0;if(m.parentNode)do M+=m.offsetTop||0,U+=m.offsetLeft||0,m=m.offsetParent;while(m);return new Element.Offset(U,M)}function j(m){m=$(m);var M=m.getLayout(),U=0,z=0;do if(U+=m.offsetTop||0,z+=m.offsetLeft||0,m=m.offsetParent,m){if(I(m))break;var q=Element.getStyle(m,"position");if(q!=="static")break}while(m);return z-=M.get("margin-top"),U-=M.get("margin-left"),new Element.Offset(z,U)}function N(m){var M=0,U=0;do M+=m.scrollTop||0,U+=m.scrollLeft||0,m=m.parentNode;while(m);return new Element.Offset(U,M)}function p(m){var M=0,U=0,z=document.body,q=$(m);do if(M+=q.offsetTop||0,U+=q.offsetLeft||0,q.offsetParent==z&&Element.getStyle(q,"position")=="absolute")break;while(q=q.offsetParent);q=m;do q!=z&&(M-=q.scrollTop||0,U-=q.scrollLeft||0);while(q=q.parentNode);return new Element.Offset(U,M)}function b(m){if(m=$(m),Element.getStyle(m,"position")==="absolute")return m;var M=A(m),U=m.viewportOffset(),z=M.viewportOffset(),q=U.relativeTo(z),ee=m.getLayout();return m.store("prototype_absolutize_original_styles",{left:m.getStyle("left"),top:m.getStyle("top"),width:m.getStyle("width"),height:m.getStyle("height")}),m.setStyle({position:"absolute",top:q.top+"px",left:q.left+"px",width:ee.get("width")+"px",height:ee.get("height")+"px"}),m}function _(m){if(m=$(m),Element.getStyle(m,"position")==="relative")return m;var M=m.retrieve("prototype_absolutize_original_styles");return M&&m.setStyle(M),m}function L(m){m=$(m);var M=Element.cumulativeOffset(m);return window.scrollTo(M.left,M.top),m}function P(m){m=$(m);var M=Element.getStyle(m,"position"),U={};return(M==="static"||!M)&&(U.position="relative",Prototype.Browser.Opera&&(U.top=0,U.left=0),Element.setStyle(m,U),Element.store(m,"prototype_made_positioned",!0)),m}function S(m){m=$(m);var M=Element.getStorage(m),U=M.get("prototype_made_positioned");return U&&(M.unset("prototype_made_positioned"),Element.setStyle(m,{position:"",top:"",bottom:"",left:"",right:""})),m}function k(m){m=$(m);var M=Element.getStorage(m),U=M.get("prototype_made_clipping");if(Object.isUndefined(U)){var z=Element.getStyle(m,"overflow");M.set("prototype_made_clipping",z),z!=="hidden"&&(m.style.overflow="hidden")}return m}function O(m){m=$(m);var M=Element.getStorage(m),U=M.get("prototype_made_clipping");return Object.isUndefined(U)||(M.unset("prototype_made_clipping"),m.style.overflow=U||""),m}function R(m,M,U){U=Object.extend({setLeft:!0,setTop:!0,setWidth:!0,setHeight:!0,offsetTop:0,offsetLeft:0},U||{}),M=$(M),m=$(m);var z,q,ee,W={};if((U.setLeft||U.setTop)&&(z=Element.viewportOffset(M),q=[0,0],Element.getStyle(m,"position")==="absolute")){var Y=Element.getOffsetParent(m);Y!==document.body&&(q=Element.viewportOffset(Y))}return(U.setWidth||U.setHeight)&&(ee=Element.getLayout(M)),U.setLeft&&(W.left=z[0]-q[0]+U.offsetLeft+"px"),U.setTop&&(W.top=z[1]-q[1]+U.offsetTop+"px"),U.setWidth&&(W.width=ee.get("border-box-width")+"px"),U.setHeight&&(W.height=ee.get("border-box-height")+"px"),Element.setStyle(m,W)}Prototype.Browser.IE?(A=A.wrap(function(m,M){if(M=$(M),V(M)||D(M)||I(M)||F(M))return $(document.body);var U=M.getStyle("position");if(U!=="static")return m(M);M.setStyle({position:"relative"});var z=m(M);return M.setStyle({position:U}),z}),j=j.wrap(function(m,M){if(M=$(M),!M.parentNode)return new Element.Offset(0,0);var U=M.getStyle("position");if(U!=="static")return m(M);var z=M.getOffsetParent();z&&z.getStyle("position")==="fixed"&&c(z),M.setStyle({position:"relative"});var q=m(M);return M.setStyle({position:U}),q})):Prototype.Browser.Webkit&&(T=function(m){m=$(m);var M=0,U=0;do{if(M+=m.offsetTop||0,U+=m.offsetLeft||0,m.offsetParent==document.body&&Element.getStyle(m,"position")=="absolute")break;m=m.offsetParent}while(m);return new Element.Offset(U,M)}),Element.addMethods({getLayout:u,measure:f,getWidth:h,getHeight:v,getDimensions:C,getOffsetParent:A,cumulativeOffset:T,positionedOffset:j,cumulativeScrollOffset:N,viewportOffset:p,absolutize:b,relativize:_,scrollTo:L,makePositioned:P,undoPositioned:S,makeClipping:k,undoClipping:O,clonePosition:R});function I(m){return m.nodeName.toUpperCase()==="BODY"}function F(m){return m.nodeName.toUpperCase()==="HTML"}function V(m){return m.nodeType===Node.DOCUMENT_NODE}function D(m){return m!==document.body&&!Element.descendantOf(m,document.body)}"getBoundingClientRect"in document.documentElement&&Element.addMethods({viewportOffset:function(m){if(m=$(m),D(m))return new Element.Offset(0,0);var M=m.getBoundingClientRect(),U=document.documentElement;return new Element.Offset(M.left-U.clientLeft,M.top-U.clientTop)}})})(),(function(){var e=Prototype.Browser.Opera&&window.parseFloat(window.opera.version())<9.5,t=null;function n(){return t||(t=e?document.body:document.documentElement,t)}function r(){return{width:this.getWidth(),height:this.getHeight()}}function o(){return n().clientWidth}function a(){return n().clientHeight}function s(){var c=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,d=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;return new Element.Offset(c,d)}document.viewport={getDimensions:r,getWidth:o,getHeight:a,getScrollOffsets:s}})(),window.$$=function(){var e=$A(arguments).join(", ");return Prototype.Selector.select(e,document)},Prototype.Selector=(function(){function e(){throw new Error('Method "Prototype.Selector.select" must be defined.')}function t(){throw new Error('Method "Prototype.Selector.match" must be defined.')}function n(a,s,c){c=c||0;var d=Prototype.Selector.match,u=a.length,f=0,v;for(v=0;v<u;v++)if(d(a[v],s)&&c==f++)return Element.extend(a[v])}function r(a){for(var s=0,c=a.length;s<c;s++)Element.extend(a[s]);return a}var o=Prototype.K;return{select:e,match:t,find:n,extendElements:Element.extend===o?o:r,extendElement:Element.extend}})();/*!
var Prototype={Version:"1.7.1",Browser:(function(){var e=navigator.userAgent,t=Object.prototype.toString.call(window.opera)=="[object Opera]";return{IE:!!window.attachEvent&&!t,Opera:t,WebKit:e.indexOf("AppleWebKit/")>-1,Gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,MobileSafari:/Apple.*Mobile/.test(e)}})(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:(function(){var e=window.Element||window.HTMLElement;return!!(e&&e.prototype)})(),SpecificElementExtensions:(function(){if(typeof window.HTMLDivElement<"u")return!0;var e=document.createElement("div"),t=document.createElement("form"),r=!1;return e.__proto__&&e.__proto__!==t.__proto__&&(r=!0),e=t=null,r})()},ScriptFragment:"<script[^>]*>([\\S\\s]*?)<\/script\\s*>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(e){return e}};Prototype.Browser.MobileSafari&&(Prototype.BrowserFeatures.SpecificElementExtensions=!1);var Class=(function(){var e=(function(){for(var n in{toString:1})if(n==="toString")return!1;return!0})();function t(){}function r(){var n=null,o=$A(arguments);Object.isFunction(o[0])&&(n=o.shift());function u(){this.initialize.apply(this,arguments)}Object.extend(u,Class.Methods),u.superclass=n,u.subclasses=[],n&&(t.prototype=n.prototype,u.prototype=new t,n.subclasses.push(u));for(var s=0,d=o.length;s<d;s++)u.addMethods(o[s]);return u.prototype.initialize||(u.prototype.initialize=Prototype.emptyFunction),u.prototype.constructor=u,u}function a(n){var o=this.superclass&&this.superclass.prototype,u=Object.keys(n);e&&(n.toString!=Object.prototype.toString&&u.push("toString"),n.valueOf!=Object.prototype.valueOf&&u.push("valueOf"));for(var s=0,d=u.length;s<d;s++){var c=u[s],f=n[c];if(o&&Object.isFunction(f)&&f.argumentNames()[0]=="$super"){var C=f;f=(function(m){return function(){return o[m].apply(this,arguments)}})(c).wrap(C),f.valueOf=(function(m){return function(){return m.valueOf.call(m)}})(C),f.toString=(function(m){return function(){return m.toString.call(m)}})(C)}this.prototype[c]=f}return this}return{create:r,Methods:{addMethods:a}}})();(function(){var e=Object.prototype.toString,t=Object.prototype.hasOwnProperty,r="Null",a="Undefined",n="Boolean",o="Number",u="String",s="Object",d="[object Function]",c="[object Boolean]",f="[object Number]",C="[object String]",m="[object Array]",E="[object Date]",S=window.JSON&&typeof JSON.stringify=="function"&&JSON.stringify(0)==="0"&&typeof JSON.stringify(Prototype.K)>"u",P=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],N=(function(){for(var J in{toString:1})if(J==="toString")return!1;return!0})();function R(J){switch(J){case null:return r;case void 0:return a}var re=typeof J;switch(re){case"boolean":return n;case"number":return o;case"string":return u}return s}function g(J,re){for(var ne in re)J[ne]=re[ne];return J}function v(J){try{return te(J)?"undefined":J===null?"null":J.inspect?J.inspect():String(J)}catch(re){if(re instanceof RangeError)return"...";throw re}}function M(J){return L("",{"":J},[])}function L(J,re,ne){var K=re[J];R(K)===s&&typeof K.toJSON=="function"&&(K=K.toJSON(J));var ue=e.call(K);switch(ue){case f:case c:case C:K=K.valueOf()}switch(K){case null:return"null";case!0:return"true";case!1:return"false"}var pe=typeof K;switch(pe){case"string":return K.inspect(!0);case"number":return isFinite(K)?String(K):"null";case"object":for(var he=0,be=ne.length;he<be;he++)if(ne[he]===K)throw new TypeError("Cyclic reference to '"+K+"' in object");ne.push(K);var Ce=[];if(ue===m){for(var he=0,be=K.length;he<be;he++){var ve=L(he,K,ne);Ce.push(typeof ve>"u"?"null":ve)}Ce="["+Ce.join(",")+"]"}else{for(var Ee=Object.keys(K),he=0,be=Ee.length;he<be;he++){var J=Ee[he],ve=L(J,K,ne);typeof ve<"u"&&Ce.push(J.inspect(!0)+":"+ve)}Ce="{"+Ce.join(",")+"}"}return ne.pop(),Ce}}function T(J){return JSON.stringify(J)}function A(J){return $H(J).toQueryString()}function j(J){return J&&J.toHTML?J.toHTML():String.interpret(J)}function k(J){if(R(J)!==s)throw new TypeError;var re=[];for(var ne in J)t.call(J,ne)&&re.push(ne);if(N)for(var K=0;ne=P[K];K++)t.call(J,ne)&&re.push(ne);return re}function U(J){var re=[];for(var ne in J)re.push(J[ne]);return re}function _(J){return g({},J)}function Q(J){return!!(J&&J.nodeType==1)}function W(J){return e.call(J)===m}var F=typeof Array.isArray=="function"&&Array.isArray([])&&!Array.isArray({});F&&(W=Array.isArray);function p(J){return J instanceof Hash}function D(J){return e.call(J)===d}function O(J){return e.call(J)===C}function G(J){return e.call(J)===f}function V(J){return e.call(J)===E}function te(J){return typeof J>"u"}g(Object,{extend:g,inspect:v,toJSON:S?T:M,toQueryString:A,toHTML:j,keys:Object.keys||k,values:U,clone:_,isElement:Q,isArray:W,isHash:p,isFunction:D,isString:O,isNumber:G,isDate:V,isUndefined:te})})(),Object.extend(Function.prototype,(function(){var e=Array.prototype.slice;function t(m,E){for(var S=m.length,P=E.length;P--;)m[S+P]=E[P];return m}function r(m,E){return m=e.call(m,0),t(m,E)}function a(){var m=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return m.length==1&&!m[0]?[]:m}function n(m){if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;if(!Object.isFunction(this))throw new TypeError("The object is not callable.");var E=function(){},S=this,P=e.call(arguments,1),N=function(){var R=r(P,arguments),g=m,g=this instanceof N?this:m;return S.apply(g,R)};return E.prototype=this.prototype,N.prototype=new E,N}function o(m){var E=this,S=e.call(arguments,1);return function(P){var N=t([P||window.event],S);return E.apply(m,N)}}function u(){if(!arguments.length)return this;var m=this,E=e.call(arguments,0);return function(){var S=r(E,arguments);return m.apply(this,S)}}function s(m){var E=this,S=e.call(arguments,1);return m=m*1e3,window.setTimeout(function(){return E.apply(E,S)},m)}function d(){var m=t([.01],arguments);return this.delay.apply(this,m)}function c(m){var E=this;return function(){var S=t([E.bind(this)],arguments);return m.apply(this,S)}}function f(){if(this._methodized)return this._methodized;var m=this;return this._methodized=function(){var E=t([this],arguments);return m.apply(null,E)}}var C={argumentNames:a,bindAsEventListener:o,curry:u,delay:s,defer:d,wrap:c,methodize:f};return Function.prototype.bind||(C.bind=n),C})()),(function(e){function t(){return this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+"Z"}function r(){return this.toISOString()}e.toISOString||(e.toISOString=t),e.toJSON||(e.toJSON=r)})(Date.prototype),RegExp.prototype.match=RegExp.prototype.test,RegExp.escape=function(e){return String(e).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};var PeriodicalExecuter=Class.create({initialize:function(e,t){this.callback=e,this.frequency=t,this.currentlyExecuting=!1,this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1e3)},execute:function(){this.callback(this)},stop:function(){this.timer&&(clearInterval(this.timer),this.timer=null)},onTimerEvent:function(){if(!this.currentlyExecuting)try{this.currentlyExecuting=!0,this.execute(),this.currentlyExecuting=!1}catch(e){throw this.currentlyExecuting=!1,e}}});Object.extend(String,{interpret:function(e){return e==null?"":String(e)},specialChar:{"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"}}),Object.extend(String.prototype,(function(){var NATIVE_JSON_PARSE_SUPPORT=window.JSON&&typeof JSON.parse=="function"&&JSON.parse('{"test": true}').test;function prepareReplacement(e){if(Object.isFunction(e))return e;var t=new Template(e);return function(r){return t.evaluate(r)}}function gsub(e,t){var r="",a=this,n;if(t=prepareReplacement(t),Object.isString(e)&&(e=RegExp.escape(e)),!(e.length||e.source))return t=t(""),t+a.split("").join(t)+t;for(;a.length>0;)(n=a.match(e))?(r+=a.slice(0,n.index),r+=String.interpret(t(n)),a=a.slice(n.index+n[0].length)):(r+=a,a="");return r}function sub(e,t,r){return t=prepareReplacement(t),r=Object.isUndefined(r)?1:r,this.gsub(e,function(a){return--r<0?a[0]:t(a)})}function scan(e,t){return this.gsub(e,t),String(this)}function truncate(e,t){return e=e||30,t=Object.isUndefined(t)?"...":t,this.length>e?this.slice(0,e-t.length)+t:String(this)}function strip(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}function stripTags(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")}function stripScripts(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")}function extractScripts(){var e=new RegExp(Prototype.ScriptFragment,"img"),t=new RegExp(Prototype.ScriptFragment,"im");return(this.match(e)||[]).map(function(r){return(r.match(t)||["",""])[1]})}function evalScripts(){return this.extractScripts().map(function(script){return eval(script)})}function escapeHTML(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function unescapeHTML(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}function toQueryParams(e){var t=this.strip().match(/([^?#]*)(#.*)?$/);return t?t[1].split(e||"&").inject({},function(r,a){if((a=a.split("="))[0]){var n=decodeURIComponent(a.shift()),o=a.length>1?a.join("="):a[0];o!=null&&(o=decodeURIComponent(o)),n in r?(Object.isArray(r[n])||(r[n]=[r[n]]),r[n].push(o)):r[n]=o}return r}):{}}function toArray(){return this.split("")}function succ(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)}function times(e){return e<1?"":new Array(e+1).join(this)}function camelize(){return this.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})}function capitalize(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()}function underscore(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()}function dasherize(){return this.replace(/_/g,"-")}function inspect(e){var t=this.replace(/[\x00-\x1f\\]/g,function(r){return r in String.specialChar?String.specialChar[r]:"\\u00"+r.charCodeAt().toPaddedString(2,16)});return e?'"'+t.replace(/"/g,'\\"')+'"':"'"+t.replace(/'/g,"\\'")+"'"}function unfilterJSON(e){return this.replace(e||Prototype.JSONFilter,"$1")}function isJSON(){var e=this;return e.blank()?!1:(e=e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@"),e=e.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]"),e=e.replace(/(?:^|:|,)(?:\s*\[)+/g,""),/^[\],:{}\s]*$/.test(e))}function evalJSON(sanitize){var json=this.unfilterJSON(),cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;cx.test(json)&&(json=json.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));try{if(!sanitize||json.isJSON())return eval("("+json+")")}catch(e){}throw new SyntaxError("Badly formed JSON string: "+this.inspect())}function parseJSON(){var e=this.unfilterJSON();return JSON.parse(e)}function include(e){return this.indexOf(e)>-1}function startsWith(e){return this.lastIndexOf(e,0)===0}function endsWith(e){var t=this.length-e.length;return t>=0&&this.indexOf(e,t)===t}function empty(){return this==""}function blank(){return/^\s*$/.test(this)}function interpolate(e,t){return new Template(this,t).evaluate(e)}return{gsub,sub,scan,truncate,strip:String.prototype.trim||strip,stripTags,stripScripts,extractScripts,evalScripts,escapeHTML,unescapeHTML,toQueryParams,parseQuery:toQueryParams,toArray,succ,times,camelize,capitalize,underscore,dasherize,inspect,unfilterJSON,isJSON,evalJSON:NATIVE_JSON_PARSE_SUPPORT?parseJSON:evalJSON,include,startsWith,endsWith,empty,blank,interpolate}})());var Template=Class.create({initialize:function(e,t){this.template=e.toString(),this.pattern=t||Template.Pattern},evaluate:function(e){return e&&Object.isFunction(e.toTemplateReplacements)&&(e=e.toTemplateReplacements()),this.template.gsub(this.pattern,function(t){if(e==null)return t[1]+"";var r=t[1]||"";if(r=="\\")return t[2];var a=e,n=t[3],o=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;if(t=o.exec(n),t==null)return r;for(;t!=null;){var u=t[1].startsWith("[")?t[2].replace(/\\\\]/g,"]"):t[1];if(a=a[u],a==null||t[3]=="")break;n=n.substring(t[3]=="["?t[1].length:t[0].length),t=o.exec(n)}return r+String.interpret(a)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;var $break={},Enumerable=(function(){function e(T,A){try{this._each(T,A)}catch(j){if(j!=$break)throw j}return this}function t(T,A,j){var k=-T,U=[],_=this.toArray();if(T<1)return _;for(;(k+=T)<_.length;)U.push(_.slice(k,k+T));return U.collect(A,j)}function r(T,A){T=T||Prototype.K;var j=!0;return this.each(function(k,U){if(j=j&&!!T.call(A,k,U,this),!j)throw $break},this),j}function a(T,A){T=T||Prototype.K;var j=!1;return this.each(function(k,U){if(j=!!T.call(A,k,U,this))throw $break},this),j}function n(T,A){T=T||Prototype.K;var j=[];return this.each(function(k,U){j.push(T.call(A,k,U,this))},this),j}function o(T,A){var j;return this.each(function(k,U){if(T.call(A,k,U,this))throw j=k,$break},this),j}function u(T,A){var j=[];return this.each(function(k,U){T.call(A,k,U,this)&&j.push(k)},this),j}function s(T,A,j){A=A||Prototype.K;var k=[];return Object.isString(T)&&(T=new RegExp(RegExp.escape(T))),this.each(function(U,_){T.match(U)&&k.push(A.call(j,U,_,this))},this),k}function d(T){if(Object.isFunction(this.indexOf)&&this.indexOf(T)!=-1)return!0;var A=!1;return this.each(function(j){if(j==T)throw A=!0,$break}),A}function c(T,A){return A=Object.isUndefined(A)?null:A,this.eachSlice(T,function(j){for(;j.length<T;)j.push(A);return j})}function f(T,A,j){return this.each(function(k,U){T=A.call(j,T,k,U,this)},this),T}function C(T){var A=$A(arguments).slice(1);return this.map(function(j){return j[T].apply(j,A)})}function m(T,A){T=T||Prototype.K;var j;return this.each(function(k,U){k=T.call(A,k,U,this),(j==null||k>=j)&&(j=k)},this),j}function E(T,A){T=T||Prototype.K;var j;return this.each(function(k,U){k=T.call(A,k,U,this),(j==null||k<j)&&(j=k)},this),j}function S(T,A){T=T||Prototype.K;var j=[],k=[];return this.each(function(U,_){(T.call(A,U,_,this)?j:k).push(U)},this),[j,k]}function P(T){var A=[];return this.each(function(j){A.push(j[T])}),A}function N(T,A){var j=[];return this.each(function(k,U){T.call(A,k,U,this)||j.push(k)},this),j}function R(T,A){return this.map(function(j,k){return{value:j,criteria:T.call(A,j,k,this)}},this).sort(function(j,k){var U=j.criteria,_=k.criteria;return U<_?-1:U>_?1:0}).pluck("value")}function g(){return this.map()}function v(){var T=Prototype.K,A=$A(arguments);Object.isFunction(A.last())&&(T=A.pop());var j=[this].concat(A).map($A);return this.map(function(k,U){return T(j.pluck(U))})}function M(){return this.toArray().length}function L(){return"#<Enumerable:"+this.toArray().inspect()+">"}return{each:e,eachSlice:t,all:r,every:r,any:a,some:a,collect:n,map:n,detect:o,findAll:u,select:u,filter:u,grep:s,include:d,member:d,inGroupsOf:c,inject:f,invoke:C,max:m,min:E,partition:S,pluck:P,reject:N,sortBy:R,toArray:g,entries:g,zip:v,size:M,inspect:L,find:o}})();function $A(e){if(!e)return[];if("toArray"in Object(e))return e.toArray();for(var t=e.length||0,r=new Array(t);t--;)r[t]=e[t];return r}function $w(e){return Object.isString(e)?(e=e.strip(),e?e.split(/\s+/):[]):[]}Array.from=$A,(function(){var e=Array.prototype,t=e.slice,r=e.forEach;function a(_,Q){for(var W=0,F=this.length>>>0;W<F;W++)W in this&&_.call(Q,this[W],W,this)}r||(r=a);function n(){return this.length=0,this}function o(){return this[0]}function u(){return this[this.length-1]}function s(){return this.select(function(_){return _!=null})}function d(){return this.inject([],function(_,Q){return Object.isArray(Q)?_.concat(Q.flatten()):(_.push(Q),_)})}function c(){var _=t.call(arguments,0);return this.select(function(Q){return!_.include(Q)})}function f(_){return(_===!1?this.toArray():this)._reverse()}function C(_){return this.inject([],function(Q,W,F){return(F==0||(_?Q.last()!=W:!Q.include(W)))&&Q.push(W),Q})}function m(_){return this.uniq().findAll(function(Q){return _.indexOf(Q)!==-1})}function E(){return t.call(this,0)}function S(){return this.length}function P(){return"["+this.map(Object.inspect).join(", ")+"]"}function N(_,Q){if(this==null)throw new TypeError;var W=Object(this),F=W.length>>>0;if(F===0||(Q=Number(Q),isNaN(Q)?Q=0:Q!==0&&isFinite(Q)&&(Q=(Q>0?1:-1)*Math.floor(Math.abs(Q))),Q>F))return-1;for(var p=Q>=0?Q:Math.max(F-Math.abs(Q),0);p<F;p++)if(p in W&&W[p]===_)return p;return-1}function R(_,Q){if(this==null)throw new TypeError;var W=Object(this),F=W.length>>>0;if(F===0)return-1;Object.isUndefined(Q)?Q=F:(Q=Number(Q),isNaN(Q)?Q=0:Q!==0&&isFinite(Q)&&(Q=(Q>0?1:-1)*Math.floor(Math.abs(Q))));for(var p=Q>=0?Math.min(Q,F-1):F-Math.abs(Q);p>=0;p--)if(p in W&&W[p]===_)return p;return-1}function g(_){var Q=[],W=t.call(arguments,0),F,p=0;W.unshift(this);for(var D=0,O=W.length;D<O;D++)if(F=W[D],Object.isArray(F)&&!("callee"in F))for(var G=0,V=F.length;G<V;G++)G in F&&(Q[p]=F[G]),p++;else Q[p++]=F;return Q.length=p,Q}function v(_){return function(){if(arguments.length===0)return _.call(this,Prototype.K);if(arguments[0]===void 0){var Q=t.call(arguments,1);return Q.unshift(Prototype.K),_.apply(this,Q)}else return _.apply(this,arguments)}}function M(_){if(this==null)throw new TypeError;_=_||Prototype.K;for(var Q=Object(this),W=[],F=arguments[1],p=0,D=0,O=Q.length>>>0;D<O;D++)D in Q&&(W[p]=_.call(F,Q[D],D,Q)),p++;return W.length=p,W}e.map&&(M=v(Array.prototype.map));function L(_){if(this==null||!Object.isFunction(_))throw new TypeError;for(var Q=Object(this),W=[],F=arguments[1],p,D=0,O=Q.length>>>0;D<O;D++)D in Q&&(p=Q[D],_.call(F,p,D,Q)&&W.push(p));return W}e.filter&&(L=Array.prototype.filter);function T(_){if(this==null)throw new TypeError;_=_||Prototype.K;for(var Q=arguments[1],W=Object(this),F=0,p=W.length>>>0;F<p;F++)if(F in W&&_.call(Q,W[F],F,W))return!0;return!1}if(e.some)var T=v(Array.prototype.some);function A(_){if(this==null)throw new TypeError;_=_||Prototype.K;for(var Q=arguments[1],W=Object(this),F=0,p=W.length>>>0;F<p;F++)if(F in W&&!_.call(Q,W[F],F,W))return!1;return!0}if(e.every)var A=v(Array.prototype.every);var j=e.reduce;function k(_,Q){Q=Q||Prototype.K;var W=arguments[2];return j.call(this,Q.bind(W),_)}if(!e.reduce)var k=Enumerable.inject;Object.extend(e,Enumerable),e._reverse||(e._reverse=e.reverse),Object.extend(e,{_each:r,map:M,collect:M,select:L,filter:L,findAll:L,some:T,any:T,every:A,all:A,inject:k,clear:n,first:o,last:u,compact:s,flatten:d,without:c,reverse:f,uniq:C,intersect:m,clone:E,toArray:E,size:S,inspect:P});var U=(function(){return[].concat(arguments)[0][0]!==1})(1,2);U&&(e.concat=g),e.indexOf||(e.indexOf=N),e.lastIndexOf||(e.lastIndexOf=R)})();function $H(e){return new Hash(e)}var Hash=Class.create(Enumerable,(function(){function e(P){this._object=Object.isHash(P)?P.toObject():Object.clone(P)}function t(P,N){for(var R in this._object){var g=this._object[R],v=[R,g];v.key=R,v.value=g,P.call(N,v)}}function r(P,N){return this._object[P]=N}function a(P){if(this._object[P]!==Object.prototype[P])return this._object[P]}function n(P){var N=this._object[P];return delete this._object[P],N}function o(){return Object.clone(this._object)}function u(){return this.pluck("key")}function s(){return this.pluck("value")}function d(P){var N=this.detect(function(R){return R.value===P});return N&&N.key}function c(P){return this.clone().update(P)}function f(P){return new Hash(P).inject(this,function(N,R){return N.set(R.key,R.value),N})}function C(P,R){if(Object.isUndefined(R))return P;var R=String.interpret(R);return R=R.gsub(/(\r)?\n/,`\r
`),R=encodeURIComponent(R),R=R.gsub(/%20/,"+"),P+"="+R}function m(){return this.inject([],function(P,N){var R=encodeURIComponent(N.key),g=N.value;if(g&&typeof g=="object"){if(Object.isArray(g)){for(var v=[],M=0,L=g.length,T;M<L;M++)T=g[M],v.push(C(R,T));return P.concat(v)}}else P.push(C(R,g));return P}).join("&")}function E(){return"#<Hash:{"+this.map(function(P){return P.map(Object.inspect).join(": ")}).join(", ")+"}>"}function S(){return new Hash(this)}return{initialize:e,_each:t,set:r,get:a,unset:n,toObject:o,toTemplateReplacements:o,keys:u,values:s,index:d,merge:c,update:f,toQueryString:m,inspect:E,toJSON:o,clone:S}})());Hash.from=$H,Object.extend(Number.prototype,(function(){function e(){return this.toPaddedString(2,16)}function t(){return this+1}function r(d,c){return $R(0,this,!0).each(d,c),this}function a(d,c){var f=this.toString(c||10);return"0".times(d-f.length)+f}function n(){return Math.abs(this)}function o(){return Math.round(this)}function u(){return Math.ceil(this)}function s(){return Math.floor(this)}return{toColorPart:e,succ:t,times:r,toPaddedString:a,abs:n,round:o,ceil:u,floor:s}})());function $R(e,t,r){return new ObjectRange(e,t,r)}var ObjectRange=Class.create(Enumerable,(function(){function e(a,n,o){this.start=a,this.end=n,this.exclusive=o}function t(a,n){for(var o=this.start;this.include(o);)a.call(n,o),o=o.succ()}function r(a){return a<this.start?!1:this.exclusive?a<this.end:a<=this.end}return{initialize:e,_each:t,include:r}})()),Abstract={},Try={these:function(){for(var e,t=0,r=arguments.length;t<r;t++){var a=arguments[t];try{e=a();break}catch{}}return e}},Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||!1},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(e,t){this.responders._each(e,t)},register:function(e){this.include(e)||this.responders.push(e)},unregister:function(e){this.responders=this.responders.without(e)},dispatch:function(e,t,r,a){this.each(function(n){if(Object.isFunction(n[e]))try{n[e].apply(n,[t,r,a])}catch{}})}},Object.extend(Ajax.Responders,Enumerable),Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}}),Ajax.Base=Class.create({initialize:function(e){this.options={method:"post",asynchronous:!0,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:!0,evalJS:!0},Object.extend(this.options,e||{}),this.options.method=this.options.method.toLowerCase(),Object.isHash(this.options.parameters)&&(this.options.parameters=this.options.parameters.toObject())}}),Ajax.Request=Class.create(Ajax.Base,{_complete:!1,initialize:function(e,t,r){e(r),this.transport=Ajax.getTransport(),this.request(t)},request:function(e){this.url=e,this.method=this.options.method;var t=Object.isString(this.options.parameters)?this.options.parameters:Object.toQueryString(this.options.parameters);["get","post"].include(this.method)||(t+=(t?"&":"")+"_method="+this.method,this.method="post"),t&&this.method==="get"&&(this.url+=(this.url.include("?")?"&":"?")+t),this.parameters=t.toQueryParams();try{var r=new Ajax.Response(this);this.options.onCreate&&this.options.onCreate(r),Ajax.Responders.dispatch("onCreate",this,r),this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous),this.options.asynchronous&&this.respondToReadyState.bind(this).defer(1),this.transport.onreadystatechange=this.onStateChange.bind(this),this.setRequestHeaders(),this.body=this.method=="post"?this.options.postBody||t:null,this.transport.send(this.body),!this.options.asynchronous&&this.transport.overrideMimeType&&this.onStateChange()}catch(a){this.dispatchException(a)}},onStateChange:function(){var e=this.transport.readyState;e>1&&!(e==4&&this._complete)&&this.respondToReadyState(this.transport.readyState)},setRequestHeaders:function(){var e={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if(this.method=="post"&&(e["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:""),this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005&&(e.Connection="close")),typeof this.options.requestHeaders=="object"){var t=this.options.requestHeaders;if(Object.isFunction(t.push))for(var r=0,a=t.length;r<a;r+=2)e[t[r]]=t[r+1];else $H(t).each(function(o){e[o.key]=o.value})}for(var n in e)this.transport.setRequestHeader(n,e[n])},success:function(){var e=this.getStatus();return!e||e>=200&&e<300||e==304},getStatus:function(){try{return this.transport.status===1223?204:this.transport.status||0}catch{return 0}},respondToReadyState:function(e){var t=Ajax.Request.Events[e],r=new Ajax.Response(this);if(t=="Complete"){try{this._complete=!0,(this.options["on"+r.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(r,r.headerJSON)}catch(n){this.dispatchException(n)}var a=r.getHeader("Content-type");(this.options.evalJS=="force"||this.options.evalJS&&this.isSameOrigin()&&a&&a.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))&&this.evalResponse()}try{(this.options["on"+t]||Prototype.emptyFunction)(r,r.headerJSON),Ajax.Responders.dispatch("on"+t,this,r,r.headerJSON)}catch(n){this.dispatchException(n)}t=="Complete"&&(this.transport.onreadystatechange=Prototype.emptyFunction)},isSameOrigin:function(){var e=this.url.match(/^\s*https?:\/\/[^\/]*/);return!e||e[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""})},getHeader:function(e){try{return this.transport.getResponseHeader(e)||null}catch{return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(e){this.dispatchException(e)}},dispatchException:function(e){(this.options.onException||Prototype.emptyFunction)(this,e),Ajax.Responders.dispatch("onException",this,e)}}),Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"],Ajax.Response=Class.create({initialize:function(e){this.request=e;var t=this.transport=e.transport,r=this.readyState=t.readyState;if((r>2&&!Prototype.Browser.IE||r==4)&&(this.status=this.getStatus(),this.statusText=this.getStatusText(),this.responseText=String.interpret(t.responseText),this.headerJSON=this._getHeaderJSON()),r==4){var a=t.responseXML;this.responseXML=Object.isUndefined(a)?null:a,this.responseJSON=this._getResponseJSON()}},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch{return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch{return null}},getResponseHeader:function(e){return this.transport.getResponseHeader(e)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var e=this.getHeader("X-JSON");if(!e)return null;try{e=decodeURIComponent(escape(e))}catch{}try{return e.evalJSON(this.request.options.sanitizeJSON||!this.request.isSameOrigin())}catch(t){this.request.dispatchException(t)}},_getResponseJSON:function(){var e=this.request.options;if(!e.evalJSON||e.evalJSON!="force"&&!(this.getHeader("Content-type")||"").include("application/json")||this.responseText.blank())return null;try{return this.responseText.evalJSON(e.sanitizeJSON||!this.request.isSameOrigin())}catch(t){this.request.dispatchException(t)}}}),Ajax.Updater=Class.create(Ajax.Request,{initialize:function(e,t,r,a){this.container={success:t.success||t,failure:t.failure||(t.success?null:t)},a=Object.clone(a);var n=a.onComplete;a.onComplete=(function(o,u){this.updateContent(o.responseText),Object.isFunction(n)&&n(o,u)}).bind(this),e(r,a)},updateContent:function(e){var t=this.container[this.success()?"success":"failure"],r=this.options;if(r.evalScripts||(e=e.stripScripts()),t=$(t))if(r.insertion)if(Object.isString(r.insertion)){var a={};a[r.insertion]=e,t.insert(a)}else r.insertion(t,e);else t.update(e)}}),Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function(e,t,r,a){e(a),this.onComplete=this.options.onComplete,this.frequency=this.options.frequency||2,this.decay=this.options.decay||1,this.updater={},this.container=t,this.url=r,this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this),this.onTimerEvent()},stop:function(){this.updater.options.onComplete=void 0,clearTimeout(this.timer),(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},updateComplete:function(e){this.options.decay&&(this.decay=e.responseText==this.lastText?this.decay*this.options.decay:1,this.lastText=e.responseText),this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}}),(function(e){var t,r=Array.prototype.slice,a=document.createElement("div");function n(h){if(arguments.length>1){for(var b=0,I=[],Y=arguments.length;b<Y;b++)I.push(n(arguments[b]));return I}return Object.isString(h)&&(h=document.getElementById(h)),c.extend(h)}e.$=n,e.Node||(e.Node={}),e.Node.ELEMENT_NODE||Object.extend(e.Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12});var o={};function u(h,b){return!(h==="select"||"type"in b)}var s=(function(){try{var h=document.createElement('<input name="x">');return h.tagName.toLowerCase()==="input"&&h.name==="x"}catch{return!1}})(),d=e.Element;function c(h,b){if(b=b||{},h=h.toLowerCase(),s&&b.name)return h="<"+h+' name="'+b.name+'">',delete b.name,c.writeAttribute(document.createElement(h),b);o[h]||(o[h]=c.extend(document.createElement(h)));var I=u(h,b)?o[h].cloneNode(!1):document.createElement(h);return c.writeAttribute(I,b)}e.Element=c,Object.extend(e.Element,d||{}),d&&(e.Element.prototype=d.prototype),c.Methods={ByTag:{},Simulated:{}};var f={},C={id:"id",className:"class"};function m(h){h=n(h);var b="<"+h.tagName.toLowerCase(),I,Y;for(var ae in C)I=C[ae],Y=(h[ae]||"").toString(),Y&&(b+=" "+I+"="+Y.inspect(!0));return b+">"}f.inspect=m;function E(h){return n(h).style.display!=="none"}function S(h,b){return h=n(h),Object.isUndefined(b)&&(b=!c.visible(h)),c[b?"show":"hide"](h),h}function P(h){return h=n(h),h.style.display="none",h}function N(h){return h=n(h),h.style.display="",h}Object.extend(f,{visible:E,toggle:S,hide:P,show:N});function R(h){return h=n(h),h.parentNode.removeChild(h),h}var g=(function(){var h=document.createElement("select"),b=!0;return h.innerHTML='<option value="test">test</option>',h.options&&h.options[0]&&(b=h.options[0].nodeName.toUpperCase()!=="OPTION"),h=null,b})(),v=(function(){try{var h=document.createElement("table");if(h&&h.tBodies){h.innerHTML="<tbody><tr><td>test</td></tr></tbody>";var b=typeof h.tBodies[0]>"u";return h=null,b}}catch{return!0}})(),M=(function(){try{var h=document.createElement("div");h.innerHTML="<link />";var b=h.childNodes.length===0;return h=null,b}catch{return!0}})(),L=g||v||M,T=(function(){var h=document.createElement("script"),b=!1;try{h.appendChild(document.createTextNode("")),b=!h.firstChild||h.firstChild&&h.firstChild.nodeType!==3}catch{b=!0}return h=null,b})();function A(h,b){h=n(h);for(var I=h.getElementsByTagName("*"),Y=I.length;Y--;)te(I[Y]);if(b&&b.toElement&&(b=b.toElement()),Object.isElement(b))return h.update().insert(b);b=Object.toHTML(b);var ae=h.tagName.toUpperCase();if(ae==="SCRIPT"&&T)return h.text=b,h;if(L)if(ae in k.tags){for(;h.firstChild;)h.removeChild(h.firstChild);for(var se=G(ae,b.stripScripts()),Y=0,xe;xe=se[Y];Y++)h.appendChild(xe)}else if(M&&Object.isString(b)&&b.indexOf("<link")>-1){for(;h.firstChild;)h.removeChild(h.firstChild);for(var se=G(ae,b.stripScripts(),!0),Y=0,xe;xe=se[Y];Y++)h.appendChild(xe)}else h.innerHTML=b.stripScripts();else h.innerHTML=b.stripScripts();return b.evalScripts.bind(b).defer(),h}function j(h,b){if(h=n(h),b&&b.toElement)b=b.toElement();else if(!Object.isElement(b)){b=Object.toHTML(b);var I=h.ownerDocument.createRange();I.selectNode(h),b.evalScripts.bind(b).defer(),b=I.createContextualFragment(b.stripScripts())}return h.parentNode.replaceChild(b,h),h}var k={before:function(h,b){h.parentNode.insertBefore(b,h)},top:function(h,b){h.insertBefore(b,h.firstChild)},bottom:function(h,b){h.appendChild(b)},after:function(h,b){h.parentNode.insertBefore(b,h.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}},U=k.tags;Object.extend(U,{THEAD:U.TBODY,TFOOT:U.TBODY,TH:U.TD});function _(h,b){if(h=n(h),b&&b.toElement&&(b=b.toElement()),Object.isElement(b))return h.parentNode.replaceChild(b,h),h;b=Object.toHTML(b);var I=h.parentNode,Y=I.tagName.toUpperCase();if(Y in k.tags){var ae=c.next(h),se=G(Y,b.stripScripts());I.removeChild(h);var xe;ae?xe=function(Ne){I.insertBefore(Ne,ae)}:xe=function(Ne){I.appendChild(Ne)},se.each(xe)}else h.outerHTML=b.stripScripts();return b.evalScripts.bind(b).defer(),h}"outerHTML"in document.documentElement&&(j=_);function Q(h){return Object.isUndefined(h)||h===null?!1:!!(Object.isString(h)||Object.isNumber(h)||Object.isElement(h)||h.toElement||h.toHTML)}function W(h,b,I){I=I.toLowerCase();var Y=k[I];if(b&&b.toElement&&(b=b.toElement()),Object.isElement(b))return Y(h,b),h;b=Object.toHTML(b);var ae=(I==="before"||I==="after"?h.parentNode:h).tagName.toUpperCase(),se=G(ae,b.stripScripts());(I==="top"||I==="after")&&se.reverse();for(var xe=0,Ne;Ne=se[xe];xe++)Y(h,Ne);b.evalScripts.bind(b).defer()}function F(h,b){h=n(h),Q(b)&&(b={bottom:b});for(var I in b)W(h,b[I],I);return h}function p(h,b,I){return h=n(h),Object.isElement(b)?n(b).writeAttribute(I||{}):Object.isString(b)?b=new c(b,I):b=new c("div",b),h.parentNode&&h.parentNode.replaceChild(b,h),b.appendChild(h),b}function D(h){h=n(h);for(var b=h.firstChild;b;){var I=b.nextSibling;b.nodeType===Node.TEXT_NODE&&!/\S/.test(b.nodeValue)&&h.removeChild(b),b=I}return h}function O(h){return n(h).innerHTML.blank()}function G(h,b,I){var Y=k.tags[h],ae=a,se=!!Y;if(!se&&I&&(se=!0,Y=["","",0]),se){ae.innerHTML="&#160;"+Y[0]+b+Y[1],ae.removeChild(ae.firstChild);for(var xe=Y[2];xe--;)ae=ae.firstChild}else ae.innerHTML=b;return $A(ae.childNodes)}function V(h,b){if(h=n(h)){var I=h.cloneNode(b);if(!Qe&&(I._prototypeUID=t,b))for(var Y=c.select(I,"*"),ae=Y.length;ae--;)Y[ae]._prototypeUID=t;return c.extend(I)}}function te(h){var b=De(h);b&&(c.stopObserving(h),Qe||(h._prototypeUID=t),delete c.Storage[b])}function J(h){for(var b=h.length;b--;)te(h[b])}function re(h){for(var b=h.length,I,Y;b--;)I=h[b],Y=De(I),delete c.Storage[Y],delete Event.cache[Y]}Qe&&(J=re);function ne(h){if(h=n(h)){te(h);for(var b=h.getElementsByTagName("*"),I=b.length;I--;)te(b[I]);return null}}Object.extend(f,{remove:R,update:A,replace:j,insert:F,wrap:p,cleanWhitespace:D,empty:O,clone:V,purge:ne});function K(h,b,I){h=n(h),I=I||-1;for(var Y=[];(h=h[b])&&(h.nodeType===Node.ELEMENT_NODE&&Y.push(c.extend(h)),Y.length!==I););return Y}function ue(h){return K(h,"parentNode")}function pe(h){return c.select(h,"*")}function he(h){for(h=n(h).firstChild;h&&h.nodeType!==Node.ELEMENT_NODE;)h=h.nextSibling;return n(h)}function be(h){for(var b=[],I=n(h).firstChild;I;)I.nodeType===Node.ELEMENT_NODE&&b.push(c.extend(I)),I=I.nextSibling;return b}function Ce(h){return K(h,"previousSibling")}function ve(h){return K(h,"nextSibling")}function Ee(h){h=n(h);var b=Ce(h),I=ve(h);return b.reverse().concat(I)}function Ae(h,b){return h=n(h),Object.isString(b)?Prototype.Selector.match(h,b):b.match(h)}function H(h,b,I,Y){for(h=n(h),I=I||0,Y=Y||0,Object.isNumber(I)&&(Y=I,I=null);h=h[b];)if(h.nodeType===1&&!(I&&!Prototype.Selector.match(h,I))&&!(--Y>=0))return c.extend(h)}function z(h,b,I){return h=n(h),arguments.length===1?n(h.parentNode):H(h,"parentNode",b,I)}function q(h,b,I){h=n(h),b=b||0,I=I||0,Object.isNumber(b)&&(I=b,b="*");var Y=Prototype.Selector.select(b,h)[I];return c.extend(Y)}function Z(h,b,I){return H(h,"previousSibling",b,I)}function B(h,b,I){return H(h,"nextSibling",b,I)}function X(h){h=n(h);var b=r.call(arguments,1).join(", ");return Prototype.Selector.select(b,h)}function ie(h){h=n(h);for(var b=r.call(arguments,1).join(", "),I=c.siblings(h),Y=[],ae=0,se;se=I[ae];ae++)Prototype.Selector.match(se,b)&&Y.push(se);return Y}function ee(h,b){for(h=n(h),b=n(b);h=h.parentNode;)if(h===b)return!0;return!1}function le(h,b){return h=n(h),b=n(b),b.contains?b.contains(h)&&b!==h:ee(h,b)}function me(h,b){return h=n(h),b=n(b),(h.compareDocumentPosition(b)&8)===8}var fe;a.compareDocumentPosition?fe=me:a.contains?fe=le:fe=ee,Object.extend(f,{recursivelyCollect:K,ancestors:ue,descendants:pe,firstDescendant:he,immediateDescendants:be,previousSiblings:Ce,nextSiblings:ve,siblings:Ee,match:Ae,up:z,down:q,previous:Z,next:B,select:X,adjacent:ie,descendantOf:fe,getElementsBySelector:X,childElements:be});var ke=1;function Se(h){h=n(h);var b=c.readAttribute(h,"id");if(b)return b;do b="anonymous_element_"+ke++;while(n(b));return c.writeAttribute(h,"id",b),b}function we(h,b){return n(h).getAttribute(b)}function ce(h,b){h=n(h);var I=je.read;return I.values[b]?I.values[b](h,b):(I.names[b]&&(b=I.names[b]),b.include(":")?!h.attributes||!h.attributes[b]?null:h.attributes[b].value:h.getAttribute(b))}function oe(h,b){return b==="title"?h.title:h.getAttribute(b)}var ge=(function(){a.setAttribute("onclick",Prototype.emptyFunction);var h=a.getAttribute("onclick"),b=typeof h=="function";return a.removeAttribute("onclick"),b})();ge?we=ce:Prototype.Browser.Opera&&(we=oe);function Te(h,b,I){h=n(h);var Y={},ae=je.write;typeof b=="object"?Y=b:Y[b]=Object.isUndefined(I)?!0:I;for(var se in Y)b=ae.names[se]||se,I=Y[se],ae.values[se]&&(b=ae.values[se](h,I)),I===!1||I===null?h.removeAttribute(b):I===!0?h.setAttribute(b,b):h.setAttribute(b,I);return h}function de(h,b){b=je.has[b]||b;var I=n(h).getAttributeNode(b);return!!(I&&I.specified)}e.Element.Methods.Simulated.hasAttribute=de;function Pe(h){return new c.ClassNames(h)}var Le={};function Ye(h){if(Le[h])return Le[h];var b=new RegExp("(^|\\s+)"+h+"(\\s+|$)");return Le[h]=b,b}function ze(h,b){if(h=n(h)){var I=h.className;return I.length===0?!1:I===b?!0:Ye(b).test(I)}}function ot(h,b){if(h=n(h))return ze(h,b)||(h.className+=(h.className?" ":"")+b),h}function st(h,b){if(h=n(h))return h.className=h.className.replace(Ye(b)," ").strip(),h}function lt(h,b,I){if(h=n(h)){Object.isUndefined(I)&&(I=!ze(h,b));var Y=c[I?"addClassName":"removeClassName"];return Y(h,b)}}var je={},Ie="className",Re="for";a.setAttribute(Ie,"x"),a.className!=="x"&&(a.setAttribute("class","x"),a.className==="x"&&(Ie="class"));var Ue=document.createElement("label");Ue.setAttribute(Re,"x"),Ue.htmlFor!=="x"&&(Ue.setAttribute("htmlFor","x"),Ue.htmlFor==="x"&&(Re="htmlFor")),Ue=null;function ut(h,b){return h.getAttribute(b)}function Xe(h,b){return h.getAttribute(b,2)}function ct(h,b){var I=h.getAttributeNode(b);return I?I.value:""}function He(h,b){return n(h).hasAttribute(b)?b:null}a.onclick=Prototype.emptyFunction;var Ke=a.getAttribute("onclick"),ye;String(Ke).indexOf("{")>-1?ye=function(h,b){var I=h.getAttribute(b);return I?(I=I.toString(),I=I.split("{")[1],I=I.split("}")[0],I.strip()):null}:Ke===""&&(ye=function(h,b){var I=h.getAttribute(b);return I?I.strip():null}),je.read={names:{class:Ie,className:Ie,for:Re,htmlFor:Re},values:{style:function(h){return h.style.cssText.toLowerCase()},title:function(h){return h.title}}},je.write={names:{className:"class",htmlFor:"for",cellpadding:"cellPadding",cellspacing:"cellSpacing"},values:{checked:function(h,b){h.checked=!!b},style:function(h,b){h.style.cssText=b||""}}},je.has={names:{}},Object.extend(je.write.names,je.read.names);for(var dt=$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc frameBorder"),Ze=0,Oe;Oe=dt[Ze];Ze++)je.write.names[Oe.toLowerCase()]=Oe,je.has.names[Oe.toLowerCase()]=Oe;Object.extend(je.read.values,{href:Xe,src:Xe,type:ut,action:ct,disabled:He,checked:He,readonly:He,multiple:He,onload:ye,onunload:ye,onclick:ye,ondblclick:ye,onmousedown:ye,onmouseup:ye,onmouseover:ye,onmousemove:ye,onmouseout:ye,onfocus:ye,onblur:ye,onkeypress:ye,onkeydown:ye,onkeyup:ye,onsubmit:ye,onreset:ye,onselect:ye,onchange:ye}),Object.extend(f,{identify:Se,readAttribute:we,writeAttribute:Te,classNames:Pe,hasClassName:ze,addClassName:ot,removeClassName:st,toggleClassName:lt});function ft(h){return h==="float"||h==="styleFloat"?"cssFloat":h.camelize()}function ht(h){return h==="float"||h==="cssFloat"?"styleFloat":h.camelize()}function gt(h,b){h=n(h);var I=h.style,Y;if(Object.isString(b)){if(I.cssText+=";"+b,b.include("opacity")){var ae=b.match(/opacity:\s*(\d?\.?\d*)/)[1];c.setOpacity(h,ae)}return h}for(var se in b)if(se==="opacity")c.setOpacity(h,b[se]);else{var xe=b[se];(se==="float"||se==="cssFloat")&&(se=Object.isUndefined(I.styleFloat)?"cssFloat":"styleFloat"),I[se]=xe}return h}function Ge(h,b){h=n(h),b=ft(b);var I=h.style[b];if(!I||I==="auto"){var Y=document.defaultView.getComputedStyle(h,null);I=Y?Y[b]:null}return b==="opacity"?I?parseFloat(I):1:I==="auto"?null:I}function Pt(h,b){switch(b){case"height":case"width":if(!c.visible(h))return null;var I=parseInt(Ge(h,b),10);return I!==h["offset"+b.capitalize()]?I+"px":c.measure(h,b);default:return Ge(h,b)}}function pt(h,b){h=n(h),b=ht(b);var I=h.style[b];return!I&&h.currentStyle&&(I=h.currentStyle[b]),b==="opacity"&&!Be?rt(h):I==="auto"?(b==="width"||b==="height")&&c.visible(h)?c.measure(h,b)+"px":null:I}function et(h){return(h||"").replace(/alpha\([^\)]*\)/gi,"")}function mt(h){return h.currentStyle.hasLayout||(h.style.zoom=1),h}var Be=(function(){return a.style.cssText="opacity:.55",/^0.55/.test(a.style.opacity)})();function tt(h,b){return h=n(h),b==1||b===""?b="":b<1e-5&&(b=0),h.style.opacity=b,h}function vt(h,b){if(Be)return tt(h,b);h=mt(n(h));var I=c.getStyle(h,"filter"),Y=h.style;return b==1||b===""?(I=et(I),I?Y.filter=I:Y.removeAttribute("filter"),h):(b<1e-5&&(b=0),Y.filter=et(I)+"alpha(opacity="+b*100+")",h)}function it(h){return c.getStyle(h,"opacity")}function rt(h){if(Be)return it(h);var b=c.getStyle(h,"filter");if(b.length===0)return 1;var I=(b||"").match(/alpha\(opacity=(.*)\)/);return I[1]?parseFloat(I[1])/100:1}Object.extend(f,{setStyle:gt,getStyle:Ge,setOpacity:tt,getOpacity:it}),"styleFloat"in a.style&&(f.getStyle=pt,f.setOpacity=vt,f.getOpacity=rt);var jt=0;e.Element.Storage={UID:1};function De(h){return h===window?0:(typeof h._prototypeUID>"u"&&(h._prototypeUID=c.Storage.UID++),h._prototypeUID)}function yt(h){return h===window?0:h==document?1:h.uniqueID}var Qe="uniqueID"in a;Qe&&(De=yt);function We(h){if(h=n(h)){var b=De(h);return c.Storage[b]||(c.Storage[b]=$H()),c.Storage[b]}}function bt(h,b,I){if(h=n(h)){var Y=We(h);return arguments.length===2?Y.update(b):Y.set(b,I),h}}function Ct(h,b,I){if(h=n(h)){var Y=We(h),ae=Y.get(b);return Object.isUndefined(ae)&&(Y.set(b,I),ae=I),ae}}Object.extend(f,{getStorage:We,store:bt,retrieve:Ct});var Ve={},Me=c.Methods.ByTag,_e=Prototype.BrowserFeatures;!_e.ElementExtensions&&"__proto__"in a&&(e.HTMLElement={},e.HTMLElement.prototype=a.__proto__,_e.ElementExtensions=!0);function wt(h){if(typeof window.Element>"u")return!1;var b=window.Element.prototype;if(b){var I="_"+(Math.random()+"").slice(2),Y=document.createElement(h);b[I]="x";var ae=Y[I]!=="x";return delete b[I],Y=null,ae}return!1}var xt=wt("object");function Fe(h,b){for(var I in b){var Y=b[I];Object.isFunction(Y)&&!(I in h)&&(h[I]=Y.methodize())}}var qe={};function at(h){var b=De(h);return b in qe}function $e(h){if(!h||at(h)||h.nodeType!==Node.ELEMENT_NODE||h==window)return h;var b=Object.clone(Ve),I=h.tagName.toUpperCase();return Me[I]&&Object.extend(b,Me[I]),Fe(h,b),qe[De(h)]=!0,h}function St(h){if(!h||at(h))return h;var b=h.tagName;return b&&/^(?:object|applet|embed)$/i.test(b)&&(Fe(h,c.Methods),Fe(h,c.Methods.Simulated),Fe(h,c.Methods.ByTag[b.toUpperCase()])),h}_e.SpecificElementExtensions&&($e=xt?St:Prototype.K);function nt(h,b){h=h.toUpperCase(),Me[h]||(Me[h]={}),Object.extend(Me[h],b)}function Je(h,b,I){Object.isUndefined(I)&&(I=!1);for(var Y in b){var ae=b[Y];Object.isFunction(ae)&&(!I||!(Y in h))&&(h[Y]=ae.methodize())}}function Et(h){var b,I={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};if(I[h]&&(b="HTML"+I[h]+"Element"),window[b]||(b="HTML"+h+"Element",window[b])||(b="HTML"+h.capitalize()+"Element",window[b]))return window[b];var Y=document.createElement(h),ae=Y.__proto__||Y.constructor.prototype;return Y=null,ae}function At(h){if(arguments.length===0&&Tt(),arguments.length===2){var b=h;h=arguments[1]}if(!b)Object.extend(c.Methods,h||{});else if(Object.isArray(b))for(var I=0,Y;Y=b[I];I++)nt(Y,h);else nt(b,h);var ae=window.HTMLElement?HTMLElement.prototype:c.prototype;if(_e.ElementExtensions&&(Je(ae,c.Methods),Je(ae,c.Methods.Simulated,!0)),_e.SpecificElementExtensions)for(var Y in c.Methods.ByTag){var se=Et(Y);Object.isUndefined(se)||Je(se.prototype,Me[Y])}Object.extend(c,c.Methods),Object.extend(c,c.Methods.Simulated),delete c.ByTag,delete c.Simulated,c.extend.refresh(),o={}}Object.extend(e.Element,{extend:$e,addMethods:At}),$e===Prototype.K?e.Element.extend.refresh=Prototype.emptyFunction:e.Element.extend.refresh=function(){Prototype.BrowserFeatures.ElementExtensions||(Object.extend(Ve,c.Methods),Object.extend(Ve,c.Methods.Simulated),qe={})};function Tt(){Object.extend(Form,Form.Methods),Object.extend(Form.Element,Form.Element.Methods),Object.extend(c.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods),BUTTON:Object.clone(Form.Element.Methods)})}c.addMethods(f)})(this),(function(){function e(p){var D=p.match(/^(\d+)%?$/i);return D?Number(D[1])/100:null}function t(p,D){p=$(p);var O=p.style[D];if(!O||O==="auto"){var G=document.defaultView.getComputedStyle(p,null);O=G?G[D]:null}return D==="opacity"?O?parseFloat(O):1:O==="auto"?null:O}function r(p,D){var O=p.style[D];return!O&&p.currentStyle&&(O=p.currentStyle[D]),O}function a(p,D){var O=p.offsetWidth,G=n(p,"borderLeftWidth",D)||0,V=n(p,"borderRightWidth",D)||0,te=n(p,"paddingLeft",D)||0,J=n(p,"paddingRight",D)||0;return O-G-V-te-J}"currentStyle"in document.documentElement&&(t=r);function n(p,D,O){var G=null;if(Object.isElement(p)&&(G=p,p=t(G,D)),p===null||Object.isUndefined(p))return null;if(/^(?:-)?\d+(\.\d+)?(px)?$/i.test(p))return window.parseFloat(p);var V=p.include("%"),te=O===document.viewport;if(/\d/.test(p)&&G&&G.runtimeStyle&&!(V&&te)){var J=G.style.left,re=G.runtimeStyle.left;return G.runtimeStyle.left=G.currentStyle.left,G.style.left=p||0,p=G.style.pixelLeft,G.style.left=J,G.runtimeStyle.left=re,p}if(G&&V){O=O||G.parentNode;var ne=e(p),K=null,ue=D.include("left")||D.include("right")||D.include("width"),pe=D.include("top")||D.include("bottom")||D.include("height");return O===document.viewport?ue?K=document.viewport.getWidth():pe&&(K=document.viewport.getHeight()):ue?K=$(O).measure("width"):pe&&(K=$(O).measure("height")),K===null?0:K*ne}return 0}function o(p){return Object.isString(p)&&p.endsWith("px")?p:p+"px"}function u(p){for(;p&&p.parentNode;){var D=p.getStyle("display");if(D==="none")return!1;p=$(p.parentNode)}return!0}var s=Prototype.K;"currentStyle"in document.documentElement&&(s=function(p){return p.currentStyle.hasLayout||(p.style.zoom=1),p});function d(p){return p.include("border")&&(p=p+"-width"),p.camelize()}Element.Layout=Class.create(Hash,{initialize:function(p,D,O){p(),this.element=$(D),Element.Layout.PROPERTIES.each(function(G){this._set(G,null)},this),O&&(this._preComputing=!0,this._begin(),Element.Layout.PROPERTIES.each(this._compute,this),this._end(),this._preComputing=!1)},_set:function(p,D){return Hash.prototype.set.call(this,p,D)},set:function(p,D){throw"Properties of Element.Layout are read-only."},get:function(p,D){var O=p(D);return O===null?this._compute(D):O},_begin:function(){if(!this._isPrepared()){var p=this.element;if(u(p)){this._setPrepared(!0);return}var D={position:p.style.position||"",width:p.style.width||"",visibility:p.style.visibility||"",display:p.style.display||""};p.store("prototype_original_styles",D);var O=t(p,"position"),G=p.offsetWidth;(G===0||G===null)&&(p.style.display="block",G=p.offsetWidth);var V=O==="fixed"?document.viewport:p.parentNode,te={visibility:"hidden",display:"block"};O!=="fixed"&&(te.position="absolute"),p.setStyle(te);var J=p.offsetWidth,re;if(G&&J===G)re=a(p,V);else if(O==="absolute"||O==="fixed")re=a(p,V);else{var ne=p.parentNode,K=$(ne).getLayout();re=K.get("width")-this.get("margin-left")-this.get("border-left")-this.get("padding-left")-this.get("padding-right")-this.get("border-right")-this.get("margin-right")}p.setStyle({width:re+"px"}),this._setPrepared(!0)}},_end:function(){var p=this.element,D=p.retrieve("prototype_original_styles");p.store("prototype_original_styles",null),p.setStyle(D),this._setPrepared(!1)},_compute:function(p){var D=Element.Layout.COMPUTATIONS;if(!(p in D))throw"Property not found.";return this._set(p,D[p].call(this,this.element))},_isPrepared:function(){return this.element.retrieve("prototype_element_layout_prepared",!1)},_setPrepared:function(p){return this.element.store("prototype_element_layout_prepared",p)},toObject:function(){var p=$A(arguments),D=p.length===0?Element.Layout.PROPERTIES:p.join(" ").split(" "),O={};return D.each(function(G){if(Element.Layout.PROPERTIES.include(G)){var V=this.get(G);V!=null&&(O[G]=V)}},this),O},toHash:function(){var p=this.toObject.apply(this,arguments);return new Hash(p)},toCSS:function(){var p=$A(arguments),D=p.length===0?Element.Layout.PROPERTIES:p.join(" ").split(" "),O={};return D.each(function(G){if(Element.Layout.PROPERTIES.include(G)&&!Element.Layout.COMPOSITE_PROPERTIES.include(G)){var V=this.get(G);V!=null&&(O[d(G)]=V+"px")}},this),O},inspect:function(){return"#<Element.Layout>"}}),Object.extend(Element.Layout,{PROPERTIES:$w("height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height"),COMPOSITE_PROPERTIES:$w("padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height"),COMPUTATIONS:{height:function(p){this._preComputing||this._begin();var D=this.get("border-box-height");if(D<=0)return this._preComputing||this._end(),0;var O=this.get("border-top"),G=this.get("border-bottom"),V=this.get("padding-top"),te=this.get("padding-bottom");return this._preComputing||this._end(),D-O-G-V-te},width:function(p){this._preComputing||this._begin();var D=this.get("border-box-width");if(D<=0)return this._preComputing||this._end(),0;var O=this.get("border-left"),G=this.get("border-right"),V=this.get("padding-left"),te=this.get("padding-right");return this._preComputing||this._end(),D-O-G-V-te},"padding-box-height":function(p){var D=this.get("height"),O=this.get("padding-top"),G=this.get("padding-bottom");return D+O+G},"padding-box-width":function(p){var D=this.get("width"),O=this.get("padding-left"),G=this.get("padding-right");return D+O+G},"border-box-height":function(p){this._preComputing||this._begin();var D=p.offsetHeight;return this._preComputing||this._end(),D},"border-box-width":function(p){this._preComputing||this._begin();var D=p.offsetWidth;return this._preComputing||this._end(),D},"margin-box-height":function(p){var D=this.get("border-box-height"),O=this.get("margin-top"),G=this.get("margin-bottom");return D<=0?0:D+O+G},"margin-box-width":function(p){var D=this.get("border-box-width"),O=this.get("margin-left"),G=this.get("margin-right");return D<=0?0:D+O+G},top:function(p){var D=p.positionedOffset();return D.top},bottom:function(p){var D=p.positionedOffset(),O=p.getOffsetParent(),G=O.measure("height"),V=this.get("border-box-height");return G-V-D.top},left:function(p){var D=p.positionedOffset();return D.left},right:function(p){var D=p.positionedOffset(),O=p.getOffsetParent(),G=O.measure("width"),V=this.get("border-box-width");return G-V-D.left},"padding-top":function(p){return n(p,"paddingTop")},"padding-bottom":function(p){return n(p,"paddingBottom")},"padding-left":function(p){return n(p,"paddingLeft")},"padding-right":function(p){return n(p,"paddingRight")},"border-top":function(p){return n(p,"borderTopWidth")},"border-bottom":function(p){return n(p,"borderBottomWidth")},"border-left":function(p){return n(p,"borderLeftWidth")},"border-right":function(p){return n(p,"borderRightWidth")},"margin-top":function(p){return n(p,"marginTop")},"margin-bottom":function(p){return n(p,"marginBottom")},"margin-left":function(p){return n(p,"marginLeft")},"margin-right":function(p){return n(p,"marginRight")}}}),"getBoundingClientRect"in document.documentElement&&Object.extend(Element.Layout.COMPUTATIONS,{right:function(p){var D=s(p.getOffsetParent()),O=p.getBoundingClientRect(),G=D.getBoundingClientRect();return(G.right-O.right).round()},bottom:function(p){var D=s(p.getOffsetParent()),O=p.getBoundingClientRect(),G=D.getBoundingClientRect();return(G.bottom-O.bottom).round()}}),Element.Offset=Class.create({initialize:function(p,D){this.left=p.round(),this.top=D.round(),this[0]=this.left,this[1]=this.top},relativeTo:function(p){return new Element.Offset(this.left-p.left,this.top-p.top)},inspect:function(){return"#<Element.Offset left: #{left} top: #{top}>".interpolate(this)},toString:function(){return"[#{left}, #{top}]".interpolate(this)},toArray:function(){return[this.left,this.top]}});function c(p,D){return new Element.Layout(p,D)}function f(p,D){return $(p).getLayout().get(D)}function C(p){return Element.getDimensions(p).height}function m(p){return Element.getDimensions(p).width}function E(p){p=$(p);var D=Element.getStyle(p,"display");if(D&&D!=="none")return{width:p.offsetWidth,height:p.offsetHeight};var O=p.style,G={visibility:O.visibility,position:O.position,display:O.display},V={visibility:"hidden",display:"block"};G.position!=="fixed"&&(V.position="absolute"),Element.setStyle(p,V);var te={width:p.offsetWidth,height:p.offsetHeight};return Element.setStyle(p,G),te}function S(p){if(p=$(p),W(p)||F(p)||_(p)||Q(p))return $(document.body);var D=Element.getStyle(p,"display")==="inline";if(!D&&p.offsetParent)return $(p.offsetParent);for(;(p=p.parentNode)&&p!==document.body;)if(Element.getStyle(p,"position")!=="static")return Q(p)?$(document.body):$(p);return $(document.body)}function P(p){p=$(p);var D=0,O=0;if(p.parentNode)do D+=p.offsetTop||0,O+=p.offsetLeft||0,p=p.offsetParent;while(p);return new Element.Offset(O,D)}function N(p){p=$(p);var D=p.getLayout(),O=0,G=0;do if(O+=p.offsetTop||0,G+=p.offsetLeft||0,p=p.offsetParent,p){if(_(p))break;var V=Element.getStyle(p,"position");if(V!=="static")break}while(p);return G-=D.get("margin-top"),O-=D.get("margin-left"),new Element.Offset(G,O)}function R(p){var D=0,O=0;do D+=p.scrollTop||0,O+=p.scrollLeft||0,p=p.parentNode;while(p);return new Element.Offset(O,D)}function g(p){var D=0,O=0,G=document.body,V=$(p);do if(D+=V.offsetTop||0,O+=V.offsetLeft||0,V.offsetParent==G&&Element.getStyle(V,"position")=="absolute")break;while(V=V.offsetParent);V=p;do V!=G&&(D-=V.scrollTop||0,O-=V.scrollLeft||0);while(V=V.parentNode);return new Element.Offset(O,D)}function v(p){if(p=$(p),Element.getStyle(p,"position")==="absolute")return p;var D=S(p),O=p.viewportOffset(),G=D.viewportOffset(),V=O.relativeTo(G),te=p.getLayout();return p.store("prototype_absolutize_original_styles",{left:p.getStyle("left"),top:p.getStyle("top"),width:p.getStyle("width"),height:p.getStyle("height")}),p.setStyle({position:"absolute",top:V.top+"px",left:V.left+"px",width:te.get("width")+"px",height:te.get("height")+"px"}),p}function M(p){if(p=$(p),Element.getStyle(p,"position")==="relative")return p;var D=p.retrieve("prototype_absolutize_original_styles");return D&&p.setStyle(D),p}function L(p){p=$(p);var D=Element.cumulativeOffset(p);return window.scrollTo(D.left,D.top),p}function T(p){p=$(p);var D=Element.getStyle(p,"position"),O={};return(D==="static"||!D)&&(O.position="relative",Prototype.Browser.Opera&&(O.top=0,O.left=0),Element.setStyle(p,O),Element.store(p,"prototype_made_positioned",!0)),p}function A(p){p=$(p);var D=Element.getStorage(p),O=D.get("prototype_made_positioned");return O&&(D.unset("prototype_made_positioned"),Element.setStyle(p,{position:"",top:"",bottom:"",left:"",right:""})),p}function j(p){p=$(p);var D=Element.getStorage(p),O=D.get("prototype_made_clipping");if(Object.isUndefined(O)){var G=Element.getStyle(p,"overflow");D.set("prototype_made_clipping",G),G!=="hidden"&&(p.style.overflow="hidden")}return p}function k(p){p=$(p);var D=Element.getStorage(p),O=D.get("prototype_made_clipping");return Object.isUndefined(O)||(D.unset("prototype_made_clipping"),p.style.overflow=O||""),p}function U(p,D,O){O=Object.extend({setLeft:!0,setTop:!0,setWidth:!0,setHeight:!0,offsetTop:0,offsetLeft:0},O||{}),D=$(D),p=$(p);var G,V,te,J={};if((O.setLeft||O.setTop)&&(G=Element.viewportOffset(D),V=[0,0],Element.getStyle(p,"position")==="absolute")){var re=Element.getOffsetParent(p);re!==document.body&&(V=Element.viewportOffset(re))}return(O.setWidth||O.setHeight)&&(te=Element.getLayout(D)),O.setLeft&&(J.left=G[0]-V[0]+O.offsetLeft+"px"),O.setTop&&(J.top=G[1]-V[1]+O.offsetTop+"px"),O.setWidth&&(J.width=te.get("border-box-width")+"px"),O.setHeight&&(J.height=te.get("border-box-height")+"px"),Element.setStyle(p,J)}Prototype.Browser.IE?(S=S.wrap(function(p,D){if(D=$(D),W(D)||F(D)||_(D)||Q(D))return $(document.body);var O=D.getStyle("position");if(O!=="static")return p(D);D.setStyle({position:"relative"});var G=p(D);return D.setStyle({position:O}),G}),N=N.wrap(function(p,D){if(D=$(D),!D.parentNode)return new Element.Offset(0,0);var O=D.getStyle("position");if(O!=="static")return p(D);var G=D.getOffsetParent();G&&G.getStyle("position")==="fixed"&&s(G),D.setStyle({position:"relative"});var V=p(D);return D.setStyle({position:O}),V})):Prototype.Browser.Webkit&&(P=function(p){p=$(p);var D=0,O=0;do{if(D+=p.offsetTop||0,O+=p.offsetLeft||0,p.offsetParent==document.body&&Element.getStyle(p,"position")=="absolute")break;p=p.offsetParent}while(p);return new Element.Offset(O,D)}),Element.addMethods({getLayout:c,measure:f,getWidth:m,getHeight:C,getDimensions:E,getOffsetParent:S,cumulativeOffset:P,positionedOffset:N,cumulativeScrollOffset:R,viewportOffset:g,absolutize:v,relativize:M,scrollTo:L,makePositioned:T,undoPositioned:A,makeClipping:j,undoClipping:k,clonePosition:U});function _(p){return p.nodeName.toUpperCase()==="BODY"}function Q(p){return p.nodeName.toUpperCase()==="HTML"}function W(p){return p.nodeType===Node.DOCUMENT_NODE}function F(p){return p!==document.body&&!Element.descendantOf(p,document.body)}"getBoundingClientRect"in document.documentElement&&Element.addMethods({viewportOffset:function(p){if(p=$(p),F(p))return new Element.Offset(0,0);var D=p.getBoundingClientRect(),O=document.documentElement;return new Element.Offset(D.left-O.clientLeft,D.top-O.clientTop)}})})(),(function(){var e=Prototype.Browser.Opera&&window.parseFloat(window.opera.version())<9.5,t=null;function r(){return t||(t=e?document.body:document.documentElement,t)}function a(){return{width:this.getWidth(),height:this.getHeight()}}function n(){return r().clientWidth}function o(){return r().clientHeight}function u(){var s=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,d=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;return new Element.Offset(s,d)}document.viewport={getDimensions:a,getWidth:n,getHeight:o,getScrollOffsets:u}})(),window.$$=function(){var e=$A(arguments).join(", ");return Prototype.Selector.select(e,document)},Prototype.Selector=(function(){function e(){throw new Error('Method "Prototype.Selector.select" must be defined.')}function t(){throw new Error('Method "Prototype.Selector.match" must be defined.')}function r(o,u,s){s=s||0;var d=Prototype.Selector.match,c=o.length,f=0,C;for(C=0;C<c;C++)if(d(o[C],u)&&s==f++)return Element.extend(o[C])}function a(o){for(var u=0,s=o.length;u<s;u++)Element.extend(o[u]);return o}var n=Prototype.K;return{select:e,match:t,find:r,extendElements:Element.extend===n?n:a,extendElement:Element.extend}})();/*!
 * Sizzle CSS Selector Engine
 *  Copyright 2011, The Dojo Foundation
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://sizzlejs.com/
 */(function(){var e=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,t=0,n=Object.prototype.toString,r=!1,o=!0,a=/\\/g,s=/\W/;[0,0].sort(function(){return o=!1,0});var c=function(p,b,_,L){_=_||[],b=b||document;var P=b;if(b.nodeType!==1&&b.nodeType!==9)return[];if(!p||typeof p!="string")return _;var S,k,O,R,I,F,V,D,m=!0,M=c.isXML(b),U=[],z=p;do if(e.exec(""),S=e.exec(z),S&&(z=S[3],U.push(S[1]),S[2])){R=S[3];break}while(S);if(U.length>1&&u.exec(p))if(U.length===2&&d.relative[U[0]])k=N(U[0]+U[1],b);else for(k=d.relative[U[0]]?[b]:c(U.shift(),b);U.length;)p=U.shift(),d.relative[p]&&(p+=U.shift()),k=N(p,k);else if(!L&&U.length>1&&b.nodeType===9&&!M&&d.match.ID.test(U[0])&&!d.match.ID.test(U[U.length-1])&&(I=c.find(U.shift(),b,M),b=I.expr?c.filter(I.expr,I.set)[0]:I.set[0]),b)for(I=L?{expr:U.pop(),set:h(L)}:c.find(U.pop(),U.length===1&&(U[0]==="~"||U[0]==="+")&&b.parentNode?b.parentNode:b,M),k=I.expr?c.filter(I.expr,I.set):I.set,U.length>0?O=h(k):m=!1;U.length;)F=U.pop(),V=F,d.relative[F]?V=U.pop():F="",V==null&&(V=b),d.relative[F](O,V,M);else O=U=[];if(O||(O=k),O||c.error(F||p),n.call(O)==="[object Array]")if(!m)_.push.apply(_,O);else if(b&&b.nodeType===1)for(D=0;O[D]!=null;D++)O[D]&&(O[D]===!0||O[D].nodeType===1&&c.contains(b,O[D]))&&_.push(k[D]);else for(D=0;O[D]!=null;D++)O[D]&&O[D].nodeType===1&&_.push(k[D]);else h(O,_);return R&&(c(R,P,_,L),c.uniqueSort(_)),_};c.uniqueSort=function(p){if(C&&(r=o,p.sort(C),r))for(var b=1;b<p.length;b++)p[b]===p[b-1]&&p.splice(b--,1);return p},c.matches=function(p,b){return c(p,null,null,b)},c.matchesSelector=function(p,b){return c(b,null,null,[p]).length>0},c.find=function(p,b,_){var L;if(!p)return[];for(var P=0,S=d.order.length;P<S;P++){var k,O=d.order[P];if(k=d.leftMatch[O].exec(p)){var R=k[1];if(k.splice(1,1),R.substr(R.length-1)!=="\\"&&(k[1]=(k[1]||"").replace(a,""),L=d.find[O](k,b,_),L!=null)){p=p.replace(d.match[O],"");break}}}return L||(L=typeof b.getElementsByTagName<"u"?b.getElementsByTagName("*"):[]),{set:L,expr:p}},c.filter=function(p,b,_,L){for(var P,S,k=p,O=[],R=b,I=b&&b[0]&&c.isXML(b[0]);p&&b.length;){for(var F in d.filter)if((P=d.leftMatch[F].exec(p))!=null&&P[2]){var V,D,m=d.filter[F],M=P[1];if(S=!1,P.splice(1,1),M.substr(M.length-1)==="\\")continue;if(R===O&&(O=[]),d.preFilter[F]){if(P=d.preFilter[F](P,R,_,O,L,I),!P)S=V=!0;else if(P===!0)continue}if(P){for(var U=0;(D=R[U])!=null;U++)if(D){V=m(D,P,U,R);var z=L^!!V;_&&V!=null?z?S=!0:R[U]=!1:z&&(O.push(D),S=!0)}}if(V!==void 0){if(_||(R=O),p=p.replace(d.match[F],""),!S)return[];break}}if(p===k)if(S==null)c.error(p);else break;k=p}return R},c.error=function(p){throw"Syntax error, unrecognized expression: "+p};var d=c.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{class:"className",for:"htmlFor"},attrHandle:{href:function(p){return p.getAttribute("href")},type:function(p){return p.getAttribute("type")}},relative:{"+":function(p,b){var _=typeof b=="string",L=_&&!s.test(b),P=_&&!L;L&&(b=b.toLowerCase());for(var S=0,k=p.length,O;S<k;S++)if(O=p[S]){for(;(O=O.previousSibling)&&O.nodeType!==1;);p[S]=P||O&&O.nodeName.toLowerCase()===b?O||!1:O===b}P&&c.filter(b,p,!0)},">":function(p,b){var _,L=typeof b=="string",P=0,S=p.length;if(L&&!s.test(b)){for(b=b.toLowerCase();P<S;P++)if(_=p[P],_){var k=_.parentNode;p[P]=k.nodeName.toLowerCase()===b?k:!1}}else{for(;P<S;P++)_=p[P],_&&(p[P]=L?_.parentNode:_.parentNode===b);L&&c.filter(b,p,!0)}},"":function(p,b,_){var L,P=t++,S=j;typeof b=="string"&&!s.test(b)&&(b=b.toLowerCase(),L=b,S=T),S("parentNode",b,P,p,L,_)},"~":function(p,b,_){var L,P=t++,S=j;typeof b=="string"&&!s.test(b)&&(b=b.toLowerCase(),L=b,S=T),S("previousSibling",b,P,p,L,_)}},find:{ID:function(p,b,_){if(typeof b.getElementById<"u"&&!_){var L=b.getElementById(p[1]);return L&&L.parentNode?[L]:[]}},NAME:function(p,b){if(typeof b.getElementsByName<"u"){for(var _=[],L=b.getElementsByName(p[1]),P=0,S=L.length;P<S;P++)L[P].getAttribute("name")===p[1]&&_.push(L[P]);return _.length===0?null:_}},TAG:function(p,b){if(typeof b.getElementsByTagName<"u")return b.getElementsByTagName(p[1])}},preFilter:{CLASS:function(p,b,_,L,P,S){if(p=" "+p[1].replace(a,"")+" ",S)return p;for(var k=0,O;(O=b[k])!=null;k++)O&&(P^(O.className&&(" "+O.className+" ").replace(/[\t\n\r]/g," ").indexOf(p)>=0)?_||L.push(O):_&&(b[k]=!1));return!1},ID:function(p){return p[1].replace(a,"")},TAG:function(p,b){return p[1].replace(a,"").toLowerCase()},CHILD:function(p){if(p[1]==="nth"){p[2]||c.error(p[0]),p[2]=p[2].replace(/^\+|\s*/g,"");var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(p[2]==="even"&&"2n"||p[2]==="odd"&&"2n+1"||!/\D/.test(p[2])&&"0n+"+p[2]||p[2]);p[2]=b[1]+(b[2]||1)-0,p[3]=b[3]-0}else p[2]&&c.error(p[0]);return p[0]=t++,p},ATTR:function(p,b,_,L,P,S){var k=p[1]=p[1].replace(a,"");return!S&&d.attrMap[k]&&(p[1]=d.attrMap[k]),p[4]=(p[4]||p[5]||"").replace(a,""),p[2]==="~="&&(p[4]=" "+p[4]+" "),p},PSEUDO:function(p,b,_,L,P){if(p[1]==="not")if((e.exec(p[3])||"").length>1||/^\w/.test(p[3]))p[3]=c(p[3],null,null,b);else{var S=c.filter(p[3],b,_,!0^P);return _||L.push.apply(L,S),!1}else if(d.match.POS.test(p[0])||d.match.CHILD.test(p[0]))return!0;return p},POS:function(p){return p.unshift(!0),p}},filters:{enabled:function(p){return p.disabled===!1&&p.type!=="hidden"},disabled:function(p){return p.disabled===!0},checked:function(p){return p.checked===!0},selected:function(p){return p.parentNode&&p.parentNode.selectedIndex,p.selected===!0},parent:function(p){return!!p.firstChild},empty:function(p){return!p.firstChild},has:function(p,b,_){return!!c(_[3],p).length},header:function(p){return/h\d/i.test(p.nodeName)},text:function(p){var b=p.getAttribute("type"),_=p.type;return p.nodeName.toLowerCase()==="input"&&_==="text"&&(b===_||b===null)},radio:function(p){return p.nodeName.toLowerCase()==="input"&&p.type==="radio"},checkbox:function(p){return p.nodeName.toLowerCase()==="input"&&p.type==="checkbox"},file:function(p){return p.nodeName.toLowerCase()==="input"&&p.type==="file"},password:function(p){return p.nodeName.toLowerCase()==="input"&&p.type==="password"},submit:function(p){var b=p.nodeName.toLowerCase();return(b==="input"||b==="button")&&p.type==="submit"},image:function(p){return p.nodeName.toLowerCase()==="input"&&p.type==="image"},reset:function(p){var b=p.nodeName.toLowerCase();return(b==="input"||b==="button")&&p.type==="reset"},button:function(p){var b=p.nodeName.toLowerCase();return b==="input"&&p.type==="button"||b==="button"},input:function(p){return/input|select|textarea|button/i.test(p.nodeName)},focus:function(p){return p===p.ownerDocument.activeElement}},setFilters:{first:function(p,b){return b===0},last:function(p,b,_,L){return b===L.length-1},even:function(p,b){return b%2===0},odd:function(p,b){return b%2===1},lt:function(p,b,_){return b<_[3]-0},gt:function(p,b,_){return b>_[3]-0},nth:function(p,b,_){return _[3]-0===b},eq:function(p,b,_){return _[3]-0===b}},filter:{PSEUDO:function(p,b,_,L){var P=b[1],S=d.filters[P];if(S)return S(p,_,b,L);if(P==="contains")return(p.textContent||p.innerText||c.getText([p])||"").indexOf(b[3])>=0;if(P==="not"){for(var k=b[3],O=0,R=k.length;O<R;O++)if(k[O]===p)return!1;return!0}else c.error(P)},CHILD:function(p,b){var _=b[1],L=p;switch(_){case"only":case"first":for(;L=L.previousSibling;)if(L.nodeType===1)return!1;if(_==="first")return!0;L=p;case"last":for(;L=L.nextSibling;)if(L.nodeType===1)return!1;return!0;case"nth":var P=b[2],S=b[3];if(P===1&&S===0)return!0;var k=b[0],O=p.parentNode;if(O&&(O.sizcache!==k||!p.nodeIndex)){var R=0;for(L=O.firstChild;L;L=L.nextSibling)L.nodeType===1&&(L.nodeIndex=++R);O.sizcache=k}var I=p.nodeIndex-S;return P===0?I===0:I%P===0&&I/P>=0}},ID:function(p,b){return p.nodeType===1&&p.getAttribute("id")===b},TAG:function(p,b){return b==="*"&&p.nodeType===1||p.nodeName.toLowerCase()===b},CLASS:function(p,b){return(" "+(p.className||p.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(p,b){var _=b[1],L=d.attrHandle[_]?d.attrHandle[_](p):p[_]!=null?p[_]:p.getAttribute(_),P=L+"",S=b[2],k=b[4];return L==null?S==="!=":S==="="?P===k:S==="*="?P.indexOf(k)>=0:S==="~="?(" "+P+" ").indexOf(k)>=0:k?S==="!="?P!==k:S==="^="?P.indexOf(k)===0:S==="$="?P.substr(P.length-k.length)===k:S==="|="?P===k||P.substr(0,k.length+1)===k+"-":!1:P&&L!==!1},POS:function(p,b,_,L){var P=b[2],S=d.setFilters[P];if(S)return S(p,_,b,L)}}},u=d.match.POS,f=function(p,b){return"\\"+(b-0+1)};for(var v in d.match)d.match[v]=new RegExp(d.match[v].source+/(?![^\[]*\])(?![^\(]*\))/.source),d.leftMatch[v]=new RegExp(/(^(?:.|\r|\n)*?)/.source+d.match[v].source.replace(/\\(\d+)/g,f));var h=function(p,b){return p=Array.prototype.slice.call(p,0),b?(b.push.apply(b,p),b):p};try{Array.prototype.slice.call(document.documentElement.childNodes,0)[0].nodeType}catch{h=function(b,_){var L=0,P=_||[];if(n.call(b)==="[object Array]")Array.prototype.push.apply(P,b);else if(typeof b.length=="number")for(var S=b.length;L<S;L++)P.push(b[L]);else for(;b[L];L++)P.push(b[L]);return P}}var C,A;document.documentElement.compareDocumentPosition?C=function(p,b){return p===b?(r=!0,0):!p.compareDocumentPosition||!b.compareDocumentPosition?p.compareDocumentPosition?-1:1:p.compareDocumentPosition(b)&4?-1:1}:(C=function(p,b){if(p===b)return r=!0,0;if(p.sourceIndex&&b.sourceIndex)return p.sourceIndex-b.sourceIndex;var _,L,P=[],S=[],k=p.parentNode,O=b.parentNode,R=k;if(k===O)return A(p,b);if(k){if(!O)return 1}else return-1;for(;R;)P.unshift(R),R=R.parentNode;for(R=O;R;)S.unshift(R),R=R.parentNode;_=P.length,L=S.length;for(var I=0;I<_&&I<L;I++)if(P[I]!==S[I])return A(P[I],S[I]);return I===_?A(p,S[I],-1):A(P[I],b,1)},A=function(p,b,_){if(p===b)return _;for(var L=p.nextSibling;L;){if(L===b)return-1;L=L.nextSibling}return 1}),c.getText=function(p){for(var b="",_,L=0;p[L];L++)_=p[L],_.nodeType===3||_.nodeType===4?b+=_.nodeValue:_.nodeType!==8&&(b+=c.getText(_.childNodes));return b},(function(){var p=document.createElement("div"),b="script"+new Date().getTime(),_=document.documentElement;p.innerHTML="<a name='"+b+"'/>",_.insertBefore(p,_.firstChild),document.getElementById(b)&&(d.find.ID=function(L,P,S){if(typeof P.getElementById<"u"&&!S){var k=P.getElementById(L[1]);return k?k.id===L[1]||typeof k.getAttributeNode<"u"&&k.getAttributeNode("id").nodeValue===L[1]?[k]:void 0:[]}},d.filter.ID=function(L,P){var S=typeof L.getAttributeNode<"u"&&L.getAttributeNode("id");return L.nodeType===1&&S&&S.nodeValue===P}),_.removeChild(p),_=p=null})(),(function(){var p=document.createElement("div");p.appendChild(document.createComment("")),p.getElementsByTagName("*").length>0&&(d.find.TAG=function(b,_){var L=_.getElementsByTagName(b[1]);if(b[1]==="*"){for(var P=[],S=0;L[S];S++)L[S].nodeType===1&&P.push(L[S]);L=P}return L}),p.innerHTML="<a href='#'></a>",p.firstChild&&typeof p.firstChild.getAttribute<"u"&&p.firstChild.getAttribute("href")!=="#"&&(d.attrHandle.href=function(b){return b.getAttribute("href",2)}),p=null})(),document.querySelectorAll&&(function(){var p=c,b=document.createElement("div"),_="__sizzle__";if(b.innerHTML="<p class='TEST'></p>",!(b.querySelectorAll&&b.querySelectorAll(".TEST").length===0)){c=function(P,S,k,O){if(S=S||document,!O&&!c.isXML(S)){var R=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(P);if(R&&(S.nodeType===1||S.nodeType===9)){if(R[1])return h(S.getElementsByTagName(P),k);if(R[2]&&d.find.CLASS&&S.getElementsByClassName)return h(S.getElementsByClassName(R[2]),k)}if(S.nodeType===9){if(P==="body"&&S.body)return h([S.body],k);if(R&&R[3]){var I=S.getElementById(R[3]);if(I&&I.parentNode){if(I.id===R[3])return h([I],k)}else return h([],k)}try{return h(S.querySelectorAll(P),k)}catch{}}else if(S.nodeType===1&&S.nodeName.toLowerCase()!=="object"){var F=S,V=S.getAttribute("id"),D=V||_,m=S.parentNode,M=/^\s*[+~]/.test(P);V?D=D.replace(/'/g,"\\$&"):S.setAttribute("id",D),M&&m&&(S=S.parentNode);try{if(!M||m)return h(S.querySelectorAll("[id='"+D+"'] "+P),k)}catch{}finally{V||F.removeAttribute("id")}}}return p(P,S,k,O)};for(var L in p)c[L]=p[L];b=null}})(),(function(){var p=document.documentElement,b=p.matchesSelector||p.mozMatchesSelector||p.webkitMatchesSelector||p.msMatchesSelector;if(b){var _=!b.call(document.createElement("div"),"div"),L=!1;try{b.call(document.documentElement,"[test!='']:sizzle")}catch{L=!0}c.matchesSelector=function(P,S){if(S=S.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']"),!c.isXML(P))try{if(L||!d.match.PSEUDO.test(S)&&!/!=/.test(S)){var k=b.call(P,S);if(k||!_||P.document&&P.document.nodeType!==11)return k}}catch{}return c(S,null,null,[P]).length>0}}})(),(function(){var p=document.createElement("div");p.innerHTML="<div class='test e'></div><div class='test'></div>",!(!p.getElementsByClassName||p.getElementsByClassName("e").length===0)&&(p.lastChild.className="e",p.getElementsByClassName("e").length!==1&&(d.order.splice(1,0,"CLASS"),d.find.CLASS=function(b,_,L){if(typeof _.getElementsByClassName<"u"&&!L)return _.getElementsByClassName(b[1])},p=null))})();function T(p,b,_,L,P,S){for(var k=0,O=L.length;k<O;k++){var R=L[k];if(R){var I=!1;for(R=R[p];R;){if(R.sizcache===_){I=L[R.sizset];break}if(R.nodeType===1&&!S&&(R.sizcache=_,R.sizset=k),R.nodeName.toLowerCase()===b){I=R;break}R=R[p]}L[k]=I}}}function j(p,b,_,L,P,S){for(var k=0,O=L.length;k<O;k++){var R=L[k];if(R){var I=!1;for(R=R[p];R;){if(R.sizcache===_){I=L[R.sizset];break}if(R.nodeType===1){if(S||(R.sizcache=_,R.sizset=k),typeof b!="string"){if(R===b){I=!0;break}}else if(c.filter(b,[R]).length>0){I=R;break}}R=R[p]}L[k]=I}}}document.documentElement.contains?c.contains=function(p,b){return p!==b&&(p.contains?p.contains(b):!0)}:document.documentElement.compareDocumentPosition?c.contains=function(p,b){return!!(p.compareDocumentPosition(b)&16)}:c.contains=function(){return!1},c.isXML=function(p){var b=(p?p.ownerDocument||p:0).documentElement;return b?b.nodeName!=="HTML":!1};var N=function(p,b){for(var _,L=[],P="",S=b.nodeType?[b]:b;_=d.match.PSEUDO.exec(p);)P+=_[0],p=p.replace(d.match.PSEUDO,"");p=d.relative[p]?p+"*":p;for(var k=0,O=S.length;k<O;k++)c(p,S[k],L);return c.filter(P,L)};window.Sizzle=c})(),Prototype._original_property=window.Sizzle,(function(e){var t=Prototype.Selector.extendElements;function n(o,a){return t(e(o,a||document))}function r(o,a){return e.matches(a,[o]).length==1}Prototype.Selector.engine=e,Prototype.Selector.select=n,Prototype.Selector.match=r})(Sizzle),window.Sizzle=Prototype._original_property,delete Prototype._original_property;var Form={reset:function(e){return e=$(e),e.reset(),e},serializeElements:function(e,t){typeof t!="object"?t={hash:!!t}:Object.isUndefined(t.hash)&&(t.hash=!0);var n,r,o=!1,a=t.submit,s,c;return t.hash?(c={},s=function(d,u,f){return u in d?(Object.isArray(d[u])||(d[u]=[d[u]]),d[u].push(f)):d[u]=f,d}):(c="",s=function(d,u,f){return f=f.gsub(/(\r)?\n/,`\r
`),f=encodeURIComponent(f),f=f.gsub(/%20/,"+"),d+(d?"&":"")+encodeURIComponent(u)+"="+f}),e.inject(c,function(d,u){return!u.disabled&&u.name&&(n=u.name,r=$(u).getValue(),r!=null&&u.type!="file"&&(u.type!="submit"||!o&&a!==!1&&(!a||n==a)&&(o=!0))&&(d=s(d,n,r))),d})}};Form.Methods={serialize:function(e,t){return Form.serializeElements(Form.getElements(e),t)},getElements:function(e){for(var t=$(e).getElementsByTagName("*"),n,r=[],o=Form.Element.Serializers,a=0;n=t[a];a++)o[n.tagName.toLowerCase()]&&r.push(Element.extend(n));return r},getInputs:function(e,t,n){e=$(e);var r=e.getElementsByTagName("input");if(!t&&!n)return $A(r).map(Element.extend);for(var o=0,a=[],s=r.length;o<s;o++){var c=r[o];t&&c.type!=t||n&&c.name!=n||a.push(Element.extend(c))}return a},disable:function(e){return e=$(e),Form.getElements(e).invoke("disable"),e},enable:function(e){return e=$(e),Form.getElements(e).invoke("enable"),e},findFirstElement:function(e){var t=$(e).getElements().findAll(function(r){return r.type!="hidden"&&!r.disabled}),n=t.findAll(function(r){return r.hasAttribute("tabIndex")&&r.tabIndex>=0}).sortBy(function(r){return r.tabIndex}).first();return n||t.find(function(r){return/^(?:input|select|textarea)$/i.test(r.tagName)})},focusFirstElement:function(e){e=$(e);var t=e.findFirstElement();return t&&t.activate(),e},request:function(e,t){e=$(e),t=Object.clone(t||{});var n=t.parameters,r=e.readAttribute("action")||"";return r.blank()&&(r=window.location.href),t.parameters=e.serialize(!0),n&&(Object.isString(n)&&(n=n.toQueryParams()),Object.extend(t.parameters,n)),e.hasAttribute("method")&&!t.method&&(t.method=e.method),new Ajax.Request(r,t)}},Form.Element={focus:function(e){return $(e).focus(),e},select:function(e){return $(e).select(),e}},Form.Element.Methods={serialize:function(e){if(e=$(e),!e.disabled&&e.name){var t=e.getValue();if(t!=null){var n={};return n[e.name]=t,Object.toQueryString(n)}}return""},getValue:function(e){e=$(e);var t=e.tagName.toLowerCase();return Form.Element.Serializers[t](e)},setValue:function(e,t){e=$(e);var n=e.tagName.toLowerCase();return Form.Element.Serializers[n](e,t),e},clear:function(e){return $(e).value="",e},present:function(e){return $(e).value!=""},activate:function(e){e=$(e);try{e.focus(),e.select&&(e.tagName.toLowerCase()!="input"||!/^(?:button|reset|submit)$/i.test(e.type))&&e.select()}catch{}return e},disable:function(e){return e=$(e),e.disabled=!0,e},enable:function(e){return e=$(e),e.disabled=!1,e}};var Field=Form.Element,$F=Form.Element.Methods.getValue;Form.Element.Serializers=(function(){function e(c,d){switch(c.type.toLowerCase()){case"checkbox":case"radio":return t(c,d);default:return n(c,d)}}function t(c,d){if(Object.isUndefined(d))return c.checked?c.value:null;c.checked=!!d}function n(c,d){if(Object.isUndefined(d))return c.value;c.value=d}function r(c,d){if(Object.isUndefined(d))return(c.type==="select-one"?o:a)(c);for(var u,f,v=!Object.isArray(d),h=0,C=c.length;h<C;h++)if(u=c.options[h],f=this.optionValue(u),v){if(f==d){u.selected=!0;return}}else u.selected=d.include(f)}function o(c){var d=c.selectedIndex;return d>=0?s(c.options[d]):null}function a(c){var d,u=c.length;if(!u)return null;for(var f=0,d=[];f<u;f++){var v=c.options[f];v.selected&&d.push(s(v))}return d}function s(c){return Element.hasAttribute(c,"value")?c.value:c.text}return{input:e,inputSelector:t,textarea:n,select:r,selectOne:o,selectMany:a,optionValue:s,button:n}})(),Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function(e,t,n,r){e(r,n),this.element=$(t),this.lastValue=this.getValue()},execute:function(){var e=this.getValue();(Object.isString(this.lastValue)&&Object.isString(e)?this.lastValue!=e:String(this.lastValue)!=String(e))&&(this.callback(this.element,e),this.lastValue=e)}}),Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}}),Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}}),Abstract.EventObserver=Class.create({initialize:function(e,t){this.element=$(e),this.callback=t,this.lastValue=this.getValue(),this.element.tagName.toLowerCase()=="form"?this.registerFormCallbacks():this.registerCallback(this.element)},onElementEvent:function(){var e=this.getValue();this.lastValue!=e&&(this.callback(this.element,e),this.lastValue=e)},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(e){if(e.type)switch(e.type.toLowerCase()){case"checkbox":case"radio":Event.observe(e,"click",this.onElementEvent.bind(this));break;default:Event.observe(e,"change",this.onElementEvent.bind(this));break}}}),Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}}),Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}}),(function(e){var t=document.createElement("div"),n=document.documentElement,r="onmouseenter"in n&&"onmouseleave"in n,o={KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45},a=function(Q){return!1};window.attachEvent&&(window.addEventListener?a=function(Q){return!(Q instanceof window.Event)}:a=function(Q){return!0});var s;function c(Q,B){return Q.which?Q.which===B+1:Q.button===B}var d={0:1,1:4,2:2};function u(Q,B){return Q.button===d[B]}function f(Q,B){switch(B){case 0:return Q.which==1&&!Q.metaKey;case 1:return Q.which==2||Q.which==1&&Q.metaKey;case 2:return Q.which==3;default:return!1}}window.attachEvent?window.addEventListener?s=function(Q,B){return a(Q)?u(Q,B):c(Q,B)}:s=u:Prototype.Browser.WebKit?s=f:s=c;function v(Q){return s(Q,0)}function h(Q){return s(Q,1)}function C(Q){return s(Q,2)}function A(Q){return Element.extend(T(Q))}function T(Q){Q=o.extend(Q);var B=Q.target,J=Q.type,te=Q.currentTarget;return te&&te.tagName&&(J==="load"||J==="error"||J==="click"&&te.tagName.toLowerCase()==="input"&&te.type==="radio")&&(B=te),B.nodeType==Node.TEXT_NODE&&(B=B.parentNode),Element.extend(B)}function j(Q,B){var J=T(Q),te=Prototype.Selector.match;if(!B)return Element.extend(J);for(;J;){if(Object.isElement(J)&&te(J,B))return Element.extend(J);J=J.parentNode}}function N(Q){return{x:p(Q),y:b(Q)}}function p(Q){var B=document.documentElement,J=document.body||{scrollLeft:0};return Q.pageX||Q.clientX+(B.scrollLeft||J.scrollLeft)-(B.clientLeft||0)}function b(Q){var B=document.documentElement,J=document.body||{scrollTop:0};return Q.pageY||Q.clientY+(B.scrollTop||J.scrollTop)-(B.clientTop||0)}function _(Q){o.extend(Q),Q.preventDefault(),Q.stopPropagation(),Q.stopped=!0}o.Methods={isLeftClick:v,isMiddleClick:h,isRightClick:C,element:A,findElement:j,pointer:N,pointerX:p,pointerY:b,stop:_};var L=Object.keys(o.Methods).inject({},function(Q,B){return Q[B]=o.Methods[B].methodize(),Q});if(window.attachEvent){let Q=function(B){var J;switch(B.type){case"mouseover":case"mouseenter":J=B.fromElement;break;case"mouseout":case"mouseleave":J=B.toElement;break;default:return null}return Element.extend(J)};var Se=Q,P={stopPropagation:function(){this.cancelBubble=!0},preventDefault:function(){this.returnValue=!1},inspect:function(){return"[object Event]"}};o.extend=function(B,J){if(!B)return!1;if(!a(B)||B._extendedByPrototype)return B;B._extendedByPrototype=Prototype.emptyFunction;var te=o.pointer(B);return Object.extend(B,{target:B.srcElement||J,relatedTarget:Q(B),pageX:te.x,pageY:te.y}),Object.extend(B,L),Object.extend(B,P),B}}else o.extend=Prototype.K;window.addEventListener&&(o.prototype=window.Event.prototype||document.createEvent("HTMLEvents").__proto__,Object.extend(o.prototype,L));var S={mouseenter:"mouseover",mouseleave:"mouseout"};function k(Q){return S[Q]||Q}r&&(k=Prototype.K);function O(Q){return Q===window?0:(typeof Q._prototypeUID>"u"&&(Q._prototypeUID=Element.Storage.UID++),Q._prototypeUID)}function R(Q){return Q===window?0:Q==document?1:Q.uniqueID}"uniqueID"in t&&(O=R);function I(Q){return Q.include(":")}o._isCustomEvent=I;function F(Q,B){var J=e.Event.cache;return Object.isUndefined(B)&&(B=O(Q)),J[B]||(J[B]={element:Q}),J[B]}function V(Q,B){Object.isUndefined(B)&&(B=O(Q)),delete e.Event.cache[B]}function D(Q,B,J){var te=F(Q);te[B]||(te[B]=[]);for(var G=te[B],Z=G.length;Z--;)if(G[Z].handler===J)return null;var re=O(Q),ie=e.Event._createResponder(re,B,J),ce={responder:ie,handler:J};return G.push(ce),ce}function m(Q,B,J){var te=F(Q),G=te[B];if(G){for(var Z=G.length,re;Z--;)if(G[Z].handler===J){re=G[Z];break}if(re){var ie=G.indexOf(re);return G.splice(ie,1),re}}}function M(Q,B,J){Q=$(Q);var te=D(Q,B,J);if(te===null)return Q;var G=te.responder;return I(B)?z(Q,B,G):U(Q,B,G),Q}function U(Q,B,J){var te=k(B);Q.addEventListener?Q.addEventListener(te,J,!1):Q.attachEvent("on"+te,J)}function z(Q,B,J){Q.addEventListener?Q.addEventListener("dataavailable",J,!1):(Q.attachEvent("ondataavailable",J),Q.attachEvent("onlosecapture",J))}function q(Q,B,J){Q=$(Q);var te=!Object.isUndefined(J),G=!Object.isUndefined(B);if(!G&&!te)return Y(Q),Q;if(!te)return ne(Q,B),Q;var Z=m(Q,B,J);return Z&&X(Q,B,Z.responder),Q}function ee(Q,B,J){var te=k(B);Q.removeEventListener?Q.removeEventListener(te,J,!1):Q.detachEvent("on"+te,J)}function W(Q,B,J){Q.removeEventListener?Q.removeEventListener("dataavailable",J,!1):(Q.detachEvent("ondataavailable",J),Q.detachEvent("onlosecapture",J))}function Y(Q){var B=O(Q),J=F(Q,B);V(Q,B);var te,G;for(var Z in J)if(Z!=="element")for(te=J[Z],G=te.length;G--;)X(Q,Z,te[G].responder)}function ne(Q,B){var J=F(Q),te=J[B];if(te){delete J[B];for(var G=te.length;G--;)X(Q,B,te[G].responder)}}function X(Q,B,J){I(B)?W(Q,B,J):ee(Q,B,J)}function se(Q){return Q!==document?Q:document.createEvent&&!Q.dispatchEvent?document.documentElement:Q}function fe(Q,B,J,te){Q=se($(Q)),Object.isUndefined(te)&&(te=!0),J=J||{};var G=ye(Q,B,J,te);return o.extend(G)}function pe(Q,B,J,te){var G=document.createEvent("HTMLEvents");return G.initEvent("dataavailable",te,!0),G.eventName=B,G.memo=J,Q.dispatchEvent(G),G}function me(Q,B,J,te){var G=document.createEventObject();return G.eventType=te?"ondataavailable":"onlosecapture",G.eventName=B,G.memo=J,Q.fireEvent(G.eventType,G),G}var ye=document.createEvent?pe:me;o.Handler=Class.create({initialize:function(Q,B,J,te){this.element=$(Q),this.eventName=B,this.selector=J,this.callback=te,this.handler=this.handleEvent.bind(this)},start:function(){return o.observe(this.element,this.eventName,this.handler),this},stop:function(){return o.stopObserving(this.element,this.eventName,this.handler),this},handleEvent:function(Q){var B=o.findElement(Q,this.selector);B&&this.callback.call(this.element,Q,B)}});function be(Q,B,J,te){return Q=$(Q),Object.isFunction(J)&&Object.isUndefined(te)&&(te=J,J=null),new o.Handler(Q,B,J,te).start()}Object.extend(o,o.Methods),Object.extend(o,{fire:fe,observe:M,stopObserving:q,on:be}),Element.addMethods({fire:fe,observe:M,stopObserving:q,on:be}),Object.extend(document,{fire:fe.methodize(),observe:M.methodize(),stopObserving:q.methodize(),on:be.methodize(),loaded:!1}),e.Event?Object.extend(window.Event,o):e.Event=o,e.Event.cache={};function Ee(){e.Event.cache=null}window.attachEvent&&window.attachEvent("onunload",Ee),t=null,n=null})(this),(function(e){var t=document.documentElement,n="onmouseenter"in t&&"onmouseleave"in t;function r(c){return!n&&(c==="mouseenter"||c==="mouseleave")}function o(c,d,u){return Event._isCustomEvent(d)?a(c,d,u):r(d)?s(c,d,u):function(f){var v=Event.cache[c],h=v.element;Event.extend(f,h),u.call(h,f)}}function a(c,d,u){return function(f){var v=Event.cache[c],h=v.element;if(Object.isUndefined(f.eventName)||f.eventName!==d)return!1;Event.extend(f,h),u.call(h,f)}}function s(c,d,u){return function(f){var v=Event.cache[c],h=v.element;Event.extend(f,h);for(var C=f.relatedTarget;C&&C!==h;)try{C=C.parentNode}catch{C=h}C!==h&&u.call(h,f)}}e.Event._createResponder=o,t=null})(this),(function(e){var t;function n(){document.loaded||(t&&window.clearTimeout(t),document.loaded=!0,document.fire("dom:loaded"))}function r(){document.readyState==="complete"&&(document.detachEvent("onreadystatechange",r),n())}function o(){try{document.documentElement.doScroll("left")}catch{t=o.defer();return}n()}document.addEventListener?document.addEventListener("DOMContentLoaded",n,!1):(document.attachEvent("onreadystatechange",r),window==top&&(t=o.defer())),Event.observe(window,"load",n)})(this),Element.addMethods(),Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;var Insertion={Before:function(e,t){return Element.insert(e,{before:t})},Top:function(e,t){return Element.insert(e,{top:t})},Bottom:function(e,t){return Element.insert(e,{bottom:t})},After:function(e,t){return Element.insert(e,{after:t})}},$continue=new Error('"throw $continue" is deprecated, use "return" instead'),Position={includeScrollOffsets:!1,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0,this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},within:function(e,t,n){return this.includeScrollOffsets?this.withinIncludingScrolloffsets(e,t,n):(this.xcomp=t,this.ycomp=n,this.offset=Element.cumulativeOffset(e),n>=this.offset[1]&&n<this.offset[1]+e.offsetHeight&&t>=this.offset[0]&&t<this.offset[0]+e.offsetWidth)},withinIncludingScrolloffsets:function(e,t,n){var r=Element.cumulativeScrollOffset(e);return this.xcomp=t+r[0]-this.deltaX,this.ycomp=n+r[1]-this.deltaY,this.offset=Element.cumulativeOffset(e),this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+e.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+e.offsetWidth},overlap:function(e,t){if(!e)return 0;if(e=="vertical")return(this.offset[1]+t.offsetHeight-this.ycomp)/t.offsetHeight;if(e=="horizontal")return(this.offset[0]+t.offsetWidth-this.xcomp)/t.offsetWidth},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(e){return Position.prepare(),Element.absolutize(e)},relativize:function(e){return Position.prepare(),Element.relativize(e)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(e,t,n){return n=n||{},Element.clonePosition(t,e,n)}};document.getElementsByClassName||(document.getElementsByClassName=(function(e){function t(n){return n.blank()?null:"[contains(concat(' ', @class, ' '), ' "+n+" ')]"}return e.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(n,r){r=r.toString().strip();var o=/\s/.test(r)?$w(r).map(t).join(""):t(r);return o?document._getElementsByXPath(".//*"+o,n):[]}:function(n,r){r=r.toString().strip();var o=[],a=/\s/.test(r)?$w(r):null;if(!a&&!r)return o;var s=$(n).getElementsByTagName("*");r=" "+r+" ";for(var c=0,d,u;d=s[c];c++)d.className&&(u=" "+d.className+" ")&&(u.include(r)||a&&a.all(function(f){return!f.toString().blank()&&u.include(" "+f+" ")}))&&o.push(Element.extend(d));return o},function(n,r){return $(r||document.body).getElementsByClassName(n)}})(Element.Methods)),Element.ClassNames=Class.create(),Element.ClassNames.prototype={initialize:function(e){this.element=$(e)},_each:function(e,t){this.element.className.split(/\s+/).select(function(n){return n.length>0})._each(e,t)},set:function(e){this.element.className=e},add:function(e){this.include(e)||this.set($A(this).concat(e).join(" "))},remove:function(e){this.include(e)&&this.set($A(this).without(e).join(" "))},toString:function(){return $A(this).join(" ")}},Object.extend(Element.ClassNames.prototype,Enumerable),(function(){window.Selector=Class.create({initialize:function(e){this.expression=e.strip()},findElements:function(e){return Prototype.Selector.select(this.expression,e)},match:function(e){return Prototype.Selector.match(e,this.expression)},toString:function(){return this.expression},inspect:function(){return"#<Selector: "+this.expression+">"}}),Object.extend(Selector,{matchElements:function(e,t){for(var n=Prototype.Selector.match,r=[],o=0,a=e.length;o<a;o++){var s=e[o];n(s,t)&&r.push(Element.extend(s))}return r},findElement:function(e,t,n){n=n||0;for(var r=0,o,a=0,s=e.length;a<s;a++)if(o=e[a],Prototype.Selector.match(o,t)&&n===r++)return Element.extend(o)},findChildElements:function(e,t){var n=t.toArray().join(", ");return Prototype.Selector.select(n,e||document)}})})();function Dom(){}Dom.getEvent=function(t){if(!t)var t=window.event;return t},Dom.getObject=function(e){return e.currentTarget?e.currentTarget:event.srcElement},Dom.removeObject=function(e){e?.parentNode.removeChild(e)},Dom.x=function(e){return e.pageX?e.pageX:e.x},Dom.y=function(e){return e.pageY?e.pageY:e.y},Dom.left=function(e){return e.offsetLeft==0&&e.offsetTop==0?e.style.left.substr(0,e.style.left.length-2):e.offsetLeft},Dom.top=function(e){return e.offsetLeft==0&&e.offsetTop==0?e.style.top.substr(0,e.style.top.length-2):e.offsetTop},Dom.cornerX=function(e){return e.layerX?Dom.x(e)-e.layerX:Dom.x(e)-e.offsetX},Dom.cornerY=function(e){return e.layerY?Dom.y(e)-e.layerY:Dom.y(e)-e.offsetY},Dom.setClass=function(e,t){e.setAttribute("class",t),e.setAttribute("className",t)},Dom.setStyle=function(e,t){e.setAttribute("style",t),e.style.cssText=t},Dom.setDisplay=function(e,t){var n=document.getElementById(e);n!=null&&(n.style.display=t)},Dom.attachEvent=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,!0)},Dom.getElementsByName=function(e,t){var n=document.getElementsByTagName(e),r=new Array;for(i=0,iarr=0;i<n.length;i++)att=n[i].getAttribute("name"),att==t&&(r[iarr]=n[i],iarr++);return r},Dom.is_child_of=function(e,t){if(t!=null)try{for(;t.parentNode;)if((t=t.parentNode)==e)return!0}catch(n){Debugger.log("Unable to ask is_child_of: "+n)}return!1},Dom.divMouseEvent=function(element,event,JavaScript_code){var current_mouse_target=null;event.toElement?current_mouse_target=event.toElement:event.relatedTarget&&(current_mouse_target=event.relatedTarget),!Dom.is_child_of(element,current_mouse_target)&&element!=current_mouse_target&&eval(JavaScript_code)},Ajax=new Object,Ajax.isSending=!1,Ajax.queue=[],Ajax.waitUntilReady=function(){if(!Ajax.isSending&&Ajax.queue.length>0){Ajax.isSending=!0;var e=Ajax.queue[0];e.go(),Ajax.queue.splice(0,1)}Ajax.queue.length>0&&setTimeout("Ajax.waitUntilReady()",100)},Ajax.createHttp=function(){for(var e=0;e<httpFactories.length;e++)try{return httpFactories[e]()}catch{continue}return!1},Ajax.sendRequest=function(e,t,n){var r=new AjaxSender(e,t,n);Ajax.queue.push(r),Ajax.waitUntilReady()},Ajax.defaultAjaxHandle=function(e){var t=e.responseText;alert(t)};var httpFactories=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];function AjaxSender(e,t,n){this.url=e,this.callback=t,this.postData=n,this.go=function(){var r=this.url,o=this.callback,a=this.postData;if(http=Ajax.createHttp(),!!http){var s=a?"POST":"GET";o=o||Ajax.defaultAjaxHandle,http.open(s,r,!0),a&&http.setRequestHeader("Content-type","application/x-www-form-urlencoded"),http.onreadystatechange=function(){http.readyState==4&&(http.status!=200&&http.status!=304||(o(http),Ajax.isSending=!1))},http.readyState!=4&&http.send(a)}}}function roundTo(e,t){var n=Math.pow(10,t);return t>0,Math.round(e/n)*n}String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.ltrim=function(){return this.replace(/^\s+/,"")},String.prototype.rtrim=function(){return this.replace(/\s+$/,"")};function trim(e){return e.replace(/^\s+|\s+$/g,"")}function format(e){for(var t=e,n="";t!=n;){n=t;for(var r=1;r<arguments.length;r++)t=t.replace("{"+(r-1)+"}",arguments[r])}return t}function formatOnce(e){for(var t=e,n=1;n<arguments.length;n++)t=t.replace("{"+(n-1)+"}",arguments[n]);return t}Json=new Object,Json.toObject=function(jsonText){return jsonText==""?null:(eval(format("var data = {0};",jsonText)),data)},Json.toString=function(e,t,n){typeof t>"u"&&(t=null),typeof n>"u"&&(n=!0);var r="";for(var o in e){var a=e[o];if(!((""+a).startsWith("function")||a==null))if(r.length>0&&(r+=","),Json.isObject(a))r+=Json.toString(a,o,!1);else if(Json.isArray(a)){r+=format('"{0}" : [',o);for(var s=0;s<a.length;s++)s>0&&(r+=","),r+=Json.toString(a[s],null,!0);r+="]"}else r+=format('"{0}" : "{1}"',o,e[o])}return t!=null&&(r=format('"{0}" : {{1}}',t,r)),n&&(r=format("{{0}}",r)),r},Json.isObject=function(e){return typeof e=="object"&&!Json.isArray(e)},Json.isArray=function(e){return e.constructor.toString().indexOf("Array")!=-1},Debugger=new Object,Debugger.inspect=function(e){var t="";for(var n in e)(""+e[n]).startsWith("function")||(t+=typeof e+"."+n+"="+e[n]+`
 */(function(){var e=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,t=0,r=Object.prototype.toString,a=!1,n=!0,o=/\\/g,u=/\W/;[0,0].sort(function(){return n=!1,0});var s=function(g,v,M,L){M=M||[],v=v||document;var T=v;if(v.nodeType!==1&&v.nodeType!==9)return[];if(!g||typeof g!="string")return M;var A,j,k,U,_,Q,W,F,p=!0,D=s.isXML(v),O=[],G=g;do if(e.exec(""),A=e.exec(G),A&&(G=A[3],O.push(A[1]),A[2])){U=A[3];break}while(A);if(O.length>1&&c.exec(g))if(O.length===2&&d.relative[O[0]])j=R(O[0]+O[1],v);else for(j=d.relative[O[0]]?[v]:s(O.shift(),v);O.length;)g=O.shift(),d.relative[g]&&(g+=O.shift()),j=R(g,j);else if(!L&&O.length>1&&v.nodeType===9&&!D&&d.match.ID.test(O[0])&&!d.match.ID.test(O[O.length-1])&&(_=s.find(O.shift(),v,D),v=_.expr?s.filter(_.expr,_.set)[0]:_.set[0]),v)for(_=L?{expr:O.pop(),set:m(L)}:s.find(O.pop(),O.length===1&&(O[0]==="~"||O[0]==="+")&&v.parentNode?v.parentNode:v,D),j=_.expr?s.filter(_.expr,_.set):_.set,O.length>0?k=m(j):p=!1;O.length;)Q=O.pop(),W=Q,d.relative[Q]?W=O.pop():Q="",W==null&&(W=v),d.relative[Q](k,W,D);else k=O=[];if(k||(k=j),k||s.error(Q||g),r.call(k)==="[object Array]")if(!p)M.push.apply(M,k);else if(v&&v.nodeType===1)for(F=0;k[F]!=null;F++)k[F]&&(k[F]===!0||k[F].nodeType===1&&s.contains(v,k[F]))&&M.push(j[F]);else for(F=0;k[F]!=null;F++)k[F]&&k[F].nodeType===1&&M.push(j[F]);else m(k,M);return U&&(s(U,T,M,L),s.uniqueSort(M)),M};s.uniqueSort=function(g){if(E&&(a=n,g.sort(E),a))for(var v=1;v<g.length;v++)g[v]===g[v-1]&&g.splice(v--,1);return g},s.matches=function(g,v){return s(g,null,null,v)},s.matchesSelector=function(g,v){return s(v,null,null,[g]).length>0},s.find=function(g,v,M){var L;if(!g)return[];for(var T=0,A=d.order.length;T<A;T++){var j,k=d.order[T];if(j=d.leftMatch[k].exec(g)){var U=j[1];if(j.splice(1,1),U.substr(U.length-1)!=="\\"&&(j[1]=(j[1]||"").replace(o,""),L=d.find[k](j,v,M),L!=null)){g=g.replace(d.match[k],"");break}}}return L||(L=typeof v.getElementsByTagName<"u"?v.getElementsByTagName("*"):[]),{set:L,expr:g}},s.filter=function(g,v,M,L){for(var T,A,j=g,k=[],U=v,_=v&&v[0]&&s.isXML(v[0]);g&&v.length;){for(var Q in d.filter)if((T=d.leftMatch[Q].exec(g))!=null&&T[2]){var W,F,p=d.filter[Q],D=T[1];if(A=!1,T.splice(1,1),D.substr(D.length-1)==="\\")continue;if(U===k&&(k=[]),d.preFilter[Q]){if(T=d.preFilter[Q](T,U,M,k,L,_),!T)A=W=!0;else if(T===!0)continue}if(T){for(var O=0;(F=U[O])!=null;O++)if(F){W=p(F,T,O,U);var G=L^!!W;M&&W!=null?G?A=!0:U[O]=!1:G&&(k.push(F),A=!0)}}if(W!==void 0){if(M||(U=k),g=g.replace(d.match[Q],""),!A)return[];break}}if(g===j)if(A==null)s.error(g);else break;j=g}return U},s.error=function(g){throw"Syntax error, unrecognized expression: "+g};var d=s.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{class:"className",for:"htmlFor"},attrHandle:{href:function(g){return g.getAttribute("href")},type:function(g){return g.getAttribute("type")}},relative:{"+":function(g,v){var M=typeof v=="string",L=M&&!u.test(v),T=M&&!L;L&&(v=v.toLowerCase());for(var A=0,j=g.length,k;A<j;A++)if(k=g[A]){for(;(k=k.previousSibling)&&k.nodeType!==1;);g[A]=T||k&&k.nodeName.toLowerCase()===v?k||!1:k===v}T&&s.filter(v,g,!0)},">":function(g,v){var M,L=typeof v=="string",T=0,A=g.length;if(L&&!u.test(v)){for(v=v.toLowerCase();T<A;T++)if(M=g[T],M){var j=M.parentNode;g[T]=j.nodeName.toLowerCase()===v?j:!1}}else{for(;T<A;T++)M=g[T],M&&(g[T]=L?M.parentNode:M.parentNode===v);L&&s.filter(v,g,!0)}},"":function(g,v,M){var L,T=t++,A=N;typeof v=="string"&&!u.test(v)&&(v=v.toLowerCase(),L=v,A=P),A("parentNode",v,T,g,L,M)},"~":function(g,v,M){var L,T=t++,A=N;typeof v=="string"&&!u.test(v)&&(v=v.toLowerCase(),L=v,A=P),A("previousSibling",v,T,g,L,M)}},find:{ID:function(g,v,M){if(typeof v.getElementById<"u"&&!M){var L=v.getElementById(g[1]);return L&&L.parentNode?[L]:[]}},NAME:function(g,v){if(typeof v.getElementsByName<"u"){for(var M=[],L=v.getElementsByName(g[1]),T=0,A=L.length;T<A;T++)L[T].getAttribute("name")===g[1]&&M.push(L[T]);return M.length===0?null:M}},TAG:function(g,v){if(typeof v.getElementsByTagName<"u")return v.getElementsByTagName(g[1])}},preFilter:{CLASS:function(g,v,M,L,T,A){if(g=" "+g[1].replace(o,"")+" ",A)return g;for(var j=0,k;(k=v[j])!=null;j++)k&&(T^(k.className&&(" "+k.className+" ").replace(/[\t\n\r]/g," ").indexOf(g)>=0)?M||L.push(k):M&&(v[j]=!1));return!1},ID:function(g){return g[1].replace(o,"")},TAG:function(g,v){return g[1].replace(o,"").toLowerCase()},CHILD:function(g){if(g[1]==="nth"){g[2]||s.error(g[0]),g[2]=g[2].replace(/^\+|\s*/g,"");var v=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(g[2]==="even"&&"2n"||g[2]==="odd"&&"2n+1"||!/\D/.test(g[2])&&"0n+"+g[2]||g[2]);g[2]=v[1]+(v[2]||1)-0,g[3]=v[3]-0}else g[2]&&s.error(g[0]);return g[0]=t++,g},ATTR:function(g,v,M,L,T,A){var j=g[1]=g[1].replace(o,"");return!A&&d.attrMap[j]&&(g[1]=d.attrMap[j]),g[4]=(g[4]||g[5]||"").replace(o,""),g[2]==="~="&&(g[4]=" "+g[4]+" "),g},PSEUDO:function(g,v,M,L,T){if(g[1]==="not")if((e.exec(g[3])||"").length>1||/^\w/.test(g[3]))g[3]=s(g[3],null,null,v);else{var A=s.filter(g[3],v,M,!0^T);return M||L.push.apply(L,A),!1}else if(d.match.POS.test(g[0])||d.match.CHILD.test(g[0]))return!0;return g},POS:function(g){return g.unshift(!0),g}},filters:{enabled:function(g){return g.disabled===!1&&g.type!=="hidden"},disabled:function(g){return g.disabled===!0},checked:function(g){return g.checked===!0},selected:function(g){return g.parentNode&&g.parentNode.selectedIndex,g.selected===!0},parent:function(g){return!!g.firstChild},empty:function(g){return!g.firstChild},has:function(g,v,M){return!!s(M[3],g).length},header:function(g){return/h\d/i.test(g.nodeName)},text:function(g){var v=g.getAttribute("type"),M=g.type;return g.nodeName.toLowerCase()==="input"&&M==="text"&&(v===M||v===null)},radio:function(g){return g.nodeName.toLowerCase()==="input"&&g.type==="radio"},checkbox:function(g){return g.nodeName.toLowerCase()==="input"&&g.type==="checkbox"},file:function(g){return g.nodeName.toLowerCase()==="input"&&g.type==="file"},password:function(g){return g.nodeName.toLowerCase()==="input"&&g.type==="password"},submit:function(g){var v=g.nodeName.toLowerCase();return(v==="input"||v==="button")&&g.type==="submit"},image:function(g){return g.nodeName.toLowerCase()==="input"&&g.type==="image"},reset:function(g){var v=g.nodeName.toLowerCase();return(v==="input"||v==="button")&&g.type==="reset"},button:function(g){var v=g.nodeName.toLowerCase();return v==="input"&&g.type==="button"||v==="button"},input:function(g){return/input|select|textarea|button/i.test(g.nodeName)},focus:function(g){return g===g.ownerDocument.activeElement}},setFilters:{first:function(g,v){return v===0},last:function(g,v,M,L){return v===L.length-1},even:function(g,v){return v%2===0},odd:function(g,v){return v%2===1},lt:function(g,v,M){return v<M[3]-0},gt:function(g,v,M){return v>M[3]-0},nth:function(g,v,M){return M[3]-0===v},eq:function(g,v,M){return M[3]-0===v}},filter:{PSEUDO:function(g,v,M,L){var T=v[1],A=d.filters[T];if(A)return A(g,M,v,L);if(T==="contains")return(g.textContent||g.innerText||s.getText([g])||"").indexOf(v[3])>=0;if(T==="not"){for(var j=v[3],k=0,U=j.length;k<U;k++)if(j[k]===g)return!1;return!0}else s.error(T)},CHILD:function(g,v){var M=v[1],L=g;switch(M){case"only":case"first":for(;L=L.previousSibling;)if(L.nodeType===1)return!1;if(M==="first")return!0;L=g;case"last":for(;L=L.nextSibling;)if(L.nodeType===1)return!1;return!0;case"nth":var T=v[2],A=v[3];if(T===1&&A===0)return!0;var j=v[0],k=g.parentNode;if(k&&(k.sizcache!==j||!g.nodeIndex)){var U=0;for(L=k.firstChild;L;L=L.nextSibling)L.nodeType===1&&(L.nodeIndex=++U);k.sizcache=j}var _=g.nodeIndex-A;return T===0?_===0:_%T===0&&_/T>=0}},ID:function(g,v){return g.nodeType===1&&g.getAttribute("id")===v},TAG:function(g,v){return v==="*"&&g.nodeType===1||g.nodeName.toLowerCase()===v},CLASS:function(g,v){return(" "+(g.className||g.getAttribute("class"))+" ").indexOf(v)>-1},ATTR:function(g,v){var M=v[1],L=d.attrHandle[M]?d.attrHandle[M](g):g[M]!=null?g[M]:g.getAttribute(M),T=L+"",A=v[2],j=v[4];return L==null?A==="!=":A==="="?T===j:A==="*="?T.indexOf(j)>=0:A==="~="?(" "+T+" ").indexOf(j)>=0:j?A==="!="?T!==j:A==="^="?T.indexOf(j)===0:A==="$="?T.substr(T.length-j.length)===j:A==="|="?T===j||T.substr(0,j.length+1)===j+"-":!1:T&&L!==!1},POS:function(g,v,M,L){var T=v[2],A=d.setFilters[T];if(A)return A(g,M,v,L)}}},c=d.match.POS,f=function(g,v){return"\\"+(v-0+1)};for(var C in d.match)d.match[C]=new RegExp(d.match[C].source+/(?![^\[]*\])(?![^\(]*\))/.source),d.leftMatch[C]=new RegExp(/(^(?:.|\r|\n)*?)/.source+d.match[C].source.replace(/\\(\d+)/g,f));var m=function(g,v){return g=Array.prototype.slice.call(g,0),v?(v.push.apply(v,g),v):g};try{Array.prototype.slice.call(document.documentElement.childNodes,0)[0].nodeType}catch{m=function(v,M){var L=0,T=M||[];if(r.call(v)==="[object Array]")Array.prototype.push.apply(T,v);else if(typeof v.length=="number")for(var A=v.length;L<A;L++)T.push(v[L]);else for(;v[L];L++)T.push(v[L]);return T}}var E,S;document.documentElement.compareDocumentPosition?E=function(g,v){return g===v?(a=!0,0):!g.compareDocumentPosition||!v.compareDocumentPosition?g.compareDocumentPosition?-1:1:g.compareDocumentPosition(v)&4?-1:1}:(E=function(g,v){if(g===v)return a=!0,0;if(g.sourceIndex&&v.sourceIndex)return g.sourceIndex-v.sourceIndex;var M,L,T=[],A=[],j=g.parentNode,k=v.parentNode,U=j;if(j===k)return S(g,v);if(j){if(!k)return 1}else return-1;for(;U;)T.unshift(U),U=U.parentNode;for(U=k;U;)A.unshift(U),U=U.parentNode;M=T.length,L=A.length;for(var _=0;_<M&&_<L;_++)if(T[_]!==A[_])return S(T[_],A[_]);return _===M?S(g,A[_],-1):S(T[_],v,1)},S=function(g,v,M){if(g===v)return M;for(var L=g.nextSibling;L;){if(L===v)return-1;L=L.nextSibling}return 1}),s.getText=function(g){for(var v="",M,L=0;g[L];L++)M=g[L],M.nodeType===3||M.nodeType===4?v+=M.nodeValue:M.nodeType!==8&&(v+=s.getText(M.childNodes));return v},(function(){var g=document.createElement("div"),v="script"+new Date().getTime(),M=document.documentElement;g.innerHTML="<a name='"+v+"'/>",M.insertBefore(g,M.firstChild),document.getElementById(v)&&(d.find.ID=function(L,T,A){if(typeof T.getElementById<"u"&&!A){var j=T.getElementById(L[1]);return j?j.id===L[1]||typeof j.getAttributeNode<"u"&&j.getAttributeNode("id").nodeValue===L[1]?[j]:void 0:[]}},d.filter.ID=function(L,T){var A=typeof L.getAttributeNode<"u"&&L.getAttributeNode("id");return L.nodeType===1&&A&&A.nodeValue===T}),M.removeChild(g),M=g=null})(),(function(){var g=document.createElement("div");g.appendChild(document.createComment("")),g.getElementsByTagName("*").length>0&&(d.find.TAG=function(v,M){var L=M.getElementsByTagName(v[1]);if(v[1]==="*"){for(var T=[],A=0;L[A];A++)L[A].nodeType===1&&T.push(L[A]);L=T}return L}),g.innerHTML="<a href='#'></a>",g.firstChild&&typeof g.firstChild.getAttribute<"u"&&g.firstChild.getAttribute("href")!=="#"&&(d.attrHandle.href=function(v){return v.getAttribute("href",2)}),g=null})(),document.querySelectorAll&&(function(){var g=s,v=document.createElement("div"),M="__sizzle__";if(v.innerHTML="<p class='TEST'></p>",!(v.querySelectorAll&&v.querySelectorAll(".TEST").length===0)){s=function(T,A,j,k){if(A=A||document,!k&&!s.isXML(A)){var U=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(T);if(U&&(A.nodeType===1||A.nodeType===9)){if(U[1])return m(A.getElementsByTagName(T),j);if(U[2]&&d.find.CLASS&&A.getElementsByClassName)return m(A.getElementsByClassName(U[2]),j)}if(A.nodeType===9){if(T==="body"&&A.body)return m([A.body],j);if(U&&U[3]){var _=A.getElementById(U[3]);if(_&&_.parentNode){if(_.id===U[3])return m([_],j)}else return m([],j)}try{return m(A.querySelectorAll(T),j)}catch{}}else if(A.nodeType===1&&A.nodeName.toLowerCase()!=="object"){var Q=A,W=A.getAttribute("id"),F=W||M,p=A.parentNode,D=/^\s*[+~]/.test(T);W?F=F.replace(/'/g,"\\$&"):A.setAttribute("id",F),D&&p&&(A=A.parentNode);try{if(!D||p)return m(A.querySelectorAll("[id='"+F+"'] "+T),j)}catch{}finally{W||Q.removeAttribute("id")}}}return g(T,A,j,k)};for(var L in g)s[L]=g[L];v=null}})(),(function(){var g=document.documentElement,v=g.matchesSelector||g.mozMatchesSelector||g.webkitMatchesSelector||g.msMatchesSelector;if(v){var M=!v.call(document.createElement("div"),"div"),L=!1;try{v.call(document.documentElement,"[test!='']:sizzle")}catch{L=!0}s.matchesSelector=function(T,A){if(A=A.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']"),!s.isXML(T))try{if(L||!d.match.PSEUDO.test(A)&&!/!=/.test(A)){var j=v.call(T,A);if(j||!M||T.document&&T.document.nodeType!==11)return j}}catch{}return s(A,null,null,[T]).length>0}}})(),(function(){var g=document.createElement("div");g.innerHTML="<div class='test e'></div><div class='test'></div>",!(!g.getElementsByClassName||g.getElementsByClassName("e").length===0)&&(g.lastChild.className="e",g.getElementsByClassName("e").length!==1&&(d.order.splice(1,0,"CLASS"),d.find.CLASS=function(v,M,L){if(typeof M.getElementsByClassName<"u"&&!L)return M.getElementsByClassName(v[1])},g=null))})();function P(g,v,M,L,T,A){for(var j=0,k=L.length;j<k;j++){var U=L[j];if(U){var _=!1;for(U=U[g];U;){if(U.sizcache===M){_=L[U.sizset];break}if(U.nodeType===1&&!A&&(U.sizcache=M,U.sizset=j),U.nodeName.toLowerCase()===v){_=U;break}U=U[g]}L[j]=_}}}function N(g,v,M,L,T,A){for(var j=0,k=L.length;j<k;j++){var U=L[j];if(U){var _=!1;for(U=U[g];U;){if(U.sizcache===M){_=L[U.sizset];break}if(U.nodeType===1){if(A||(U.sizcache=M,U.sizset=j),typeof v!="string"){if(U===v){_=!0;break}}else if(s.filter(v,[U]).length>0){_=U;break}}U=U[g]}L[j]=_}}}document.documentElement.contains?s.contains=function(g,v){return g!==v&&(g.contains?g.contains(v):!0)}:document.documentElement.compareDocumentPosition?s.contains=function(g,v){return!!(g.compareDocumentPosition(v)&16)}:s.contains=function(){return!1},s.isXML=function(g){var v=(g?g.ownerDocument||g:0).documentElement;return v?v.nodeName!=="HTML":!1};var R=function(g,v){for(var M,L=[],T="",A=v.nodeType?[v]:v;M=d.match.PSEUDO.exec(g);)T+=M[0],g=g.replace(d.match.PSEUDO,"");g=d.relative[g]?g+"*":g;for(var j=0,k=A.length;j<k;j++)s(g,A[j],L);return s.filter(T,L)};window.Sizzle=s})(),Prototype._original_property=window.Sizzle,(function(e){var t=Prototype.Selector.extendElements;function r(n,o){return t(e(n,o||document))}function a(n,o){return e.matches(o,[n]).length==1}Prototype.Selector.engine=e,Prototype.Selector.select=r,Prototype.Selector.match=a})(Sizzle),window.Sizzle=Prototype._original_property,delete Prototype._original_property;var Form={reset:function(e){return e=$(e),e.reset(),e},serializeElements:function(e,t){typeof t!="object"?t={hash:!!t}:Object.isUndefined(t.hash)&&(t.hash=!0);var r,a,n=!1,o=t.submit,u,s;return t.hash?(s={},u=function(d,c,f){return c in d?(Object.isArray(d[c])||(d[c]=[d[c]]),d[c].push(f)):d[c]=f,d}):(s="",u=function(d,c,f){return f=f.gsub(/(\r)?\n/,`\r
`),f=encodeURIComponent(f),f=f.gsub(/%20/,"+"),d+(d?"&":"")+encodeURIComponent(c)+"="+f}),e.inject(s,function(d,c){return!c.disabled&&c.name&&(r=c.name,a=$(c).getValue(),a!=null&&c.type!="file"&&(c.type!="submit"||!n&&o!==!1&&(!o||r==o)&&(n=!0))&&(d=u(d,r,a))),d})}};Form.Methods={serialize:function(e,t){return Form.serializeElements(Form.getElements(e),t)},getElements:function(e){for(var t=$(e).getElementsByTagName("*"),r,a=[],n=Form.Element.Serializers,o=0;r=t[o];o++)n[r.tagName.toLowerCase()]&&a.push(Element.extend(r));return a},getInputs:function(e,t,r){e=$(e);var a=e.getElementsByTagName("input");if(!t&&!r)return $A(a).map(Element.extend);for(var n=0,o=[],u=a.length;n<u;n++){var s=a[n];t&&s.type!=t||r&&s.name!=r||o.push(Element.extend(s))}return o},disable:function(e){return e=$(e),Form.getElements(e).invoke("disable"),e},enable:function(e){return e=$(e),Form.getElements(e).invoke("enable"),e},findFirstElement:function(e){var t=$(e).getElements().findAll(function(a){return a.type!="hidden"&&!a.disabled}),r=t.findAll(function(a){return a.hasAttribute("tabIndex")&&a.tabIndex>=0}).sortBy(function(a){return a.tabIndex}).first();return r||t.find(function(a){return/^(?:input|select|textarea)$/i.test(a.tagName)})},focusFirstElement:function(e){e=$(e);var t=e.findFirstElement();return t&&t.activate(),e},request:function(e,t){e=$(e),t=Object.clone(t||{});var r=t.parameters,a=e.readAttribute("action")||"";return a.blank()&&(a=window.location.href),t.parameters=e.serialize(!0),r&&(Object.isString(r)&&(r=r.toQueryParams()),Object.extend(t.parameters,r)),e.hasAttribute("method")&&!t.method&&(t.method=e.method),new Ajax.Request(a,t)}},Form.Element={focus:function(e){return $(e).focus(),e},select:function(e){return $(e).select(),e}},Form.Element.Methods={serialize:function(e){if(e=$(e),!e.disabled&&e.name){var t=e.getValue();if(t!=null){var r={};return r[e.name]=t,Object.toQueryString(r)}}return""},getValue:function(e){e=$(e);var t=e.tagName.toLowerCase();return Form.Element.Serializers[t](e)},setValue:function(e,t){e=$(e);var r=e.tagName.toLowerCase();return Form.Element.Serializers[r](e,t),e},clear:function(e){return $(e).value="",e},present:function(e){return $(e).value!=""},activate:function(e){e=$(e);try{e.focus(),e.select&&(e.tagName.toLowerCase()!="input"||!/^(?:button|reset|submit)$/i.test(e.type))&&e.select()}catch{}return e},disable:function(e){return e=$(e),e.disabled=!0,e},enable:function(e){return e=$(e),e.disabled=!1,e}};var Field=Form.Element,$F=Form.Element.Methods.getValue;Form.Element.Serializers=(function(){function e(s,d){switch(s.type.toLowerCase()){case"checkbox":case"radio":return t(s,d);default:return r(s,d)}}function t(s,d){if(Object.isUndefined(d))return s.checked?s.value:null;s.checked=!!d}function r(s,d){if(Object.isUndefined(d))return s.value;s.value=d}function a(s,d){if(Object.isUndefined(d))return(s.type==="select-one"?n:o)(s);for(var c,f,C=!Object.isArray(d),m=0,E=s.length;m<E;m++)if(c=s.options[m],f=this.optionValue(c),C){if(f==d){c.selected=!0;return}}else c.selected=d.include(f)}function n(s){var d=s.selectedIndex;return d>=0?u(s.options[d]):null}function o(s){var d,c=s.length;if(!c)return null;for(var f=0,d=[];f<c;f++){var C=s.options[f];C.selected&&d.push(u(C))}return d}function u(s){return Element.hasAttribute(s,"value")?s.value:s.text}return{input:e,inputSelector:t,textarea:r,select:a,selectOne:n,selectMany:o,optionValue:u,button:r}})(),Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function(e,t,r,a){e(a,r),this.element=$(t),this.lastValue=this.getValue()},execute:function(){var e=this.getValue();(Object.isString(this.lastValue)&&Object.isString(e)?this.lastValue!=e:String(this.lastValue)!=String(e))&&(this.callback(this.element,e),this.lastValue=e)}}),Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}}),Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}}),Abstract.EventObserver=Class.create({initialize:function(e,t){this.element=$(e),this.callback=t,this.lastValue=this.getValue(),this.element.tagName.toLowerCase()=="form"?this.registerFormCallbacks():this.registerCallback(this.element)},onElementEvent:function(){var e=this.getValue();this.lastValue!=e&&(this.callback(this.element,e),this.lastValue=e)},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(e){if(e.type)switch(e.type.toLowerCase()){case"checkbox":case"radio":Event.observe(e,"click",this.onElementEvent.bind(this));break;default:Event.observe(e,"change",this.onElementEvent.bind(this));break}}}),Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}}),Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}}),(function(e){var t=document.createElement("div"),r=document.documentElement,a="onmouseenter"in r&&"onmouseleave"in r,n={KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45},o=function(H){return!1};window.attachEvent&&(window.addEventListener?o=function(H){return!(H instanceof window.Event)}:o=function(H){return!0});var u;function s(H,z){return H.which?H.which===z+1:H.button===z}var d={0:1,1:4,2:2};function c(H,z){return H.button===d[z]}function f(H,z){switch(z){case 0:return H.which==1&&!H.metaKey;case 1:return H.which==2||H.which==1&&H.metaKey;case 2:return H.which==3;default:return!1}}window.attachEvent?window.addEventListener?u=function(H,z){return o(H)?c(H,z):s(H,z)}:u=c:Prototype.Browser.WebKit?u=f:u=s;function C(H){return u(H,0)}function m(H){return u(H,1)}function E(H){return u(H,2)}function S(H){return Element.extend(P(H))}function P(H){H=n.extend(H);var z=H.target,q=H.type,Z=H.currentTarget;return Z&&Z.tagName&&(q==="load"||q==="error"||q==="click"&&Z.tagName.toLowerCase()==="input"&&Z.type==="radio")&&(z=Z),z.nodeType==Node.TEXT_NODE&&(z=z.parentNode),Element.extend(z)}function N(H,z){var q=P(H),Z=Prototype.Selector.match;if(!z)return Element.extend(q);for(;q;){if(Object.isElement(q)&&Z(q,z))return Element.extend(q);q=q.parentNode}}function R(H){return{x:g(H),y:v(H)}}function g(H){var z=document.documentElement,q=document.body||{scrollLeft:0};return H.pageX||H.clientX+(z.scrollLeft||q.scrollLeft)-(z.clientLeft||0)}function v(H){var z=document.documentElement,q=document.body||{scrollTop:0};return H.pageY||H.clientY+(z.scrollTop||q.scrollTop)-(z.clientTop||0)}function M(H){n.extend(H),H.preventDefault(),H.stopPropagation(),H.stopped=!0}n.Methods={isLeftClick:C,isMiddleClick:m,isRightClick:E,element:S,findElement:N,pointer:R,pointerX:g,pointerY:v,stop:M};var L=Object.keys(n.Methods).inject({},function(H,z){return H[z]=n.Methods[z].methodize(),H});if(window.attachEvent){let H=function(z){var q;switch(z.type){case"mouseover":case"mouseenter":q=z.fromElement;break;case"mouseout":case"mouseleave":q=z.toElement;break;default:return null}return Element.extend(q)};var Ae=H,T={stopPropagation:function(){this.cancelBubble=!0},preventDefault:function(){this.returnValue=!1},inspect:function(){return"[object Event]"}};n.extend=function(z,q){if(!z)return!1;if(!o(z)||z._extendedByPrototype)return z;z._extendedByPrototype=Prototype.emptyFunction;var Z=n.pointer(z);return Object.extend(z,{target:z.srcElement||q,relatedTarget:H(z),pageX:Z.x,pageY:Z.y}),Object.extend(z,L),Object.extend(z,T),z}}else n.extend=Prototype.K;window.addEventListener&&(n.prototype=window.Event.prototype||document.createEvent("HTMLEvents").__proto__,Object.extend(n.prototype,L));var A={mouseenter:"mouseover",mouseleave:"mouseout"};function j(H){return A[H]||H}a&&(j=Prototype.K);function k(H){return H===window?0:(typeof H._prototypeUID>"u"&&(H._prototypeUID=Element.Storage.UID++),H._prototypeUID)}function U(H){return H===window?0:H==document?1:H.uniqueID}"uniqueID"in t&&(k=U);function _(H){return H.include(":")}n._isCustomEvent=_;function Q(H,z){var q=e.Event.cache;return Object.isUndefined(z)&&(z=k(H)),q[z]||(q[z]={element:H}),q[z]}function W(H,z){Object.isUndefined(z)&&(z=k(H)),delete e.Event.cache[z]}function F(H,z,q){var Z=Q(H);Z[z]||(Z[z]=[]);for(var B=Z[z],X=B.length;X--;)if(B[X].handler===q)return null;var ie=k(H),ee=e.Event._createResponder(ie,z,q),le={responder:ee,handler:q};return B.push(le),le}function p(H,z,q){var Z=Q(H),B=Z[z];if(B){for(var X=B.length,ie;X--;)if(B[X].handler===q){ie=B[X];break}if(ie){var ee=B.indexOf(ie);return B.splice(ee,1),ie}}}function D(H,z,q){H=$(H);var Z=F(H,z,q);if(Z===null)return H;var B=Z.responder;return _(z)?G(H,z,B):O(H,z,B),H}function O(H,z,q){var Z=j(z);H.addEventListener?H.addEventListener(Z,q,!1):H.attachEvent("on"+Z,q)}function G(H,z,q){H.addEventListener?H.addEventListener("dataavailable",q,!1):(H.attachEvent("ondataavailable",q),H.attachEvent("onlosecapture",q))}function V(H,z,q){H=$(H);var Z=!Object.isUndefined(q),B=!Object.isUndefined(z);if(!B&&!Z)return re(H),H;if(!Z)return ne(H,z),H;var X=p(H,z,q);return X&&K(H,z,X.responder),H}function te(H,z,q){var Z=j(z);H.removeEventListener?H.removeEventListener(Z,q,!1):H.detachEvent("on"+Z,q)}function J(H,z,q){H.removeEventListener?H.removeEventListener("dataavailable",q,!1):(H.detachEvent("ondataavailable",q),H.detachEvent("onlosecapture",q))}function re(H){var z=k(H),q=Q(H,z);W(H,z);var Z,B;for(var X in q)if(X!=="element")for(Z=q[X],B=Z.length;B--;)K(H,X,Z[B].responder)}function ne(H,z){var q=Q(H),Z=q[z];if(Z){delete q[z];for(var B=Z.length;B--;)K(H,z,Z[B].responder)}}function K(H,z,q){_(z)?J(H,z,q):te(H,z,q)}function ue(H){return H!==document?H:document.createEvent&&!H.dispatchEvent?document.documentElement:H}function pe(H,z,q,Z){H=ue($(H)),Object.isUndefined(Z)&&(Z=!0),q=q||{};var B=Ce(H,z,q,Z);return n.extend(B)}function he(H,z,q,Z){var B=document.createEvent("HTMLEvents");return B.initEvent("dataavailable",Z,!0),B.eventName=z,B.memo=q,H.dispatchEvent(B),B}function be(H,z,q,Z){var B=document.createEventObject();return B.eventType=Z?"ondataavailable":"onlosecapture",B.eventName=z,B.memo=q,H.fireEvent(B.eventType,B),B}var Ce=document.createEvent?he:be;n.Handler=Class.create({initialize:function(H,z,q,Z){this.element=$(H),this.eventName=z,this.selector=q,this.callback=Z,this.handler=this.handleEvent.bind(this)},start:function(){return n.observe(this.element,this.eventName,this.handler),this},stop:function(){return n.stopObserving(this.element,this.eventName,this.handler),this},handleEvent:function(H){var z=n.findElement(H,this.selector);z&&this.callback.call(this.element,H,z)}});function ve(H,z,q,Z){return H=$(H),Object.isFunction(q)&&Object.isUndefined(Z)&&(Z=q,q=null),new n.Handler(H,z,q,Z).start()}Object.extend(n,n.Methods),Object.extend(n,{fire:pe,observe:D,stopObserving:V,on:ve}),Element.addMethods({fire:pe,observe:D,stopObserving:V,on:ve}),Object.extend(document,{fire:pe.methodize(),observe:D.methodize(),stopObserving:V.methodize(),on:ve.methodize(),loaded:!1}),e.Event?Object.extend(window.Event,n):e.Event=n,e.Event.cache={};function Ee(){e.Event.cache=null}window.attachEvent&&window.attachEvent("onunload",Ee),t=null,r=null})(this),(function(e){var t=document.documentElement,r="onmouseenter"in t&&"onmouseleave"in t;function a(s){return!r&&(s==="mouseenter"||s==="mouseleave")}function n(s,d,c){return Event._isCustomEvent(d)?o(s,d,c):a(d)?u(s,d,c):function(f){var C=Event.cache[s],m=C.element;Event.extend(f,m),c.call(m,f)}}function o(s,d,c){return function(f){var C=Event.cache[s],m=C.element;if(Object.isUndefined(f.eventName)||f.eventName!==d)return!1;Event.extend(f,m),c.call(m,f)}}function u(s,d,c){return function(f){var C=Event.cache[s],m=C.element;Event.extend(f,m);for(var E=f.relatedTarget;E&&E!==m;)try{E=E.parentNode}catch{E=m}E!==m&&c.call(m,f)}}e.Event._createResponder=n,t=null})(this),(function(e){var t;function r(){document.loaded||(t&&window.clearTimeout(t),document.loaded=!0,document.fire("dom:loaded"))}function a(){document.readyState==="complete"&&(document.detachEvent("onreadystatechange",a),r())}function n(){try{document.documentElement.doScroll("left")}catch{t=n.defer();return}r()}document.addEventListener?document.addEventListener("DOMContentLoaded",r,!1):(document.attachEvent("onreadystatechange",a),window==top&&(t=n.defer())),Event.observe(window,"load",r)})(this),Element.addMethods(),Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;var Insertion={Before:function(e,t){return Element.insert(e,{before:t})},Top:function(e,t){return Element.insert(e,{top:t})},Bottom:function(e,t){return Element.insert(e,{bottom:t})},After:function(e,t){return Element.insert(e,{after:t})}},$continue=new Error('"throw $continue" is deprecated, use "return" instead'),Position={includeScrollOffsets:!1,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0,this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},within:function(e,t,r){return this.includeScrollOffsets?this.withinIncludingScrolloffsets(e,t,r):(this.xcomp=t,this.ycomp=r,this.offset=Element.cumulativeOffset(e),r>=this.offset[1]&&r<this.offset[1]+e.offsetHeight&&t>=this.offset[0]&&t<this.offset[0]+e.offsetWidth)},withinIncludingScrolloffsets:function(e,t,r){var a=Element.cumulativeScrollOffset(e);return this.xcomp=t+a[0]-this.deltaX,this.ycomp=r+a[1]-this.deltaY,this.offset=Element.cumulativeOffset(e),this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+e.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+e.offsetWidth},overlap:function(e,t){if(!e)return 0;if(e=="vertical")return(this.offset[1]+t.offsetHeight-this.ycomp)/t.offsetHeight;if(e=="horizontal")return(this.offset[0]+t.offsetWidth-this.xcomp)/t.offsetWidth},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(e){return Position.prepare(),Element.absolutize(e)},relativize:function(e){return Position.prepare(),Element.relativize(e)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(e,t,r){return r=r||{},Element.clonePosition(t,e,r)}};document.getElementsByClassName||(document.getElementsByClassName=(function(e){function t(r){return r.blank()?null:"[contains(concat(' ', @class, ' '), ' "+r+" ')]"}return e.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(r,a){a=a.toString().strip();var n=/\s/.test(a)?$w(a).map(t).join(""):t(a);return n?document._getElementsByXPath(".//*"+n,r):[]}:function(r,a){a=a.toString().strip();var n=[],o=/\s/.test(a)?$w(a):null;if(!o&&!a)return n;var u=$(r).getElementsByTagName("*");a=" "+a+" ";for(var s=0,d,c;d=u[s];s++)d.className&&(c=" "+d.className+" ")&&(c.include(a)||o&&o.all(function(f){return!f.toString().blank()&&c.include(" "+f+" ")}))&&n.push(Element.extend(d));return n},function(r,a){return $(a||document.body).getElementsByClassName(r)}})(Element.Methods)),Element.ClassNames=Class.create(),Element.ClassNames.prototype={initialize:function(e){this.element=$(e)},_each:function(e,t){this.element.className.split(/\s+/).select(function(r){return r.length>0})._each(e,t)},set:function(e){this.element.className=e},add:function(e){this.include(e)||this.set($A(this).concat(e).join(" "))},remove:function(e){this.include(e)&&this.set($A(this).without(e).join(" "))},toString:function(){return $A(this).join(" ")}},Object.extend(Element.ClassNames.prototype,Enumerable),(function(){window.Selector=Class.create({initialize:function(e){this.expression=e.strip()},findElements:function(e){return Prototype.Selector.select(this.expression,e)},match:function(e){return Prototype.Selector.match(e,this.expression)},toString:function(){return this.expression},inspect:function(){return"#<Selector: "+this.expression+">"}}),Object.extend(Selector,{matchElements:function(e,t){for(var r=Prototype.Selector.match,a=[],n=0,o=e.length;n<o;n++){var u=e[n];r(u,t)&&a.push(Element.extend(u))}return a},findElement:function(e,t,r){r=r||0;for(var a=0,n,o=0,u=e.length;o<u;o++)if(n=e[o],Prototype.Selector.match(n,t)&&r===a++)return Element.extend(n)},findChildElements:function(e,t){var r=t.toArray().join(", ");return Prototype.Selector.select(r,e||document)}})})();function Dom(){}Dom.getEvent=function(t){if(!t)var t=window.event;return t},Dom.getObject=function(e){return e.currentTarget?e.currentTarget:event.srcElement},Dom.removeObject=function(e){e?.parentNode.removeChild(e)},Dom.x=function(e){return e.pageX?e.pageX:e.x},Dom.y=function(e){return e.pageY?e.pageY:e.y},Dom.left=function(e){return e.offsetLeft==0&&e.offsetTop==0?e.style.left.substr(0,e.style.left.length-2):e.offsetLeft},Dom.top=function(e){return e.offsetLeft==0&&e.offsetTop==0?e.style.top.substr(0,e.style.top.length-2):e.offsetTop},Dom.cornerX=function(e){return e.layerX?Dom.x(e)-e.layerX:Dom.x(e)-e.offsetX},Dom.cornerY=function(e){return e.layerY?Dom.y(e)-e.layerY:Dom.y(e)-e.offsetY},Dom.setClass=function(e,t){e.setAttribute("class",t),e.setAttribute("className",t)},Dom.setStyle=function(e,t){e.setAttribute("style",t),e.style.cssText=t},Dom.setDisplay=function(e,t){var r=document.getElementById(e);r!=null&&(r.style.display=t)},Dom.attachEvent=function(e,t,r){e.attachEvent?e.attachEvent("on"+t,r):e.addEventListener&&e.addEventListener(t,r,!0)},Dom.getElementsByName=function(e,t){var r=document.getElementsByTagName(e),a=new Array;for(i=0,iarr=0;i<r.length;i++)att=r[i].getAttribute("name"),att==t&&(a[iarr]=r[i],iarr++);return a},Dom.is_child_of=function(e,t){if(t!=null)try{for(;t.parentNode;)if((t=t.parentNode)==e)return!0}catch(r){Debugger.log("Unable to ask is_child_of: "+r)}return!1},Dom.divMouseEvent=function(element,event,JavaScript_code){var current_mouse_target=null;event.toElement?current_mouse_target=event.toElement:event.relatedTarget&&(current_mouse_target=event.relatedTarget),!Dom.is_child_of(element,current_mouse_target)&&element!=current_mouse_target&&eval(JavaScript_code)},Ajax=new Object,Ajax.isSending=!1,Ajax.queue=[],Ajax.waitUntilReady=function(){if(!Ajax.isSending&&Ajax.queue.length>0){Ajax.isSending=!0;var e=Ajax.queue[0];e.go(),Ajax.queue.splice(0,1)}Ajax.queue.length>0&&setTimeout("Ajax.waitUntilReady()",100)},Ajax.createHttp=function(){for(var e=0;e<httpFactories.length;e++)try{return httpFactories[e]()}catch{continue}return!1},Ajax.sendRequest=function(e,t,r){var a=new AjaxSender(e,t,r);Ajax.queue.push(a),Ajax.waitUntilReady()},Ajax.defaultAjaxHandle=function(e){var t=e.responseText;alert(t)};var httpFactories=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];function AjaxSender(e,t,r){this.url=e,this.callback=t,this.postData=r,this.go=function(){var a=this.url,n=this.callback,o=this.postData;if(http=Ajax.createHttp(),!!http){var u=o?"POST":"GET";n=n||Ajax.defaultAjaxHandle,http.open(u,a,!0),o&&http.setRequestHeader("Content-type","application/x-www-form-urlencoded"),http.onreadystatechange=function(){http.readyState==4&&(http.status!=200&&http.status!=304||(n(http),Ajax.isSending=!1))},http.readyState!=4&&http.send(o)}}}function roundTo(e,t){var r=Math.pow(10,t);return t>0,Math.round(e/r)*r}String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.ltrim=function(){return this.replace(/^\s+/,"")},String.prototype.rtrim=function(){return this.replace(/\s+$/,"")};function trim(e){return e.replace(/^\s+|\s+$/g,"")}function format(e){for(var t=e,r="";t!=r;){r=t;for(var a=1;a<arguments.length;a++)t=t.replace("{"+(a-1)+"}",arguments[a])}return t}function formatOnce(e){for(var t=e,r=1;r<arguments.length;r++)t=t.replace("{"+(r-1)+"}",arguments[r]);return t}Json=new Object,Json.toObject=function(jsonText){return jsonText==""?null:(eval(format("var data = {0};",jsonText)),data)},Json.toString=function(e,t,r){typeof t>"u"&&(t=null),typeof r>"u"&&(r=!0);var a="";for(var n in e){var o=e[n];if(!((""+o).startsWith("function")||o==null))if(a.length>0&&(a+=","),Json.isObject(o))a+=Json.toString(o,n,!1);else if(Json.isArray(o)){a+=format('"{0}" : [',n);for(var u=0;u<o.length;u++)u>0&&(a+=","),a+=Json.toString(o[u],null,!0);a+="]"}else a+=format('"{0}" : "{1}"',n,e[n])}return t!=null&&(a=format('"{0}" : {{1}}',t,a)),r&&(a=format("{{0}}",a)),a},Json.isObject=function(e){return typeof e=="object"&&!Json.isArray(e)},Json.isArray=function(e){return e.constructor.toString().indexOf("Array")!=-1},Debugger=new Object,Debugger.inspect=function(e){var t="";for(var r in e)(""+e[r]).startsWith("function")||(t+=typeof e+"."+r+"="+e[r]+`
`);alert(t)},Debugger.log=function(e){console.log(e)};/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */eval((function(e,t,n,r,o,a){if(o=function(s){return(s<t?"":o(parseInt(s/t)))+((s=s%t)>35?String.fromCharCode(s+29):s.toString(36))},!"".replace(/^/,String)){for(;n--;)a[o(n)]=r[n]||o(n);r=[function(s){return a[s]}],o=function(){return"\\w+"},n=1}for(;n--;)r[n]&&(e=e.replace(new RegExp("\\b"+o(n)+"\\b","g"),r[n]));return e})(`f(!1o.31){p 31=h(){p l={5S:{"1e-1c":"","73-2E":1,"2a-1P":u,"1I":u,"6T-6S":U,"1F-1P":4,"5F":O,"5x":U,"1q":U,"5v":O,"6i-6p":U,"6J":O},Q:{5D:u,5i:16,5k:16,7P:O,7I:"5L",1b:{4e:"91 1i",3Y:"92 1i",5l:"93 90 6K",6X:"8Z I 8W 1X 8X 6K 8Y",3u:"3u",6h:"?",1u:"31\\n\\n",5Z:"94't 95 7J C: ",7z:"9b 9c't 9a C 2j-2n 99: ",6B:"<!96 2j 97 \\"-//98//8b 8V 1.0 8U//8I\\" \\"2y://7A.7E.7o/8J/86/8b/86-8K.8H\\"><2j 8G=\\"2y://7A.7E.7o/8D/8E\\"><70><8F 2y-8L=\\"8M-8S\\" 5h=\\"2c/2j; 8T=8R-8\\" /><36>8Q 31</36></70><2R 1f=\\"2a-7T:8N,'7h 8O 8P',7h,7L;9d-53:#9e;53:#9D;2a-1P:9E;2c-8i:85;\\"><z 1f=\\"2c-8i:85;5n-4z:9F;\\"><z 1f=\\"2a-7T:9C,9B,9y,8C-7L;2a-1P:9z-9A;\\">31</z><z 1f=\\"2a-1P:.9G;5n-9H:9N;\\"><z>84 2.0.9O (9M 9L 6H)</z><z><a 2q=\\"2y://6a.4a\\" 9I=\\"4P\\" 1f=\\"53:#9J;2c-9K:9x;\\">2y://6a.4a</a></z></z><z>9w I 9k 9l.</z><z>9m 9j-6H 9i 9f.</z></z></2R></2j>"},7j:O},1p:{59:u,3q:u,3o:u,5j:{}},30:{},8a:{9g:/\\/\\*[\\s\\S]*?\\*\\//4M,9h:/\\/\\/.*$/4M,9n:/#.*$/4M,9o:/"(?:\\.|(\\\\\\")|[^\\""\\n])*"/g,9u:/'(?:\\.|(\\\\\\')|[^\\''\\n])*'/g,9v:/"(?:\\.|(\\\\\\")|[^\\""])*"/g,9t:/'(?:\\.|(\\\\\\')|[^\\''])*'/g,3e:/\\w+:\\/\\/[\\w-.\\/?%&=]*/g,9s:{E:/(&1C;|<)\\?=?/g,17:/\\?(&2m;|>)/g},9p:{E:/(&1C;|<)%=?/g,17:/%(&2m;|>)/g},9q:{E:/(&1C;|<)\\s*2n.*?(&2m;|>)/47,17:/(&1C;|<)\\/\\s*2n\\s*(&2m;|>)/47}},1q:{15:h(32){p 38=J.1t("37"),4L=l.1q.77;38.Y="1q";C(p 2N 1X 4L){p 6j=4L[2N],4G=R 6j(32),22=4G.15();32.5E[2N]=4G;f(22==u){1V}f(9r(22)=="9P"){22=l.1q.6C(22,32.1j,2N)}22.Y+="8w "+2N;38.1z(22)}q 38},6C:h(4v,6O,4w){p a=J.1t("a"),5e=a.1f,4F=l.Q,57=4F.5i,5c=4F.5k;a.2q="#"+4w;a.36=4v;a.5P=6O;a.6c=4w;a.1r=4v;f(5z(57)==O){5e.1N=57+"5H"}f(5z(5c)==O){5e.2u=5c+"5H"}a.8q=h(e){8j{l.1q.6f(c,e||1o.6g,c.5P,c.6c)}8m(e){l.B.1u(e.6F)}q O};q a},6f:h(7i,7a,5T,7O,72){p 4Y=l.1p.5j[5T],45;f(4Y==u||(45=4Y.5E[7O])==u){q u}q 45.2h(7i,7a,72)},77:{4e:h(4p){c.15=h(){f(4p.T("5v")!=U){q}q l.Q.1b.4e};c.2h=h(4q,8v,8B){p z=4p.z;4q.71.51(4q);z.Y=z.Y.D("5t","")}},3Y:h(8g){c.15=h(){q l.Q.1b.3Y};c.2h=h(8p,8o,8t){p 33=l.B.3d(8g.5r).D(/</g,"&1C;"),2b=l.B.4y("","4P",8r,8n,"8x=0, 8k=1, 8s=0, 6n=1");33=l.B.2W(33);2b.J.3t("<5L>"+33+"</5L>");2b.J.4N()}},5l:h(4S){p 3x,8y,5M=4S.1j;c.15=h(){p 2A=l.Q;f(2A.5D==u){q u}h 1L(5C){p 5s="";C(p 5A 1X 5C){5s+="<8z 1c='"+5A+"' 1W='"+5C[5A]+"'/>"}q 5s};h 2p(43){p 5p="";C(p 5o 1X 43){5p+=" "+5o+"='"+43[5o]+"'"}q 5p};p 48={1N:2A.5i,2u:2A.5k,1j:5M+"ai",6z:"bu/x-74-79",36:l.Q.1b.5l},46={bl:"bm",bx:"bA",bz:"5P="+5M,bF:"O"},4t=2A.5D,35;f(/aQ/i.1R(61.6b)){35="<8h"+2p({aT:"bd:bf-b9-b5-b4-b7",b8:"2y://ba.be.4a/bb/74/bc/79/b3.b2#84=9,0,0,0"})+2p(48)+">"+1L(46)+1L({aU:4t})+"</8h>"}F{35="<aS"+2p(48)+2p(46)+2p({aR:4t})+"/>"}3x=J.1t("z");3x.1r=35;q 3x};c.2h=h(aV,aW,4R){p 68=4R.b1;6V(68){2J"7C":p 5d=l.B.2W(l.B.3d(4S.5r).D(/&1C;/g,"<").D(/&2m;/g,">").D(/&b0;/g,"&"));f(1o.6e){1o.6e.aZ("2c",5d)}F{q l.B.2W(5d)}2J"aX":l.B.1u(l.Q.1b.6X);2B;2J"aY":l.B.1u(4R.6F);2B}}},bh:h(4I){c.15=h(){q l.Q.1b.3u};c.2h=h(bg,by,bB){p 25=J.1t("bG"),1J=u;f(l.1p.3o!=u){J.2R.51(l.1p.3o)}l.1p.3o=25;25.1f.bC="bE:bD;1N:6m;2u:6m;E:-6l;4z:-6l;";J.2R.1z(25);1J=25.4J.J;6t(1J,1o.J);1J.3t("<z 1e=\\""+4I.z.Y.D("5t","")+" bn\\">"+4I.z.1r+"</z>");1J.4N();25.4J.4A();25.4J.3u();h 6t(6A,6s){p 2S=6s.7M("4K");C(p i=0;i<2S.v;i++){f(2S[i].6r.bk()=="6q"&&/bi\\.12$/.1R(2S[i].2q)){6A.3t("<4K 6z=\\"2c/12\\" 6r=\\"6q\\" 2q=\\""+2S[i].2q+"\\"></4K>")}}}}},bj:h(bo){c.15=h(){q l.Q.1b.6h};c.2h=h(bv,bt){p 2b=l.B.4y("","4P",bq,bs,"6n=0"),1J=2b.J;1J.3t(l.Q.1b.6B);1J.4N();2b.4A()}}}},B:{5m:h(6R){q 6R+3z.aN(3z.aa()*ab).2f()},5u:h(4E,4x){p 3l={},1S;C(1S 1X 4E){3l[1S]=4E[1S]}C(1S 1X 4x){3l[1S]=4x[1S]}q 3l},7w:h(4u){6V(4u){2J"U":q U;2J"O":q O}q 4u},4y:h(3e,6M,4D,4C,2I){p x=(6N.1N-4D)/2,y=(6N.2u-4C)/2;2I+=", E="+x+", 4z="+y+", 1N="+4D+", 2u="+4C;2I=2I.D(/^,/,"");p 4Q=1o.9Q(3e,6M,2I);4Q.4A();q 4Q},78:h(1A,29,23){f(1A.6D){1A["e"+29+23]=23;1A[29+23]=h(){1A["e"+29+23](1o.6g)};1A.6D("a6"+29,1A[29+23])}F{1A.a7(29,23,O)}},1u:h(A){1u(l.Q.1b.1u+A)},4c:h(5a,5Y){p 2k=l.1p.59,3j=u;f(2k==u){2k={};C(p 55 1X l.30){p 3g=l.30[55].ac;f(3g==u){1V}C(p i=0;i<3g.v;i++){2k[3g[i]]=55}}l.1p.59=2k}3j=l.30[2k[5a]];f(3j==u&&5Y!=O){l.B.1u(l.Q.1b.5Z+5a)}q 3j},42:h(A,60){p 2T=A.21("\\n");C(p i=0;i<2T.v;i++){2T[i]=60(2T[i])}q 2T.4h("\\n")},6x:h(){p z=J.1t("z"),3h=J.1t("z"),6d=10,i=1;28(i<=aO){f(i%6d===0){z.1r+=i;i+=(i+"").v}F{z.1r+="&ah;";i++}}3h.Y="5F 2E";3h.1z(z);q 3h},6U:h(A){q A.D(/^[ ]*[\\n]+|[\\n]*[ ]*$/g,"")},7d:h(A){p 3i,4V={},5b=R M("^\\\\[(?<54>(.*?))\\\\]$"),69=R M("(?<1c>[\\\\w-]+)"+"\\\\s*:\\\\s*"+"(?<1W>"+"[\\\\w-%#]+|"+"\\\\[.*?\\\\]|"+"\\".*?\\"|"+"'.*?'"+")\\\\s*;?","g");28((3i=69.N(A))!=u){p 2g=3i.1W.D(/^['"]|['"]$/g,"");f(2g!=u&&5b.1R(2g)){p m=5b.N(2g);2g=m.54.v>0?m.54.21(/\\s*,\\s*/):[]}4V[3i.1c]=2g}q 4V},80:h(A,12){f(A==u||A.v==0||A=="\\n"){q A}A=A.D(/</g,"&1C;");A=A.D(/ {2,}/g,h(m){p 4U="";C(p i=0;i<m.v-1;i++){4U+="&1O;"}q 4U+" "});f(12!=u){A=l.B.42(A,h(2i){f(2i.v==0){q""}p 3k="";2i=2i.D(/^(&1O;| )+/,h(s){3k=s;q""});f(2i.v==0){q 3k}q 3k+"<I 1e=\\""+12+"\\">"+2i+"</I>"})}q A},7f:h(66,67){p 2Z=66.2f();28(2Z.v<67){2Z="0"+2Z}q 2Z},5y:h(){p 3b=J.1t("z"),3f,3a=0,52=J.2R,1j=l.B.5m("5y"),2O="<z 1e=\\"",2Q="</z>",4W="</1T>";3b.1r=2O+"6L\\">"+2O+"26\\">"+2O+"2E\\">"+2O+"5h"+"\\"><1T 1e=\\"7V\\"><1T 1j=\\""+1j+"\\">&1O;"+4W+4W+2Q+2Q+2Q+2Q;52.1z(3b);3f=J.a5(1j);f(/a4/i.1R(61.6b)){p 5Q=1o.9V(3f,u);3a=7l(5Q.9W("1N"))}F{3a=3f.9U}52.51(3b);q 3a},6Q:h(7R,6Y){p 1F="";C(p i=0;i<6Y;i++){1F+=" "}q 7R.D(/\\t/g,1F)},6P:h(2P,41){p 9T=2P.21("\\n"),1F="\\t",5f="";C(p i=0;i<50;i++){5f+="                    "}h 7X(3c,18,7Z){q 3c.1M(0,18)+5f.1M(0,7Z)+3c.1M(18+1,3c.v)};2P=l.B.42(2P,h(20){f(20.1h(1F)==-1){q 20}p 18=0;28((18=20.1h(1F))!=-1){p 7U=41-18%41;20=7X(20,18,7U)}q 20});q 2P},3d:h(A){q(l.Q.7P==U)?A.D(/<br\\s*\\/?>|&1C;br\\s*\\/?&2m;/47,"\\n"):A},3P:h(A){q A.D(/\\s*$/g,"").D(/^\\s*/,"")},2W:h(A){p 1Q=l.B.3d(A).21("\\n"),9X=R 5B(),7S=/^\\s*/,24=9Y;C(p i=0;i<1Q.v&&24>0;i++){p 3V=1Q[i];f(l.B.3P(3V).v==0){1V}p 3S=7S.N(3V);f(3S==u){q A}24=3z.24(3S[0].v,24)}f(24>0){C(p i=0;i<1Q.v;i++){1Q[i]=1Q[i].1M(24)}}q 1Q.4h("\\n")},7B:h(2L,2K){f(2L.H<2K.H){q-1}F{f(2L.H>2K.H){q 1}F{f(2L.v<2K.v){q-1}F{f(2L.v>2K.v){q 1}}}}q 0},2D:h(8d,2G){h 8e(3W,81){q[R l.4i(3W[0],3W.H,81.12)]};p a2=0,3X=u,3y=[],8c=2G.4m?2G.4m:8e;28((3X=2G.3D.N(8d))!=u){3y=3y.2H(8c(3X,2G))}q 3y},6o:h(8f){q 8f.D(l.8a.3e,h(m){q"<a 2q=\\""+m+"\\">"+m+"</a>"})}},1I:h(7c,4l){h 88(4s){p 49=[];C(p i=0;i<4s.v;i++){49.K(4s[i])}q 49};p 3m=4l?[4l]:88(J.7M(l.Q.7I)),7g="1r",2t=u;f(3m.v===0){q}C(p i=0;i<3m.v;i++){p 2F=3m[i],2s=l.B.7d(2F.Y),2Y;2s=l.B.5u(7c,2s);2Y=2s["7J"];f(2Y==u){1V}f(2s["2j-2n"]=="U"){2t=R l.44(2Y)}F{p 4o=l.B.4c(2Y);f(4o){2t=R 4o()}F{1V}}2t.1I(2F[7g],2s);p 2l=2t.z;f(l.Q.7j){2l=J.1t("a0");2l.1W=2t.z.1r;2l.1f.1N="aj";2l.1f.2u="aE"}2F.71.aF(2l,2F)}},aD:h(76){l.B.78(1o,"aC",h(){l.1I(76)})}};l.4i=h(4j,75,12){c.1W=4j;c.H=75;c.v=4j.v;c.12=12};l.4i.Z.2f=h(){q c.1W};l.44=h(4g){p 1H=l.B.4c(4g),4f=R l.30.aA(),aB=u;f(1H==u){q}1H=R 1H();c.4X=4f;f(1H.3K==u){l.B.1u(l.Q.1b.7z+4g);q}4f.4B.K({3D:1H.3K.I,4m:7F});h 39(4d,7G){C(p j=0;j<4d.v;j++){4d[j].H+=7G}};h 7F(14,aH){p 7x=14.I,1E=[],4k=1H.4B,7p=14.H+14.E.v,2X=1H.3K,1n;C(p i=0;i<4k.v;i++){1n=l.B.2D(7x,4k[i]);39(1n,7p);1E=1E.2H(1n)}f(2X.E!=u&&14.E!=u){1n=l.B.2D(14.E,2X.E);39(1n,14.H);1E=1E.2H(1n)}f(2X.17!=u&&14.17!=u){1n=l.B.2D(14.17,2X.17);39(1n,14.H+14[0].aM(14.17));1E=1E.2H(1n)}q 1E}};l.44.Z.1I=h(7u,7t){c.4X.1I(7u,7t);c.z=c.4X.z};l.87=h(){};l.87.Z={T:h(7v,7n){p 5J=c.1L[7v];q l.B.7w(5J==u?7n:5J)},15:h(7y){q J.1t(7y)},7m:h(5G){C(p i=0;i<c.1Y.v;i++){p 2V=c.1Y[i];f(2V===u){1V}f((5G.H>2V.H)&&(5G.H<2V.H+2V.v)){q U}}q O},6v:h(3v,7D){p 2e=[];f(3v!=u){C(p i=0;i<3v.v;i++){2e=2e.2H(l.B.2D(7D,3v[i]))}}2e=2e.aL(l.B.7B);q 2e},6u:h(){C(p i=0;i<c.1Y.v;i++){f(c.7m(c.1Y[i])){c.1Y[i]=u}}},6k:h(2C){p 3w=2C.21(/\\n/g),3s=7l(c.T("73-2E")),7e=(3s+3w.v).2f().v,89=c.T("1I",[]);2C="";C(p i=0;i<3w.v;i++){p 1s=3w[i],2w=/^(&1O;|\\s)+/.N(1s),5w="2E aK"+(i%2==0?1:2),82=l.B.7f(3s+i,7e),83=89.1h((3s+i).2f())!=-1,1D=u;f(2w!=u){1D=2w[0].2f();1s=1s.1M(1D.v);1D=1D.D(/&1O;/g," ");2w=l.1p.3q*1D.v}F{2w=0}1s=l.B.3P(1s);f(1s.v==0){1s="&1O;"}f(83){5w+=" aI"}2C+="<z 1e=\\""+5w+"\\">"+"<I 1e=\\"aJ\\">"+82+".</I>"+"<1T 1e=\\"5h\\">"+(1D!=u?"<I 1e=\\"az\\">"+1D.D(/\\s/g,"&1O;")+"</I>":"")+"<1T 1e=\\"7V\\" 1f=\\"5n-E: "+2w+"5H !aq;\\">"+1s+"</1T>"+"</1T>"+"</z>"}q 2C},6w:h(5N,5K){p 18=0,3n="",3r=l.B.80;C(p i=0;i<5K.v;i++){p 1y=5K[i];f(1y===u||1y.v===0){1V}3n+=3r(5N.1M(18,1y.H-18),"63")+3r(1y.1W,1y.12);18=1y.H+1y.v}3n+=3r(5N.1M(18),"63");q 3n},1I:h(1g,5R){p am=l.Q,3p=l.1p,z,34;c.1L={};c.z=u;c.26=u;c.I=u;c.2d=u;c.5E={};c.1j=l.B.5m("ar");3p.5j[c.1j]=c;f(1g===u){1g=""}f(3p.3q===u){3p.3q=l.B.5y()}c.1L=l.B.5u(l.5S,5R||{});f(c.T("6J")==U){c.1L.1q=c.1L.5x=O}c.z=z=c.15("37");c.26=c.15("37");c.26.Y="26";z.Y="6L";z.1j=c.1j;f(c.T("5v")){z.Y+=" 5t"}f(c.T("5x")==O){z.Y+=" ax"}z.Y+=" "+c.T("1e-1c");z.1f.av=c.T("2a-1P","");c.5r=1g;c.I=l.B.6U(1g).D(/\\r/g," ");34=c.T("1F-1P");c.I=c.T("6T-6S")==U?l.B.6P(c.I,34):l.B.6Q(c.I,34);c.I=l.B.2W(c.I);f(c.T("1q")){c.2d=c.15("37");c.2d.Y="2d";c.2d.1z(l.1q.15(c));z.1z(c.2d)}f(c.T("5F")){z.1z(l.B.6x())}z.1z(c.26);c.1Y=c.6v(c.4B,c.I);c.6u();1g=c.6w(c.I,c.1Y);1g=c.6k(l.B.3P(1g));f(c.T("6i-6p")){1g=l.B.6o(1g)}c.26.1r=1g},au:h(A){A=A.D(/^\\s+|\\s+$/g,"").D(/\\s+/g,"\\\\b|\\\\b");q"\\\\b"+A+"\\\\b"},at:h(2z){c.3K={E:{3D:2z.E,12:"2n"},17:{3D:2z.17,12:"2n"},I:R M("(?<E>"+2z.E.1i+")"+"(?<I>.*?)"+"(?<17>"+2z.17.1i+")","aw")}}};q l}()}f(!5B.1h){5B.Z.1h=h(5V,3J){3J=3z.as(3J||0,0);C(p i=3J;i<c.v;i++){f(c[i]==5V){q i}}q-1}}f(!1o.M){(h(){p 2v={N:V.Z.N,64:5q.Z.64,D:5q.Z.D,21:5q.Z.21},1G={11:/(?:[^\\\\([#\\s.]+|\\\\(?!k<[\\w$]+>|[65]{[^}]+})[\\S\\s]?|\\((?=\\?(?!#|<[\\w$]+>)))+|(\\()(?:\\?(?:(#)[^)]*\\)|<([$\\w]+)>))?|\\\\(?:k<([\\w$]+)>|[65]{([^}]+)})|(\\[\\^?)|([\\S\\s])/g,al:/(?:[^$]+|\\$(?![1-9$&\`']|{[$\\w]+}))+|\\$(?:([1-9]\\d*|[$&\`'])|{([$\\w]+)})/g,3F:/^(?:\\s+|#.*)+/,3R:/^(?:[?*+]|{\\d+(?:,\\d*)?})/,7H:/&&\\[\\^?/g,7q:/]/g},7N=h(5I,7Y,7K){C(p i=7K||0;i<5I.v;i++){f(5I[i]===7Y){q i}}q-1},7k=/()??/.N("")[1]!==3A,3L={};M=h(1d,1U){f(1d 4T V){f(1U!==3A){3G 62("56't 58 an 6G ao 5X V ap ay")}q 1d.3I()}p 1U=1U||"",7s=1U.1h("s")>-1,7r=1U.1h("x")>-1,4b=O,3C=[],13=[],11=1G.11,G,3N,3O,3E,3B;11.L=0;28(G=2v.N.2x(11,1d)){f(G[2]){f(!1G.3R.1R(1d.19(11.L))){13.K("(?:)")}}F{f(G[1]){3C.K(G[3]||u);f(G[3]){4b=U}13.K("(")}F{f(G[4]){3E=7N(3C,G[4]);13.K(3E>-1?"\\\\"+(3E+1)+(5z(1d.5O(11.L))?"":"(?:)"):G[0])}F{f(G[5]){13.K(3L.6Z?3L.6Z.7C(G[5],G[0].5O(1)==="P"):G[0])}F{f(G[6]){f(1d.5O(11.L)==="]"){13.K(G[6]==="["?"(?!)":"[\\\\S\\\\s]");11.L++}F{3N=M.6E("&&"+1d.19(G.H),1G.7H,1G.7q,"",{5W:"\\\\"})[0];13.K(G[6]+3N+"]");11.L+=3N.v+1}}F{f(G[7]){f(7s&&G[7]==="."){13.K("[\\\\S\\\\s]")}F{f(7r&&1G.3F.1R(G[7])){3O=2v.N.2x(1G.3F,1d.19(11.L-1))[0].v;f(!1G.3R.1R(1d.19(11.L-1+3O))){13.K("(?:)")}11.L+=3O-1}F{13.K(G[7])}}}F{13.K(G[0])}}}}}}}3B=V(13.4h(""),2v.D.2x(1U,/[aG]+/g,""));3B.1v={1i:1d,2o:4b?3C:u};q 3B};M.ak=h(1c,o){3L[1c]=o};V.Z.N=h(A){p 1a=2v.N.2x(c,A),1c,i,5g;f(1a){f(7k&&1a.v>1){5g=R V("^"+c.1i+"$(?!\\\\s)",c.3U());2v.D.2x(1a[0],5g,h(){C(i=1;i<7b.v-2;i++){f(7b[i]===3A){1a[i]=3A}}})}f(c.1v&&c.1v.2o){C(i=1;i<1a.v;i++){1c=c.1v.2o[i-1];f(1c){1a[1c]=1a[i]}}}f(c.3H&&c.L>(1a.H+1a[0].v)){c.L--}}q 1a}})()}V.Z.3U=h(){q(c.3H?"g":"")+(c.9Z?"i":"")+(c.6W?"m":"")+(c.3F?"x":"")+(c.a1?"y":"")};V.Z.3I=h(7Q){p 3T=R M(c.1i,(7Q||"")+c.3U());f(c.1v){3T.1v={1i:c.1v.1i,2o:c.1v.2o?c.1v.2o.19(0):u}}q 3T};V.Z.2x=h(a3,A){q c.N(A)};V.Z.9S=h(9R,7W){q c.N(7W[0])};M.3Z=h(4r,4Z){p 40="/"+4r+"/"+(4Z||"");q M.3Z[40]||(M.3Z[40]=R M(4r,4Z))};M.3M=h(A){q A.D(/[-[\\]{}()*+?.\\\\^$|,#\\s]/g,"\\\\$&")};M.6E=h(A,E,W,1k,2M){p 2M=2M||{},2U=2M.5W,X=2M.af,1k=1k||"",4O=1k.1h("g")>-1,6y=1k.1h("i")>-1,5U=1k.1h("m")>-1,4H=1k.1h("y")>-1,1k=1k.D(/y/g,""),E=E 4T V?(E.3H?E:E.3I("g")):R M(E,"g"+1k),W=W 4T V?(W.3H?W:W.3I("g")):R M(W,"g"+1k),1K=[],2r=0,1m=0,1l=0,1x=0,27,1Z,1w,1B,3Q,4n;f(2U){f(2U.v>1){3G ae("56't 58 ag ad 5X 3M 6I")}f(5U){3G 62("56't 58 3M 6I 6G a8 a9 6W aP")}3Q=M.3M(2U);4n=R V("^(?:"+3Q+"[\\\\S\\\\s]|(?:(?!"+E.1i+"|"+W.1i+")[^"+3Q+"])+)+",6y?"i":"")}28(U){E.L=W.L=1l+(2U?(4n.N(A.19(1l))||[""])[0].v:0);1w=E.N(A);1B=W.N(A);f(1w&&1B){f(1w.H<=1B.H){1B=u}F{1w=u}}f(1w||1B){1m=(1w||1B).H;1l=(1w?E:W).L}F{f(!2r){2B}}f(4H&&!2r&&1m>1x){2B}f(1w){f(!2r++){27=1m;1Z=1l}}F{f(1B&&2r){f(!--2r){f(X){f(X[0]&&27>1x){1K.K([X[0],A.19(1x,27),1x,27])}f(X[1]){1K.K([X[1],A.19(27,1Z),27,1Z])}f(X[2]){1K.K([X[2],A.19(1Z,1m),1Z,1m])}f(X[3]){1K.K([X[3],A.19(1m,1l),1m,1l])}}F{1K.K(A.19(1Z,1m))}1x=1l;f(!4O){2B}}}F{E.L=W.L=0;3G b6("bw bp 8l 8u 8A")}}f(1m===1l){1l++}}f(4O&&!4H&&X&&X[0]&&A.v>1x){1K.K([X[0],A.19(1x),1x,A.v])}E.L=W.L=0;q 1K};`,62,725,"||||||||||||this|||if||function||||sh||||var|return||||null|length||||div|str|utils|for|replace|left|else|_109|index|code|document|push|lastIndex|XRegExp|exec|false||config|new||getParam|true|RegExp|_121|vN|className|prototype||part|css|_107|_c3|create||right|pos|slice|_111|strings|name|_101|class|style|_ed|indexOf|source|id|_122|_12d|_12c|_ca|window|vars|toolbar|innerHTML|_e0|createElement|alert|_x|_131|_12e|_ec|appendChild|obj|_132|lt|_e5|_c6|tab|lib|_bd|highlight|doc|_12a|params|substr|width|nbsp|size|_97|test|_4b|span|_102|continue|value|in|matches|_130|_91|split|_8|_57|min|_3c|lines|_12f|while|_56|font|wnd|text|bar|_d7|toString|_6e|execute|_75|html|_5b|_b7|gt|script|captureNames|attributes|href|_12b|_b4|_b1|height|_f8|_e1|call|http|_f4|_28|break|_da|getMatches|line|_b3|_a1|concat|_51|case|m2|m1|_123|_5|_80|_88|_81|body|_40|_62|_124|_d4|unindent|_c9|_b5|_7a|brushes|SyntaxHighlighter|_2|_22|_f2|_32|title|DIV|_3|offsetMatches|_7d|_7b|_8e|fixForBlogger|url|_7c|_5e|_65|_6a|_5c|_76|_4a|_af|_e9|printFrame|_f0|spaceWidth|_ea|_dc|write|print|_d5|_db|_25|_a6|Math|undefined|_10d|_106|regex|_10c|extended|throw|global|addFlags|_f6|htmlScript|_100|escape|cc|len|trim|_133|quantifier|_9d|_116|getNativeFlags|_9c|_a2|_a5|viewSource|cache|key|_89|eachLine|_2c|HtmlScript|_18|_30|gi|_2f|_ad|com|_105|findBrush|_c0|expandSource|_be|_bc|join|Match|_b9|_c7|_ab|func|esc|_b6|_19|_1a|_11b|_ac|swf|_4c|_9|_b|_49|popup|top|focus|regexList|_50|_4f|_48|_e|_7|_129|_38|contentWindow|link|_4|gm|close|_126|_blank|win|_35|_24|instanceof|_73|_6b|_82|xmlBrush|_17|_11c||removeChild|_7e|color|values|_5d|can|_f|supply|discoveredBrushes|_59|_6c|_10|_37|_d|_8c|r2|content|toolbarItemWidth|highlighters|toolbarItemHeight|copyToClipboard|guid|margin|_2e|_2d|String|originalCode|_2a|collapsed|merge|collapse|_e2|gutter|measureSpace|isNaN|_2b|Array|_29|clipboardSwf|toolbarCommands|ruler|_d2|px|_fb|_d0|_e7|pre|_27|_e6|charAt|highlighterId|_83|_ee|defaults|_14|_128|_f5|escapeChar|one|_5a|noBrush|_61|navigator|TypeError|plain|match|pP|_78|_79|_36|_6d|alexgorbatchev|userAgent|commandName|_66|clipboardData|executeCommand|event|help|auto|_6|createDisplayLines|500px|0px|scrollbars|processUrls|links|stylesheet|rel|_3f|copyStyles|removeNestedMatches|findMatches|processMatches|createRuler|_127|type|_3e|aboutDialog|createButton|attachEvent|matchRecursive|message|when|2009|character|light|clipboard|syntaxhighlighter|_4e|screen|_a|processSmartTabs|processTabs|_47|tabs|smart|trimFirstAndLastLines|switch|multiline|copyToClipboardConfirmation|_85|unicode|head|parentNode|_16|first|shockwave|_ba|_b8|items|addEvent|flash|_13|arguments|_aa|parseParams|_dd|padNumber|_b0|Times|_12|debug|_ff|parseInt|isMatchNested|_cf|org|_c8|classRight|_104|_103|_cd|_cc|_ce|toBoolean|_c5|_d1|brushNotHtmlScript|www|matchesSortCallback|get|_d6|w3|process|_c1|classLeft|tagName|brush|_fd|serif|getElementsByTagName|_fa|_15|bloggerMode|_115|_84|_99|family|_93|block|args|insertSpaces|_fc|_90|decorate|_a3|_e3|_e4|version|center|xhtml1|Highlighter|toArray|_de|regexLib|DTD|_a7|_a0|defaultAdd|_a8|_1e|object|align|try|resizable|contains|catch|400|_20|_1f|onclick|750|menubar|_21|unbalanced|_1b|item|location|_26|param|delimiters|_1c|sans|1999|xhtml|meta|xmlns|dtd|EN|TR|transitional|equiv|Content|Georgia|New|Roman|About|utf|Type|charset|Transitional|XHTML|is|your|now|The|to|expand|view|copy|Can|find|DOCTYPE|PUBLIC|W3C|option|configured|Brush|wasn|background|fff|Gorbatchev|multiLineCComments|singleLineCComments|Alex|2004|syntax|highlighter|Copyright|singleLinePerlComments|doubleQuotedString|aspScriptTags|scriptScriptTags|typeof|phpScriptTags|multiLineSingleQuotedString|singleQuotedString|multiLineDoubleQuotedString|JavaScript|none|Helvetica|xx|large|Arial|Geneva|000|1em|3em|75em|bottom|target|0099FF|decoration|01|March|4em|296|string|open|_119|apply|_8a|offsetWidth|getComputedStyle|getPropertyValue|_98|1000|ignoreCase|textarea|sticky|_a4|_117|opera|getElementById|on|addEventListener|using|the|random|1000000|aliases|than|SyntaxError|valueNames|more|middot|_clipboard|70em|addPlugin|replaceVar|_ef|flags|constructing|from|important|highlighter_|max|forHtmlScript|getKeywords|fontSize|sgi|nogutter|another|spaces|Xml|_bf|load|all|30em|replaceChild|sx|_c4|highlighted|number|alt|sort|lastIndexOf|round|150|flag|msie|src|embed|classid|movie|_33|_34|ok|error|setData|amp|command|cab|swflash|96b8|11cf|Error|444553540000|codebase|ae6d|download|pub|cabs|clsid|macromedia|d27cdb6e|_39|printSource|shCore|about|toLowerCase|allowScriptAccess|always|printing|_42|data|500||250|_44|application|_43|subject|wmode|_3a|flashVars|transparent|_3b|cssText|absolute|position|menu|IFRAME".split("|"),0,{}));/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */SyntaxHighlighter.brushes.Alloy=function(){var e="abstract assert assert fact in all else extends module sig String Int one some lone set no ";this.regexList=[{regex:SyntaxHighlighter.regexLib.singleLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.multiLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.doubleQuotedString,css:"string"},{regex:SyntaxHighlighter.regexLib.singleQuotedString,css:"string"},{regex:/\b([\d]+(\.[\d]+)?|0x[a-f0-9]+)\b/gi,css:"value"},{regex:/(?!\@interface\b)\@[\$\w]+\b/g,css:"color1"},{regex:/\@interface\b/g,css:"color2"},{regex:new RegExp(this.getKeywords(e),"gm"),css:"keyword"}],this.forHtmlScript(SyntaxHighlighter.regexLib.aspScriptTags)},SyntaxHighlighter.brushes.Alloy.prototype=new SyntaxHighlighter.Highlighter,SyntaxHighlighter.brushes.Alloy.aliases=["Alloy","alloy","als"];/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */SyntaxHighlighter.brushes.Cpp=function(){var e="ATOM BOOL BOOLEAN BYTE CHAR COLORREF DWORD DWORDLONG DWORD_PTR DWORD32 DWORD64 FLOAT HACCEL HALF_PTR HANDLE HBITMAP HBRUSH HCOLORSPACE HCONV HCONVLIST HCURSOR HDC HDDEDATA HDESK HDROP HDWP HENHMETAFILE HFILE HFONT HGDIOBJ HGLOBAL HHOOK HICON HINSTANCE HKEY HKL HLOCAL HMENU HMETAFILE HMODULE HMONITOR HPALETTE HPEN HRESULT HRGN HRSRC HSZ HWINSTA HWND INT INT_PTR INT32 INT64 LANGID LCID LCTYPE LGRPID LONG LONGLONG LONG_PTR LONG32 LONG64 LPARAM LPBOOL LPBYTE LPCOLORREF LPCSTR LPCTSTR LPCVOID LPCWSTR LPDWORD LPHANDLE LPINT LPLONG LPSTR LPTSTR LPVOID LPWORD LPWSTR LRESULT PBOOL PBOOLEAN PBYTE PCHAR PCSTR PCTSTR PCWSTR PDWORDLONG PDWORD_PTR PDWORD32 PDWORD64 PFLOAT PHALF_PTR PHANDLE PHKEY PINT PINT_PTR PINT32 PINT64 PLCID PLONG PLONGLONG PLONG_PTR PLONG32 PLONG64 POINTER_32 POINTER_64 PSHORT PSIZE_T PSSIZE_T PSTR PTBYTE PTCHAR PTSTR PUCHAR PUHALF_PTR PUINT PUINT_PTR PUINT32 PUINT64 PULONG PULONGLONG PULONG_PTR PULONG32 PULONG64 PUSHORT PVOID PWCHAR PWORD PWSTR SC_HANDLE SC_LOCK SERVICE_STATUS_HANDLE SHORT SIZE_T SSIZE_T TBYTE TCHAR UCHAR UHALF_PTR UINT UINT_PTR UINT32 UINT64 ULONG ULONGLONG ULONG_PTR ULONG32 ULONG64 USHORT USN VOID WCHAR WORD WPARAM WPARAM WPARAM char bool short int __int32 __int64 __int8 __int16 long float double __wchar_t clock_t _complex _dev_t _diskfree_t div_t ldiv_t _exception _EXCEPTION_POINTERS FILE _finddata_t _finddatai64_t _wfinddata_t _wfinddatai64_t __finddata64_t __wfinddata64_t _FPIEEE_RECORD fpos_t _HEAPINFO _HFILE lconv intptr_t jmp_buf mbstate_t _off_t _onexit_t _PNH ptrdiff_t _purecall_handler sig_atomic_t size_t _stat __stat64 _stati64 terminate_function time_t __time64_t _timeb __timeb64 tm uintptr_t _utimbuf va_list wchar_t wctrans_t wctype_t wint_t signed",t="break case catch class const __finally __exception __try const_cast continue private public protected __declspec default delete deprecated dllexport dllimport do dynamic_cast else enum explicit extern if for friend goto inline mutable naked namespace new noinline noreturn nothrow register reinterpret_cast return selectany sizeof static static_cast struct switch template this thread throw true false try typedef typeid typename union using uuid virtual void volatile whcar_t while",n="assert isalnum isalpha iscntrl isdigit isgraph islower isprintispunct isspace isupper isxdigit tolower toupper errno localeconv setlocale acos asin atan atan2 ceil cos cosh exp fabs floor fmod frexp ldexp log log10 modf pow sin sinh sqrt tan tanh jmp_buf longjmp setjmp raise signal sig_atomic_t va_arg va_end va_start clearerr fclose feof ferror fflush fgetc fgetpos fgets fopen fprintf fputc fputs fread freopen fscanf fseek fsetpos ftell fwrite getc getchar gets perror printf putc putchar puts remove rename rewind scanf setbuf setvbuf sprintf sscanf tmpfile tmpnam ungetc vfprintf vprintf vsprintf abort abs atexit atof atoi atol bsearch calloc div exit free getenv labs ldiv malloc mblen mbstowcs mbtowc qsort rand realloc srand strtod strtol strtoul system wcstombs wctomb memchr memcmp memcpy memmove memset strcat strchr strcmp strcoll strcpy strcspn strerror strlen strncat strncmp strncpy strpbrk strrchr strspn strstr strtok strxfrm asctime clock ctime difftime gmtime localtime mktime strftime time";this.regexList=[{regex:SyntaxHighlighter.regexLib.singleLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.multiLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.doubleQuotedString,css:"string"},{regex:SyntaxHighlighter.regexLib.singleQuotedString,css:"string"},{regex:/^ *#.*/gm,css:"preprocessor"},{regex:new RegExp(this.getKeywords(e),"gm"),css:"color1 bold"},{regex:new RegExp(this.getKeywords(n),"gm"),css:"functions bold"},{regex:new RegExp(this.getKeywords(t),"gm"),css:"keyword bold"}]},SyntaxHighlighter.brushes.Cpp.prototype=new SyntaxHighlighter.Highlighter,SyntaxHighlighter.brushes.Cpp.aliases=["cpp","c"];/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */SyntaxHighlighter.brushes.Java=function(){var e="abstract assert boolean break byte case catch char class const continue default do double else enum extends false final finally float for goto if implements import instanceof int interface long native new null package private protected public return short static strictfp super switch synchronized this throw throws true transient try void volatile while";this.regexList=[{regex:SyntaxHighlighter.regexLib.singleLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.multiLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.doubleQuotedString,css:"string"},{regex:SyntaxHighlighter.regexLib.singleQuotedString,css:"string"},{regex:/\b([\d]+(\.[\d]+)?|0x[a-f0-9]+)\b/gi,css:"value"},{regex:/(?!\@interface\b)\@[\$\w]+\b/g,css:"color1"},{regex:/\@interface\b/g,css:"color2"},{regex:new RegExp(this.getKeywords(e),"gm"),css:"keyword"}],this.forHtmlScript(SyntaxHighlighter.regexLib.aspScriptTags)},SyntaxHighlighter.brushes.Java.prototype=new SyntaxHighlighter.Highlighter,SyntaxHighlighter.brushes.Java.aliases=["java"];/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */SyntaxHighlighter.brushes.NuSMV=function(){var e="MODULE IVAR VAR ASSIGN DEFINE TRANS INVARSPEC SPEC CTLSPEC LTLSPEC next init esac case TRUE FALSE main EF AG AX AF EX EG U A E ";this.regexList=[{regex:SyntaxHighlighter.regexLib.singleLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.multiLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.doubleQuotedString,css:"string"},{regex:SyntaxHighlighter.regexLib.singleQuotedString,css:"string"},{regex:/\b([\d]+(\.[\d]+)?|0x[a-f0-9]+)\b/gi,css:"value"},{regex:/(?!\@interface\b)\@[\$\w]+\b/g,css:"color1"},{regex:/\@interface\b/g,css:"color2"},{regex:new RegExp(this.getKeywords(e),"gm"),css:"keyword"}],this.forHtmlScript(SyntaxHighlighter.regexLib.aspScriptTags)},SyntaxHighlighter.brushes.NuSMV.prototype=new SyntaxHighlighter.Highlighter,SyntaxHighlighter.brushes.NuSMV.aliases=["NuSMV","nusmv","smv"];/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */SyntaxHighlighter.brushes.Php=function(){var e="abs acos acosh addcslashes addslashes array_change_key_case array_chunk array_combine array_count_values array_diff array_diff_assoc array_diff_key array_diff_uassoc array_diff_ukey array_fill array_filter array_flip array_intersect array_intersect_assoc array_intersect_key array_intersect_uassoc array_intersect_ukey array_key_exists array_keys array_map array_merge array_merge_recursive array_multisort array_pad array_pop array_product array_push array_rand array_reduce array_reverse array_search array_shift array_slice array_splice array_sum array_udiff array_udiff_assoc array_udiff_uassoc array_uintersect array_uintersect_assoc array_uintersect_uassoc array_unique array_unshift array_values array_walk array_walk_recursive atan atan2 atanh base64_decode base64_encode base_convert basename bcadd bccomp bcdiv bcmod bcmul bindec bindtextdomain bzclose bzcompress bzdecompress bzerrno bzerror bzerrstr bzflush bzopen bzread bzwrite ceil chdir checkdate checkdnsrr chgrp chmod chop chown chr chroot chunk_split class_exists closedir closelog copy cos cosh count count_chars date decbin dechex decoct deg2rad delete ebcdic2ascii echo empty end ereg ereg_replace eregi eregi_replace error_log error_reporting escapeshellarg escapeshellcmd eval exec exit exp explode extension_loaded feof fflush fgetc fgetcsv fgets fgetss file_exists file_get_contents file_put_contents fileatime filectime filegroup fileinode filemtime fileowner fileperms filesize filetype floatval flock floor flush fmod fnmatch fopen fpassthru fprintf fputcsv fputs fread fscanf fseek fsockopen fstat ftell ftok getallheaders getcwd getdate getenv gethostbyaddr gethostbyname gethostbynamel getimagesize getlastmod getmxrr getmygid getmyinode getmypid getmyuid getopt getprotobyname getprotobynumber getrandmax getrusage getservbyname getservbyport gettext gettimeofday gettype glob gmdate gmmktime ini_alter ini_get ini_get_all ini_restore ini_set interface_exists intval ip2long is_a is_array is_bool is_callable is_dir is_double is_executable is_file is_finite is_float is_infinite is_int is_integer is_link is_long is_nan is_null is_numeric is_object is_readable is_real is_resource is_scalar is_soap_fault is_string is_subclass_of is_uploaded_file is_writable is_writeable mkdir mktime nl2br parse_ini_file parse_str parse_url passthru pathinfo readlink realpath rewind rewinddir rmdir round str_ireplace str_pad str_repeat str_replace str_rot13 str_shuffle str_split str_word_count strcasecmp strchr strcmp strcoll strcspn strftime strip_tags stripcslashes stripos stripslashes stristr strlen strnatcasecmp strnatcmp strncasecmp strncmp strpbrk strpos strptime strrchr strrev strripos strrpos strspn strstr strtok strtolower strtotime strtoupper strtr strval substr substr_compare",t="and or xor array as break case cfunction class const continue declare default die do else elseif enddeclare endfor endforeach endif endswitch endwhile extends for foreach function include include_once global if new old_function return static switch use require require_once var while abstract interface public implements extends private protected throw",n="__FILE__ __LINE__ __METHOD__ __FUNCTION__ __CLASS__";this.regexList=[{regex:SyntaxHighlighter.regexLib.singleLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.multiLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.doubleQuotedString,css:"string"},{regex:SyntaxHighlighter.regexLib.singleQuotedString,css:"string"},{regex:/\$\w+/g,css:"variable"},{regex:new RegExp(this.getKeywords(e),"gmi"),css:"functions"},{regex:new RegExp(this.getKeywords(n),"gmi"),css:"constants"},{regex:new RegExp(this.getKeywords(t),"gm"),css:"keyword"}],this.forHtmlScript(SyntaxHighlighter.regexLib.phpScriptTags)},SyntaxHighlighter.brushes.Php.prototype=new SyntaxHighlighter.Highlighter,SyntaxHighlighter.brushes.Php.aliases=["php"];/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */SyntaxHighlighter.brushes.Python=function(){var e="and assert break class continue def del elif else except exec finally for from global if import in is lambda not or pass raise return try yield while",t="__import__ abs all any apply basestring bin bool buffer callable chr classmethod cmp coerce compile complex delattr dict dir divmod enumerate eval execfile file filter float format frozenset getattr globals hasattr hash help hex id input int intern isinstance issubclass iter len list locals long map max min next object oct open ord pow print property range raw_input reduce reload repr reversed round set setattr slice sorted staticmethod str sum super tuple type type unichr unicode vars xrange zip",n="None True False self cls class_";this.regexList=[{regex:SyntaxHighlighter.regexLib.singleLinePerlComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.singleLineCComments,css:"comments"},{regex:/^\s*@\w+/gm,css:"decorator"},{regex:/(['\"]{3})([^\1])*?\1/gm,css:"comments"},{regex:/"(?!")(?:\.|\\\"|[^\""\n])*"/gm,css:"string"},{regex:/'(?!')(?:\.|(\\\')|[^\''\n])*'/gm,css:"string"},{regex:/\+|\-|\*|\/|\%|=|==/gm,css:"keyword"},{regex:/\b\d+\.?\w*/g,css:"value"},{regex:new RegExp(this.getKeywords(t),"gm"),css:"functions"},{regex:new RegExp(this.getKeywords(e),"gm"),css:"keyword"},{regex:new RegExp(this.getKeywords(n),"gm"),css:"color1"}],this.forHtmlScript(SyntaxHighlighter.regexLib.aspScriptTags)},SyntaxHighlighter.brushes.Python.prototype=new SyntaxHighlighter.Highlighter,SyntaxHighlighter.brushes.Python.aliases=["py","python"];/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */SyntaxHighlighter.brushes.Ruby=function(){var e="alias and BEGIN begin break case class def define_method defined do each else elsif END end ensure false for if in module new next nil not or raise redo rescue retry return self super then throw true undef unless until when while yield",t="Array Bignum Binding Class Continuation Dir Exception FalseClass File::Stat File Fixnum Fload Hash Integer IO MatchData Method Module NilClass Numeric Object Proc Range Regexp String Struct::TMS Symbol ThreadGroup Thread Time TrueClass";this.regexList=[{regex:SyntaxHighlighter.regexLib.singleLinePerlComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.doubleQuotedString,css:"string"},{regex:SyntaxHighlighter.regexLib.singleQuotedString,css:"string"},{regex:/\b[A-Z0-9_]+\b/g,css:"constants"},{regex:/:[a-z][A-Za-z0-9_]*/g,css:"color2"},{regex:/(\$|@@|@)\w+/g,css:"variable bold"},{regex:new RegExp(this.getKeywords(e),"gm"),css:"keyword"},{regex:new RegExp(this.getKeywords(t),"gm"),css:"color1"}],this.forHtmlScript(SyntaxHighlighter.regexLib.aspScriptTags)},SyntaxHighlighter.brushes.Ruby.prototype=new SyntaxHighlighter.Highlighter,SyntaxHighlighter.brushes.Ruby.aliases=["ruby","rails","ror"];/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */SyntaxHighlighter.brushes.Sql=function(){var e="abs avg case cast coalesce convert count current_timestamp current_user day isnull left lower month nullif replace right session_user space substring sum system_user upper user year",t="absolute action add after alter as asc at authorization begin bigint binary bit by cascade char character check checkpoint close collate column commit committed connect connection constraint contains continue create cube current current_date current_time cursor database date deallocate dec decimal declare default delete desc distinct double drop dynamic else end end-exec escape except exec execute false fetch first float for force foreign forward free from full function global goto grant group grouping having hour ignore index inner insensitive insert instead int integer intersect into is isolation key last level load local max min minute modify move name national nchar next no numeric of off on only open option order out output partial password precision prepare primary prior privileges procedure public read real references relative repeatable restrict return returns revoke rollback rollup rows rule schema scroll second section select sequence serializable set size smallint static statistics table temp temporary then time timestamp to top transaction translation trigger true truncate uncommitted union unique update values varchar varying view when where with work",n="all and any between cross in join like not null or outer some";this.regexList=[{regex:/--(.*)$/gm,css:"comments"},{regex:SyntaxHighlighter.regexLib.multiLineDoubleQuotedString,css:"string"},{regex:SyntaxHighlighter.regexLib.multiLineSingleQuotedString,css:"string"},{regex:new RegExp(this.getKeywords(e),"gmi"),css:"color2"},{regex:new RegExp(this.getKeywords(n),"gmi"),css:"color1"},{regex:new RegExp(this.getKeywords(t),"gmi"),css:"keyword"}]},SyntaxHighlighter.brushes.Sql.prototype=new SyntaxHighlighter.Highlighter,SyntaxHighlighter.brushes.Sql.aliases=["sql"];/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */SyntaxHighlighter.brushes.Xml=function(){function e(t,n){var r=SyntaxHighlighter.Match,o=t[0],a=new XRegExp("(&lt;|<)[\\s\\/\\?]*(?<name>[:\\w-\\.]+)","xg").exec(o),s=[];if(t.attributes!=null)for(var c,d=new XRegExp(`(?<name> [\\w:\\-\\.]+)\\s*=\\s*(?<value> ".*?"|'.*?'|\\w+)`,"xg");(c=d.exec(o))!=null;)s.push(new r(c.name,t.index+c.index,"color1")),s.push(new r(c.value,t.index+c.index+c[0].indexOf(c.value),"string"));return a!=null&&s.push(new r(a.name,t.index+a[0].indexOf(a.name),"keyword")),s}this.regexList=[{regex:new XRegExp("(\\&lt;|<)\\!\\[[\\w\\s]*?\\[(.|\\s)*?\\]\\](\\&gt;|>)","gm"),css:"color2"},{regex:new XRegExp("(\\&lt;|<)!--\\s*.*?\\s*--(\\&gt;|>)","gm"),css:"comments"},{regex:new XRegExp("(&lt;|<)[\\s\\/\\?]*(\\w+)(?<attributes>.*?)[\\s\\/\\?]*(&gt;|>)","sg"),func:e}]},SyntaxHighlighter.brushes.Xml.prototype=new SyntaxHighlighter.Highlighter,SyntaxHighlighter.brushes.Xml.aliases=["xml","xhtml","xslt","html","xhtml"];var inlineeditor_isIE=navigator.userAgent.toLowerCase().search("msie")!=-1&&navigator.userAgent.toLowerCase().search("opera")==-1,InlineEditor={alreadyInited:!1,addClass:function(e,t){return InlineEditor.jscss("add",e,t)},removeClass:function(e,t){return InlineEditor.jscss("remove",e,t)},checkClass:function(e,t){return InlineEditor.jscss("check",e,t)},swapClass:function(e,t,n){return InlineEditor.jscss("swap",e,t,n)},customEditor:function(e){var t=jQuery("<input/>");return t.attr("id",e.attr("id")+"_editor"),t.val(e.html()=="-- Add More --"?"":e.html()),t.width(e.parent().width()-30),t.height(e.offset().height),t},handleOnClick:function(t){var t=InlineEditor.fixEvent(t),n=jQuery(InlineEditor.findEditableTarget(t.target));if(!(n.hasClass("uneditable")||n.hasClass("editing"))){var r=n.html(),o=null;InlineEditor.elementValue&&(o=InlineEditor.elementValue(n)),o||(o=n.html());var a=null;return InlineEditor.customEditor&&(a=InlineEditor.customEditor(n)),a.focusout(function(s){InlineEditor.handleInputBlur(a,o,r)}),a.keypress(function(s){var c=13;if(s.which==c&&(a.blur(),o=="-- Add More --"&&a.val()!="")){var d=n.attr("id");jQuery("#"+d).click()}}),n.addClass("editing"),n.html(""),n.append(a),a.focusin(),a.select(),!1}},handleInputBlur:function(e,t,n){var r=e.parent(),o=null;if(InlineEditor.editorValue&&(o=InlineEditor.editorValue(e)),o||(o=e.val()==""?t:e.val()),t==o){r.html(n),r.removeClass("editing");return}r.html(o),InlineEditor.elementChanged&&InlineEditor.elementChanged(r,t,o)},jscss:function(e,t,n,r){switch(e){case"swap":t.className=InlineEditor.jscss("check",t,n)?t.className.replace(n,r):t.className.replace(r,n);break;case"add":InlineEditor.jscss("check",t,n)||(t.className+=t.className?" "+n:n);break;case"remove":var o=t.className.match(" "+n)?" "+n:n;t.className=t.className.replace(o,"");break;case"check":return new RegExp("\\b"+n+"\\b").test(t.className)}},fixEvent:function(e){var t=e||window.event;return t.target&&t.target.nodeType==3&&(t.target=t.target.parentNode),inlineeditor_isIE&&t.srcElement&&(t.target=t.srcElement),t},findEditableTarget:function(e){return e.nodeType==1&&e.tagName=="TD"||InlineEditor.checkClass(e,"editable")?e:e.parentNode?InlineEditor.findEditableTarget(e.parentNode):null},addEvent:function(e,t,n,r){if(e.addEventListener)return e.addEventListener(t,n,r),!0;if(e.attachEvent)return e.attachEvent("on"+t,n)},removeEvent:function(e,t,n,r){if(e.removeEventListener)return e.removeEventListener(t,n,r),!0;if(e.detachEvent)return e.detachEvent("on"+t,n)}};DropboxChooser={},DropboxChooser.init=function(){jQuery(".dropbox-button-chooser").each(function(){this.setAttribute("data-link-type","direct"),this.setAttribute("data-extensions",".ump");var e=this;this.addEventListener("DbxChooserSuccess",function(t){DropboxChooser.load(t.files[0].link)},!1)})},DropboxChooser.load=function(e){UmpleSystem.merge(null),Page.showCanvasLoading(!0),Page.showModelLoading(!0),Page.showLayoutLoading(!0),jQuery.get(e).done(function(t){Action.freshLoad=!0,Page.setUmpleCode(t),Page.hideLoading(),TabControl.getCurrentHistory().save(t,"dropboxLoad"),Action.updateUmpleDiagram(),Action.setCaretPosition("0"),Action.updateLineNumberDisplay()}).fail(function(){Page.setFeedbackMessage("Cannot load from the chosen Dropbox file."),Page.hideLoading()})};var DropboxInitializer={};DropboxInitializer.initializeDropbox=function(){jQuery(".dropbox-add-saver").addClass("dropbox-option").append('<li id="ttDropboxSaver"><span class="dropbox-button-saver"></span></li>'),jQuery(".dropbox-add-chooser").addClass("dropbox-option").append('<li id="ttDropboxChooser"><input type="dropbox-chooser" class="dropbox-button-chooser"/></li>'),DropboxChooser.init(),DropboxSaver.init()},DropboxMaster={resetTimeout:2e3},DropboxSaver={},DropboxSaver.init=function(){jQuery(".dropbox-button-saver").each(function(){DropboxSaver.createSaverIn(this)})},DropboxSaver.createSaverIn=function(e){var t=DropboxSaver.getAbsoluteLink(Page.getFilename()),n=Dropbox.createSaveButton({files:[{url:t}],success:function(){window.setTimeout(function(){jQuery(e).children(".dropbox-dropin-btn").remove(),DropboxSaver.createSaverIn(e)},DropboxMaster.resetTimeout)},error:function(r){console.log(r),Page.setFeedbackMessage("Cannot save to the chosen Dropbox location.")}});jQuery(e).append(n)},DropboxSaver.getAbsoluteLink=function(e){var t=document.createElement("a");return t.href=e.replace(/^\.\.\//,""),t.href};var Action=new Object;Action.waiting_time=1500,Action.oldTimeout=null,Action.elementClicked=!1,Action.canCreateByDrag=!0,Action.manualSync=!1,Action.diagramInSync=!0,Action.freshLoad=!1,Action.gentime=new Date().getTime(),Action.savedCanonical="",Action.gdprHidden=!1,Action.update="",Action.neighbors=[];const clientDebuggerFlag=!1;let justUpdatetoSaveLater=!1;Action.setjustUpdatetoSaveLater=function(e){justUpdatetoSaveLater=e};let justUpdatetoSaveLaterForTextCallback=!1;Action.setjustUpdatetoSaveLaterForTextCallback=function(e){justUpdatetoSaveLaterForTextCallback=e},Action.clicked=function(e){Page.clickCount+=1;var t=e.currentTarget,n=t.id.substring(6);if(n=="PhpCode")Action.generateCode("php","Php");else if(n=="RubyCode")Action.generateCode("ruby","Ruby");else if(n=="JavaCode")Action.generateCode("java","Java");else if(n=="RTCppCode")Action.generateCode("rtcpp","RTCpp");else if(n=="AlloyCode")Action.generateCode("alloy","Alloy");else if(n=="NuSMVCode")Action.generateCode("nusmv","NuSMV");else if(n=="CppCode")Action.generateCode("cpp","Cpp");else if(n=="SQLCode")Action.generateCode("sql","Sql");else if(n=="JavaAPIDoc")Action.generateCode("javadoc","javadoc");else if(n=="StateDiagram")Action.generateCode("stateDiagram","stateDiagram");else if(n=="StructureDiagram")Action.generateCode("structureDiagram","structureDiagram");else if(n=="FeatureDiagram")Action.generateCode("featureDiagram","featureDiagram");else if(n=="classDiagram")Action.generateCode("classDiagram","classDiagram");else if(n=="instanceDiagram")Action.generateCode("instanceDiagram","instanceDiagram");else if(n=="entityRelationshipDiagram")Action.generateCode("entityRelationshipDiagram","entityRelationshipDiagram");else if(n=="EcoreCode")Action.generateCode("xml","Ecore");else if(n=="GenerateCode"){var r=$("inputGenerateCode").value.split(":");Action.generateCode(r[0],r[1])}else if(n=="ExecuteCode"){var o=$("inputGenerateCode").value.split(":");Action.executeCode(o[0],o[1])}else if(n=="SimulateCode")Action.simulateCode();else if(n=="StartOver")Action.startOver();else if(n=="ShowRefreshUmpleOnlineCompletely")Action.showRefreshUmpleOnlineCompletely();else if(n=="LoadBlankModel")Action.loadBlankModel();else if(n=="PngImage")Action.pngImage();else if(n=="YumlImage")Action.yumlImage();else if(n=="Jsf")Action.uigu();else if(n=="CopyClip")Action.copyClipboardCode();else if(n=="CopyMix")Action.copyClipboardMixset();else if(n=="Copy")Action.showCodeInSeparateWindow();else if(n=="CopyCommandLine")Action.copyCommandLineCode();else if(n=="CopyEncodedURL")Action.showEncodedURLCodeInSeparateWindow();else if(n=="CopyLocalBrowser")typeof Storage<"u"?(localStorage.setItem("umpleLocalStorage1",Page.getUmpleCode()),Page.setFeedbackMessage("Model saved. Use Load From Browser later to restore.")):Page.setFeedbackMessage("Unable to copy the model to browser storage. An error occurred.");else if(n=="LoadLocalBrowser"){if(typeof Storage<"u"){var a=localStorage.getItem("umpleLocalStorage1");a!=null&&Page.setUmpleCode(a)}}else if(n=="CreateTask")jQuery("#taskArea").css("display","block"),jQuery("#labelTaskName").css("display","block"),jQuery("#taskNameCell").css("display","block"),jQuery("#instructions").css("display","block"),jQuery("#isExperimentCell").css("display","block"),Layout.zoomResize();else if(n=="LoadTask")jQuery("#loadTaskNameArea").css("display","block");else if(n=="LoadThisTask")Action.loadTask(Page.getModel().split("-")[1],!1);else if(n=="RequestLoadTaskURL"){var s=Page.getModel().split("-")[1];Action.copyToClp(window.location.hostname+"/bookmark.php?loadTaskWithURL=1&taskname="+s+"&model="+s)}else if(n=="RequestAllZip"){if(document.getElementById("downloadTaskDirLink")===null){var c=document.createElement("a");c.setAttribute("href","scripts/tab_control.php?downloadTaskUserDir=1&taskid="+Page.getModel()),c.setAttribute("id","downloadTaskDirLink");var d=document.createTextNode("Download ZIP File From Here");c.appendChild(d);var u=document.createElement("LI");u.appendChild(c),document.getElementById("taskSubmenu").appendChild(u)}else document.getElementById("downloadTaskDirLink").setAttribute("href","scripts/tab_control.php?downloadTaskUserDir=1&taskid="+Page.getModel());setTimeout(function(){document.getElementById("downloadTaskDirLink").remove()},3e4)}else if(n=="DownloadFiles"){if(TabControl.useActiveTabTo(TabControl.saveTab)(Page.getUmpleCode()),document.getElementById("downloadLink")===null){var c=document.createElement("a");c.setAttribute("href","scripts/tab_control.php?download=1&&model="+Page.getModel()),c.setAttribute("id","downloadLink");var d=document.createTextNode("Download ZIP File From Here");c.appendChild(d);var u=document.createElement("LI");u.appendChild(c),document.getElementById("saveLoad").appendChild(u)}else document.getElementById("downloadLink").setAttribute("href","scripts/tab_control.php?download=1&&model="+Page.getModel());setTimeout(function(){document.getElementById("downloadLink").remove()},3e4)}else if(n=="Undo")Action.undo();else if(n=="Redo")Action.redo();else if(n=="Reindent"){var f=Page.getRawUmpleCodeCM6().split(`
`),v=Page.codeMirrorEditor6.state.selection.main.head,h=Page.codeMirrorEditor6.state.doc.lineAt(v).number;clientDebuggerFlag&&console.log(h);var C=f[h].match(/^\s*/)[0].length,A=v.ch-C;v.ch=A,Action.reindent(f,v)}else n=="ShowHideTextEditor"?(Layout.showHideTextEditor(),Page.showText=!Page.showText,Page.setShowHideIconState("SHT_button")):n=="ShowHideCanvas"?(Layout.showHideCanvas(),Page.showCanvas=!Page.showCanvas,Page.setShowHideIconState("SHD_button")):n=="ShowEditableClassDiagram"?Action.changeDiagramType({type:"editableClass"}):n=="ShowJointJSClassDiagram"?Action.changeDiagramType({type:"JointJSClass"}):n=="ShowGvClassDiagram"?Action.changeDiagramType({type:"GvClass"}):n=="ShowGvFeatureDiagram"?Action.changeDiagramType({type:"GvFeature"}):n=="ShowGvStateDiagram"?Action.changeDiagramType({type:"GvState"}):n=="ShowStructureDiagram"?Action.changeDiagramType({type:"structure"}):n=="ShowHideLayoutEditor"?Layout.showHideLayoutEditor():n=="ManualSync"?Action.enableManualSync():n=="SyncDiagram"?(Action.processTyping("codeMirrorEditor",!0),Page.codeMirrorEditor6.focus()):n=="PhotoReady"?Action.photoReady():n=="ToggleAttributes"?(Action.toggleAttributes(),Page.setShowHideIconState("SHA_button")):n=="ToggleMethods"?(Action.toggleMethods(),Page.setShowHideIconState("SHM_button")):n=="ToggleActions"?Action.toggleActions():n=="ToggleTraits"?Action.toggleTraits():n=="ToggleTransitionLabels"?Action.toggleTransitionLabels():n=="ToggleGuards"?Action.toggleGuards():n=="ToggleGuardLabels"?Action.toggleGuardLabels():n=="AllowPinch"?Action.allowPinch():n=="ToggleFeatureDependency"?Action.toggleFeatureDependency():n=="StructureLink"?Action.generateStructureDiagramFile():n=="TabsCheckbox"?Action.toggleTabs():n.substr(0,6)=="mixset"?Action.toggleMixsetUseStatement(n.substr(6)):n.substr(0,6)=="filter"?Action.toggleFilterUseStatement(n.substr(6)):n.substr(0,2)=="gv"&&Action.toggleSpecialSuboption(n)},Action.toggleSpecialSuboption=function(e){var t=Page.specialSuboptionsActive.indexOf(e);t!==-1?Page.specialSuboptionsActive.splice(t,1):(Page.specialSuboptionsActive.push(e),Action.deactivateSpecialLayoutAlgorithmsExcept(e)),Action.redrawDiagram()},Action.toggleMixsetUseStatement=function(e){var t=Page.mixsetsActive.indexOf(e);t!==-1?Page.mixsetsActive.splice(t,1):Page.mixsetsActive.push(e),Action.redrawDiagram()},Action.toggleFilterUseStatement=function(e){var t=Page.filtersActive.indexOf(e);t!==-1?Page.filtersActive.splice(t,1):Page.filtersActive.push(e),Action.redrawDiagram()},Action.focusOn=function(e,t){var n="#"+e,r=e=="umpleModelEditorText"||e=="umpleLayoutEditorText"||e=="CodeMirror";e=="CodeMirror"&&(n=".CodeMirror-scroll"),t?(!Page.isPhotoReady()||r)&&(jQuery(n).parent().addClass("focus"),jQuery(n).addClass("visibleFocus"),r&&(Page.shortcutsEnabled=!1,Page.selectedItem!=null&&Page.unselectAllToggleTools(),Action.unselectAll())):(jQuery(n).parent().removeClass("focus"),jQuery(n).removeClass("visibleFocus"),(r||e=="CodeMirror")&&(Page.shortcutsEnabled=!0))},Action.startOver=function(){Page.setUmpleCode(""),UmpleSystem.merge(null),window.location="umple.php"},Action.showRefreshUmpleOnlineCompletely=function(){jQuery("#buttonStartOver").show()},Action.loadBlankModel=function(){UmpleSystem.merge(null),Page.showCanvasLoading(!0),Page.showModelLoading(!0),Page.showLayoutLoading(!0),Ajax.sendRequest("scripts/compiler.php",Action.loadExampleCallback,"exampleCode=")},Action.undo=function(){jQuery("#buttonUndo").hasClass("disabled")||Action.redoOrUndo(!0)},Action.redo=function(){jQuery("#buttonRedo").hasClass("disabled")||Action.redoOrUndo(!1)},Action.dropHandler=function(e){if(Page.setFeedbackMessage("File will be dropped"),e.preventDefault(),e.dataTransfer.items){for(var t=0;t<e.dataTransfer.items.length;t++)if(e.dataTransfer.items[t].kind==="file"){var n=e.dataTransfer.items[t].getAsFile();n.text().then(function(r){Page.setUmpleCode(r)})}}else for(var t=0;t<e.dataTransfer.files.length;t++)e.dataTransfer.files[t].text().then(function(o){Page.setUmpleCode(o)})},Action.dragOverHandler=function(e){e.preventDefault()},Action.getThemePreference=function(){try{var e=document.getElementById("themeModeSelect"),t=localStorage.getItem("umple-theme"),n=e&&/^(light|dark|system)$/.test(e.value)?e.value:/(light|dark|system)$/.test(t)?t:"system";return n==="system"?window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":n}catch{return"light"}},Action.redoOrUndo=function(e){var t="";Action.manualSync&&Action.diagramInSync&&(Action.diagramInSync=!1,Page.enablePaletteItem("buttonSyncDiagram",!0),Page.enableDiagram(!1)),e?t=TabControl.getCurrentHistory().getPreviousVersion():t=TabControl.getCurrentHistory().getNextVersion(),t==History.noChange&&(t="");var n=t.indexOf(Page.modelDelimiter),r="";n==-1?r=t:r=t.substring(0,n);var o=Page.getRawUmpleCodeCM6().replace(Page.modelDelimiter,""),a=Action.findDiff(o,r),s=Action.getCaretPosition();Action.freshLoad=!0,Page.setUmpleCode(t),Action.manualSync||Action.updateLayoutEditorAndDiagram(),Action.setjustUpdatetoSaveLater(!0),setTimeout(function(){a[1]==a[2]?Action.setCaretPosition(s):Action.setCaretPosition(a[3])},300)},Action.findDiff=function(e,t){var n=0,r=e.length,o=t.length,a=r;o<a&&(a=o);for(var s=0;s<a&&e.charAt(s)===t.charAt(s);)s++,e.charAt(s)===`
`&&t.charAt(s)===`
`&&n++;var c=t.substring(s,1);return[r,o,s,n+1]},Action.loadFile=function(){var e=Page.getFilename();e!=""?(Action.setjustUpdatetoSaveLater(!0),Page.getModel().substring(0,8)=="taskroot"?Ajax.sendRequest("scripts/compiler.php",Action.loadFileCallback,format("load=1&isTask=1&filename={0}",e)):Ajax.sendRequest("scripts/compiler.php",Action.loadFileCallback,format("load=1&filename={0}",e))):Action.saveNewFile()},Action.loadFileCallback=function(e){if(Action.freshLoad=!0,!(Object.keys(TabControl.tabs).length>1)){if(Page.setUmpleCode(e.responseText,!0),TabControl.getCurrentHistory().save(e.responseText,"loadFileCallback"),Action.setjustUpdatetoSaveLater(!0),TabControl.tabs[TabControl.getActiveTabId()].nameIsEphemeral){var t=TabControl.extractNameFromCode(e.responseText);t&&TabControl.useActiveTabTo(TabControl.renameTab)(t,!0)}Action.manualSync||(Action.updateUmpleDiagram(),Action.freshLoad=!1)}},Action.loadTask=function(e,t){jQuery("#showInstrcutionsArea").css("display","block"),t?Page.getModel().split("-")[0]=="task"?Ajax.sendRequest("scripts/compiler.php",Action.loadTaskExceptCodeCallback,format("loadTask=1&loadInstructionAsHTML=1&filename={0}",e)):Ajax.sendRequest("scripts/compiler.php",Action.loadTaskExceptCodeCallback,format("loadTask=1&filename={0}",e)):Ajax.sendRequest("bookmark.php",Action.loadTaskBookmark,format("taskname={0}&model={0}",e))},Action.loadTaskBookmark=function(e){e.responseText.split(" ")[0]=="Task"?window.alert("Load Task Failed! "+e.responseText):window.location.href="umple.php?model="+e.responseText},Action.loadTaskCallback=function(e){if(Action.freshLoad=!0,!(Object.keys(TabControl.tabs).length>1)){Action.setjustUpdatetoSaveLater(!0),TabControl.getCurrentHistory().save(e.responseText,"loadTaskCallback");var t=e.responseText.split("task delimiter");if(Page.setUmpleCode(t[0]),TabControl.tabs[TabControl.getActiveTabId()].nameIsEphemeral){var n=TabControl.extractNameFromCode(t[0]);n&&TabControl.useActiveTabTo(TabControl.renameTab)(n,!0)}Action.manualSync||Action.updateUmpleDiagram(),TabControl.useActiveTabTo(TabControl.saveTab)(Page.getUmpleCode()),TabControl.saveActiveTabs(),window.location.href="bookmark.php?taskname="+t[2]+"&model="+t[3]}},Action.loadTaskExceptCodeCallback=function(e){Action.freshLoad=!0,justUpdatetoSaveLater||(TabControl.getCurrentHistory().save(e.responseText,"loadTaskExceptCodeCallback"),Action.setjustUpdatetoSaveLater(!0));var t=e.responseText.split("task delimiter");if(jQuery("#labelInstructions").text('Instructions for task "'+t[2]+'":'),jQuery("#requestorName").val(t[4]),jQuery("#labelInstructions").css("display","block"),jQuery("#taskArea").css("display","block"),Page.getModel().split("-")[0]=="task"?(jQuery("#labelInstructions").text('Instructions for task "'+t[2]+'":               Requestor Name:'+t[4]),jQuery("#labelCompletionURL").css("display","none"),jQuery("#completionURLCell").css("display","none"),jQuery("#labelRequestorName").css("display","none"),jQuery("#requestorName").css("display","none"),jQuery("#instructionsHTML").html(t[1])):(jQuery("#instructions").val(t[1]),jQuery("#instructions").css("display","block"),jQuery("#completionURL").val(t[5]),jQuery("#isExperimentCell").css("display","inline"),jQuery("#isExperiment").prop("checked",t[6]=="true"),jQuery("#instructions").each(function(){this.setAttribute("style","height:"+this.scrollHeight+"px;overflow-y:hidden;")}).on("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"})),TabControl.tabs[TabControl.getActiveTabId()].nameIsEphemeral){var n=TabControl.extractNameFromCode(t[0]);n&&TabControl.useActiveTabTo(TabControl.renameTab)(n,!0)}Layout.zoomResize()},Action.submitLoadTask=function(){var e=jQuery("#inputLoadTaskName").val();if(!/^(\w|\.)+$/.test(e)){window.alert("Task Name can only contain letters(case insensitive), underscores, dots, and digits!");return}Action.loadTask(e,!1)},Action.submitTaskWork=function(){Ajax.sendRequest("task.php",Action.submitTaskWorkCallback,format("submitTaskWork=1&model={0}&responseURL={1}",Page.getModel(),window.location.href))},Action.submitTaskWorkCallback=function(e){window.alert("Successfully submitted Task!");var t=e.responseText.split("task submit delimiter");t[0]==""?window.location.href=t[2]:window.location.href=t[0]+"?task="+t[1]+"&url="+t[2]},Action.launchParticipantURL=function(){var e=Page.getModel().split("-")[1];window.open("bookmark.php?loadTaskWithURL=1&taskname="+e+"&model="+e)},Action.copyParticipantURL=function(){var e=Page.getModel().split("-")[1],t=window.location.hostname+window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/"))+"/bookmark.php?loadTaskWithURL=1&taskname="+e+"&model="+e;Action.copyToClp(t),Page.setFeedbackMessage("Participant URL is in copy buffer: "+t)},Action.openStartFreshWork=function(){var e=confirm("Are you sure to start from fresh?");e&&(window.location.href="/umpleonline/umple.php")},Action.copyToClp=function(e){prenode=document.createElement("PRE"),e=document.createTextNode(e),prenode.appendChild(e);var t=document,n=window,r=t.body;if(r.appendChild(prenode),r.createTextRange){var o=r.createTextRange();o.moveToElementText(e),o.select(),t.execCommand("copy")}else{var o=t.createRange(),a=n.getSelection;o.selectNodeContents(e),a().removeAllRanges(),a().addRange(o),t.execCommand("copy"),a().removeAllRanges()}prenode.remove()},Action.openInstructionInNewTab=function(){jQuery("#buttonReshowInstructions").css("display","inline");var e=window.open("about:blank","_blank");e.document.write(jQuery("#instructionsHTML").html()),e.document.close(),jQuery("#instructionsHTML").css("display","none"),jQuery("#labelInstructions").css("display","none"),jQuery("#buttonHideInstructions").css("display","none"),Layout.zoomResize()},Action.reshowInstructions=function(){jQuery("#instructionsHTML").css("display","block"),jQuery("#labelInstructions").css("display","inline"),jQuery("#buttonReshowInstructions").css("display","none"),jQuery("#buttonHideInstructions").css("display","inline"),Layout.zoomResize()},Action.hideInstructions=function(){jQuery("#instructionsHTML").css("display","none"),jQuery("#labelInstructions").css("display","none"),jQuery("#buttonHideInstructions").css("display","none"),jQuery("#buttonReshowInstructions").css("display","inline"),Layout.zoomResize()},Action.saveNewFile=function(){var e=Page.getUmpleCode(),t=Page.getFilename();t==""&&Ajax.sendRequest("scripts/compiler.php",Action.saveNewFileCallback,format("save=1&&umpleCode={0}",e))},Action.saveNewFileCallback=function(e){Page.setFilename(e.responseText)},Action.changeDiagramType=function(e){var t=!1;if(jQuery(".layoutListItem").hide(),e.type=="editableClass"){if(Page.useEditableClassDiagram)return;Page.useEditableClassDiagram=!0,Page.useJointJSClassDiagram=!1,Page.useGvClassDiagram=!1,Page.useGvStateDiagram=!1,Page.useGvFeatureDiagram=!1,Page.useStructureDiagram=!1,t=!0,jQuery("#buttonShowEditableClassDiagram").prop("checked","checked"),Page.setDiagramTypeIconState("editableClass"),jQuery(".view_opt_class").show(),jQuery(".view_opt_class_palette").show()}else if(e.type=="JointJSClass"){if(Page.useJointJSClassDiagram)return;Page.useEditableClassDiagram=!1,Page.useJointJSClassDiagram=!0,Page.useGvClassDiagram=!1,Page.useGvStateDiagram=!1,Page.useGvFeatureDiagram=!1,Page.useStructureDiagram=!1,t=!0,jQuery("#buttonShowJointJSClassDiagram").prop("checked","checked"),Page.setDiagramTypeIconState("JointJSClass"),jQuery(".view_opt_class").show(),jQuery(".view_opt_class_palette").show()}else if(e.type=="GvClass"){if(Page.useGvClassDiagram)return;Page.useEditableClassDiagram=!1,Page.useJointJSClassDiagram=!1,Page.useGvClassDiagram=!0,Page.useGvStateDiagram=!1,Page.useGvFeatureDiagram=!1,Page.useStructureDiagram=!1,t=!0,jQuery("#buttonShowGvClassDiagram").prop("checked","checked"),Page.setDiagramTypeIconState("GvClass"),jQuery(".view_opt_class").show()}else if(e.type=="GvState"){if(Page.useGvStateDiagram)return;Page.useEditableClassDiagram=!1,Page.useJointJSClassDiagram=!1,Page.useGvClassDiagram=!1,Page.useGvStateDiagram=!0,Page.useStructureDiagram=!1,Page.useGvFeatureDiagram=!1,t=!0,jQuery("#buttonShowGvStateDiagram").prop("checked","checked"),Page.setDiagramTypeIconState("GvState"),jQuery(".view_opt_state").show()}else if(e.type=="GvFeature"){if(Page.useGvFeatureDiagram)return;Page.useEditableClassDiagram=!1,Page.useJointJSClassDiagram=!1,Page.useGvClassDiagram=!1,Page.useGvStateDiagram=!1,Page.useStructureDiagram=!1,Page.useGvFeatureDiagram=!0,t=!0,jQuery("#buttonShowGvFeatureDiagram").prop("checked","checked"),Page.setDiagramTypeIconState("GvFeature"),jQuery(".view_opt_feature").show()}else if(e.type=="structure"){if(Page.useGvStructureDiagram)return;Page.useEditableClassDiagram=!1,Page.useJointJSClassDiagram=!1,Page.useGvClassDiagram=!1,Page.useGvStateDiagram=!1,Page.useStructureDiagram=!0,Page.useGvFeatureDiagram=!1,t=!0,jQuery("#buttonShowStructureDiagram").prop("checked","checked"),Page.setDiagramTypeIconState("structure")}t&&Action.redrawDiagram()},Action.pngImage=function(){var e=Json.toString(UmpleSystem),t=encodeURIComponent(e);window.open("scripts/compiler.php?asImage="+t,"UMLClassDiagram")},Action.yumlImage=function(){var e="#buttonYumlImage";jQuery(e).showLoading(),Action.ajax(Action.yumlImageCallback,"save=1")},Action.yumlImageCallback=function(e){var t=e.responseText,n="#buttonYumlImage";jQuery(n).hideLoading(),window.open("scripts/compiler.php?asYuml="+t,"yumlClassDiagram"),Page.showViewDone()},Action.uigu=function(){var e="#buttonUigu";jQuery(e).showLoading(),Action.ajax(Action.uiguCallback,"save=1")},Action.uiguCallback=function(e){var t=e.responseText,n="#buttonUigu";jQuery(n).hideLoading(),window.open("scripts/compiler.php?asUI="+t,"showUserInterface"),Page.showViewDone()},Action.copyClipboardCode=function(){Action.copyToClp(Page.getUmpleCode()),Page.setFeedbackMessage("Code has been copied to the clipboard")},Action.copyClipboardMixset=function(){Action.copyToClp(Page.copyableMixset),Page.setFeedbackMessage("Mixset with selected diagram filters and options is in clipboard")},Action.copyCommandLineCode=function(){var e=`sh
`;e+=`echo Will compile umple file. Requires umple command to be installed
`,e+=`cd ~/tmp
`,e+=`mkdir testump-$$
`,e+=`cd testump-$$
`,e+=`cat >> test.ump <<ENDUMP
`;var t=`
ENDUMP
`;t+=`umple test.ump -c -
`,t+=`echo Use ctrl-D to exit back to the original shell

`,Action.copyToClp(e+Page.getUmpleCode()+t),Page.setFeedbackMessage("Shell code to compile on command line was copied to clipboard")},Action.showCodeInSeparateWindow=function(){const e=new Date,t=a=>String(a).padStart(2,"0"),o=`// UmpleOnline code as of ${e.getFullYear()+t(e.getMonth()+1)+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())}

`+Page.getUmpleCode();codeWindow=window.open("","UmpleCode","height=700, width=400, left=100, top=100, location=no, status=no, scrollbars=yes"),codeWindow.document.write('<code><pre id="umpleCode">'+o+"</pre></code>"),codeWindow.document.title="Umple raw code",codeWindow.document.close()},Action.showEncodedURLCodeInSeparateWindow=function(){const t=Page.getEncodedURL(),n=t.length;let r="";n>2e3?(r="// WARNING: Encoded URL length ("+n+` characters)
// exceeds recommended limit (2000).
// Use Save & Collaborate for larger models.

`,Page.setFeedbackMessage("Encoded URL too long ("+n+" chars). Use Save & Collaborate instead.")):Page.setFeedbackMessage("Encoded URL generated ("+n+" chars). Ideal for PowerPoint embedding.");const o=r+t;codeWindow=window.open("","UmpleEncodedURL","height=500, width=520, left=100, top=100, location=no, status=no, scrollbars=yes"),codeWindow.document.write('<code><pre id="umpleCode">'+o+"</pre></code>"),codeWindow.document.title="Umple encoded URL",codeWindow.document.close()},Action.simulateCode=function(){simulateButtonSelector="#buttonSimulateCode",jQuery(simulateButtonSelector).showLoading(),Action.ajax(Action.simulateCodeCallback,"language=Simulate")},Action.simulateCodeCallback=function(e){simulateButtonSelector="#buttonSimulateCode",jQuery(simulateButtonSelector).hideLoading();var t=e.responseText;window.open("../umpleonline/simulate.php?model="+t,"umpleSimulator"),Page.showViewDone()},Action.drawInputState=function(e,t,n){var r=document.createElement("div");r.style.zIndex="1000",r.style.border="1px solid #ccc",r.style.backgroundColor="#f8f8f8",r.style.padding="5px",r.style.position="fixed",r.id="promptBox";var o=r.getBoundingClientRect();event.clientX+o.width>window.innerWidth?r.style.right=window.innerWidth-event.clientX+"px":r.style.left=event.clientX+"px",event.clientY+o.height>window.innerHeight?r.style.bottom=window.innerHieght-event.clientY+"px":r.style.top=event.clientY+"px";var a=document.createElement("input");a.type="text",a.style.padding="5px",a.style.borderRadius="3px",a.style.border="1px solid #ccc",a.style.width="200px",a.style.marginLeft="5px";var s=document.createElement("label");s.type="label",s.textContent="Error - Please enter an alphanumeric name beginning with a non-numeric character.",s.style.color="red";var c=function f(v){document.contains(r)&&v.target!=r&&!r.contains(v.target)&&(document.removeEventListener("mousedown",f),r.remove())},d=t.replaceAll("&#10",`
`).replaceAll("&#$quot",'"'),u=document.createElement("label");u.htmlFor="inputLabel",u.style.marginRight="5px",document.addEventListener("mousedown",c),e=="rename"?(clientDebuggerFlag&&console.log("Renaming State ..."),u.appendChild(document.createTextNode("New name for '"+n+"'?")),a.value=n,a.addEventListener("keydown",function(f){if(f.key==="Enter")if(Action.validateAttributeName(a.value)){clientDebuggerFlag&&console.log("Getting code from codemirror editor ...");let v=Page.codeMirrorEditor6.state.doc.toString(),h=new RegExp("(\\W+)("+n+")(\\W+)"),C;for(;(C=v.match(h))!=null;)v=v.substr(0,C.index+C[1].length)+a.value.trim()+v.substr(C.index+C[1].length+C[2].length,v.length-(C.index+C[1].length+C[2].length));clientDebuggerFlag&&console.log("Setting updated code to codemirror editor ..."),Page.setCodeMirror6Text(v),setTimeout('Action.processTyping("newEditor",false)',Action.waiting_time),document.removeEventListener("mousedown",c),clientDebuggerFlag&&console.log("Removing mousedown event ..."),r.remove(),Action.removeContextMenu(),TabControl.getCurrentHistory().save(v,"menuUpdate")}else document.contains(s)||r.appendChild(s)})):e=="substate"?(clientDebuggerFlag&&console.log("Substating state ..."),u.appendChild(document.createTextNode("Name of new substate?")),a.addEventListener("keydown",function(f){if(f.key==="Enter")if(Action.validateAttributeName(a.value)){let v=d.substr(0,d.length-1)+"  "+a.value+"{}}";clientDebuggerFlag&&console.log("Getting original code and adding substate ..."),v=Page.codeMirrorEditor6.state.doc.toString().replace(d,v),clientDebuggerFlag&&console.log("Setting updated code with substate into codemirror editor ..."),Page.setCodeMirror6Text(v),setTimeout('Action.processTyping("newEditor",false)',Action.waiting_time),document.removeEventListener("mousedown",c),clientDebuggerFlag&&console.log("Removing mousedown event ..."),r.remove(),Action.removeContextMenu(),TabControl.getCurrentHistory().save(v,"menuUpdate")}else document.contains(s)||r.appendChild(s)})):e=="transition"&&(clientDebuggerFlag&&console.log("Adding Transition ..."),u.appendChild(document.createTextNode("Condition for new transition?")),a.addEventListener("keydown",function(f){if(f.key==="Enter")if(Action.validateAttributeName(a.value)){var v=t.replaceAll("&#10",`
`).replaceAll("&#$quot",'"');document.removeEventListener("mousedown",c),r.remove(),Action.removeContextMenu(),clientDebuggerFlag&&console.log("Waiting to select target state for transition ...");var h=function(A){let T=A.target;for(;T.parentElement.id!="graph0";)T=T.parentNode;let j=T.outerHTML.substr(T.outerHTML.indexOf("stateClicked(&quot;")+19,T.outerHTML.indexOf('&quot;)"')-(T.outerHTML.indexOf("stateClicked(&quot;")+19));j=j.split("^*^");let N="  "+a.value+" -> "+j[2]+`;
}`,p=v.substr(0,v.length-1)+N;clientDebuggerFlag&&(console.log("New state created ..."),console.log("Replacing original state with new state in the code ...")),Page.setCodeMirror6Text(Page.codeMirrorEditor6.state.doc.toString().replace(v,p)),setTimeout('Action.processTyping("newEditor",false)',Action.waiting_time),TabControl.getCurrentHistory().save(Page.codeMirrorEditor6.state.doc.toString(),"menuUpdate");let b=document.getElementsByClassName("node");for(let _=0;_<b.length;_++)b[_].removeEventListener("mousedown",h);C=document.getElementsByClassName("cluster");for(let _=0;_<b.length;_++)b[_].removeEventListener("mousedown",h)},C=document.getElementsByClassName("node");for(let A=0;A<C.length;A++)C[A].addEventListener("mousedown",h);C=document.getElementsByClassName("cluster");for(let A=0;A<C.length;A++)C[A].addEventListener("mousedown",h)}else document.contains(s)||r.appendChild(s)})),r.appendChild(u),r.appendChild(a),document.body.appendChild(r),a.focus()},Action.deleteState=function(e,t,n,r){let o=r.split(",");clientDebuggerFlag&&console.log("Getting code from codemirror editor ...");let a=Page.codeMirrorEditor6.state.doc.toString();clientDebuggerFlag&&console.log("Deleting State: ",r);let s=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"');a=a.replace(s,"");let c=new RegExp("[^{};]*->\\s*([^\\S\\s]*|\\s*)(\\/\\s*{[^}]*})*([^\\S\\s]*|\\s*)("+o[o.length-1]+")(\\s+\\w+)*\\s*;"),d;for(;(d=a.match(c))!=null;)a=a.substr(0,d.index)+a.substr(d.index+d[0].length,a.length-(d.index+d[0].length));clientDebuggerFlag&&console.log("Setting updated code to codemirror editor ..."),Page.setCodeMirror6Text(a),setTimeout('Action.processTyping("newEditor",false)',Action.waiting_time),TabControl.getCurrentHistory().save(a,"menuUpdate"),Action.removeContextMenu()},Action.drawStateMenu=function(){if(Action.diagramInSync){Action.removeContextMenu();for(var e=event.target;e.parentElement.id!="graph0";)e=e.parentNode;var t=e.outerHTML.substr(e.outerHTML.indexOf("stateClicked(&quot;")+19,e.outerHTML.indexOf('&quot;)"')-(e.outerHTML.indexOf("stateClicked(&quot;")+19));t=t.split("^*^"),t[2]=t[2].split(".");var n=Page.codeMirrorEditor6.state.doc.toString(),r=Action.selectStateInClassCM6(t[0],t[1],t[2][0]);for(let h=1;h<t[2].length;h++)r=Action.selectStateInStateCM6(r.startIndex,r.endIndex,t[2][h]);var o=n.substr(r.startIndex,r.endIndex-r.startIndex);if(typeof o=="string"){var a=document.createElement("customContextMenu"),s=["Rename State","Delete State","Add Substate","Add Transition"],c=o.replaceAll(`
`,"&#10").replaceAll('"',"&#$quot"),d=['Action.drawInputState("rename","'+c+'","'+t[2][t[2].length-1]+'")','Action.deleteState("'+c+'","'+t[0]+'","'+t[1]+'","'+t[2]+'")','Action.drawInputState("substate","'+c+'","'+t[2][t[2].length-1]+'")','Action.drawInputState("transition","'+c+'","'+t[2][t[2].length-1]+'")'];a.style.zIndex="1000",a.style.border="1px solid #ccc",a.style.backgroundColor="#f8f8f8",a.style.padding="5px",a.style.position="fixed";for(var u=0;u<s.length;u++){var f=document.createElement("div");f.style.padding="5px",f.style.borderRadius="3px",f.style.cursor="pointer",f.style.transition="background-color 0.3s",f.textContent=s[u],f.setAttribute("onclick","javascript:"+d[u]),f.addEventListener("mouseover",function(){this.style.backgroundColor="#ddd"}),f.addEventListener("mouseout",function(){this.style.backgroundColor="transparent"}),a.appendChild(f)}var v=a.getBoundingClientRect();event.clientX+v.width>window.innerWidth?a.style.right=window.innerWidth-event.clientX+"px":a.style.left=event.clientX+"px",event.clientY+v.height>window.innerHeight?a.style.bottom=window.innerHieght-event.clientY+"px":a.style.top=event.clientY+"px",document.addEventListener("mousedown",function h(C){var A=document.getElementById("promptBox");C.target!=a&&!a.contains(C.target)&&(A!=null&&C.target!=A&&A.contains(C.target),document.removeEventListener("mousedown",h),Action.removeContextMenu())}),document.body.appendChild(a)}}},Action.displayTransitionMenu=function(e){if(!Action.diagramInSync)return;Action.removeContextMenu();for(var t=e.target;t.parentElement.id!="graph0";)t=t.parentNode;var n=t.outerHTML.substr(t.outerHTML.indexOf("transitionClicked(&quot;")+24,t.outerHTML.indexOf('&quot;)"')-(t.outerHTML.indexOf("transitionClicked(&quot;")+24));n=n.replaceAll("&amp;","&");let r=n.split("*^*"),o=r[3].split(".");dest=r[4].split(".");for(var a=Action.selectStateInClassCM6(r[0],r[1],o[0]),s=1;s<o.length;s++)a=Action.selectStateInStateCM6(a.startIndex,a.endIndex,o[s]);let c=r[2].replaceAll("+","\\+").replaceAll("-","\\-").replaceAll("*","\\*").replaceAll("?","\\?").replaceAll("|","\\|");if(c=c.replace("after","after~`~?:Every`~`?"),r[5]!=""){let O=r[5].trim().replaceAll("+","\\+").replaceAll("-","\\-").replaceAll("*","\\*").replaceAll("?","\\?").replaceAll("|","\\|");c=c+"\\s*[\\s*"+O.trim().slice(1,O.trim().length-1)+"\\s*]"}c=c.replaceAll("]","\\]").replaceAll("[","\\[").replaceAll(")","\\)?").replaceAll("(","\\(?").replaceAll("~`~","(").replaceAll("`~`",")").replaceAll(" ","\\s*").replaceAll(",","\\s*,\\s*").replaceAll("!","\\s*!\\s*").replaceAll("/","\\s*/\\s*"),c=c.replaceAll("&&","&{1,2}");let d=new RegExp(c+".*->","s"),u=Page.codeMirrorEditor6.state.doc.toString().substr(a.startIndex,a.endIndex-a.startIndex).search(d)+a.startIndex,f=Page.codeMirrorEditor6.state.doc.toString().substr(u),v=Action.findEOL(f);if(v.split("->").length-1!==1){Page.setFeedbackMessage(" Please edit this complex transition in the textual code.");return}let h=u+v.length,C=Page.codeMirrorEditor6.state.doc.toString().substring(u,h),A=new RegExp("^(.*?)(\\s*\\[(.*?)\\])?(\\s*\\/\\s*\\{(.*?)\\})?\\s*->\\s*(\\[(.*?)\\])?(\\s*\\/\\s*\\{(.*?)\\})?\\s*(\\w+);?$","s");const T=C.trim().match(A);let j=T[1].trim(),N=T[3]?T[3].trim():T[7]?T[7].trim():null,p=T[5]?T[5].trim():T[9]?T[9].trim():null,b=T[10].trim();N===null&&(N=""),p===null&&(p="");var _=document.createElement("customContextMenu"),L=["Change or Add Event Name","Change or Add Guard","Change or Add Action","Change Destination State","Delete Transition"],P=['Action.modifyTransitionEventName("'+u+'","'+h+'")','Action.modifyTransitionGuard("'+u+'","'+h+'")','Action.modifyTransitionAction("'+u+'","'+h+'")','Action.changeTransition("'+b+'","'+u+'","'+h+'")','Action.deleteTransition("'+u+'","'+h+'")'];_.style.zIndex="1000",_.style.border="1px solid #ccc",_.style.backgroundColor="#f8f8f8",_.style.padding="5px",_.style.position="fixed";for(var s=0;s<L.length;s++){var S=document.createElement("div");S.style.padding="5px",S.style.borderRadius="3px",S.style.cursor="pointer",S.style.transition="background-color 0.3s",S.textContent=L[s],S.setAttribute("onclick","javascript:"+P[s]),S.addEventListener("mouseover",function(){this.style.backgroundColor="#ddd"}),S.addEventListener("mouseout",function(){this.style.backgroundColor="transparent"}),_.appendChild(S)}var k=_.getBoundingClientRect();e.clientX+k.width>window.innerWidth?_.style.right=window.innerWidth-e.clientX+"px":_.style.left=e.clientX+"px",e.clientY+k.height>window.innerHeight?_.style.bottom=window.innerHieght-e.clientY+"px":_.style.top=e.clientY+"px",document.addEventListener("mousedown",function O(R){var I=document.getElementById("promptBox");R.target!=_&&!_.contains(R.target)&&(I!=null&&R.target!=I&&I.contains(R.target),document.removeEventListener("mousedown",O),Action.removeContextMenu())}),document.addEventListener("keydown",function O(R){var I=document.getElementById("promptBox");R.target!=_&&!_.contains(R.target)&&R.key==="Escape"&&(I!=null&&R.target!=I&&I.contains(R.target),document.removeEventListener("keydown",O),Action.removeContextMenu())}),document.body.appendChild(_)},Action.changeTransition=function(e,t,n){let a=Page.codeMirrorEditor6.state.doc.toString().substring(t,n).trim().replace(/;$/,"").split("->");if(a[0]=a[0].trim(),a[1]=a[1].trim(),a.length!=2){console.log("Invalid transition format.");return}var s=document.createElement("div");s.style.zIndex="1000",s.style.border="1px solid #ccc",s.style.backgroundColor="#f8f8f8",s.style.padding="5px",s.style.position="absolute",s.style.left="50%",s.style.top="50%",s.style.transform="translate(-50%, -50%)",s.id="promptBox";var c=document.createElement("input");c.type="text",c.value=a[1],c.style.padding="5px",c.style.margin="5px",c.style.width="200px";var d=document.createElement("button");d.textContent="Change Destination",d.style.padding="5px",d.style.marginLeft="5px",s.appendChild(c),s.appendChild(d),document.body.appendChild(s),c.focus();var u=function f(v){document.contains(s)&&v.target!=s&&!s.contains(v.target)&&(document.removeEventListener("mousedown",f),s.remove())};document.addEventListener("mousedown",u),document.addEventListener("keydown",function(f){f.key==="Escape"&&(s.remove(),document.removeEventListener("keydown",arguments.callee))}),d.addEventListener("click",function(){if(c.value.trim()===""){console.log("Input for new destination state is empty.");return}let f=a[0]+" -> "+a[1].replace(e,c.value.trim())+";",v=Page.codeMirrorEditor6.state.doc.toString(),h=v.substring(0,t),C=v.substring(n),A=h+f+C;Page.setCodeMirror6Text(A),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"changeTransitionDestination"),document.removeEventListener("mousedown",u),s.remove(),Action.selectMatchingText(f)}),c.addEventListener("keydown",function(f){f.key==="Enter"&&(f.preventDefault(),f.stopPropagation(),d.click())})},Action.deleteTransition=function(e,t){let n=Page.codeMirrorEditor6.state.doc.toString().substring(e,t),r=Page.codeMirrorEditor6.state.doc.toString();r=r.replace(n,""),Page.setCodeMirror6Text(r),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate")},Action.modifyTransitionGuard=function(e,t){let n=new RegExp("^(.*?)(\\s*\\[(.*?)\\])?(\\s*\\/\\s*\\{(.*?)\\})?\\s*->\\s*(\\[(.*?)\\])?(\\s*\\/\\s*\\{(.*?)\\})?\\s*(\\w+);?$","s"),r=Page.codeMirrorEditor6.state.doc.toString().substring(e,t);const o=r.trim().match(n);let a=o[1].trim(),s=o[3]?o[3].trim():o[7]?o[7].trim():null,c=o[5]?o[5].trim():o[9]?o[9].trim():null,d=o[10].trim();s===null&&(s=""),c===null&&(c="");var u=document.createElement("div");u.style.zIndex="1000",u.style.border="1px solid #ccc",u.style.backgroundColor="#f8f8f8",u.style.padding="5px",u.style.position="absolute",u.style.left="50%",u.style.top="50%",u.style.transform="translate(-50%, -50%)",u.id="promptBox";var f=document.createElement("input");f.type="text",f.value=s,f.style.padding="5px",f.style.margin="5px",f.style.width="200px";var v=document.createElement("button");v.textContent="Change/Add Guard",v.style.padding="5px",v.style.marginLeft="5px",u.appendChild(f),u.appendChild(v),document.body.appendChild(u),f.focus();var h=function C(A){document.contains(u)&&A.target!=u&&!u.contains(A.target)&&(document.removeEventListener("mousedown",C),u.remove())};document.addEventListener("mousedown",h),document.addEventListener("keydown",function(C){C.key==="Escape"&&(u.remove(),document.removeEventListener("keydown",arguments.callee))}),v.addEventListener("click",function(){let A=r.trim().split("->");if(A[0]=A[0].trim(),A[1]=A[1].trim(),A.length!=2){console.log("Invalid transition format.");return}let T="";if(f.value.trim()===""){if(s===null||s==="")return;pattern=new RegExp("\\[\\s*(.*?)\\s*\\]","g"),T=r.replace(pattern,"")}else s===null||s===""?(c==null||c===""||A[1].includes(c)?A[0]=a+" ["+f.value.trim()+"]":A[0]=a+" ["+f.value.trim()+"] /{"+c+"}",T=A[0]+" -> "+A[1]):T=r.replace(s,f.value.trim());let j=Page.codeMirrorEditor6.state.doc.toString(),N=j.substring(0,e),p=j.substring(t),b=N+T+p;Page.setCodeMirror6Text(b),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"modifyGuard"),document.removeEventListener("mousedown",h),u.remove(),Action.selectMatchingText(T)}),f.addEventListener("keydown",function(C){C.key==="Enter"&&(C.preventDefault(),C.stopPropagation(),v.click())})},Action.modifyTransitionAction=function(e,t){let n=new RegExp("^(.*?)(\\s*\\[(.*?)\\])?(\\s*\\/\\s*\\{(.*?)\\})?\\s*->\\s*(\\[(.*?)\\])?(\\s*\\/\\s*\\{(.*?)\\})?\\s*(\\w+);?$","s"),r=Page.codeMirrorEditor6.state.doc.toString().substring(e,t);const o=r.trim().match(n);let a=o[3]?o[3].trim():o[7]?o[7].trim():null,s=o[5]?o[5].trim():o[9]?o[9].trim():null;a===null&&(a=""),s===null&&(s="");var c=document.createElement("div");c.style.zIndex="1000",c.style.border="1px solid #ccc",c.style.backgroundColor="#f8f8f8",c.style.padding="5px",c.style.position="absolute",c.style.left="50%",c.style.top="50%",c.style.transform="translate(-50%, -50%)",c.id="promptBox";var d=document.createElement("textarea");d.style.width="300px",d.style.height="100px",d.value=s||"";var u=document.createElement("button");u.textContent="Change/Add Action",u.style.padding="5px",u.style.marginLeft="5px",c.appendChild(d),c.appendChild(u),document.body.appendChild(c),d.focus();var f=function v(h){document.contains(c)&&h.target!=c&&!c.contains(h.target)&&(document.removeEventListener("mousedown",v),c.remove())};document.addEventListener("mousedown",f),document.addEventListener("keydown",function(v){v.key==="Escape"&&(c.remove(),document.removeEventListener("keydown",arguments.callee))}),u.addEventListener("click",function(){let h=r.trim().split("->");if(h[0]=h[0].trim(),h[1]=h[1].trim(),h.length!=2){console.log("Invalid transition format.");return}let C="";if(d.value.trim()===""){if(s===null||s==="")return;pattern=new RegExp("/\\s*\\{.*?\\}\\s*->","g"),C=r.replace(pattern," ->")}else s===null||s===""?C=h[0]+"/{"+d.value.trim()+"} -> "+h[1]:C=r.replace(s,d.value.trim());let A=Page.codeMirrorEditor6.state.doc.toString(),T=A.substring(0,e),j=A.substring(t),N=T+C+j;Page.setCodeMirror6Text(N),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"modifyAction"),document.removeEventListener("mousedown",f),c.remove(),Action.selectMatchingText(C)}),input.addEventListener("keydown",function(v){v.key==="Enter"&&(v.preventDefault(),v.stopPropagation(),u.click())})},Action.modifyTransitionEventName=function(e,t){let n=Page.codeMirrorEditor6.state.doc.toString().substring(e,t),r=new RegExp("^(.*?)\\s*(\\[(.*?)\\])?\\s*(\\/\\s*\\{(.*?)\\})?\\s*->\\s*(\\w+);?$","s");const o=n.match(r);let a=o[1].trim(),s=o[3]?o[3].trim():null,c=o[5]?o[5].trim():null,d=o[6].trim();var u=document.createElement("div");u.style.zIndex="1000",u.style.border="1px solid #ccc",u.style.backgroundColor="#f8f8f8",u.style.padding="5px",u.style.position="absolute",u.style.left="50%",u.style.top="50%",u.style.transform="translate(-50%, -50%)",u.id="promptBox";var f=document.createElement("input");f.type="text",f.value=a,f.style.padding="5px",f.style.margin="5px",f.style.width="200px";var v=document.createElement("button");v.textContent="Change/Add Event Name",v.style.padding="5px",v.style.marginLeft="5px",u.appendChild(f),u.appendChild(v),document.body.appendChild(u),f.focus();var h=function C(A){document.contains(u)&&A.target!=u&&!u.contains(A.target)&&(document.removeEventListener("mousedown",C),u.remove())};document.addEventListener("mousedown",h),document.addEventListener("keydown",function(C){C.key==="Escape"&&(u.remove(),document.removeEventListener("keydown",arguments.callee))}),v.addEventListener("click",function(){if(f.value.trim()===""){console.log("Input for new transition condition is empty.");return}let C=n.replace(a,f.value.trim()),A=Page.codeMirrorEditor6.state.doc.toString(),T=A.substring(0,e),j=A.substring(t),N=T+C+j;Page.setCodeMirror6Text(N),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"renameTransition"),document.removeEventListener("mousedown",h),u.remove(),Action.selectMatchingText(C)}),f.addEventListener("keydown",function(C){C.key==="Enter"&&(C.preventDefault(),C.stopPropagation(),v.click())})},Action.removeContextMenu=function(){var e=document.getElementsByTagName("customContextMenu");e.length!=0&&e.item(0).remove()},Action.setColor=function(e,t,n){let r=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"');if(r.includes("displayColor")){let o="displayColor "+n+";",a=new RegExp("displayColor\\s+.*;");o=r.replace(a,o),Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:Page.codeMirrorEditor6.state.doc.toString().replace(r,o)}}),setTimeout(function(){TabControl.getCurrentHistory().save(Page.getUmpleCode(),"setColor")},100)}else{let o="{  displayColor "+n+`;
`;o=r.substr(0,r.indexOf("{"))+o+r.substr(r.indexOf("{")+1,r.length-r.indexOf("{")-1),Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:Page.codeMirrorEditor6.state.doc.toString().replace(r,o)}})}},Action.filterOnOneClass=function(e){Page.filterWordsOutput.length==0||Page.filterWordsOutput.includes("~")?Action.setFilterFull(e,!0):Action.setFilterFull(`${Page.filterWordsOutput} ${e}`,!0);var t=jQuery("#filtervalues").val();t.includes("*")||t.includes("~")?jQuery("#filtervalues").val(e):jQuery("#filtervalues").val(t+" "+e),Action.removeContextMenu()},Action.clearFilterOnOneClass=function(e){Page.filterWordsOutput=Page.filterWordsOutput.replace(`${e}!@`,""),Action.setFilterFull(Page.filterWordsOutput.trim(),!0);let t=jQuery("#filtervalues").val();if(t.length-e.length<2)jQuery("#filtervalues").val("*");else{let n=t.replace(e,"");jQuery("#filtervalues").val(n)}Action.removeContextMenu()},Action.hideClass=function(e){Page.filterWordsOutput.includes("*")?Action.setFilterFull(`~${e}`,!0):Action.setFilterFull(Page.filterWordsOutput+"~"+e,!0);var t=jQuery("#filtervalues").val();if(t.includes("*")){let n="~"+e;jQuery("#filtervalues").val(n)}else jQuery("#filtervalues").val(t+" ~"+e);Action.removeContextMenu()},Action.unHideClasses=function(){let e=Action.removeHiddenClasses(Page.filterWordsOutput),t=Action.removeHiddenClasses(jQuery("#filtervalues").val());Action.setFilterFull(e,!0),jQuery("#filtervalues").val(t),Action.removeContextMenu()},Action.removeHiddenClasses=function(e){const t=/~\w+!?@?/g;return e.replace(t,"").replace(/\s+/g,"").trim()},Action.getGvPosition=function(e,t){var n=new RegExp("class[\\s]*"+t+"[\\s]{([\\sa-zA-Z\\:\\.\\,\\;\\-\\_0-9]*)\\s*position ([\\d.]*) ([\\d.]*) ([\\d.]*) ([\\d.]*);([\\sa-zA-Z\\:\\.\\,\\;\\-\\_0-9]*)}","s"),r=e.match(n);if(r==null)return null;var o={all:r[0],assoc1:r[1],x:r[2],y:r[3],width:r[4],height:r[5],assoc2:r[6]};return o},Action.updateGvPosition=function(e,t,n){var r=jQuery("#umpleLayoutEditorText").val(),o=Action.getGvPosition(r,e);if(o==null)return null;var a=o.all,s=o.x,c=o.y,d=o.assoc1,u=o.assoc2;return Action.updateGVPositionBasic(e,t,n,r,a,s,c,d,u,!0)},Action.updateGVPositionBasic=function(e,t,n,r,o,a,s,c,d,u){var f=Math.round(Math.max(Number(a)+t,5)),v=Math.round(Math.max(Number(s)+n,5)),h=o.replace("position "+a+" "+s,"position "+f+" "+v);c!=null&&(h=h.replace(""+c,`
`)),d!=null&&(h=h.replace(""+d,`
`)),Page.setUmplePositioningCode(r.replace(o,h)),u&&(setTimeout(function(){TabControl.getCurrentHistory().save(Page.getUmpleCode(),"moveClass")},100),Action.redrawDiagram())},Action.drawInput=function(e,t,n,r){var o=document.createElement("div");o.style.zIndex="1000",o.style.border="1px solid #ccc",o.style.backgroundColor="#f8f8f8",o.style.padding="5px",o.style.position="fixed",o.id="promptBox";var a=o.getBoundingClientRect();event.clientX+a.width>window.innerWidth?o.style.right=window.innerWidth-event.clientX+"px":o.style.left=event.clientX+"px",event.clientY+a.height>window.innerHeight?o.style.bottom=window.innerHeight-event.clientY+"px":o.style.top=event.clientY+"px";var s=document.createElement("input");s.type="text",s.style.padding="5px",s.style.borderRadius="3px",s.style.border="1px solid #ccc",s.style.width="200px",s.style.marginLeft="5px";var c=document.createElement("label");c.type="label",c.textContent="Error - Please enter an alphanumeric name.",c.style.color="red";var d=function L(P){document.contains(o)&&P.target!=o&&!o.contains(P.target)&&(document.removeEventListener("mousedown",L),o.remove())};if(document.addEventListener("mousedown",d),e=="attri"){var u=document.createElement("select"),f=document.createElement("option");f.value="String",f.text="String";var v=document.createElement("option");v.value="Integer",v.text="Integer";var h=document.createElement("option");h.value="Double",h.text="Double";var C=document.createElement("option");C.value="Float",C.text="Float";var A=document.createElement("option");A.value="Boolean",A.text="Boolean";var T=document.createElement("option");T.value="Date",T.text="Date";var j=document.createElement("option");j.value="Time",j.text="Time",u.add(f),u.add(v),u.add(h),u.add(C),u.add(A),u.add(T),u.add(j),o.appendChild(u);var s=document.createElement("input");s.type="text",s.style.padding="5px",s.style.borderRadius="3px",s.style.border="1px solid #ccc",s.style.width="200px",s.style.marginLeft="5px",s.addEventListener("keydown",function(P){if(P.key==="Enter")if(Action.validateAttributeName(s.value)){let S=t.replaceAll("&#10",`
`).replaceAll("&#$quot",'"'),k;if(s.value.includes(":")){let I=s.value.split(":");k=S.substr(0,S.length-1)+"  "+I[1].trim()+" "+I[0].trim()+`;
}`}else k=S.substr(0,S.length-1)+"  "+u.value+" "+s.value+`;
}`;const O=Page.codeMirrorEditor6.state.doc.length,R=Page.codeMirrorEditor6.state.doc.toString().replace(S,k);Page.codeMirrorEditor6.dispatch({changes:{from:0,to:O,insert:R}}),document.removeEventListener("mousedown",d),o.remove(),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate")}else document.contains(c)||o.appendChild(c)}),o.appendChild(s)}else if(e=="rename"){var N=document.createElement("label");N.htmlFor="replace-all-checkbox",N.style.marginRight="5px",N.appendChild(document.createTextNode("New name for '"+n+"'?")),s.value=n,s.addEventListener("keydown",function(L){if(L.key==="Enter")if(Action.validateAttributeName(s.value)){let S=Page.codeMirrorEditor6.state.doc.toString();S=Action.renameClassAssistant(S,n,s.value.trim()),Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:S}});var P=jQuery("#umpleLayoutEditorText").val();P=Action.renameClassAssistant(P,n,s.value.trim()),Page.setUmplePositioningCode(P),document.removeEventListener("mousedown",d),o.remove(),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate")}else document.contains(c)||o.appendChild(c)}),o.appendChild(N),o.appendChild(s)}else if(e=="subclass")s.addEventListener("keydown",function(L){if(L.key==="Enter")if(Action.validateAttributeName(s.value)){let P=`
class `+s.value+`
`,Action.copyToClp(e+Page.getUmpleCode()+t),Page.setFeedbackMessage("Shell code to compile on command line was copied to clipboard")},Action.showCodeInSeparateWindow=function(){const e=new Date,t=o=>String(o).padStart(2,"0"),n=`// UmpleOnline code as of ${e.getFullYear()+t(e.getMonth()+1)+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())}

`+Page.getUmpleCode();codeWindow=window.open("","UmpleCode","height=700, width=400, left=100, top=100, location=no, status=no, scrollbars=yes"),codeWindow.document.write('<code><pre id="umpleCode">'+n+"</pre></code>"),codeWindow.document.title="Umple raw code",codeWindow.document.close()},Action.showEncodedURLCodeInSeparateWindow=function(){const t=Page.getEncodedURL(),r=t.length;let a="";r>2e3?(a="// WARNING: Encoded URL length ("+r+` characters)
// exceeds recommended limit (2000).
// Use Save & Collaborate for larger models.

`,Page.setFeedbackMessage("Encoded URL too long ("+r+" chars). Use Save & Collaborate instead.")):Page.setFeedbackMessage("Encoded URL generated ("+r+" chars). Ideal for PowerPoint embedding.");const n=a+t;codeWindow=window.open("","UmpleEncodedURL","height=500, width=520, left=100, top=100, location=no, status=no, scrollbars=yes"),codeWindow.document.write('<code><pre id="umpleCode">'+n+"</pre></code>"),codeWindow.document.title="Umple encoded URL",codeWindow.document.close()},Action.simulateCode=function(){simulateButtonSelector="#buttonSimulateCode",jQuery(simulateButtonSelector).showLoading(),Action.ajax(Action.simulateCodeCallback,"language=Simulate")},Action.simulateCodeCallback=function(e){simulateButtonSelector="#buttonSimulateCode",jQuery(simulateButtonSelector).hideLoading();var t=e.responseText;window.open("../umpleonline/simulate.php?model="+t,"umpleSimulator"),Page.showViewDone()},Action.drawInputState=function(e,t,r){var a=document.createElement("div");a.style.zIndex="1000",a.style.border="1px solid #ccc",a.style.backgroundColor="#f8f8f8",a.style.padding="5px",a.style.position="fixed",a.id="promptBox";var n=a.getBoundingClientRect();event.clientX+n.width>window.innerWidth?a.style.right=window.innerWidth-event.clientX+"px":a.style.left=event.clientX+"px",event.clientY+n.height>window.innerHeight?a.style.bottom=window.innerHieght-event.clientY+"px":a.style.top=event.clientY+"px";var o=document.createElement("input");o.type="text",o.style.padding="5px",o.style.borderRadius="3px",o.style.border="1px solid #ccc",o.style.width="200px",o.style.marginLeft="5px";var u=document.createElement("label");u.type="label",u.textContent="Error - Please enter an alphanumeric name beginning with a non-numeric character.",u.style.color="red";var s=function f(C){document.contains(a)&&C.target!=a&&!a.contains(C.target)&&(document.removeEventListener("mousedown",f),a.remove())},d=t.replaceAll("&#10",`
`).replaceAll("&#$quot",'"'),c=document.createElement("label");c.htmlFor="inputLabel",c.style.marginRight="5px",document.addEventListener("mousedown",s),e=="rename"?(clientDebuggerFlag&&console.log("Renaming State ..."),c.appendChild(document.createTextNode("New name for '"+r+"'?")),o.value=r,o.addEventListener("keydown",function(f){if(f.key==="Enter")if(Action.validateAttributeName(o.value)){clientDebuggerFlag&&console.log("Getting code from codemirror editor ...");let C=Page.codeMirrorEditor6.state.doc.toString(),m=new RegExp("(\\W+)("+r+")(\\W+)"),E;for(;(E=C.match(m))!=null;)C=C.substr(0,E.index+E[1].length)+o.value.trim()+C.substr(E.index+E[1].length+E[2].length,C.length-(E.index+E[1].length+E[2].length));clientDebuggerFlag&&console.log("Setting updated code to codemirror editor ..."),Page.setCodeMirror6Text(C),setTimeout('Action.processTyping("newEditor",false)',Action.waiting_time),document.removeEventListener("mousedown",s),clientDebuggerFlag&&console.log("Removing mousedown event ..."),a.remove(),Action.removeContextMenu(),TabControl.getCurrentHistory().save(C,"menuUpdate")}else document.contains(u)||a.appendChild(u)})):e=="substate"?(clientDebuggerFlag&&console.log("Substating state ..."),c.appendChild(document.createTextNode("Name of new substate?")),o.addEventListener("keydown",function(f){if(f.key==="Enter")if(Action.validateAttributeName(o.value)){let C=d.substr(0,d.length-1)+"  "+o.value+"{}}";clientDebuggerFlag&&console.log("Getting original code and adding substate ..."),C=Page.codeMirrorEditor6.state.doc.toString().replace(d,C),clientDebuggerFlag&&console.log("Setting updated code with substate into codemirror editor ..."),Page.setCodeMirror6Text(C),setTimeout('Action.processTyping("newEditor",false)',Action.waiting_time),document.removeEventListener("mousedown",s),clientDebuggerFlag&&console.log("Removing mousedown event ..."),a.remove(),Action.removeContextMenu(),TabControl.getCurrentHistory().save(C,"menuUpdate")}else document.contains(u)||a.appendChild(u)})):e=="transition"&&(clientDebuggerFlag&&console.log("Adding Transition ..."),c.appendChild(document.createTextNode("Condition for new transition?")),o.addEventListener("keydown",function(f){if(f.key==="Enter")if(Action.validateAttributeName(o.value)){var C=t.replaceAll("&#10",`
`).replaceAll("&#$quot",'"');document.removeEventListener("mousedown",s),a.remove(),Action.removeContextMenu(),clientDebuggerFlag&&console.log("Waiting to select target state for transition ...");var m=function(S){let P=S.target;for(;P.parentElement.id!="graph0";)P=P.parentNode;let N=P.outerHTML.substr(P.outerHTML.indexOf("stateClicked(&quot;")+19,P.outerHTML.indexOf('&quot;)"')-(P.outerHTML.indexOf("stateClicked(&quot;")+19));N=N.split("^*^");let R="  "+o.value+" -> "+N[2]+`;
}`,g=C.substr(0,C.length-1)+R;clientDebuggerFlag&&(console.log("New state created ..."),console.log("Replacing original state with new state in the code ...")),Page.setCodeMirror6Text(Page.codeMirrorEditor6.state.doc.toString().replace(C,g)),setTimeout('Action.processTyping("newEditor",false)',Action.waiting_time),TabControl.getCurrentHistory().save(Page.codeMirrorEditor6.state.doc.toString(),"menuUpdate");let v=document.getElementsByClassName("node");for(let M=0;M<v.length;M++)v[M].removeEventListener("mousedown",m);E=document.getElementsByClassName("cluster");for(let M=0;M<v.length;M++)v[M].removeEventListener("mousedown",m)},E=document.getElementsByClassName("node");for(let S=0;S<E.length;S++)E[S].addEventListener("mousedown",m);E=document.getElementsByClassName("cluster");for(let S=0;S<E.length;S++)E[S].addEventListener("mousedown",m)}else document.contains(u)||a.appendChild(u)})),a.appendChild(c),a.appendChild(o),document.body.appendChild(a),o.focus()},Action.deleteState=function(e,t,r,a){let n=a.split(",");clientDebuggerFlag&&console.log("Getting code from codemirror editor ...");let o=Page.codeMirrorEditor6.state.doc.toString();clientDebuggerFlag&&console.log("Deleting State: ",a);let u=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"');o=o.replace(u,"");let s=new RegExp("[^{};]*->\\s*([^\\S\\s]*|\\s*)(\\/\\s*{[^}]*})*([^\\S\\s]*|\\s*)("+n[n.length-1]+")(\\s+\\w+)*\\s*;"),d;for(;(d=o.match(s))!=null;)o=o.substr(0,d.index)+o.substr(d.index+d[0].length,o.length-(d.index+d[0].length));clientDebuggerFlag&&console.log("Setting updated code to codemirror editor ..."),Page.setCodeMirror6Text(o),setTimeout('Action.processTyping("newEditor",false)',Action.waiting_time),TabControl.getCurrentHistory().save(o,"menuUpdate"),Action.removeContextMenu()},Action.drawStateMenu=function(){if(Action.diagramInSync){Action.removeContextMenu();for(var e=event.target;e.parentElement.id!="graph0";)e=e.parentNode;var t=e.outerHTML.substr(e.outerHTML.indexOf("stateClicked(&quot;")+19,e.outerHTML.indexOf('&quot;)"')-(e.outerHTML.indexOf("stateClicked(&quot;")+19));t=t.split("^*^"),t[2]=t[2].split(".");var r=Page.codeMirrorEditor6.state.doc.toString(),a=Action.selectStateInClassCM6(t[0],t[1],t[2][0]);for(let m=1;m<t[2].length;m++)a=Action.selectStateInStateCM6(a.startIndex,a.endIndex,t[2][m]);var n=r.substr(a.startIndex,a.endIndex-a.startIndex);if(typeof n=="string"){var o=document.createElement("customContextMenu"),u=["Rename State","Delete State","Add Substate","Add Transition"],s=n.replaceAll(`
`,"&#10").replaceAll('"',"&#$quot"),d=['Action.drawInputState("rename","'+s+'","'+t[2][t[2].length-1]+'")','Action.deleteState("'+s+'","'+t[0]+'","'+t[1]+'","'+t[2]+'")','Action.drawInputState("substate","'+s+'","'+t[2][t[2].length-1]+'")','Action.drawInputState("transition","'+s+'","'+t[2][t[2].length-1]+'")'];o.style.zIndex="1000",o.style.border="1px solid #ccc",o.style.backgroundColor="#f8f8f8",o.style.padding="5px",o.style.position="fixed";for(var c=0;c<u.length;c++){var f=document.createElement("div");f.style.padding="5px",f.style.borderRadius="3px",f.style.cursor="pointer",f.style.transition="background-color 0.3s",f.textContent=u[c],f.setAttribute("onclick","javascript:"+d[c]),f.addEventListener("mouseover",function(){this.style.backgroundColor="#ddd"}),f.addEventListener("mouseout",function(){this.style.backgroundColor="transparent"}),o.appendChild(f)}var C=o.getBoundingClientRect();event.clientX+C.width>window.innerWidth?o.style.right=window.innerWidth-event.clientX+"px":o.style.left=event.clientX+"px",event.clientY+C.height>window.innerHeight?o.style.bottom=window.innerHieght-event.clientY+"px":o.style.top=event.clientY+"px",document.addEventListener("mousedown",function m(E){var S=document.getElementById("promptBox");E.target!=o&&!o.contains(E.target)&&(S!=null&&E.target!=S&&S.contains(E.target),document.removeEventListener("mousedown",m),Action.removeContextMenu())}),document.body.appendChild(o)}}},Action.displayTransitionMenu=function(e){if(!Action.diagramInSync)return;Action.removeContextMenu();for(var t=e.target;t.parentElement.id!="graph0";)t=t.parentNode;var r=t.outerHTML.substr(t.outerHTML.indexOf("transitionClicked(&quot;")+24,t.outerHTML.indexOf('&quot;)"')-(t.outerHTML.indexOf("transitionClicked(&quot;")+24));r=r.replaceAll("&amp;","&");let a=r.split("*^*"),n=a[3].split(".");dest=a[4].split(".");for(var o=Action.selectStateInClassCM6(a[0],a[1],n[0]),u=1;u<n.length;u++)o=Action.selectStateInStateCM6(o.startIndex,o.endIndex,n[u]);let s=a[2].replaceAll("+","\\+").replaceAll("-","\\-").replaceAll("*","\\*").replaceAll("?","\\?").replaceAll("|","\\|");if(s=s.replace("after","after~`~?:Every`~`?"),a[5]!=""){let k=a[5].trim().replaceAll("+","\\+").replaceAll("-","\\-").replaceAll("*","\\*").replaceAll("?","\\?").replaceAll("|","\\|");s=s+"\\s*[\\s*"+k.trim().slice(1,k.trim().length-1)+"\\s*]"}s=s.replaceAll("]","\\]").replaceAll("[","\\[").replaceAll(")","\\)?").replaceAll("(","\\(?").replaceAll("~`~","(").replaceAll("`~`",")").replaceAll(" ","\\s*").replaceAll(",","\\s*,\\s*").replaceAll("!","\\s*!\\s*").replaceAll("/","\\s*/\\s*"),s=s.replaceAll("&&","&{1,2}");let d=new RegExp(s+".*->","s"),c=Page.codeMirrorEditor6.state.doc.toString().substr(o.startIndex,o.endIndex-o.startIndex).search(d)+o.startIndex,f=Page.codeMirrorEditor6.state.doc.toString().substr(c),C=Action.findEOL(f);if(C.split("->").length-1!==1){Page.setFeedbackMessage(" Please edit this complex transition in the textual code.");return}let m=c+C.length,E=Page.codeMirrorEditor6.state.doc.toString().substring(c,m),S=new RegExp("^(.*?)(\\s*\\[(.*?)\\])?(\\s*\\/\\s*\\{(.*?)\\})?\\s*->\\s*(\\[(.*?)\\])?(\\s*\\/\\s*\\{(.*?)\\})?\\s*(\\w+);?$","s");const P=E.trim().match(S);let N=P[1].trim(),R=P[3]?P[3].trim():P[7]?P[7].trim():null,g=P[5]?P[5].trim():P[9]?P[9].trim():null,v=P[10].trim();R===null&&(R=""),g===null&&(g="");var M=document.createElement("customContextMenu"),L=["Change or Add Event Name","Change or Add Guard","Change or Add Action","Change Destination State","Delete Transition"],T=['Action.modifyTransitionEventName("'+c+'","'+m+'")','Action.modifyTransitionGuard("'+c+'","'+m+'")','Action.modifyTransitionAction("'+c+'","'+m+'")','Action.changeTransition("'+v+'","'+c+'","'+m+'")','Action.deleteTransition("'+c+'","'+m+'")'];M.style.zIndex="1000",M.style.border="1px solid #ccc",M.style.backgroundColor="#f8f8f8",M.style.padding="5px",M.style.position="fixed";for(var u=0;u<L.length;u++){var A=document.createElement("div");A.style.padding="5px",A.style.borderRadius="3px",A.style.cursor="pointer",A.style.transition="background-color 0.3s",A.textContent=L[u],A.setAttribute("onclick","javascript:"+T[u]),A.addEventListener("mouseover",function(){this.style.backgroundColor="#ddd"}),A.addEventListener("mouseout",function(){this.style.backgroundColor="transparent"}),M.appendChild(A)}var j=M.getBoundingClientRect();e.clientX+j.width>window.innerWidth?M.style.right=window.innerWidth-e.clientX+"px":M.style.left=e.clientX+"px",e.clientY+j.height>window.innerHeight?M.style.bottom=window.innerHieght-e.clientY+"px":M.style.top=e.clientY+"px",document.addEventListener("mousedown",function k(U){var _=document.getElementById("promptBox");U.target!=M&&!M.contains(U.target)&&(_!=null&&U.target!=_&&_.contains(U.target),document.removeEventListener("mousedown",k),Action.removeContextMenu())}),document.addEventListener("keydown",function k(U){var _=document.getElementById("promptBox");U.target!=M&&!M.contains(U.target)&&U.key==="Escape"&&(_!=null&&U.target!=_&&_.contains(U.target),document.removeEventListener("keydown",k),Action.removeContextMenu())}),document.body.appendChild(M)},Action.changeTransition=function(e,t,r){let o=Page.codeMirrorEditor6.state.doc.toString().substring(t,r).trim().replace(/;$/,"").split("->");if(o[0]=o[0].trim(),o[1]=o[1].trim(),o.length!=2){console.log("Invalid transition format.");return}var u=document.createElement("div");u.style.zIndex="1000",u.style.border="1px solid #ccc",u.style.backgroundColor="#f8f8f8",u.style.padding="5px",u.style.position="absolute",u.style.left="50%",u.style.top="50%",u.style.transform="translate(-50%, -50%)",u.id="promptBox";var s=document.createElement("input");s.type="text",s.value=o[1],s.style.padding="5px",s.style.margin="5px",s.style.width="200px";var d=document.createElement("button");d.textContent="Change Destination",d.style.padding="5px",d.style.marginLeft="5px",u.appendChild(s),u.appendChild(d),document.body.appendChild(u),s.focus();var c=function f(C){document.contains(u)&&C.target!=u&&!u.contains(C.target)&&(document.removeEventListener("mousedown",f),u.remove())};document.addEventListener("mousedown",c),document.addEventListener("keydown",function(f){f.key==="Escape"&&(u.remove(),document.removeEventListener("keydown",arguments.callee))}),d.addEventListener("click",function(){if(s.value.trim()===""){console.log("Input for new destination state is empty.");return}let f=o[0]+" -> "+o[1].replace(e,s.value.trim())+";",C=Page.codeMirrorEditor6.state.doc.toString(),m=C.substring(0,t),E=C.substring(r),S=m+f+E;Page.setCodeMirror6Text(S),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"changeTransitionDestination"),document.removeEventListener("mousedown",c),u.remove(),Action.selectMatchingText(f)}),s.addEventListener("keydown",function(f){f.key==="Enter"&&(f.preventDefault(),f.stopPropagation(),d.click())})},Action.deleteTransition=function(e,t){let r=Page.codeMirrorEditor6.state.doc.toString().substring(e,t),a=Page.codeMirrorEditor6.state.doc.toString();a=a.replace(r,""),Page.setCodeMirror6Text(a),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate")},Action.modifyTransitionGuard=function(e,t){let r=new RegExp("^(.*?)(\\s*\\[(.*?)\\])?(\\s*\\/\\s*\\{(.*?)\\})?\\s*->\\s*(\\[(.*?)\\])?(\\s*\\/\\s*\\{(.*?)\\})?\\s*(\\w+);?$","s"),a=Page.codeMirrorEditor6.state.doc.toString().substring(e,t);const n=a.trim().match(r);let o=n[1].trim(),u=n[3]?n[3].trim():n[7]?n[7].trim():null,s=n[5]?n[5].trim():n[9]?n[9].trim():null,d=n[10].trim();u===null&&(u=""),s===null&&(s="");var c=document.createElement("div");c.style.zIndex="1000",c.style.border="1px solid #ccc",c.style.backgroundColor="#f8f8f8",c.style.padding="5px",c.style.position="absolute",c.style.left="50%",c.style.top="50%",c.style.transform="translate(-50%, -50%)",c.id="promptBox";var f=document.createElement("input");f.type="text",f.value=u,f.style.padding="5px",f.style.margin="5px",f.style.width="200px";var C=document.createElement("button");C.textContent="Change/Add Guard",C.style.padding="5px",C.style.marginLeft="5px",c.appendChild(f),c.appendChild(C),document.body.appendChild(c),f.focus();var m=function E(S){document.contains(c)&&S.target!=c&&!c.contains(S.target)&&(document.removeEventListener("mousedown",E),c.remove())};document.addEventListener("mousedown",m),document.addEventListener("keydown",function(E){E.key==="Escape"&&(c.remove(),document.removeEventListener("keydown",arguments.callee))}),C.addEventListener("click",function(){let S=a.trim().split("->");if(S[0]=S[0].trim(),S[1]=S[1].trim(),S.length!=2){console.log("Invalid transition format.");return}let P="";if(f.value.trim()===""){if(u===null||u==="")return;pattern=new RegExp("\\[\\s*(.*?)\\s*\\]","g"),P=a.replace(pattern,"")}else u===null||u===""?(s==null||s===""||S[1].includes(s)?S[0]=o+" ["+f.value.trim()+"]":S[0]=o+" ["+f.value.trim()+"] /{"+s+"}",P=S[0]+" -> "+S[1]):P=a.replace(u,f.value.trim());let N=Page.codeMirrorEditor6.state.doc.toString(),R=N.substring(0,e),g=N.substring(t),v=R+P+g;Page.setCodeMirror6Text(v),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"modifyGuard"),document.removeEventListener("mousedown",m),c.remove(),Action.selectMatchingText(P)}),f.addEventListener("keydown",function(E){E.key==="Enter"&&(E.preventDefault(),E.stopPropagation(),C.click())})},Action.modifyTransitionAction=function(e,t){let r=new RegExp("^(.*?)(\\s*\\[(.*?)\\])?(\\s*\\/\\s*\\{(.*?)\\})?\\s*->\\s*(\\[(.*?)\\])?(\\s*\\/\\s*\\{(.*?)\\})?\\s*(\\w+);?$","s"),a=Page.codeMirrorEditor6.state.doc.toString().substring(e,t);const n=a.trim().match(r);let o=n[3]?n[3].trim():n[7]?n[7].trim():null,u=n[5]?n[5].trim():n[9]?n[9].trim():null;o===null&&(o=""),u===null&&(u="");var s=document.createElement("div");s.style.zIndex="1000",s.style.border="1px solid #ccc",s.style.backgroundColor="#f8f8f8",s.style.padding="5px",s.style.position="absolute",s.style.left="50%",s.style.top="50%",s.style.transform="translate(-50%, -50%)",s.id="promptBox";var d=document.createElement("textarea");d.style.width="300px",d.style.height="100px",d.value=u||"";var c=document.createElement("button");c.textContent="Change/Add Action",c.style.padding="5px",c.style.marginLeft="5px",s.appendChild(d),s.appendChild(c),document.body.appendChild(s),d.focus();var f=function C(m){document.contains(s)&&m.target!=s&&!s.contains(m.target)&&(document.removeEventListener("mousedown",C),s.remove())};document.addEventListener("mousedown",f),document.addEventListener("keydown",function(C){C.key==="Escape"&&(s.remove(),document.removeEventListener("keydown",arguments.callee))}),c.addEventListener("click",function(){let m=a.trim().split("->");if(m[0]=m[0].trim(),m[1]=m[1].trim(),m.length!=2){console.log("Invalid transition format.");return}let E="";if(d.value.trim()===""){if(u===null||u==="")return;pattern=new RegExp("/\\s*\\{.*?\\}\\s*->","g"),E=a.replace(pattern," ->")}else u===null||u===""?E=m[0]+"/{"+d.value.trim()+"} -> "+m[1]:E=a.replace(u,d.value.trim());let S=Page.codeMirrorEditor6.state.doc.toString(),P=S.substring(0,e),N=S.substring(t),R=P+E+N;Page.setCodeMirror6Text(R),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"modifyAction"),document.removeEventListener("mousedown",f),s.remove(),Action.selectMatchingText(E)}),input.addEventListener("keydown",function(C){C.key==="Enter"&&(C.preventDefault(),C.stopPropagation(),c.click())})},Action.modifyTransitionEventName=function(e,t){let r=Page.codeMirrorEditor6.state.doc.toString().substring(e,t),a=new RegExp("^(.*?)\\s*(\\[(.*?)\\])?\\s*(\\/\\s*\\{(.*?)\\})?\\s*->\\s*(\\w+);?$","s");const n=r.match(a);let o=n[1].trim(),u=n[3]?n[3].trim():null,s=n[5]?n[5].trim():null,d=n[6].trim();var c=document.createElement("div");c.style.zIndex="1000",c.style.border="1px solid #ccc",c.style.backgroundColor="#f8f8f8",c.style.padding="5px",c.style.position="absolute",c.style.left="50%",c.style.top="50%",c.style.transform="translate(-50%, -50%)",c.id="promptBox";var f=document.createElement("input");f.type="text",f.value=o,f.style.padding="5px",f.style.margin="5px",f.style.width="200px";var C=document.createElement("button");C.textContent="Change/Add Event Name",C.style.padding="5px",C.style.marginLeft="5px",c.appendChild(f),c.appendChild(C),document.body.appendChild(c),f.focus();var m=function E(S){document.contains(c)&&S.target!=c&&!c.contains(S.target)&&(document.removeEventListener("mousedown",E),c.remove())};document.addEventListener("mousedown",m),document.addEventListener("keydown",function(E){E.key==="Escape"&&(c.remove(),document.removeEventListener("keydown",arguments.callee))}),C.addEventListener("click",function(){if(f.value.trim()===""){console.log("Input for new transition condition is empty.");return}let E=r.replace(o,f.value.trim()),S=Page.codeMirrorEditor6.state.doc.toString(),P=S.substring(0,e),N=S.substring(t),R=P+E+N;Page.setCodeMirror6Text(R),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"renameTransition"),document.removeEventListener("mousedown",m),c.remove(),Action.selectMatchingText(E)}),f.addEventListener("keydown",function(E){E.key==="Enter"&&(E.preventDefault(),E.stopPropagation(),C.click())})},Action.removeContextMenu=function(){var e=document.getElementsByTagName("customContextMenu");e.length!=0&&e.item(0).remove()},Action.setColor=function(e,t,r){let a=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"');if(a.includes("displayColor")){let n="displayColor "+r+";",o=new RegExp("displayColor\\s+.*;");n=a.replace(o,n),Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:Page.codeMirrorEditor6.state.doc.toString().replace(a,n)}}),setTimeout(function(){TabControl.getCurrentHistory().save(Page.getUmpleCode(),"setColor")},100)}else{let n="{  displayColor "+r+`;
`;n=a.substr(0,a.indexOf("{"))+n+a.substr(a.indexOf("{")+1,a.length-a.indexOf("{")-1),Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:Page.codeMirrorEditor6.state.doc.toString().replace(a,n)}})}},Action.filterOnOneClass=function(e){Page.filterWordsOutput.length==0||Page.filterWordsOutput.includes("~")?Action.setFilterFull(e,!0):Action.setFilterFull(`${Page.filterWordsOutput} ${e}`,!0);var t=jQuery("#filtervalues").val();t.includes("*")||t.includes("~")?jQuery("#filtervalues").val(e):jQuery("#filtervalues").val(t+" "+e),Action.removeContextMenu()},Action.clearFilterOnOneClass=function(e){Page.filterWordsOutput=Page.filterWordsOutput.replace(`${e}!@`,""),Action.setFilterFull(Page.filterWordsOutput.trim(),!0);let t=jQuery("#filtervalues").val();if(t.length-e.length<2)jQuery("#filtervalues").val("*");else{let r=t.replace(e,"");jQuery("#filtervalues").val(r)}Action.removeContextMenu()},Action.hideClass=function(e){Page.filterWordsOutput.includes("*")?Action.setFilterFull(`~${e}`,!0):Action.setFilterFull(Page.filterWordsOutput+"~"+e,!0);var t=jQuery("#filtervalues").val();if(t.includes("*")){let r="~"+e;jQuery("#filtervalues").val(r)}else jQuery("#filtervalues").val(t+" ~"+e);Action.removeContextMenu()},Action.unHideClasses=function(){let e=Action.removeHiddenClasses(Page.filterWordsOutput),t=Action.removeHiddenClasses(jQuery("#filtervalues").val());Action.setFilterFull(e,!0),jQuery("#filtervalues").val(t),Action.removeContextMenu()},Action.removeHiddenClasses=function(e){const t=/~\w+!?@?/g;return e.replace(t,"").replace(/\s+/g,"").trim()},Action.getGvPosition=function(e,t){var r=new RegExp("class[\\s]*"+t+"[\\s]{([\\sa-zA-Z\\:\\.\\,\\;\\-\\_0-9]*)\\s*position ([\\d.]*) ([\\d.]*) ([\\d.]*) ([\\d.]*);([\\sa-zA-Z\\:\\.\\,\\;\\-\\_0-9]*)}","s"),a=e.match(r);if(a==null)return null;var n={all:a[0],assoc1:a[1],x:a[2],y:a[3],width:a[4],height:a[5],assoc2:a[6]};return n},Action.updateGvPosition=function(e,t,r){var a=jQuery("#umpleLayoutEditorText").val(),n=Action.getGvPosition(a,e);if(n==null)return null;var o=n.all,u=n.x,s=n.y,d=n.assoc1,c=n.assoc2;return Action.updateGVPositionBasic(e,t,r,a,o,u,s,d,c,!0)},Action.updateGVPositionBasic=function(e,t,r,a,n,o,u,s,d,c){var f=Math.round(Math.max(Number(o)+t,5)),C=Math.round(Math.max(Number(u)+r,5)),m=n.replace("position "+o+" "+u,"position "+f+" "+C);s!=null&&(m=m.replace(""+s,`
`)),d!=null&&(m=m.replace(""+d,`
`)),Page.setUmplePositioningCode(a.replace(n,m)),c&&(setTimeout(function(){TabControl.getCurrentHistory().save(Page.getUmpleCode(),"moveClass")},100),Action.redrawDiagram())},Action.drawInput=function(e,t,r,a){var n=document.createElement("div");n.style.zIndex="1000",n.style.border="1px solid #ccc",n.style.backgroundColor="#f8f8f8",n.style.padding="5px",n.style.position="fixed",n.id="promptBox";var o=n.getBoundingClientRect();event.clientX+o.width>window.innerWidth?n.style.right=window.innerWidth-event.clientX+"px":n.style.left=event.clientX+"px",event.clientY+o.height>window.innerHeight?n.style.bottom=window.innerHeight-event.clientY+"px":n.style.top=event.clientY+"px";var u=document.createElement("input");u.type="text",u.style.padding="5px",u.style.borderRadius="3px",u.style.border="1px solid #ccc",u.style.width="200px",u.style.marginLeft="5px";var s=document.createElement("label");s.type="label",s.textContent="Error - Please enter an alphanumeric name.",s.style.color="red";var d=function L(T){document.contains(n)&&T.target!=n&&!n.contains(T.target)&&(document.removeEventListener("mousedown",L),n.remove())};if(document.addEventListener("mousedown",d),e=="attri"){var c=document.createElement("select"),f=document.createElement("option");f.value="String",f.text="String";var C=document.createElement("option");C.value="Integer",C.text="Integer";var m=document.createElement("option");m.value="Double",m.text="Double";var E=document.createElement("option");E.value="Float",E.text="Float";var S=document.createElement("option");S.value="Boolean",S.text="Boolean";var P=document.createElement("option");P.value="Date",P.text="Date";var N=document.createElement("option");N.value="Time",N.text="Time",c.add(f),c.add(C),c.add(m),c.add(E),c.add(S),c.add(P),c.add(N),n.appendChild(c);var u=document.createElement("input");u.type="text",u.style.padding="5px",u.style.borderRadius="3px",u.style.border="1px solid #ccc",u.style.width="200px",u.style.marginLeft="5px",u.addEventListener("keydown",function(T){if(T.key==="Enter")if(Action.validateAttributeName(u.value)){let A=t.replaceAll("&#10",`
`).replaceAll("&#$quot",'"'),j;if(u.value.includes(":")){let _=u.value.split(":");j=A.substr(0,A.length-1)+"  "+_[1].trim()+" "+_[0].trim()+`;
}`}else j=A.substr(0,A.length-1)+"  "+c.value+" "+u.value+`;
}`;const k=Page.codeMirrorEditor6.state.doc.length,U=Page.codeMirrorEditor6.state.doc.toString().replace(A,j);Page.codeMirrorEditor6.dispatch({changes:{from:0,to:k,insert:U}}),document.removeEventListener("mousedown",d),n.remove(),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate")}else document.contains(s)||n.appendChild(s)}),n.appendChild(u)}else if(e=="rename"){var R=document.createElement("label");R.htmlFor="replace-all-checkbox",R.style.marginRight="5px",R.appendChild(document.createTextNode("New name for '"+r+"'?")),u.value=r,u.addEventListener("keydown",function(L){if(L.key==="Enter")if(Action.validateAttributeName(u.value)){let A=Page.codeMirrorEditor6.state.doc.toString();A=Action.renameClassAssistant(A,r,u.value.trim()),Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:A}});var T=jQuery("#umpleLayoutEditorText").val();T=Action.renameClassAssistant(T,r,u.value.trim()),Page.setUmplePositioningCode(T),document.removeEventListener("mousedown",d),n.remove(),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate")}else document.contains(s)||n.appendChild(s)}),n.appendChild(R),n.appendChild(u)}else if(e=="subclass")u.addEventListener("keydown",function(L){if(L.key==="Enter")if(Action.validateAttributeName(u.value)){let T=`
class `+u.value+`
{
  isA `+n+`;
}
`;Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:Page.codeMirrorEditor6.state.doc.toString()+P}}),document.removeEventListener("mousedown",d),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate"),o.remove(),Action.removeContextMenu()}else document.contains(c)||o.appendChild(c)}),o.appendChild(s);else if(e=="color"){var p=document.createElement("label");p.textContent="Color - ";var b=document.createElement("span");b.innerHTML="&#8594;",b.style.cursor="pointer",b.fontSize="20px",b.style.paddingLeft="5px",s.style.width="30px",s.style.height="30px",s.type="color";var _=function L(P){P.key==="Enter"&&(document.removeEventListener("keydown",L),Action.setColor(t,n,s.value),o.remove(),Action.removeContextMenu())};document.addEventListener("keydown",_),b.addEventListener("click",function(){Action.setColor(t,n,s.value),document.removeEventListener("keydown",_),o.remove(),Action.removeContextMenu()}),b.addEventListener("mouseover",function(){b.style.color="blue"}),b.addEventListener("mouseout",function(){b.style.color="black"}),o.appendChild(p),o.appendChild(s),o.appendChild(b)}else e=="assoc"&&r.forEach(L=>{var P=document.createElement("p");P.textContent=L,P.style.width="100px",P.style.padding="5px",P.style.borderRadius="3px",P.style.margin="0px",P.style.cursor="pointer",P.onclick=()=>{Action.filterOnOneClass(L),o.remove()},P.addEventListener("mouseover",function(){this.style.backgroundColor="#ddd"}),P.addEventListener("mouseout",function(){this.style.backgroundColor="transparent"}),o.appendChild(P)});document.body.appendChild(o),s.focus()},Action.renameClassAssistant=function(e,t,n){let r=e,o=new RegExp("(\\W+)("+t+")(\\W+)"),a;for(;(a=r.match(o))!=null;)r=r.substr(0,a.index+a[1].length)+n+r.substr(a.index+a[1].length+a[2].length,r.length-(a.index+a[1].length+a[2].length));return r},Action.deleteClass=function(e,t){let n=Page.codeMirrorEditor6.state.doc.toString();n=n.replace(e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"'),"");let r=new RegExp(".*\\s*(-|<)(>|-)\\s*.*\\s*"+t+"(\\s+\\w+)*\\s*;"),o;for(;(o=n.match(r))!=null;)n=n.substr(0,o.index)+n.substr(o.index+o[0].length,n.length-(o.index+o[0].length));for(r=new RegExp(".*"+t+"\\s*(<|-)(>|-)\\s*.*\\s+\\w+;");(o=n.match(r))!=null;)n=n.substr(0,o.index)+n.substr(o.index+o[0].length,n.length-(o.index+o[0].length));if(r=new RegExp("isA\\s+"+t),n.match(r)!=null){let a=new RegExp("isA\\s+(\\w+);"),s;if((s=e.match(a))!=null){let c="isA "+s[1]+";";for(;(o=n.match(r))!=null;)n=n.substr(0,o.index)+c+n.substr(o.index+o[0].length+1,n.length-(o.index+o[0].length+1))}else for(;(o=n.match(r))!=null;)n=n.substr(0,o.index)+n.substr(o.index+o[0].length+1,n.length-(o.index+o[0].length+1))}for(r=new RegExp("associationClass\\s+\\w+\\s*\\n*{(\\n*\\W*\\w*;)*(\\s*CRUD_Value\\s*{(\\s*\\w*\\s*,*)*}\\s*\\n*)*(\\n*\\W*\\w*;)*([\\s|\\t]*[*]\\s+"+t+";)(\\n*\\W*\\w*;)*(\\s*CRUD_Value\\s*{(\\s*\\w*\\s*,*)*}\\s*\\n*)*(\\n*\\W*\\w*)*?}"),o=null;(o=n.match(r))!=null;)n=n.substr(0,o.index)+n.substr(o.index+o[0].length,n.length-(o.index+o[0].length));Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:n}}),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate")},Action.addAssociationGv=function(e,t){var n=document.getElementsByClassName("node"),r=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"');Action.removeContextMenu();for(let o=0;o<n.length;o++)n[o].addEventListener("mousedown",function a(s){for(var c=s.target;c.parentElement.id!="graph0";)c=c.parentNode;c=c.outerHTML.substr(c.outerHTML.indexOf("&nbsp;"),c.outerHTML.indexOf("</text>")-c.outerHTML.indexOf("&nbsp;")).replaceAll("&nbsp;","").trim();let d="  * -> 1 "+c+`;
}
`,u=r.substr(0,r.length-1)+d;Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:Page.codeMirrorEditor6.state.doc.toString().replace(r,u)}}),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate");let f=document.getElementsByClassName("node");for(let v=0;v<f.length;v++)f[v].removeEventListener("mousedown",a)})},Action.getGvClassName=function(e){return Action.getGvClassNameFromNode(e.target)},Action.getGvClassNameFromNode=function(e){for(;e.parentElement.id!="graph0";)e=e.parentNode;return e=e.outerHTML.substr(e.outerHTML.indexOf("&nbsp;"),e.outerHTML.indexOf("</text>")-e.outerHTML.indexOf("&nbsp;")).replaceAll("&nbsp;","").trim(),e},Action.displayMenu=function(e){if(Action.diagramInSync){Action.removeContextMenu();var t=Action.getGvClassName(e),n=Page.codeMirrorEditor6.state.doc.toString(),r=Action.splitStates(n);for(let N=0;N<r.length;N++)(r[N].startsWith("class "+t+"{")||r[N].startsWith("class "+t+" ")||r[N].startsWith("class "+t+`
`))&&(r=r[N]);if(typeof r=="string"){var o=document.createElement("customContextMenu"),a=["Add Attribute","Rename Class","Delete Class","Add Subclass","Add Association","Change Color","Filter Class","Hide Class"],s=r.replaceAll(`
`,"&#10").replaceAll('"',"&#$quot"),c=['Action.drawInput("attri","'+s+'","'+t+'")','Action.drawInput("rename","'+s+'","'+t+'")','Action.deleteClass("'+s+'","'+t+'")','Action.drawInput("subclass","'+s+'","'+t+'")','Action.addAssociationGv("'+s+'","'+t+'")','Action.drawInput("color","'+s+'","'+t+'")','Action.filterOnOneClass("'+t+'")','Action.hideClass("'+t+'")'],d=jQuery("#umpleLayoutEditorText").val(),u=[],f=[],v=document.getElementsByClassName("node");for(let N=0;N<v.length;N++){var h=Action.getGvClassNameFromNode(v[N]);u.push(h)}var C=Action.neighbors[t];f=C.filter(N=>!u.includes(N)),f.length>0&&(a.push("Show Associations to:"),c.push('Action.drawInput("assoc",null,null,'+JSON.stringify(f)+")")),Page.filterWordsOutput.length>0&&Page.filterWordsOutput.split("!@").forEach(function(N){N.toLowerCase()==t.toLowerCase()&&(a=a.filter(p=>!p.includes("Filter Class")),a.push("Remove Filter"),c=c.filter(p=>!p.includes("Action.filterOnOneClass")),c.push('Action.clearFilterOnOneClass("'+t+'")'),a=a.filter(p=>!p.includes("Hide Class")),c=c.filter(p=>!p.includes("Action.hideClass"))),N.includes("~")&&(a.includes("Unhide Class(es)")||(a.push("Unhide Class(es)"),c.push("Action.unHideClasses()")))}),o.style.zIndex="1000",o.style.border="1px solid #ccc",o.style.backgroundColor="#f8f8f8",o.style.padding="5px",o.style.position="fixed";for(var A=0;A<a.length;A++){var T=document.createElement("div");T.style.padding="5px",T.style.borderRadius="3px",T.style.cursor="pointer",T.style.transition="background-color 0.3s",T.textContent=a[A],T.setAttribute("onclick","javascript:"+c[A]),T.addEventListener("mouseover",function(){this.style.backgroundColor="#ddd"}),T.addEventListener("mouseout",function(){this.style.backgroundColor="transparent"}),o.appendChild(T)}var j=o.getBoundingClientRect();e.clientX+j.width>window.innerWidth?o.style.right=window.innerWidth-e.clientX+"px":o.style.left=e.clientX+"px",e.clientY+j.height>window.innerHeight?o.style.bottom=window.innerHieght-e.clientY+"px":o.style.top=e.clientY+"px",document.addEventListener("mousedown",function N(p){var b=document.getElementById("promptBox");p.target!=o&&!o.contains(p.target)&&(b!=null&&p.target!=b&&b.contains(p.target),document.removeEventListener("mousedown",N),Action.removeContextMenu())}),document.body.appendChild(o)}}},Action.isWithinRadarZone=function(e,t,n,r=100){var o=Action.getGvPosition(e,t),a=Action.getGvClassNameFromNode(n),s=Action.getGvPosition(e,a);const c=Math.abs(s.x-o.x)<=r,d=Math.abs(s.y-o.y)<=r;return c&&d},Action.displayAssociMenu=function(e,t){const n=/Action\.selectAssociation\('([^']+)'\)/,r=t.match(n);let o=Action.selectAssociation(r[1]);var a=r[1].split(",");if(a.length==4)var s=a[1].trim(),c=a[0].trim(),d=a[2].split(" "),u=a[3].split(" ");else var s=a[1].trim(),d=a[2].split(" "),u=a[2].split(" "),c=a[0].trim();var f=new RegExp("(associationClass|class|interface|trait) "+c+"($|\\s|[{])"),v=new RegExp("(class|interface|trait) [A-Za-z]");if(Page.codeMirrorOn){var h=Action.selectItemCM6(f),C=Page.codeMirrorEditor6.state.sliceDoc(h.startIndex,h.endIndex);clientDebuggerFlag&&console.warn("classCode: "+C)}var A=C.replaceAll(`
`,"&#10").replaceAll('"',"&#$quot");let T=1,j=o.startIndex,N=o.endIndex;var p=Page.codeMirrorEditor6.state.sliceDoc(j,N);clientDebuggerFlag&&console.warn("selectedText: "+p),p.includes(d[0].trim())==!1&&(T=3);var b=document.createElement("customContextMenu"),_=T===3?["Alter "+c+" multiplicity","Alter "+c+" role name","Alter "+s+" role name"]:["Alter "+c+" multiplicity","Alter "+c+" role name","Alter "+s+" multiplicity","Alter "+s+" role name","Delete the association"],L=T===3?['Action.modifyMultiplicity("'+A+'","'+p+'","'+u[0]+'","0")','Action.modifyRoleName("'+A+'","'+p+'","'+u[1]+'","'+u[0]+'","0")','Action.modifyRoleName("'+A+'","'+p+'","'+d[1]+'","'+u[0]+'","1")']:['Action.modifyMultiplicity("'+A+'","'+p+'","'+u[0]+'","0")','Action.modifyRoleName("'+A+'","'+p+'","'+u[1]+'","'+u[0]+'","0")','Action.modifyMultiplicity("'+A+'","'+p+'","'+d[0]+'","'+T+'")','Action.modifyRoleName("'+A+'","'+p+'","'+d[1]+'","'+u[0]+'","1")','Action.deleteAssociation("'+A+'","'+p+'")'];b.style.zIndex="1000",b.style.border="1px solid #ccc",b.style.backgroundColor="#f8f8f8",b.style.padding="5px",b.style.position="fixed";for(var P=0;P<_.length;P++){var S=document.createElement("div");S.style.padding="5px",S.style.borderRadius="3px",S.style.cursor="pointer",S.style.transition="background-color 0.3s",S.textContent=_[P],S.setAttribute("onclick","javascript:"+L[P]),S.addEventListener("mouseover",function(){this.style.backgroundColor="#ddd"}),S.addEventListener("mouseout",function(){this.style.backgroundColor="transparent"}),b.appendChild(S)}var k=b.getBoundingClientRect();e.clientX+k.width>window.innerWidth?b.style.right=window.innerWidth-e.clientX+"px":b.style.left=e.clientX+"px",e.clientY+k.height>window.innerHeight?b.style.bottom=window.innerHieght-e.clientY+"px":b.style.top=e.clientY+"px",document.addEventListener("keydown",function O(R){var I=document.getElementById("promptBox");R.target!=b&&!b.contains(R.target)&&R.key==="Escape"&&(I!=null&&R.target!=I&&I.contains(R.target),document.removeEventListener("keydown",O),Action.removeContextMenu())}),document.addEventListener("mousedown",function O(R){var I=document.getElementById("promptBox");R.target!=b&&!b.contains(R.target)&&(I!=null&&R.target!=I&&I.contains(R.target),document.removeEventListener("mousedown",O),Action.removeContextMenu())}),document.body.appendChild(b)},Action.validateMultiplicity=function(e){if(!e)return!1;if(e==="*"||e.match(/^\d+$/))return!0;if(e.match(/^(\d+|\*)\.\.(\d+|\*)$/)){const t=e.split(".."),n=t[0],r=t[1];if(n==="*"||r==="*"){if(n==="0"||n.match(/^\d+$/)&&n!=="0")return!0}else{const o=parseInt(n,10),a=parseInt(r,10);if(o<=a)return!0}}return!1},Action.modifyMultiplicity=function(e,t,n,r){let o=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"');if(r==1)var a=!0;else if(r==3){Page.setFeedbackMessage(" unable to change end multiplicity for associationClass ");return}else var a=!1;var s=document.createElement("div");s.style.zIndex="1000",s.style.border="1px solid #ccc",s.style.backgroundColor="#f8f8f8",s.style.padding="5px",s.style.position="absolute",s.style.left="50%",s.style.top="50%",s.style.transform="translate(-50%, -50%)",s.id="promptBox";var c=document.createElement("input");c.type="text",c.value=n,c.style.padding="5px",c.style.margin="5px",c.style.width="200px";var d=document.createElement("button");d.textContent="Change",d.style.padding="5px",d.style.marginLeft="5px";var u=document.createElement("label");u.type="label",u.style.color="red",u.textContent="Please enter a valid multiplicity format (e.g., '*', '1', '0..1', '1..*', '2..5').",s.appendChild(c),s.appendChild(d),document.body.appendChild(s),c.focus();var f=function v(h){document.contains(s)&&h.target!=s&&!s.contains(h.target)&&(document.removeEventListener("mousedown",v),s.remove())};document.addEventListener("mousedown",f),document.addEventListener("keydown",function(v){v.key==="Escape"&&(s.remove(),document.removeEventListener("keydown",arguments.callee))}),d.addEventListener("click",function(){if(Action.validateMultiplicity(c.value.trim())){var v=n.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&");let h;if(a){const A=t.split(new RegExp(v));A.length===3?h=A[0]+n.trim()+A[1]+c.value.trim()+A[2]:A.length===2&&(h=A[0]+c.value.trim()+A[1])}else h=t.replace(new RegExp(v),c.value.trim());let C=Page.codeMirrorEditor6.state.doc.toString();if(o.includes(t)==!1)C=C.replace(t,h);else{let A=o;A=A.replace(t,h),C=C.replace(o,A)}Page.setCodeMirror6Text(C),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate"),s.remove(),Action.selectMatchingText(h)}else c.focus(),s.appendChild(u)}),c.addEventListener("keydown",function(v){v.key==="Enter"&&(v.preventDefault(),v.stopPropagation(),d.click())})},Action.modifyRoleName=function(e,t,n,r,o){let a=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"');if(o==1)var s=!0;else var s=!1;var c=document.createElement("div");c.style.zIndex="1000",c.style.border="1px solid #ccc",c.style.backgroundColor="#f8f8f8",c.style.padding="5px",c.style.position="absolute",c.style.left="50%",c.style.top="50%",c.style.transform="translate(-50%, -50%)",c.id="promptBox";var d=document.createElement("input");d.type="text",d.value=n,d.style.padding="5px",d.style.margin="5px",d.style.width="200px";var u=document.createElement("button");u.textContent="Change",u.style.padding="5px",u.style.marginLeft="5px";var f=document.createElement("label");f.type="label",f.style.color="red",f.textContent="To add a role name at this end there must be a role name at the other end first",c.appendChild(d),c.appendChild(u),document.body.appendChild(c),d.focus();var v=function h(C){document.contains(c)&&C.target!=c&&!c.contains(C.target)&&(document.removeEventListener("mousedown",h),c.remove())};document.addEventListener("mousedown",v),document.addEventListener("keydown",function(h){h.key==="Escape"&&(c.remove(),document.removeEventListener("keydown",arguments.callee))}),u.addEventListener("click",function(){var h=d.value.trim();if(n==""){var C=/(\s*<-\s*|\s*><\s*|\s*--\s*|\s*->\s*|\s*<@>-\s*|\s*-\s*<@>\s*)/,A=t.split(C),T=A[0].trim(),j,N,p;if(A.length>2){var b=A[2].trim();if(s)if(b.includes("sorted")){var _=b.split("sorted"),L=b.split(";");N=_[0].trim()+" "+h+"sorted"+_[1]}else{var L=b.split(";");N=L[0].trim()+" "+h+";"}else if(a.includes(t)==!1?j=T.trim()+" "+h:j=r.trim()+" "+h,T.includes("sorted")){var P=T.split("sorted");j=r.trim()+" "+h+"sorted"+P[1]}p=s?T+A[1]+N:j+A[1]+b}else if(A=t.split(";")[0].split(" "),s==!1)if(j=r.trim()+" "+h,A.length>2)p=j+" "+A[1].trim()+" "+A[2].trim()+";";else{d.focus(),c.appendChild(f);return}else L=t.split(";"),p=L[0].trim()+" "+h+";"}else p=t.replace(n,h);let S=Page.codeMirrorEditor6.state.doc.toString();if(a.includes(t)==!1)S=S.replace(t,p);else{let k=a;k=k.replace(t,p),S=S.replace(a,k)}Page.setCodeMirror6Text(S),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate"),c.remove(),Action.selectMatchingText(p)}),d.addEventListener("keydown",function(h){h.key==="Enter"&&(h.preventDefault(),h.stopPropagation(),u.click())})},Action.deleteAssociation=function(e,t){let n=Page.codeMirrorEditor6.state.doc.toString(),r=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"');if(r.includes(t)==!1)n=n.replace(t,"");else{let o=r;o=o.replace(t,""),n=n.replace(r,o)}Page.setCodeMirror6Text(n),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate")},Action.displayAttributeMenu=function(e,t,n){if(Action.diagramInSync){Action.removeContextMenu();var r=e.target;for(t=t.trim();r.parentElement.id!="graph0";)r=r.parentNode;r=r.outerHTML.substr(r.outerHTML.indexOf("&nbsp;"),r.outerHTML.indexOf("</text>")-r.outerHTML.indexOf("&nbsp;")).replaceAll("&nbsp;","").trim();var o=Page.codeMirrorEditor6.state.doc.toString(),a=Action.splitStates(o);for(let A=0;A<a.length;A++)(a[A].startsWith("class "+r+"{")||a[A].startsWith("class "+r+" ")||a[A].startsWith("class "+r+`
`))&&(a=a[A]);if(typeof a=="string"){var s=document.createElement("customContextMenu"),c=document.createElement("div");c.textContent="Attribute: "+t+"Type: "+n,c.style.padding="5px",c.style.borderBottom="1px solid #ccc",c.style.fontWeight="bold",s.appendChild(c);var d=["Rename Attribute","Change Type","Delete Attribute"],u=a.replaceAll(`
`,"&#10").replaceAll('"',"&#$quot"),f=['Action.renameAttribute("'+u+'","'+r+'","'+t+'","'+n+'")','Action.changeAttributeType("'+u+'","'+r+'","'+t+'","'+n+'")','Action.deleteAttribute("'+u+'","'+r+'","'+t+'","'+n+'")'];s.style.zIndex="1000",s.style.border="1px solid #ccc",s.style.backgroundColor="#f8f8f8",s.style.padding="5px",s.style.position="fixed";for(var v=0;v<d.length;v++){var h=document.createElement("div");h.style.padding="5px",h.style.borderRadius="3px",h.style.cursor="pointer",h.style.transition="background-color 0.3s",h.textContent=d[v],h.setAttribute("onclick","javascript:"+f[v]),h.addEventListener("mouseover",function(){this.style.backgroundColor="#ddd"}),h.addEventListener("mouseout",function(){this.style.backgroundColor="transparent"}),s.appendChild(h)}var C=s.getBoundingClientRect();e.clientX+C.width>window.innerWidth?s.style.right=window.innerWidth-e.clientX+"px":s.style.left=e.clientX+"px",e.clientY+C.height>window.innerHeight?s.style.bottom=window.innerHeight-e.clientY+"px":s.style.top=e.clientY+"px",document.addEventListener("keydown",function A(T){var j=document.getElementById("promptBox");T.target!=s&&!s.contains(T.target)&&T.key==="Escape"&&(j!=null&&T.target!=j&&j.contains(T.target),document.removeEventListener("keydown",A),Action.removeContextMenu())}),document.addEventListener("mousedown",function A(T){T.target!=s&&!s.contains(T.target)&&(document.removeEventListener("mousedown",A),Action.removeContextMenu())}),document.body.appendChild(s)}}},Action.renameAttribute=function(e,t,n,r){var o=document.createElement("div");o.style.zIndex="1000",o.style.border="1px solid #ccc",o.style.backgroundColor="#f8f8f8",o.style.padding="5px",o.style.position="absolute",o.style.left="50%",o.style.top="50%",o.style.transform="translate(-50%, -50%)",o.id="promptBox";var a=document.createElement("input");a.type="text",a.value=n,a.style.padding="5px",a.style.margin="5px",a.style.width="200px";var s=document.createElement("button");s.textContent="Rename",s.style.padding="5px",s.style.marginLeft="5px",o.appendChild(a),o.appendChild(s),document.body.appendChild(o),a.focus();var c=function d(u){document.contains(o)&&u.target!=o&&!o.contains(u.target)&&(document.removeEventListener("mousedown",d),o.remove())};document.addEventListener("mousedown",c),s.addEventListener("click",function(){if(Action.validateAttributeName(a.value.trim())){let d=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"'),u=d.includes(n+" :"),f=new RegExp("\\b"+n+"\\s*:\\s*\\w+\\s*;\\n?","g"),v=new RegExp("\\b"+n+"\\s*;\\n?","g"),h=u?r+" "+a.value.trim()+`;
`:a.value.trim()+`;
`,C=d;C=C.replace(f,h),C=C.replace(v,h);let A=new RegExp("\\b"+n+"\\b","g");C=C.replace(A,a.value.trim());let T=Page.codeMirrorEditor6.state.doc.toString();T=T.replace(d,C),Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:T}}),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate"),document.removeEventListener("mousedown",c),o.remove()}})},Action.changeAttributeType=function(e,t,n,r){var o=document.createElement("div");o.style.zIndex="1000",o.style.border="1px solid #ccc",o.style.backgroundColor="#f8f8f8",o.style.padding="5px",o.style.position="absolute",o.style.left="50%",o.style.top="50%",o.style.transform="translate(-50%, -50%)",o.id="promptBox";var a=document.createElement("select");["String","Integer","Double","Float","Boolean","Date","Time"].forEach(function(d){var u=document.createElement("option");u.value=d,u.text=d,d===r&&(u.selected=!0),a.appendChild(u)});var s=document.createElement("button");s.textContent="Change Type",s.style.padding="5px",s.style.margin="5px",o.appendChild(a),o.appendChild(s),document.body.appendChild(o),a.focus();var c=function d(u){document.contains(o)&&u.target!=o&&!o.contains(u.target)&&(document.removeEventListener("mousedown",d),o.remove())};document.addEventListener("mousedown",c),s.addEventListener("click",function(){var d=a.options[a.selectedIndex].value;if(d!==r){let u=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"'),f=u;if(r!="String"){let h=new RegExp("\\b"+r+"\\s"+n,"g");f=f.replace(h,d+" "+n)}else{let h=new RegExp("\\b"+r+"\\s"+n,"g"),C=new RegExp("\\b"+n,"g");f=f.replace(h,d+" "+n),f=f.replace(C,d+" "+n)}let v=Page.codeMirrorEditor6.state.doc.toString();v=v.replace(u,f),Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:v}}),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate"),document.removeEventListener("mousedown",c),o.remove()}else document.removeEventListener("mousedown",c),o.remove()})},Action.deleteAttribute=function(e,t,n,r){let o=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"'),a=new RegExp("\\b"+r+"\\s"+n+"\\s*;","g"),s=new RegExp("\\b"+n+"\\s*;\\n?","g"),c=o;c=c.replace(a,""),c=c.replace(s,"");let d=Page.codeMirrorEditor6.state.doc.toString();d=d.replace(o,c),Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:d}}),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate")},Action.classSelected=function(e){var t=Page.selectedClass,n=e;if(t!=null){Page.selectedClass=null,jQuery("#"+t.id).css("background-color","white");for(var r="#"+t.id+"_anchor",o=0;o<8;o++)jQuery(r+o).hide()}if(n!=null){jQuery("#umpleCanvas").addClass("unscrollable"),Page.selectedClass=UmpleSystem.find(n.id),jQuery("#"+n.id).css("background-color","#F3F6FB");for(var r="#"+n.id+"_anchor",a="#"+n.id+"_hover",o=0;o<8;o++)jQuery(r+o).show(),jQuery(a+o).hide()}else jQuery("#umpleCanvas").removeClass("unscrollable")},Action.classHover=function(e,t){var n=e.currentTarget;if(Action.diagramInSync&&!(Page.selectedClass!=null&&Page.selectedClass.id==n.id)){var r=t?"block":"none",o=jQuery("#"+n.id);if(t?o.css("background-color","#F3F6FB"):o.css("background-color","white"),Page.canShowHovers())for(var a=8,s="#"+n.id+"_hover",c=0;c<a;c++)t?jQuery(s+c).show():jQuery(s+c).hide()}},Action.unselectAll=function(){Action.classSelected(null),Action.associationSelected(null),Action.generalizationSelected(null),Action.transitionSelected(null)},Action.classClicked=function(e){if(Action.diagramInSync){Action.focusOn("umpleCanvas",!0),Action.focusOn("umpleModelEditorText",!1),Action.unselectAll(),Action.elementClicked=!0;var t=e.currentTarget;if(Action.selectClass(t.id),Page.selectedItem=="DeleteEntity")DiagramEdit.classDeleted(t.id);else if(Page.selectedItem=="AddAssociation")DiagramEdit.newAssociation==null?(Action.canCreateByDrag=!1,DiagramEdit.createAssociationPartOne(e)):(DiagramEdit.createAssociationPartTwo(e),setTimeout(function(){Action.canCreateByDrag=!0},500));else if(Page.selectedItem=="AddGeneralization")if(DiagramEdit.newGeneralization==null){var n=DiagramEdit.createGeneralizationPartOne(e);n&&(Action.canCreateByDrag=!1)}else DiagramEdit.createGeneralizationPartTwo(e),setTimeout(function(){Action.canCreateByDrag=!0},500);else Action.classSelected(t)}},Action.stateClicked=function(e){if(Action.diagramInSync){Action.focusOn("umpleCanvas",!0),Action.focusOn("umpleModelEditorText",!1);var t=e.split("^*^"),n=t[0],r=t[1],o=t[2].replace("Entry:","").replace("Exit:","");o=o.replace("Exit:",""),Action.unselectAll(),Action.elementClicked=!0;var a=null,s=null;if(o.includes(".")){clientDebuggerFlag&&console.log("stateClicked - nested state case"),o=o.split("."),s=Action.selectStateInClassCM6(n,r,o[0]);for(let c=1;c<o.length;c++)clientDebuggerFlag&&console.log("Iterating states within Identified state ..."),s=Action.selectStateInStateCM6(s.startIndex,s.endIndex,o[c])}else clientDebuggerFlag&&console.log("stateClicked - else - base case"),s=Action.selectStateInClassCM6(n,r,o),clientDebuggerFlag&&console.log("selectionIndiciesCM6: ",s);Action.highlightByIndexCM6(s.startIndex,s.endIndex),Page.selectedItem=="AddTransition"&&(DiagramEdit.newTransition==null?(Action.canCreateByDrag=!1,DiagramEdit.createTransitionPartOne(event)):(DiagramEdit.createTransitionPartTwo(event),setTimeout(function(){Action.canCreateByDrag=!0},500)))}},Action.associationClicked=function(e){if(Action.diagramInSync){Action.elementClicked=!0,Action.unselectAll();var t=e.currentTarget;Action.associationSelected(t)}},Action.transitionClicked=function(e){if(!Action.diagramInSync||typeof e=="string"&&e===null)return;Action.elementClicked=!0,Action.unselectAll();let t=e.split("*^*"),n=t[3].split(".");dest=t[4];var r=Action.selectStateInClassCM6(t[0],t[1],n[0]);dest=t[4].split(".");for(var o=1;o<n.length;o++)r=Action.selectStateInStateCM6(r.startIndex,r.endIndex,n[o]);let a=t[2].replaceAll("+","\\+").replaceAll("-","\\-").replaceAll("*","\\*").replaceAll("?","\\?").replaceAll("|","\\|");if(a=a.replace("after","after~`~?:Every`~`?"),t[5]!=""){let v=t[5].trim().replaceAll("+","\\+").replaceAll("-","\\-").replaceAll("*","\\*").replaceAll("?","\\?").replaceAll("|","\\|");a=a+"\\s*[\\s*"+v.trim().slice(1,v.trim().length-1)+"\\s*]"}a=a.replaceAll("]","\\]").replaceAll("[","\\[").replaceAll(")","\\)?").replaceAll("(","\\(?").replaceAll("~`~","(").replaceAll("`~`",")").replaceAll(" ","\\s*").replaceAll(",","\\s*,\\s*").replaceAll("!","\\s*!\\s*").replaceAll("/","\\s*/\\s*"),a=a.replaceAll("&&","&{1,2}");let s=new RegExp(a+".*->","s"),c=Page.codeMirrorEditor6.state.doc.toString().substr(r.startIndex,r.endIndex-r.startIndex).search(s)+r.startIndex,d=Page.codeMirrorEditor6.state.doc.toString().substr(c),u=Action.findEOL(d),f=c+u.length;Action.highlightByIndexCM6(c,f),u.split("->").length-1!==1&&Page.setFeedbackMessage("Please edit this complex transition in the textual code."),Action.highlightByIndexCM6(c,f)},Action.generalizationClicked=function(e){if(Action.diagramInSync){Action.elementClicked=!0,Action.unselectAll();var t=e.currentTarget;Action.generalizationSelected(t)}},Action.associationHover=function(e,t){if(Action.diagramInSync){var n=e.currentTarget,r=UmpleSystem.findAssociation(n.id);if(n!=null&&Page.canShowHovers())for(var o=2,a="#"+n.id+"_hover",s=0;s<o;s++)t?jQuery(a+s).show():jQuery(a+s).hide()}},Action.transitionHover=function(e,t){if(Action.diagramInSync){var n=e.currentTarget,r=UmpleSystem.findTransition(n.id);if(updateAssociation!=null&&Page.canShowHovers())for(var o=2,a="#"+updateAssociation.id+"_hover",s=0;s<o;s++)t?jQuery(a+s).show():jQuery(a+s).hide()}},Action.generalizationHover=function(e,t){if(Action.diagramInSync){var n=e.currentTarget;if(n!=null&&Page.canShowHovers())for(var r="#"+n.id+"_hover",o=0;o<3;o++)t?jQuery(r+o).show():jQuery(r+o).hide()}},Action.associationSelected=function(e){var t=e!=null,n=null;if(Page.selectedItem=="DeleteEntity"&&e!=null){var r=!1;DiagramEdit.associationDeleted(e.id,r);return}if(e!=null)Page.selectedAssociation=e,n=e;else if(Page.selectedAssociation!=null)n=Page.selectedAssociation,Page.selectedAssociation=null;else return;for(var o=2,a="#"+n.id+"_anchor",s=0;s<o;s++)t?jQuery(a+s).show():jQuery(a+s).hide()},Action.transitionSelected=function(e){var t=e!=null,n=null;if(Page.selectedItem=="DeleteEntity"&&e!=null){var r=!1;DiagramEdit.transitionDeleted(e.id,r);return}if(e!=null)Page.selectedTransition=e,n=e;else if(Page.selectedTransition!=null)n=Page.selectedTransition,Page.selectedTransition=null;else return;for(var o=2,a="#"+n.id+"_anchor",s=0;s<o;s++)t?jQuery(a+s).show():jQuery(a+s).hide()},Action.generalizationSelected=function(e){var t=e!=null,n=null;if(Page.selectedItem=="DeleteEntity"&&e!=null){var r=!1;DiagramEdit.generalizationDeleted(e.id,r);return}if(e!=null)Page.selectedGeneralization=e,n=e;else if(Page.selectedGeneralization!=null)n=Page.selectedGeneralization,Page.selectedGeneralization=null;else return;for(var o=3,a="#"+n.id+"_anchor",s=0;s<o;s++)t?jQuery(a+s).show():jQuery(a+s).hide()},Action.executeCode=function(e,t){var n="#buttonExecuteCode",r=t;jQuery(n).showLoading(),Action.ajax(function(o){Action.executeCodeCallback(o)},format("execute=true&language={0}&languageStyle={1}&model={2}",r,e,Page.getModel()),"true")},Action.generateCode=function(e,t){var n="#buttonGenerateCode",r=t,o;Page.getAdvancedMode()==0&&t==="Cpp"&&(r="Experimental-"+t),t==="StateTables"&&(o=StateTree.colourStateTables),t==="EventSequence"&&(o=StateTree.colourEventSequences),t==="stateDiagram"&&(r=t+"."+$("inputGenerateCode").value.split(":")[1]),jQuery(n).showLoading(),Action.ajax(function(a){Action.generateCodeCallback(a,e,o)},format("language={0}&languageStyle={1}",r,e),"true")},Action.photoReady=function(){var e="#"+Page.umpleCanvasId();Page.isPhotoReady()?jQuery(e).addClass("photoReady"):jQuery(e).removeClass("photoReady"),UmpleSystem.redrawCanvas()},Action.executeCodeCallback=function(e){var t="#buttonExecuteCode";jQuery(t).hideLoading(),Page.showExecutionArea(),Page.hideGeneratedCodeOnly(),Page.showExecutedResponse(e.responseText),window.location.href="#codeExecutionArea"},Action.generateCodeCallback=function(e,t,n){Page.showGeneratedCode(e.responseText,t),Page.hideExecutionArea(),Action.gentime=new Date().getTime(),n!==void 0&&n();var r="#buttonGenerateCode";jQuery(r).hideLoading(),Page.showCodeDone(),window.location.href="#genArea"},Action.classMouseDown=function(e){Action.canCreateByDrag&&(Page.selectedItem=="AddAssociation"&&DiagramEdit.newAssociation==null?DiagramEdit.createAssociationPartOne(e):Page.selectedItem=="AddGeneralization"&&DiagramEdit.newGeneralization==null?DiagramEdit.createGeneralizationPartOne(e):Page.selectedItem=="AddTransition"&&DiagramEdit.newTransition==null&&DiagramEdit.createTransitionPartOne(e))},Action.classMouseUp=function(e){Action.canCreateByDrag&&(Page.selectedItem=="AddAssociation"&&DiagramEdit.newAssociation!=null?DiagramEdit.createAssociationPartTwo(e):Page.selectedItem=="AddGeneralization"&&DiagramEdit.newGeneralization!=null?DiagramEdit.createGeneralizationPartTwo(e):Page.selectedItem=="AddTransition"&&DiagramEdit.newTransition!=null&&DiagramEdit.createTransitionPartTwo(e))},Action.mouseMove=function(e){Page.clickCount=0,Page.selectedItem=="AddClass"&&(DiagramEdit.newClass==null&&(DiagramEdit.newClass=new UmpleClass,DiagramEdit.newClass.name="",DiagramEdit.newClass.id="tempClass"),Action.drawClassOutline(e,DiagramEdit.newClass)),DiagramEdit.newAssociation!=null&&Page.selectedItem=="AddAssociation"&&Action.drawAssociationLine(e,DiagramEdit.newAssociation),DiagramEdit.newTransition!=null&&Page.selectedItem=="AddTransition"&&Action.drawTransitionLine(e,Diagramedit.newTransition),DiagramEdit.newGeneralization!=null&&Page.selectedItem=="AddGeneralization"&&Action.drawGeneralizationLine(e,DiagramEdit.newGeneralization)},Action.drawClassOutline=function(e,t){var n="#"+Page.umpleCanvasId(),r=new UmplePosition(e.pageX,e.pageY+1,0,0),o=r.subtract(UmpleSystem.position());t.position=new UmplePosition(o.x,o.y,UmpleClassFactory.defaultSize.width,UmpleClassFactory.defaultSize.height);var a=t.drawableClassOutline();jQuery(n).append(a);var s="#"+t.id,c=s+"_width",d=s+"_height",u=new Object;u.left=r.x,u.top=r.y,jQuery(s).offset(u),jQuery(c).width(t.position.width),jQuery(d).height(t.position.height)},Action.drawAssociationLine=function(e,t){var n="#"+Page.umpleCanvasId(),r=new UmplePosition(e.pageX,e.pageY,0,0);t.classTwoPosition=r.subtract(UmpleSystem.position()),jQuery(n).append(t.drawable())},Action.drawTransitionLine=function(e,t){var n="#"+Page.umpleCanvasId(),r=new UmplePosition(e.pageX,e.pageY,0,0);t.toStatePosition=r.subtract(UmpleSystem.position()),jQuery(n).append(t.drawable())},Action.drawGeneralizationLine=function(e,t){var n="#"+Page.umpleCanvasId(),r="#"+t.getElementId(),o=UmpleSystem.position(),a=e.pageX-5-o.x,s=e.pageY+5-o.y;t.parentPosition=new UmplePosition(a,s,0,0),jQuery(r).remove(),jQuery(n).append(t.drawable(!1))},Action.umpleCanvasClicked=function(e){if(Action.elementClicked){Action.elementClicked=!1;return}if(Page.selectedItem=="AddClass"){var t=new UmplePosition(Math.floor(e.pageX),Math.floor(e.pageY),0,0);DiagramEdit.addClass(t)}else Page.selectedItem=="AddAssociation"&&DiagramEdit.newAssociation!=null?Page.clickCount>1&&DiagramEdit.removeNewAssociation():Page.selectedItem=="AddTransition"&&DiagramEdit.newTransition!=null?Page.clickCount>1&&DiagramEdit.removeNewTransition():Page.selectedItem=="AddGeneralization"&&DiagramEdit.newGeneralization!=null?Page.clickCount>1&&DiagramEdit.removeNewGeneralization():Action.unselectAll()},Action.directUpdateCommandCallback=function(e){Action.updateUmpleTextCallback(e),Action.redrawDiagram()},Action.updateUmpleTextCallback=function(e){!justUpdatetoSaveLater&&!justUpdatetoSaveLaterForTextCallback&&(TabControl.getCurrentHistory().save(e.responseText,"TextCallback"),Page.setExampleMessage("")),Action.freshLoad=!0,Page.setUmpleCode(e.responseText,Action.update.codeChange),Page.hideLoading(),DiagramEdit.textChangeQueue.length==0?(Action.freshLoad=!1,DiagramEdit.pendingChanges=!1,Action.setjustUpdatetoSaveLater(!1),Action.setjustUpdatetoSaveLaterForTextCallback(!1)):(Action.setjustUpdatetoSaveLater(!0),Action.setjustUpdatetoSaveLaterForTextCallback(!0),DiagramEdit.doTextUpdate())},Action.setExampleType=function e(){jQuery("#itemLoadExamples").hide(),jQuery("#itemLoadExamples2").hide(),jQuery("#itemLoadExamples3").hide(),jQuery("#itemLoadExamples4").hide(),jQuery("#itemLoadExamples5").hide(),jQuery("#itemLoadExamples6").hide(),jQuery("#itemLoadExamples7").hide(),jQuery("#itemLoadExamples8").hide(),Page.getExampleType()=="cdModels"?(jQuery("#itemLoadExamples").show(),jQuery("#defaultExampleOption").prop("selected",!0)):Page.getExampleType()=="smModels"?(jQuery("#itemLoadExamples2").show(),jQuery("#defaultExampleOption2").prop("selected",!0)):Page.getExampleType()=="featureModels"?(jQuery("#itemLoadExamples4").show(),jQuery("#defaultExampleOption4").prop("selected",!0)):Page.getExampleType()=="extra1ModelsAD"?(jQuery("#itemLoadExamples5").show(),jQuery("#defaultExampleOption5").prop("selected",!0)):Page.getExampleType()=="extra1ModelsEL"?(jQuery("#itemLoadExamples6").show(),jQuery("#defaultExampleOption6").prop("selected",!0)):Page.getExampleType()=="extra1ModelsMP"?(jQuery("#itemLoadExamples7").show(),jQuery("#defaultExampleOption7").prop("selected",!0)):Page.getExampleType()=="extra1ModelsQZ"?(jQuery("#itemLoadExamples8").show(),jQuery("#defaultExampleOption8").prop("selected",!0)):(jQuery("#itemLoadExamples3").show(),jQuery("#defaultExampleOption3").prop("selected",!0))},Action.loadExample=function e(){var r=this.dataset.diagramType,t=jQuery(" option:selected",this);if(t.hasClass("openUmprOption")){location.href="http://umple.org/umpr?diagram-type="+r;return}UmpleSystem.merge(null),Page.showCanvasLoading(!0),Page.showModelLoading(!0),Page.showLayoutLoading(!0),Ajax.sendRequest("scripts/compiler.php",Action.loadExampleCallback,"exampleCode="+Page.getSelectedExample());var n=Page.getSelectedExample().slice(0,-4),r="";Page.useGvStateDiagram?r="&diagramtype=state":Page.useGvFeatureDiagram?r="&diagramtype=GvFeature":Page.useStructureDiagram?r="&diagramtype=structure&generateDefault=cpp":r="&diagramtype=GvClass";var o="#buttonLarger",a="#buttonSmaller",s="#"+Page.umpleCanvasId();umpleCanvasWidth=jQuery(s).width(),umpleCanvasHeight=jQuery(s).height();var c=Page.getSelectedExample();if(n.startsWith("https"))var d=n.split("/").pop(),u="?filename="+n.substr(8)+".ump"+r;else var d=n,u="?example="+d+r;setTimeout(function(){Page.setExampleMessage('<a href="'+u+'">URL for '+d+" example</a>")},3e3),jQuery("#inputExample").blur()},Action.loadExampleCallback=function(e){Action.freshLoad=!0,Action.setjustUpdatetoSaveLater(!0),Page.setUmpleCode(e.responseText,function(){Page.hideLoading(),Action.updateUmpleDiagram()}),Action.setCaretPosition("0"),Action.updateLineNumberDisplay(),TabControl.getCurrentHistory().save(e.responseText,"loadExampleCallback")},Action.customSizeTyped=function(){Action.oldTimeout!=null&&clearTimeout(Action.oldTimeout);var e=jQuery("#widthField").val(),t=jQuery("#heightField").val();Action.oldTimeout=setTimeout(function(){Page.setUmpleCanvasSize(e,t)},Action.waiting_time)},Action.moveSelectedClass=function(e,t){e!=null&&(e.position=e.position.add(t),UmpleSystem.updateClass(e),Action.classSelected(e),Action.oldTimeout!=null&&clearTimeout(Action.oldTimeout),Action.oldTimeout=setTimeout(function(){DiagramEdit.classMoved(Page.selectedClass)},1e3))},Action.keyboardShortcut=function(e){if(Page.shortcutsEnabled){var t=e.which;if(t==27){var n=Page.unselectAllToggleTools();n||jQuery(".visibleFocus").blur()}else(t==8||t==46)&&jQuery("#umpleCanvasColumn").hasClass("focus")?Page.selectedClass&&jQuery("#"+Page.selectedClass.id).find("input").length==0?(DiagramEdit.classDeleted(Page.selectedClass.id),e.preventDefault()):Page.selectedAssociation?(DiagramEdit.associationDeleted(Page.selectedAssociation.id),e.preventDefault()):Page.selectedGeneralization&&(DiagramEdit.generalizationDeleted(Page.selectedGeneralization.id),e.preventDefault()):(t==8||t==46)&&jQuery(".umpleClass").is(":focus")?(DiagramEdit.classDeleted(document.activeElement.id),e.preventDefault()):(t==8||t==46)&&(jQuery(".untracedAssociation").is(":focus")||jQuery(".redTracedAssociation").is(":focus"))?(DiagramEdit.associationDeleted(document.activeElement.id),e.preventDefault()):(t==8||t==46)&&jQuery(".umpleGeneralization").is(":focus")&&(DiagramEdit.generalizationDeleted(document.activeElement.id),e.preventDefault())}},Action.getCaretPosition=function(){return Page.codeMirrorEditor6.state.doc.lineAt(Page.codeMirrorEditor6.state.selection.main.head).number},Action.getInputSelectionStart=function(e){var t=0,n,r,o,a,s;return typeof e.selectionStart=="number"&&typeof e.selectionEnd=="number"?(t=e.selectionStart,Page.getAdvancedMode()==2&&Page.setFeedbackMessage("Non-IE browser ")):(Page.getAdvancedMode()==2&&Page.setFeedbackMessage("IE-type browser "),r=document.selection.createRange(),r&&r.parentElement()==e&&(a=e.value.length,n=e.value.replace(/\r\n/g,`
`),o=e.createTextRange(),o.moveToBookmark(r.getBookmark()),s=e.createTextRange(),s.collapse(!1),o.compareEndPoints("StartToEnd",s)>-1?t=a:(t=-o.moveStart("character",-a),t+=n.slice(0,t).split(`
`).length-1))),t},Action.setCaretPosition=function(e){if(isNaN(e-0)){if(e=="gd"&&(jQuery("#gdprtext").show(),Action.gdprHidden=!1),e=="av"){document.getElementById("advancedMode").value=1,Page.setFeedbackMessage("");return}if(e=="db"){document.getElementById("advancedMode").value=2,Page.setFeedbackMessage("Debug Mode");return}if(e.substr(0,4)=="clws"){e.substr(4,1)=="+"?(Page.setFeedbackMessage("Collaboration logging Enabled"),Collab.websocketLogging(0)):e.substr(4,1)=="-"?(Page.setFeedbackMessage("Collaboration logging disabled"),Collab.websocketLogging(-1)):e.substr(4,2)=="tq"?(Page.setFeedbackMessage("Ten seconds to timeout the client"),Collab.clientSetTimeout(10)):e.substr(4,2)=="tn"?(Page.setFeedbackMessage("Turn the timeout back to normal"),Collab.clientSetTimeout(-1)):e.substr(4,2)=="tx"&&(Page.setFeedbackMessage("Disabled the timeout"),Collab.clientSetTimeout(0));return}if(e=="sp"&&existSCookie("surveyCookie")==null&&window.localStorage.getItem("surveyShown")==null&&(document.getElementById("styleTip")!=null&&(document.getElementById("styleTip").innerHTML=""),window.randomSurveyRoll=1,window.surveyData.EditsBeforePrompt=1,timeSurveyUp=!1,clearTimeout(timeSurvey),timeSurvey=setTimeout(function(){timeSurveyUp=!0},1e4),displayedText=!1,displayedText||(beforeInstance=TabControl.getCurrentHistory().currentIndex,document.addEventListener("mouseover",function(){TabControl.getCurrentHistory().currentIndex-beforeInstance>=1&&!displayedText&&timeSurveyUp&&(displaySurvey(),this.removeEventListener("mouseover",arguments.callee))}))),e=="sc"){let c=new Date;c.setTime(c.getTime()-1e3),document.cookie="surveyCookie=done; expires="+c.toUTCString()+"; path=/;",window.localStorage.removeItem("surveyShown"),document.addEventListener("mouseover",function(){}),setCookieBeforeClose("off")}if(e=="tc"){Page.setFeedbackMessage("Clearing tip cookies");let c=new Date;c.setTime(c.getTime()-1e3),window.localStorage.removeItem("first_time"),document.cookie="tipCookie=done; expires="+c.toUTCString()+"; path=/;"}if(e.substr(0,2)=="cm"){e.substr(2,1)=="0"&&Page.codeMirrorOn?(Page.setFeedbackMessage("Turning code mirroring off"),Page.codeMirrorEditor.toTextArea(),Page.codeMirrorOn=!1,jQuery("#linenum").val("0")):e.substr(2,1)=="1"&&!Page.codeMirrorOn&&(Page.initCodeMirrorEditor(),jQuery("#linenum").val("0"));return}if(e.substr(0,2)=="bp"){Action.promptAndExecuteTest();return}else{Action.selectMatchingText(e)||(Page.setFeedbackMessage('Line number or word "'+e+'" not located'),setTimeout(function(){Page.setFeedbackMessage("")},3e3));return}}if(Page.codeMirrorOn){if(Page.codeMirrorEditor6.focus(),e>=1){e=Math.min(e,Page.codeMirrorEditor6.state.doc.lines);const c=Page.codeMirrorEditor6.state.doc.line(e).from;Page.codeMirrorEditor6.dispatch({selection:{anchor:c},scrollIntoView:!0})}return}var t=document.getElementById("umpleModelEditorText"),n=0,r=-1;if(e<1)r=0;else{for(var o=Page.getRawUmpleCodeCM6(),a=0;a<o.length;a++)if(o.charAt(a)==`
`&&(e--,e==1&&(n=a+1),e==0)){r=a;break}r==-1&&(r=o.length,e!=1&&(n=r))}if(t.setSelectionRange)t.focus(),t.setSelectionRange(n,r);else if(t.createTextRange){var s=t.createTextRange();s.collapse(!0),s.moveEnd("character",r),s.moveStart("character",n),s.select()}},Action.promptAndExecuteTest=function(){var e=prompt("Umpleonline test prompt. Enter command e.g. 'ac Classname' to add a class",""),t=e.substr(2,99).strip().split(" ");if(e.substr(0,1)=="a"){if(e.substr(1,1)=="c"){if(t.length>=1){Action.directAddClass(t[0]);return}}else if(e.substr(1,1)=="a"){if(t.length>=2){Action.directAddAttribute(t[0],t[1]);return}}else Page.setFeedbackMessage("Syntax error in test add command");Page.setFeedbackMessage("Syntax error in test command")}},Action.setFilterFull=function(e,t){Page.filterWordsOutput="";var n=e.split(" ").filter(r=>r.trim()!=="");n.forEach(function(r){var o=r;r.startsWith("gvseparator=")&&(o=r.replace(".","@@@")),Page.filterWordsOutput+=o+"!@"}),t&&Action.redrawDiagram()},Action.setFilter=function(e){return Action.setFilterFull(e,!0)},Action.directAddClass=function(e){var t=Json.toString({position:{x:"10",y:"10",width:"109",height:"41"},name:e});Page.setFeedbackMessage("Adding class "+e),Action.setjustUpdatetoSaveLater(!1),Action.ajax(Action.directUpdateCommandCallback,format("action=addClass&actionCode={0}",t))},Action.directAddAttribute=function(e,t){Page.setFeedbackMessage("((when written) Adding to class "+e+" attribute "+t)},Action.selectMatchingText=function(e){if(Page.codeMirrorOn){const t=new cm6.SearchCursor(Page.codeMirrorEditor6.state.doc,e);return t.next()?(Page.codeMirrorEditor6.dispatch({selection:{anchor:t.value.from,head:t.value.to}}),!0):!1}return!1},Action.selectItemCM6=function(e){if(Page.codeMirrorOn){var t=Page.codeMirrorEditor6.state.doc.toString();let r=Action.splitStates(t),o=null;for(let c=0;c<r.length;c++)if(r[c].search(e)==0){o=r[c];break}let a=0,s=0;try{a=t.indexOf(o),s=a+o.length}catch{console.log("Please wait a little more for diagram updates, and try again.")}var n={startIndex:a,endIndex:s};return n}},Action.selectMethod=function(e,t,n){var r=new RegExp(n+" "+t+" "+e+"(\\s|[(])"),o=new RegExp("(public|protected|private|class) [A-Za-z]"),a=Action.selectItemCM6(r);Action.highlightByIndexCM6(a.startIndex,a.endIndex)},Action.selectAssociation=function(e){var t=e.split(","),n=t[0],r=new RegExp("(associationClass|class|interface|trait) "+n+"($|\\s|[{])"),o=new RegExp("(class|interface|trait) [A-Za-z]");if(Page.codeMirrorOn)var a=Action.selectItemCM6(r),s=Page.codeMirrorEditor6.state.sliceDoc(a.startIndex,a.endIndex);var c,d;if(t.length>3){if(t[2].trim().includes(" ")){var u=t[2].split(" ");c=t[3].trim(),u.length==2?d=u[0].trim()+" "+t[1].trim()+" "+u[1].trim():d=u[0].trim()+" "+t[1].trim()}else c=t[3].trim(),d=t[2].trim()+" "+t[1].trim();var f=c.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),v=d.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),h=f+"(?:\\s+sorted\\s+{.*?})?(\\s*<-\\s*|\\s*><\\s*|\\s*--\\s*|\\s*->\\s*|\\s*<@>\\-\\s*|\\s*-\\<@>\\s*)"+v+"(?:\\s+sorted\\s+{.*?})?\\s*;",C=new RegExp(h,"g"),A=Page.codeMirrorEditor6.state.doc.toString(),T=s.match(C);if(T)return startIndex=A.indexOf(s)+s.indexOf(T[0]),endIndex=startIndex+T[0].length,Action.highlightByIndexCM6(startIndex,endIndex),{startIndex,endIndex};if(v.startsWith("1")){d=v.substring(2).trim(),v=d.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),h=f+"\\s+"+v+"\\s*;",C=new RegExp(h,"g"),T=s.match(C),T==null&&(h=f+"\\s+.*?"+v+"\\s*;",C=new RegExp(h,"g"),T=s.match(C));try{startIndex=A.indexOf(s)+s.indexOf(T[0]),endIndex=startIndex+T[0].length}catch{console.log("Please wait a little more for diagram updates, and try again.")}return Action.highlightByIndexCM6(startIndex,endIndex),{startIndex,endIndex}}else{if(f.trim().includes(" ")){var j=f.split(" ");f=j[0].trim()+" "+n+" "+j[1].trim()}else f+=" "+n;h=f+"(\\s*<-\\s*|\\s*><\\s*|\\s*--\\s*|\\s*->\\s*|\\s*<@>\\-\\s*|\\s*-\\<@>\\s*)"+v+"\\s*;",C=new RegExp(h,"g"),T=A.match(C),T==null&&(h=f+"\\s+.*?"+v+"\\s*;",C=new RegExp(h,"g"),T=A.match(C));try{startIndex=A.indexOf(T[0]),endIndex=startIndex+T[0].length}catch{console.log("Please wait a little more for diagram updates, and try again.")}return Action.highlightByIndexCM6(startIndex,endIndex),{startIndex,endIndex}}}else{var u=t[2].split(" ");c=u[0].trim(),d=u[1].trim();var f=c.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),v=d.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),h=f+".*?"+v+"\\s*;",C=new RegExp(h,"g"),A=Page.codeMirrorEditor6.state.doc.toString(),T=s.match(C);if(T)return startIndex=A.indexOf(s)+s.indexOf(T[0]),endIndex=startIndex+T[0].length,Action.highlightByIndexCM6(startIndex,endIndex),{startIndex,endIndex}}},Action.selectClass=function(e){var t=new RegExp("(associationClass|class|interface|trait) "+e+"($|\\s|[{])"),n=new RegExp("(class|interface|trait) [A-Za-z]"),r=Action.selectItemCM6(t);Action.highlightByIndexCM6(r.startIndex,r.endIndex)},Action.selectState=function(e){var t=new RegExp("(class|interface|trait) "+e+"($|\\s|[{])"),n=new RegExp("(class|interface|trait) [A-Za-z]"),r=Action.selectItemCM6(t);Action.highlightByIndexCM6(r.startIndex,r.endIndex)},Action.splitStates=function(e){let t=[],n="",r=0,o=!1,a=!1;for(var s in e){let c=e.charAt(s);a&&c!=`
`&&c!=" "&&(a=!1,c!="{"&&(n="")),c=="/"&&e.charAt(parseInt(s)+1)=="/"&&(o=!0),c==`
`&&o&&(o=!1),c=="{"&&!o?(n=n+c,r++):c=="}"&&!o?(n=n+c,r--,r==0&&(t.push(n.trim()),n="")):c==`
`&&r==0?(a=!0,n=n+`
`):c==" "&&r==0&&n==""||(n=n+c)}return t},Action.indexToPos=function(e,t){for(var n=0,r=0,o="",a=0;a<e;a++){let s=t.charAt(a);s==`
`?(r++,o=""):o=o+s}return n=o.length,output={line:r,ch:n},output},Action.selectStateInClassCM6=function(e,t,n){if(Page.codeMirrorOn){var r=Page.codeMirrorEditor6.state.doc.toString();let a=Action.splitStates(r),s=null,c=new RegExp("(?:class|queued)\\s+"+e,"");for(let u=0;u<a.length;u++)if(a[u].search(c)==0){s=a[u];break}a=Action.splitStates(s.substr(s.indexOf("{")+1));let d=null;for(let u=0;u<a.length;u++){let f=new RegExp("(?:queued\\s*)?"+t);if(a[u].search(f)==0){d=a[u];break}}if(a=Action.splitStates(d.substr(d.indexOf("{")+1)),a!=null){let u=a,f=null;for(let C=0;C<u.length;C++)if(u[C].search(n)==0){f=u[C];break}let v=r.indexOf(s),h=v+s.length;v=r.substr(v,h).indexOf(d)+v,h=v+d.length,v=r.substr(v,h).indexOf(f)+v,h=v+f.length;var o={startIndex:v,endIndex:v+f.length};return o}else console.log("No matching state found with regex:"+c)}else console.log("No matching class and state machine found for class: "+e+" and sm "+t);return null},Action.selectStateInStateCM6=function(e,t,n){var r=Page.codeMirrorEditor6.state.doc.toString().substr(e,t-e);let o=Action.splitStates(r.substr(r.indexOf("{")+1));var a=null;for(let u=0;u<o.length;u++)if(o[u].startsWith(n)){a=o[u];break}let s=r.indexOf(a)+e,c=s+a.length;return{startIndex:s,endIndex:c}},Action.highlightByIndex=function(e,t){Page.codeMirrorEditor.setSelection(Action.indexToPos(e,Page.codeMirrorEditor.getValue()),Action.indexToPos(t,Page.codeMirrorEditor.getValue()))},Action.highlightByIndexCM6=function(e,t){let n=Action.indexToPos(e,Page.codeMirrorEditor6.state.doc.toString()),r=Page.codeMirrorEditor6.state.doc.line(n.line+1).from,o=Action.indexToPos(t,Page.codeMirrorEditor6.state.doc.toString()),a=Math.min(o.line+2,Page.codeMirrorEditor6.state.doc.lines),s=Page.codeMirrorEditor6.state.doc.line(a).from;Page.codeMirrorEditor6.dispatch({selection:cm6.EditorSelection.create([cm6.EditorSelection.range(s,r)]),scrollIntoView:!0})},Action.findEOL=function(e){let t="",n="",r=0,o=!1;for(var a in e){let s=e.charAt(a);if(s=="{")r++,n=n+s;else if(s=="}")r--,n=n+s;else if(s==";"&&r==0){t=n+";";break}else n=n+s}return t},Action.delayedFocus=function(e){var t=document.getElementById("umpleModelEditorText");setTimeout(function(){t.focus()},e)},Action.updateLineNumberDisplay=function(){jQuery("#linenum").val(Action.getCaretPosition())},Action.umpleTyped=function(e){clientDebuggerFlag&&console.log("Inside Action.umpleTyped()..."),Page.getAdvancedMode()=="2"&&Page.catFeedbackMessage("["+e.keyCode+"] "),Action.updateLineNumberDisplay();var t=e.keyCode;if(!(t>=33&&t<=40)){var n=e.target.id;Action.umpleTypingActivity(n)}},Action.umpleCodeMirrorCursorActivity=function(){var e=Page.codeMirrorEditor6.state.selection.main.head,t=Page.codeMirrorEditor6.state.doc.lineAt(e);jQuery("#linenum").val(t.number)},Action.umpleCodeMirrorTypingActivity=function(e){clientDebuggerFlag&&console.log("Inside Action.umpleCodeMirrorTypingActivity..."),Action.freshLoad==!1?(Action.umpleTypingActivity(e),e=="codeMirrorEditor"&&Page.codeMirrorEditor.save()):(Action.freshLoad=!1,Action.setjustUpdatetoSaveLaterForTextCallback(!1))},Action.trimMultipleNonPrintingAndComments=function(e){return e=Action.removeComments(e),e=e.replace(/[^\x21-\x7E]+/g," "),e=e.replace(/^\s+|\s+$/g,""),e},Action.removeComments=function(e){var t="_"+ +new Date,n=[],r=0;return e.replace(/(['"])(\\\1|.)+?\1/g,function(o){return n[r]=o,t+""+r++}).replace(/([^\/])(\/(?!\*|\/)(\\\/|.)+?\/[gim]{0,3})/g,function(o,a,s){return n[r]=s,a+(t+"")+r++}).replace(/\/\/.*?\/?\*.+?(?=\n|\r|$)|\/\*[\s\S]*?\/\/[\s\S]*?\*\//g," ").replace(/\/\/.+?(?=\n|\r|$)|\/\*[\s\S]+?\*\//g," ").replace(RegExp("\\/\\*[\\s\\S]+"+t+"\\d+","g")," ").replace(RegExp(t+"(\\d+)","g"),function(o,a){return n[a]})},Action.umpleTypingActivity=function(e){clientDebuggerFlag&&console.log("Inside Action.umpleTypingActivity()..."),Action.manualSync&&Action.diagramInSync&&(jQuery("#umpleCanvasColumn").is(":visible")&&Page.enablePaletteItem("buttonSyncDiagram",!0),Action.diagramInSync=!1,Page.enableDiagram(!1)),Action.oldTimeout!=null&&clearTimeout(Action.oldTimeout),e=="diagramEdit"?Action.oldTimeout=setTimeout('Action.processTyping("'+e+'",false)',500):Action.oldTimeout=setTimeout('Action.processTyping("'+e+'",false)',Action.waiting_time)},Action.processTyping=function(e,t,n){if(clientDebuggerFlag&&console.log("Inside Action.processTyping ...",e),document.getElementById("newEditor").value=Page.codeMirrorEditor6.state.doc.toString(),e!="diagramEdit"?Action.setjustUpdatetoSaveLaterForTextCallback(!0):Action.setjustUpdatetoSaveLaterForTextCallback(!1),!Action.manualSync||t)if(Action.diagramInSync=!0,e=="umpleModelEditorText"||e=="codeMirrorEditor"||e=="newEditor"){Action.updateLayoutEditorAndDiagram(e);var r=document.getElementById("downloadLink");r!==null&&r.remove(),Page.enablePaletteItem("buttonSyncDiagram",!1)}else e=="diagramEdit"&&Action.ajax(Action.updateFromDiagramCallback,Action.getLanguage());e!="diagramEdit"&&(justUpdatetoSaveLater?(e=="umpleModelEditorText"||e=="codeMirrorEditor"||e=="newEditor")&&Action.setjustUpdatetoSaveLater(!1):TabControl.getCurrentHistory().save(Page.getUmpleCode(),"processTyping"),Page.setExampleMessage(""))},Action.updateCurrentUmpleTextBeingEdited=function(e){Page.currentUmpleTextBeingEdited=e,jQuery("#umpleModelEditorText").val(e),Page.setCodeMirror6Text(e)},Action.updateLayoutEditorAndDiagram=function(e){Action.ajax(Action.updateUmpleLayoutEditor,"language=Json",e)},Action.updateUmpleLayoutEditor=function(e){var t=e.responseText.split("URL_SPLIT"),n=t[0],r=t[1];(r==null||r==null)&&(r=e.responseText),Page.showLayoutLoading(),Action.ajax(Action.updateUmpleLayoutEditorCallback,format("action=addPositioning&actionCode={0}",r))},Action.updateUmpleLayoutEditorCallback=function(e){var t=e.responseText,n=Page.splitUmpleCode(t)[1];Page.setUmplePositioningCode(n),Page.hideLoading(),Action.updateUmpleDiagramForce(!0)},Action.updateUmpleDiagram=function(){return Action.updateUmpleDiagramForce(!0)},Action.updateUmpleDiagramForce=function(e){var t=Action.trimMultipleNonPrintingAndComments(Page.getUmpleCode());!e&&t==Action.savedCanonical||(Action.savedCanonical=t,Page.showCanvasLoading(),Action.ajax(Action.updateUmpleDiagramCallback,Action.getLanguage()))},Action.updateUmpleDiagramCallback=function(response){var theCanvas=jQuery("#umpleCanvas"),canvasX=Math.round(theCanvas.offset().left),canvasY=Math.round(theCanvas.offset().top),diagramCode="",errorMessage="";if(diagramCode=Action.getDiagramCode(response.responseText),errorMessage=Action.getErrorCode(response.responseText),Page.hideExecutionArea(),diagramCode==null||diagramCode==""||diagramCode=="null")Page.enableDiagram(!1),Action.diagramInSync=!1,Page.setFeedbackMessage('<a href="#errorClick">See message.</a> To fix: edit model or click undo');else{Page.enableDiagram(!0),Action.diagramInSync||(Action.diagramInSync=!0),Page.setFeedbackMessage(""),Page.hideGeneratedCode();var dynamicCheckboxItems=Page.getUmpleCode().match(/(((?<!(\/\/.*))(mixset))|((?<!(\/\/.*))(filter)))\s+[a-zA-Z1-9-_]+/g);dynamicCheckboxItems==null&&(dynamicCheckboxItems=new Array),dynamicCheckboxItems.push("gvmanual","gvdot","gvsfdp","gvcirco","gvortho");var spanToInjectItem=document.getElementById("ShowMFDynamicArea");if(spanToInjectItem.innerHTML="",!(dynamicCheckboxItems==null||dynamicCheckboxItems.length==0)){var boxesToActivate=new Array;dynamicCheckboxItems.forEach(function(e){var t=e.replace(/\s/g,""),n='<li id="tt'+t+'" class="layoutListItem view_opt_class">                <input id="button'+t+'" class="checkbox" type="checkbox"/>                <a id="label'+t+'" class="buttonExtend">'+e+"</a>              </li>";spanToInjectItem.innerHTML+=n,boxesToActivate.push(t)}),Page.mixsetsActive=Page.mixsetsActive.filter(function(e){return boxesToActivate.includes("mixset"+e)}),Page.filtersActive=Page.filtersActive.filter(function(e){return boxesToActivate.includes("filter"+e)}),Page.specialSuboptionsActive=Page.specialSuboptionsActive.filter(function(e){return boxesToActivate.includes(e)}),boxesToActivate.forEach(function(e){Page.initHighlighter("button"+e);var t=!1;(e.substr(0,6)=="mixset"&&Page.mixsetsActive.includes(e.substr(6))||e.substr(0,6)=="filter"&&Page.filtersActive.includes(e.substr(6))||e.substr(0,2)=="gv"&&Page.specialSuboptionsActive.includes(e))&&(t=!0),jQuery("#button"+e).prop("checked",t),Page.initAction("button"+e),Page.initLabel("label"+e),ToolTips.setATooltipBasic(ToolTips.dynamicTooltips,"tt"+e,"right"),jQuery("#tt"+e).show()})}if(Page.useEditableClassDiagram){var newSystem=Json.toObject(diagramCode);UmpleSystem.merge(newSystem),UmpleSystem.update(),Page.readOnly&&jQuery("span.editable").addClass("uneditable")}else if(Page.useJointJSClassDiagram){var model=JSON.parse(diagramCode.replace(new RegExp('} { "name": "',"gi"),'}, { "name": "')),umpleCanvas=jQuery("#umpleCanvas"),paper=JJSdiagram.initJJSDiagram(umpleCanvas,model),MouseWheelHandler=function(e){var t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));if(e.altKey===!0){var n=paper.options.height,r=paper.options.width,o=1+Math.abs(t)/(t*10);paper.setDimensions(r*o,n*o),JJSdiagram.paper&&JJSdiagram.paper.setDimensions(jQuery("#umpleCanvas")[0].clientWidth,jQuery("#umpleCanvas")[0].clientHeight)}},paperHolder=document.getElementById("umpleCanvas");paperHolder.addEventListener?(paperHolder.addEventListener("mousewheel",MouseWheelHandler,!1),paperHolder.addEventListener("DOMMouseScroll",MouseWheelHandler,!1)):paperHolder.attachEvent("onmousewheel",MouseWheelHandler),jQuery("#jjsPaper").click(function(){Action.focusOn(Page.umpleCanvasId(),!0)})}else if(Page.useGvClassDiagram||Page.useGvStateDiagram||Page.useGvFeatureDiagram){if(theCanvas.html(format("{0}",diagramCode)),theCanvas.children().first().attr("id","svgCanvas"),Page.useGvClassDiagram&&Page.isGvManual()){var algoWasRemoved=Action.deactivateSpecialLayoutAlgorithmsExcept(null),positioningCode=jQuery("#umpleLayoutEditorText").val(),elems=document.getElementsByClassName("node"),posMap=new Array,minUmpleLeft=9999999,minUmpleTop=9999999,minRectLeft=9999999,minRectTop=9999999;for(let u=0;u<elems.length;u++){var currentClassForPos=Action.getGvClassNameFromNode(elems[u]),umplePosOfCurrentClass=Action.getGvPosition(positioningCode,currentClassForPos);if(umplePosOfCurrentClass!=null){var theRect=Action.getRectFromSvgNode(elems[u],canvasX,canvasY),rectLeft=theRect.left,rectTop=theRect.top,rectCentreX=theRect.centreX,rectCentreY=theRect.centreY,uLeft=umplePosOfCurrentClass.x,uTop=umplePosOfCurrentClass.y;posMap.push({className:currentClassForPos,fullUmplePosOfCurrentClass:umplePosOfCurrentClass.all,left:uLeft,umpleX:Number(umplePosOfCurrentClass.x)+Number(umplePosOfCurrentClass.width)/2,rectCentreX,top:uTop,umpleY:Number(umplePosOfCurrentClass.y)+Number(umplePosOfCurrentClass.height)/2,rectCentreY,associationPos1:umplePosOfCurrentClass.assoc1,associationPos2:umplePosOfCurrentClass.assoc2}),minUmpleLeft=Math.min(minUmpleLeft,uLeft),minUmpleTop=Math.min(minUmpleTop,uTop),minRectLeft=Math.min(minRectLeft,rectLeft),minRectTop=Math.min(minRectTop,rectTop)}}let c=minUmpleLeft-minRectLeft,d=minUmpleTop-minRectTop;var nodesMoved=0;posMap.forEach(function(u){var v=Math.round(u.rectCentreX+c-u.umpleX),h=Math.round(u.rectCentreY+d-u.umpleY);(Math.abs(v)>10||Math.abs(h)>10)&&(nodesMoved++,Action.updateGVPositionBasic(u.className,v,h,positioningCode,u.fullUmplePosOfCurrentClass,u.left,u.top,u.associationPos1,u.associationPos2,!1))}),algoWasRemoved&&TabControl.getCurrentHistory().save(Page.getUmpleCode(),"moveClass")}const t=Page.getUmpleCode().split(`
`),n={};let r=null;const o=/^class\s+(\w+)/,a=/\s*(--\*|--|\*--\*|->|<-)\s*/,s=/^isA\s+([A-Za-z0-9_,\s]+);?/;for(let c=0;c<t.length;c++){const d=t[c].trim();if(d.includes("//$?[End_of_model]$?"))break;const u=d.match(o);if(u){r=u[1],n[r]||(n[r]=[]);continue}if(!r)continue;const f=d.match(s);if(f){const h=f[1].split(",").map(C=>C.trim().replace(/[^a-zA-Z0-9_]/g,""));n[r].push(...h);continue}const v=d.split(a);if(v.length>=3){const C=v[2].trim().split(/\s+/),T=(C.length>1?C[1]:C[0]).replace(/[^a-zA-Z0-9_]/g,"");T&&n[r].push(T)}}for(const[c,d]of Object.entries(n))for(const u of d)n[u]||(n[u]=[]),n[u].includes(c)||n[u].push(c);Action.neighbors=n,Action.setupPinch()}else Page.useStructureDiagram&&(jQuery("#umpleCanvas").html('<svg id="svgCanvas"></svg>'),eval(diagramCode))}if(errorMessage!=""?(Action.lastCompilerErrorHtml=errorMessage,Page.showGeneratedCode(errorMessage,"diagramUpdate")):Action.lastCompilerErrorHtml="",Page.hideLoading(),Page.useGvClassDiagram){allowNodeMovement=!0,Page.isGvManual()||(allowNodeMovement=!1);var elems=document.getElementsByClassName("node");for(let t=0;t<elems.length;t++){let n=elems[t];n.addEventListener("contextmenu",function(r){r.preventDefault(),Action.displayMenu(r)}),n.addEventListener("dblclick",function(r){r.preventDefault(),Action.displayMenu(r)}),n.addEventListener("mousedown",function(r){r.preventDefault();let o=0,a=0,s=!1;Page.selectedGvClass=Action.getGvClassName(r),Page.initialMouseDownX=r.clientX,Page.initialMouseDownY=r.clientY;let c=Page.initialMouseDownX,d=Page.initialMouseDownY,u=Action.getRectFromSvgNode(n,canvasX,canvasY),f=u.top,v=u.left;function h(A){A.preventDefault();let T=A.clientX,j=A.clientY;u=Action.getRectFromSvgNode(n,canvasX,canvasY),f=u.top,v=u.left;let N=T-c,p=j-d;o+=N,a+=p,allowNodeMovement&&(s||Math.abs(o+a)>10)&&(n.setAttribute("transform"," translate("+o+","+a+")"),s=!0),c=T,d=j,allowNodeMovement||Page.setFeedbackMessage("To enable moving of classes in G mode, set gvmanual in the Show and Hide menu")}function C(A){allowNodeMovement&&s&&(o!=0||o!=0)&&Action.updateGvPosition(Page.selectedGvClass,o,a),document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",C)}document.addEventListener("mousemove",h),document.addEventListener("mouseup",C)});var attributeAnchors=elems[t].getElementsByTagName("a");for(let r=1;r<attributeAnchors.length;r++){let o=attributeAnchors[r].getAttribute("xlink:title"),[a,s]=o.split(" ");attributeAnchors[r].addEventListener("dblclick",function(c){c.preventDefault(),Action.displayAttributeMenu(c,s,a)}),attributeAnchors[r].addEventListener("contextmenu",function(c){c.preventDefault(),c.stopPropagation(),Action.displayAttributeMenu(c,s,a)})}}var associationElems=document.getElementsByClassName("edge");for(let t=0;t<associationElems.length;t++){var associationAnchors=associationElems[t].getElementsByTagName("a");for(let n=0;n<associationAnchors.length;n++){let r=associationAnchors[n].getAttribute("xlink:href");associationAnchors[n].addEventListener("dblclick",function(o){o.preventDefault(),Action.displayAssociMenu(o,r)}),associationAnchors[n].addEventListener("contextmenu",function(o){o.preventDefault(),Action.displayAssociMenu(o,r)})}}}if(Page.useGvStateDiagram){var elems=document.getElementsByClassName("node");for(let t=0;t<elems.length;t++)elems[t].addEventListener("contextmenu",function(n){n.preventDefault(),Action.drawStateMenu(n)}),elems[t].addEventListener("dblclick",function(n){n.preventDefault(),Action.drawStateMenu(n)});elems=document.getElementsByClassName("cluster");for(let t=0;t<elems.length;t++)elems[t].addEventListener("contextmenu",function(n){n.preventDefault(),Action.drawStateMenu(n)}),elems[t].addEventListener("dblclick",function(n){n.preventDefault(),Action.drawStateMenu(n)});var transitionElems=document.getElementsByClassName("edge");for(let t=0;t<transitionElems.length;t++)transitionElems[t].addEventListener("dblclick",function(n){n.preventDefault(),Action.displayTransitionMenu(n)}),transitionElems[t].addEventListener("contextmenu",function(n){n.preventDefault(),Action.displayTransitionMenu(n)})}},Action.deactivateSpecialLayoutAlgorithmsExcept=function(e){var t=new Array,n=!1;return t.push("gvdot","gvsfdp","gvcirco"),e!=null&&!t.includes(e)?!1:(t.forEach(function(r){if(e==null||r!=e){jQuery("#button"+r).prop("checked",!1);var o=Page.specialSuboptionsActive.indexOf(r);o!==-1&&(Page.specialSuboptionsActive.splice(o,1),n=!0)}}),n)},Action.getRectFromSvgNode=function(e,t,n){var r=e.getBoundingClientRect();return{left:Math.round(r.left-t),top:Math.round(r.top-n),centreX:Math.round(r.left-t+Math.abs(r.width/2)),centreY:Math.round(r.top-n+Math.abs(r.height/2))}},Action.updateFromDiagramCallback=function(e){var t="",n="";t=Action.getDiagramCode(e.responseText),n=Action.getErrorCode(e.responseText),(t==null||t==""||t=="null")&&Action.diagramInSync?(Page.enableDiagram(!1),Action.diagramInSync=!1,Page.setFeedbackMessage('<a href="#errorClick">See message.</a> To fix: edit model or click undo')):(Page.enableDiagram(!0),Action.diagramInSync=!0),n!=""?(Action.lastCompilerErrorHtml=n,Page.showGeneratedCode(n,"diagramUpdate")):Action.lastCompilerErrorHtml=""},Action.getDiagramCode=function(e){var t="";if(Page.useEditableClassDiagram||Page.useJointJSClassDiagram)t=e.split("URL_SPLIT")[1],t=="null"&&(t="");else if(Page.useGvClassDiagram||Page.useGvStateDiagram||Page.useGvFeatureDiagram){var n=e.split("<svg width=");n.length>1&&n[1].length>100&&(t="<svg width="+n[1],t=t.replace(/<\/svg>$/,""))}else Page.useStructureDiagram&&(t=e.split("<p>URL_SPLIT")[1],t=t.replace(/##CANVAS_ID##/g,"svgCanvas"),t=jQuery("<div/>").html(t).text());return t},Action.getErrorCode=function(e){var t="";if(Page.useEditableClassDiagram||Page.useStructureDiagram)t=e.split("URL_SPLIT")[0],t=="<p>"&&(t="");else if(Page.useGvClassDiagram||Page.useGvStateDiagram||Page.useGvFeatureDiagram){var n=e.split("<svg width=")[0],r=n.split("errorRow");r.length>1&&(t=n.split("<\/script>&nbsp;")[0])}return t},Action.classResizing=function(e,t){var n=e.target.id,r=UmpleSystem.find(n),o="#"+n,a=Math.round(jQuery(o).width()),s=Math.round(jQuery(o).height());UmpleSystem.updatingSize(r,a,s)},Action.associationSnap=function(e,t,n){var r=jQuery(n).prop("id"),o=r.substr(0,r.lastIndexOf("_")),a=r.substr(r.lastIndexOf("_")+6+1),s=UmpleSystem.findAssociation(o),c=s.getClass(a),d=UmpleClassFactory.perimeterPosition(c,new UmplePosition(e,t,0,0),UmpleSystem.position());return[d.x,d.y]},Action.associationSnapClassReady=function(e,t,n){var r=UmpleClassFactory.perimeterPosition(n,new UmplePosition(e,t,0,0),UmpleSystem.position());return[r.x,r.y]},Action.updateMovedAssociation=function(e,t){jQuery(e).show();var n=jQuery(e).offset(),r=jQuery(e).prop("id");jQuery(e).hide();var o=Math.round(n.left),a=Math.round(n.top),s=Action.associationSnap(o,a,e),c=new UmplePosition(s[0],s[1],0,0);r.endsWith("_anchor0")?t.setOffsetOnePosition(c):t.setOffsetTwoPosition(c),UmpleSystem.redrawAssociation(t),Action.associationSelected(null)},Action.validateAttributeName=function(e){return e.length!=0&&(e.match(/^[_a-zA-Z0-9]+$/)||e.match(/^[_a-zA-Z0-9]+[\u0020]*:[\u0020]*[_a-zA-Z0-9]+(\[\])?$/))},Action.validateMethodName=function(e){return e.length!=0&&e.match(/^[-+#]?\s*[_a-zA-Z0-9]+\s*\(([_a-zA-Z0-9]+(\[\])?(,\s*[_a-zA-Z0-9]+(\[\])?)*)?\)(\s*:\s*[_a-zA-Z0-9]+(\[\])?)?$/)},Action.toggleAttributes=function(){Page.showAttributes=!Page.showAttributes,Action.redrawDiagram()},Action.toggleMethods=function(){Page.showMethods=!Page.showMethods,Action.redrawDiagram()},Action.toggleActions=function(){Page.showActions=!Page.showActions,Action.redrawDiagram()},Action.toggleTransitionLabels=function(){Page.showTransitionLabels=!Page.showTransitionLabels,Action.redrawDiagram()},Action.toggleGuards=function(){Page.showGuards=!Page.showGuards,Action.redrawDiagram()},Action.toggleGuardLabels=function(){Page.showGuardLabels=!Page.showGuardLabels,Action.redrawDiagram()},Action.allowPinch=function(){Page.allowPinch=!Page.allowPinch,Action.redrawDiagram()},Action.toggleFeatureDependency=function(){Page.showFeatureDependency=!Page.showFeatureDependency,Action.redrawDiagram()},Action.toggleTraits=function(){Page.showTraits=!Page.showTraits,Action.redrawDiagram()},Action.redrawDiagram=function(){UmpleSystem.merge(null);var e=jQuery("#umpleCanvas");e.html(""),Action.manualSync||(Action.updateUmpleDiagram(),Action.diagramInSync=!0),Action.manualSync&&!Action.diagramInSync&&Page.enablePaletteItem("buttonSyncDiagram",!0),(!Action.manualSync||Action.diagramInSync)&&(Page.enableCheckBoxItem("buttonPhotoReady","ttPhotoReady",!0),Page.enableCheckBoxItem("buttonManualSync","ttManualSync",!0),Page.enablePaletteItem("buttonAddClass",!0),Page.enablePaletteItem("buttonAddAssociation",!0),Page.enablePaletteItem("buttonAddTransition",!0),Page.enablePaletteItem("buttonAddGeneralization",!0),Page.enablePaletteItem("buttonDeleteEntity",!0),Page.initToggleTool("buttonAddClass"),Page.initToggleTool("buttonAddAssociation"),Page.initToggleTool("buttonAddTransition"),Page.initToggleTool("buttonAddGeneralization"),Page.initToggleTool("buttonDeleteEntity"))},InlineEditor.elementChanged=function(e,t,n){var r=e.attr("name"),o=e.attr("id");if(r=="className"){var a=o.substr(0,o.length-5);DiagramEdit.classNameChanged(a,t,n)}else if(r=="attributeEdit"){var s=o.substr(o.lastIndexOf("_")+1),a=o.substr(0,o.length-11-s.length);DiagramEdit.attributeNameChanged(a,s,t,n)}else if(r=="methodEdit"){var s=o.substr(o.lastIndexOf("_")+1),a=o.substr(0,o.length-8-s.length);DiagramEdit.methodChanged(a,s,t,n)}else if(r=="attributeNew"){var a=o.substr(0,o.length-13);DiagramEdit.attributeNew(a,n)}else if(r=="methodNew"){var a=o.substr(0,o.length-10);DiagramEdit.methodNew(a,n)}},Action.enableManualSync=function(e){var t=jQuery("#buttonManualSync"),n=jQuery("#buttonSyncDiagram");e==null&&(e=t.is(":checked")),e?Action.manualSync=!0:(Action.manualSync=!1,Action.processTyping("umpleModelEditorText",!0),Page.enablePaletteItem("buttonSyncDiagram",!1))},Action.generateStructureDiagramFile=function(){var e=Page.getFilename().slice(0,-9)+"structureDiagram.svg",t=jQuery("#innerGeneratedCodeRow").html().slice(4,-1);t=format('<svg xmlns="http://www.w3.org/2000/svg" {0}>',t),jQuery("#buttonStructureLink").showLoading(),Ajax.sendRequest("scripts/compiler.php",Action.generateStructureDiagramFileCallback,format("save=1&filename={0}&svgContent={1}",e,t))},Action.generateStructureDiagramFileCallback=function(e){jQuery("#buttonStructureLink").hideLoading(),Page.toggleStructureDiagramLink(!0,e.responseText)},Action.ajax=function(e,t,n,d,o){var a=null;a=Page.getUmpleCode();var s=encodeURIComponent(a),c=Page.getFilename(),d="true";TabControl.useActiveTabTo(TabControl.saveTab)(s),t=t+"&theme="+Action.getThemePreference();var u=TabControl.getActiveTabId(),f=o?e:function(v){var h=TabControl.getActiveTabId();if(h!==u){Page.hideLoading();return}e(v)};Ajax.sendRequest("scripts/compiler.php",f,format("{0}&error={3}&umpleCode={1}&filename={2}",t,s,c,d))},navigator.appVersion.indexOf("Mac")!=-1?(jQuery(document).ready(function(){jQuery("#undosmall").html("[cmd+z]"),jQuery("#redosmall").html("[cmd+shift+z]")}),Mousetrap.bind(["command+z"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Action.undo(),e.preventDefault()}),Mousetrap.bind(["command+shift+z"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Action.redo(),e.preventDefault()})):(jQuery(document).ready(function(){jQuery("#undosmall").html("[ctrl+z]"),jQuery("#redosmall").html("[ctrl+y]")}),Mousetrap.bind(["ctrl+z"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Action.undo(),e.preventDefault()}),Mousetrap.bind(["ctrl+y"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Action.redo(),e.preventDefault()})),Mousetrap.bind(["up"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(0,-5,0,0)),!1}),Mousetrap.bind(["shift+up"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(0,-1,0,0)),!1}),Mousetrap.bind(["down"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(0,5,0,0)),!1}),Mousetrap.bind(["shift+down"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(0,1,0,0)),!1}),Mousetrap.bind(["left"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(-5,0,0,0)),!1}),Mousetrap.bind(["shift+left"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(-1,0,0,0)),!1}),Mousetrap.bind(["right"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(5,0,0,0)),!1}),Mousetrap.bind(["shift+right"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(1,0,0,0)),!1}),Mousetrap.bind(["ctrl+e"],function(e){return Page.clickShowEditableClassDiagram(),!1}),Mousetrap.bind(["ctrl+j"],function(e){return Page.clickShowJointJSClassDiagram(),!1}),Mousetrap.bind(["ctrl+g"],function(e){return Page.clickShowGvClassDiagram(),!1}),Mousetrap.bind(["ctrl+s"],function(e){return Page.clickShowGvStateDiagram(),!1}),Mousetrap.bind(["ctrl+l"],function(e){return Page.clickShowStructureDiagram(),!1}),Mousetrap.bind(["ctrl+t","ctrl+alt+shift+t"],function(e){return Page.clickShowHideText(),!1}),Mousetrap.bind(["ctrl+d"],function(e){return Page.clickShowHideCanvas(),!1}),Mousetrap.bind(["ctrl+n","ctrl+alt+n"],function(e){return Page.clickShowHideMenu(),!1}),Mousetrap.bind(["shift+ctrl+a"],function(e){return Page.clickToggleAttributes(),!1}),Mousetrap.bind(["ctrl+m"],function(e){return Page.clickToggleMethods(),!1}),Mousetrap.bind(["ctrl+r"],function(e){return Page.clickToggleTraits(),!1}),Mousetrap.bind(["ctrl+i"],function(e){return Page.clickToggleTransitionLabels(),!1}),Mousetrap.bind(["ctrl+k"],function(e){return Page.clickToggleGuardLabels(),!1}),Mousetrap.bind(["ctrl+b"],function(e){return Action.promptAndExecuteTest(),!1}),Mousetrap.bind(["ctrl+o"],function(e){return Action.copyCommandLineCode(),!1}),Mousetrap.bind(["g"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Page.selectedAssociation==null&&Page.selectedGeneralization==null&&(Page.selectedClass==null||Page.selectedClass&&jQuery("#"+Page.selectedClass.id).find("input").length==0)&&jQuery("#buttonAddGeneralization").click()}),Mousetrap.bind(["a"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Page.selectedAssociation==null&&Page.selectedGeneralization==null&&(Page.selectedClass==null||Page.selectedClass&&jQuery("#"+Page.selectedClass.id).find("input").length==0)&&jQuery("#buttonAddAssociation").click()}),Mousetrap.bind(["c"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Page.selectedAssociation==null&&Page.selectedGeneralization==null&&(Page.selectedClass==null||Page.selectedClass&&jQuery("#"+Page.selectedClass.id).find("input").length==0)&&jQuery("#buttonAddClass").click()}),Action.toggleTabsCheckbox=function(e){$("inputGenerateCode").value.split(":")[1]=="TextUml"&&(e="TextUml"),e=="java"||e=="php"||e=="cpp"||e=="python"||e=="ruby"||e=="sql"?(jQuery("#ttTabsCheckbox").show(),jQuery("#tabRow").show(),($("inputGenerateCode").value.split(":")[1]=="USE"||$("inputGenerateCode").value.split(":")[1]=="UmpleSelf"||$("inputGenerateCode").value.split(":")[1]=="Json")&&(jQuery("#ttTabsCheckbox").hide(),jQuery("#tabRow").hide())):(jQuery("#ttTabsCheckbox").hide(),jQuery("#tabRow").hide(),jQuery("#buttonTabsCheckbox").is(":checked")&&jQuery("#buttonTabsCheckbox").click())},Action.toggleTabs=function(){jQuery("#buttonTabsCheckbox").is(":checked")?(jQuery("#tabRow").show(),jQuery("#innerGeneratedCodeRow").hide(),jQuery("#tabButton1").click()):(jQuery("#tabRow").hide(),jQuery("#innerGeneratedCodeRow").show(),jQuery("#innerGeneratedCodeRow").nextAll().hide())},Action.generateTabsCode=function(e){var t=[],n=0,r="",o=[],a="",s=!1;for(e.split("URL_SPLIT")[1].split(`
`).forEach(function(c){c.indexOf("//%%")>=0||c.indexOf("# %%")>=0?(n++,strFileName=c.slice(14),strFileName=strFileName.substr(0,strFileName.indexOf(" ")),o[n]=strFileName,jQuery("#generatedCodeRow").append("<div id='innerGeneratedCodeRow"+n+"'></div>"),t[n]="",s=!0):s?s=!1:t[n]+=c+`
`}),i=1;i<=n;i++)jQuery("#tabRow").append("<button type='button' id='tabButton"+i+"'>"+o[i]+"</button>"),jQuery("#tabButton"+i).click({code:t[i],tabnumber:i},showTab)},Action.getLanguage=function(){var e="";if(Page.useEditableClassDiagram?e="language=Json":Page.useJointJSClassDiagram?e="language=JsonMixed":Page.useGvClassDiagram?Page.showTraits?e="language=traitDiagram":e="language=classDiagram":Page.useGvStateDiagram?e="language=stateDiagram":Page.useStructureDiagram&&(e="language=StructureDiagram"),Page.useGvStateDiagram&&(Page.showActions||(e=e+".hideactions"),Page.showTransitionLabels&&(e=e+".showtransitionlabels"),Page.showGuards||(e=e+".hideguards"),Page.showGuardLabels&&(e=e+".showguardlabels"),e=e+"."+$("inputGenerateCode").value.split(":")[1]),Page.useGvClassDiagram&&(Page.showMethods&&(e=e+".showmethods"),Page.showAttributes||(e=e+".hideattributes")),Page.useGvFeatureDiagram&&(e="language=featureDiagram",Page.showFeatureDependency&&(e=e+".showFeatureDependency")),copyableMixset="",Page.filterWordsOutput!=""){e=e+".!@FW!@"+Page.filterWordsOutput;var t="";Page.filterWordsOutput.split("!@").forEach(function(r){r!=""&&(isNaN(r)?r.substr(0,2)=="gv"?r.substr(0,11)=="gvseparator"?copyableMixset+='  suboption "'+r.replace("@@@","")+`";
`:copyableMixset+='  suboption "'+r+`";
`:r.substr(0,6)=="filter"?copyableMixset+="  filter {includeFilter "+r.substr(6)+`;}
`:r.substr(0,6)=="mixset"?copyableMixset+="  use "+r.substr(6)+`;
`:t+=" include "+r+";":t+="  hops { association "+r+";} ")}),t!=""&&(copyableMixset+="  filter {"+t+`}
`)}Page.filtersActive.forEach(function(r){e=e+".filter"+r,copyableMixset+="  filter {includeFilter "+r+`;}
`}),Page.mixsetsActive.forEach(function(r){e=e+".mixset"+r,copyableMixset+="  use "+r+`;
`}),Page.specialSuboptionsActive.forEach(function(r){e=e+"."+r,copyableMixset+='  suboption "'+r+`";
`});var n=Math.floor(Math.random()*899+100);return Page.copyableMixset=`// The following was generated from the show and hide options
// Rename the mixset and paste into the code so you can invoke it at any time
mixset M`+n+` {
`+copyableMixset+"}",e};function showTab(e){jQuery("#innerGeneratedCodeRow").nextAll().hide(),jQuery("#innerGeneratedCodeRow"+e.data.tabnumber).show(),Page.showGeneratedCode(e.data.code,$("inputGenerateCode").value.split(":")[0],e.data.tabnumber),jQuery("#innerGeneratedCodeRow").hide()}Action.hidegdpr=function(){jQuery("#gdprtext").hide(),Action.gdprHidden=!0},Action.reindent=function(e,t){for(var n="",r="",o=e.length,a=!1,s=!0,c=0,d=-1,u=0;u<o;u++){for(var f=e[u].trim(),v=f.indexOf('"'),h=f.indexOf('"',v+1);v!=-1&&h!=-1;)f=f.slice(0,v)+f.slice(h+1,f.length),v=f.indexOf('"'),h=f.indexOf('"',v+1);if(f.indexOf("//")!=-1&&(f=f.substr(0,f.indexOf("//")).trim()),a)if(f.indexOf("*/")!=-1)f=f.substr(f.indexOf("*/")+2).trim(),a=!1;else{u!=e.length-1?r+=e[u]+`
`:r+=e[u];continue}else f.indexOf("/*")!=-1&&(f.indexOf("*/")==-1?(a=!0,f=f.substr(0,f.indexOf("/*")).trim()):f=f.substr(0,f.indexOf("/*"))+f.substr(f.indexOf("*/")+2).trim());var C=f.indexOf("{"),A=f.indexOf("}"),T=f.indexOf(";");if(T!=-1&&T!=f.length-1&&f.substr(T+1).trim().charAt(0)!="}"){e.splice(u+1,0,f.substr(T+1)),u<=t.line&&t.line++,e[u]=e[u].substr(0,e[u].match(/^\s*/)[0].length+T+1),Action.reindent(e,t);return}var j=C!=-1&&A!=-1&&A-C<40&&f.substr(0,A).indexOf("{",C+1)==-1;if(j){if(A!=f.length-1){e.splice(u+1,0,f.substr(A+1)),u<=t.line&&t.line++,e[u]=e[u].substr(0,e[u].match(/^\s*/)[0].length+A+1),Action.reindent(e,t);return}s?e[u]=n+e[u].trim():f.slice(-1)=="{"?s=!0:(e[u]=n+e[u].match(/^\s*/)[0].substr(c)+e[u].trim(),f.indexOf(";")==f.length-1&&(s=!0))}else{if(C!=-1&&C!=f.length-1){e.splice(u+1,0,f.substr(C+1)),e[u]=e[u].substr(0,e[u].match(/^\s*/)[0].length+C+1),u<=t.line&&t.line++,Action.reindent(e,t);return}if(A!=-1&&f.length>1){A==0?(e.splice(u+1,0,f.substr(1)),e[u]="}",u<=t.line&&t.line++):(e.splice(u+1,0,"}"),u<=t.line&&t.line++,A!=f.length-1&&(e.splice(u+2,0,f.substr(A+1)),u<=t.line&&t.line++),e[u]=e[u].substr(0,e[u].match(/^\s*/)[0].length+A)),Action.reindent(e,t);return}s&&f.indexOf(";")!=f.length-1&&f.slice(-1)!="{"&&f.slice(-1)!="}"&&f.slice(-2)!="||"&&(s=!1,c=e[u].match(/^\s*/)[0].length),A!=-1&&(n=n.substr(2)),s?e[u]=n+e[u].trim():f.slice(-1)=="{"||f.slice(-2)=="||"&&f.slice(-1)=="}"?(s=!0,e[u]=n+e[u].trim()):(e[u]=n+e[u].match(/^\s*/)[0].substr(c)+e[u].trim(),f.indexOf(";")==f.length-1&&(s=!0)),C!=-1&&(n+="  ")}u!=e.length-1?r+=e[u]+`
`:r+=e[u]}Page.codeMirrorOn&&Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:r}}),Action.updateCurrentUmpleTextBeingEdited(r);var N=Page.getRawUmpleCodeCM6().split(`
`)[Page.codeMirrorEditor6.state.doc.lineAt(Page.codeMirrorEditor6.state.selection.main.head).number],p=N.match(/^\s*/)[0].length;if(t.ch>=N.trim().length)Page.codeMirrorEditor6.dispatch({selection:{anchor:t.line,head:N.trim().length+p}});else if(t.ch>=0)Page.codeMirrorEditor6.dispatch({selection:{anchor:t.line,head:t.ch+p}});else{const b=Page.codeMirrorEditor6.state.selection.main.head;Page.codeMirrorEditor6.dispatch({selection:{anchor:b,head:b}})}Page.codeMirrorEditor6.focus()},DiagramEdit=new Object,DiagramEdit.textChangeQueue=[],DiagramEdit.pendingChanges=!1,DiagramEdit.newClass=null,DiagramEdit.newAssociation=null,DiagramEdit.newTransition=null,DiagramEdit.newGeneralization=null,DiagramEdit.updateUmpleText=function(e){DiagramEdit.textChangeQueue.length==0&&!DiagramEdit.pendingChanges?(DiagramEdit.pendingChanges=!0,DiagramEdit.textChangeQueue.push(e),DiagramEdit.doTextUpdate()):DiagramEdit.textChangeQueue.push(e),Action.umpleTypingActivity("diagramEdit")},DiagramEdit.doTextUpdate=function(){update=DiagramEdit.textChangeQueue.shift(),Action.update=update,update.codeChange&&Page.hideGeneratedCode(),Action.ajax(Action.updateUmpleTextCallback,update.actionCode)},DiagramEdit.addClass=function(e){Action.setjustUpdatetoSaveLater(!1),DiagramEdit.removeNewClass();var t=UmpleSystem.createClass(e),n=Json.toString(t);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=addClass&actionCode={0}",n),codeChange:!0})},DiagramEdit.addAssociation=function(e){Action.setjustUpdatetoSaveLater(!1),DiagramEdit.removeNewAssociation();var t=UmpleSystem.createAssociation(e.classOneId,e.classTwoId,e.classOnePosition.add(UmpleSystem.position()),e.classTwoPosition.add(UmpleSystem.position())),n=Json.toString(t);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=addAssociation&actionCode={0}",n),codeChange:!0})},DiagramEdit.addTransition=function(e){Action.setjustUpdatetoSaveLater(!1),DiagramEdit.removeNewTransition();var t=UmpleSystem.createTransition(e.fromStateId,e.toStateId),n=Json.toString(t);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=addTransition&actionCode={0}",n),codeChange:!0})},DiagramEdit.addGeneralization=function(e){Action.setjustUpdatetoSaveLater(!1),DiagramEdit.removeNewGeneralization(),UmpleSystem.createGeneralization(e.childId,e.parentId);var t=Json.toString(e);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=addGeneralization&actionCode={0}",t),codeChange:!0})},DiagramEdit.createAssociationPartOne=function(e){var t=new UmplePosition(e.pageX,e.pageY,0,0),n=UmpleSystem.position(),r=t.x-n.x,o=t.y-n.y;Action.classSelected(e.currentTarget),DiagramEdit.newAssociation=new UmpleAssociation,DiagramEdit.newAssociation.classOneId=e.currentTarget.id,DiagramEdit.newAssociation.classOnePosition=new UmplePosition(r,o,0,0)},DiagramEdit.createAssociationPartTwo=function(e){var t=new UmplePosition(e.pageX,e.pageY,0,0);Action.classSelected(e.currentTarget),DiagramEdit.newAssociation.classOneId<=e.currentTarget.id?(DiagramEdit.newAssociation.classTwoId=e.currentTarget.id,DiagramEdit.newAssociation.classTwoPosition=t.subtract(UmpleSystem.position())):(DiagramEdit.newAssociation.classTwoId=DiagramEdit.newAssociation.classOneId,DiagramEdit.newAssociation.classTwoPosition=DiagramEdit.newAssociation.classOnePosition,DiagramEdit.newAssociation.classOneId=e.currentTarget.id,DiagramEdit.newAssociation.classOnePosition=t.subtract(UmpleSystem.position())),DiagramEdit.addAssociation(DiagramEdit.newAssociation)},DiagramEdit.createTransitionPartOne=function(e){var t=new UmplePosition(e.pageX,e.pageY,0,0),n=UmpleSystem.position(),r=t.x-n.x,o=t.y-n.y;Action.classSelected(e.currentTarget),DiagramEdit.newTransition=new UmpleTransition,DiagramEdit.newTransition.fromStatePosition=e.currentTarget.id,DiagramEdit.newTransition.toStatePosition=new UmplePosition(r,o,0,0),DiagramEdit.newTransition.eventName="event1"},DiagramEdit.createTransitionPartTwo=function(e){var t=new UmplePosition(e.pageX,e.pageY,0,0);Action.classSelected(e.currentTarget),DiagramEdit.newTransition.toStateId=e.currentTarget.id,DiagramEdit.newTransition.toStatePosition=t.subtract(UmpleSystem.position()),DiagramEdit.addTransition(DiagramEdit.newTransition)},DiagramEdit.createGeneralizationPartOne=function(e){var t=UmpleSystem.find(e.currentTarget.id);if(t.extendsClass!=null)return!1;Action.classSelected(e.currentTarget),DiagramEdit.newGeneralization=new UmpleGeneralization,DiagramEdit.newGeneralization.childId=e.currentTarget.id,umpleSystem=UmpleSystem.position(),childPositionX=Dom.x(e)-umpleSystem.x,childPositionY=Dom.y(e)-umpleSystem.y,DiagramEdit.newGeneralization.childPosition=new UmplePosition(childPositionX,childPositionY,0,0)},DiagramEdit.createGeneralizationPartTwo=function(e){Action.classSelected(e.currentTarget),DiagramEdit.newGeneralization.parentId=e.currentTarget.id,DiagramEdit.newGeneralization.parentPosition=new UmplePosition(Dom.x(e),Dom.y(e),0,0),DiagramEdit.addGeneralization(DiagramEdit.newGeneralization)},DiagramEdit.classMoved=function(e){Action.setjustUpdatetoSaveLater(!1);var t=UmpleSystem.find(e.id),n=jQuery("#"+t.id);newPositionX=Math.floor(n.offset().left),newPositionY=Math.floor(n.offset().top),UmpleSystem.updatePosition(t,newPositionX,newPositionY);var r=Json.toString(t),o=Page.getUmpleCode();Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",r),codeChange:!1}),Action.classSelected(e),UmpleSystem.trimOverlappingAssociations(t)},DiagramEdit.classResized=function(e,t){Action.setjustUpdatetoSaveLater(!1);var n=e.target,r=n.id,o=UmpleSystem.find(r);UmpleSystem.updateClass(o),UmpleSystem.redrawGeneralizationsTo(o,v);for(var a=0;a<UmpleSystem.umpleAssociations.length;a++){var s=UmpleSystem.umpleAssociations[a];if(s.contains(o)){var c=s.classOneId==o.id,d=c?s.offsetOnePosition:s.offsetTwoPosition,u=c?"_anchor0":"_anchor1",f="#"+s.id+u,v=!0;DiagramEdit.associationMoved(f,v)}}var h=Json.toString(o),C=Page.getUmpleCode();Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",h),codeChange:!1}),Action.classSelected(n)},DiagramEdit.associationMoved=function(e,t){Action.setjustUpdatetoSaveLater(!1),DiagramEdit.newAssociation!=null&&DiagramEdit.removeNewAssociation(),t==null&&(t=!1);var n=jQuery(e).attr("id"),r=n.substr(0,n.length-8),o=UmpleSystem.findAssociation(r);Action.updateMovedAssociation(e,o);var a=Json.toString(o);Page.showLayoutLoading(),DiagramEdit.updateUmpleText({codeChange:!1,actionCode:format("action=editAssociation&actionCode={0}",a)})},DiagramEdit.regularAssociationMoving=function(e){if(DiagramEdit.newAssociation==null){var t=jQuery(e).attr("id"),n=t.substr(0,t.length-8),r=UmpleSystem.findAssociation(n),o=new UmpleAssociation;t.endsWith("_anchor0")?(o.classOneId=r.classTwoId,o.classOnePosition=r.classTwoPosition,o.offsetOnePosition=r.offsetTwoPosition):(o.classOneId=r.classOneId,o.classOnePosition=r.classOnePosition,o.offsetOnePosition=r.offsetOnePosition),DiagramEdit.newAssociation=o}var a=jQuery(e).offset(),s=Action.associationSnap(Math.round(a.left),Math.round(a.top),e),c=new UmplePosition(s[0],s[1]);DiagramEdit.newAssociation.classTwoPosition=c.subtract(UmpleSystem.position()),DiagramEdit.newAssociation.offsetTwoPosition=new UmplePosition(0,0,0,0);var d="#"+Page.umpleCanvasId();jQuery(d).append(DiagramEdit.newAssociation.drawable())},DiagramEdit.reflexiveAssociationMoving=function(e){var t=jQuery(e).attr("id"),n=t.substr(0,t.length-8),r=UmpleSystem.findAssociation(n);DiagramEdit.newAssociation==null&&(DiagramEdit.newAssociation=new UmpleAssociation,DiagramEdit.newAssociation.classOneId=r.classOneId,DiagramEdit.newAssociation.classTwoId=r.classTwoId,DiagramEdit.newAssociation.classOnePosition=r.classOnePosition,DiagramEdit.newAssociation.classTwoPosition=r.classTwoPosition,DiagramEdit.newAssociation.offsetOnePosition=r.offsetOnePosition,DiagramEdit.newAssociation.offsetTwoPosition=r.offsetTwoPosition,DiagramEdit.newAssociation.id=DiagramEdit.newAssociation.getElementId());var o=jQuery(e).offset(),a=Action.associationSnap(Math.round(o.left),Math.round(o.top),e),s=new UmplePosition(a[0],a[1],0,0),c=s.subtract(UmpleSystem.position());c.x=c.x-DiagramEdit.newAssociation.classOnePosition.x,c.y=c.y-DiagramEdit.newAssociation.classOnePosition.y,t.endsWith("_anchor0")?DiagramEdit.newAssociation.offsetOnePosition=c:DiagramEdit.newAssociation.offsetTwoPosition=c;var d="#"+Page.umpleCanvasId();jQuery(d).append(DiagramEdit.newAssociation.drawableReflexive())},DiagramEdit.classNameChanged=function(e,t,n){if(Action.setjustUpdatetoSaveLater(!1),n.length=!n.match(/^[_a-zA-Z0-9]+$/)){Action.updateUmpleDiagram();var r="Class names must be alphanumeric. &lt;"+n.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")+"&gt is not valid.";setTimeout(function(){Page.setFeedbackMessage(r)},2e3),setTimeout(function(){Page.setFeedbackMessage("")},1e4)}else{var o=UmpleSystem.renameClass(e,t,n);o.position.width=UmpleClassFactory.defaultSize.width;var a=Json.toString(o);delete o.oldname,Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",a),codeChange:!0})}},DiagramEdit.attributeNameChanged=function(e,t,n,r){if(Action.setjustUpdatetoSaveLater(!1),!Action.validateAttributeName(r))Action.updateUmpleDiagram(),setTimeout(function(){Page.setFeedbackMessage("UML Attributes must be alphanumeric with an optional type after a colon. &lt;"+r.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")+"&gt is not valid.")},2e3),setTimeout(function(){Page.setFeedbackMessage("")},1e4);else{var o=UmpleSystem.find(e);o.attributes[t].set(r),UmpleSystem.redraw(o);var a=Json.toString(o);Page.showModelLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",a),codeChange:!0}),o.resetAttribute(t)}},DiagramEdit.attributeNew=function(e,t){if(Action.setjustUpdatetoSaveLater(!1),!Action.validateAttributeName(t))Action.updateUmpleDiagram(),setTimeout(function(){Page.setFeedbackMessage("UML Attributes must be alphanumeric with an optional type after a colon. &lt;"+t.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")+"&gt is not valid.")},2e3),setTimeout(function(){Page.setFeedbackMessage("")},1e4);else{var n=UmpleSystem.find(e),r=n.addAttribute(t),o=Json.toString(n);Page.showModelLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",o),codeChange:!0}),n.resetAttribute(r),UmpleSystem.updateClass(n),UmpleSystem.redrawGeneralizationsTo(n),UmpleSystem.trimOverlappingAssociations(n),UmpleSystem.update()}},DiagramEdit.classDeleted=function(e){Action.setjustUpdatetoSaveLater(!1);for(var t=!0,n=UmpleSystem.find(e),r=[],o=[],a=0;a<UmpleSystem.umpleAssociations.length;a++){var s=UmpleSystem.umpleAssociations[a];s.contains(n)&&r.push(s.id)}for(var a=0;a<UmpleSystem.umpleClasses.length;a++){var c=UmpleSystem.umpleClasses[a];c.extendsClass==n.id&&o.push(c.id+"_generalization")}for(var a=0;a<r.length;a++)DiagramEdit.associationDeleted(r[a],t);for(var a=0;a<o.length;a++)DiagramEdit.generalizationDeleted(o[a],t);var d=UmpleSystem.removeClass(e),u=Json.toString(d);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=removeClass&actionCode={0}",u),codeChange:!0})},DiagramEdit.methodNew=function(e,t){if(Action.setjustUpdatetoSaveLater(!1),!Action.validateMethodName(t))Action.updateUmpleDiagram(),setTimeout(function(){Page.setFeedbackMessage("Invalid UML Method. &lt;"+t.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")+"&gt is not valid.")},2e3),setTimeout(function(){Page.setFeedbackMessage("")},1e4);else{var n=UmpleSystem.find(e),r=n.addMethod(t),o=Json.toString(n);Page.showModelLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",o),codeChange:!0}),n.resetMethod(r),UmpleSystem.updateClass(n),UmpleSystem.redrawGeneralizationsTo(n),UmpleSystem.trimOverlappingAssociations(n),UmpleSystem.update()}},DiagramEdit.methodChanged=function(e,t,n,r){if(Action.setjustUpdatetoSaveLater(!1),!Action.validateMethodName(r))Action.updateUmpleDiagram(),setTimeout(function(){Page.setFeedbackMessage("Invalid UML Method. &lt;"+r.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")+"&gt is not valid.")},2e3),setTimeout(function(){Page.setFeedbackMessage("")},1e4);else{var o=UmpleSystem.find(e);o.methods[t].set(r),UmpleSystem.redraw(o);var a=Json.toString(o);Page.showModelLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",a),codeChange:!0}),o.resetMethod(t)}},DiagramEdit.methodDelete=function(e,t){Action.setjustUpdatetoSaveLater(!1);var n=UmpleSystem.find(e);n.removeMethod(t);var r=jQuery("#"+n.id);n.position.width=UmpleClassFactory.defaultSize.width;var o=Json.toString(n);Page.showModelLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",o),codeChange:!0}),n.resetMethod(t),UmpleSystem.updateClass(n),UmpleSystem.redrawGeneralizationsTo(n),UmpleSystem.trimOverlappingAssociations(n),UmpleSystem.update()},DiagramEdit.attributeDelete=function(e,t){Action.setjustUpdatetoSaveLater(!1);var n=UmpleSystem.find(e);n.removeAttribute(t);var r=jQuery("#"+n.id);n.position.width=UmpleClassFactory.defaultSize.width;var o=Json.toString(n);Page.showModelLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",o),codeChange:!0}),n.resetAttribute(t),UmpleSystem.updateClass(n),UmpleSystem.redrawGeneralizationsTo(n),UmpleSystem.trimOverlappingAssociations(n),UmpleSystem.update()},DiagramEdit.associationDeleted=function(e,t){Action.setjustUpdatetoSaveLater(!1),t==null&&(t=!1);var n=UmpleSystem.removeAssociation(e),r=Json.toString(n);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=removeAssociation&actionCode={0}",r),codeChange:!0})},DiagramEdit.transitionDeleted=function(e,t){Action.setjustUpdatetoSaveLater(!1),t==null&&(t=!1);var n=UmpleSystem.removeTransition(e),r=Json.toString(n);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=removeTransition&actionCode={0}",r),codeChange:!0})},DiagramEdit.generalizationDeleted=function(e,t){Action.setjustUpdatetoSaveLater(!1),t==null&&(t=!1);var n=UmpleSystem.removeGeneralization(e),r=Json.toString(n);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=removeGeneralization&actionCode={0}",r),codeChange:!0})},DiagramEdit.removeNewClass=function(){if(DiagramEdit.newClass!=null){var e="#"+DiagramEdit.newClass.id;return DiagramEdit.newClass=null,jQuery(e).remove(),!0}return!1},DiagramEdit.removeNewAssociation=function(){if(DiagramEdit.newAssociation!=null){var e="#"+DiagramEdit.newAssociation.getElementId();return jQuery(e).remove(),DiagramEdit.newAssociation=null,!0}return!1},DiagramEdit.removeNewTransition=function(){if(DiagramEdit.newTransition!=null){var e="#"+DiagramEdit.newTransition.getElementId();return jQuery(e).remove(),DiagramEdit.newTransition=null,!0}return!1},DiagramEdit.removeNewGeneralization=function(){if(DiagramEdit.newGeneralization!=null){var e="#"+DiagramEdit.newGeneralization.getElementId();return jQuery(e).remove(),DiagramEdit.newGeneralization=null,!0}return!1},UmpleAssociationFactory=new Object,UmpleAssociationFactory.create=function(e){var t=new UmpleAssociation;return t.id=e.id,t.classOneId=e.classOneId,t.classTwoId=e.classTwoId,t.offsetOnePosition=UmplePositionFactory.copy(e.offsetOnePosition),t.offsetTwoPosition=UmplePositionFactory.copy(e.offsetTwoPosition),t.multiplicityOne=e.multiplicityOne,t.multiplicityTwo=e.multiplicityTwo,t.name=e.name,t.roleOne=e.roleOne,t.roleTwo=e.roleTwo,t.isSymmetricReflexive=e.isSymmetricReflexive=="true"||e.isSymmetricReflexive==!0,t.isLeftNavigable=e.isLeftNavigable=="true"||e.isLeftNavigable==!0,t.isRightNavigable=e.isRightNavigable=="true"||e.isRightNavigable==!0,t.isLeftComposition=e.isLeftComposition=="true"||e.isLeftComposition==!0,t.isRightComposition=e.isRightComposition=="true"||e.isRightComposition==!0,t.color=e.isTraced,t};function UmpleAssociation(){this.id,this.classOneId,this.classTwoId,this.classOnePosition=null,this.classTwoPosition=null,this.offsetOnePosition=null,this.offsetTwoPosition=null,this.multiplicityOne="",this.multiplicityTwo="",this.name="",this.roleOne="",this.roleTwo="",this.isSymmetricReflexive=!1,this.isLeftNavigable=!0,this.isRightNavigable=!0,this.isLeftComposition=!1,this.isRightComposition=!1,this.color="black",this.setClasses=function(e,t){this.classOneId=e,this.classTwoId=t},this.setDefaultMultiplicities=function(){this.multiplicityOne="*",this.multiplicityTwo="*"},this.setDefaultRoles=function(){this.classOneId==this.classTwoId&&(this.roleTwo="roleName")},this.setRoles=function(e,t){this.roleOne=e,this.roleTwo=t},this.setName=function(e){this.name=e},this.getName=function(){return this.name==null||this.name==""?this.deriveName():this.name},this.deriveName=function(){var e="",t=this.classOneId,n=this.classTwoId;return this.roleOne==null||this.roleOne===""||(t=this.classOneId+":"+this.roleOne),this.roleTwo==null||this.roleTwo===""||(n=this.classTwoId+":"+this.roleTwo),this.classOneId<=this.classTwoId?e=t+"__"+n:e=n+"__"+t,e},this.getElementId=function(){return this.id==null?"newassociation":this.id},this.getClass=function(e){return e==0?UmpleSystem.find(this.classOneId):UmpleSystem.find(this.classTwoId)},this.setOffsetOnePosition=function(e){var t=UmpleSystem.find(this.classOneId);this.classOnePosition=t.position,this.offsetOnePosition=e.subtract(t.position).subtract(UmpleSystem.position()),this.offsetOnePosition.width=0,this.offsetOnePosition.height=0},this.setOffsetTwoPosition=function(e){var t=UmpleSystem.find(this.classTwoId);this.classTwoPosition=t.position,this.offsetTwoPosition=e.subtract(t.position).subtract(UmpleSystem.position()),this.offsetTwoPosition.width=0,this.offsetTwoPosition.height=0},this.trimOverlap=function(){for(var e=new UmpleLine(this.offsetOnePosition.add(this.classOnePosition),this.offsetTwoPosition.add(this.classTwoPosition)),t=UmpleSystem.find(this.classOneId).borderLines(),n=UmpleSystem.find(this.classTwoId).borderLines(),r=this.offsetOnePosition.add(this.classOnePosition),o=this.offsetTwoPosition.add(this.classTwoPosition),a=[],s=[],c=0;c<t.length;c++)intersection=e.intersection(t[c]),intersection!=null&&a.push(intersection);for(var c=0;c<n.length;c++)intersection=e.intersection(n[c]),intersection!=null&&s.push(intersection);for(var d=new UmpleLine(r,o),u=new UmpleLine(d.pointOne,d.pointTwo),c=0;c<a.length;c++)u.pointOne=a[c],u.length()<d.length()&&(d=new UmpleLine(u.pointOne,u.pointTwo));for(var u=new UmpleLine(d.pointOne,d.pointTwo),c=0;c<s.length;c++)u.pointTwo=s[c],u.length()<d.length()&&(d=new UmpleLine(u.pointOne,u.pointTwo));this.setOffsetOnePosition(d.pointOne.add(UmpleSystem.position())),this.setOffsetTwoPosition(d.pointTwo.add(UmpleSystem.position()))},this.adjustReflexiveEndpoints=function(){var e=this.offsetOnePosition,t=this.offsetTwoPosition,n=UmpleSystem.find(this.classOneId).borderLines();this.snapToClosestEdge(e,n),this.snapToClosestEdge(t,n)},this.snapToClosestEdge=function(e,t){var n=!0,r=!0,o=e.x+this.classOnePosition.x,a=e.y+this.classOnePosition.y,s=a-t[0].pointOne.y,c=o-t[1].pointOne.x;s>t[2].pointOne.y-a&&(n=!1,s=t[2].pointOne.y-a),c>t[3].pointOne.x-o&&(r=!1,c=t[3].pointOne.x-o),s<=c?n?e.y=0:e.y=this.classOnePosition.height:r?e.x=0:e.x=this.classOnePosition.width},this.drawable=function(){return this.id==null?associationDiv=this.drawableTemp():this.isReflexive()?associationDiv=this.drawableReflexive():this.isComposition()?associationDiv=this.drawableComposition():this.isBidirectional()?associationDiv=this.drawableBidirectional():associationDiv=this.drawableUnidirectional(),associationDiv},this.drawableTemp=function(){var e="#"+this.getElementId();jQuery(e).remove();var t=this.createBaseJQueryObject();t.addClass("umpleAssociationTemp"),t.attr("id","newassociation");var n=new UmpleLine(this.classOnePosition.add(this.offsetOnePosition),this.classTwoPosition.add(this.offsetTwoPosition));return t.append(n.drawable()),t},this.drawableBidirectional=function(){var e="#"+this.id;jQuery(e).remove();var t=this.createBaseJQueryObject();this.color=="red"?t.addClass("redTracedAssociation"):t.addClass("untracedAssociation"),t.attr("id",this.id),t.attr("tabindex",2);var n=UmpleSystem.find(this.classOneId),r=UmpleSystem.find(this.classTwoId);if(n==null||n==null||r==null||r==null)return t;this.classOnePosition=n.position,this.classTwoPosition=r.position;var o=this.classOnePosition.add(this.offsetOnePosition),a=this.classTwoPosition.add(this.offsetTwoPosition),s=new UmpleLine(o.add(UmpleClassFactory.offsetError),a.add(UmpleClassFactory.offsetError));this.isComposition()||t.append(s.drawable());var c="",d=-3;c+=this.anchorDivHtml("hover",0,o.x+d,o.y+d),c+=this.anchorDivHtml("anchor",0,o.x+d,o.y+d),c+=this.anchorDivHtml("hover",1,a.x+d,a.y+d),c+=this.anchorDivHtml("anchor",1,a.x+d,a.y+d);var u=o.slopeAngle(a),f=this.multiplicityPosition(!0),v=this.multiplicityPosition(!1),h=this.multiplicityDivHtml("one",this.multiplicityOne,f.x,f.y),C=this.multiplicityDivHtml("two",this.multiplicityTwo,v.x,v.y);if(this.roleOne!=""){roleOnePosition=this.rolePosition(!0);var A=this.roleDivHtml("one",this.roleOne,roleOnePosition.x,roleOnePosition.y)}else A="";if(this.roleTwo!=""){roleTwoPosition=this.rolePosition(!1);var T=this.roleDivHtml("two",this.roleTwo,roleTwoPosition.x,roleTwoPosition.y)}else T="";return currentHtml=t.html(),t.html(h+C+A+T+c+currentHtml),t},this.drawableUnidirectional=function(){var e=this.drawableBidirectional(),t=null;this.isLeftNavigable?(t=this.classOnePosition.add(this.offsetOnePosition),otherEnd=this.classTwoPosition.add(this.offsetTwoPosition)):(t=this.classTwoPosition.add(this.offsetTwoPosition),otherEnd=this.classOnePosition.add(this.offsetOnePosition));var n=t.slopeAngle360(otherEnd),r=n+30,o=n-30,a=10,s=t.travelForward(a,r),c=t.travelForward(a,o),d=new UmpleLine(t.add(UmpleClassFactory.offsetError),s.add(UmpleClassFactory.offsetError)),u=new UmpleLine(t.add(UmpleClassFactory.offsetError),c.add(UmpleClassFactory.offsetError));return e.append(d.drawable()),e.append(u.drawable()),e},this.drawableComposition=function(){var e=this.drawableBidirectional(),t=null;this.isLeftComposition?(t=this.classOnePosition.add(this.offsetOnePosition),otherEnd=this.classTwoPosition.add(this.offsetTwoPosition)):(t=this.classTwoPosition.add(this.offsetTwoPosition),otherEnd=this.classOnePosition.add(this.offsetOnePosition));var n=t.slopeAngle360(otherEnd),r=n+30,o=n-30,a=8,s=t.travelForward(a,r),c=t.travelForward(a,o),d=s.travelForward(a,o),u=new UmpleLine(t.add(UmpleClassFactory.offsetError),s.add(UmpleClassFactory.offsetError)),f=new UmpleLine(t.add(UmpleClassFactory.offsetError),c.add(UmpleClassFactory.offsetError)),v=new UmpleLine(s.add(UmpleClassFactory.offsetError),d.add(UmpleClassFactory.offsetError)),h=new UmpleLine(c.add(UmpleClassFactory.offsetError),d.add(UmpleClassFactory.offsetError));e.append(u.drawable()),e.append(f.drawable()),e.append(v.drawable()),e.append(h.drawable());var C=new UmpleLine(d.add(UmpleClassFactory.offsetError),otherEnd.add(UmpleClassFactory.offsetError));e.append(C.drawable());var A=4,T=t.travelForward(A,r),j=t.travelForward(A,o),N=s.travelForward(A,o),p=c.travelForward(A,r),b=new UmpleLine(t.add(UmpleClassFactory.offsetError),N.add(UmpleClassFactory.offsetError)),_=new UmpleLine(t.add(UmpleClassFactory.offsetError),p.add(UmpleClassFactory.offsetError)),L=new UmpleLine(t.add(UmpleClassFactory.offsetError),d.add(UmpleClassFactory.offsetError)),P=new UmpleLine(s.add(UmpleClassFactory.offsetError),p.add(UmpleClassFactory.offsetError)),S=new UmpleLine(s.add(UmpleClassFactory.offsetError),j.add(UmpleClassFactory.offsetError)),k=new UmpleLine(s.add(UmpleClassFactory.offsetError),c.add(UmpleClassFactory.offsetError)),O=new UmpleLine(c.add(UmpleClassFactory.offsetError),T.add(UmpleClassFactory.offsetError)),R=new UmpleLine(c.add(UmpleClassFactory.offsetError),N.add(UmpleClassFactory.offsetError)),I=new UmpleLine(d.add(UmpleClassFactory.offsetError),T.add(UmpleClassFactory.offsetError)),F=new UmpleLine(d.add(UmpleClassFactory.offsetError),j.add(UmpleClassFactory.offsetError)),V=new UmpleLine(T.add(UmpleClassFactory.offsetError),j.add(UmpleClassFactory.offsetError)),D=new UmpleLine(T.add(UmpleClassFactory.offsetError),N.add(UmpleClassFactory.offsetError)),m=new UmpleLine(T.add(UmpleClassFactory.offsetError),p.add(UmpleClassFactory.offsetError)),M=new UmpleLine(j.add(UmpleClassFactory.offsetError),N.add(UmpleClassFactory.offsetError)),U=new UmpleLine(j.add(UmpleClassFactory.offsetError),p.add(UmpleClassFactory.offsetError)),z=new UmpleLine(N.add(UmpleClassFactory.offsetError),p.add(UmpleClassFactory.offsetError));return e.append(b.drawable()),e.append(_.drawable()),e.append(L.drawable()),e.append(P.drawable()),e.append(S.drawable()),e.append(k.drawable()),e.append(O.drawable()),e.append(R.drawable()),e.append(I.drawable()),e.append(F.drawable()),e.append(V.drawable()),e.append(D.drawable()),e.append(m.drawable()),e.append(M.drawable()),e.append(U.drawable()),e.append(z.drawable()),e},this.drawableReflexive=function(){var e="#"+this.id;jQuery(e).remove();var t=this.createBaseJQueryObject();this.color=="red"?t.addClass("redTracedAssociation"):t.addClass("untracedAssociation"),t.attr("id",this.id),t.attr("tabindex",2);var n=UmpleSystem.find(this.classOneId);this.classOnePosition=n.position,this.classTwoPosition=n.position;var r=n.position.height,o=n.position.width,a=15,s=this.whichWall(!0);factorX=s=="West"?-1:s=="South"?0:s=="East"?1:0,factorY=s=="West"?0:s=="South"?1:s=="East"?0:-1;var c=this.offsetOnePosition.add(this.classOnePosition),d=this.offsetOnePosition.add(this.classOnePosition).add(new UmplePosition(a*factorX,a*factorY,0,0));s=="South"&&(c.y=c.y-1);var u=new UmpleLine(c,d),f=this.whichWall(!1);factorX=f=="West"?-1:f=="South"?0:f=="East"?1:0,factorY=f=="West"?0:f=="South"?1:f=="East"?0:-1;var v=this.offsetTwoPosition.add(this.classTwoPosition),h=this.offsetTwoPosition.add(this.classTwoPosition).add(new UmplePosition(a*factorX,a*factorY,0,0)),C=new UmpleLine(v,h);t.append(u.drawable()),t.append(C.drawable());var A=new UmplePosition(0,0,0,0);if(s==f){var T=new UmpleLine(d,h);s=="North"||s=="South"?this.isSymmetricReflexive&&(A.x=(d.x+h.x)/2,A.y=d.y):this.isSymmetricReflexive&&(A.x=d.x,A.y=(d.y+h.y)/2),t.append(T.drawable())}else if(this.offsetOnePosition.wallsAreAdjacent(s,f)){var j=new UmplePosition(0,0,0,0),N=s=="West"||f=="West",p=s=="North"||f=="North";N?j.x=this.classOnePosition.x-a:j.x=this.classOnePosition.x+o+a,p?j.y=this.classOnePosition.y-a:j.y=this.classOnePosition.y+r+a;var b=new UmpleLine(d,j),_=new UmpleLine(h,j);t.append(b.drawable()),t.append(_.drawable()),this.isSymmetricReflexive&&A.set(j.x,j.y)}else{var L=new UmplePosition(0,0,0,0),P=new UmplePosition(0,0,0,0),S,k,O,R,I;s=="South"||f=="South"?(L.x=this.classOnePosition.x-a,L.y=this.classOnePosition.y-a,P.x=L.x,P.y=this.classOnePosition.y+r+a,f=="South"?(R=d,I=h):(R=h,I=d),this.isSymmetricReflexive&&(A.x=L.x,A.y=(L.y+P.y)/2)):(L.x=this.classOnePosition.x-a,L.y=this.classOnePosition.y+r+a,P.x=this.classOnePosition.x+o+a,P.y=L.y,f=="East"?(R=d,I=h):(R=h,I=d),this.isSymmetricReflexive&&(A.x=(L.x+P.x)/2,A.y=L.y)),S=new UmpleLine(R,L),k=new UmpleLine(L,P),O=new UmpleLine(P,I),t.append(S.drawable()),t.append(k.drawable()),t.append(O.drawable())}if(!this.isSymmetricReflexive){var F=new UmplePosition(0,0,0,0);s=="North"||s=="South"?(A.x=d.x,A.y=(c.y+d.y)/2):(A.x=(c.x+d.x)/2,A.y=d.y),f=="North"||f=="South"?(F.x=h.x,F.y=(v.y+h.y)/2):(F.x=(v.x+h.x)/2,F.y=h.y)}var V="",D=c,m=v,M=3;if(V+=this.anchorDivHtml("hover",0,D.x-M,D.y-M),V+=this.anchorDivHtml("anchor",0,D.x-M,D.y-M),V+=this.anchorDivHtml("hover",1,m.x-M,m.y-M),V+=this.anchorDivHtml("anchor",1,m.x-M,m.y-M),this.isSymmetricReflexive)var U=UmplePositionFactory.copy(this.centerMultiplicityPosition(A)),z=this.adjustRolePosition(A,!0),q=this.roleDivHtml("center",this.roleOne,z.x,z.y),ee=this.multiplicityDivHtml("center",this.multiplicityOne,U.x,U.y);else var W=UmplePositionFactory.copy(this.reflexiveMultiplicityPosition(A,F,!0)),Y=UmplePositionFactory.copy(this.reflexiveMultiplicityPosition(F,A,!1)),ne=this.adjustRolePosition(A,!0),X=this.adjustRolePosition(F,!1),q=this.roleDivHtml("one",this.roleOne,ne.x,ne.y)+this.roleDivHtml("two",this.roleTwo,X.x,X.y),ee=this.multiplicityDivHtml("one",this.multiplicityOne,W.x,W.y)+this.multiplicityDivHtml("two",this.multiplicityTwo,Y.x,Y.y);if(this.id==null)return t.attr("id","newassociation"),t;var se=t.html();return t.html(ee+q+V+se),t},this.isReflexive=function(){return this.classOneId==this.classTwoId||this.isSymmetricReflexive},this.isBidirectional=function(){return this.isRightNavigable==null||this.isLeftNavigable==null?!0:this.isRightNavigable&&this.isLeftNavigable},this.isComposition=function(){return this.isRightComposition||this.isLeftComposition},this.endHasArrow=function(e){return e?this.isLeftNavigable:this.isRightNavigable},this.contains=function(e){return e.id==this.classOneId||e.id==this.classTwoId},this.anchorDivHtml=function(e,t,n,r){return format('<div id="{0}_{1}{2}" class="{1}" name="{1}" style="left: {3}px; top: {4}px; cursor: pointer; display: none;"><img name="image" src="./scripts/_.gif"/></div>',this.id,e,t,n,r)},this.multiplicityDivHtml=function(e,t,n,r,o){return(o==null||o=="undefined")&&(o=""),format('<div id="{0}_{1}" class="multiplicity" name="{1}" style="left: {2}px; top: {3}px; cursor: pointer;">{4}&nbsp;&nbsp;{5}</div>',this.id,e,n,r,t,o)},this.roleDivHtml=function(e,t,n,r){return e=="one"?idExtension="roleOne":e=="two"?idExtension="roleTwo":e=="center"?idExtension="role":idExtension="",format('<div id="{0}_{1}" class="role" name="{1}" style="left: {2}px; top: {3}px; cursor: pointer;">{4}</div>',this.id,idExtension,n,r,t)},this.whichWall=function(e){if(e)var t=this.classOnePosition,n=this.offsetOnePosition;else var t=this.classTwoPosition,n=this.offsetTwoPosition;var r=1;return n.x==0?"West":n.y==0?"North":Math.abs(n.x-t.width)<=r?"East":"South"},this.multiplicityPosition=function(e){if(e)var t=this.classOnePosition.add(this.offsetOnePosition),n=this.classTwoPosition.add(this.offsetTwoPosition),r=this.multiplicityOne;else var t=this.classTwoPosition.add(this.offsetTwoPosition),n=this.classOnePosition.add(this.offsetOnePosition),r=this.multiplicityTwo;var o=this.whichWall(e),a=r=="*"?new UmplePosition(0,10,0,0):new UmplePosition(0,16,0,0),s=new UmplePosition(5*r.length+1,0,0,0),c=3;(!this.isBidirectional()&&this.endHasArrow(e)||this.isComposition())&&(c+=5);var d=t.slopeAngle360(n);if(o=="North")if(d<90){var u=(180-d)/2+d,f=t.travelForward(c,u);f=f.subtract(s),f=f.subtract(a)}else{var u=d/2,f=t.travelForward(c,u);f=f.subtract(a)}else if(o=="East")if(d>=0&&d<=90)var u=(d+90)/2+270,f=t.travelForward(c,u);else{var u=((360-d+90)/2+d)%360,f=t.travelForward(c,u);f=f.subtract(a)}else if(o=="South")if(d<=270)var u=(360-d)/2+d,f=t.travelForward(c,u),v=f;else{var u=(d-180)/2+180,f=t.travelForward(c,u),v=f;f=f.subtract(s)}else if(d<=180){var u=(270-d)/2+d,f=t.travelForward(c,u);f=f.subtract(s)}else{var u=(d-90)/2+90,f=t.travelForward(c,u);f=f.subtract(a),f=f.subtract(s)}return f},this.centerMultiplicityPosition=function(e){var t=this.whichWall(!0),n=this.whichWall(!1),r=1,o=5;return e.width=5*this.multiplicityOne.length+o+6*this.roleOne.length,e.height=16,t=="West"&&n=="West"||t=="North"&&n=="South"||t=="South"&&n=="North"?(e.x-=e.width+r,e.y-=e.height/2):t=="East"&&n=="East"?(e.x+=r,e.y-=e.height/2):t=="North"||n=="North"?(e.y-=r+e.height,e.x-=e.width/2):(e.y+=r,e.x-=e.width/2),e},this.reflexiveMultiplicityPosition=function(e,t,n){var r=5,o=1;if(n)var a=this.whichWall(!0),s=this.whichWall(!1),c=this.multiplicityOne.length,d=this.roleOne.length;else var a=this.whichWall(!1),s=this.whichWall(!0),c=this.multiplicityTwo.length,d=this.roleTwo.length;return e.width=5*c+r+6*d,e.height=16,a=="North"?(e.y-=e.height/2,s=="North"&&e.x<t.x||s=="East"?e.x-=e.width+o:e.x+=o):a=="East"?s=="East"&&e.y<t.y||s=="South"||s=="West"?e.y-=e.height:e.y+=o:a=="South"?(e.y-=e.height/2,s=="South"&&e.x<t.x||s=="East"?e.x-=e.width+o:e.x+=o):a=="West"&&(e.x-=e.width,s=="West"&&e.y<t.y||s=="East"||s=="South"?e.y-=e.height:e.y+=o),e},this.rolePosition=function(e){var t=e?this.multiplicityOne:this.multiplicityTwo,n=e?this.roleOne:this.roleTwo,r=e?this.classOnePosition.add(this.offsetOnePosition):this.classTwoPosition.add(this.offsetTwoPosition),o=e?this.classTwoPosition.add(this.offsetTwoPosition):this.classOnePosition.add(this.offsetOnePosition),a=new UmplePosition(5*t.length,0,0,0),s=new UmplePosition(6*n.length,0,0,0,0),c=new UmplePosition(0,16,0,0),d=c,u=new UmplePosition(5,0,0,0),f=this.multiplicityPosition(e),v=this.whichWall(e),h=r.slopeAngle360(o);return v=="North"?(h<90?rolePosition=f.subtract(s).subtract(a):rolePosition=f.add(a).add(u),t=="*"&&(rolePosition=rolePosition.subtract(new UmplePosition(0,6,0,0)))):v=="East"||v=="South"&&h<=270?rolePosition=f.add(a).add(u):rolePosition=f.subtract(s).subtract(a),rolePosition},this.adjustRolePosition=function(e,t){var n=t?this.multiplicityOne.length:this.multiplicityTwo.length;return e.x+=5*n+6,e},this.createBaseJQueryObject=function(){return jQuery(format("<div class='{0}'></div>",this.getName()))}}UmpleAttributeFactory=new Object,UmpleAttributeFactory.create=function(e){var t=e.type,n=e.name,r=e.traceColor;r==""&&(r="black");var o=new UmpleAttribute(t,n,r);return o};function UmpleAttribute(e,t,n){this.type=e,this.name=t,this.textColor=n,(this.aColor===""||this.aColor===void 0)&&(this.aColor="black"),this.set=function(r){this.textColor="black";var o=this.type!=""&&this.name!="";o&&(this.oldType=this.type,this.oldName=this.name);var a=r.split(":");a.length<2?(this.type="String",this.name=r):(this.name=a[0].trim(),this.type=a[1].trim()),o||(this.newType=this.type,this.newName=this.name)},this.copy=function(){return new UmpleAttribute(this.type,this.name,this.textColor)}}UmpleClassFactory=new Object,UmpleClassFactory.defaultSize=new UmplePosition(0,0,109,41),UmpleClassFactory.offsetError=new UmplePosition(0,0,0,0),UmpleClassFactory.create=function(e){var t=new UmpleClass;t.id=e.id,t.name=e.name,t.isInterface=e.isInterface,t.isAbstract=e.isAbstract,t.displayColor=e.displayColor,t.displayColor==""&&(t.displayColor="transparent"),t.position.x=e.position.x,t.position.y=e.position.y,t.position.width=e.position.width,t.position.height=e.position.height,t.extendsClass=e.extendsClass;for(var n=0;n<e.attributes.length;n++)e.attributes[n].modifier!="const"&&t.attributes.push(UmpleAttributeFactory.create(e.attributes[n]));for(var n=0;n<e.methods.length;n++)t.methods.push(UmpleMethodFactory.create(e.methods[n]));if(e.implementedInterfaces!=null)for(var n=0;n<e.implementedInterfaces.length;n++)t.interfaces[n]=e.implementedInterfaces[n].interfacesName+"";return t},UmpleClassFactory.perimeterPosition=function(e,t,n){typeof n>"u"&&(n=new UmplePosition(0,0,0,0));var r=t.x,o=t.y,a=0,s=n.x+e.position.x+a,c=s+e.position.width,d=n.y+e.position.y+a,u=d+e.position.height,f=r<s?s:r>c?c:r,v=o<d?d:o>u?u:o,h=r-s,C=c-r,A=o-d,T=u-o,j=Math.min(h,C),N=Math.min(A,T);return j<N?f=h<C?s:c:N<j&&(v=A<T?d:u),new UmplePosition(Math.round(f),Math.round(v),0,0)};function UmpleClass(){this.id,this.name,this.isInterface,this.isAbstract,this.displayColor="transparent",this.position=new UmplePosition(0,0,109,41),this.attributes=[],this.methods=[],this.interfaces=[],this.extendsClass,this.addAttribute=function(e){var t=new UmpleAttribute("","","");return t.set(e),this.attributes.push(t),this.attributes.length-1},this.removeAttribute=function(e){var t=this.attributes[e];t.deleteType=t.type,t.deleteName=t.name},this.resetAttribute=function(e){this.attributes[e].deleteName!=null?this.attributes.splice(e,1):this.attributes[e]=this.attributes[e].copy()},this.resetMethod=function(e){this.methods[e].deleteName!=null?this.methods.splice(e,1):this.methods[e]=this.methods[e].copy()},this.addMethod=function(e){var t=new UmpleMethod("","","","");return t.set(e),this.methods.push(t),this.methods.length-1},this.removeMethod=function(e){var t=this.methods[e];t.deleteType=t.type,t.deleteVisibility=t.visibility,t.deleteName=t.name,t.deleteParameters=t.parameters},this.setExtendsClass=function(e){this.extendsClass=e},this.removeExtendsClass=function(){this.extendsClass=null},this.borderLines=function(){var e=jQuery("#"+this.id),t=e.width(),n=e.height(),r=this.position,o=this.position.add(new UmplePosition(t,0,0,0)),a=this.position.add(new UmplePosition(0,n,0,0)),s=this.position.add(new UmplePosition(t,n,0,0));return borders=[],borders.push(new UmpleLine(r,o)),borders.push(new UmpleLine(r,a)),borders.push(new UmpleLine(a,s)),borders.push(new UmpleLine(o,s)),borders},this.drawable=function(){var e=this.drawClass(),t=this.drawGeneralization(),n=[e,t];return n},this.drawClass=function(){var e="#"+this.id,t=jQuery(e).get();t==null||t==null||t==""?(classDiv=jQuery("<div></div>"),classDiv.addClass("umpleClass"),classDiv.attr("tabindex",2)):(classDiv=jQuery(t),removalSel=format("div#{0} .classTable,div#{0} .umpleAttribute,div#{0} .umpleAttributeNew,div#{0} .anchor, div#{0} .hover",this.id),jQuery(removalSel).remove()),classDiv.attr("id",this.id);var n=-3.5,r=-3,o="",a="",s="";if(this.attributes.length>0)for(var c=0;c<this.attributes.length;c++){var d=this.attributes[c],u="";d.textColor!="black"&&(u=format("style='color:{0}'",d.textColor)),Page.isPhotoReady()?o+=format('<div class="umpleAttribute" {3}>{0} : {1}</div>',d.name,d.type,u):o+=format('<div class="umpleAttribute" {5}><span id="{2}_attribute_{3}" name="attributeEdit" class="editable editableDoubleClick">{0} : {1}</span> <img src="scripts/delete2.jpg" onclick="DiagramEdit.attributeDelete({4}{2}{4},{4}{3}{4})" /></div>',d.name,d.type,this.id,c,"'",u)}if(this.methods.length>0)for(var c=0;c<this.methods.length;c++){var f=this.methods[c],v="";f.visibility=="public"?v="+ ":f.visibility=="private"?v="- ":f.visibility=="protected"?v="# ":v="+ ";var h=f.type==""?"void":f.type;Page.isPhotoReady()?f.isAbstract=="true"?a+=format('<div class="umpleMethod">{3}<span style="font-style:italic">{1}({2}) </span> : {0} </div>',h,f.name,f.parameters,v):a+=format('<div class="umpleMethod">{3}{1}({2}) : {0} </div>',h,f.name,f.parameters,v):f.isAbstract=="true"?a+=format('<div class="umpleMethod"><span id="{4}_method_{5}" name="methodEdit" class="editable editableDoubleClick">{3}<span style="font-style:italic">{1}({2})</span> : {0} </span> <img src="scripts/delete2.jpg" onclick="DiagramEdit.methodDelete({6}{4}{6},{6}{5}{6})" /></div>',h,f.name,f.parameters,v,this.id,c,"'"):a+=format('<div class="umpleMethod"><span id="{4}_method_{5}" name="methodEdit" class="editable editableDoubleClick">{3}{1}({2}) : {0} </span> <img src="scripts/delete2.jpg" onclick="DiagramEdit.methodDelete({6}{4}{6},{6}{5}{6})" /></div>',h,f.name,f.parameters,v,this.id,c,"'")}o+=format('<div class="umpleAttributeNew"><span id="{0}_newAttribute" name="attributeNew" class="editable editableSingleClick">{1}</span></div>',this.id,Page.isPhotoReady()?"&nbsp;":"-- Add More --"),a+=format('<div class="umpleMethodNew"><span id="{0}_newMethod" name="methodNew" class="editable editableSingleClick">{1}</span></div>',this.id,Page.isPhotoReady()?"&nbsp;":"-- Add More --"),Page.isPhotoReady(),rowspan=3,Page.showAttributes&&(rowspan+=1),Page.showMethods&&(rowspan+=1),s+=format('<table bgcolor="'+this.displayColor+'" class="classTable" border="0">',this.id)+format('  <tr class="height">    <td rowspan="{2}"> <img id="{0}_height" src="scripts/_.gif" style="width:0px;height:{1}px;display:block;"  />    </td>  </tr>',this.id,this.position.height,rowspan)+'  <tr class="classArea">    <td > <img src="scripts/class.png" title="Class" /> ',Page.isPhotoReady()?this.isInterface=="true"?s+=format('<span>&#171interface&#187<span><br><span id="{0}_name" name="className">{1}</span>',this.id,this.name):this.isAbstract=="true"?s+=format('<span>&#171abstract&#187<span><br><span id="{0}_name" name="className">{1}</span>',this.id,this.name):s+=format('<span id="{0}_name" name="className">{1}</span>',this.id,this.name):this.isInterface=="true"?s+=format('<span>&#171interface&#187<span><br><span id="{0}_name" name="className" class="editable editableDoubleClick">{1}</span>',this.id,this.name):this.isAbstract=="true"?s+=format('<span>&#171abstract&#187<span><br><span id="{0}_name" name="className" class="editable editableDoubleClick">{1}</span>',this.id,this.name):s+=format('<span id="{0}_name" name="className" class="editable editableDoubleClick" >{1}</span>',this.id,this.name),s+="</td> </tr>",Page.showAttributes==!0&&(s+=format('  <tr class="attributeArea">    <td class="attributes">{0}    </td>  </tr>',o)),Page.showMethods==!0&&(s+=format('  <tr class="methodArea">    <td class="methods">{0}    </td>  </tr>',a)),s+=format('  <tr class="width">    <td> <img id="{0}_width" src="scripts/_.gif" style="width:{1}px;height:0px;display:block;"  />    </td>  </tr>',this.id,this.position.width),s+="</table>";var C=classDiv.html();return classDiv.html(s+C),classDiv},this.drawableClassOutline=function(){var e="#tempClass",t=jQuery(e).get();t==null||t==null||t==""?(t=jQuery("<div></div>"),t.addClass("umpleClass"),t.attr("id",this.id)):t=jQuery(e);var n='<table class="classTable" "border="0">'+format('  <tr class="height">    <td rowspan="4"> <img id="{0}_height" src="scripts/_.gif" style="width:0px;height:{1}px;display:block;"  />    </td>  </tr>',this.id,this.position.height)+'  <tr class="classArea">    <td> <img src="scripts/class.png" title="Class" /> '+format('      <span id="{0}_name" name="className" >{1}</span>',this.id,this.name)+'    </td>  </tr>  <tr class="attributeArea">    <td class="attributes">    </td>  </tr>  <tr class="width">'+format('    <td> <img id="{0}_width" src="scripts/_.gif" style="width:{1}px;height:0px;display:block;"  />    </td>  </tr>',this.id,this.position.width)+"</table>";return t.html(n),t},this.drawGeneralization=function(){var e=null,t=[],n=UmpleSystem.find(this.extendsClass);if(n==null&&this.interfaces.length==0)return null;if(n!=null&&(e=new UmpleGeneralization,e.childId=this.id,e.parentId=n.id,e.childPosition=this.position,e.parentPosition=n.position,t[0]=e.drawable()),this.interfaces.length>0)for(var r=null,o=0;o<this.interfaces.length;o++)r=UmpleSystem.find(this.interfaces[o]),r!=null&&(e=new UmpleGeneralization,e.childId=this.id,e.parentId=r.id,e.childPosition=this.position,e.parentPosition=r.position,t[o+1]=e.drawable());return t},this.anchorDivHtml=function(e,t){return format('<div id="{0}_{1}{2}" class="{3}" name="{4}" style="top: 0px; left: 0px; cursor:{5}; display: none;"><img name="image" src="./scripts/_.gif"/></div>',this.id,e,t,e,e,"move")}}function UmpleGeneralization(){this.parentId=null,this.childId=null,this.parentPosition=null,this.childPosition=null,this.id=null,this.setClasses=function(e,t){this.childId=e,this.parentId=t},this.setChildId=function(e){this.childId=e},this.setParentId=function(e){this.parentId=e},this.getElementId=function(){return this.id==null?"newgeneralization":this.id},this.getChildId=function(){return this.childId},this.getParentId=function(){return this.parentId},this.drawable=function(e){if(e==null&&(e=!0),this.childId==null||this.childId==null)return null;var t="#"+this.childId+"_generalization";jQuery(t).remove();var n=jQuery("<div></div>"),r=e?this.childId+"_generalization":"newgeneralization",o="umpleGeneralization";n.attr("id",r),n.attr("tabindex",2),n.addClass(o);var a=new UmplePosition(0,10,0,0),O=new UmplePosition(15,0,0,0),s=new UmplePosition(0,22,0,0),c=this.childPosition,d=new UmplePosition(this.childPosition.width/2,0,0,0),u=this.parentPosition,f=new UmplePosition(this.parentPosition.width/2,this.parentPosition.height,0,0);f=f.add(a).add(s),u=u.add(f),c=c.add(d);var v=this.childPosition.x,h=this.childPosition.x+this.childPosition.width,C=this.childPosition.y+this.childPosition.height,A=this.childPosition.y,T=!0;u.y>A&&(u.y<C?Math.abs(u.x-h)<Math.abs(u.x-v)?(c=c.add(new UmplePosition(this.childPosition.width/2,0,0,0)),c.y=u.y,T=!1):(c=c.subtract(new UmplePosition(this.childPosition.width/2,0,0,0)),c.y=u.y,T=!1):c=c.add(new UmplePosition(0,this.childPosition.height,0,0)));var j=new UmplePosition(c.x,u.y);if(T){var N=new UmpleLine(j.add(UmpleClassFactory.offsetError),u.add(UmpleClassFactory.offsetError)),p=new UmpleLine(c.add(UmpleClassFactory.offsetError),j.add(UmpleClassFactory.offsetError));n.append(N.drawable())}else var p=new UmpleLine(c.add(UmpleClassFactory.offsetError),u.add(UmpleClassFactory.offsetError));n.append(p.drawable());var b=u,_=u.subtract(s),L=new UmpleLine(b.add(UmpleClassFactory.offsetError),_.add(UmpleClassFactory.offsetError));n.append(L.drawable());var P=_.subtract(new UmplePosition(O.x/2,0,0,0)),S=P.add(O),k=_.subtract(a),O=new UmpleLine(P.add(UmpleClassFactory.offsetError),S.add(UmpleClassFactory.offsetError)),R=new UmpleLine(P.add(UmpleClassFactory.offsetError),k.add(UmpleClassFactory.offsetError)),I=new UmpleLine(S.add(UmpleClassFactory.offsetError),k.add(UmpleClassFactory.offsetError));n.append(O.drawable()),n.append(I.drawable()),n.append(R.drawable());var F="",V=n.html();return n.html(F+V),n},this.anchorDivHtml=function(e,t,n,r){return format('<div id="{0}_{1}{2}" class="{1}" name="{1}" style="left: {3}px; top: {4}px; cursor: pointer; display: none;"><img name="image" src="./scripts/_.gif"/></div>',this.childId+"_generalization",e,t,n,r)}}History=new Object,History.versionCount=9999,History.noChange="//$?[No_Change]$?",History.getInstance=function(e){var t=new Object;return t.id=e,t.currentIndex=-1,t.oldestAvailableIndex=0,t.newestAvailableIndex=0,t.firstSave=!0,t.undoButton=!1,t.redoButton=!1,t.getNextVersion=function(){return History.getNextVersion(t)},t.getPreviousVersion=function(){return History.getPreviousVersion(t)},t.save=function(n,r){return History.save(t,n,r)},t.distanceBetween=function(n,r){return History.distanceBetween(t,n,r)},t.setButtons=function(){return History.setButtons(t)},t.getVersion=function(n){return History.getVersion(t,n)},t.setVersion=function(n,r){return History.setVersion(t,n,r)},t},History.setButtons=function(e){History.enableButtonUndo(e,e.undoButton),History.enableButtonRedo(e,e.redoButton)},History.enableButtonUndo=function(e,t){e.undoButton=t,Page.enablePaletteItem("buttonUndo",t)},History.enableButtonRedo=function(e,t){e.redoButton=t,Page.enablePaletteItem("buttonRedo",t)},History.getNextVersion=function(e){History.enableButtonUndo(e,!0);var t;return!e.FirstSave&&e.newestAvailableIndex!=e.currentIndex?(e.currentIndex=History.incrementIndex(e.currentIndex),t=e.getVersion(e.currentIndex),t==null&&(t=History.noChange)):t=History.noChange,e.newestAvailableIndex==e.currentIndex&&History.enableButtonRedo(e,!1),t},History.getPreviousVersion=function(e){var t;return!e.FirstSave&&e.oldestAvailableIndex!=e.currentIndex?(e.currentIndex=History.decrementIndex(e.currentIndex),t=e.getVersion(e.currentIndex),t==null?t=History.noChange:History.enableButtonRedo(e,!0)):t=History.noChange,e.oldestAvailableIndex==e.currentIndex&&History.enableButtonUndo(e,!1),t},History.save=function(e,t,n){if(e.getVersion(e.currentIndex)!=t){e.firstSave||(History.enableButtonRedo(e,!1),History.enableButtonUndo(e,!0));var r=e.distanceBetween(e.oldestAvailableIndex,e.currentIndex);r==e.versionCount-1&&(e.oldestAvailableIndex=History.incrementIndex(e.oldestAvailableIndex)),e.currentIndex=History.incrementIndex(e.currentIndex),e.newestAvailableIndex=e.currentIndex,e.setVersion(e.currentIndex,t),e.firstSave&&(e.firstSave=!1)}},History.decrementIndex=function(e){var t;return e==0?t=History.versionCount-1:t=e-1,t},History.incrementIndex=function(e){var t=(e+1)%History.versionCount;return t},History.getVersion=function(e,t){var n="#textEditorColumn",r=e.id+"version"+t;return jQuery(n).data(r)},History.setVersion=function(e,t,n){var r="#textEditorColumn",o=e.id+"version"+t;return jQuery(r).data(o,n)},History.distanceBetween=function(e,t,n){if(e.currentIndex==-1)return 0;for(var r=0,o=t;o!=n;)o=History.incrementIndex(o),r+=1;return r};var Layout={};Layout.isTextVisible=!0,Layout.isDiagramVisible=!0,Layout.isPaletteVisible=!0,Layout.isLayoutVisible=!1,Layout.layoutHandler=null,Layout.isInSmallScreenMode=!1,Layout.screenThresholdWidth=945;var canvasHandle="#umpleCanvasColumn",editorHandle="#textEditorColumn",modelEditorHandle="#newEditor",paletteHandle="#paletteColumn",layoutEditorHandle="#bottomTextEditor";Layout.init=function(){Layout.errorMessageSpace=jQuery(".spacer").outerHeight(),Layout.errorMessageSpace===null&&(Layout.errorMessageSpace=0);var e=this.checkLayoutNeeded();e.layoutType==="large"?(this.layoutHandler=new LargeScreenManager,this.isInSmallScreenMode=!1):e.layoutType==="small"&&(this.layoutHandler=new SmallScreenManager,this.isInSmallScreenMode=!0),this.layoutHandler.transition(!0),jQuery(window).bind("resize",function(t){jQuery(t.target).hasClass("ui-resizable")||Layout.zoomResize()})},Layout.checkLayoutNeeded=function(){return jQuery(window).innerWidth()>jQuery(window).innerHeight()&&!(jQuery("body").innerWidth()<580&&jQuery("body").innerHeight()<580)?{layoutType:"large"}:{layoutType:"small"}},Layout.initPaletteSize=function(){this.layoutHandler.initPaletteSize()},Layout.initUmpleCanvasSize=function(){this.layoutHandler.initUmpleCanvasSize()},Layout.initUmpleTextAreaSize=function(){this.layoutHandler.initUmpleTextAreaSize()},Layout.setTextEditorSize=function(e,t){this.layoutHandler.setTextEditorSize(e,t)},Layout.setUmpleCanvasSize=function(e,t){this.layoutHandler.setUmpleCanvasSize(e,t)},Layout.adjustTextEditorHeight=function(e){this.isLayoutVisible?(jQuery(modelEditorHandle).outerHeight(e*.7),Page.codeMirrorOn&&this.resizeCodeMirrorEditor(e*.7),jQuery(layoutEditorHandle).outerHeight(e*.3)):(jQuery(modelEditorHandle).outerHeight(e),Page.codeMirrorOn&&this.resizeCodeMirrorEditor(e)),jQuery(editorHandle).height(e)},Layout.resizeCodeMirrorEditor=function(e){Page.codeMirrorOn&&(Page.codeMirrorEditor6.dom.style.height=e+"px")},Layout.showHideLayoutEditor=function(e){var t=jQuery(layoutEditorHandle),n=jQuery(editorHandle).height();e==null&&(e=!this.isLayoutVisible),e?(Layout.isLayoutVisible=!0,t.show()):(Layout.isLayoutVisible=!1,t.hide()),this.adjustTextEditorHeight(n)},Layout.showHideTextEditor=function(e){var t=jQuery(editorHandle),n=jQuery("#buttonShowHideLayoutEditor"),r=jQuery(".layoutListItem");e==null&&(e=!this.isTextVisible),e?(t.show(),this.isTextVisible=!0,n.prop("disabled",!1),n.css("cursor","pointer"),r.css("color","Black"),jQuery("#linetext").show(),Page.setUmpleCode(Page.getUmpleCode())):(t.hide(),this.isTextVisible=!1,n.prop("disabled",!0),n.css("cursor","not-allowed"),r.css("color","DimGray"),jQuery("#linetext").hide()),this.layoutHandler.showHideResizableAdjustment(),this.layoutHandler.showHideResize()},Layout.showHideCanvas=function(e){var t=jQuery(canvasHandle);e==null&&(e=!this.isDiagramVisible),e?(t.show(),this.isDiagramVisible=!0,Action.manualSync=jQuery("#buttonManualSync").prop("checked"),jQuery("#buttonShowHideCanvas").prop("checked",!0),Action.manualSync||(Action.updateUmpleDiagram(),Action.diagramInSync=!0,Page.enableDiagram(!0)),Action.manualSync&&!Action.diagramInSync&&Page.enablePaletteItem("buttonSyncDiagram",!0),(!Action.manualSync||Action.diagramInSync)&&(Page.enableCheckBoxItem("buttonPhotoReady","ttPhotoReady",!0),Page.enableCheckBoxItem("buttonManualSync","ttManualSync",!0),Page.enablePaletteItem("buttonAddClass",!0),Page.enablePaletteItem("buttonAddAssociation",!0),Page.enablePaletteItem("buttonAddTransition",!0),Page.enablePaletteItem("buttonAddGeneralization",!0),Page.enablePaletteItem("buttonDeleteEntity",!0),Page.initToggleTool("buttonAddClass"),Page.initToggleTool("buttonAddAssociation"),Page.initToggleTool("buttonAddTransition"),Page.initToggleTool("buttonAddGeneralization"),Page.initToggleTool("buttonDeleteEntity"))):(t.hide(),this.isDiagramVisible=!1,Action.manualSync=!0,jQuery("#buttonShowHideCanvas").prop("checked",!1),Page.enableCheckBoxItem("buttonPhotoReady","ttPhotoReady",!1),Page.enableCheckBoxItem("buttonManualSync","ttManualSync",!1),Page.enablePaletteItem("buttonAddClass",!1),Page.enablePaletteItem("buttonAddAssociation",!1),Page.enablePaletteItem("buttonAddTransition",!1),Page.enablePaletteItem("buttonAddGeneralization",!1),Page.enablePaletteItem("buttonDeleteEntity",!1),Page.enablePaletteItem("buttonSyncDiagram",!1),Page.removeToggleTool("buttonAddClass"),Page.removeToggleTool("buttonAddAssociation"),Page.removeToggleTool("buttonAddTransition"),Page.removeToggleTool("buttonAddGeneralization"),Page.removeToggleTool("buttonDeleteEntity")),this.layoutHandler.showHideResizableAdjustment(),this.layoutHandler.showHideResize()},Layout.showHideMenu=function(e){var t=jQuery("#paletteColumn");e==null&&(e=!this.isPaletteVisible),e?(Layout.isPaletteVisible=!0,t.show()):(Layout.isPaletteVisible=!1,t.hide()),this.layoutHandler.showHideResizableAdjustment(),this.layoutHandler.showHideResize()},Layout.zoomResize=function(){var e=this.checkLayoutNeeded();e.layoutType==="large"?this.isInSmallScreenMode&&this.toggleSmallScreenMode():e.layoutType==="small"&&(this.isInSmallScreenMode||this.toggleSmallScreenMode()),this.layoutHandler.adjustAfterWindowResize()},Layout.toggleSmallScreenMode=function(){this.isInSmallScreenMode?(this.isInSmallScreenMode=!1,this.layoutHandler=new LargeScreenManager):(this.isInSmallScreenMode=!0,this.layoutHandler=new SmallScreenManager),this.layoutHandler.transition(!1)},Layout.verticallyResizing=function(e,t){this.layoutHandler.verticallyResizing(e,t)},Layout.verticallyResized=function(e,t){this.layoutHandler.verticallyResized(e,t)},Layout.editorResizing=function(e,t){this.layoutHandler.editorResizing(e,t)},Layout.editorResized=function(e,t){this.layoutHandler.editorResized(e,t)},Layout.canvasResizing=function(e,t){this.layoutHandler.canvasResizing(e,t)},Layout.canvasResized=function(e,t){this.layoutHandler.canvasResized(e,t)},Layout.calculateMainHeight=function(){return jQuery(paletteHandle).outerHeight()};function LargeScreenManager(){this.transition=function(e){if(!e){try{jQuery(editorHandle).resizable("destroy")}catch{}try{jQuery(paletteHandle).resizable("destroy")}catch{}try{jQuery(canvasHandle).resizable("destroy")}catch{}jQuery(editorHandle).removeClass("smallScreenEditor smallScreenEditorNoMargin"),jQuery(canvasHandle).removeClass("smallScreenCanvas smallScreenCanvasNoEditor smallScreenCanvasNoEditorNoPalette")}this.adjustMarginSpace(),this.heightFactor=1,this.minCanvasSize=new UmplePosition(0,0,420,50),this.minEditorSize=new UmplePosition(0,0,284,0);var t=jQuery("body").outerWidth(!0)-this.marginSpace-jQuery(paletteHandle).outerWidth()-this.minCanvasSize.width,n=jQuery("body").outerWidth(!0)-this.marginSpace-jQuery(paletteHandle).outerWidth()-this.minEditorSize.width;this.maxEditorSize=new UmplePosition(0,0,t,0),this.maxCanvasSize=new UmplePosition(0,0,n,0),this.initEditorResizable(),this.initCanvasResizable(),this.initVerticalResizable()},this.initUmpleCanvasSize=function(){this.initCanvasResizable(),this.setUmpleCanvasSize(this.minCanvasSize.width)},this.initUmpleTextAreaSize=function(){this.initEditorResizable(),this.setTextEditorSize(508,void 0),this.adjustAfterWindowResize()},this.initPaletteSize=function(){jQuery("#paletteColumn").height(this.calculateHeight()),jQuery("#palette").accordion("refresh"),this.initVerticalResizable()},this.setTextEditorSize=function(e,t){var n=jQuery(editorHandle);e==null&&(e=n.outerWidth()),t==null&&(t=Layout.calculateMainHeight()),e<this.minEditorSize.width?e=this.minEditorSize.width:Layout.isDiagramVisible||(e=e),n.outerWidth(e),Layout.adjustTextEditorHeight(t),Layout.isDiagramVisible&&this.setUmpleCanvasSize(this.calculateLeftoverWidth()+jQuery(canvasHandle).outerWidth(),void 0)},this.setUmpleCanvasSize=function(e,t){var n=jQuery(canvasHandle);e==null&&(e=n.outerWidth()),t==null&&(t=Layout.calculateMainHeight()),e<this.minCanvasSize.width&&(e=this.minCanvasSize.width),t<this.minCanvasSize.height&&(t=this.minCanvasSize.height),e>this.maxCanvasSize.width&&Layout.isTextVisible&&(e=this.maxCanvasSize.width),n.outerWidth(e),n.height(t),jQuery("#palette").accordion("refresh")},this.showHideResize=function(){this.adjustMarginSpace(),this.adjustMaxSizes(),Layout.isDiagramVisible&&!Layout.isTextVisible?this.setUmpleCanvasSize(this.calculateLeftoverWidth()+jQuery(canvasHandle).outerWidth(),void 0):Layout.isTextVisible&&this.setTextEditorSize(this.calculateLeftoverWidth()+jQuery(editorHandle).outerWidth(),void 0)},this.showHideResizableAdjustment=function(){if(!Layout.isDiagramVisible||!Layout.isTextVisible){try{jQuery(canvasHandle).resizable("destroy")}catch{}try{jQuery(editorHandle).resizable("destroy")}catch{}}else Layout.isDiagramVisible&&Layout.isTextVisible&&(this.initCanvasResizable(),this.initEditorResizable());if(jQuery(editorHandle).outerWidth()<this.minEditorSize.width||jQuery(canvasHandle).outerWidth()<this.minCanvasSize.width){try{jQuery(canvasHandle).resizable("destroy")}catch{}try{jQuery(editorHandle).resizable("destroy")}catch{}}else this.initCanvasResizable(),this.initEditorResizable();this.adjustMaxSizes()},this.adjustMaxSizes=function(){if(Layout.isDiagramVisible&&Layout.isTextVisible){var e=jQuery("body").outerWidth(!0)-this.marginSpace;Layout.isDiagramVisible&&(e-=this.minCanvasSize.width),Layout.isPaletteVisible&&(e-=jQuery(paletteHandle).outerWidth());var t=jQuery("body").outerWidth(!0)-this.marginSpace;Layout.isTextVisible&&(t-=this.minEditorSize.width),Layout.isPaletteVisible&&(t-=jQuery(paletteHandle).outerWidth()),this.maxEditorSize=new UmplePosition(0,0,e,0),this.maxCanvasSize=new UmplePosition(0,0,t,0),jQuery(editorHandle).outerWidth()>this.minEditorSize.width&&jQuery(canvasHandle).outerWidth()>this.minCanvasSize.width&&(jQuery(editorHandle).resizable("option","maxWidth",this.maxEditorSize.width),jQuery(canvasHandle).resizable("option","maxWidth",this.maxCanvasSize.width))}Action.setupPinch()},this.adjustAfterWindowResize=function(){this.adjustMaxSizes(),jQuery("#paletteColumn").height(this.calculateHeight()),jQuery("#palette").accordion("refresh");var e=this.calculateLeftoverWidth();jQuery(canvasHandle).outerWidth()<this.minCanvasSize.width&&jQuery(canvasHandle).outerWidth()+e>=this.minCanvasSize.width&&e>0||jQuery(canvasHandle).outerWidth()+e<=this.minCanvasSize.width&&e>0?this.setTextEditorSize(jQuery(editorHandle).outerWidth(),void 0):this.setTextEditorSize(e+jQuery(editorHandle).outerWidth(),void 0),this.showHideResizableAdjustment()},this.initVerticalResizable=function(){jQuery("#mainApplication").resizable({resize:function(e,t){Layout.verticallyResizing(e,t)},stop:function(e,t){Layout.verticallyResized(e,t)},autoHide:!0,minHeight:this.minCanvasSize.height,handles:"s"})},this.initEditorResizable=function(){!Layout.isTextVisible||!Layout.isDiagramVisible||jQuery(editorHandle).resizable({start:function(e,t){Layout.savedStartingWidth=jQuery(canvasHandle).outerWidth()},resize:function(e,t){Layout.editorResizing(e,t)},stop:function(e,t){Layout.editorResized(e,t)},autoHide:!0,minWidth:this.minEditorSize.width,maxWidth:this.maxEditorSize.width,handles:"e"})},this.initCanvasResizable=function(){if(!(!Layout.isTextVisible||!Layout.isDiagramVisible)){var e=jQuery(canvasHandle);e.resizable({start:function(t,n){Layout.savedStartingWidth=jQuery(editorHandle).outerWidth()},resize:function(t,n){Layout.canvasResizing(t,n)},stop:function(t,n){Layout.canvasResized(t,n)},autoHide:!0,minWidth:this.minCanvasSize.width,maxWidth:this.maxCanvasSize.width,handles:"w"})}},this.verticallyResizing=function(e,t){var n=t.size.height;jQuery(paletteHandle).outerHeight(n),jQuery(editorHandle).outerHeight(n),jQuery(canvasHandle).outerHeight(n),Layout.adjustTextEditorHeight(n),jQuery("#palette").accordion("refresh")},this.verticallyResized=function(e,t){this.heightFactor=jQuery("#mainApplication").outerHeight()/(jQuery(window).innerHeight()-jQuery("#header").outerHeight()-jQuery("#topLine").outerHeight()-parseInt(jQuery("body").css("marginBottom"))-parseInt(jQuery("body").css("marginTop"))),this.setTextEditorSize(void 0,t.size.height),jQuery("#mainApplication").css("height","auto")},this.editorResizing=function(e,t){var n=t.size.width,r=t.originalSize.width-n;jQuery(canvasHandle).outerWidth(Layout.savedStartingWidth+r),jQuery(modelEditorHandle).width(n),jQuery(layoutEditorHandle).width(n)},this.editorResized=function(e,t){var n=t.size.width;jQuery(modelEditorHandle).css("width","auto"),jQuery(layoutEditorHandle).css("width","auto"),this.setTextEditorSize(n,void 0),delete Layout.savedStartingWidth},this.canvasResizing=function(e,t){var n=t.size.width;jQuery(canvasHandle).outerWidth(n);var r=n-t.originalSize.width;jQuery(editorHandle).width(Layout.savedStartingWidth-r),jQuery(modelEditorHandle).width(Layout.savedStartingWidth-r),jQuery(layoutEditorHandle).width(Layout.savedStartingWidth-r),jQuery(canvasHandle).css("left","0px"),Action.setupPinch()},this.canvasResized=function(e,t){var n=t.size.width;jQuery(modelEditorHandle).css("width","auto"),jQuery(layoutEditorHandle).css("width","auto"),this.setTextEditorSize(this.calculateLeftoverWidth()+jQuery(editorHandle).outerWidth(),void 0),delete this.savedStartingWidth},this.adjustMarginSpace=function(){jQuery(editorHandle).removeClass("largeScreenEditor largeScreenEditorNoMargin"),jQuery(canvasHandle).removeClass("largeScreenCanvas largeScreenCanvasNoMargin"),Layout.isTextVisible?Layout.isDiagramVisible&&Layout.isPaletteVisible?(jQuery(editorHandle).addClass("largeScreenEditor"),jQuery(canvasHandle).addClass("largeScreenCanvas")):Layout.isDiagramVisible||Layout.isPaletteVisible?(jQuery(editorHandle).addClass("largeScreenEditor"),jQuery(canvasHandle).addClass("largeScreenCanvasNoMargin")):(jQuery(editorHandle).addClass("largeScreenEditorNoMargin"),jQuery(canvasHandle).addClass("largeScreenCanvasNoMargin")):(jQuery(editorHandle).addClass("largeScreenEditorNoMargin"),Layout.isDiagramVisible&&Layout.isPaletteVisible?jQuery(canvasHandle).addClass("largeScreenCanvas"):jQuery(canvasHandle).addClass("largeScreenCanvasNoMargin")),this.marginSpace=parseInt(jQuery("body").css("marginLeft"))+parseInt(jQuery("body").css("marginRight"))+1+parseInt(jQuery(canvasHandle).css("marginLeft"))+parseInt(jQuery(editorHandle).css("marginRight"))},this.calculateLeftoverWidth=function(){var e=jQuery("body").outerWidth(!0)-this.marginSpace;return Layout.isTextVisible&&(e-=jQuery(editorHandle).outerWidth()),Layout.isDiagramVisible&&(e-=jQuery(canvasHandle).outerWidth()),Layout.isPaletteVisible&&(e-=jQuery(paletteHandle).outerWidth()),e},this.calculateHeight=function(){var e=TabControl.isHidden()?0:jQuery("#tabControl").outerHeight(),t=jQuery("#taskArea").css("display")=="none"?0:jQuery("#taskArea").outerHeight();t>jQuery(window).innerHeight()/2&&(t=0);var n=(jQuery(window).innerHeight()-jQuery("#header").outerHeight()-jQuery("#topLine").outerHeight()-e-parseInt(jQuery("body").css("marginBottom"))-parseInt(jQuery("body").css("marginTop"))-Layout.errorMessageSpace)*this.heightFactor-t;return n<this.minCanvasSize.height?this.minCanvasSize.height:n}}function SmallScreenManager(){this.transition=function(e){if(!e){try{jQuery(editorHandle).resizable("destroy")}catch{}try{jQuery(canvasHandle).resizable("destroy")}catch{}try{jQuery("#mainApplication").resizable("destroy")}catch{}jQuery(editorHandle).removeClass("largeScreenEditor largeScreenEditorNoMargin"),jQuery(canvasHandle).removeClass("largeScreenCanvas largeScreenCanvasNoMargin")}this.adjustMarginSpace(),this.minCanvasSize=new UmplePosition(0,0,420,50),this.minEditorSize=new UmplePosition(0,0,284,0),this.initEditorResizable(),this.initCanvasResizable(),this.initPaletteResizable()},this.initUmpleCanvasSize=function(){this.setUmpleCanvasSize(void 0,this.calculateHeight()),this.initCanvasResizable(),this.initPaletteResizable(),Layout.isDiagramVisible==!1&&Layout.showHideCanvas(!1)},this.initUmpleTextAreaSize=function(){this.setTextEditorSize(),this.initEditorResizable()},this.initPaletteSize=function(){jQuery("#paletteColumn").outerHeight(this.calculateHeight()),jQuery("#palette").accordion("refresh")},this.setTextEditorSize=function(n,t){var n=this.calculateLeftoverWidth();Layout.isPaletteVisible,jQuery(editorHandle).outerWidth(n),t!=null?Layout.adjustTextEditorHeight(t):Layout.adjustTextEditorHeight(this.calculateHeight())},this.setUmpleCanvasSize=function(e,t){Layout.isTextVisible?jQuery(canvasHandle).outerWidth(jQuery("body").width()):jQuery(canvasHandle).outerWidth(this.calculateLeftoverWidth()),t!=null&&jQuery(canvasHandle).outerHeight(t)},this.showHideResize=function(){var e=void 0;this.adjustMarginSpace(),Layout.isTextVisible?this.setTextEditorSize(void 0,jQuery(paletteHandle).outerHeight()):e=jQuery(paletteHandle).outerHeight(),jQuery("#palette").accordion("refresh"),this.pairResizables(),this.setUmpleCanvasSize(void 0,e)},this.showHideResizableAdjustment=function(){},this.adjustAfterWindowResize=function(){jQuery("#paletteColumn").outerHeight(this.calculateHeight()),jQuery("#palette").accordion("refresh"),this.setTextEditorSize(),this.setUmpleCanvasSize(void 0,this.calculateHeight())},this.initEditorResizable=function(){jQuery(editorHandle).resizable({autoHide:!0,minHeight:30,handles:"s"}),this.pairResizables()},this.initPaletteResizable=function(){jQuery(paletteHandle).resizable({autoHide:!0,minHeight:30,handles:"s"}),this.pairResizables()},this.initCanvasResizable=function(){jQuery(canvasHandle).resizable({autoHide:!0,minHeight:30,handles:"s"}),this.pairResizables()},this.verticallyResizing=function(e,t){jQuery(paletteHandle).outerHeight(t.size.height),jQuery("#palette").accordion("refresh")},this.verticallyResized=function(e,t){},this.editorResizing=function(e,t){Layout.adjustTextEditorHeight(t.size.height)},this.editorResized=function(e,t){},this.canvasResizing=function(e,t){jQuery(canvasHandle).outerHeight(t.size.height)},this.canvasResized=function(e,t){},this.adjustMarginSpace=function(){jQuery(canvasHandle).removeClass("smallScreenCanvas smallScreenCanvasNoEditor smallScreenCanvasNoEditorNoPalette"),jQuery(editorHandle).removeClass("smallScreenEditor smallScreenEditorNoMargin"),Layout.isTextVisible?(jQuery(canvasHandle).addClass("smallScreenCanvas"),Layout.isPaletteVisible?jQuery(editorHandle).addClass("smallScreenEditor"):jQuery(editorHandle).addClass("smallScreenEditorNoMargin")):(jQuery(editorHandle).addClass("smallScreenEditorNoMargin"),Layout.isPaletteVisible&&Layout.isDiagramVisible?jQuery(canvasHandle).addClass("smallScreenCanvasNoEditor"):jQuery(canvasHandle).addClass("smallScreenCanvasNoEditorNoPalette")),this.marginSpace=parseInt(jQuery("body").css("marginLeft"))+parseInt(jQuery("body").css("marginRight"))+1+parseInt(jQuery(editorHandle).css("marginRight"))+parseInt(jQuery(canvasHandle).css("marginLeft"))},this.calculateLeftoverWidth=function(){return Layout.isPaletteVisible?jQuery("body").outerWidth(!0)-this.marginSpace-jQuery(paletteHandle).outerWidth():jQuery("body").outerWidth(!0)-this.marginSpace},this.calculateHeight=function(){var e=TabControl.isHidden()?0:jQuery("#tabControl").outerHeight(),t=jQuery("#taskArea").css("display")=="none"?0:jQuery("#taskArea").outerHeight();t>jQuery(window).innerHeight()/2&&(t=0);var n=(jQuery(window).innerHeight()-jQuery("#header").outerHeight(!0)-2*jQuery("#topLine").outerHeight(!0)-e-Layout.errorMessageSpace)/2-t;return n},this.pairResizables=function(){if(!(!jQuery(editorHandle).is(".ui-resizable")||!jQuery(paletteHandle).is(".ui-resizable")||!jQuery(canvasHandle).is(".ui-resizable"))){if(Layout.isTextVisible)var e=function(s,c){Layout.editorResizing(s,c),Layout.verticallyResizing(s,c)},t=e,n=function(s,c){Layout.canvasResizing(s,c)},r=function(s,c){Layout.editorResized(s,c),Layout.verticallyResized(s,c)},o=r,a=function(s,c){Layout.canvasResized(s,c)};else var e=function(h,C){Layout.editorResizing(h,C)},n=function(h,C){Layout.canvasResizing(h,C),Layout.verticallyResizing(h,C)},t=n,r=function(h,C){Layout.editorResized(h,C)},a=function(h,C){Layout.canvasResized(h,C),Layout.verticallyResized(h,C)},o=a;jQuery(editorHandle).resizable("option","resize",e),jQuery(editorHandle).resizable("option","stop",r),jQuery(paletteHandle).resizable("option","resize",t),jQuery(paletteHandle).resizable("option","stop",o),jQuery(canvasHandle).resizable("option","resize",n),jQuery(canvasHandle).resizable("option","stop",a)}}}function UmpleLine(e,t){this.pointOne=e,this.pointTwo=t,this.drawable=function(n){var r=jQuery("<div class='umpleLine'></div>"),o=UmplePositionFactory.copy(this.pointOne),a=UmplePositionFactory.copy(this.pointTwo);typeof n<"u"&&(o.x=o.x+n.x,o.y=o.y+n.y,a.x=a.x+n.x,a.y=a.y+n.y);var s=0;if(o.y==a.y){var c=o.x<a.x?o:a,d=Math.abs(a.x-o.x);return r.append(this.createConnector(c.x,c.y,d,1)),r.append(this.createSelector(c.x,c.y,d,6)),r}else if(o.x==a.x){var c=o.y<a.y?o:a,u=Math.abs(a.y-o.y);return r.append(this.createConnector(c.x,c.y,1,u)),r.append(this.createSelector(c.x,c.y,6,u)),r}var f=this.slope(),v=a.x>o.x?1:-1,h=v*f;Math.abs(f)>1&&(h=a.y>o.y?1:-1,v=h*(1/f));for(var C=0,A=o.y,T=o.x;(T<=a.x&&v>0||T>=a.x&&v<0)&&!(C++>1e3);T+=v)r.append(this.createConnector(T,A,1,1)),r.append(this.createSelector(T,A,6,6)),A+=h,s++;return r},this.slope=function(){return slope=(this.pointTwo.y-this.pointOne.y)/(this.pointTwo.x-this.pointOne.x),slope},this.length=function(){var n=this.pointTwo.x-this.pointOne.x,r=this.pointTwo.y-this.pointOne.y,o=Math.sqrt(Math.pow(n,2)+Math.pow(r,2));return Math.round(o)},this.createConnector=function(n,r,o,a){var s=jQuery("<div></div>");return s.addClass("umpleAssociation"),s.attr("name",this.startId),s.css({position:"absolute",left:n,top:r,width:o,height:a}),s},this.createSelector=function(n,r,o,a){var s=jQuery("<div></div>");return s.addClass("umpleAssociationSelector"),s.attr("name",this.startId),s.css({position:"absolute",left:n,top:r,width:o,height:a}),s},this.intersection=function(n){var r=this.pointOne.x,o=this.pointOne.y,a=this.pointTwo.x,s=this.pointTwo.y,c=n.pointOne.x,d=n.pointOne.y,u=n.pointTwo.x,f=n.pointTwo.y,v=this.slope(),h=n.slope(),C=null,A=null,T=null,j=null,N=!1;if(v==h)return null;v==1/0||v==-1/0?(j=d-h*c,C=r,A=h*C+j,N=!0):(h==1/0||h==-1/0)&&(T=o-v*r,C=c,A=v*C+T,N=!0),N||(T=o-v*r,j=d-h*c,C=(j-T)/(v-h),A=v*C+T);var p=a>r?a:r,b=u>c?u:c,_=s>o?s:o,L=f>d?f:d,P=p==a?r:a,S=b==u?c:u,k=_==s?o:s,O=L==f?d:f;return C<P||C<S||C>p||C>b||A<k||A<O||A>_||A>L?null:(C=Math.round(C),A=Math.round(A),new UmplePosition(C,A,0,0))}}UmpleMethodFactory=new Object,UmpleMethodFactory.create=function(e){var t=new UmpleMethod(e.visibility,e.isAbstract,e.type,e.name,e.parameters);return t};function UmpleMethod(e,t,n,r,o){this.visibility=e,this.isAbstract=t,this.type=n,this.name=r,this.parameters=typeof o=="string"?o.split(","):o,this.set=function(a){var s=this.name!="";s&&(this.oldVisibility=this.visibility,this.oldType=this.type,this.oldName=this.name,this.oldParameters=this.parameters),a=a.trim();var c=a.charAt(0);c=="+"?(this.visibility="public",a=a.substr(1)):c=="-"?(this.visibility="private",a=a.substr(1)):c=="#"?(this.visibility="protected",a=a.substr(1)):this.visibility="public";var d=a.split(":");if(d.length<2)this.type="void",this.name=a.substring(0,a.indexOf("(")).trim(),this.parameters=a.match("\\((.*)\\)")[1].replace(/\s+/g,"").split(",");else{var u=d[0].trim();this.type=d[1].trim(),this.name=u.substring(0,u.indexOf("(")).trim(),this.parameters=u.match("\\((.*)\\)")[1].replace(/\s+/g,"").split(",")}s||(this.newVisibility=this.visibility,this.newType=this.type,this.newName=this.name,this.newParameters=this.parameters)},this.copy=function(){return new UmpleMethod(this.visibility,this.type,this.name,this.parameters)}}Page=new Object,Page.currentUmpleTextBeingEdited="",Page.selectedItem=null,Page.selectedClass=null,Page.selectedAssociation=null,Page.selectedTransition=null,Page.selectedGeneralization=null,Page.canEditTask=!1,Page.canCreateTask=!0,Page.codeEffect=null,Page.clickCount=0,Page.repeatToolItem=!1,Page.shortcutsEnabled=!0,Page.diagramSyncNeededAppend=!1,Page.modelDelimiter="//$?[End_of_model]$?",Page.codeMirrorOn=!1,Page.codeMirrorEditor=null,Page.codeMirrorEditor6=null,Page.hLine=null,Page.modelLoadingCount=0,Page.layoutLoadingCount=0,Page.canvasLoadingCount=0,Page.onLoadingCompleteCallbacks=[],Page.readOnly=!1,Page.useEditableClassDiagram=!0,Page.useGvClassDiagram=!1,Page.useGvStateDiagram=!1,Page.useGvFeatureDiagram=!1,Page.showFeatureDependency=!1,Page.useStructureDiagram=!1,Page.useFeatureDiagram=!1,Page.showAttributes=!0,Page.showMethods=!1,Page.filterWordsOutput="",Page.mixsetsActive=new Array,Page.filtersActive=new Array,Page.copyableMixset="",Page.specialSuboptionsActive=new Array,Page.showActions=!0,Page.showText=!0,Page.showCanvas=!0,Page.showTraits=!1,Page.showTransitionLabels=!1,Page.showGuardLabels=!1,Page.showGuards=!0,Page.modifiedDiagrams=!1,Page.allowPinch=!1,Page.initialMouseDownX=0,Page.initialMouseDownY=0,Page.selectedGvClass="",Page.blahblah=function(e){console.log("In blah blah "+e)},Page.isGvManual=function(){return Page.specialSuboptionsActive.includes("gvmanual")},Page.init=function(e,t,n,r,o,a,s,c,d,u,f){performance.navigation.type==2&&location.reload(!0),Page.canEditTask=d,Page.canCreateTask=u,Layout.isDiagramVisible=e,Layout.isTextVisible=t,Layout.isPaletteVisible=n,Layout.isLayoutVisible=o,Page.readOnly=r,TabControl.init(),jQuery(".layoutListItem").hide(),a.toLowerCase()=="gvstate"||a.toLowerCase()=="state"?(Page.useGvStateDiagram=!0,Page.useEditableClassDiagram=!1,Page.setDiagramTypeIconState("GvState"),Page.useGvFeatureDiagram=!1,jQuery(".view_opt_state").show()):a.toLowerCase()=="gvclass"?(Page.useGvClassDiagram=!0,Page.useEditableClassDiagram=!1,Page.setDiagramTypeIconState("GvClass"),Page.useGvFeatureDiagram=!1,jQuery(".view_opt_class").show()):a.toLowerCase()=="gvclasstrait"?(Page.useGvClassDiagram=!0,Page.useEditableClassDiagram=!1,Page.setDiagramTypeIconState("GvClass"),Page.useGvFeatureDiagram=!1,Page.showTraits=!0,jQuery(".view_opt_class").show()):a.toLowerCase()=="gvfeature"?(Page.useGvFeatureDiagram=!0,Page.useEditableClassDiagram=!1,Page.useGvStateDiagram=!1,Page.useStructureDiagram=!1,Page.setDiagramTypeIconState("GvFeature"),jQuery(".view_opt_feature").show()):a.toLowerCase()=="structurediagram"?(Page.useStructureDiagram=!0,Page.useEditableClassDiagram=!1,Page.setDiagramTypeIconState("structureDiagram"),Page.useGvFeatureDiagram=!1):(jQuery(".view_opt_class").show(),jQuery(".view_opt_class_palette").show()),f!=""&&(f.includes("gvmanual")&&(Page.specialSuboptionsActive.push("gvmanual"),f=f.replace("gvmanual","")),f.includes("gvdot")?(Page.specialSuboptionsActive.push("gvdot"),f=f.replace("gvdot","")):f.includes("gvsfdp")?(Page.specialSuboptionsActive.push("gvsfdp"),f=f.replace("gvsfdp","")):f.includes("gvortho")&&(Page.specialSuboptionsActive.push("gvortho"),f=f.replace("gvortho","")),jQuery("#filtervalues").val(f),Action.setFilterFull(f,!1)),jQuery.noConflict(),jQuery(document).keydown(function(v){Action.keyboardShortcut(v)}),Layout.init(),Page.initPaletteArea(),Page.initCanvasArea(),Page.initUmpleTextArea(),Page.initSourceCodeArea(),Page.initCodeExecutionArea(),jQuery(document).ready(function(){DropboxInitializer.initializeDropbox(),ToolTips.initTooltips(),window.AiSettings&&window.AiSettings.init&&window.AiSettings.init()}),Page.readOnly&&jQuery("#"+Page.umpleCanvasId()).addClass("photoReady"),Action.loadFile(),c&&Action.loadTask(jQuery("#model").val().split("-")[1],!0),jQuery(s).prop("selected",!0)},Page.initPaletteArea=function(){var e="#palette",t=e+" *";jQuery(e).accordion({heightStyle:"fill",fillSpace:!0,active:1,collapsible:!0}),jQuery(t).addClass("unselectable"),Layout.initPaletteSize(),Page.initJQueryButton("buttonGenerateCode"),Page.initJQueryButton("buttonExecuteCode"),Page.initJQueryButton("buttonStartOver"),Page.initJQueryButton("buttonShowRefreshUmpleOnlineCompletely"),Page.initJQueryButton("buttonLoadBlankModel"),Page.initHighlighter("buttonAddClass"),Page.initHighlighter("buttonAddAssociation"),Page.initHighlighter("buttonAddTransition"),Page.initHighlighter("buttonAddGeneralization"),Page.initHighlighter("buttonDeleteEntity"),Page.initHighlighter("buttonPngImage"),Page.initHighlighter("buttonYumlImage"),Page.initHighlighter("buttonSimulateCode"),Page.initHighlighter("buttonUigu"),Page.initHighlighter("buttonCopyClip"),Page.initHighlighter("buttonCopyMix"),Page.initHighlighter("buttonCollabFork"),Page.initHighlighter("buttonCopy"),Page.initHighlighter("buttonCopyEncodedURL"),Page.initHighlighter("buttonCopyCommandLine"),Page.initHighlighter("buttonCopyLocalBrowser"),Page.initHighlighter("buttonLoadLocalBrowser"),Page.canEditTask&&(Page.initHighlighter("buttonRequestAllZip"),Page.initHighlighter("buttonRequestLoadTaskURL")),Page.canCreateTask&&Page.initHighlighter("buttonCreateTask"),Page.initHighlighter("buttonLoadTask"),Page.initHighlighter("buttonDownloadFiles"),Page.initHighlighter("buttonSmaller"),Page.initHighlighter("buttonLarger"),Page.initHighlighter("buttonSyncCode"),Page.initHighlighter("buttonSyncDiagram"),Page.initHighlighter("buttonToggleMethods"),Page.initHighlighter("buttonToggleAttributes"),Page.initHighlighter("buttonToggleActions"),Page.initHighlighter("buttonToggleTransitionLabels"),Page.initHighlighter("buttonToggleGuards"),Page.initHighlighter("buttonToggleGuardLabels"),Page.initHighlighter("buttonToggleTraits"),Page.initHighlighter("buttonToggleFeatureDependency"),Page.initHighlighter("buttonallowPinch"),Page.initHighlighter("buttonReindent"),Page.initToggleTool("buttonAddClass"),Page.initToggleTool("buttonAddAssociation"),Page.initToggleTool("buttonAddTransition"),Page.initToggleTool("buttonAddGeneralization"),Page.initToggleTool("buttonDeleteEntity"),Page.initAction("buttonPngImage"),Page.initAction("buttonYumlImage"),Page.initAction("buttonPhpCode"),Page.initAction("buttonEcoreCode"),Page.initAction("buttonJavaCode"),Page.initAction("buttonJavaAPIDoc"),Page.initAction("buttonRubyCode"),Page.initAction("buttonAlloyCode"),Page.initAction("buttonNuSMVCode"),Page.initAction("buttonSqlCode"),Page.initAction("buttonCppCode"),Page.initAction("buttonPhotoReady"),Page.initAction("buttonSimulateCode"),Page.initAction("buttonShowHideTextEditor"),Page.initAction("buttonShowHideCanvas"),Page.initAction("buttonShowEditableClassDiagram"),Page.initAction("buttonShowJointJSClassDiagram"),Page.initAction("buttonShowGvClassDiagram"),Page.initAction("buttonShowGvStateDiagram"),Page.initAction("buttonShowGvFeatureDiagram"),Page.initAction("buttonShowStructureDiagram"),Page.initAction("buttonShowHideLayoutEditor"),Page.initAction("buttonManualSync"),Page.initAction("buttonCopyClip"),Page.initAction("buttonCopyMix"),Page.initAction("buttonCollabFork"),Page.initAction("buttonCopy"),Page.initAction("buttonCopyEncodedURL"),Page.initAction("buttonCopyCommandLine"),Page.initAction("buttonCopyLocalBrowser"),Page.initAction("buttonLoadLocalBrowser"),Page.canEditTask&&(Page.initAction("buttonRequestAllZip"),Page.initAction("buttonRequestLoadTaskURL")),Page.canCreateTask&&Page.initAction("buttonCreateTask"),Page.initAction("buttonLoadTask"),Page.initAction("buttonDownloadFiles"),Page.initAction("buttonUndo"),Page.initAction("buttonRedo"),Page.initAction("buttonReindent"),Page.initAction("buttonUigu"),Page.initAction("buttonStartOver"),Page.initAction("buttonShowRefreshUmpleOnlineCompletely"),Page.initAction("buttonLoadBlankModel"),Page.initAction("buttonGenerateCode"),Page.initAction("buttonExecuteCode"),Page.initAction("buttonTabsCheckbox"),Page.initAction("buttonSmaller"),Page.initAction("buttonLarger"),Page.initAction("buttonSyncCode"),Page.initAction("buttonSyncDiagram"),Page.initAction("buttonToggleMethods"),Page.initAction("buttonToggleAttributes"),Page.initAction("buttonToggleActions"),Page.initAction("buttonToggleTraits"),Page.initAction("buttonToggleFeatureDependency"),Page.initAction("buttonToggleTransitionLabels"),Page.initAction("buttonToggleGuards"),Page.initAction("buttonToggleGuardLabels"),Page.initAction("buttonAllowPinch"),Page.initLabels(),Page.enablePaletteItem("buttonUndo",!1),Page.enablePaletteItem("buttonRedo",!1),Page.enablePaletteItem("buttonSyncDiagram",!1),Page.enablePaletteItem("buttonAddTransition",!1),jQuery("#genstatus").hide(),jQuery("#buttonViewComplete").hide(),Page.initExamples(),Page.initOptions(),Page.readOnly&&(jQuery("#mainDrawMenu").hide(),jQuery(".layoutListItem").hide(),jQuery("#preferencesTitle").hide(),jQuery("#ttPhotoReady").hide(),jQuery("#ttManualSync").hide(),jQuery("#canvasSizeTitle").hide(),jQuery("#buttonSmaller").hide(),jQuery("#buttonLarger").hide(),jQuery("#menuBookmarkable").hide()),(Page.readOnly||!Layout.isPaletteVisible)&&jQuery("#topBookmarkable").hide(),Layout.isPaletteVisible||jQuery("#paletteColumn").hide(),Layout.isTextVisible||(Page.readOnly?jQuery("#topLine").hide():jQuery("#linetext").hide()),jQuery("#inputGenerateCode").on("change",function(){this.value.split(":")[1]==="Java"||this.value.split(":")[1]==="Python"?jQuery("#buttonExecuteCode").show():jQuery("#buttonExecuteCode").hide()})},Page.initOptions=function(){jQuery("#buttonShowHideLayoutEditor").prop("checked",Layout.isLayoutVisible),jQuery("#buttonShowHideTextEditor").prop("checked",Layout.isTextVisible),jQuery("#buttonShowHideCanvas").prop("checked",Layout.isDiagramVisible),jQuery("#buttonTabsCheckbox").prop("checked",!1),jQuery("#tabRow").hide(),jQuery("#ttTabsCheckbox").hide(),jQuery("#buttonToggleAttributes").prop("checked",!0),jQuery("#buttonToggleActions").prop("checked",!0),jQuery("#buttonToggleTransitionLabels").prop("checked",!1),jQuery("#buttonToggleGuards").prop("checked",!0),jQuery("#buttonToggleGuardLabels").prop("checked",!1),jQuery("#buttonToggleTraits").prop("checked",Page.showTraits),jQuery("#buttonToggleFeatureDependency").prop("checked",!1),jQuery("#buttonAllowPinch").prop("checked",!1),Page.useEditableClassDiagram&&jQuery("#buttonShowEditableClassDiagram").prop("checked",!0),Page.useJointJSClassDiagram&&jQuery("#buttonShowJointJSClassDiagram").prop("checked",!0),Page.useGvClassDiagram&&jQuery("#buttonShowGvClassDiagram").prop("checked",!0),Page.useGvFeatureDiagram&&jQuery("#buttonShowGvFeatureDiagram").prop("checked",!0),Page.useGvStateDiagram&&jQuery("#buttonShowGvStateDiagram").prop("checked",!0),Page.useStructureDiagram&&jQuery("#buttonShowStructureDiagram").prop("checked",!0),jQuery("#buttonPhotoReady").prop("checked",!1),jQuery("#buttonManualSync").prop("checked",!1),jQuery("#buttonShowHideTextEditor").prop("disabled",!1),jQuery("#buttonShowHideCanvas").prop("disabled",!1),jQuery("#buttonPhotoReady").prop("disabled",!1),jQuery("#buttonManualSync").prop("disabled",!1)},Page.initHighlighter=function(e){var t="#"+e;jQuery(t).mouseover(function(){Page.highlightItem(e)}),jQuery(t).mouseout(function(){Page.unhighlightItem(e)})},Page.removeHighlighter=function(e){var t="#"+e;jQuery(t).unbind("mouseover"),jQuery(t).unbind("mouseout")},Page.enableCheckBoxItem=function(e,t,n){var r=jQuery("#"+t),o=jQuery("#"+e);n?(o.prop("disabled",!1),o.css("cursor","pointer"),r.css("color","Black")):(o.prop("disabled",!0),o.css("cursor","not-allowed"),r.css("color","Silver"))},Page.enablePaletteItem=function(e,t){var n=jQuery("#"+e),r=!n.hasClass("disabled");r!=t&&(t?(n.removeClass(),n.prop("disabled",!0),Page.initHighlighter(e)):(n.removeClass(),n.addClass("disabled"),n.prop("disabled",!1),Page.removeHighlighter(e)))},Page.initToggleTool=function(e){var t=jQuery("#"+e);t.unbind().click(function(){Page.toggleToolItem(e,!1)}),t.dblclick(function(){Page.toggleToolItem(e,!0)})},Page.removeToggleTool=function(e){var t=jQuery("#"+e);t.unbind("click"),t.unbind("dblclick")},Page.initJQueryButton=function(e){var t="#"+e,n=jQuery(t).attr("value");jQuery(t).button({label:n,className:"jQuery-palette-button"})},Page.initAction=function(e){var t="#"+e;jQuery(t).click(Action.clicked)},Page.initLabels=function(){for(var e=jQuery(".buttonExtend"),t=0,n=e.length;t<n;t++)Page.initLabel(jQuery(e[t]).prop("id"))},Page.initLabel=function(e){var t="#"+e;jQuery(t).click((function(n){return function(){jQuery("#"+jQuery(n).prop("id").replace("label","button")).trigger("click")}})(t))},Page.initUmpleTextArea=function(){var e=jQuery("#newEditor"),t=jQuery("#umpleLayoutEditorText");e.keyup(function(n){Action.freshLoad=!1,Action.umpleTyped(n)}),e.mousedown(function(){setTimeout('jQuery("#linenum").val(Action.getCaretPosition())',25)}),t.keyup(function(n){Action.freshLoad=!1,Action.setjustUpdateNowtoSaveLater(!1),Action.umpleCodeMirrorTypingActivity("layoutEditor")}),e.focusin(function(){Action.focusOn("umpleModelEditorText",!0)}),t.focus(function(){Action.focusOn("umpleLayoutEditorText",!0)}),e.focusout(function(){Action.focusOn("umpleModelEditorText",!1)}),t.blur(function(){Action.focusOn("umpleLayoutEditorText",!1)}),Page.initCodeMirrorEditor(),Layout.initUmpleTextAreaSize(),Layout.isTextVisible||Layout.showHideTextEditor(!1),Layout.isLayoutVisible||Layout.showHideLayoutEditor(!1)},Page.initCodeMirrorEditor=function(){const e=[{key:"Ctrl-E",run:function(){Page.clickShowEditableClassDiagram()}},{key:"Ctrl-J",run:function(){Page.clickShowJointJSClassDiagram()}},{key:"Ctrl-G",run:function(){Page.clickShowGvClassDiagram()}},{key:"Ctrl-S",run:function(){Page.clickShowGvStateDiagram()}},{key:"Ctrl-L",run:function(){Page.clickShowStructureDiagram()}},{key:"Ctrl-T",run:function(){Page.clickShowHideText()}},{key:"Shift-Ctrl-Alt-T",run:function(){Page.clickShowHideText()}},{key:"Ctrl-D",run:function(){Page.clickShowHideCanvas()}},{key:"Ctrl-N",run:function(){Page.clickShowHideMenu()}},{key:"trl-Alt-N",run:function(){Page.clickShowHideMenu()}},{key:"Ctrl-Shift-=",run:function(){Page.clickButtonlarger()}},{key:"Ctrl-Shift--",run:function(){Page.clickButtonSmaller()}},{key:"Shift-Ctrl-A",run:function(){Page.clickToggleAttributes()}},{key:"Ctrl-M",run:function(){Page.clickToggleMethods()}},{key:"Ctrl-R",run:function(){Page.clickToggleTraits()}},{key:"Ctrl-I",run:function(){Page.clickToggleTransitionLabels()}},{key:"Ctrl-K",run:function(){Page.clickToggleGuardLabels()}},{key:"Ctrl-O",run:function(){Page.copyCommandLineCode()}},{key:"Ctrl-B",run:function(){Page.promptAndExecuteTest()}},{key:"Esc",run:function(n){n.getInputField().blur()}}],t=cm6.createEditorState(document.getElementById("newEditor").value,{extensions:[]});Page.codeMirrorEditor6=cm6.createEditorView(t,document.getElementById("newEditor")),Page.codeMirrorEditor6.dispatch({effects:cm6.StateEffect.appendConfig.of(cm6.changeListenerPlugin)}),Page.readOnly&&Page.codeMirrorEditor6.dispatch({effects:cm6.editableCompartment.reconfigure(cm6.EditorView.editable.of(!1))}),Page.setCodeMirror6Text=function(n){Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:n}})},Page.codeMirrorEditor6.dom.addEventListener("mousedown",function(){Action.umpleCodeMirrorCursorActivity()}),Page.codeMirrorOn=!0},Page.setDiagramTypeIconState=function(e){for(buttonList=["ECD_button","GCD_button","SD_button"],i=0,l=buttonList.length;i<l;++i)document.getElementById(buttonList[i]).className="button2";switch(e){case"editableClass":document.getElementById("ECD_button").className="button2 active";break;case"GvClass":document.getElementById("GCD_button").className="button2 active";break;case"GvState":document.getElementById("SD_button").className="button2 active";break}},Page.setShowHideIconState=function(e){switch(e){case"SHT_button":Page.showText?document.getElementById(e).className="button2 active":document.getElementById(e).className="button2";break;case"SHD_button":Page.showCanvas?document.getElementById(e).className="button2 active":document.getElementById(e).className="button2";break;case"SHA_button":Page.showAttributes?document.getElementById(e).className="button2 active":document.getElementById(e).className="button2";break;case"SHM_button":Page.showMethods?document.getElementById(e).className="button2 active":document.getElementById(e).className="button2";break}},Page.clickShowEditableClassDiagram=function(){jQuery("#buttonShowEditableClassDiagram").trigger("click")},Page.clickShowJointJSClassDiagram=function(){jQuery("#buttonShowJointJSClassDiagram").trigger("click")},Page.clickShowGvClassDiagram=function(){jQuery("#buttonShowGvClassDiagram").trigger("click")},Page.clickShowGvStateDiagram=function(){jQuery("#buttonShowGvStateDiagram").trigger("click")},Page.clickShowGvFeatureDiagram=function(){jQuery("#buttonShowGvFeatureDiagram").trigger("click")},Page.clickShowStructureDiagram=function(){jQuery("#buttonShowStructureDiagram").trigger("click")},Page.clickShowHideText=function(){jQuery("#buttonShowHideTextEditor").trigger("click")},Page.clickShowHideCanvas=function(){jQuery("#buttonShowHideCanvas").trigger("click")},Page.clickShowHideMenu=function(){Layout.showHideMenu()},Page.clickButtonlarger=function(){jQuery("#buttonLarger").trigger("click")},Page.clickButtonSmaller=function(){jQuery("#buttonSmaller").trigger("click")},Page.clickToggleAttributes=function(){jQuery("#buttonToggleAttributes").trigger("click")},Page.clickToggleMethods=function(){jQuery("#buttonToggleMethods").trigger("click")},Page.clickToggleTraits=function(){jQuery("#buttonToggleTraits").trigger("click")},Page.clickToggleFeatureDependency=function(){jQuery("#buttonToggleFeatureDependency").trigger("click")},Page.clickToggleTransitionLabels=function(){jQuery("#buttonToggleTransitionLabels").trigger("click")},Page.clickToggleGuardLabels=function(){jQuery("#buttonToggleGuards").trigger("click")},Page.clickToggleGuardLabels=function(){jQuery("#buttonToggleGuardLabels").trigger("click")},Page.clickAllowPinch=function(){jQuery("#buttonAllowPinch").trigger("click")},Page.isPhotoReady=function(){if(Page.readOnly)return!0;var e="#buttonPhotoReady";return jQuery(e).prop("checked")},Page.initSourceCodeArea=function(){SyntaxHighlighter.config.clipboardSwf="scripts/clipboard.swf";var e="#generatedCodeRow";jQuery(e).hide()},Page.initCodeExecutionArea=function(){var e="#codeExecutionArea";jQuery(e).hide()},Page.showExecutionArea=function(){var e="#codeExecutionArea";jQuery(e).show()},Page.hideExecutionArea=function(){var e="#codeExecutionArea";jQuery(e).hide()},Page.hideGeneratedCode=function(){jQuery("#generatedCodeRow").hide(),jQuery("#innerGeneratedCodeRow").hide(),Page.useStructureDiagram||jQuery("#svgCanvas").hide()},Page.hideGeneratedCodeOnly=function(){jQuery("#generatedCodeRow").hide(),jQuery("#innerGeneratedCodeRow").hide()},Page.initCanvasArea=function(){var e=jQuery("#umpleCanvas");Layout.initUmpleCanvasSize(),e.click(function(t){Action.umpleCanvasClicked(t)}),e.mousemove(Action.mouseMove),e.focus(function(){Action.focusOn(Page.umpleCanvasId(),!0)}),e.blur(function(){Action.focusOn(Page.umpleCanvasId(),!1)}),e.delegate("[class$='editableDoubleClick']","dblclick",InlineEditor.handleOnClick),e.delegate("[class$='editableSingleClick']","click",InlineEditor.handleOnClick),Layout.isDiagramVisible||Layout.showHideCanvas(!1)},Page.setExamples=function(e){var t=e+".ump";jQuery("#inputExample").change(Action.loadExample),jQuery("#inputExample option").each(function(){if(this.value==t||this.value.startsWith("http")&&this.value.endsWith(t)){jQuery('#inputExample option[value = "'+t+'"]').attr("selected",!0);return}}),jQuery("#inputExampleType").change(Action.setExampleType),jQuery("#inputExample2").change(Action.loadExample),jQuery("#inputExample2 option").each(function(){if(this.value==t||this.value.startsWith("http")&&this.value.endsWith(t)){jQuery('#inputExample2 option[value = "'+t+'"]').attr("selected",!0);return}}),jQuery("#inputExample3").change(Action.loadExample),jQuery("#inputExample3 option").each(function(){if(this.value==t||this.value.startsWith("http")&&this.value.endsWith(t)){jQuery('#inputExample3 option[value = "'+t+'"]').attr("selected",!0);return}}),jQuery("#inputExample4").change(Action.loadExample),jQuery("#inputExample4 option").each(function(){if(this.value==t||this.value.startsWith("http")&&this.value.endsWith(t)){jQuery('#inputExample4 option[value = "'+t+'"]').attr("selected",!0);return}}),jQuery("#inputExample5").change(Action.loadExample),jQuery("#inputExample5 option").each(function(){if(this.value==t||this.value.startsWith("http")&&this.value.endsWith(t)){jQuery('#inputExample5 option[value = "extraExamples1/'+t+'"]').attr("selected",!0);return}})},Page.initExamples=function(){jQuery("#inputExample").change(Action.loadExample),jQuery("#defaultExampleOption").attr("selected",!0),jQuery("#inputExampleType").change(Action.setExampleType),jQuery("#inputExample2").change(Action.loadExample),jQuery("#defaultExampleOption2").attr("selected",!0),jQuery("#inputExample3").change(Action.loadExample),jQuery("#defaultExampleOption3").attr("selected",!0),jQuery("#inputExample4").change(Action.loadExample),jQuery("#defaultExampleOption4").attr("selected",!0),jQuery("#inputExample5").change(Action.loadExample),jQuery("#defaultExampleOption5").attr("selected",!0),jQuery("#inputExample6").change(Action.loadExample),jQuery("#defaultExampleOption6").attr("selected",!0),jQuery("#inputExample7").change(Action.loadExample),jQuery("#defaultExampleOption7").attr("selected",!0),jQuery("#inputExample8").change(Action.loadExample),jQuery("#defaultExampleOption8").attr("selected",!0),Page.useStructureDiagram?(jQuery("#structureModels").prop("selected",!0),jQuery("#itemLoadExamples").hide(),jQuery("#itemLoadExamples2").hide(),jQuery("#itemLoadExamples4").hide(),jQuery("#itemLoadExamples5").hide(),jQuery("#itemLoadExamples6").hide(),jQuery("#itemLoadExamples7").hide(),jQuery("#itemLoadExamples8").hide()):Page.useGvStateDiagram?(jQuery("#smModels").prop("selected",!0),jQuery("#itemLoadExamples").hide(),jQuery("#itemLoadExamples3").hide(),jQuery("#itemLoadExamples4").hide(),jQuery("#itemLoadExamples5").hide(),jQuery("#itemLoadExamples6").hide(),jQuery("#itemLoadExamples7").hide(),jQuery("#itemLoadExamples8").hide()):Page.useGvFeatureDiagram?(jQuery("#featureModels").prop("selected",!0),jQuery("#itemLoadExamples").hide(),jQuery("#itemLoadExamples2").hide(),jQuery("#itemLoadExamples3").hide(),jQuery("#itemLoadExamples5").hide(),jQuery("#itemLoadExamples6").hide(),jQuery("#itemLoadExamples7").hide(),jQuery("#itemLoadExamples8").hide()):(jQuery("#cdModels").prop("selected",!0),jQuery("#itemLoadExamples2").hide(),jQuery("#itemLoadExamples3").hide(),jQuery("#itemLoadExamples4").hide(),jQuery("#itemLoadExamples5").hide(),jQuery("#itemLoadExamples6").hide(),jQuery("#itemLoadExamples7").hide(),jQuery("#itemLoadExamples8").hide())},Page.highlightItem=function(e){var t="#"+e;jQuery(t).addClass("highlight")},Page.unhighlightItem=function(e){var t="#"+e;jQuery(t).removeClass("highlight")},Page.enableDiagram=function(e){Page.enableEditDragAndResize(e),Page.enablePaletteItem("buttonAddClass",e),Page.enablePaletteItem("buttonAddAssociation",e),Page.enablePaletteItem("buttonAddGeneralization",e),Page.enablePaletteItem("buttonDeleteEntity",e),Page.showDiagramSyncNeeded(!e)},Page.enableTransition=function(e){Page.enablePaletteItem("buttonAddTransition",e),Page.enablePaletteItem("buttonAddAssociation",!e)},Page.enableEditDragAndResize=function(e){e?(jQuery("span.editable").removeClass("uneditable"),jQuery("div.umpleClass").removeClass("unselectable"),jQuery("div.umpleClass.ui-draggable").draggable({disabled:!1})):(jQuery("span.editable").addClass("uneditable"),jQuery("div.umpleClass").addClass("unselectable"),jQuery("div.umpleClass.ui-draggable").draggable({disabled:!0}),jQuery(":text").blur())},Page.toggleToolItem=function(e,t){t==null&&(t=!1),Page.repeatToolItem=t;var n=e.substring(6),r=n!=Page.selectedItem;r?Page.selectToggleTool(n):Page.unselectAllToggleTools()},Page.unselectAllToggleTools=function(){var e=!1,t=!1;t=DiagramEdit.removeNewClass(),t&&(e=!0),t=DiagramEdit.removeNewAssociation(),t&&(e=!0),t=DiagramEdit.removeNewTransition(),t&&(e=!0),t=DiagramEdit.removeNewGeneralization(),t&&(e=!0);var n="ul.toggle li.selected";return jQuery(n).removeClass("selected highlight"),setTimeout("Page.enableEditDragAndResize(true);",500),Page.selectedItem=null,Page.repeatToolItem=!1,e},Page.selectToggleTool=function(e){Page.selectedItem!=null&&(DiagramEdit.removeNewClass(),DiagramEdit.removeNewAssociation(),DiagramEdit.removeNewTransition(),DiagramEdit.removeNewGeneralization()),Page.enableEditDragAndResize(!1),Page.selectedItem=e,Action.unselectAll();var t=format("ul.toggle li.selected"),n="#button"+e;jQuery(t).removeClass("selected highlight"),jQuery(n).addClass("selected")},Page.canShowHovers=function(){return Page.selectedItem==null||Page.selectedItem=="DeleteEntity"},Page.getRawUmpleCode=function(){return document.getElementById("umpleModelEditorText").value},Page.getRawUmpleCodeCM6=function(){return Page.codeMirrorEditor6.state.doc.toString()},Page.getUmpleCode=function(){var e=Page.getRawUmpleCodeCM6().replace(Page.modelDelimiter,""),t=jQuery("#umpleLayoutEditorText").val().replace(Page.modelDelimiter,"");t!==""&&!t.includes("namespace -;")&&(t=`
`,c=a.substr(0,a.length-1)+d;Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:Page.codeMirrorEditor6.state.doc.toString().replace(a,c)}}),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate");let f=document.getElementsByClassName("node");for(let C=0;C<f.length;C++)f[C].removeEventListener("mousedown",o)})},Action.getGvClassName=function(e){return Action.getGvClassNameFromNode(e.target)},Action.getGvClassNameFromNode=function(e){for(;e.parentElement.id!="graph0";)e=e.parentNode;return e=e.outerHTML.substr(e.outerHTML.indexOf("&nbsp;"),e.outerHTML.indexOf("</text>")-e.outerHTML.indexOf("&nbsp;")).replaceAll("&nbsp;","").trim(),e},Action.displayMenu=function(e){if(Action.diagramInSync){Action.removeContextMenu();var t=Action.getGvClassName(e),r=Page.codeMirrorEditor6.state.doc.toString(),a=Action.splitStates(r);for(let R=0;R<a.length;R++)(a[R].startsWith("class "+t+"{")||a[R].startsWith("class "+t+" ")||a[R].startsWith("class "+t+`
`))&&(a=a[R]);if(typeof a=="string"){var n=document.createElement("customContextMenu"),o=["Add Attribute","Rename Class","Delete Class","Add Subclass","Add Association","Change Color","Filter Class","Hide Class"],u=a.replaceAll(`
`,"&#10").replaceAll('"',"&#$quot"),s=['Action.drawInput("attri","'+u+'","'+t+'")','Action.drawInput("rename","'+u+'","'+t+'")','Action.deleteClass("'+u+'","'+t+'")','Action.drawInput("subclass","'+u+'","'+t+'")','Action.addAssociationGv("'+u+'","'+t+'")','Action.drawInput("color","'+u+'","'+t+'")','Action.filterOnOneClass("'+t+'")','Action.hideClass("'+t+'")'],d=jQuery("#umpleLayoutEditorText").val(),c=[],f=[],C=document.getElementsByClassName("node");for(let R=0;R<C.length;R++){var m=Action.getGvClassNameFromNode(C[R]);c.push(m)}var E=Action.neighbors[t];f=E.filter(R=>!c.includes(R)),f.length>0&&(o.push("Show Associations to:"),s.push('Action.drawInput("assoc",null,null,'+JSON.stringify(f)+")")),Page.filterWordsOutput.length>0&&Page.filterWordsOutput.split("!@").forEach(function(R){R.toLowerCase()==t.toLowerCase()&&(o=o.filter(g=>!g.includes("Filter Class")),o.push("Remove Filter"),s=s.filter(g=>!g.includes("Action.filterOnOneClass")),s.push('Action.clearFilterOnOneClass("'+t+'")'),o=o.filter(g=>!g.includes("Hide Class")),s=s.filter(g=>!g.includes("Action.hideClass"))),R.includes("~")&&(o.includes("Unhide Class(es)")||(o.push("Unhide Class(es)"),s.push("Action.unHideClasses()")))}),n.style.zIndex="1000",n.style.border="1px solid #ccc",n.style.backgroundColor="#f8f8f8",n.style.padding="5px",n.style.position="fixed";for(var S=0;S<o.length;S++){var P=document.createElement("div");P.style.padding="5px",P.style.borderRadius="3px",P.style.cursor="pointer",P.style.transition="background-color 0.3s",P.textContent=o[S],P.setAttribute("onclick","javascript:"+s[S]),P.addEventListener("mouseover",function(){this.style.backgroundColor="#ddd"}),P.addEventListener("mouseout",function(){this.style.backgroundColor="transparent"}),n.appendChild(P)}var N=n.getBoundingClientRect();e.clientX+N.width>window.innerWidth?n.style.right=window.innerWidth-e.clientX+"px":n.style.left=e.clientX+"px",e.clientY+N.height>window.innerHeight?n.style.bottom=window.innerHieght-e.clientY+"px":n.style.top=e.clientY+"px",document.addEventListener("mousedown",function R(g){var v=document.getElementById("promptBox");g.target!=n&&!n.contains(g.target)&&(v!=null&&g.target!=v&&v.contains(g.target),document.removeEventListener("mousedown",R),Action.removeContextMenu())}),document.body.appendChild(n)}}},Action.isWithinRadarZone=function(e,t,r,a=100){var n=Action.getGvPosition(e,t),o=Action.getGvClassNameFromNode(r),u=Action.getGvPosition(e,o);const s=Math.abs(u.x-n.x)<=a,d=Math.abs(u.y-n.y)<=a;return s&&d},Action.displayAssociMenu=function(e,t){const r=/Action\.selectAssociation\('([^']+)'\)/,a=t.match(r);let n=Action.selectAssociation(a[1]);var o=a[1].split(",");if(o.length==4)var u=o[1].trim(),s=o[0].trim(),d=o[2].split(" "),c=o[3].split(" ");else var u=o[1].trim(),d=o[2].split(" "),c=o[2].split(" "),s=o[0].trim();var f=new RegExp("(associationClass|class|interface|trait) "+s+"($|\\s|[{])"),C=new RegExp("(class|interface|trait) [A-Za-z]");if(Page.codeMirrorOn){var m=Action.selectItemCM6(f),E=Page.codeMirrorEditor6.state.sliceDoc(m.startIndex,m.endIndex);clientDebuggerFlag&&console.warn("classCode: "+E)}var S=E.replaceAll(`
`,"&#10").replaceAll('"',"&#$quot");let P=1,N=n.startIndex,R=n.endIndex;var g=Page.codeMirrorEditor6.state.sliceDoc(N,R);clientDebuggerFlag&&console.warn("selectedText: "+g),g.includes(d[0].trim())==!1&&(P=3);var v=document.createElement("customContextMenu"),M=P===3?["Alter "+s+" multiplicity","Alter "+s+" role name","Alter "+u+" role name"]:["Alter "+s+" multiplicity","Alter "+s+" role name","Alter "+u+" multiplicity","Alter "+u+" role name","Delete the association"],L=P===3?['Action.modifyMultiplicity("'+S+'","'+g+'","'+c[0]+'","0")','Action.modifyRoleName("'+S+'","'+g+'","'+c[1]+'","'+c[0]+'","0")','Action.modifyRoleName("'+S+'","'+g+'","'+d[1]+'","'+c[0]+'","1")']:['Action.modifyMultiplicity("'+S+'","'+g+'","'+c[0]+'","0")','Action.modifyRoleName("'+S+'","'+g+'","'+c[1]+'","'+c[0]+'","0")','Action.modifyMultiplicity("'+S+'","'+g+'","'+d[0]+'","'+P+'")','Action.modifyRoleName("'+S+'","'+g+'","'+d[1]+'","'+c[0]+'","1")','Action.deleteAssociation("'+S+'","'+g+'")'];v.style.zIndex="1000",v.style.border="1px solid #ccc",v.style.backgroundColor="#f8f8f8",v.style.padding="5px",v.style.position="fixed";for(var T=0;T<M.length;T++){var A=document.createElement("div");A.style.padding="5px",A.style.borderRadius="3px",A.style.cursor="pointer",A.style.transition="background-color 0.3s",A.textContent=M[T],A.setAttribute("onclick","javascript:"+L[T]),A.addEventListener("mouseover",function(){this.style.backgroundColor="#ddd"}),A.addEventListener("mouseout",function(){this.style.backgroundColor="transparent"}),v.appendChild(A)}var j=v.getBoundingClientRect();e.clientX+j.width>window.innerWidth?v.style.right=window.innerWidth-e.clientX+"px":v.style.left=e.clientX+"px",e.clientY+j.height>window.innerHeight?v.style.bottom=window.innerHieght-e.clientY+"px":v.style.top=e.clientY+"px",document.addEventListener("keydown",function k(U){var _=document.getElementById("promptBox");U.target!=v&&!v.contains(U.target)&&U.key==="Escape"&&(_!=null&&U.target!=_&&_.contains(U.target),document.removeEventListener("keydown",k),Action.removeContextMenu())}),document.addEventListener("mousedown",function k(U){var _=document.getElementById("promptBox");U.target!=v&&!v.contains(U.target)&&(_!=null&&U.target!=_&&_.contains(U.target),document.removeEventListener("mousedown",k),Action.removeContextMenu())}),document.body.appendChild(v)},Action.validateMultiplicity=function(e){if(!e)return!1;if(e==="*"||e.match(/^\d+$/))return!0;if(e.match(/^(\d+|\*)\.\.(\d+|\*)$/)){const t=e.split(".."),r=t[0],a=t[1];if(r==="*"||a==="*"){if(r==="0"||r.match(/^\d+$/)&&r!=="0")return!0}else{const n=parseInt(r,10),o=parseInt(a,10);if(n<=o)return!0}}return!1},Action.modifyMultiplicity=function(e,t,r,a){let n=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"');if(a==1)var o=!0;else if(a==3){Page.setFeedbackMessage(" unable to change end multiplicity for associationClass ");return}else var o=!1;var u=document.createElement("div");u.style.zIndex="1000",u.style.border="1px solid #ccc",u.style.backgroundColor="#f8f8f8",u.style.padding="5px",u.style.position="absolute",u.style.left="50%",u.style.top="50%",u.style.transform="translate(-50%, -50%)",u.id="promptBox";var s=document.createElement("input");s.type="text",s.value=r,s.style.padding="5px",s.style.margin="5px",s.style.width="200px";var d=document.createElement("button");d.textContent="Change",d.style.padding="5px",d.style.marginLeft="5px";var c=document.createElement("label");c.type="label",c.style.color="red",c.textContent="Please enter a valid multiplicity format (e.g., '*', '1', '0..1', '1..*', '2..5').",u.appendChild(s),u.appendChild(d),document.body.appendChild(u),s.focus();var f=function C(m){document.contains(u)&&m.target!=u&&!u.contains(m.target)&&(document.removeEventListener("mousedown",C),u.remove())};document.addEventListener("mousedown",f),document.addEventListener("keydown",function(C){C.key==="Escape"&&(u.remove(),document.removeEventListener("keydown",arguments.callee))}),d.addEventListener("click",function(){if(Action.validateMultiplicity(s.value.trim())){var C=r.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&");let m;if(o){const S=t.split(new RegExp(C));S.length===3?m=S[0]+r.trim()+S[1]+s.value.trim()+S[2]:S.length===2&&(m=S[0]+s.value.trim()+S[1])}else m=t.replace(new RegExp(C),s.value.trim());let E=Page.codeMirrorEditor6.state.doc.toString();if(n.includes(t)==!1)E=E.replace(t,m);else{let S=n;S=S.replace(t,m),E=E.replace(n,S)}Page.setCodeMirror6Text(E),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate"),u.remove(),Action.selectMatchingText(m)}else s.focus(),u.appendChild(c)}),s.addEventListener("keydown",function(C){C.key==="Enter"&&(C.preventDefault(),C.stopPropagation(),d.click())})},Action.modifyRoleName=function(e,t,r,a,n){let o=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"');if(n==1)var u=!0;else var u=!1;var s=document.createElement("div");s.style.zIndex="1000",s.style.border="1px solid #ccc",s.style.backgroundColor="#f8f8f8",s.style.padding="5px",s.style.position="absolute",s.style.left="50%",s.style.top="50%",s.style.transform="translate(-50%, -50%)",s.id="promptBox";var d=document.createElement("input");d.type="text",d.value=r,d.style.padding="5px",d.style.margin="5px",d.style.width="200px";var c=document.createElement("button");c.textContent="Change",c.style.padding="5px",c.style.marginLeft="5px";var f=document.createElement("label");f.type="label",f.style.color="red",f.textContent="To add a role name at this end there must be a role name at the other end first",s.appendChild(d),s.appendChild(c),document.body.appendChild(s),d.focus();var C=function m(E){document.contains(s)&&E.target!=s&&!s.contains(E.target)&&(document.removeEventListener("mousedown",m),s.remove())};document.addEventListener("mousedown",C),document.addEventListener("keydown",function(m){m.key==="Escape"&&(s.remove(),document.removeEventListener("keydown",arguments.callee))}),c.addEventListener("click",function(){var m=d.value.trim();if(r==""){var E=/(\s*<-\s*|\s*><\s*|\s*--\s*|\s*->\s*|\s*<@>-\s*|\s*-\s*<@>\s*)/,S=t.split(E),P=S[0].trim(),N,R,g;if(S.length>2){var v=S[2].trim();if(u)if(v.includes("sorted")){var M=v.split("sorted"),L=v.split(";");R=M[0].trim()+" "+m+"sorted"+M[1]}else{var L=v.split(";");R=L[0].trim()+" "+m+";"}else if(o.includes(t)==!1?N=P.trim()+" "+m:N=a.trim()+" "+m,P.includes("sorted")){var T=P.split("sorted");N=a.trim()+" "+m+"sorted"+T[1]}g=u?P+S[1]+R:N+S[1]+v}else if(S=t.split(";")[0].split(" "),u==!1)if(N=a.trim()+" "+m,S.length>2)g=N+" "+S[1].trim()+" "+S[2].trim()+";";else{d.focus(),s.appendChild(f);return}else L=t.split(";"),g=L[0].trim()+" "+m+";"}else g=t.replace(r,m);let A=Page.codeMirrorEditor6.state.doc.toString();if(o.includes(t)==!1)A=A.replace(t,g);else{let j=o;j=j.replace(t,g),A=A.replace(o,j)}Page.setCodeMirror6Text(A),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate"),s.remove(),Action.selectMatchingText(g)}),d.addEventListener("keydown",function(m){m.key==="Enter"&&(m.preventDefault(),m.stopPropagation(),c.click())})},Action.deleteAssociation=function(e,t){let r=Page.codeMirrorEditor6.state.doc.toString(),a=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"');if(a.includes(t)==!1)r=r.replace(t,"");else{let n=a;n=n.replace(t,""),r=r.replace(a,n)}Page.setCodeMirror6Text(r),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate")},Action.displayAttributeMenu=function(e,t,r){if(Action.diagramInSync){Action.removeContextMenu();var a=e.target;for(t=t.trim();a.parentElement.id!="graph0";)a=a.parentNode;a=a.outerHTML.substr(a.outerHTML.indexOf("&nbsp;"),a.outerHTML.indexOf("</text>")-a.outerHTML.indexOf("&nbsp;")).replaceAll("&nbsp;","").trim();var n=Page.codeMirrorEditor6.state.doc.toString(),o=Action.splitStates(n);for(let S=0;S<o.length;S++)(o[S].startsWith("class "+a+"{")||o[S].startsWith("class "+a+" ")||o[S].startsWith("class "+a+`
`))&&(o=o[S]);if(typeof o=="string"){var u=document.createElement("customContextMenu"),s=document.createElement("div");s.textContent="Attribute: "+t+"Type: "+r,s.style.padding="5px",s.style.borderBottom="1px solid #ccc",s.style.fontWeight="bold",u.appendChild(s);var d=["Rename Attribute","Change Type","Delete Attribute"],c=o.replaceAll(`
`,"&#10").replaceAll('"',"&#$quot"),f=['Action.renameAttribute("'+c+'","'+a+'","'+t+'","'+r+'")','Action.changeAttributeType("'+c+'","'+a+'","'+t+'","'+r+'")','Action.deleteAttribute("'+c+'","'+a+'","'+t+'","'+r+'")'];u.style.zIndex="1000",u.style.border="1px solid #ccc",u.style.backgroundColor="#f8f8f8",u.style.padding="5px",u.style.position="fixed";for(var C=0;C<d.length;C++){var m=document.createElement("div");m.style.padding="5px",m.style.borderRadius="3px",m.style.cursor="pointer",m.style.transition="background-color 0.3s",m.textContent=d[C],m.setAttribute("onclick","javascript:"+f[C]),m.addEventListener("mouseover",function(){this.style.backgroundColor="#ddd"}),m.addEventListener("mouseout",function(){this.style.backgroundColor="transparent"}),u.appendChild(m)}var E=u.getBoundingClientRect();e.clientX+E.width>window.innerWidth?u.style.right=window.innerWidth-e.clientX+"px":u.style.left=e.clientX+"px",e.clientY+E.height>window.innerHeight?u.style.bottom=window.innerHeight-e.clientY+"px":u.style.top=e.clientY+"px",document.addEventListener("keydown",function S(P){var N=document.getElementById("promptBox");P.target!=u&&!u.contains(P.target)&&P.key==="Escape"&&(N!=null&&P.target!=N&&N.contains(P.target),document.removeEventListener("keydown",S),Action.removeContextMenu())}),document.addEventListener("mousedown",function S(P){P.target!=u&&!u.contains(P.target)&&(document.removeEventListener("mousedown",S),Action.removeContextMenu())}),document.body.appendChild(u)}}},Action.renameAttribute=function(e,t,r,a){var n=document.createElement("div");n.style.zIndex="1000",n.style.border="1px solid #ccc",n.style.backgroundColor="#f8f8f8",n.style.padding="5px",n.style.position="absolute",n.style.left="50%",n.style.top="50%",n.style.transform="translate(-50%, -50%)",n.id="promptBox";var o=document.createElement("input");o.type="text",o.value=r,o.style.padding="5px",o.style.margin="5px",o.style.width="200px";var u=document.createElement("button");u.textContent="Rename",u.style.padding="5px",u.style.marginLeft="5px",n.appendChild(o),n.appendChild(u),document.body.appendChild(n),o.focus();var s=function d(c){document.contains(n)&&c.target!=n&&!n.contains(c.target)&&(document.removeEventListener("mousedown",d),n.remove())};document.addEventListener("mousedown",s),u.addEventListener("click",function(){if(Action.validateAttributeName(o.value.trim())){let d=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"'),c=d.includes(r+" :"),f=new RegExp("\\b"+r+"\\s*:\\s*\\w+\\s*;\\n?","g"),C=new RegExp("\\b"+r+"\\s*;\\n?","g"),m=c?a+" "+o.value.trim()+`;
`:o.value.trim()+`;
`,E=d;E=E.replace(f,m),E=E.replace(C,m);let S=new RegExp("\\b"+r+"\\b","g");E=E.replace(S,o.value.trim());let P=Page.codeMirrorEditor6.state.doc.toString();P=P.replace(d,E),Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:P}}),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate"),document.removeEventListener("mousedown",s),n.remove()}})},Action.changeAttributeType=function(e,t,r,a){var n=document.createElement("div");n.style.zIndex="1000",n.style.border="1px solid #ccc",n.style.backgroundColor="#f8f8f8",n.style.padding="5px",n.style.position="absolute",n.style.left="50%",n.style.top="50%",n.style.transform="translate(-50%, -50%)",n.id="promptBox";var o=document.createElement("select");["String","Integer","Double","Float","Boolean","Date","Time"].forEach(function(d){var c=document.createElement("option");c.value=d,c.text=d,d===a&&(c.selected=!0),o.appendChild(c)});var u=document.createElement("button");u.textContent="Change Type",u.style.padding="5px",u.style.margin="5px",n.appendChild(o),n.appendChild(u),document.body.appendChild(n),o.focus();var s=function d(c){document.contains(n)&&c.target!=n&&!n.contains(c.target)&&(document.removeEventListener("mousedown",d),n.remove())};document.addEventListener("mousedown",s),u.addEventListener("click",function(){var d=o.options[o.selectedIndex].value;if(d!==a){let c=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"'),f=c;if(a!="String"){let m=new RegExp("\\b"+a+"\\s"+r,"g");f=f.replace(m,d+" "+r)}else{let m=new RegExp("\\b"+a+"\\s"+r,"g"),E=new RegExp("\\b"+r,"g");f=f.replace(m,d+" "+r),f=f.replace(E,d+" "+r)}let C=Page.codeMirrorEditor6.state.doc.toString();C=C.replace(c,f),Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:C}}),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate"),document.removeEventListener("mousedown",s),n.remove()}else document.removeEventListener("mousedown",s),n.remove()})},Action.deleteAttribute=function(e,t,r,a){let n=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"'),o=new RegExp("\\b"+a+"\\s"+r+"\\s*;","g"),u=new RegExp("\\b"+r+"\\s*;\\n?","g"),s=n;s=s.replace(o,""),s=s.replace(u,"");let d=Page.codeMirrorEditor6.state.doc.toString();d=d.replace(n,s),Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:d}}),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate")},Action.classSelected=function(e){var t=Page.selectedClass,r=e;if(t!=null){Page.selectedClass=null,jQuery("#"+t.id).css("background-color","white");for(var a="#"+t.id+"_anchor",n=0;n<8;n++)jQuery(a+n).hide()}if(r!=null){jQuery("#umpleCanvas").addClass("unscrollable"),Page.selectedClass=UmpleSystem.find(r.id),jQuery("#"+r.id).css("background-color","#F3F6FB");for(var a="#"+r.id+"_anchor",o="#"+r.id+"_hover",n=0;n<8;n++)jQuery(a+n).show(),jQuery(o+n).hide()}else jQuery("#umpleCanvas").removeClass("unscrollable")},Action.classHover=function(e,t){var r=e.currentTarget;if(Action.diagramInSync&&!(Page.selectedClass!=null&&Page.selectedClass.id==r.id)){var a=t?"block":"none",n=jQuery("#"+r.id);if(t?n.css("background-color","#F3F6FB"):n.css("background-color","white"),Page.canShowHovers())for(var o=8,u="#"+r.id+"_hover",s=0;s<o;s++)t?jQuery(u+s).show():jQuery(u+s).hide()}},Action.unselectAll=function(){Action.classSelected(null),Action.associationSelected(null),Action.generalizationSelected(null),Action.transitionSelected(null)},Action.classClicked=function(e){if(Action.diagramInSync){Action.focusOn("umpleCanvas",!0),Action.focusOn("umpleModelEditorText",!1),Action.unselectAll(),Action.elementClicked=!0;var t=e.currentTarget;if(Action.selectClass(t.id),Page.selectedItem=="DeleteEntity")DiagramEdit.classDeleted(t.id);else if(Page.selectedItem=="AddAssociation")DiagramEdit.newAssociation==null?(Action.canCreateByDrag=!1,DiagramEdit.createAssociationPartOne(e)):(DiagramEdit.createAssociationPartTwo(e),setTimeout(function(){Action.canCreateByDrag=!0},500));else if(Page.selectedItem=="AddGeneralization")if(DiagramEdit.newGeneralization==null){var r=DiagramEdit.createGeneralizationPartOne(e);r&&(Action.canCreateByDrag=!1)}else DiagramEdit.createGeneralizationPartTwo(e),setTimeout(function(){Action.canCreateByDrag=!0},500);else Action.classSelected(t)}},Action.stateClicked=function(e){if(Action.diagramInSync){Action.focusOn("umpleCanvas",!0),Action.focusOn("umpleModelEditorText",!1);var t=e.split("^*^"),r=t[0],a=t[1],n=t[2].replace("Entry:","").replace("Exit:","");n=n.replace("Exit:",""),Action.unselectAll(),Action.elementClicked=!0;var o=null,u=null;if(n.includes(".")){clientDebuggerFlag&&console.log("stateClicked - nested state case"),n=n.split("."),u=Action.selectStateInClassCM6(r,a,n[0]);for(let s=1;s<n.length;s++)clientDebuggerFlag&&console.log("Iterating states within Identified state ..."),u=Action.selectStateInStateCM6(u.startIndex,u.endIndex,n[s])}else clientDebuggerFlag&&console.log("stateClicked - else - base case"),u=Action.selectStateInClassCM6(r,a,n),clientDebuggerFlag&&console.log("selectionIndiciesCM6: ",u);Action.highlightByIndexCM6(u.startIndex,u.endIndex),Page.selectedItem=="AddTransition"&&(DiagramEdit.newTransition==null?(Action.canCreateByDrag=!1,DiagramEdit.createTransitionPartOne(event)):(DiagramEdit.createTransitionPartTwo(event),setTimeout(function(){Action.canCreateByDrag=!0},500)))}},Action.associationClicked=function(e){if(Action.diagramInSync){Action.elementClicked=!0,Action.unselectAll();var t=e.currentTarget;Action.associationSelected(t)}},Action.transitionClicked=function(e){if(!Action.diagramInSync||typeof e=="string"&&e===null)return;Action.elementClicked=!0,Action.unselectAll();let t=e.split("*^*"),r=t[3].split(".");dest=t[4];var a=Action.selectStateInClassCM6(t[0],t[1],r[0]);dest=t[4].split(".");for(var n=1;n<r.length;n++)a=Action.selectStateInStateCM6(a.startIndex,a.endIndex,r[n]);let o=t[2].replaceAll("+","\\+").replaceAll("-","\\-").replaceAll("*","\\*").replaceAll("?","\\?").replaceAll("|","\\|");if(o=o.replace("after","after~`~?:Every`~`?"),t[5]!=""){let C=t[5].trim().replaceAll("+","\\+").replaceAll("-","\\-").replaceAll("*","\\*").replaceAll("?","\\?").replaceAll("|","\\|");o=o+"\\s*[\\s*"+C.trim().slice(1,C.trim().length-1)+"\\s*]"}o=o.replaceAll("]","\\]").replaceAll("[","\\[").replaceAll(")","\\)?").replaceAll("(","\\(?").replaceAll("~`~","(").replaceAll("`~`",")").replaceAll(" ","\\s*").replaceAll(",","\\s*,\\s*").replaceAll("!","\\s*!\\s*").replaceAll("/","\\s*/\\s*"),o=o.replaceAll("&&","&{1,2}");let u=new RegExp(o+".*->","s"),s=Page.codeMirrorEditor6.state.doc.toString().substr(a.startIndex,a.endIndex-a.startIndex).search(u)+a.startIndex,d=Page.codeMirrorEditor6.state.doc.toString().substr(s),c=Action.findEOL(d),f=s+c.length;Action.highlightByIndexCM6(s,f),c.split("->").length-1!==1&&Page.setFeedbackMessage("Please edit this complex transition in the textual code."),Action.highlightByIndexCM6(s,f)},Action.generalizationClicked=function(e){if(Action.diagramInSync){Action.elementClicked=!0,Action.unselectAll();var t=e.currentTarget;Action.generalizationSelected(t)}},Action.associationHover=function(e,t){if(Action.diagramInSync){var r=e.currentTarget,a=UmpleSystem.findAssociation(r.id);if(r!=null&&Page.canShowHovers())for(var n=2,o="#"+r.id+"_hover",u=0;u<n;u++)t?jQuery(o+u).show():jQuery(o+u).hide()}},Action.transitionHover=function(e,t){if(Action.diagramInSync){var r=e.currentTarget,a=UmpleSystem.findTransition(r.id);if(updateAssociation!=null&&Page.canShowHovers())for(var n=2,o="#"+updateAssociation.id+"_hover",u=0;u<n;u++)t?jQuery(o+u).show():jQuery(o+u).hide()}},Action.generalizationHover=function(e,t){if(Action.diagramInSync){var r=e.currentTarget;if(r!=null&&Page.canShowHovers())for(var a="#"+r.id+"_hover",n=0;n<3;n++)t?jQuery(a+n).show():jQuery(a+n).hide()}},Action.associationSelected=function(e){var t=e!=null,r=null;if(Page.selectedItem=="DeleteEntity"&&e!=null){var a=!1;DiagramEdit.associationDeleted(e.id,a);return}if(e!=null)Page.selectedAssociation=e,r=e;else if(Page.selectedAssociation!=null)r=Page.selectedAssociation,Page.selectedAssociation=null;else return;for(var n=2,o="#"+r.id+"_anchor",u=0;u<n;u++)t?jQuery(o+u).show():jQuery(o+u).hide()},Action.transitionSelected=function(e){var t=e!=null,r=null;if(Page.selectedItem=="DeleteEntity"&&e!=null){var a=!1;DiagramEdit.transitionDeleted(e.id,a);return}if(e!=null)Page.selectedTransition=e,r=e;else if(Page.selectedTransition!=null)r=Page.selectedTransition,Page.selectedTransition=null;else return;for(var n=2,o="#"+r.id+"_anchor",u=0;u<n;u++)t?jQuery(o+u).show():jQuery(o+u).hide()},Action.generalizationSelected=function(e){var t=e!=null,r=null;if(Page.selectedItem=="DeleteEntity"&&e!=null){var a=!1;DiagramEdit.generalizationDeleted(e.id,a);return}if(e!=null)Page.selectedGeneralization=e,r=e;else if(Page.selectedGeneralization!=null)r=Page.selectedGeneralization,Page.selectedGeneralization=null;else return;for(var n=3,o="#"+r.id+"_anchor",u=0;u<n;u++)t?jQuery(o+u).show():jQuery(o+u).hide()},Action.executeCode=function(e,t){var r="#buttonExecuteCode",a=t;jQuery(r).showLoading(),Action.ajax(function(n){Action.executeCodeCallback(n)},format("execute=true&language={0}&languageStyle={1}&model={2}",a,e,Page.getModel()),"true")},Action.generateCode=function(e,t){var r="#buttonGenerateCode",a=t,n;Page.getAdvancedMode()==0&&t==="Cpp"&&(a="Experimental-"+t),t==="StateTables"&&(n=StateTree.colourStateTables),t==="EventSequence"&&(n=StateTree.colourEventSequences),t==="stateDiagram"&&(a=t+"."+$("inputGenerateCode").value.split(":")[1]),jQuery(r).showLoading(),Action.ajax(function(o){Action.generateCodeCallback(o,e,n)},format("language={0}&languageStyle={1}",a,e),"true")},Action.photoReady=function(){var e="#"+Page.umpleCanvasId();Page.isPhotoReady()?jQuery(e).addClass("photoReady"):jQuery(e).removeClass("photoReady"),UmpleSystem.redrawCanvas()},Action.executeCodeCallback=function(e){var t="#buttonExecuteCode";jQuery(t).hideLoading(),Page.showExecutionArea(),Page.hideGeneratedCodeOnly(),Page.showExecutedResponse(e.responseText),window.location.href="#codeExecutionArea"},Action.generateCodeCallback=function(e,t,r){Page.showGeneratedCode(e.responseText,t),Page.hideExecutionArea(),Action.gentime=new Date().getTime(),r!==void 0&&r();var a="#buttonGenerateCode";jQuery(a).hideLoading(),Page.showCodeDone(),window.location.href="#genArea"},Action.classMouseDown=function(e){Action.canCreateByDrag&&(Page.selectedItem=="AddAssociation"&&DiagramEdit.newAssociation==null?DiagramEdit.createAssociationPartOne(e):Page.selectedItem=="AddGeneralization"&&DiagramEdit.newGeneralization==null?DiagramEdit.createGeneralizationPartOne(e):Page.selectedItem=="AddTransition"&&DiagramEdit.newTransition==null&&DiagramEdit.createTransitionPartOne(e))},Action.classMouseUp=function(e){Action.canCreateByDrag&&(Page.selectedItem=="AddAssociation"&&DiagramEdit.newAssociation!=null?DiagramEdit.createAssociationPartTwo(e):Page.selectedItem=="AddGeneralization"&&DiagramEdit.newGeneralization!=null?DiagramEdit.createGeneralizationPartTwo(e):Page.selectedItem=="AddTransition"&&DiagramEdit.newTransition!=null&&DiagramEdit.createTransitionPartTwo(e))},Action.mouseMove=function(e){Page.clickCount=0,Page.selectedItem=="AddClass"&&(DiagramEdit.newClass==null&&(DiagramEdit.newClass=new UmpleClass,DiagramEdit.newClass.name="",DiagramEdit.newClass.id="tempClass"),Action.drawClassOutline(e,DiagramEdit.newClass)),DiagramEdit.newAssociation!=null&&Page.selectedItem=="AddAssociation"&&Action.drawAssociationLine(e,DiagramEdit.newAssociation),DiagramEdit.newTransition!=null&&Page.selectedItem=="AddTransition"&&Action.drawTransitionLine(e,Diagramedit.newTransition),DiagramEdit.newGeneralization!=null&&Page.selectedItem=="AddGeneralization"&&Action.drawGeneralizationLine(e,DiagramEdit.newGeneralization)},Action.drawClassOutline=function(e,t){var r="#"+Page.umpleCanvasId(),a=new UmplePosition(e.pageX,e.pageY+1,0,0),n=a.subtract(UmpleSystem.position());t.position=new UmplePosition(n.x,n.y,UmpleClassFactory.defaultSize.width,UmpleClassFactory.defaultSize.height);var o=t.drawableClassOutline();jQuery(r).append(o);var u="#"+t.id,s=u+"_width",d=u+"_height",c=new Object;c.left=a.x,c.top=a.y,jQuery(u).offset(c),jQuery(s).width(t.position.width),jQuery(d).height(t.position.height)},Action.drawAssociationLine=function(e,t){var r="#"+Page.umpleCanvasId(),a=new UmplePosition(e.pageX,e.pageY,0,0);t.classTwoPosition=a.subtract(UmpleSystem.position()),jQuery(r).append(t.drawable())},Action.drawTransitionLine=function(e,t){var r="#"+Page.umpleCanvasId(),a=new UmplePosition(e.pageX,e.pageY,0,0);t.toStatePosition=a.subtract(UmpleSystem.position()),jQuery(r).append(t.drawable())},Action.drawGeneralizationLine=function(e,t){var r="#"+Page.umpleCanvasId(),a="#"+t.getElementId(),n=UmpleSystem.position(),o=e.pageX-5-n.x,u=e.pageY+5-n.y;t.parentPosition=new UmplePosition(o,u,0,0),jQuery(a).remove(),jQuery(r).append(t.drawable(!1))},Action.umpleCanvasClicked=function(e){if(Action.elementClicked){Action.elementClicked=!1;return}if(Page.selectedItem=="AddClass"){var t=new UmplePosition(Math.floor(e.pageX),Math.floor(e.pageY),0,0);DiagramEdit.addClass(t)}else Page.selectedItem=="AddAssociation"&&DiagramEdit.newAssociation!=null?Page.clickCount>1&&DiagramEdit.removeNewAssociation():Page.selectedItem=="AddTransition"&&DiagramEdit.newTransition!=null?Page.clickCount>1&&DiagramEdit.removeNewTransition():Page.selectedItem=="AddGeneralization"&&DiagramEdit.newGeneralization!=null?Page.clickCount>1&&DiagramEdit.removeNewGeneralization():Action.unselectAll()},Action.directUpdateCommandCallback=function(e){Action.updateUmpleTextCallback(e),Action.redrawDiagram()},Action.updateUmpleTextCallback=function(e){!justUpdatetoSaveLater&&!justUpdatetoSaveLaterForTextCallback&&(TabControl.getCurrentHistory().save(e.responseText,"TextCallback"),Page.setExampleMessage("")),Action.freshLoad=!0,Page.setUmpleCode(e.responseText,Action.update.codeChange),Page.hideLoading(),DiagramEdit.textChangeQueue.length==0?(Action.freshLoad=!1,DiagramEdit.pendingChanges=!1,Action.setjustUpdatetoSaveLater(!1),Action.setjustUpdatetoSaveLaterForTextCallback(!1)):(Action.setjustUpdatetoSaveLater(!0),Action.setjustUpdatetoSaveLaterForTextCallback(!0),DiagramEdit.doTextUpdate())},Action.setExampleType=function e(){jQuery("#itemLoadExamples").hide(),jQuery("#itemLoadExamples2").hide(),jQuery("#itemLoadExamples3").hide(),jQuery("#itemLoadExamples4").hide(),jQuery("#itemLoadExamples5").hide(),jQuery("#itemLoadExamples6").hide(),jQuery("#itemLoadExamples7").hide(),jQuery("#itemLoadExamples8").hide(),Page.getExampleType()=="cdModels"?(jQuery("#itemLoadExamples").show(),jQuery("#defaultExampleOption").prop("selected",!0)):Page.getExampleType()=="smModels"?(jQuery("#itemLoadExamples2").show(),jQuery("#defaultExampleOption2").prop("selected",!0)):Page.getExampleType()=="featureModels"?(jQuery("#itemLoadExamples4").show(),jQuery("#defaultExampleOption4").prop("selected",!0)):Page.getExampleType()=="extra1ModelsAD"?(jQuery("#itemLoadExamples5").show(),jQuery("#defaultExampleOption5").prop("selected",!0)):Page.getExampleType()=="extra1ModelsEL"?(jQuery("#itemLoadExamples6").show(),jQuery("#defaultExampleOption6").prop("selected",!0)):Page.getExampleType()=="extra1ModelsMP"?(jQuery("#itemLoadExamples7").show(),jQuery("#defaultExampleOption7").prop("selected",!0)):Page.getExampleType()=="extra1ModelsQZ"?(jQuery("#itemLoadExamples8").show(),jQuery("#defaultExampleOption8").prop("selected",!0)):(jQuery("#itemLoadExamples3").show(),jQuery("#defaultExampleOption3").prop("selected",!0))},Action.loadExample=function e(){var a=this.dataset.diagramType,t=jQuery(" option:selected",this);if(t.hasClass("openUmprOption")){location.href="http://umple.org/umpr?diagram-type="+a;return}UmpleSystem.merge(null),Page.showCanvasLoading(!0),Page.showModelLoading(!0),Page.showLayoutLoading(!0),Ajax.sendRequest("scripts/compiler.php",Action.loadExampleCallback,"exampleCode="+Page.getSelectedExample());var r=Page.getSelectedExample().slice(0,-4),a="";Page.useGvStateDiagram?a="&diagramtype=state":Page.useGvFeatureDiagram?a="&diagramtype=GvFeature":Page.useStructureDiagram?a="&diagramtype=structure&generateDefault=cpp":a="&diagramtype=GvClass";var n="#buttonLarger",o="#buttonSmaller",u="#"+Page.umpleCanvasId();umpleCanvasWidth=jQuery(u).width(),umpleCanvasHeight=jQuery(u).height();var s=Page.getSelectedExample();if(r.startsWith("https"))var d=r.split("/").pop(),c="?filename="+r.substr(8)+".ump"+a;else var d=r,c="?example="+d+a;setTimeout(function(){Page.setExampleMessage('<a href="'+c+'">URL for '+d+" example</a>")},3e3),jQuery("#inputExample").blur()},Action.loadExampleCallback=function(e){Action.freshLoad=!0,Action.setjustUpdatetoSaveLater(!0),Page.setUmpleCode(e.responseText,function(){Page.hideLoading(),Action.updateUmpleDiagram()}),Action.setCaretPosition("0"),Action.updateLineNumberDisplay(),TabControl.getCurrentHistory().save(e.responseText,"loadExampleCallback")},Action.customSizeTyped=function(){Action.oldTimeout!=null&&clearTimeout(Action.oldTimeout);var e=jQuery("#widthField").val(),t=jQuery("#heightField").val();Action.oldTimeout=setTimeout(function(){Page.setUmpleCanvasSize(e,t)},Action.waiting_time)},Action.moveSelectedClass=function(e,t){e!=null&&(e.position=e.position.add(t),UmpleSystem.updateClass(e),Action.classSelected(e),Action.oldTimeout!=null&&clearTimeout(Action.oldTimeout),Action.oldTimeout=setTimeout(function(){DiagramEdit.classMoved(Page.selectedClass)},1e3))},Action.keyboardShortcut=function(e){if(Page.shortcutsEnabled){var t=e.which;if(t==27){var r=Page.unselectAllToggleTools();r||jQuery(".visibleFocus").blur()}else(t==8||t==46)&&jQuery("#umpleCanvasColumn").hasClass("focus")?Page.selectedClass&&jQuery("#"+Page.selectedClass.id).find("input").length==0?(DiagramEdit.classDeleted(Page.selectedClass.id),e.preventDefault()):Page.selectedAssociation?(DiagramEdit.associationDeleted(Page.selectedAssociation.id),e.preventDefault()):Page.selectedGeneralization&&(DiagramEdit.generalizationDeleted(Page.selectedGeneralization.id),e.preventDefault()):(t==8||t==46)&&jQuery(".umpleClass").is(":focus")?(DiagramEdit.classDeleted(document.activeElement.id),e.preventDefault()):(t==8||t==46)&&(jQuery(".untracedAssociation").is(":focus")||jQuery(".redTracedAssociation").is(":focus"))?(DiagramEdit.associationDeleted(document.activeElement.id),e.preventDefault()):(t==8||t==46)&&jQuery(".umpleGeneralization").is(":focus")&&(DiagramEdit.generalizationDeleted(document.activeElement.id),e.preventDefault())}},Action.getCaretPosition=function(){return Page.codeMirrorEditor6.state.doc.lineAt(Page.codeMirrorEditor6.state.selection.main.head).number},Action.getInputSelectionStart=function(e){var t=0,r,a,n,o,u;return typeof e.selectionStart=="number"&&typeof e.selectionEnd=="number"?(t=e.selectionStart,Page.getAdvancedMode()==2&&Page.setFeedbackMessage("Non-IE browser ")):(Page.getAdvancedMode()==2&&Page.setFeedbackMessage("IE-type browser "),a=document.selection.createRange(),a&&a.parentElement()==e&&(o=e.value.length,r=e.value.replace(/\r\n/g,`
`),n=e.createTextRange(),n.moveToBookmark(a.getBookmark()),u=e.createTextRange(),u.collapse(!1),n.compareEndPoints("StartToEnd",u)>-1?t=o:(t=-n.moveStart("character",-o),t+=r.slice(0,t).split(`
`).length-1))),t},Action.setCaretPosition=function(e){if(isNaN(e-0)){if(e=="gd"&&(jQuery("#gdprtext").show(),Action.gdprHidden=!1),e=="av"){document.getElementById("advancedMode").value=1,Page.setFeedbackMessage("");return}if(e=="db"){document.getElementById("advancedMode").value=2,Page.setFeedbackMessage("Debug Mode");return}if(e.substr(0,4)=="clws"){e.substr(4,1)=="+"?(Page.setFeedbackMessage("Collaboration logging Enabled"),Collab.websocketLogging(0)):e.substr(4,1)=="-"?(Page.setFeedbackMessage("Collaboration logging disabled"),Collab.websocketLogging(-1)):e.substr(4,2)=="tq"?(Page.setFeedbackMessage("Ten seconds to timeout the client"),Collab.clientSetTimeout(10)):e.substr(4,2)=="tn"?(Page.setFeedbackMessage("Turn the timeout back to normal"),Collab.clientSetTimeout(-1)):e.substr(4,2)=="tx"&&(Page.setFeedbackMessage("Disabled the timeout"),Collab.clientSetTimeout(0));return}if(e=="sp"&&existSCookie("surveyCookie")==null&&window.localStorage.getItem("surveyShown")==null&&(document.getElementById("styleTip")!=null&&(document.getElementById("styleTip").innerHTML=""),window.randomSurveyRoll=1,window.surveyData.EditsBeforePrompt=1,timeSurveyUp=!1,clearTimeout(timeSurvey),timeSurvey=setTimeout(function(){timeSurveyUp=!0},1e4),displayedText=!1,displayedText||(beforeInstance=TabControl.getCurrentHistory().currentIndex,document.addEventListener("mouseover",function(){TabControl.getCurrentHistory().currentIndex-beforeInstance>=1&&!displayedText&&timeSurveyUp&&(displaySurvey(),this.removeEventListener("mouseover",arguments.callee))}))),e=="sc"){let s=new Date;s.setTime(s.getTime()-1e3),document.cookie="surveyCookie=done; expires="+s.toUTCString()+"; path=/;",window.localStorage.removeItem("surveyShown"),document.addEventListener("mouseover",function(){}),setCookieBeforeClose("off")}if(e=="tc"){Page.setFeedbackMessage("Clearing tip cookies");let s=new Date;s.setTime(s.getTime()-1e3),window.localStorage.removeItem("first_time"),document.cookie="tipCookie=done; expires="+s.toUTCString()+"; path=/;"}if(e.substr(0,2)=="cm"){e.substr(2,1)=="0"&&Page.codeMirrorOn?(Page.setFeedbackMessage("Turning code mirroring off"),Page.codeMirrorEditor.toTextArea(),Page.codeMirrorOn=!1,jQuery("#linenum").val("0")):e.substr(2,1)=="1"&&!Page.codeMirrorOn&&(Page.initCodeMirrorEditor(),jQuery("#linenum").val("0"));return}if(e.substr(0,2)=="bp"){Action.promptAndExecuteTest();return}else{Action.selectMatchingText(e)||(Page.setFeedbackMessage('Line number or word "'+e+'" not located'),setTimeout(function(){Page.setFeedbackMessage("")},3e3));return}}if(Page.codeMirrorOn){if(Page.codeMirrorEditor6.focus(),e>=1){e=Math.min(e,Page.codeMirrorEditor6.state.doc.lines);const s=Page.codeMirrorEditor6.state.doc.line(e).from;Page.codeMirrorEditor6.dispatch({selection:{anchor:s},scrollIntoView:!0})}return}var t=document.getElementById("umpleModelEditorText"),r=0,a=-1;if(e<1)a=0;else{for(var n=Page.getRawUmpleCodeCM6(),o=0;o<n.length;o++)if(n.charAt(o)==`
`&&(e--,e==1&&(r=o+1),e==0)){a=o;break}a==-1&&(a=n.length,e!=1&&(r=a))}if(t.setSelectionRange)t.focus(),t.setSelectionRange(r,a);else if(t.createTextRange){var u=t.createTextRange();u.collapse(!0),u.moveEnd("character",a),u.moveStart("character",r),u.select()}},Action.promptAndExecuteTest=function(){var e=prompt("Umpleonline test prompt. Enter command e.g. 'ac Classname' to add a class",""),t=e.substr(2,99).strip().split(" ");if(e.substr(0,1)=="a"){if(e.substr(1,1)=="c"){if(t.length>=1){Action.directAddClass(t[0]);return}}else if(e.substr(1,1)=="a"){if(t.length>=2){Action.directAddAttribute(t[0],t[1]);return}}else Page.setFeedbackMessage("Syntax error in test add command");Page.setFeedbackMessage("Syntax error in test command")}},Action.setFilterFull=function(e,t){Page.filterWordsOutput="";var r=e.split(" ").filter(a=>a.trim()!=="");r.forEach(function(a){var n=a;a.startsWith("gvseparator=")&&(n=a.replace(".","@@@")),Page.filterWordsOutput+=n+"!@"}),t&&Action.redrawDiagram()},Action.setFilter=function(e){return Action.setFilterFull(e,!0)},Action.directAddClass=function(e){var t=Json.toString({position:{x:"10",y:"10",width:"109",height:"41"},name:e});Page.setFeedbackMessage("Adding class "+e),Action.setjustUpdatetoSaveLater(!1),Action.ajax(Action.directUpdateCommandCallback,format("action=addClass&actionCode={0}",t))},Action.directAddAttribute=function(e,t){Page.setFeedbackMessage("((when written) Adding to class "+e+" attribute "+t)},Action.selectMatchingText=function(e){if(Page.codeMirrorOn){const t=new cm6.SearchCursor(Page.codeMirrorEditor6.state.doc,e);return t.next()?(Page.codeMirrorEditor6.dispatch({selection:{anchor:t.value.from,head:t.value.to}}),!0):!1}return!1},Action.selectItemCM6=function(e){if(Page.codeMirrorOn){var t=Page.codeMirrorEditor6.state.doc.toString();let a=Action.splitStates(t),n=null;for(let s=0;s<a.length;s++)if(a[s].search(e)==0){n=a[s];break}let o=0,u=0;try{o=t.indexOf(n),u=o+n.length}catch{console.log("Please wait a little more for diagram updates, and try again.")}var r={startIndex:o,endIndex:u};return r}},Action.selectMethod=function(e,t,r){var a=new RegExp(r+" "+t+" "+e+"(\\s|[(])"),n=new RegExp("(public|protected|private|class) [A-Za-z]"),o=Action.selectItemCM6(a);Action.highlightByIndexCM6(o.startIndex,o.endIndex)},Action.selectAssociation=function(e){var t=e.split(","),r=t[0],a=new RegExp("(associationClass|class|interface|trait) "+r+"($|\\s|[{])"),n=new RegExp("(class|interface|trait) [A-Za-z]");if(Page.codeMirrorOn)var o=Action.selectItemCM6(a),u=Page.codeMirrorEditor6.state.sliceDoc(o.startIndex,o.endIndex);var s,d;if(t.length>3){if(t[2].trim().includes(" ")){var c=t[2].split(" ");s=t[3].trim(),c.length==2?d=c[0].trim()+" "+t[1].trim()+" "+c[1].trim():d=c[0].trim()+" "+t[1].trim()}else s=t[3].trim(),d=t[2].trim()+" "+t[1].trim();var f=s.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),C=d.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),m=f+"(?:\\s+sorted\\s+{.*?})?(\\s*<-\\s*|\\s*><\\s*|\\s*--\\s*|\\s*->\\s*|\\s*<@>\\-\\s*|\\s*-\\<@>\\s*)"+C+"(?:\\s+sorted\\s+{.*?})?\\s*;",E=new RegExp(m,"g"),S=Page.codeMirrorEditor6.state.doc.toString(),P=u.match(E);if(P)return startIndex=S.indexOf(u)+u.indexOf(P[0]),endIndex=startIndex+P[0].length,Action.highlightByIndexCM6(startIndex,endIndex),{startIndex,endIndex};if(C.startsWith("1")){d=C.substring(2).trim(),C=d.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),m=f+"\\s+"+C+"\\s*;",E=new RegExp(m,"g"),P=u.match(E),P==null&&(m=f+"\\s+.*?"+C+"\\s*;",E=new RegExp(m,"g"),P=u.match(E));try{startIndex=S.indexOf(u)+u.indexOf(P[0]),endIndex=startIndex+P[0].length}catch{console.log("Please wait a little more for diagram updates, and try again.")}return Action.highlightByIndexCM6(startIndex,endIndex),{startIndex,endIndex}}else{if(f.trim().includes(" ")){var N=f.split(" ");f=N[0].trim()+" "+r+" "+N[1].trim()}else f+=" "+r;m=f+"(\\s*<-\\s*|\\s*><\\s*|\\s*--\\s*|\\s*->\\s*|\\s*<@>\\-\\s*|\\s*-\\<@>\\s*)"+C+"\\s*;",E=new RegExp(m,"g"),P=S.match(E),P==null&&(m=f+"\\s+.*?"+C+"\\s*;",E=new RegExp(m,"g"),P=S.match(E));try{startIndex=S.indexOf(P[0]),endIndex=startIndex+P[0].length}catch{console.log("Please wait a little more for diagram updates, and try again.")}return Action.highlightByIndexCM6(startIndex,endIndex),{startIndex,endIndex}}}else{var c=t[2].split(" ");s=c[0].trim(),d=c[1].trim();var f=s.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),C=d.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),m=f+".*?"+C+"\\s*;",E=new RegExp(m,"g"),S=Page.codeMirrorEditor6.state.doc.toString(),P=u.match(E);if(P)return startIndex=S.indexOf(u)+u.indexOf(P[0]),endIndex=startIndex+P[0].length,Action.highlightByIndexCM6(startIndex,endIndex),{startIndex,endIndex}}},Action.selectClass=function(e){var t=new RegExp("(associationClass|class|interface|trait) "+e+"($|\\s|[{])"),r=new RegExp("(class|interface|trait) [A-Za-z]"),a=Action.selectItemCM6(t);Action.highlightByIndexCM6(a.startIndex,a.endIndex)},Action.selectState=function(e){var t=new RegExp("(class|interface|trait) "+e+"($|\\s|[{])"),r=new RegExp("(class|interface|trait) [A-Za-z]"),a=Action.selectItemCM6(t);Action.highlightByIndexCM6(a.startIndex,a.endIndex)},Action.splitStates=function(e){let t=[],r="",a=0,n=!1,o=!1;for(var u in e){let s=e.charAt(u);o&&s!=`
`&&s!=" "&&(o=!1,s!="{"&&(r="")),s=="/"&&e.charAt(parseInt(u)+1)=="/"&&(n=!0),s==`
`&&n&&(n=!1),s=="{"&&!n?(r=r+s,a++):s=="}"&&!n?(r=r+s,a--,a==0&&(t.push(r.trim()),r="")):s==`
`&&a==0?(o=!0,r=r+`
`):s==" "&&a==0&&r==""||(r=r+s)}return t},Action.indexToPos=function(e,t){for(var r=0,a=0,n="",o=0;o<e;o++){let u=t.charAt(o);u==`
`?(a++,n=""):n=n+u}return r=n.length,output={line:a,ch:r},output},Action.selectStateInClassCM6=function(e,t,r){if(Page.codeMirrorOn){var a=Page.codeMirrorEditor6.state.doc.toString();let o=Action.splitStates(a),u=null,s=new RegExp("(?:class|queued)\\s+"+e,"");for(let c=0;c<o.length;c++)if(o[c].search(s)==0){u=o[c];break}o=Action.splitStates(u.substr(u.indexOf("{")+1));let d=null;for(let c=0;c<o.length;c++){let f=new RegExp("(?:queued\\s*)?"+t);if(o[c].search(f)==0){d=o[c];break}}if(o=Action.splitStates(d.substr(d.indexOf("{")+1)),o!=null){let c=o,f=null;for(let E=0;E<c.length;E++)if(c[E].search(r)==0){f=c[E];break}let C=a.indexOf(u),m=C+u.length;C=a.substr(C,m).indexOf(d)+C,m=C+d.length,C=a.substr(C,m).indexOf(f)+C,m=C+f.length;var n={startIndex:C,endIndex:C+f.length};return n}else console.log("No matching state found with regex:"+s)}else console.log("No matching class and state machine found for class: "+e+" and sm "+t);return null},Action.selectStateInStateCM6=function(e,t,r){var a=Page.codeMirrorEditor6.state.doc.toString().substr(e,t-e);let n=Action.splitStates(a.substr(a.indexOf("{")+1));var o=null;for(let c=0;c<n.length;c++)if(n[c].startsWith(r)){o=n[c];break}let u=a.indexOf(o)+e,s=u+o.length;return{startIndex:u,endIndex:s}},Action.highlightByIndex=function(e,t){Page.codeMirrorEditor.setSelection(Action.indexToPos(e,Page.codeMirrorEditor.getValue()),Action.indexToPos(t,Page.codeMirrorEditor.getValue()))},Action.highlightByIndexCM6=function(e,t){let r=Action.indexToPos(e,Page.codeMirrorEditor6.state.doc.toString()),a=Page.codeMirrorEditor6.state.doc.line(r.line+1).from,n=Action.indexToPos(t,Page.codeMirrorEditor6.state.doc.toString()),o=Math.min(n.line+2,Page.codeMirrorEditor6.state.doc.lines),u=Page.codeMirrorEditor6.state.doc.line(o).from;Page.codeMirrorEditor6.dispatch({selection:cm6.EditorSelection.create([cm6.EditorSelection.range(u,a)]),scrollIntoView:!0})},Action.findEOL=function(e){let t="",r="",a=0,n=!1;for(var o in e){let u=e.charAt(o);if(u=="{")a++,r=r+u;else if(u=="}")a--,r=r+u;else if(u==";"&&a==0){t=r+";";break}else r=r+u}return t},Action.delayedFocus=function(e){var t=document.getElementById("umpleModelEditorText");setTimeout(function(){t.focus()},e)},Action.updateLineNumberDisplay=function(){jQuery("#linenum").val(Action.getCaretPosition())},Action.umpleTyped=function(e){clientDebuggerFlag&&console.log("Inside Action.umpleTyped()..."),Page.getAdvancedMode()=="2"&&Page.catFeedbackMessage("["+e.keyCode+"] "),Action.updateLineNumberDisplay();var t=e.keyCode;if(!(t>=33&&t<=40)){var r=e.target.id;Action.umpleTypingActivity(r)}},Action.umpleCodeMirrorCursorActivity=function(){var e=Page.codeMirrorEditor6.state.selection.main.head,t=Page.codeMirrorEditor6.state.doc.lineAt(e);jQuery("#linenum").val(t.number)},Action.umpleCodeMirrorTypingActivity=function(e){clientDebuggerFlag&&console.log("Inside Action.umpleCodeMirrorTypingActivity..."),Action.freshLoad==!1?(Action.umpleTypingActivity(e),e=="codeMirrorEditor"&&Page.codeMirrorEditor.save()):(Action.freshLoad=!1,Action.setjustUpdatetoSaveLaterForTextCallback(!1))},Action.trimMultipleNonPrintingAndComments=function(e){return e=Action.removeComments(e),e=e.replace(/[^\x21-\x7E]+/g," "),e=e.replace(/^\s+|\s+$/g,""),e},Action.removeComments=function(e){var t="_"+ +new Date,r=[],a=0;return e.replace(/(['"])(\\\1|.)+?\1/g,function(n){return r[a]=n,t+""+a++}).replace(/([^\/])(\/(?!\*|\/)(\\\/|.)+?\/[gim]{0,3})/g,function(n,o,u){return r[a]=u,o+(t+"")+a++}).replace(/\/\/.*?\/?\*.+?(?=\n|\r|$)|\/\*[\s\S]*?\/\/[\s\S]*?\*\//g," ").replace(/\/\/.+?(?=\n|\r|$)|\/\*[\s\S]+?\*\//g," ").replace(RegExp("\\/\\*[\\s\\S]+"+t+"\\d+","g")," ").replace(RegExp(t+"(\\d+)","g"),function(n,o){return r[o]})},Action.umpleTypingActivity=function(e){clientDebuggerFlag&&console.log("Inside Action.umpleTypingActivity()..."),Action.manualSync&&Action.diagramInSync&&(jQuery("#umpleCanvasColumn").is(":visible")&&Page.enablePaletteItem("buttonSyncDiagram",!0),Action.diagramInSync=!1,Page.enableDiagram(!1)),Action.oldTimeout!=null&&clearTimeout(Action.oldTimeout),e=="diagramEdit"?Action.oldTimeout=setTimeout('Action.processTyping("'+e+'",false)',500):Action.oldTimeout=setTimeout('Action.processTyping("'+e+'",false)',Action.waiting_time)},Action.processTyping=function(e,t,r){if(clientDebuggerFlag&&console.log("Inside Action.processTyping ...",e),document.getElementById("newEditor").value=Page.codeMirrorEditor6.state.doc.toString(),e!="diagramEdit"?Action.setjustUpdatetoSaveLaterForTextCallback(!0):Action.setjustUpdatetoSaveLaterForTextCallback(!1),!Action.manualSync||t)if(Action.diagramInSync=!0,e=="umpleModelEditorText"||e=="codeMirrorEditor"||e=="newEditor"){Action.updateLayoutEditorAndDiagram(e);var a=document.getElementById("downloadLink");a!==null&&a.remove(),Page.enablePaletteItem("buttonSyncDiagram",!1)}else e=="diagramEdit"&&Action.ajax(Action.updateFromDiagramCallback,Action.getLanguage());e!="diagramEdit"&&(justUpdatetoSaveLater?(e=="umpleModelEditorText"||e=="codeMirrorEditor"||e=="newEditor")&&Action.setjustUpdatetoSaveLater(!1):TabControl.getCurrentHistory().save(Page.getUmpleCode(),"processTyping"),Page.setExampleMessage(""))},Action.updateCurrentUmpleTextBeingEdited=function(e){Page.currentUmpleTextBeingEdited=e,jQuery("#umpleModelEditorText").val(e),Page.setCodeMirror6Text(e)},Action.updateLayoutEditorAndDiagram=function(e){Action.ajax(Action.updateUmpleLayoutEditor,"language=Json",e)},Action.updateUmpleLayoutEditor=function(e){var t=e.responseText.split("URL_SPLIT"),r=t[0],a=t[1];(a==null||a==null)&&(a=e.responseText),Page.showLayoutLoading(),Action.ajax(Action.updateUmpleLayoutEditorCallback,format("action=addPositioning&actionCode={0}",a))},Action.updateUmpleLayoutEditorCallback=function(e){var t=e.responseText,r=Page.splitUmpleCode(t)[1];Page.setUmplePositioningCode(r),Page.hideLoading(),Action.updateUmpleDiagramForce(!0)},Action.updateUmpleDiagram=function(){return Action.updateUmpleDiagramForce(!0)},Action.updateUmpleDiagramForce=function(e){var t=Action.trimMultipleNonPrintingAndComments(Page.getUmpleCode());!e&&t==Action.savedCanonical||(Action.savedCanonical=t,Page.showCanvasLoading(),Action.ajax(Action.updateUmpleDiagramCallback,Action.getLanguage()))},Action.updateUmpleDiagramCallback=function(response){var theCanvas=jQuery("#umpleCanvas"),canvasX=Math.round(theCanvas.offset().left),canvasY=Math.round(theCanvas.offset().top),diagramCode="",errorMessage="";if(diagramCode=Action.getDiagramCode(response.responseText),errorMessage=Action.getErrorCode(response.responseText),Page.hideExecutionArea(),diagramCode==null||diagramCode==""||diagramCode=="null")Page.enableDiagram(!1),Action.diagramInSync=!1,Page.setFeedbackMessage('<a href="#errorClick">See message.</a> To fix: edit model or click undo');else{Page.enableDiagram(!0),Action.diagramInSync||(Action.diagramInSync=!0),Page.setFeedbackMessage(""),Page.hideGeneratedCode();var dynamicCheckboxItems=Page.getUmpleCode().match(/(((?<!(\/\/.*))(mixset))|((?<!(\/\/.*))(filter)))\s+[a-zA-Z1-9-_]+/g);dynamicCheckboxItems==null&&(dynamicCheckboxItems=new Array),dynamicCheckboxItems.push("gvmanual","gvdot","gvsfdp","gvcirco","gvortho");var spanToInjectItem=document.getElementById("ShowMFDynamicArea");if(spanToInjectItem.innerHTML="",!(dynamicCheckboxItems==null||dynamicCheckboxItems.length==0)){var boxesToActivate=new Array;dynamicCheckboxItems.forEach(function(e){var t=e.replace(/\s/g,""),r='<li id="tt'+t+'" class="layoutListItem view_opt_class">                <input id="button'+t+'" class="checkbox" type="checkbox"/>                <a id="label'+t+'" class="buttonExtend">'+e+"</a>              </li>";spanToInjectItem.innerHTML+=r,boxesToActivate.push(t)}),Page.mixsetsActive=Page.mixsetsActive.filter(function(e){return boxesToActivate.includes("mixset"+e)}),Page.filtersActive=Page.filtersActive.filter(function(e){return boxesToActivate.includes("filter"+e)}),Page.specialSuboptionsActive=Page.specialSuboptionsActive.filter(function(e){return boxesToActivate.includes(e)}),boxesToActivate.forEach(function(e){Page.initHighlighter("button"+e);var t=!1;(e.substr(0,6)=="mixset"&&Page.mixsetsActive.includes(e.substr(6))||e.substr(0,6)=="filter"&&Page.filtersActive.includes(e.substr(6))||e.substr(0,2)=="gv"&&Page.specialSuboptionsActive.includes(e))&&(t=!0),jQuery("#button"+e).prop("checked",t),Page.initAction("button"+e),Page.initLabel("label"+e),ToolTips.setATooltipBasic(ToolTips.dynamicTooltips,"tt"+e,"right"),jQuery("#tt"+e).show()})}if(Page.useEditableClassDiagram){var newSystem=Json.toObject(diagramCode);UmpleSystem.merge(newSystem),UmpleSystem.update(),Page.readOnly&&jQuery("span.editable").addClass("uneditable")}else if(Page.useJointJSClassDiagram){var model=JSON.parse(diagramCode.replace(new RegExp('} { "name": "',"gi"),'}, { "name": "')),umpleCanvas=jQuery("#umpleCanvas"),paper=JJSdiagram.initJJSDiagram(umpleCanvas,model),MouseWheelHandler=function(e){var t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));if(e.altKey===!0){var r=paper.options.height,a=paper.options.width,n=1+Math.abs(t)/(t*10);paper.setDimensions(a*n,r*n),JJSdiagram.paper&&JJSdiagram.paper.setDimensions(jQuery("#umpleCanvas")[0].clientWidth,jQuery("#umpleCanvas")[0].clientHeight)}},paperHolder=document.getElementById("umpleCanvas");paperHolder.addEventListener?(paperHolder.addEventListener("mousewheel",MouseWheelHandler,!1),paperHolder.addEventListener("DOMMouseScroll",MouseWheelHandler,!1)):paperHolder.attachEvent("onmousewheel",MouseWheelHandler),jQuery("#jjsPaper").click(function(){Action.focusOn(Page.umpleCanvasId(),!0)})}else if(Page.useGvClassDiagram||Page.useGvStateDiagram||Page.useGvFeatureDiagram){if(theCanvas.html(format("{0}",diagramCode)),theCanvas.children().first().attr("id","svgCanvas"),Page.useGvClassDiagram&&Page.isGvManual()){var algoWasRemoved=Action.deactivateSpecialLayoutAlgorithmsExcept(null),positioningCode=jQuery("#umpleLayoutEditorText").val(),elems=document.getElementsByClassName("node"),posMap=new Array,minUmpleLeft=9999999,minUmpleTop=9999999,minRectLeft=9999999,minRectTop=9999999;for(let c=0;c<elems.length;c++){var currentClassForPos=Action.getGvClassNameFromNode(elems[c]),umplePosOfCurrentClass=Action.getGvPosition(positioningCode,currentClassForPos);if(umplePosOfCurrentClass!=null){var theRect=Action.getRectFromSvgNode(elems[c],canvasX,canvasY),rectLeft=theRect.left,rectTop=theRect.top,rectCentreX=theRect.centreX,rectCentreY=theRect.centreY,uLeft=umplePosOfCurrentClass.x,uTop=umplePosOfCurrentClass.y;posMap.push({className:currentClassForPos,fullUmplePosOfCurrentClass:umplePosOfCurrentClass.all,left:uLeft,umpleX:Number(umplePosOfCurrentClass.x)+Number(umplePosOfCurrentClass.width)/2,rectCentreX,top:uTop,umpleY:Number(umplePosOfCurrentClass.y)+Number(umplePosOfCurrentClass.height)/2,rectCentreY,associationPos1:umplePosOfCurrentClass.assoc1,associationPos2:umplePosOfCurrentClass.assoc2}),minUmpleLeft=Math.min(minUmpleLeft,uLeft),minUmpleTop=Math.min(minUmpleTop,uTop),minRectLeft=Math.min(minRectLeft,rectLeft),minRectTop=Math.min(minRectTop,rectTop)}}let s=minUmpleLeft-minRectLeft,d=minUmpleTop-minRectTop;var nodesMoved=0;posMap.forEach(function(c){var C=Math.round(c.rectCentreX+s-c.umpleX),m=Math.round(c.rectCentreY+d-c.umpleY);(Math.abs(C)>10||Math.abs(m)>10)&&(nodesMoved++,Action.updateGVPositionBasic(c.className,C,m,positioningCode,c.fullUmplePosOfCurrentClass,c.left,c.top,c.associationPos1,c.associationPos2,!1))}),algoWasRemoved&&TabControl.getCurrentHistory().save(Page.getUmpleCode(),"moveClass")}const t=Page.getUmpleCode().split(`
`),r={};let a=null;const n=/^class\s+(\w+)/,o=/\s*(--\*|--|\*--\*|->|<-)\s*/,u=/^isA\s+([A-Za-z0-9_,\s]+);?/;for(let s=0;s<t.length;s++){const d=t[s].trim();if(d.includes("//$?[End_of_model]$?"))break;const c=d.match(n);if(c){a=c[1],r[a]||(r[a]=[]);continue}if(!a)continue;const f=d.match(u);if(f){const m=f[1].split(",").map(E=>E.trim().replace(/[^a-zA-Z0-9_]/g,""));r[a].push(...m);continue}const C=d.split(o);if(C.length>=3){const E=C[2].trim().split(/\s+/),P=(E.length>1?E[1]:E[0]).replace(/[^a-zA-Z0-9_]/g,"");P&&r[a].push(P)}}for(const[s,d]of Object.entries(r))for(const c of d)r[c]||(r[c]=[]),r[c].includes(s)||r[c].push(s);Action.neighbors=r,Action.setupPinch()}else Page.useStructureDiagram&&(jQuery("#umpleCanvas").html('<svg id="svgCanvas"></svg>'),eval(diagramCode))}if(errorMessage!=""&&Page.showGeneratedCode(errorMessage,"diagramUpdate"),Page.hideLoading(),Page.useGvClassDiagram){allowNodeMovement=!0,Page.isGvManual()||(allowNodeMovement=!1);var elems=document.getElementsByClassName("node");for(let t=0;t<elems.length;t++){let r=elems[t];r.addEventListener("contextmenu",function(a){a.preventDefault(),Action.displayMenu(a)}),r.addEventListener("dblclick",function(a){a.preventDefault(),Action.displayMenu(a)}),r.addEventListener("mousedown",function(a){a.preventDefault();let n=0,o=0,u=!1;Page.selectedGvClass=Action.getGvClassName(a),Page.initialMouseDownX=a.clientX,Page.initialMouseDownY=a.clientY;let s=Page.initialMouseDownX,d=Page.initialMouseDownY,c=Action.getRectFromSvgNode(r,canvasX,canvasY),f=c.top,C=c.left;function m(S){S.preventDefault();let P=S.clientX,N=S.clientY;c=Action.getRectFromSvgNode(r,canvasX,canvasY),f=c.top,C=c.left;let R=P-s,g=N-d;n+=R,o+=g,allowNodeMovement&&(u||Math.abs(n+o)>10)&&(r.setAttribute("transform"," translate("+n+","+o+")"),u=!0),s=P,d=N,allowNodeMovement||Page.setFeedbackMessage("To enable moving of classes in G mode, set gvmanual in the Show and Hide menu")}function E(S){allowNodeMovement&&u&&(n!=0||n!=0)&&Action.updateGvPosition(Page.selectedGvClass,n,o),document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",E)}document.addEventListener("mousemove",m),document.addEventListener("mouseup",E)});var attributeAnchors=elems[t].getElementsByTagName("a");for(let a=1;a<attributeAnchors.length;a++){let n=attributeAnchors[a].getAttribute("xlink:title"),[o,u]=n.split(" ");attributeAnchors[a].addEventListener("dblclick",function(s){s.preventDefault(),Action.displayAttributeMenu(s,u,o)}),attributeAnchors[a].addEventListener("contextmenu",function(s){s.preventDefault(),s.stopPropagation(),Action.displayAttributeMenu(s,u,o)})}}var associationElems=document.getElementsByClassName("edge");for(let t=0;t<associationElems.length;t++){var associationAnchors=associationElems[t].getElementsByTagName("a");for(let r=0;r<associationAnchors.length;r++){let a=associationAnchors[r].getAttribute("xlink:href");associationAnchors[r].addEventListener("dblclick",function(n){n.preventDefault(),Action.displayAssociMenu(n,a)}),associationAnchors[r].addEventListener("contextmenu",function(n){n.preventDefault(),Action.displayAssociMenu(n,a)})}}}if(Page.useGvStateDiagram){var elems=document.getElementsByClassName("node");for(let t=0;t<elems.length;t++)elems[t].addEventListener("contextmenu",function(r){r.preventDefault(),Action.drawStateMenu(r)}),elems[t].addEventListener("dblclick",function(r){r.preventDefault(),Action.drawStateMenu(r)});elems=document.getElementsByClassName("cluster");for(let t=0;t<elems.length;t++)elems[t].addEventListener("contextmenu",function(r){r.preventDefault(),Action.drawStateMenu(r)}),elems[t].addEventListener("dblclick",function(r){r.preventDefault(),Action.drawStateMenu(r)});var transitionElems=document.getElementsByClassName("edge");for(let t=0;t<transitionElems.length;t++)transitionElems[t].addEventListener("dblclick",function(r){r.preventDefault(),Action.displayTransitionMenu(r)}),transitionElems[t].addEventListener("contextmenu",function(r){r.preventDefault(),Action.displayTransitionMenu(r)})}},Action.deactivateSpecialLayoutAlgorithmsExcept=function(e){var t=new Array,r=!1;return t.push("gvdot","gvsfdp","gvcirco"),e!=null&&!t.includes(e)?!1:(t.forEach(function(a){if(e==null||a!=e){jQuery("#button"+a).prop("checked",!1);var n=Page.specialSuboptionsActive.indexOf(a);n!==-1&&(Page.specialSuboptionsActive.splice(n,1),r=!0)}}),r)},Action.getRectFromSvgNode=function(e,t,r){var a=e.getBoundingClientRect();return{left:Math.round(a.left-t),top:Math.round(a.top-r),centreX:Math.round(a.left-t+Math.abs(a.width/2)),centreY:Math.round(a.top-r+Math.abs(a.height/2))}},Action.updateFromDiagramCallback=function(e){var t="",r="";t=Action.getDiagramCode(e.responseText),r=Action.getErrorCode(e.responseText),(t==null||t==""||t=="null")&&Action.diagramInSync?(Page.enableDiagram(!1),Action.diagramInSync=!1,Page.setFeedbackMessage('<a href="#errorClick">See message.</a> To fix: edit model or click undo')):(Page.enableDiagram(!0),Action.diagramInSync=!0),r!=""&&Page.showGeneratedCode(r,"diagramUpdate")},Action.getDiagramCode=function(e){var t="";if(Page.useEditableClassDiagram||Page.useJointJSClassDiagram)t=e.split("URL_SPLIT")[1],t=="null"&&(t="");else if(Page.useGvClassDiagram||Page.useGvStateDiagram||Page.useGvFeatureDiagram){var r=e.split("<svg width=");r.length>1&&r[1].length>100&&(t="<svg width="+r[1],t=t.replace(/<\/svg>$/,""))}else Page.useStructureDiagram&&(t=e.split("<p>URL_SPLIT")[1],t=t.replace(/##CANVAS_ID##/g,"svgCanvas"),t=jQuery("<div/>").html(t).text());return t},Action.getErrorCode=function(e){var t="";if(Page.useEditableClassDiagram||Page.useStructureDiagram)t=e.split("URL_SPLIT")[0],t=="<p>"&&(t="");else if(Page.useGvClassDiagram||Page.useGvStateDiagram||Page.useGvFeatureDiagram){var r=e.split("<svg width=")[0],a=r.split("errorRow");a.length>1&&(t=r.split("<\/script>&nbsp;")[0])}return t},Action.classResizing=function(e,t){var r=e.target.id,a=UmpleSystem.find(r),n="#"+r,o=Math.round(jQuery(n).width()),u=Math.round(jQuery(n).height());UmpleSystem.updatingSize(a,o,u)},Action.associationSnap=function(e,t,r){var a=jQuery(r).prop("id"),n=a.substr(0,a.lastIndexOf("_")),o=a.substr(a.lastIndexOf("_")+6+1),u=UmpleSystem.findAssociation(n),s=u.getClass(o),d=UmpleClassFactory.perimeterPosition(s,new UmplePosition(e,t,0,0),UmpleSystem.position());return[d.x,d.y]},Action.associationSnapClassReady=function(e,t,r){var a=UmpleClassFactory.perimeterPosition(r,new UmplePosition(e,t,0,0),UmpleSystem.position());return[a.x,a.y]},Action.updateMovedAssociation=function(e,t){jQuery(e).show();var r=jQuery(e).offset(),a=jQuery(e).prop("id");jQuery(e).hide();var n=Math.round(r.left),o=Math.round(r.top),u=Action.associationSnap(n,o,e),s=new UmplePosition(u[0],u[1],0,0);a.endsWith("_anchor0")?t.setOffsetOnePosition(s):t.setOffsetTwoPosition(s),UmpleSystem.redrawAssociation(t),Action.associationSelected(null)},Action.validateAttributeName=function(e){return e.length!=0&&(e.match(/^[_a-zA-Z0-9]+$/)||e.match(/^[_a-zA-Z0-9]+[\u0020]*:[\u0020]*[_a-zA-Z0-9]+(\[\])?$/))},Action.validateMethodName=function(e){return e.length!=0&&e.match(/^[-+#]?\s*[_a-zA-Z0-9]+\s*\(([_a-zA-Z0-9]+(\[\])?(,\s*[_a-zA-Z0-9]+(\[\])?)*)?\)(\s*:\s*[_a-zA-Z0-9]+(\[\])?)?$/)},Action.toggleAttributes=function(){Page.showAttributes=!Page.showAttributes,Action.redrawDiagram()},Action.toggleMethods=function(){Page.showMethods=!Page.showMethods,Action.redrawDiagram()},Action.toggleActions=function(){Page.showActions=!Page.showActions,Action.redrawDiagram()},Action.toggleTransitionLabels=function(){Page.showTransitionLabels=!Page.showTransitionLabels,Action.redrawDiagram()},Action.toggleGuards=function(){Page.showGuards=!Page.showGuards,Action.redrawDiagram()},Action.toggleGuardLabels=function(){Page.showGuardLabels=!Page.showGuardLabels,Action.redrawDiagram()},Action.allowPinch=function(){Page.allowPinch=!Page.allowPinch,Action.redrawDiagram()},Action.toggleFeatureDependency=function(){Page.showFeatureDependency=!Page.showFeatureDependency,Action.redrawDiagram()},Action.toggleTraits=function(){Page.showTraits=!Page.showTraits,Action.redrawDiagram()},Action.redrawDiagram=function(){UmpleSystem.merge(null);var e=jQuery("#umpleCanvas");e.html(""),Action.manualSync||(Action.updateUmpleDiagram(),Action.diagramInSync=!0),Action.manualSync&&!Action.diagramInSync&&Page.enablePaletteItem("buttonSyncDiagram",!0),(!Action.manualSync||Action.diagramInSync)&&(Page.enableCheckBoxItem("buttonPhotoReady","ttPhotoReady",!0),Page.enableCheckBoxItem("buttonManualSync","ttManualSync",!0),Page.enablePaletteItem("buttonAddClass",!0),Page.enablePaletteItem("buttonAddAssociation",!0),Page.enablePaletteItem("buttonAddTransition",!0),Page.enablePaletteItem("buttonAddGeneralization",!0),Page.enablePaletteItem("buttonDeleteEntity",!0),Page.initToggleTool("buttonAddClass"),Page.initToggleTool("buttonAddAssociation"),Page.initToggleTool("buttonAddTransition"),Page.initToggleTool("buttonAddGeneralization"),Page.initToggleTool("buttonDeleteEntity"))},InlineEditor.elementChanged=function(e,t,r){var a=e.attr("name"),n=e.attr("id");if(a=="className"){var o=n.substr(0,n.length-5);DiagramEdit.classNameChanged(o,t,r)}else if(a=="attributeEdit"){var u=n.substr(n.lastIndexOf("_")+1),o=n.substr(0,n.length-11-u.length);DiagramEdit.attributeNameChanged(o,u,t,r)}else if(a=="methodEdit"){var u=n.substr(n.lastIndexOf("_")+1),o=n.substr(0,n.length-8-u.length);DiagramEdit.methodChanged(o,u,t,r)}else if(a=="attributeNew"){var o=n.substr(0,n.length-13);DiagramEdit.attributeNew(o,r)}else if(a=="methodNew"){var o=n.substr(0,n.length-10);DiagramEdit.methodNew(o,r)}},Action.enableManualSync=function(e){var t=jQuery("#buttonManualSync"),r=jQuery("#buttonSyncDiagram");e==null&&(e=t.is(":checked")),e?Action.manualSync=!0:(Action.manualSync=!1,Action.processTyping("umpleModelEditorText",!0),Page.enablePaletteItem("buttonSyncDiagram",!1))},Action.generateStructureDiagramFile=function(){var e=Page.getFilename().slice(0,-9)+"structureDiagram.svg",t=jQuery("#innerGeneratedCodeRow").html().slice(4,-1);t=format('<svg xmlns="http://www.w3.org/2000/svg" {0}>',t),jQuery("#buttonStructureLink").showLoading(),Ajax.sendRequest("scripts/compiler.php",Action.generateStructureDiagramFileCallback,format("save=1&filename={0}&svgContent={1}",e,t))},Action.generateStructureDiagramFileCallback=function(e){jQuery("#buttonStructureLink").hideLoading(),Page.toggleStructureDiagramLink(!0,e.responseText)},Action.ajax=function(e,t,r,d,n){var o=null;o=Page.getUmpleCode();var u=encodeURIComponent(o),s=Page.getFilename(),d="true";TabControl.useActiveTabTo(TabControl.saveTab)(u),t=t+"&theme="+Action.getThemePreference();var c=TabControl.getActiveTabId(),f=n?e:function(C){var m=TabControl.getActiveTabId();if(m!==c){Page.hideLoading();return}e(C)};Ajax.sendRequest("scripts/compiler.php",f,format("{0}&error={3}&umpleCode={1}&filename={2}",t,u,s,d))},navigator.appVersion.indexOf("Mac")!=-1?(jQuery(document).ready(function(){jQuery("#undosmall").html("[cmd+z]"),jQuery("#redosmall").html("[cmd+shift+z]")}),Mousetrap.bind(["command+z"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Action.undo(),e.preventDefault()}),Mousetrap.bind(["command+shift+z"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Action.redo(),e.preventDefault()})):(jQuery(document).ready(function(){jQuery("#undosmall").html("[ctrl+z]"),jQuery("#redosmall").html("[ctrl+y]")}),Mousetrap.bind(["ctrl+z"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Action.undo(),e.preventDefault()}),Mousetrap.bind(["ctrl+y"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Action.redo(),e.preventDefault()})),Mousetrap.bind(["up"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(0,-5,0,0)),!1}),Mousetrap.bind(["shift+up"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(0,-1,0,0)),!1}),Mousetrap.bind(["down"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(0,5,0,0)),!1}),Mousetrap.bind(["shift+down"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(0,1,0,0)),!1}),Mousetrap.bind(["left"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(-5,0,0,0)),!1}),Mousetrap.bind(["shift+left"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(-1,0,0,0)),!1}),Mousetrap.bind(["right"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(5,0,0,0)),!1}),Mousetrap.bind(["shift+right"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(1,0,0,0)),!1}),Mousetrap.bind(["ctrl+e"],function(e){return Page.clickShowEditableClassDiagram(),!1}),Mousetrap.bind(["ctrl+j"],function(e){return Page.clickShowJointJSClassDiagram(),!1}),Mousetrap.bind(["ctrl+g"],function(e){return Page.clickShowGvClassDiagram(),!1}),Mousetrap.bind(["ctrl+s"],function(e){return Page.clickShowGvStateDiagram(),!1}),Mousetrap.bind(["ctrl+l"],function(e){return Page.clickShowStructureDiagram(),!1}),Mousetrap.bind(["ctrl+t","ctrl+alt+shift+t"],function(e){return Page.clickShowHideText(),!1}),Mousetrap.bind(["ctrl+d"],function(e){return Page.clickShowHideCanvas(),!1}),Mousetrap.bind(["ctrl+n","ctrl+alt+n"],function(e){return Page.clickShowHideMenu(),!1}),Mousetrap.bind(["shift+ctrl+a"],function(e){return Page.clickToggleAttributes(),!1}),Mousetrap.bind(["ctrl+m"],function(e){return Page.clickToggleMethods(),!1}),Mousetrap.bind(["ctrl+r"],function(e){return Page.clickToggleTraits(),!1}),Mousetrap.bind(["ctrl+i"],function(e){return Page.clickToggleTransitionLabels(),!1}),Mousetrap.bind(["ctrl+k"],function(e){return Page.clickToggleGuardLabels(),!1}),Mousetrap.bind(["ctrl+b"],function(e){return Action.promptAndExecuteTest(),!1}),Mousetrap.bind(["ctrl+o"],function(e){return Action.copyCommandLineCode(),!1}),Mousetrap.bind(["g"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Page.selectedAssociation==null&&Page.selectedGeneralization==null&&(Page.selectedClass==null||Page.selectedClass&&jQuery("#"+Page.selectedClass.id).find("input").length==0)&&jQuery("#buttonAddGeneralization").click()}),Mousetrap.bind(["a"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Page.selectedAssociation==null&&Page.selectedGeneralization==null&&(Page.selectedClass==null||Page.selectedClass&&jQuery("#"+Page.selectedClass.id).find("input").length==0)&&jQuery("#buttonAddAssociation").click()}),Mousetrap.bind(["c"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Page.selectedAssociation==null&&Page.selectedGeneralization==null&&(Page.selectedClass==null||Page.selectedClass&&jQuery("#"+Page.selectedClass.id).find("input").length==0)&&jQuery("#buttonAddClass").click()}),Action.toggleTabsCheckbox=function(e){$("inputGenerateCode").value.split(":")[1]=="TextUml"&&(e="TextUml"),e=="java"||e=="php"||e=="cpp"||e=="python"||e=="ruby"||e=="sql"?(jQuery("#ttTabsCheckbox").show(),jQuery("#tabRow").show(),($("inputGenerateCode").value.split(":")[1]=="USE"||$("inputGenerateCode").value.split(":")[1]=="UmpleSelf"||$("inputGenerateCode").value.split(":")[1]=="Json")&&(jQuery("#ttTabsCheckbox").hide(),jQuery("#tabRow").hide())):(jQuery("#ttTabsCheckbox").hide(),jQuery("#tabRow").hide(),jQuery("#buttonTabsCheckbox").is(":checked")&&jQuery("#buttonTabsCheckbox").click())},Action.toggleTabs=function(){jQuery("#buttonTabsCheckbox").is(":checked")?(jQuery("#tabRow").show(),jQuery("#innerGeneratedCodeRow").hide(),jQuery("#tabButton1").click()):(jQuery("#tabRow").hide(),jQuery("#innerGeneratedCodeRow").show(),jQuery("#innerGeneratedCodeRow").nextAll().hide())},Action.generateTabsCode=function(e){var t=[],r=0,a="",n=[],o="",u=!1;for(e.split("URL_SPLIT")[1].split(`
`).forEach(function(s){s.indexOf("//%%")>=0||s.indexOf("# %%")>=0?(r++,strFileName=s.slice(14),strFileName=strFileName.substr(0,strFileName.indexOf(" ")),n[r]=strFileName,jQuery("#generatedCodeRow").append("<div id='innerGeneratedCodeRow"+r+"'></div>"),t[r]="",u=!0):u?u=!1:t[r]+=s+`
`}),i=1;i<=r;i++)jQuery("#tabRow").append("<button type='button' id='tabButton"+i+"'>"+n[i]+"</button>"),jQuery("#tabButton"+i).click({code:t[i],tabnumber:i},showTab)},Action.getLanguage=function(){var e="";if(Page.useEditableClassDiagram?e="language=Json":Page.useJointJSClassDiagram?e="language=JsonMixed":Page.useGvClassDiagram?Page.showTraits?e="language=traitDiagram":e="language=classDiagram":Page.useGvStateDiagram?e="language=stateDiagram":Page.useStructureDiagram&&(e="language=StructureDiagram"),Page.useGvStateDiagram&&(Page.showActions||(e=e+".hideactions"),Page.showTransitionLabels&&(e=e+".showtransitionlabels"),Page.showGuards||(e=e+".hideguards"),Page.showGuardLabels&&(e=e+".showguardlabels"),e=e+"."+$("inputGenerateCode").value.split(":")[1]),Page.useGvClassDiagram&&(Page.showMethods&&(e=e+".showmethods"),Page.showAttributes||(e=e+".hideattributes")),Page.useGvFeatureDiagram&&(e="language=featureDiagram",Page.showFeatureDependency&&(e=e+".showFeatureDependency")),copyableMixset="",Page.filterWordsOutput!=""){e=e+".!@FW!@"+Page.filterWordsOutput;var t="";Page.filterWordsOutput.split("!@").forEach(function(a){a!=""&&(isNaN(a)?a.substr(0,2)=="gv"?a.substr(0,11)=="gvseparator"?copyableMixset+='  suboption "'+a.replace("@@@","")+`";
`:copyableMixset+='  suboption "'+a+`";
`:a.substr(0,6)=="filter"?copyableMixset+="  filter {includeFilter "+a.substr(6)+`;}
`:a.substr(0,6)=="mixset"?copyableMixset+="  use "+a.substr(6)+`;
`:t+=" include "+a+";":t+="  hops { association "+a+";} ")}),t!=""&&(copyableMixset+="  filter {"+t+`}
`)}Page.filtersActive.forEach(function(a){e=e+".filter"+a,copyableMixset+="  filter {includeFilter "+a+`;}
`}),Page.mixsetsActive.forEach(function(a){e=e+".mixset"+a,copyableMixset+="  use "+a+`;
`}),Page.specialSuboptionsActive.forEach(function(a){e=e+"."+a,copyableMixset+='  suboption "'+a+`";
`});var r=Math.floor(Math.random()*899+100);return Page.copyableMixset=`// The following was generated from the show and hide options
// Rename the mixset and paste into the code so you can invoke it at any time
mixset M`+r+` {
`+copyableMixset+"}",e};function showTab(e){jQuery("#innerGeneratedCodeRow").nextAll().hide(),jQuery("#innerGeneratedCodeRow"+e.data.tabnumber).show(),Page.showGeneratedCode(e.data.code,$("inputGenerateCode").value.split(":")[0],e.data.tabnumber),jQuery("#innerGeneratedCodeRow").hide()}Action.hidegdpr=function(){jQuery("#gdprtext").hide(),Action.gdprHidden=!0},Action.reindent=function(e,t){for(var r="",a="",n=e.length,o=!1,u=!0,s=0,d=-1,c=0;c<n;c++){for(var f=e[c].trim(),C=f.indexOf('"'),m=f.indexOf('"',C+1);C!=-1&&m!=-1;)f=f.slice(0,C)+f.slice(m+1,f.length),C=f.indexOf('"'),m=f.indexOf('"',C+1);if(f.indexOf("//")!=-1&&(f=f.substr(0,f.indexOf("//")).trim()),o)if(f.indexOf("*/")!=-1)f=f.substr(f.indexOf("*/")+2).trim(),o=!1;else{c!=e.length-1?a+=e[c]+`
`:a+=e[c];continue}else f.indexOf("/*")!=-1&&(f.indexOf("*/")==-1?(o=!0,f=f.substr(0,f.indexOf("/*")).trim()):f=f.substr(0,f.indexOf("/*"))+f.substr(f.indexOf("*/")+2).trim());var E=f.indexOf("{"),S=f.indexOf("}"),P=f.indexOf(";");if(P!=-1&&P!=f.length-1&&f.substr(P+1).trim().charAt(0)!="}"){e.splice(c+1,0,f.substr(P+1)),c<=t.line&&t.line++,e[c]=e[c].substr(0,e[c].match(/^\s*/)[0].length+P+1),Action.reindent(e,t);return}var N=E!=-1&&S!=-1&&S-E<40&&f.substr(0,S).indexOf("{",E+1)==-1;if(N){if(S!=f.length-1){e.splice(c+1,0,f.substr(S+1)),c<=t.line&&t.line++,e[c]=e[c].substr(0,e[c].match(/^\s*/)[0].length+S+1),Action.reindent(e,t);return}u?e[c]=r+e[c].trim():f.slice(-1)=="{"?u=!0:(e[c]=r+e[c].match(/^\s*/)[0].substr(s)+e[c].trim(),f.indexOf(";")==f.length-1&&(u=!0))}else{if(E!=-1&&E!=f.length-1){e.splice(c+1,0,f.substr(E+1)),e[c]=e[c].substr(0,e[c].match(/^\s*/)[0].length+E+1),c<=t.line&&t.line++,Action.reindent(e,t);return}if(S!=-1&&f.length>1){S==0?(e.splice(c+1,0,f.substr(1)),e[c]="}",c<=t.line&&t.line++):(e.splice(c+1,0,"}"),c<=t.line&&t.line++,S!=f.length-1&&(e.splice(c+2,0,f.substr(S+1)),c<=t.line&&t.line++),e[c]=e[c].substr(0,e[c].match(/^\s*/)[0].length+S)),Action.reindent(e,t);return}u&&f.indexOf(";")!=f.length-1&&f.slice(-1)!="{"&&f.slice(-1)!="}"&&f.slice(-2)!="||"&&(u=!1,s=e[c].match(/^\s*/)[0].length),S!=-1&&(r=r.substr(2)),u?e[c]=r+e[c].trim():f.slice(-1)=="{"||f.slice(-2)=="||"&&f.slice(-1)=="}"?(u=!0,e[c]=r+e[c].trim()):(e[c]=r+e[c].match(/^\s*/)[0].substr(s)+e[c].trim(),f.indexOf(";")==f.length-1&&(u=!0)),E!=-1&&(r+="  ")}c!=e.length-1?a+=e[c]+`
`:a+=e[c]}Page.codeMirrorOn&&Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:a}}),Action.updateCurrentUmpleTextBeingEdited(a);var R=Page.getRawUmpleCodeCM6().split(`
`)[Page.codeMirrorEditor6.state.doc.lineAt(Page.codeMirrorEditor6.state.selection.main.head).number],g=R.match(/^\s*/)[0].length;if(t.ch>=R.trim().length)Page.codeMirrorEditor6.dispatch({selection:{anchor:t.line,head:R.trim().length+g}});else if(t.ch>=0)Page.codeMirrorEditor6.dispatch({selection:{anchor:t.line,head:t.ch+g}});else{const v=Page.codeMirrorEditor6.state.selection.main.head;Page.codeMirrorEditor6.dispatch({selection:{anchor:v,head:v}})}Page.codeMirrorEditor6.focus()},DiagramEdit=new Object,DiagramEdit.textChangeQueue=[],DiagramEdit.pendingChanges=!1,DiagramEdit.newClass=null,DiagramEdit.newAssociation=null,DiagramEdit.newTransition=null,DiagramEdit.newGeneralization=null,DiagramEdit.updateUmpleText=function(e){DiagramEdit.textChangeQueue.length==0&&!DiagramEdit.pendingChanges?(DiagramEdit.pendingChanges=!0,DiagramEdit.textChangeQueue.push(e),DiagramEdit.doTextUpdate()):DiagramEdit.textChangeQueue.push(e),Action.umpleTypingActivity("diagramEdit")},DiagramEdit.doTextUpdate=function(){update=DiagramEdit.textChangeQueue.shift(),Action.update=update,update.codeChange&&Page.hideGeneratedCode(),Action.ajax(Action.updateUmpleTextCallback,update.actionCode)},DiagramEdit.addClass=function(e){Action.setjustUpdatetoSaveLater(!1),DiagramEdit.removeNewClass();var t=UmpleSystem.createClass(e),r=Json.toString(t);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=addClass&actionCode={0}",r),codeChange:!0})},DiagramEdit.addAssociation=function(e){Action.setjustUpdatetoSaveLater(!1),DiagramEdit.removeNewAssociation();var t=UmpleSystem.createAssociation(e.classOneId,e.classTwoId,e.classOnePosition.add(UmpleSystem.position()),e.classTwoPosition.add(UmpleSystem.position())),r=Json.toString(t);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=addAssociation&actionCode={0}",r),codeChange:!0})},DiagramEdit.addTransition=function(e){Action.setjustUpdatetoSaveLater(!1),DiagramEdit.removeNewTransition();var t=UmpleSystem.createTransition(e.fromStateId,e.toStateId),r=Json.toString(t);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=addTransition&actionCode={0}",r),codeChange:!0})},DiagramEdit.addGeneralization=function(e){Action.setjustUpdatetoSaveLater(!1),DiagramEdit.removeNewGeneralization(),UmpleSystem.createGeneralization(e.childId,e.parentId);var t=Json.toString(e);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=addGeneralization&actionCode={0}",t),codeChange:!0})},DiagramEdit.createAssociationPartOne=function(e){var t=new UmplePosition(e.pageX,e.pageY,0,0),r=UmpleSystem.position(),a=t.x-r.x,n=t.y-r.y;Action.classSelected(e.currentTarget),DiagramEdit.newAssociation=new UmpleAssociation,DiagramEdit.newAssociation.classOneId=e.currentTarget.id,DiagramEdit.newAssociation.classOnePosition=new UmplePosition(a,n,0,0)},DiagramEdit.createAssociationPartTwo=function(e){var t=new UmplePosition(e.pageX,e.pageY,0,0);Action.classSelected(e.currentTarget),DiagramEdit.newAssociation.classOneId<=e.currentTarget.id?(DiagramEdit.newAssociation.classTwoId=e.currentTarget.id,DiagramEdit.newAssociation.classTwoPosition=t.subtract(UmpleSystem.position())):(DiagramEdit.newAssociation.classTwoId=DiagramEdit.newAssociation.classOneId,DiagramEdit.newAssociation.classTwoPosition=DiagramEdit.newAssociation.classOnePosition,DiagramEdit.newAssociation.classOneId=e.currentTarget.id,DiagramEdit.newAssociation.classOnePosition=t.subtract(UmpleSystem.position())),DiagramEdit.addAssociation(DiagramEdit.newAssociation)},DiagramEdit.createTransitionPartOne=function(e){var t=new UmplePosition(e.pageX,e.pageY,0,0),r=UmpleSystem.position(),a=t.x-r.x,n=t.y-r.y;Action.classSelected(e.currentTarget),DiagramEdit.newTransition=new UmpleTransition,DiagramEdit.newTransition.fromStatePosition=e.currentTarget.id,DiagramEdit.newTransition.toStatePosition=new UmplePosition(a,n,0,0),DiagramEdit.newTransition.eventName="event1"},DiagramEdit.createTransitionPartTwo=function(e){var t=new UmplePosition(e.pageX,e.pageY,0,0);Action.classSelected(e.currentTarget),DiagramEdit.newTransition.toStateId=e.currentTarget.id,DiagramEdit.newTransition.toStatePosition=t.subtract(UmpleSystem.position()),DiagramEdit.addTransition(DiagramEdit.newTransition)},DiagramEdit.createGeneralizationPartOne=function(e){var t=UmpleSystem.find(e.currentTarget.id);if(t.extendsClass!=null)return!1;Action.classSelected(e.currentTarget),DiagramEdit.newGeneralization=new UmpleGeneralization,DiagramEdit.newGeneralization.childId=e.currentTarget.id,umpleSystem=UmpleSystem.position(),childPositionX=Dom.x(e)-umpleSystem.x,childPositionY=Dom.y(e)-umpleSystem.y,DiagramEdit.newGeneralization.childPosition=new UmplePosition(childPositionX,childPositionY,0,0)},DiagramEdit.createGeneralizationPartTwo=function(e){Action.classSelected(e.currentTarget),DiagramEdit.newGeneralization.parentId=e.currentTarget.id,DiagramEdit.newGeneralization.parentPosition=new UmplePosition(Dom.x(e),Dom.y(e),0,0),DiagramEdit.addGeneralization(DiagramEdit.newGeneralization)},DiagramEdit.classMoved=function(e){Action.setjustUpdatetoSaveLater(!1);var t=UmpleSystem.find(e.id),r=jQuery("#"+t.id);newPositionX=Math.floor(r.offset().left),newPositionY=Math.floor(r.offset().top),UmpleSystem.updatePosition(t,newPositionX,newPositionY);var a=Json.toString(t),n=Page.getUmpleCode();Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",a),codeChange:!1}),Action.classSelected(e),UmpleSystem.trimOverlappingAssociations(t)},DiagramEdit.classResized=function(e,t){Action.setjustUpdatetoSaveLater(!1);var r=e.target,a=r.id,n=UmpleSystem.find(a);UmpleSystem.updateClass(n),UmpleSystem.redrawGeneralizationsTo(n,C);for(var o=0;o<UmpleSystem.umpleAssociations.length;o++){var u=UmpleSystem.umpleAssociations[o];if(u.contains(n)){var s=u.classOneId==n.id,d=s?u.offsetOnePosition:u.offsetTwoPosition,c=s?"_anchor0":"_anchor1",f="#"+u.id+c,C=!0;DiagramEdit.associationMoved(f,C)}}var m=Json.toString(n),E=Page.getUmpleCode();Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",m),codeChange:!1}),Action.classSelected(r)},DiagramEdit.associationMoved=function(e,t){Action.setjustUpdatetoSaveLater(!1),DiagramEdit.newAssociation!=null&&DiagramEdit.removeNewAssociation(),t==null&&(t=!1);var r=jQuery(e).attr("id"),a=r.substr(0,r.length-8),n=UmpleSystem.findAssociation(a);Action.updateMovedAssociation(e,n);var o=Json.toString(n);Page.showLayoutLoading(),DiagramEdit.updateUmpleText({codeChange:!1,actionCode:format("action=editAssociation&actionCode={0}",o)})},DiagramEdit.regularAssociationMoving=function(e){if(DiagramEdit.newAssociation==null){var t=jQuery(e).attr("id"),r=t.substr(0,t.length-8),a=UmpleSystem.findAssociation(r),n=new UmpleAssociation;t.endsWith("_anchor0")?(n.classOneId=a.classTwoId,n.classOnePosition=a.classTwoPosition,n.offsetOnePosition=a.offsetTwoPosition):(n.classOneId=a.classOneId,n.classOnePosition=a.classOnePosition,n.offsetOnePosition=a.offsetOnePosition),DiagramEdit.newAssociation=n}var o=jQuery(e).offset(),u=Action.associationSnap(Math.round(o.left),Math.round(o.top),e),s=new UmplePosition(u[0],u[1]);DiagramEdit.newAssociation.classTwoPosition=s.subtract(UmpleSystem.position()),DiagramEdit.newAssociation.offsetTwoPosition=new UmplePosition(0,0,0,0);var d="#"+Page.umpleCanvasId();jQuery(d).append(DiagramEdit.newAssociation.drawable())},DiagramEdit.reflexiveAssociationMoving=function(e){var t=jQuery(e).attr("id"),r=t.substr(0,t.length-8),a=UmpleSystem.findAssociation(r);DiagramEdit.newAssociation==null&&(DiagramEdit.newAssociation=new UmpleAssociation,DiagramEdit.newAssociation.classOneId=a.classOneId,DiagramEdit.newAssociation.classTwoId=a.classTwoId,DiagramEdit.newAssociation.classOnePosition=a.classOnePosition,DiagramEdit.newAssociation.classTwoPosition=a.classTwoPosition,DiagramEdit.newAssociation.offsetOnePosition=a.offsetOnePosition,DiagramEdit.newAssociation.offsetTwoPosition=a.offsetTwoPosition,DiagramEdit.newAssociation.id=DiagramEdit.newAssociation.getElementId());var n=jQuery(e).offset(),o=Action.associationSnap(Math.round(n.left),Math.round(n.top),e),u=new UmplePosition(o[0],o[1],0,0),s=u.subtract(UmpleSystem.position());s.x=s.x-DiagramEdit.newAssociation.classOnePosition.x,s.y=s.y-DiagramEdit.newAssociation.classOnePosition.y,t.endsWith("_anchor0")?DiagramEdit.newAssociation.offsetOnePosition=s:DiagramEdit.newAssociation.offsetTwoPosition=s;var d="#"+Page.umpleCanvasId();jQuery(d).append(DiagramEdit.newAssociation.drawableReflexive())},DiagramEdit.classNameChanged=function(e,t,r){if(Action.setjustUpdatetoSaveLater(!1),r.length=!r.match(/^[_a-zA-Z0-9]+$/)){Action.updateUmpleDiagram();var a="Class names must be alphanumeric. &lt;"+r.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")+"&gt is not valid.";setTimeout(function(){Page.setFeedbackMessage(a)},2e3),setTimeout(function(){Page.setFeedbackMessage("")},1e4)}else{var n=UmpleSystem.renameClass(e,t,r);n.position.width=UmpleClassFactory.defaultSize.width;var o=Json.toString(n);delete n.oldname,Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",o),codeChange:!0})}},DiagramEdit.attributeNameChanged=function(e,t,r,a){if(Action.setjustUpdatetoSaveLater(!1),!Action.validateAttributeName(a))Action.updateUmpleDiagram(),setTimeout(function(){Page.setFeedbackMessage("UML Attributes must be alphanumeric with an optional type after a colon. &lt;"+a.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")+"&gt is not valid.")},2e3),setTimeout(function(){Page.setFeedbackMessage("")},1e4);else{var n=UmpleSystem.find(e);n.attributes[t].set(a),UmpleSystem.redraw(n);var o=Json.toString(n);Page.showModelLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",o),codeChange:!0}),n.resetAttribute(t)}},DiagramEdit.attributeNew=function(e,t){if(Action.setjustUpdatetoSaveLater(!1),!Action.validateAttributeName(t))Action.updateUmpleDiagram(),setTimeout(function(){Page.setFeedbackMessage("UML Attributes must be alphanumeric with an optional type after a colon. &lt;"+t.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")+"&gt is not valid.")},2e3),setTimeout(function(){Page.setFeedbackMessage("")},1e4);else{var r=UmpleSystem.find(e),a=r.addAttribute(t),n=Json.toString(r);Page.showModelLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",n),codeChange:!0}),r.resetAttribute(a),UmpleSystem.updateClass(r),UmpleSystem.redrawGeneralizationsTo(r),UmpleSystem.trimOverlappingAssociations(r),UmpleSystem.update()}},DiagramEdit.classDeleted=function(e){Action.setjustUpdatetoSaveLater(!1);for(var t=!0,r=UmpleSystem.find(e),a=[],n=[],o=0;o<UmpleSystem.umpleAssociations.length;o++){var u=UmpleSystem.umpleAssociations[o];u.contains(r)&&a.push(u.id)}for(var o=0;o<UmpleSystem.umpleClasses.length;o++){var s=UmpleSystem.umpleClasses[o];s.extendsClass==r.id&&n.push(s.id+"_generalization")}for(var o=0;o<a.length;o++)DiagramEdit.associationDeleted(a[o],t);for(var o=0;o<n.length;o++)DiagramEdit.generalizationDeleted(n[o],t);var d=UmpleSystem.removeClass(e),c=Json.toString(d);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=removeClass&actionCode={0}",c),codeChange:!0})},DiagramEdit.methodNew=function(e,t){if(Action.setjustUpdatetoSaveLater(!1),!Action.validateMethodName(t))Action.updateUmpleDiagram(),setTimeout(function(){Page.setFeedbackMessage("Invalid UML Method. &lt;"+t.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")+"&gt is not valid.")},2e3),setTimeout(function(){Page.setFeedbackMessage("")},1e4);else{var r=UmpleSystem.find(e),a=r.addMethod(t),n=Json.toString(r);Page.showModelLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",n),codeChange:!0}),r.resetMethod(a),UmpleSystem.updateClass(r),UmpleSystem.redrawGeneralizationsTo(r),UmpleSystem.trimOverlappingAssociations(r),UmpleSystem.update()}},DiagramEdit.methodChanged=function(e,t,r,a){if(Action.setjustUpdatetoSaveLater(!1),!Action.validateMethodName(a))Action.updateUmpleDiagram(),setTimeout(function(){Page.setFeedbackMessage("Invalid UML Method. &lt;"+a.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")+"&gt is not valid.")},2e3),setTimeout(function(){Page.setFeedbackMessage("")},1e4);else{var n=UmpleSystem.find(e);n.methods[t].set(a),UmpleSystem.redraw(n);var o=Json.toString(n);Page.showModelLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",o),codeChange:!0}),n.resetMethod(t)}},DiagramEdit.methodDelete=function(e,t){Action.setjustUpdatetoSaveLater(!1);var r=UmpleSystem.find(e);r.removeMethod(t);var a=jQuery("#"+r.id);r.position.width=UmpleClassFactory.defaultSize.width;var n=Json.toString(r);Page.showModelLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",n),codeChange:!0}),r.resetMethod(t),UmpleSystem.updateClass(r),UmpleSystem.redrawGeneralizationsTo(r),UmpleSystem.trimOverlappingAssociations(r),UmpleSystem.update()},DiagramEdit.attributeDelete=function(e,t){Action.setjustUpdatetoSaveLater(!1);var r=UmpleSystem.find(e);r.removeAttribute(t);var a=jQuery("#"+r.id);r.position.width=UmpleClassFactory.defaultSize.width;var n=Json.toString(r);Page.showModelLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",n),codeChange:!0}),r.resetAttribute(t),UmpleSystem.updateClass(r),UmpleSystem.redrawGeneralizationsTo(r),UmpleSystem.trimOverlappingAssociations(r),UmpleSystem.update()},DiagramEdit.associationDeleted=function(e,t){Action.setjustUpdatetoSaveLater(!1),t==null&&(t=!1);var r=UmpleSystem.removeAssociation(e),a=Json.toString(r);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=removeAssociation&actionCode={0}",a),codeChange:!0})},DiagramEdit.transitionDeleted=function(e,t){Action.setjustUpdatetoSaveLater(!1),t==null&&(t=!1);var r=UmpleSystem.removeTransition(e),a=Json.toString(r);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=removeTransition&actionCode={0}",a),codeChange:!0})},DiagramEdit.generalizationDeleted=function(e,t){Action.setjustUpdatetoSaveLater(!1),t==null&&(t=!1);var r=UmpleSystem.removeGeneralization(e),a=Json.toString(r);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=removeGeneralization&actionCode={0}",a),codeChange:!0})},DiagramEdit.removeNewClass=function(){if(DiagramEdit.newClass!=null){var e="#"+DiagramEdit.newClass.id;return DiagramEdit.newClass=null,jQuery(e).remove(),!0}return!1},DiagramEdit.removeNewAssociation=function(){if(DiagramEdit.newAssociation!=null){var e="#"+DiagramEdit.newAssociation.getElementId();return jQuery(e).remove(),DiagramEdit.newAssociation=null,!0}return!1},DiagramEdit.removeNewTransition=function(){if(DiagramEdit.newTransition!=null){var e="#"+DiagramEdit.newTransition.getElementId();return jQuery(e).remove(),DiagramEdit.newTransition=null,!0}return!1},DiagramEdit.removeNewGeneralization=function(){if(DiagramEdit.newGeneralization!=null){var e="#"+DiagramEdit.newGeneralization.getElementId();return jQuery(e).remove(),DiagramEdit.newGeneralization=null,!0}return!1},UmpleAssociationFactory=new Object,UmpleAssociationFactory.create=function(e){var t=new UmpleAssociation;return t.id=e.id,t.classOneId=e.classOneId,t.classTwoId=e.classTwoId,t.offsetOnePosition=UmplePositionFactory.copy(e.offsetOnePosition),t.offsetTwoPosition=UmplePositionFactory.copy(e.offsetTwoPosition),t.multiplicityOne=e.multiplicityOne,t.multiplicityTwo=e.multiplicityTwo,t.name=e.name,t.roleOne=e.roleOne,t.roleTwo=e.roleTwo,t.isSymmetricReflexive=e.isSymmetricReflexive=="true"||e.isSymmetricReflexive==!0,t.isLeftNavigable=e.isLeftNavigable=="true"||e.isLeftNavigable==!0,t.isRightNavigable=e.isRightNavigable=="true"||e.isRightNavigable==!0,t.isLeftComposition=e.isLeftComposition=="true"||e.isLeftComposition==!0,t.isRightComposition=e.isRightComposition=="true"||e.isRightComposition==!0,t.color=e.isTraced,t};function UmpleAssociation(){this.id,this.classOneId,this.classTwoId,this.classOnePosition=null,this.classTwoPosition=null,this.offsetOnePosition=null,this.offsetTwoPosition=null,this.multiplicityOne="",this.multiplicityTwo="",this.name="",this.roleOne="",this.roleTwo="",this.isSymmetricReflexive=!1,this.isLeftNavigable=!0,this.isRightNavigable=!0,this.isLeftComposition=!1,this.isRightComposition=!1,this.color="black",this.setClasses=function(e,t){this.classOneId=e,this.classTwoId=t},this.setDefaultMultiplicities=function(){this.multiplicityOne="*",this.multiplicityTwo="*"},this.setDefaultRoles=function(){this.classOneId==this.classTwoId&&(this.roleTwo="roleName")},this.setRoles=function(e,t){this.roleOne=e,this.roleTwo=t},this.setName=function(e){this.name=e},this.getName=function(){return this.name==null||this.name==""?this.deriveName():this.name},this.deriveName=function(){var e="",t=this.classOneId,r=this.classTwoId;return this.roleOne==null||this.roleOne===""||(t=this.classOneId+":"+this.roleOne),this.roleTwo==null||this.roleTwo===""||(r=this.classTwoId+":"+this.roleTwo),this.classOneId<=this.classTwoId?e=t+"__"+r:e=r+"__"+t,e},this.getElementId=function(){return this.id==null?"newassociation":this.id},this.getClass=function(e){return e==0?UmpleSystem.find(this.classOneId):UmpleSystem.find(this.classTwoId)},this.setOffsetOnePosition=function(e){var t=UmpleSystem.find(this.classOneId);this.classOnePosition=t.position,this.offsetOnePosition=e.subtract(t.position).subtract(UmpleSystem.position()),this.offsetOnePosition.width=0,this.offsetOnePosition.height=0},this.setOffsetTwoPosition=function(e){var t=UmpleSystem.find(this.classTwoId);this.classTwoPosition=t.position,this.offsetTwoPosition=e.subtract(t.position).subtract(UmpleSystem.position()),this.offsetTwoPosition.width=0,this.offsetTwoPosition.height=0},this.trimOverlap=function(){for(var e=new UmpleLine(this.offsetOnePosition.add(this.classOnePosition),this.offsetTwoPosition.add(this.classTwoPosition)),t=UmpleSystem.find(this.classOneId).borderLines(),r=UmpleSystem.find(this.classTwoId).borderLines(),a=this.offsetOnePosition.add(this.classOnePosition),n=this.offsetTwoPosition.add(this.classTwoPosition),o=[],u=[],s=0;s<t.length;s++)intersection=e.intersection(t[s]),intersection!=null&&o.push(intersection);for(var s=0;s<r.length;s++)intersection=e.intersection(r[s]),intersection!=null&&u.push(intersection);for(var d=new UmpleLine(a,n),c=new UmpleLine(d.pointOne,d.pointTwo),s=0;s<o.length;s++)c.pointOne=o[s],c.length()<d.length()&&(d=new UmpleLine(c.pointOne,c.pointTwo));for(var c=new UmpleLine(d.pointOne,d.pointTwo),s=0;s<u.length;s++)c.pointTwo=u[s],c.length()<d.length()&&(d=new UmpleLine(c.pointOne,c.pointTwo));this.setOffsetOnePosition(d.pointOne.add(UmpleSystem.position())),this.setOffsetTwoPosition(d.pointTwo.add(UmpleSystem.position()))},this.adjustReflexiveEndpoints=function(){var e=this.offsetOnePosition,t=this.offsetTwoPosition,r=UmpleSystem.find(this.classOneId).borderLines();this.snapToClosestEdge(e,r),this.snapToClosestEdge(t,r)},this.snapToClosestEdge=function(e,t){var r=!0,a=!0,n=e.x+this.classOnePosition.x,o=e.y+this.classOnePosition.y,u=o-t[0].pointOne.y,s=n-t[1].pointOne.x;u>t[2].pointOne.y-o&&(r=!1,u=t[2].pointOne.y-o),s>t[3].pointOne.x-n&&(a=!1,s=t[3].pointOne.x-n),u<=s?r?e.y=0:e.y=this.classOnePosition.height:a?e.x=0:e.x=this.classOnePosition.width},this.drawable=function(){return this.id==null?associationDiv=this.drawableTemp():this.isReflexive()?associationDiv=this.drawableReflexive():this.isComposition()?associationDiv=this.drawableComposition():this.isBidirectional()?associationDiv=this.drawableBidirectional():associationDiv=this.drawableUnidirectional(),associationDiv},this.drawableTemp=function(){var e="#"+this.getElementId();jQuery(e).remove();var t=this.createBaseJQueryObject();t.addClass("umpleAssociationTemp"),t.attr("id","newassociation");var r=new UmpleLine(this.classOnePosition.add(this.offsetOnePosition),this.classTwoPosition.add(this.offsetTwoPosition));return t.append(r.drawable()),t},this.drawableBidirectional=function(){var e="#"+this.id;jQuery(e).remove();var t=this.createBaseJQueryObject();this.color=="red"?t.addClass("redTracedAssociation"):t.addClass("untracedAssociation"),t.attr("id",this.id),t.attr("tabindex",2);var r=UmpleSystem.find(this.classOneId),a=UmpleSystem.find(this.classTwoId);if(r==null||r==null||a==null||a==null)return t;this.classOnePosition=r.position,this.classTwoPosition=a.position;var n=this.classOnePosition.add(this.offsetOnePosition),o=this.classTwoPosition.add(this.offsetTwoPosition),u=new UmpleLine(n.add(UmpleClassFactory.offsetError),o.add(UmpleClassFactory.offsetError));this.isComposition()||t.append(u.drawable());var s="",d=-3;s+=this.anchorDivHtml("hover",0,n.x+d,n.y+d),s+=this.anchorDivHtml("anchor",0,n.x+d,n.y+d),s+=this.anchorDivHtml("hover",1,o.x+d,o.y+d),s+=this.anchorDivHtml("anchor",1,o.x+d,o.y+d);var c=n.slopeAngle(o),f=this.multiplicityPosition(!0),C=this.multiplicityPosition(!1),m=this.multiplicityDivHtml("one",this.multiplicityOne,f.x,f.y),E=this.multiplicityDivHtml("two",this.multiplicityTwo,C.x,C.y);if(this.roleOne!=""){roleOnePosition=this.rolePosition(!0);var S=this.roleDivHtml("one",this.roleOne,roleOnePosition.x,roleOnePosition.y)}else S="";if(this.roleTwo!=""){roleTwoPosition=this.rolePosition(!1);var P=this.roleDivHtml("two",this.roleTwo,roleTwoPosition.x,roleTwoPosition.y)}else P="";return currentHtml=t.html(),t.html(m+E+S+P+s+currentHtml),t},this.drawableUnidirectional=function(){var e=this.drawableBidirectional(),t=null;this.isLeftNavigable?(t=this.classOnePosition.add(this.offsetOnePosition),otherEnd=this.classTwoPosition.add(this.offsetTwoPosition)):(t=this.classTwoPosition.add(this.offsetTwoPosition),otherEnd=this.classOnePosition.add(this.offsetOnePosition));var r=t.slopeAngle360(otherEnd),a=r+30,n=r-30,o=10,u=t.travelForward(o,a),s=t.travelForward(o,n),d=new UmpleLine(t.add(UmpleClassFactory.offsetError),u.add(UmpleClassFactory.offsetError)),c=new UmpleLine(t.add(UmpleClassFactory.offsetError),s.add(UmpleClassFactory.offsetError));return e.append(d.drawable()),e.append(c.drawable()),e},this.drawableComposition=function(){var e=this.drawableBidirectional(),t=null;this.isLeftComposition?(t=this.classOnePosition.add(this.offsetOnePosition),otherEnd=this.classTwoPosition.add(this.offsetTwoPosition)):(t=this.classTwoPosition.add(this.offsetTwoPosition),otherEnd=this.classOnePosition.add(this.offsetOnePosition));var r=t.slopeAngle360(otherEnd),a=r+30,n=r-30,o=8,u=t.travelForward(o,a),s=t.travelForward(o,n),d=u.travelForward(o,n),c=new UmpleLine(t.add(UmpleClassFactory.offsetError),u.add(UmpleClassFactory.offsetError)),f=new UmpleLine(t.add(UmpleClassFactory.offsetError),s.add(UmpleClassFactory.offsetError)),C=new UmpleLine(u.add(UmpleClassFactory.offsetError),d.add(UmpleClassFactory.offsetError)),m=new UmpleLine(s.add(UmpleClassFactory.offsetError),d.add(UmpleClassFactory.offsetError));e.append(c.drawable()),e.append(f.drawable()),e.append(C.drawable()),e.append(m.drawable());var E=new UmpleLine(d.add(UmpleClassFactory.offsetError),otherEnd.add(UmpleClassFactory.offsetError));e.append(E.drawable());var S=4,P=t.travelForward(S,a),N=t.travelForward(S,n),R=u.travelForward(S,n),g=s.travelForward(S,a),v=new UmpleLine(t.add(UmpleClassFactory.offsetError),R.add(UmpleClassFactory.offsetError)),M=new UmpleLine(t.add(UmpleClassFactory.offsetError),g.add(UmpleClassFactory.offsetError)),L=new UmpleLine(t.add(UmpleClassFactory.offsetError),d.add(UmpleClassFactory.offsetError)),T=new UmpleLine(u.add(UmpleClassFactory.offsetError),g.add(UmpleClassFactory.offsetError)),A=new UmpleLine(u.add(UmpleClassFactory.offsetError),N.add(UmpleClassFactory.offsetError)),j=new UmpleLine(u.add(UmpleClassFactory.offsetError),s.add(UmpleClassFactory.offsetError)),k=new UmpleLine(s.add(UmpleClassFactory.offsetError),P.add(UmpleClassFactory.offsetError)),U=new UmpleLine(s.add(UmpleClassFactory.offsetError),R.add(UmpleClassFactory.offsetError)),_=new UmpleLine(d.add(UmpleClassFactory.offsetError),P.add(UmpleClassFactory.offsetError)),Q=new UmpleLine(d.add(UmpleClassFactory.offsetError),N.add(UmpleClassFactory.offsetError)),W=new UmpleLine(P.add(UmpleClassFactory.offsetError),N.add(UmpleClassFactory.offsetError)),F=new UmpleLine(P.add(UmpleClassFactory.offsetError),R.add(UmpleClassFactory.offsetError)),p=new UmpleLine(P.add(UmpleClassFactory.offsetError),g.add(UmpleClassFactory.offsetError)),D=new UmpleLine(N.add(UmpleClassFactory.offsetError),R.add(UmpleClassFactory.offsetError)),O=new UmpleLine(N.add(UmpleClassFactory.offsetError),g.add(UmpleClassFactory.offsetError)),G=new UmpleLine(R.add(UmpleClassFactory.offsetError),g.add(UmpleClassFactory.offsetError));return e.append(v.drawable()),e.append(M.drawable()),e.append(L.drawable()),e.append(T.drawable()),e.append(A.drawable()),e.append(j.drawable()),e.append(k.drawable()),e.append(U.drawable()),e.append(_.drawable()),e.append(Q.drawable()),e.append(W.drawable()),e.append(F.drawable()),e.append(p.drawable()),e.append(D.drawable()),e.append(O.drawable()),e.append(G.drawable()),e},this.drawableReflexive=function(){var e="#"+this.id;jQuery(e).remove();var t=this.createBaseJQueryObject();this.color=="red"?t.addClass("redTracedAssociation"):t.addClass("untracedAssociation"),t.attr("id",this.id),t.attr("tabindex",2);var r=UmpleSystem.find(this.classOneId);this.classOnePosition=r.position,this.classTwoPosition=r.position;var a=r.position.height,n=r.position.width,o=15,u=this.whichWall(!0);factorX=u=="West"?-1:u=="South"?0:u=="East"?1:0,factorY=u=="West"?0:u=="South"?1:u=="East"?0:-1;var s=this.offsetOnePosition.add(this.classOnePosition),d=this.offsetOnePosition.add(this.classOnePosition).add(new UmplePosition(o*factorX,o*factorY,0,0));u=="South"&&(s.y=s.y-1);var c=new UmpleLine(s,d),f=this.whichWall(!1);factorX=f=="West"?-1:f=="South"?0:f=="East"?1:0,factorY=f=="West"?0:f=="South"?1:f=="East"?0:-1;var C=this.offsetTwoPosition.add(this.classTwoPosition),m=this.offsetTwoPosition.add(this.classTwoPosition).add(new UmplePosition(o*factorX,o*factorY,0,0)),E=new UmpleLine(C,m);t.append(c.drawable()),t.append(E.drawable());var S=new UmplePosition(0,0,0,0);if(u==f){var P=new UmpleLine(d,m);u=="North"||u=="South"?this.isSymmetricReflexive&&(S.x=(d.x+m.x)/2,S.y=d.y):this.isSymmetricReflexive&&(S.x=d.x,S.y=(d.y+m.y)/2),t.append(P.drawable())}else if(this.offsetOnePosition.wallsAreAdjacent(u,f)){var N=new UmplePosition(0,0,0,0),R=u=="West"||f=="West",g=u=="North"||f=="North";R?N.x=this.classOnePosition.x-o:N.x=this.classOnePosition.x+n+o,g?N.y=this.classOnePosition.y-o:N.y=this.classOnePosition.y+a+o;var v=new UmpleLine(d,N),M=new UmpleLine(m,N);t.append(v.drawable()),t.append(M.drawable()),this.isSymmetricReflexive&&S.set(N.x,N.y)}else{var L=new UmplePosition(0,0,0,0),T=new UmplePosition(0,0,0,0),A,j,k,U,_;u=="South"||f=="South"?(L.x=this.classOnePosition.x-o,L.y=this.classOnePosition.y-o,T.x=L.x,T.y=this.classOnePosition.y+a+o,f=="South"?(U=d,_=m):(U=m,_=d),this.isSymmetricReflexive&&(S.x=L.x,S.y=(L.y+T.y)/2)):(L.x=this.classOnePosition.x-o,L.y=this.classOnePosition.y+a+o,T.x=this.classOnePosition.x+n+o,T.y=L.y,f=="East"?(U=d,_=m):(U=m,_=d),this.isSymmetricReflexive&&(S.x=(L.x+T.x)/2,S.y=L.y)),A=new UmpleLine(U,L),j=new UmpleLine(L,T),k=new UmpleLine(T,_),t.append(A.drawable()),t.append(j.drawable()),t.append(k.drawable())}if(!this.isSymmetricReflexive){var Q=new UmplePosition(0,0,0,0);u=="North"||u=="South"?(S.x=d.x,S.y=(s.y+d.y)/2):(S.x=(s.x+d.x)/2,S.y=d.y),f=="North"||f=="South"?(Q.x=m.x,Q.y=(C.y+m.y)/2):(Q.x=(C.x+m.x)/2,Q.y=m.y)}var W="",F=s,p=C,D=3;if(W+=this.anchorDivHtml("hover",0,F.x-D,F.y-D),W+=this.anchorDivHtml("anchor",0,F.x-D,F.y-D),W+=this.anchorDivHtml("hover",1,p.x-D,p.y-D),W+=this.anchorDivHtml("anchor",1,p.x-D,p.y-D),this.isSymmetricReflexive)var O=UmplePositionFactory.copy(this.centerMultiplicityPosition(S)),G=this.adjustRolePosition(S,!0),V=this.roleDivHtml("center",this.roleOne,G.x,G.y),te=this.multiplicityDivHtml("center",this.multiplicityOne,O.x,O.y);else var J=UmplePositionFactory.copy(this.reflexiveMultiplicityPosition(S,Q,!0)),re=UmplePositionFactory.copy(this.reflexiveMultiplicityPosition(Q,S,!1)),ne=this.adjustRolePosition(S,!0),K=this.adjustRolePosition(Q,!1),V=this.roleDivHtml("one",this.roleOne,ne.x,ne.y)+this.roleDivHtml("two",this.roleTwo,K.x,K.y),te=this.multiplicityDivHtml("one",this.multiplicityOne,J.x,J.y)+this.multiplicityDivHtml("two",this.multiplicityTwo,re.x,re.y);if(this.id==null)return t.attr("id","newassociation"),t;var ue=t.html();return t.html(te+V+W+ue),t},this.isReflexive=function(){return this.classOneId==this.classTwoId||this.isSymmetricReflexive},this.isBidirectional=function(){return this.isRightNavigable==null||this.isLeftNavigable==null?!0:this.isRightNavigable&&this.isLeftNavigable},this.isComposition=function(){return this.isRightComposition||this.isLeftComposition},this.endHasArrow=function(e){return e?this.isLeftNavigable:this.isRightNavigable},this.contains=function(e){return e.id==this.classOneId||e.id==this.classTwoId},this.anchorDivHtml=function(e,t,r,a){return format('<div id="{0}_{1}{2}" class="{1}" name="{1}" style="left: {3}px; top: {4}px; cursor: pointer; display: none;"><img name="image" src="./scripts/_.gif"/></div>',this.id,e,t,r,a)},this.multiplicityDivHtml=function(e,t,r,a,n){return(n==null||n=="undefined")&&(n=""),format('<div id="{0}_{1}" class="multiplicity" name="{1}" style="left: {2}px; top: {3}px; cursor: pointer;">{4}&nbsp;&nbsp;{5}</div>',this.id,e,r,a,t,n)},this.roleDivHtml=function(e,t,r,a){return e=="one"?idExtension="roleOne":e=="two"?idExtension="roleTwo":e=="center"?idExtension="role":idExtension="",format('<div id="{0}_{1}" class="role" name="{1}" style="left: {2}px; top: {3}px; cursor: pointer;">{4}</div>',this.id,idExtension,r,a,t)},this.whichWall=function(e){if(e)var t=this.classOnePosition,r=this.offsetOnePosition;else var t=this.classTwoPosition,r=this.offsetTwoPosition;var a=1;return r.x==0?"West":r.y==0?"North":Math.abs(r.x-t.width)<=a?"East":"South"},this.multiplicityPosition=function(e){if(e)var t=this.classOnePosition.add(this.offsetOnePosition),r=this.classTwoPosition.add(this.offsetTwoPosition),a=this.multiplicityOne;else var t=this.classTwoPosition.add(this.offsetTwoPosition),r=this.classOnePosition.add(this.offsetOnePosition),a=this.multiplicityTwo;var n=this.whichWall(e),o=a=="*"?new UmplePosition(0,10,0,0):new UmplePosition(0,16,0,0),u=new UmplePosition(5*a.length+1,0,0,0),s=3;(!this.isBidirectional()&&this.endHasArrow(e)||this.isComposition())&&(s+=5);var d=t.slopeAngle360(r);if(n=="North")if(d<90){var c=(180-d)/2+d,f=t.travelForward(s,c);f=f.subtract(u),f=f.subtract(o)}else{var c=d/2,f=t.travelForward(s,c);f=f.subtract(o)}else if(n=="East")if(d>=0&&d<=90)var c=(d+90)/2+270,f=t.travelForward(s,c);else{var c=((360-d+90)/2+d)%360,f=t.travelForward(s,c);f=f.subtract(o)}else if(n=="South")if(d<=270)var c=(360-d)/2+d,f=t.travelForward(s,c),C=f;else{var c=(d-180)/2+180,f=t.travelForward(s,c),C=f;f=f.subtract(u)}else if(d<=180){var c=(270-d)/2+d,f=t.travelForward(s,c);f=f.subtract(u)}else{var c=(d-90)/2+90,f=t.travelForward(s,c);f=f.subtract(o),f=f.subtract(u)}return f},this.centerMultiplicityPosition=function(e){var t=this.whichWall(!0),r=this.whichWall(!1),a=1,n=5;return e.width=5*this.multiplicityOne.length+n+6*this.roleOne.length,e.height=16,t=="West"&&r=="West"||t=="North"&&r=="South"||t=="South"&&r=="North"?(e.x-=e.width+a,e.y-=e.height/2):t=="East"&&r=="East"?(e.x+=a,e.y-=e.height/2):t=="North"||r=="North"?(e.y-=a+e.height,e.x-=e.width/2):(e.y+=a,e.x-=e.width/2),e},this.reflexiveMultiplicityPosition=function(e,t,r){var a=5,n=1;if(r)var o=this.whichWall(!0),u=this.whichWall(!1),s=this.multiplicityOne.length,d=this.roleOne.length;else var o=this.whichWall(!1),u=this.whichWall(!0),s=this.multiplicityTwo.length,d=this.roleTwo.length;return e.width=5*s+a+6*d,e.height=16,o=="North"?(e.y-=e.height/2,u=="North"&&e.x<t.x||u=="East"?e.x-=e.width+n:e.x+=n):o=="East"?u=="East"&&e.y<t.y||u=="South"||u=="West"?e.y-=e.height:e.y+=n:o=="South"?(e.y-=e.height/2,u=="South"&&e.x<t.x||u=="East"?e.x-=e.width+n:e.x+=n):o=="West"&&(e.x-=e.width,u=="West"&&e.y<t.y||u=="East"||u=="South"?e.y-=e.height:e.y+=n),e},this.rolePosition=function(e){var t=e?this.multiplicityOne:this.multiplicityTwo,r=e?this.roleOne:this.roleTwo,a=e?this.classOnePosition.add(this.offsetOnePosition):this.classTwoPosition.add(this.offsetTwoPosition),n=e?this.classTwoPosition.add(this.offsetTwoPosition):this.classOnePosition.add(this.offsetOnePosition),o=new UmplePosition(5*t.length,0,0,0),u=new UmplePosition(6*r.length,0,0,0,0),s=new UmplePosition(0,16,0,0),d=s,c=new UmplePosition(5,0,0,0),f=this.multiplicityPosition(e),C=this.whichWall(e),m=a.slopeAngle360(n);return C=="North"?(m<90?rolePosition=f.subtract(u).subtract(o):rolePosition=f.add(o).add(c),t=="*"&&(rolePosition=rolePosition.subtract(new UmplePosition(0,6,0,0)))):C=="East"||C=="South"&&m<=270?rolePosition=f.add(o).add(c):rolePosition=f.subtract(u).subtract(o),rolePosition},this.adjustRolePosition=function(e,t){var r=t?this.multiplicityOne.length:this.multiplicityTwo.length;return e.x+=5*r+6,e},this.createBaseJQueryObject=function(){return jQuery(format("<div class='{0}'></div>",this.getName()))}}UmpleAttributeFactory=new Object,UmpleAttributeFactory.create=function(e){var t=e.type,r=e.name,a=e.traceColor;a==""&&(a="black");var n=new UmpleAttribute(t,r,a);return n};function UmpleAttribute(e,t,r){this.type=e,this.name=t,this.textColor=r,(this.aColor===""||this.aColor===void 0)&&(this.aColor="black"),this.set=function(a){this.textColor="black";var n=this.type!=""&&this.name!="";n&&(this.oldType=this.type,this.oldName=this.name);var o=a.split(":");o.length<2?(this.type="String",this.name=a):(this.name=o[0].trim(),this.type=o[1].trim()),n||(this.newType=this.type,this.newName=this.name)},this.copy=function(){return new UmpleAttribute(this.type,this.name,this.textColor)}}UmpleClassFactory=new Object,UmpleClassFactory.defaultSize=new UmplePosition(0,0,109,41),UmpleClassFactory.offsetError=new UmplePosition(0,0,0,0),UmpleClassFactory.create=function(e){var t=new UmpleClass;t.id=e.id,t.name=e.name,t.isInterface=e.isInterface,t.isAbstract=e.isAbstract,t.displayColor=e.displayColor,t.displayColor==""&&(t.displayColor="transparent"),t.position.x=e.position.x,t.position.y=e.position.y,t.position.width=e.position.width,t.position.height=e.position.height,t.extendsClass=e.extendsClass;for(var r=0;r<e.attributes.length;r++)e.attributes[r].modifier!="const"&&t.attributes.push(UmpleAttributeFactory.create(e.attributes[r]));for(var r=0;r<e.methods.length;r++)t.methods.push(UmpleMethodFactory.create(e.methods[r]));if(e.implementedInterfaces!=null)for(var r=0;r<e.implementedInterfaces.length;r++)t.interfaces[r]=e.implementedInterfaces[r].interfacesName+"";return t},UmpleClassFactory.perimeterPosition=function(e,t,r){typeof r>"u"&&(r=new UmplePosition(0,0,0,0));var a=t.x,n=t.y,o=0,u=r.x+e.position.x+o,s=u+e.position.width,d=r.y+e.position.y+o,c=d+e.position.height,f=a<u?u:a>s?s:a,C=n<d?d:n>c?c:n,m=a-u,E=s-a,S=n-d,P=c-n,N=Math.min(m,E),R=Math.min(S,P);return N<R?f=m<E?u:s:R<N&&(C=S<P?d:c),new UmplePosition(Math.round(f),Math.round(C),0,0)};function UmpleClass(){this.id,this.name,this.isInterface,this.isAbstract,this.displayColor="transparent",this.position=new UmplePosition(0,0,109,41),this.attributes=[],this.methods=[],this.interfaces=[],this.extendsClass,this.addAttribute=function(e){var t=new UmpleAttribute("","","");return t.set(e),this.attributes.push(t),this.attributes.length-1},this.removeAttribute=function(e){var t=this.attributes[e];t.deleteType=t.type,t.deleteName=t.name},this.resetAttribute=function(e){this.attributes[e].deleteName!=null?this.attributes.splice(e,1):this.attributes[e]=this.attributes[e].copy()},this.resetMethod=function(e){this.methods[e].deleteName!=null?this.methods.splice(e,1):this.methods[e]=this.methods[e].copy()},this.addMethod=function(e){var t=new UmpleMethod("","","","");return t.set(e),this.methods.push(t),this.methods.length-1},this.removeMethod=function(e){var t=this.methods[e];t.deleteType=t.type,t.deleteVisibility=t.visibility,t.deleteName=t.name,t.deleteParameters=t.parameters},this.setExtendsClass=function(e){this.extendsClass=e},this.removeExtendsClass=function(){this.extendsClass=null},this.borderLines=function(){var e=jQuery("#"+this.id),t=e.width(),r=e.height(),a=this.position,n=this.position.add(new UmplePosition(t,0,0,0)),o=this.position.add(new UmplePosition(0,r,0,0)),u=this.position.add(new UmplePosition(t,r,0,0));return borders=[],borders.push(new UmpleLine(a,n)),borders.push(new UmpleLine(a,o)),borders.push(new UmpleLine(o,u)),borders.push(new UmpleLine(n,u)),borders},this.drawable=function(){var e=this.drawClass(),t=this.drawGeneralization(),r=[e,t];return r},this.drawClass=function(){var e="#"+this.id,t=jQuery(e).get();t==null||t==null||t==""?(classDiv=jQuery("<div></div>"),classDiv.addClass("umpleClass"),classDiv.attr("tabindex",2)):(classDiv=jQuery(t),removalSel=format("div#{0} .classTable,div#{0} .umpleAttribute,div#{0} .umpleAttributeNew,div#{0} .anchor, div#{0} .hover",this.id),jQuery(removalSel).remove()),classDiv.attr("id",this.id);var r=-3.5,a=-3,n="",o="",u="";if(this.attributes.length>0)for(var s=0;s<this.attributes.length;s++){var d=this.attributes[s],c="";d.textColor!="black"&&(c=format("style='color:{0}'",d.textColor)),Page.isPhotoReady()?n+=format('<div class="umpleAttribute" {3}>{0} : {1}</div>',d.name,d.type,c):n+=format('<div class="umpleAttribute" {5}><span id="{2}_attribute_{3}" name="attributeEdit" class="editable editableDoubleClick">{0} : {1}</span> <img src="scripts/delete2.jpg" onclick="DiagramEdit.attributeDelete({4}{2}{4},{4}{3}{4})" /></div>',d.name,d.type,this.id,s,"'",c)}if(this.methods.length>0)for(var s=0;s<this.methods.length;s++){var f=this.methods[s],C="";f.visibility=="public"?C="+ ":f.visibility=="private"?C="- ":f.visibility=="protected"?C="# ":C="+ ";var m=f.type==""?"void":f.type;Page.isPhotoReady()?f.isAbstract=="true"?o+=format('<div class="umpleMethod">{3}<span style="font-style:italic">{1}({2}) </span> : {0} </div>',m,f.name,f.parameters,C):o+=format('<div class="umpleMethod">{3}{1}({2}) : {0} </div>',m,f.name,f.parameters,C):f.isAbstract=="true"?o+=format('<div class="umpleMethod"><span id="{4}_method_{5}" name="methodEdit" class="editable editableDoubleClick">{3}<span style="font-style:italic">{1}({2})</span> : {0} </span> <img src="scripts/delete2.jpg" onclick="DiagramEdit.methodDelete({6}{4}{6},{6}{5}{6})" /></div>',m,f.name,f.parameters,C,this.id,s,"'"):o+=format('<div class="umpleMethod"><span id="{4}_method_{5}" name="methodEdit" class="editable editableDoubleClick">{3}{1}({2}) : {0} </span> <img src="scripts/delete2.jpg" onclick="DiagramEdit.methodDelete({6}{4}{6},{6}{5}{6})" /></div>',m,f.name,f.parameters,C,this.id,s,"'")}n+=format('<div class="umpleAttributeNew"><span id="{0}_newAttribute" name="attributeNew" class="editable editableSingleClick">{1}</span></div>',this.id,Page.isPhotoReady()?"&nbsp;":"-- Add More --"),o+=format('<div class="umpleMethodNew"><span id="{0}_newMethod" name="methodNew" class="editable editableSingleClick">{1}</span></div>',this.id,Page.isPhotoReady()?"&nbsp;":"-- Add More --"),Page.isPhotoReady(),rowspan=3,Page.showAttributes&&(rowspan+=1),Page.showMethods&&(rowspan+=1),u+=format('<table bgcolor="'+this.displayColor+'" class="classTable" border="0">',this.id)+format('  <tr class="height">    <td rowspan="{2}"> <img id="{0}_height" src="scripts/_.gif" style="width:0px;height:{1}px;display:block;"  />    </td>  </tr>',this.id,this.position.height,rowspan)+'  <tr class="classArea">    <td > <img src="scripts/class.png" title="Class" /> ',Page.isPhotoReady()?this.isInterface=="true"?u+=format('<span>&#171interface&#187<span><br><span id="{0}_name" name="className">{1}</span>',this.id,this.name):this.isAbstract=="true"?u+=format('<span>&#171abstract&#187<span><br><span id="{0}_name" name="className">{1}</span>',this.id,this.name):u+=format('<span id="{0}_name" name="className">{1}</span>',this.id,this.name):this.isInterface=="true"?u+=format('<span>&#171interface&#187<span><br><span id="{0}_name" name="className" class="editable editableDoubleClick">{1}</span>',this.id,this.name):this.isAbstract=="true"?u+=format('<span>&#171abstract&#187<span><br><span id="{0}_name" name="className" class="editable editableDoubleClick">{1}</span>',this.id,this.name):u+=format('<span id="{0}_name" name="className" class="editable editableDoubleClick" >{1}</span>',this.id,this.name),u+="</td> </tr>",Page.showAttributes==!0&&(u+=format('  <tr class="attributeArea">    <td class="attributes">{0}    </td>  </tr>',n)),Page.showMethods==!0&&(u+=format('  <tr class="methodArea">    <td class="methods">{0}    </td>  </tr>',o)),u+=format('  <tr class="width">    <td> <img id="{0}_width" src="scripts/_.gif" style="width:{1}px;height:0px;display:block;"  />    </td>  </tr>',this.id,this.position.width),u+="</table>";var E=classDiv.html();return classDiv.html(u+E),classDiv},this.drawableClassOutline=function(){var e="#tempClass",t=jQuery(e).get();t==null||t==null||t==""?(t=jQuery("<div></div>"),t.addClass("umpleClass"),t.attr("id",this.id)):t=jQuery(e);var r='<table class="classTable" "border="0">'+format('  <tr class="height">    <td rowspan="4"> <img id="{0}_height" src="scripts/_.gif" style="width:0px;height:{1}px;display:block;"  />    </td>  </tr>',this.id,this.position.height)+'  <tr class="classArea">    <td> <img src="scripts/class.png" title="Class" /> '+format('      <span id="{0}_name" name="className" >{1}</span>',this.id,this.name)+'    </td>  </tr>  <tr class="attributeArea">    <td class="attributes">    </td>  </tr>  <tr class="width">'+format('    <td> <img id="{0}_width" src="scripts/_.gif" style="width:{1}px;height:0px;display:block;"  />    </td>  </tr>',this.id,this.position.width)+"</table>";return t.html(r),t},this.drawGeneralization=function(){var e=null,t=[],r=UmpleSystem.find(this.extendsClass);if(r==null&&this.interfaces.length==0)return null;if(r!=null&&(e=new UmpleGeneralization,e.childId=this.id,e.parentId=r.id,e.childPosition=this.position,e.parentPosition=r.position,t[0]=e.drawable()),this.interfaces.length>0)for(var a=null,n=0;n<this.interfaces.length;n++)a=UmpleSystem.find(this.interfaces[n]),a!=null&&(e=new UmpleGeneralization,e.childId=this.id,e.parentId=a.id,e.childPosition=this.position,e.parentPosition=a.position,t[n+1]=e.drawable());return t},this.anchorDivHtml=function(e,t){return format('<div id="{0}_{1}{2}" class="{3}" name="{4}" style="top: 0px; left: 0px; cursor:{5}; display: none;"><img name="image" src="./scripts/_.gif"/></div>',this.id,e,t,e,e,"move")}}function UmpleGeneralization(){this.parentId=null,this.childId=null,this.parentPosition=null,this.childPosition=null,this.id=null,this.setClasses=function(e,t){this.childId=e,this.parentId=t},this.setChildId=function(e){this.childId=e},this.setParentId=function(e){this.parentId=e},this.getElementId=function(){return this.id==null?"newgeneralization":this.id},this.getChildId=function(){return this.childId},this.getParentId=function(){return this.parentId},this.drawable=function(e){if(e==null&&(e=!0),this.childId==null||this.childId==null)return null;var t="#"+this.childId+"_generalization";jQuery(t).remove();var r=jQuery("<div></div>"),a=e?this.childId+"_generalization":"newgeneralization",n="umpleGeneralization";r.attr("id",a),r.attr("tabindex",2),r.addClass(n);var o=new UmplePosition(0,10,0,0),k=new UmplePosition(15,0,0,0),u=new UmplePosition(0,22,0,0),s=this.childPosition,d=new UmplePosition(this.childPosition.width/2,0,0,0),c=this.parentPosition,f=new UmplePosition(this.parentPosition.width/2,this.parentPosition.height,0,0);f=f.add(o).add(u),c=c.add(f),s=s.add(d);var C=this.childPosition.x,m=this.childPosition.x+this.childPosition.width,E=this.childPosition.y+this.childPosition.height,S=this.childPosition.y,P=!0;c.y>S&&(c.y<E?Math.abs(c.x-m)<Math.abs(c.x-C)?(s=s.add(new UmplePosition(this.childPosition.width/2,0,0,0)),s.y=c.y,P=!1):(s=s.subtract(new UmplePosition(this.childPosition.width/2,0,0,0)),s.y=c.y,P=!1):s=s.add(new UmplePosition(0,this.childPosition.height,0,0)));var N=new UmplePosition(s.x,c.y);if(P){var R=new UmpleLine(N.add(UmpleClassFactory.offsetError),c.add(UmpleClassFactory.offsetError)),g=new UmpleLine(s.add(UmpleClassFactory.offsetError),N.add(UmpleClassFactory.offsetError));r.append(R.drawable())}else var g=new UmpleLine(s.add(UmpleClassFactory.offsetError),c.add(UmpleClassFactory.offsetError));r.append(g.drawable());var v=c,M=c.subtract(u),L=new UmpleLine(v.add(UmpleClassFactory.offsetError),M.add(UmpleClassFactory.offsetError));r.append(L.drawable());var T=M.subtract(new UmplePosition(k.x/2,0,0,0)),A=T.add(k),j=M.subtract(o),k=new UmpleLine(T.add(UmpleClassFactory.offsetError),A.add(UmpleClassFactory.offsetError)),U=new UmpleLine(T.add(UmpleClassFactory.offsetError),j.add(UmpleClassFactory.offsetError)),_=new UmpleLine(A.add(UmpleClassFactory.offsetError),j.add(UmpleClassFactory.offsetError));r.append(k.drawable()),r.append(_.drawable()),r.append(U.drawable());var Q="",W=r.html();return r.html(Q+W),r},this.anchorDivHtml=function(e,t,r,a){return format('<div id="{0}_{1}{2}" class="{1}" name="{1}" style="left: {3}px; top: {4}px; cursor: pointer; display: none;"><img name="image" src="./scripts/_.gif"/></div>',this.childId+"_generalization",e,t,r,a)}}History=new Object,History.versionCount=9999,History.noChange="//$?[No_Change]$?",History.getInstance=function(e){var t=new Object;return t.id=e,t.currentIndex=-1,t.oldestAvailableIndex=0,t.newestAvailableIndex=0,t.firstSave=!0,t.undoButton=!1,t.redoButton=!1,t.getNextVersion=function(){return History.getNextVersion(t)},t.getPreviousVersion=function(){return History.getPreviousVersion(t)},t.save=function(r,a){return History.save(t,r,a)},t.distanceBetween=function(r,a){return History.distanceBetween(t,r,a)},t.setButtons=function(){return History.setButtons(t)},t.getVersion=function(r){return History.getVersion(t,r)},t.setVersion=function(r,a){return History.setVersion(t,r,a)},t},History.setButtons=function(e){History.enableButtonUndo(e,e.undoButton),History.enableButtonRedo(e,e.redoButton)},History.enableButtonUndo=function(e,t){e.undoButton=t,Page.enablePaletteItem("buttonUndo",t)},History.enableButtonRedo=function(e,t){e.redoButton=t,Page.enablePaletteItem("buttonRedo",t)},History.getNextVersion=function(e){History.enableButtonUndo(e,!0);var t;return!e.FirstSave&&e.newestAvailableIndex!=e.currentIndex?(e.currentIndex=History.incrementIndex(e.currentIndex),t=e.getVersion(e.currentIndex),t==null&&(t=History.noChange)):t=History.noChange,e.newestAvailableIndex==e.currentIndex&&History.enableButtonRedo(e,!1),t},History.getPreviousVersion=function(e){var t;return!e.FirstSave&&e.oldestAvailableIndex!=e.currentIndex?(e.currentIndex=History.decrementIndex(e.currentIndex),t=e.getVersion(e.currentIndex),t==null?t=History.noChange:History.enableButtonRedo(e,!0)):t=History.noChange,e.oldestAvailableIndex==e.currentIndex&&History.enableButtonUndo(e,!1),t},History.save=function(e,t,r){if(e.getVersion(e.currentIndex)!=t){e.firstSave||(History.enableButtonRedo(e,!1),History.enableButtonUndo(e,!0));var a=e.distanceBetween(e.oldestAvailableIndex,e.currentIndex);a==e.versionCount-1&&(e.oldestAvailableIndex=History.incrementIndex(e.oldestAvailableIndex)),e.currentIndex=History.incrementIndex(e.currentIndex),e.newestAvailableIndex=e.currentIndex,e.setVersion(e.currentIndex,t),e.firstSave&&(e.firstSave=!1)}},History.decrementIndex=function(e){var t;return e==0?t=History.versionCount-1:t=e-1,t},History.incrementIndex=function(e){var t=(e+1)%History.versionCount;return t},History.getVersion=function(e,t){var r="#textEditorColumn",a=e.id+"version"+t;return jQuery(r).data(a)},History.setVersion=function(e,t,r){var a="#textEditorColumn",n=e.id+"version"+t;return jQuery(a).data(n,r)},History.distanceBetween=function(e,t,r){if(e.currentIndex==-1)return 0;for(var a=0,n=t;n!=r;)n=History.incrementIndex(n),a+=1;return a};var Layout={};Layout.isTextVisible=!0,Layout.isDiagramVisible=!0,Layout.isPaletteVisible=!0,Layout.isLayoutVisible=!1,Layout.layoutHandler=null,Layout.isInSmallScreenMode=!1,Layout.screenThresholdWidth=945;var canvasHandle="#umpleCanvasColumn",editorHandle="#textEditorColumn",modelEditorHandle="#newEditor",paletteHandle="#paletteColumn",layoutEditorHandle="#bottomTextEditor";Layout.init=function(){Layout.errorMessageSpace=jQuery(".spacer").outerHeight(),Layout.errorMessageSpace===null&&(Layout.errorMessageSpace=0);var e=this.checkLayoutNeeded();e.layoutType==="large"?(this.layoutHandler=new LargeScreenManager,this.isInSmallScreenMode=!1):e.layoutType==="small"&&(this.layoutHandler=new SmallScreenManager,this.isInSmallScreenMode=!0),this.layoutHandler.transition(!0),jQuery(window).bind("resize",function(t){jQuery(t.target).hasClass("ui-resizable")||Layout.zoomResize()})},Layout.checkLayoutNeeded=function(){return jQuery(window).innerWidth()>jQuery(window).innerHeight()&&!(jQuery("body").innerWidth()<580&&jQuery("body").innerHeight()<580)?{layoutType:"large"}:{layoutType:"small"}},Layout.initPaletteSize=function(){this.layoutHandler.initPaletteSize()},Layout.initUmpleCanvasSize=function(){this.layoutHandler.initUmpleCanvasSize()},Layout.initUmpleTextAreaSize=function(){this.layoutHandler.initUmpleTextAreaSize()},Layout.setTextEditorSize=function(e,t){this.layoutHandler.setTextEditorSize(e,t)},Layout.setUmpleCanvasSize=function(e,t){this.layoutHandler.setUmpleCanvasSize(e,t)},Layout.adjustTextEditorHeight=function(e){this.isLayoutVisible?(jQuery(modelEditorHandle).outerHeight(e*.7),Page.codeMirrorOn&&this.resizeCodeMirrorEditor(e*.7),jQuery(layoutEditorHandle).outerHeight(e*.3)):(jQuery(modelEditorHandle).outerHeight(e),Page.codeMirrorOn&&this.resizeCodeMirrorEditor(e)),jQuery(editorHandle).height(e)},Layout.resizeCodeMirrorEditor=function(e){Page.codeMirrorOn&&(Page.codeMirrorEditor6.dom.style.height=e+"px")},Layout.showHideLayoutEditor=function(e){var t=jQuery(layoutEditorHandle),r=jQuery(editorHandle).height();e==null&&(e=!this.isLayoutVisible),e?(Layout.isLayoutVisible=!0,t.show()):(Layout.isLayoutVisible=!1,t.hide()),this.adjustTextEditorHeight(r)},Layout.showHideTextEditor=function(e){var t=jQuery(editorHandle),r=jQuery("#buttonShowHideLayoutEditor"),a=jQuery(".layoutListItem");e==null&&(e=!this.isTextVisible),e?(t.show(),this.isTextVisible=!0,r.prop("disabled",!1),r.css("cursor","pointer"),a.css("color","Black"),jQuery("#linetext").show(),Page.setUmpleCode(Page.getUmpleCode())):(t.hide(),this.isTextVisible=!1,r.prop("disabled",!0),r.css("cursor","not-allowed"),a.css("color","DimGray"),jQuery("#linetext").hide()),this.layoutHandler.showHideResizableAdjustment(),this.layoutHandler.showHideResize()},Layout.showHideCanvas=function(e){var t=jQuery(canvasHandle);e==null&&(e=!this.isDiagramVisible),e?(t.show(),this.isDiagramVisible=!0,Action.manualSync=jQuery("#buttonManualSync").prop("checked"),jQuery("#buttonShowHideCanvas").prop("checked",!0),Action.manualSync||(Action.updateUmpleDiagram(),Action.diagramInSync=!0,Page.enableDiagram(!0)),Action.manualSync&&!Action.diagramInSync&&Page.enablePaletteItem("buttonSyncDiagram",!0),(!Action.manualSync||Action.diagramInSync)&&(Page.enableCheckBoxItem("buttonPhotoReady","ttPhotoReady",!0),Page.enableCheckBoxItem("buttonManualSync","ttManualSync",!0),Page.enablePaletteItem("buttonAddClass",!0),Page.enablePaletteItem("buttonAddAssociation",!0),Page.enablePaletteItem("buttonAddTransition",!0),Page.enablePaletteItem("buttonAddGeneralization",!0),Page.enablePaletteItem("buttonDeleteEntity",!0),Page.initToggleTool("buttonAddClass"),Page.initToggleTool("buttonAddAssociation"),Page.initToggleTool("buttonAddTransition"),Page.initToggleTool("buttonAddGeneralization"),Page.initToggleTool("buttonDeleteEntity"))):(t.hide(),this.isDiagramVisible=!1,Action.manualSync=!0,jQuery("#buttonShowHideCanvas").prop("checked",!1),Page.enableCheckBoxItem("buttonPhotoReady","ttPhotoReady",!1),Page.enableCheckBoxItem("buttonManualSync","ttManualSync",!1),Page.enablePaletteItem("buttonAddClass",!1),Page.enablePaletteItem("buttonAddAssociation",!1),Page.enablePaletteItem("buttonAddTransition",!1),Page.enablePaletteItem("buttonAddGeneralization",!1),Page.enablePaletteItem("buttonDeleteEntity",!1),Page.enablePaletteItem("buttonSyncDiagram",!1),Page.removeToggleTool("buttonAddClass"),Page.removeToggleTool("buttonAddAssociation"),Page.removeToggleTool("buttonAddTransition"),Page.removeToggleTool("buttonAddGeneralization"),Page.removeToggleTool("buttonDeleteEntity")),this.layoutHandler.showHideResizableAdjustment(),this.layoutHandler.showHideResize()},Layout.showHideMenu=function(e){var t=jQuery("#paletteColumn");e==null&&(e=!this.isPaletteVisible),e?(Layout.isPaletteVisible=!0,t.show()):(Layout.isPaletteVisible=!1,t.hide()),this.layoutHandler.showHideResizableAdjustment(),this.layoutHandler.showHideResize()},Layout.zoomResize=function(){var e=this.checkLayoutNeeded();e.layoutType==="large"?this.isInSmallScreenMode&&this.toggleSmallScreenMode():e.layoutType==="small"&&(this.isInSmallScreenMode||this.toggleSmallScreenMode()),this.layoutHandler.adjustAfterWindowResize()},Layout.toggleSmallScreenMode=function(){this.isInSmallScreenMode?(this.isInSmallScreenMode=!1,this.layoutHandler=new LargeScreenManager):(this.isInSmallScreenMode=!0,this.layoutHandler=new SmallScreenManager),this.layoutHandler.transition(!1)},Layout.verticallyResizing=function(e,t){this.layoutHandler.verticallyResizing(e,t)},Layout.verticallyResized=function(e,t){this.layoutHandler.verticallyResized(e,t)},Layout.editorResizing=function(e,t){this.layoutHandler.editorResizing(e,t)},Layout.editorResized=function(e,t){this.layoutHandler.editorResized(e,t)},Layout.canvasResizing=function(e,t){this.layoutHandler.canvasResizing(e,t)},Layout.canvasResized=function(e,t){this.layoutHandler.canvasResized(e,t)},Layout.calculateMainHeight=function(){return jQuery(paletteHandle).outerHeight()};function LargeScreenManager(){this.transition=function(e){if(!e){try{jQuery(editorHandle).resizable("destroy")}catch{}try{jQuery(paletteHandle).resizable("destroy")}catch{}try{jQuery(canvasHandle).resizable("destroy")}catch{}jQuery(editorHandle).removeClass("smallScreenEditor smallScreenEditorNoMargin"),jQuery(canvasHandle).removeClass("smallScreenCanvas smallScreenCanvasNoEditor smallScreenCanvasNoEditorNoPalette")}this.adjustMarginSpace(),this.heightFactor=1,this.minCanvasSize=new UmplePosition(0,0,420,50),this.minEditorSize=new UmplePosition(0,0,284,0);var t=jQuery("body").outerWidth(!0)-this.marginSpace-jQuery(paletteHandle).outerWidth()-this.minCanvasSize.width,r=jQuery("body").outerWidth(!0)-this.marginSpace-jQuery(paletteHandle).outerWidth()-this.minEditorSize.width;this.maxEditorSize=new UmplePosition(0,0,t,0),this.maxCanvasSize=new UmplePosition(0,0,r,0),this.initEditorResizable(),this.initCanvasResizable(),this.initVerticalResizable()},this.initUmpleCanvasSize=function(){this.initCanvasResizable(),this.setUmpleCanvasSize(this.minCanvasSize.width)},this.initUmpleTextAreaSize=function(){this.initEditorResizable(),this.setTextEditorSize(508,void 0),this.adjustAfterWindowResize()},this.initPaletteSize=function(){jQuery("#paletteColumn").height(this.calculateHeight()),jQuery("#palette").accordion("refresh"),this.initVerticalResizable()},this.setTextEditorSize=function(e,t){var r=jQuery(editorHandle);e==null&&(e=r.outerWidth()),t==null&&(t=Layout.calculateMainHeight()),e<this.minEditorSize.width?e=this.minEditorSize.width:Layout.isDiagramVisible||(e=e),r.outerWidth(e),Layout.adjustTextEditorHeight(t),Layout.isDiagramVisible&&this.setUmpleCanvasSize(this.calculateLeftoverWidth()+jQuery(canvasHandle).outerWidth(),void 0)},this.setUmpleCanvasSize=function(e,t){var r=jQuery(canvasHandle);e==null&&(e=r.outerWidth()),t==null&&(t=Layout.calculateMainHeight()),e<this.minCanvasSize.width&&(e=this.minCanvasSize.width),t<this.minCanvasSize.height&&(t=this.minCanvasSize.height),e>this.maxCanvasSize.width&&Layout.isTextVisible&&(e=this.maxCanvasSize.width),r.outerWidth(e),r.height(t),jQuery("#palette").accordion("refresh")},this.showHideResize=function(){this.adjustMarginSpace(),this.adjustMaxSizes(),Layout.isDiagramVisible&&!Layout.isTextVisible?this.setUmpleCanvasSize(this.calculateLeftoverWidth()+jQuery(canvasHandle).outerWidth(),void 0):Layout.isTextVisible&&this.setTextEditorSize(this.calculateLeftoverWidth()+jQuery(editorHandle).outerWidth(),void 0)},this.showHideResizableAdjustment=function(){if(!Layout.isDiagramVisible||!Layout.isTextVisible){try{jQuery(canvasHandle).resizable("destroy")}catch{}try{jQuery(editorHandle).resizable("destroy")}catch{}}else Layout.isDiagramVisible&&Layout.isTextVisible&&(this.initCanvasResizable(),this.initEditorResizable());if(jQuery(editorHandle).outerWidth()<this.minEditorSize.width||jQuery(canvasHandle).outerWidth()<this.minCanvasSize.width){try{jQuery(canvasHandle).resizable("destroy")}catch{}try{jQuery(editorHandle).resizable("destroy")}catch{}}else this.initCanvasResizable(),this.initEditorResizable();this.adjustMaxSizes()},this.adjustMaxSizes=function(){if(Layout.isDiagramVisible&&Layout.isTextVisible){var e=jQuery("body").outerWidth(!0)-this.marginSpace;Layout.isDiagramVisible&&(e-=this.minCanvasSize.width),Layout.isPaletteVisible&&(e-=jQuery(paletteHandle).outerWidth());var t=jQuery("body").outerWidth(!0)-this.marginSpace;Layout.isTextVisible&&(t-=this.minEditorSize.width),Layout.isPaletteVisible&&(t-=jQuery(paletteHandle).outerWidth()),this.maxEditorSize=new UmplePosition(0,0,e,0),this.maxCanvasSize=new UmplePosition(0,0,t,0),jQuery(editorHandle).outerWidth()>this.minEditorSize.width&&jQuery(canvasHandle).outerWidth()>this.minCanvasSize.width&&(jQuery(editorHandle).resizable("option","maxWidth",this.maxEditorSize.width),jQuery(canvasHandle).resizable("option","maxWidth",this.maxCanvasSize.width))}Action.setupPinch()},this.adjustAfterWindowResize=function(){this.adjustMaxSizes(),jQuery("#paletteColumn").height(this.calculateHeight()),jQuery("#palette").accordion("refresh");var e=this.calculateLeftoverWidth();jQuery(canvasHandle).outerWidth()<this.minCanvasSize.width&&jQuery(canvasHandle).outerWidth()+e>=this.minCanvasSize.width&&e>0||jQuery(canvasHandle).outerWidth()+e<=this.minCanvasSize.width&&e>0?this.setTextEditorSize(jQuery(editorHandle).outerWidth(),void 0):this.setTextEditorSize(e+jQuery(editorHandle).outerWidth(),void 0),this.showHideResizableAdjustment()},this.initVerticalResizable=function(){jQuery("#mainApplication").resizable({resize:function(e,t){Layout.verticallyResizing(e,t)},stop:function(e,t){Layout.verticallyResized(e,t)},autoHide:!0,minHeight:this.minCanvasSize.height,handles:"s"})},this.initEditorResizable=function(){!Layout.isTextVisible||!Layout.isDiagramVisible||jQuery(editorHandle).resizable({start:function(e,t){Layout.savedStartingWidth=jQuery(canvasHandle).outerWidth()},resize:function(e,t){Layout.editorResizing(e,t)},stop:function(e,t){Layout.editorResized(e,t)},autoHide:!0,minWidth:this.minEditorSize.width,maxWidth:this.maxEditorSize.width,handles:"e"})},this.initCanvasResizable=function(){if(!(!Layout.isTextVisible||!Layout.isDiagramVisible)){var e=jQuery(canvasHandle);e.resizable({start:function(t,r){Layout.savedStartingWidth=jQuery(editorHandle).outerWidth()},resize:function(t,r){Layout.canvasResizing(t,r)},stop:function(t,r){Layout.canvasResized(t,r)},autoHide:!0,minWidth:this.minCanvasSize.width,maxWidth:this.maxCanvasSize.width,handles:"w"})}},this.verticallyResizing=function(e,t){var r=t.size.height;jQuery(paletteHandle).outerHeight(r),jQuery(editorHandle).outerHeight(r),jQuery(canvasHandle).outerHeight(r),Layout.adjustTextEditorHeight(r),jQuery("#palette").accordion("refresh")},this.verticallyResized=function(e,t){this.heightFactor=jQuery("#mainApplication").outerHeight()/(jQuery(window).innerHeight()-jQuery("#header").outerHeight()-jQuery("#topLine").outerHeight()-parseInt(jQuery("body").css("marginBottom"))-parseInt(jQuery("body").css("marginTop"))),this.setTextEditorSize(void 0,t.size.height),jQuery("#mainApplication").css("height","auto")},this.editorResizing=function(e,t){var r=t.size.width,a=t.originalSize.width-r;jQuery(canvasHandle).outerWidth(Layout.savedStartingWidth+a),jQuery(modelEditorHandle).width(r),jQuery(layoutEditorHandle).width(r)},this.editorResized=function(e,t){var r=t.size.width;jQuery(modelEditorHandle).css("width","auto"),jQuery(layoutEditorHandle).css("width","auto"),this.setTextEditorSize(r,void 0),delete Layout.savedStartingWidth},this.canvasResizing=function(e,t){var r=t.size.width;jQuery(canvasHandle).outerWidth(r);var a=r-t.originalSize.width;jQuery(editorHandle).width(Layout.savedStartingWidth-a),jQuery(modelEditorHandle).width(Layout.savedStartingWidth-a),jQuery(layoutEditorHandle).width(Layout.savedStartingWidth-a),jQuery(canvasHandle).css("left","0px"),Action.setupPinch()},this.canvasResized=function(e,t){var r=t.size.width;jQuery(modelEditorHandle).css("width","auto"),jQuery(layoutEditorHandle).css("width","auto"),this.setTextEditorSize(this.calculateLeftoverWidth()+jQuery(editorHandle).outerWidth(),void 0),delete this.savedStartingWidth},this.adjustMarginSpace=function(){jQuery(editorHandle).removeClass("largeScreenEditor largeScreenEditorNoMargin"),jQuery(canvasHandle).removeClass("largeScreenCanvas largeScreenCanvasNoMargin"),Layout.isTextVisible?Layout.isDiagramVisible&&Layout.isPaletteVisible?(jQuery(editorHandle).addClass("largeScreenEditor"),jQuery(canvasHandle).addClass("largeScreenCanvas")):Layout.isDiagramVisible||Layout.isPaletteVisible?(jQuery(editorHandle).addClass("largeScreenEditor"),jQuery(canvasHandle).addClass("largeScreenCanvasNoMargin")):(jQuery(editorHandle).addClass("largeScreenEditorNoMargin"),jQuery(canvasHandle).addClass("largeScreenCanvasNoMargin")):(jQuery(editorHandle).addClass("largeScreenEditorNoMargin"),Layout.isDiagramVisible&&Layout.isPaletteVisible?jQuery(canvasHandle).addClass("largeScreenCanvas"):jQuery(canvasHandle).addClass("largeScreenCanvasNoMargin")),this.marginSpace=parseInt(jQuery("body").css("marginLeft"))+parseInt(jQuery("body").css("marginRight"))+1+parseInt(jQuery(canvasHandle).css("marginLeft"))+parseInt(jQuery(editorHandle).css("marginRight"))},this.calculateLeftoverWidth=function(){var e=jQuery("body").outerWidth(!0)-this.marginSpace;return Layout.isTextVisible&&(e-=jQuery(editorHandle).outerWidth()),Layout.isDiagramVisible&&(e-=jQuery(canvasHandle).outerWidth()),Layout.isPaletteVisible&&(e-=jQuery(paletteHandle).outerWidth()),e},this.calculateHeight=function(){var e=TabControl.isHidden()?0:jQuery("#tabControl").outerHeight(),t=jQuery("#taskArea").css("display")=="none"?0:jQuery("#taskArea").outerHeight();t>jQuery(window).innerHeight()/2&&(t=0);var r=(jQuery(window).innerHeight()-jQuery("#header").outerHeight()-jQuery("#topLine").outerHeight()-e-parseInt(jQuery("body").css("marginBottom"))-parseInt(jQuery("body").css("marginTop"))-Layout.errorMessageSpace)*this.heightFactor-t;return r<this.minCanvasSize.height?this.minCanvasSize.height:r}}function SmallScreenManager(){this.transition=function(e){if(!e){try{jQuery(editorHandle).resizable("destroy")}catch{}try{jQuery(canvasHandle).resizable("destroy")}catch{}try{jQuery("#mainApplication").resizable("destroy")}catch{}jQuery(editorHandle).removeClass("largeScreenEditor largeScreenEditorNoMargin"),jQuery(canvasHandle).removeClass("largeScreenCanvas largeScreenCanvasNoMargin")}this.adjustMarginSpace(),this.minCanvasSize=new UmplePosition(0,0,420,50),this.minEditorSize=new UmplePosition(0,0,284,0),this.initEditorResizable(),this.initCanvasResizable(),this.initPaletteResizable()},this.initUmpleCanvasSize=function(){this.setUmpleCanvasSize(void 0,this.calculateHeight()),this.initCanvasResizable(),this.initPaletteResizable(),Layout.isDiagramVisible==!1&&Layout.showHideCanvas(!1)},this.initUmpleTextAreaSize=function(){this.setTextEditorSize(),this.initEditorResizable()},this.initPaletteSize=function(){jQuery("#paletteColumn").outerHeight(this.calculateHeight()),jQuery("#palette").accordion("refresh")},this.setTextEditorSize=function(r,t){var r=this.calculateLeftoverWidth();Layout.isPaletteVisible,jQuery(editorHandle).outerWidth(r),t!=null?Layout.adjustTextEditorHeight(t):Layout.adjustTextEditorHeight(this.calculateHeight())},this.setUmpleCanvasSize=function(e,t){Layout.isTextVisible?jQuery(canvasHandle).outerWidth(jQuery("body").width()):jQuery(canvasHandle).outerWidth(this.calculateLeftoverWidth()),t!=null&&jQuery(canvasHandle).outerHeight(t)},this.showHideResize=function(){var e=void 0;this.adjustMarginSpace(),Layout.isTextVisible?this.setTextEditorSize(void 0,jQuery(paletteHandle).outerHeight()):e=jQuery(paletteHandle).outerHeight(),jQuery("#palette").accordion("refresh"),this.pairResizables(),this.setUmpleCanvasSize(void 0,e)},this.showHideResizableAdjustment=function(){},this.adjustAfterWindowResize=function(){jQuery("#paletteColumn").outerHeight(this.calculateHeight()),jQuery("#palette").accordion("refresh"),this.setTextEditorSize(),this.setUmpleCanvasSize(void 0,this.calculateHeight())},this.initEditorResizable=function(){jQuery(editorHandle).resizable({autoHide:!0,minHeight:30,handles:"s"}),this.pairResizables()},this.initPaletteResizable=function(){jQuery(paletteHandle).resizable({autoHide:!0,minHeight:30,handles:"s"}),this.pairResizables()},this.initCanvasResizable=function(){jQuery(canvasHandle).resizable({autoHide:!0,minHeight:30,handles:"s"}),this.pairResizables()},this.verticallyResizing=function(e,t){jQuery(paletteHandle).outerHeight(t.size.height),jQuery("#palette").accordion("refresh")},this.verticallyResized=function(e,t){},this.editorResizing=function(e,t){Layout.adjustTextEditorHeight(t.size.height)},this.editorResized=function(e,t){},this.canvasResizing=function(e,t){jQuery(canvasHandle).outerHeight(t.size.height)},this.canvasResized=function(e,t){},this.adjustMarginSpace=function(){jQuery(canvasHandle).removeClass("smallScreenCanvas smallScreenCanvasNoEditor smallScreenCanvasNoEditorNoPalette"),jQuery(editorHandle).removeClass("smallScreenEditor smallScreenEditorNoMargin"),Layout.isTextVisible?(jQuery(canvasHandle).addClass("smallScreenCanvas"),Layout.isPaletteVisible?jQuery(editorHandle).addClass("smallScreenEditor"):jQuery(editorHandle).addClass("smallScreenEditorNoMargin")):(jQuery(editorHandle).addClass("smallScreenEditorNoMargin"),Layout.isPaletteVisible&&Layout.isDiagramVisible?jQuery(canvasHandle).addClass("smallScreenCanvasNoEditor"):jQuery(canvasHandle).addClass("smallScreenCanvasNoEditorNoPalette")),this.marginSpace=parseInt(jQuery("body").css("marginLeft"))+parseInt(jQuery("body").css("marginRight"))+1+parseInt(jQuery(editorHandle).css("marginRight"))+parseInt(jQuery(canvasHandle).css("marginLeft"))},this.calculateLeftoverWidth=function(){return Layout.isPaletteVisible?jQuery("body").outerWidth(!0)-this.marginSpace-jQuery(paletteHandle).outerWidth():jQuery("body").outerWidth(!0)-this.marginSpace},this.calculateHeight=function(){var e=TabControl.isHidden()?0:jQuery("#tabControl").outerHeight(),t=jQuery("#taskArea").css("display")=="none"?0:jQuery("#taskArea").outerHeight();t>jQuery(window).innerHeight()/2&&(t=0);var r=(jQuery(window).innerHeight()-jQuery("#header").outerHeight(!0)-2*jQuery("#topLine").outerHeight(!0)-e-Layout.errorMessageSpace)/2-t;return r},this.pairResizables=function(){if(!(!jQuery(editorHandle).is(".ui-resizable")||!jQuery(paletteHandle).is(".ui-resizable")||!jQuery(canvasHandle).is(".ui-resizable"))){if(Layout.isTextVisible)var e=function(u,s){Layout.editorResizing(u,s),Layout.verticallyResizing(u,s)},t=e,r=function(u,s){Layout.canvasResizing(u,s)},a=function(u,s){Layout.editorResized(u,s),Layout.verticallyResized(u,s)},n=a,o=function(u,s){Layout.canvasResized(u,s)};else var e=function(m,E){Layout.editorResizing(m,E)},r=function(m,E){Layout.canvasResizing(m,E),Layout.verticallyResizing(m,E)},t=r,a=function(m,E){Layout.editorResized(m,E)},o=function(m,E){Layout.canvasResized(m,E),Layout.verticallyResized(m,E)},n=o;jQuery(editorHandle).resizable("option","resize",e),jQuery(editorHandle).resizable("option","stop",a),jQuery(paletteHandle).resizable("option","resize",t),jQuery(paletteHandle).resizable("option","stop",n),jQuery(canvasHandle).resizable("option","resize",r),jQuery(canvasHandle).resizable("option","stop",o)}}}function UmpleLine(e,t){this.pointOne=e,this.pointTwo=t,this.drawable=function(r){var a=jQuery("<div class='umpleLine'></div>"),n=UmplePositionFactory.copy(this.pointOne),o=UmplePositionFactory.copy(this.pointTwo);typeof r<"u"&&(n.x=n.x+r.x,n.y=n.y+r.y,o.x=o.x+r.x,o.y=o.y+r.y);var u=0;if(n.y==o.y){var s=n.x<o.x?n:o,d=Math.abs(o.x-n.x);return a.append(this.createConnector(s.x,s.y,d,1)),a.append(this.createSelector(s.x,s.y,d,6)),a}else if(n.x==o.x){var s=n.y<o.y?n:o,c=Math.abs(o.y-n.y);return a.append(this.createConnector(s.x,s.y,1,c)),a.append(this.createSelector(s.x,s.y,6,c)),a}var f=this.slope(),C=o.x>n.x?1:-1,m=C*f;Math.abs(f)>1&&(m=o.y>n.y?1:-1,C=m*(1/f));for(var E=0,S=n.y,P=n.x;(P<=o.x&&C>0||P>=o.x&&C<0)&&!(E++>1e3);P+=C)a.append(this.createConnector(P,S,1,1)),a.append(this.createSelector(P,S,6,6)),S+=m,u++;return a},this.slope=function(){return slope=(this.pointTwo.y-this.pointOne.y)/(this.pointTwo.x-this.pointOne.x),slope},this.length=function(){var r=this.pointTwo.x-this.pointOne.x,a=this.pointTwo.y-this.pointOne.y,n=Math.sqrt(Math.pow(r,2)+Math.pow(a,2));return Math.round(n)},this.createConnector=function(r,a,n,o){var u=jQuery("<div></div>");return u.addClass("umpleAssociation"),u.attr("name",this.startId),u.css({position:"absolute",left:r,top:a,width:n,height:o}),u},this.createSelector=function(r,a,n,o){var u=jQuery("<div></div>");return u.addClass("umpleAssociationSelector"),u.attr("name",this.startId),u.css({position:"absolute",left:r,top:a,width:n,height:o}),u},this.intersection=function(r){var a=this.pointOne.x,n=this.pointOne.y,o=this.pointTwo.x,u=this.pointTwo.y,s=r.pointOne.x,d=r.pointOne.y,c=r.pointTwo.x,f=r.pointTwo.y,C=this.slope(),m=r.slope(),E=null,S=null,P=null,N=null,R=!1;if(C==m)return null;C==1/0||C==-1/0?(N=d-m*s,E=a,S=m*E+N,R=!0):(m==1/0||m==-1/0)&&(P=n-C*a,E=s,S=C*E+P,R=!0),R||(P=n-C*a,N=d-m*s,E=(N-P)/(C-m),S=C*E+P);var g=o>a?o:a,v=c>s?c:s,M=u>n?u:n,L=f>d?f:d,T=g==o?a:o,A=v==c?s:c,j=M==u?n:u,k=L==f?d:f;return E<T||E<A||E>g||E>v||S<j||S<k||S>M||S>L?null:(E=Math.round(E),S=Math.round(S),new UmplePosition(E,S,0,0))}}UmpleMethodFactory=new Object,UmpleMethodFactory.create=function(e){var t=new UmpleMethod(e.visibility,e.isAbstract,e.type,e.name,e.parameters);return t};function UmpleMethod(e,t,r,a,n){this.visibility=e,this.isAbstract=t,this.type=r,this.name=a,this.parameters=typeof n=="string"?n.split(","):n,this.set=function(o){var u=this.name!="";u&&(this.oldVisibility=this.visibility,this.oldType=this.type,this.oldName=this.name,this.oldParameters=this.parameters),o=o.trim();var s=o.charAt(0);s=="+"?(this.visibility="public",o=o.substr(1)):s=="-"?(this.visibility="private",o=o.substr(1)):s=="#"?(this.visibility="protected",o=o.substr(1)):this.visibility="public";var d=o.split(":");if(d.length<2)this.type="void",this.name=o.substring(0,o.indexOf("(")).trim(),this.parameters=o.match("\\((.*)\\)")[1].replace(/\s+/g,"").split(",");else{var c=d[0].trim();this.type=d[1].trim(),this.name=c.substring(0,c.indexOf("(")).trim(),this.parameters=c.match("\\((.*)\\)")[1].replace(/\s+/g,"").split(",")}u||(this.newVisibility=this.visibility,this.newType=this.type,this.newName=this.name,this.newParameters=this.parameters)},this.copy=function(){return new UmpleMethod(this.visibility,this.type,this.name,this.parameters)}}Page=new Object,Page.currentUmpleTextBeingEdited="",Page.selectedItem=null,Page.selectedClass=null,Page.selectedAssociation=null,Page.selectedTransition=null,Page.selectedGeneralization=null,Page.canEditTask=!1,Page.canCreateTask=!0,Page.codeEffect=null,Page.clickCount=0,Page.repeatToolItem=!1,Page.shortcutsEnabled=!0,Page.diagramSyncNeededAppend=!1,Page.modelDelimiter="//$?[End_of_model]$?",Page.codeMirrorOn=!1,Page.codeMirrorEditor=null,Page.codeMirrorEditor6=null,Page.hLine=null,Page.modelLoadingCount=0,Page.layoutLoadingCount=0,Page.canvasLoadingCount=0,Page.onLoadingCompleteCallbacks=[],Page.readOnly=!1,Page.useEditableClassDiagram=!0,Page.useGvClassDiagram=!1,Page.useGvStateDiagram=!1,Page.useGvFeatureDiagram=!1,Page.showFeatureDependency=!1,Page.useStructureDiagram=!1,Page.useFeatureDiagram=!1,Page.showAttributes=!0,Page.showMethods=!1,Page.filterWordsOutput="",Page.mixsetsActive=new Array,Page.filtersActive=new Array,Page.copyableMixset="",Page.specialSuboptionsActive=new Array,Page.showActions=!0,Page.showText=!0,Page.showCanvas=!0,Page.showTraits=!1,Page.showTransitionLabels=!1,Page.showGuardLabels=!1,Page.showGuards=!0,Page.modifiedDiagrams=!1,Page.allowPinch=!1,Page.initialMouseDownX=0,Page.initialMouseDownY=0,Page.selectedGvClass="",Page.blahblah=function(e){console.log("In blah blah "+e)},Page.isGvManual=function(){return Page.specialSuboptionsActive.includes("gvmanual")},Page.init=function(e,t,r,a,n,o,u,s,d,c,f){performance.navigation.type==2&&location.reload(!0),Page.canEditTask=d,Page.canCreateTask=c,Layout.isDiagramVisible=e,Layout.isTextVisible=t,Layout.isPaletteVisible=r,Layout.isLayoutVisible=n,Page.readOnly=a,TabControl.init(),jQuery(".layoutListItem").hide(),o.toLowerCase()=="gvstate"||o.toLowerCase()=="state"?(Page.useGvStateDiagram=!0,Page.useEditableClassDiagram=!1,Page.setDiagramTypeIconState("GvState"),Page.useGvFeatureDiagram=!1,jQuery(".view_opt_state").show()):o.toLowerCase()=="gvclass"?(Page.useGvClassDiagram=!0,Page.useEditableClassDiagram=!1,Page.setDiagramTypeIconState("GvClass"),Page.useGvFeatureDiagram=!1,jQuery(".view_opt_class").show()):o.toLowerCase()=="gvclasstrait"?(Page.useGvClassDiagram=!0,Page.useEditableClassDiagram=!1,Page.setDiagramTypeIconState("GvClass"),Page.useGvFeatureDiagram=!1,Page.showTraits=!0,jQuery(".view_opt_class").show()):o.toLowerCase()=="gvfeature"?(Page.useGvFeatureDiagram=!0,Page.useEditableClassDiagram=!1,Page.useGvStateDiagram=!1,Page.useStructureDiagram=!1,Page.setDiagramTypeIconState("GvFeature"),jQuery(".view_opt_feature").show()):o.toLowerCase()=="structurediagram"?(Page.useStructureDiagram=!0,Page.useEditableClassDiagram=!1,Page.setDiagramTypeIconState("structureDiagram"),Page.useGvFeatureDiagram=!1):(jQuery(".view_opt_class").show(),jQuery(".view_opt_class_palette").show()),f!=""&&(f.includes("gvmanual")&&(Page.specialSuboptionsActive.push("gvmanual"),f=f.replace("gvmanual","")),f.includes("gvdot")?(Page.specialSuboptionsActive.push("gvdot"),f=f.replace("gvdot","")):f.includes("gvsfdp")?(Page.specialSuboptionsActive.push("gvsfdp"),f=f.replace("gvsfdp","")):f.includes("gvortho")&&(Page.specialSuboptionsActive.push("gvortho"),f=f.replace("gvortho","")),jQuery("#filtervalues").val(f),Action.setFilterFull(f,!1)),jQuery.noConflict(),jQuery(document).keydown(function(C){Action.keyboardShortcut(C)}),Layout.init(),Page.initPaletteArea(),Page.initCanvasArea(),Page.initUmpleTextArea(),Page.initSourceCodeArea(),Page.initCodeExecutionArea(),jQuery(document).ready(function(){DropboxInitializer.initializeDropbox(),ToolTips.initTooltips()}),Page.readOnly&&jQuery("#"+Page.umpleCanvasId()).addClass("photoReady"),Action.loadFile(),s&&Action.loadTask(jQuery("#model").val().split("-")[1],!0),jQuery(u).prop("selected",!0)},Page.initPaletteArea=function(){var e="#palette",t=e+" *";jQuery(e).accordion({heightStyle:"fill",fillSpace:!0,active:1,collapsible:!0}),jQuery(t).addClass("unselectable"),Layout.initPaletteSize(),Page.initJQueryButton("buttonGenerateCode"),Page.initJQueryButton("buttonExecuteCode"),Page.initJQueryButton("buttonStartOver"),Page.initJQueryButton("buttonShowRefreshUmpleOnlineCompletely"),Page.initJQueryButton("buttonLoadBlankModel"),Page.initHighlighter("buttonAddClass"),Page.initHighlighter("buttonAddAssociation"),Page.initHighlighter("buttonAddTransition"),Page.initHighlighter("buttonAddGeneralization"),Page.initHighlighter("buttonDeleteEntity"),Page.initHighlighter("buttonPngImage"),Page.initHighlighter("buttonYumlImage"),Page.initHighlighter("buttonSimulateCode"),Page.initHighlighter("buttonUigu"),Page.initHighlighter("buttonCopyClip"),Page.initHighlighter("buttonCopyMix"),Page.initHighlighter("buttonCollabFork"),Page.initHighlighter("buttonCopy"),Page.initHighlighter("buttonCopyEncodedURL"),Page.initHighlighter("buttonCopyCommandLine"),Page.initHighlighter("buttonCopyLocalBrowser"),Page.initHighlighter("buttonLoadLocalBrowser"),Page.canEditTask&&(Page.initHighlighter("buttonRequestAllZip"),Page.initHighlighter("buttonRequestLoadTaskURL")),Page.canCreateTask&&Page.initHighlighter("buttonCreateTask"),Page.initHighlighter("buttonLoadTask"),Page.initHighlighter("buttonDownloadFiles"),Page.initHighlighter("buttonSmaller"),Page.initHighlighter("buttonLarger"),Page.initHighlighter("buttonSyncCode"),Page.initHighlighter("buttonSyncDiagram"),Page.initHighlighter("buttonToggleMethods"),Page.initHighlighter("buttonToggleAttributes"),Page.initHighlighter("buttonToggleActions"),Page.initHighlighter("buttonToggleTransitionLabels"),Page.initHighlighter("buttonToggleGuards"),Page.initHighlighter("buttonToggleGuardLabels"),Page.initHighlighter("buttonToggleTraits"),Page.initHighlighter("buttonToggleFeatureDependency"),Page.initHighlighter("buttonallowPinch"),Page.initHighlighter("buttonReindent"),Page.initToggleTool("buttonAddClass"),Page.initToggleTool("buttonAddAssociation"),Page.initToggleTool("buttonAddTransition"),Page.initToggleTool("buttonAddGeneralization"),Page.initToggleTool("buttonDeleteEntity"),Page.initAction("buttonPngImage"),Page.initAction("buttonYumlImage"),Page.initAction("buttonPhpCode"),Page.initAction("buttonEcoreCode"),Page.initAction("buttonJavaCode"),Page.initAction("buttonJavaAPIDoc"),Page.initAction("buttonRubyCode"),Page.initAction("buttonAlloyCode"),Page.initAction("buttonNuSMVCode"),Page.initAction("buttonSqlCode"),Page.initAction("buttonCppCode"),Page.initAction("buttonPhotoReady"),Page.initAction("buttonSimulateCode"),Page.initAction("buttonShowHideTextEditor"),Page.initAction("buttonShowHideCanvas"),Page.initAction("buttonShowEditableClassDiagram"),Page.initAction("buttonShowJointJSClassDiagram"),Page.initAction("buttonShowGvClassDiagram"),Page.initAction("buttonShowGvStateDiagram"),Page.initAction("buttonShowGvFeatureDiagram"),Page.initAction("buttonShowStructureDiagram"),Page.initAction("buttonShowHideLayoutEditor"),Page.initAction("buttonManualSync"),Page.initAction("buttonCopyClip"),Page.initAction("buttonCopyMix"),Page.initAction("buttonCollabFork"),Page.initAction("buttonCopy"),Page.initAction("buttonCopyEncodedURL"),Page.initAction("buttonCopyCommandLine"),Page.initAction("buttonCopyLocalBrowser"),Page.initAction("buttonLoadLocalBrowser"),Page.canEditTask&&(Page.initAction("buttonRequestAllZip"),Page.initAction("buttonRequestLoadTaskURL")),Page.canCreateTask&&Page.initAction("buttonCreateTask"),Page.initAction("buttonLoadTask"),Page.initAction("buttonDownloadFiles"),Page.initAction("buttonUndo"),Page.initAction("buttonRedo"),Page.initAction("buttonReindent"),Page.initAction("buttonUigu"),Page.initAction("buttonStartOver"),Page.initAction("buttonShowRefreshUmpleOnlineCompletely"),Page.initAction("buttonLoadBlankModel"),Page.initAction("buttonGenerateCode"),Page.initAction("buttonExecuteCode"),Page.initAction("buttonTabsCheckbox"),Page.initAction("buttonSmaller"),Page.initAction("buttonLarger"),Page.initAction("buttonSyncCode"),Page.initAction("buttonSyncDiagram"),Page.initAction("buttonToggleMethods"),Page.initAction("buttonToggleAttributes"),Page.initAction("buttonToggleActions"),Page.initAction("buttonToggleTraits"),Page.initAction("buttonToggleFeatureDependency"),Page.initAction("buttonToggleTransitionLabels"),Page.initAction("buttonToggleGuards"),Page.initAction("buttonToggleGuardLabels"),Page.initAction("buttonAllowPinch"),Page.initLabels(),Page.enablePaletteItem("buttonUndo",!1),Page.enablePaletteItem("buttonRedo",!1),Page.enablePaletteItem("buttonSyncDiagram",!1),Page.enablePaletteItem("buttonAddTransition",!1),jQuery("#genstatus").hide(),jQuery("#buttonViewComplete").hide(),Page.initExamples(),Page.initOptions(),Page.readOnly&&(jQuery("#mainDrawMenu").hide(),jQuery(".layoutListItem").hide(),jQuery("#preferencesTitle").hide(),jQuery("#ttPhotoReady").hide(),jQuery("#ttManualSync").hide(),jQuery("#canvasSizeTitle").hide(),jQuery("#buttonSmaller").hide(),jQuery("#buttonLarger").hide(),jQuery("#menuBookmarkable").hide()),(Page.readOnly||!Layout.isPaletteVisible)&&jQuery("#topBookmarkable").hide(),Layout.isPaletteVisible||jQuery("#paletteColumn").hide(),Layout.isTextVisible||(Page.readOnly?jQuery("#topLine").hide():jQuery("#linetext").hide()),jQuery("#inputGenerateCode").on("change",function(){this.value.split(":")[1]==="Java"||this.value.split(":")[1]==="Python"?jQuery("#buttonExecuteCode").show():jQuery("#buttonExecuteCode").hide()})},Page.initOptions=function(){jQuery("#buttonShowHideLayoutEditor").prop("checked",Layout.isLayoutVisible),jQuery("#buttonShowHideTextEditor").prop("checked",Layout.isTextVisible),jQuery("#buttonShowHideCanvas").prop("checked",Layout.isDiagramVisible),jQuery("#buttonTabsCheckbox").prop("checked",!1),jQuery("#tabRow").hide(),jQuery("#ttTabsCheckbox").hide(),jQuery("#buttonToggleAttributes").prop("checked",!0),jQuery("#buttonToggleActions").prop("checked",!0),jQuery("#buttonToggleTransitionLabels").prop("checked",!1),jQuery("#buttonToggleGuards").prop("checked",!0),jQuery("#buttonToggleGuardLabels").prop("checked",!1),jQuery("#buttonToggleTraits").prop("checked",Page.showTraits),jQuery("#buttonToggleFeatureDependency").prop("checked",!1),jQuery("#buttonAllowPinch").prop("checked",!1),Page.useEditableClassDiagram&&jQuery("#buttonShowEditableClassDiagram").prop("checked",!0),Page.useJointJSClassDiagram&&jQuery("#buttonShowJointJSClassDiagram").prop("checked",!0),Page.useGvClassDiagram&&jQuery("#buttonShowGvClassDiagram").prop("checked",!0),Page.useGvFeatureDiagram&&jQuery("#buttonShowGvFeatureDiagram").prop("checked",!0),Page.useGvStateDiagram&&jQuery("#buttonShowGvStateDiagram").prop("checked",!0),Page.useStructureDiagram&&jQuery("#buttonShowStructureDiagram").prop("checked",!0),jQuery("#buttonPhotoReady").prop("checked",!1),jQuery("#buttonManualSync").prop("checked",!1),jQuery("#buttonShowHideTextEditor").prop("disabled",!1),jQuery("#buttonShowHideCanvas").prop("disabled",!1),jQuery("#buttonPhotoReady").prop("disabled",!1),jQuery("#buttonManualSync").prop("disabled",!1)},Page.initHighlighter=function(e){var t="#"+e;jQuery(t).mouseover(function(){Page.highlightItem(e)}),jQuery(t).mouseout(function(){Page.unhighlightItem(e)})},Page.removeHighlighter=function(e){var t="#"+e;jQuery(t).unbind("mouseover"),jQuery(t).unbind("mouseout")},Page.enableCheckBoxItem=function(e,t,r){var a=jQuery("#"+t),n=jQuery("#"+e);r?(n.prop("disabled",!1),n.css("cursor","pointer"),a.css("color","Black")):(n.prop("disabled",!0),n.css("cursor","not-allowed"),a.css("color","Silver"))},Page.enablePaletteItem=function(e,t){var r=jQuery("#"+e),a=!r.hasClass("disabled");a!=t&&(t?(r.removeClass(),r.prop("disabled",!0),Page.initHighlighter(e)):(r.removeClass(),r.addClass("disabled"),r.prop("disabled",!1),Page.removeHighlighter(e)))},Page.initToggleTool=function(e){var t=jQuery("#"+e);t.unbind().click(function(){Page.toggleToolItem(e,!1)}),t.dblclick(function(){Page.toggleToolItem(e,!0)})},Page.removeToggleTool=function(e){var t=jQuery("#"+e);t.unbind("click"),t.unbind("dblclick")},Page.initJQueryButton=function(e){var t="#"+e,r=jQuery(t).attr("value");jQuery(t).button({label:r,className:"jQuery-palette-button"})},Page.initAction=function(e){var t="#"+e;jQuery(t).click(Action.clicked)},Page.initLabels=function(){for(var e=jQuery(".buttonExtend"),t=0,r=e.length;t<r;t++)Page.initLabel(jQuery(e[t]).prop("id"))},Page.initLabel=function(e){var t="#"+e;jQuery(t).click((function(r){return function(){jQuery("#"+jQuery(r).prop("id").replace("label","button")).trigger("click")}})(t))},Page.initUmpleTextArea=function(){var e=jQuery("#newEditor"),t=jQuery("#umpleLayoutEditorText");e.keyup(function(r){Action.freshLoad=!1,Action.umpleTyped(r)}),e.mousedown(function(){setTimeout('jQuery("#linenum").val(Action.getCaretPosition())',25)}),t.keyup(function(r){Action.freshLoad=!1,Action.setjustUpdateNowtoSaveLater(!1),Action.umpleCodeMirrorTypingActivity("layoutEditor")}),e.focusin(function(){Action.focusOn("umpleModelEditorText",!0)}),t.focus(function(){Action.focusOn("umpleLayoutEditorText",!0)}),e.focusout(function(){Action.focusOn("umpleModelEditorText",!1)}),t.blur(function(){Action.focusOn("umpleLayoutEditorText",!1)}),Page.initCodeMirrorEditor(),Layout.initUmpleTextAreaSize(),Layout.isTextVisible||Layout.showHideTextEditor(!1),Layout.isLayoutVisible||Layout.showHideLayoutEditor(!1)},Page.initCodeMirrorEditor=function(){const e=[{key:"Ctrl-E",run:function(){Page.clickShowEditableClassDiagram()}},{key:"Ctrl-J",run:function(){Page.clickShowJointJSClassDiagram()}},{key:"Ctrl-G",run:function(){Page.clickShowGvClassDiagram()}},{key:"Ctrl-S",run:function(){Page.clickShowGvStateDiagram()}},{key:"Ctrl-L",run:function(){Page.clickShowStructureDiagram()}},{key:"Ctrl-T",run:function(){Page.clickShowHideText()}},{key:"Shift-Ctrl-Alt-T",run:function(){Page.clickShowHideText()}},{key:"Ctrl-D",run:function(){Page.clickShowHideCanvas()}},{key:"Ctrl-N",run:function(){Page.clickShowHideMenu()}},{key:"trl-Alt-N",run:function(){Page.clickShowHideMenu()}},{key:"Ctrl-Shift-=",run:function(){Page.clickButtonlarger()}},{key:"Ctrl-Shift--",run:function(){Page.clickButtonSmaller()}},{key:"Shift-Ctrl-A",run:function(){Page.clickToggleAttributes()}},{key:"Ctrl-M",run:function(){Page.clickToggleMethods()}},{key:"Ctrl-R",run:function(){Page.clickToggleTraits()}},{key:"Ctrl-I",run:function(){Page.clickToggleTransitionLabels()}},{key:"Ctrl-K",run:function(){Page.clickToggleGuardLabels()}},{key:"Ctrl-O",run:function(){Page.copyCommandLineCode()}},{key:"Ctrl-B",run:function(){Page.promptAndExecuteTest()}},{key:"Esc",run:function(r){r.getInputField().blur()}}],t=cm6.createEditorState(document.getElementById("newEditor").value,{extensions:[]});Page.codeMirrorEditor6=cm6.createEditorView(t,document.getElementById("newEditor")),Page.codeMirrorEditor6.dispatch({effects:cm6.StateEffect.appendConfig.of(cm6.changeListenerPlugin)}),Page.readOnly&&Page.codeMirrorEditor6.dispatch({effects:cm6.editableCompartment.reconfigure(cm6.EditorView.editable.of(!1))}),Page.setCodeMirror6Text=function(r){Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:r}})},Page.codeMirrorEditor6.dom.addEventListener("mousedown",function(){Action.umpleCodeMirrorCursorActivity()}),Page.codeMirrorOn=!0},Page.setDiagramTypeIconState=function(e){for(buttonList=["ECD_button","GCD_button","SD_button"],i=0,l=buttonList.length;i<l;++i)document.getElementById(buttonList[i]).className="button2";switch(e){case"editableClass":document.getElementById("ECD_button").className="button2 active";break;case"GvClass":document.getElementById("GCD_button").className="button2 active";break;case"GvState":document.getElementById("SD_button").className="button2 active";break}},Page.setShowHideIconState=function(e){switch(e){case"SHT_button":Page.showText?document.getElementById(e).className="button2 active":document.getElementById(e).className="button2";break;case"SHD_button":Page.showCanvas?document.getElementById(e).className="button2 active":document.getElementById(e).className="button2";break;case"SHA_button":Page.showAttributes?document.getElementById(e).className="button2 active":document.getElementById(e).className="button2";break;case"SHM_button":Page.showMethods?document.getElementById(e).className="button2 active":document.getElementById(e).className="button2";break}},Page.clickShowEditableClassDiagram=function(){jQuery("#buttonShowEditableClassDiagram").trigger("click")},Page.clickShowJointJSClassDiagram=function(){jQuery("#buttonShowJointJSClassDiagram").trigger("click")},Page.clickShowGvClassDiagram=function(){jQuery("#buttonShowGvClassDiagram").trigger("click")},Page.clickShowGvStateDiagram=function(){jQuery("#buttonShowGvStateDiagram").trigger("click")},Page.clickShowGvFeatureDiagram=function(){jQuery("#buttonShowGvFeatureDiagram").trigger("click")},Page.clickShowStructureDiagram=function(){jQuery("#buttonShowStructureDiagram").trigger("click")},Page.clickShowHideText=function(){jQuery("#buttonShowHideTextEditor").trigger("click")},Page.clickShowHideCanvas=function(){jQuery("#buttonShowHideCanvas").trigger("click")},Page.clickShowHideMenu=function(){Layout.showHideMenu()},Page.clickButtonlarger=function(){jQuery("#buttonLarger").trigger("click")},Page.clickButtonSmaller=function(){jQuery("#buttonSmaller").trigger("click")},Page.clickToggleAttributes=function(){jQuery("#buttonToggleAttributes").trigger("click")},Page.clickToggleMethods=function(){jQuery("#buttonToggleMethods").trigger("click")},Page.clickToggleTraits=function(){jQuery("#buttonToggleTraits").trigger("click")},Page.clickToggleFeatureDependency=function(){jQuery("#buttonToggleFeatureDependency").trigger("click")},Page.clickToggleTransitionLabels=function(){jQuery("#buttonToggleTransitionLabels").trigger("click")},Page.clickToggleGuardLabels=function(){jQuery("#buttonToggleGuards").trigger("click")},Page.clickToggleGuardLabels=function(){jQuery("#buttonToggleGuardLabels").trigger("click")},Page.clickAllowPinch=function(){jQuery("#buttonAllowPinch").trigger("click")},Page.isPhotoReady=function(){if(Page.readOnly)return!0;var e="#buttonPhotoReady";return jQuery(e).prop("checked")},Page.initSourceCodeArea=function(){SyntaxHighlighter.config.clipboardSwf="scripts/clipboard.swf";var e="#generatedCodeRow";jQuery(e).hide()},Page.initCodeExecutionArea=function(){var e="#codeExecutionArea";jQuery(e).hide()},Page.showExecutionArea=function(){var e="#codeExecutionArea";jQuery(e).show()},Page.hideExecutionArea=function(){var e="#codeExecutionArea";jQuery(e).hide()},Page.hideGeneratedCode=function(){jQuery("#generatedCodeRow").hide(),jQuery("#innerGeneratedCodeRow").hide(),Page.useStructureDiagram||jQuery("#svgCanvas").hide()},Page.hideGeneratedCodeOnly=function(){jQuery("#generatedCodeRow").hide(),jQuery("#innerGeneratedCodeRow").hide()},Page.initCanvasArea=function(){var e=jQuery("#umpleCanvas");Layout.initUmpleCanvasSize(),e.click(function(t){Action.umpleCanvasClicked(t)}),e.mousemove(Action.mouseMove),e.focus(function(){Action.focusOn(Page.umpleCanvasId(),!0)}),e.blur(function(){Action.focusOn(Page.umpleCanvasId(),!1)}),e.delegate("[class$='editableDoubleClick']","dblclick",InlineEditor.handleOnClick),e.delegate("[class$='editableSingleClick']","click",InlineEditor.handleOnClick),Layout.isDiagramVisible||Layout.showHideCanvas(!1)},Page.setExamples=function(e){var t=e+".ump";jQuery("#inputExample").change(Action.loadExample),jQuery("#inputExample option").each(function(){if(this.value==t||this.value.startsWith("http")&&this.value.endsWith(t)){jQuery('#inputExample option[value = "'+t+'"]').attr("selected",!0);return}}),jQuery("#inputExampleType").change(Action.setExampleType),jQuery("#inputExample2").change(Action.loadExample),jQuery("#inputExample2 option").each(function(){if(this.value==t||this.value.startsWith("http")&&this.value.endsWith(t)){jQuery('#inputExample2 option[value = "'+t+'"]').attr("selected",!0);return}}),jQuery("#inputExample3").change(Action.loadExample),jQuery("#inputExample3 option").each(function(){if(this.value==t||this.value.startsWith("http")&&this.value.endsWith(t)){jQuery('#inputExample3 option[value = "'+t+'"]').attr("selected",!0);return}}),jQuery("#inputExample4").change(Action.loadExample),jQuery("#inputExample4 option").each(function(){if(this.value==t||this.value.startsWith("http")&&this.value.endsWith(t)){jQuery('#inputExample4 option[value = "'+t+'"]').attr("selected",!0);return}}),jQuery("#inputExample5").change(Action.loadExample),jQuery("#inputExample5 option").each(function(){if(this.value==t||this.value.startsWith("http")&&this.value.endsWith(t)){jQuery('#inputExample5 option[value = "extraExamples1/'+t+'"]').attr("selected",!0);return}})},Page.initExamples=function(){jQuery("#inputExample").change(Action.loadExample),jQuery("#defaultExampleOption").attr("selected",!0),jQuery("#inputExampleType").change(Action.setExampleType),jQuery("#inputExample2").change(Action.loadExample),jQuery("#defaultExampleOption2").attr("selected",!0),jQuery("#inputExample3").change(Action.loadExample),jQuery("#defaultExampleOption3").attr("selected",!0),jQuery("#inputExample4").change(Action.loadExample),jQuery("#defaultExampleOption4").attr("selected",!0),jQuery("#inputExample5").change(Action.loadExample),jQuery("#defaultExampleOption5").attr("selected",!0),jQuery("#inputExample6").change(Action.loadExample),jQuery("#defaultExampleOption6").attr("selected",!0),jQuery("#inputExample7").change(Action.loadExample),jQuery("#defaultExampleOption7").attr("selected",!0),jQuery("#inputExample8").change(Action.loadExample),jQuery("#defaultExampleOption8").attr("selected",!0),Page.useStructureDiagram?(jQuery("#structureModels").prop("selected",!0),jQuery("#itemLoadExamples").hide(),jQuery("#itemLoadExamples2").hide(),jQuery("#itemLoadExamples4").hide(),jQuery("#itemLoadExamples5").hide(),jQuery("#itemLoadExamples6").hide(),jQuery("#itemLoadExamples7").hide(),jQuery("#itemLoadExamples8").hide()):Page.useGvStateDiagram?(jQuery("#smModels").prop("selected",!0),jQuery("#itemLoadExamples").hide(),jQuery("#itemLoadExamples3").hide(),jQuery("#itemLoadExamples4").hide(),jQuery("#itemLoadExamples5").hide(),jQuery("#itemLoadExamples6").hide(),jQuery("#itemLoadExamples7").hide(),jQuery("#itemLoadExamples8").hide()):Page.useGvFeatureDiagram?(jQuery("#featureModels").prop("selected",!0),jQuery("#itemLoadExamples").hide(),jQuery("#itemLoadExamples2").hide(),jQuery("#itemLoadExamples3").hide(),jQuery("#itemLoadExamples5").hide(),jQuery("#itemLoadExamples6").hide(),jQuery("#itemLoadExamples7").hide(),jQuery("#itemLoadExamples8").hide()):(jQuery("#cdModels").prop("selected",!0),jQuery("#itemLoadExamples2").hide(),jQuery("#itemLoadExamples3").hide(),jQuery("#itemLoadExamples4").hide(),jQuery("#itemLoadExamples5").hide(),jQuery("#itemLoadExamples6").hide(),jQuery("#itemLoadExamples7").hide(),jQuery("#itemLoadExamples8").hide())},Page.highlightItem=function(e){var t="#"+e;jQuery(t).addClass("highlight")},Page.unhighlightItem=function(e){var t="#"+e;jQuery(t).removeClass("highlight")},Page.enableDiagram=function(e){Page.enableEditDragAndResize(e),Page.enablePaletteItem("buttonAddClass",e),Page.enablePaletteItem("buttonAddAssociation",e),Page.enablePaletteItem("buttonAddGeneralization",e),Page.enablePaletteItem("buttonDeleteEntity",e),Page.showDiagramSyncNeeded(!e)},Page.enableTransition=function(e){Page.enablePaletteItem("buttonAddTransition",e),Page.enablePaletteItem("buttonAddAssociation",!e)},Page.enableEditDragAndResize=function(e){e?(jQuery("span.editable").removeClass("uneditable"),jQuery("div.umpleClass").removeClass("unselectable"),jQuery("div.umpleClass.ui-draggable").draggable({disabled:!1})):(jQuery("span.editable").addClass("uneditable"),jQuery("div.umpleClass").addClass("unselectable"),jQuery("div.umpleClass.ui-draggable").draggable({disabled:!0}),jQuery(":text").blur())},Page.toggleToolItem=function(e,t){t==null&&(t=!1),Page.repeatToolItem=t;var r=e.substring(6),a=r!=Page.selectedItem;a?Page.selectToggleTool(r):Page.unselectAllToggleTools()},Page.unselectAllToggleTools=function(){var e=!1,t=!1;t=DiagramEdit.removeNewClass(),t&&(e=!0),t=DiagramEdit.removeNewAssociation(),t&&(e=!0),t=DiagramEdit.removeNewTransition(),t&&(e=!0),t=DiagramEdit.removeNewGeneralization(),t&&(e=!0);var r="ul.toggle li.selected";return jQuery(r).removeClass("selected highlight"),setTimeout("Page.enableEditDragAndResize(true);",500),Page.selectedItem=null,Page.repeatToolItem=!1,e},Page.selectToggleTool=function(e){Page.selectedItem!=null&&(DiagramEdit.removeNewClass(),DiagramEdit.removeNewAssociation(),DiagramEdit.removeNewTransition(),DiagramEdit.removeNewGeneralization()),Page.enableEditDragAndResize(!1),Page.selectedItem=e,Action.unselectAll();var t=format("ul.toggle li.selected"),r="#button"+e;jQuery(t).removeClass("selected highlight"),jQuery(r).addClass("selected")},Page.canShowHovers=function(){return Page.selectedItem==null||Page.selectedItem=="DeleteEntity"},Page.getRawUmpleCode=function(){return document.getElementById("umpleModelEditorText").value},Page.getRawUmpleCodeCM6=function(){return Page.codeMirrorEditor6.state.doc.toString()},Page.getUmpleCode=function(){var e=Page.getRawUmpleCodeCM6().replace(Page.modelDelimiter,""),t=jQuery("#umpleLayoutEditorText").val().replace(Page.modelDelimiter,"");t!==""&&!t.includes("namespace -;")&&(t=`

namespace -;
`+t);var n=e+Page.modelDelimiter+t;return n},Page.getEncodedURL=function(){var e=window.location.href.split("?")[0];return e.substr(0,37)=="https://cruise.umple.org/umpleonline/"&&(e="http://try.umple.org/"),e+"?text="+encodeURIComponent(Page.getUmpleCode())},Page.splitUmpleCode=function(e){var t=e.indexOf(Page.modelDelimiter);if(t==-1)n=e,r="";else{e=e.replace(Page.modelDelimiter,"");var n=e.substr(0,t),r=e.substr(t,e.length)}var o=[n,r];return o},Page.setUmpleCode=function(e,t){var n=Page.splitUmpleCode(e);jQuery("#umpleLayoutEditorText").val(n[1]),Page.codeMirrorOn&&(typeof t=="boolean"&&t==!1||Page.setCodeMirror6Text(n[0])),Action.updateCurrentUmpleTextBeingEdited(n[0]),typeof t=="function"&&t()},Page.setUmplePositioningCode=function(e){jQuery("#umpleLayoutEditorText").val(e)},Page.umpleCanvasId=function(){return"umpleCanvas"},Page.createBookmark=function(){TabControl.useActiveTabTo(TabControl.saveTab)(Page.getUmpleCode()),TabControl.saveActiveTabs(),window.location.href="bookmark.php?model="+Page.getModel()},Page.createBookmarkFork=function(){TabControl.useActiveTabTo(TabControl.saveTab)(Page.getUmpleCode()),TabControl.saveActiveTabs(),window.location.href="bookmark.php?model="+Page.getModel()+"&forkSoMakeTmpOnly"},Page.createTask=function(){var e=jQuery("#taskName").val();if(!/^(\w|\.)+$/.test(e)){window.alert("Task Name can only contain letters(case insensitive), underscores, dots, and digits!");return}var n=jQuery("#requestorName").val(),r=jQuery("#instructions"),o=jQuery("#completionURL").val(),a=jQuery("#isExperiment").is(":checked");TabControl.useActiveTabTo(TabControl.saveTab)(Page.getUmpleCode()),TabControl.saveActiveTabs(),Ajax.sendRequest("task.php",Page.createTaskCallback,format("taskName={0}&instructions={1}&model={2}&requestorName={3}&completionURL={4}&isExperiment={5}",e,r.val(),Page.getModel(),n,o,a))},Page.createTaskCallback=function(e){e.responseText.split(" ")[0]=="Task"?window.alert("Not able to create a task with that name. "+e.responseText):window.location.href="umple.php?task=1&model="+e.responseText},Page.editTask=function(){var e=jQuery("#instructions"),t=jQuery("#model").val().split("-")[1],n=jQuery("#requestorName").val(),r=jQuery("#completionURL").val(),o=jQuery("#isExperiment").is(":checked");TabControl.useActiveTabTo(TabControl.saveTab)(Page.getUmpleCode()),TabControl.saveActiveTabs(),Ajax.sendRequest("task.php",Page.editTaskCallback,"edit=1&taskName="+t+"&instructions="+e.val()+"&model="+Page.getModel()+"&requestorName="+n+"&completionURL="+r+"&isExperiment="+o)},Page.editTaskCallback=function(e){Page.setFeedbackMessage("Changes saved")},Page.cancelTaskResponse=function(){var e=confirm("Are you sure to cancel this task response?");e&&(window.location.href="task.php?cancelTaskResponse=1&model="+Page.getModel())},Page.hideTask=function(){jQuery("#taskArea").css("display","none"),jQuery("#labelTaskName").css("display","none"),jQuery("#taskNameCell").css("display","none"),jQuery("#instructions").css("display","none"),jQuery("#isExperimentCell").css("display","none"),jQuery("#isExperiment").attr("checked",!1),Layout.zoomResize()},Page.cancelTask=function(){if(jQuery("#completionURL").val()!=""||jQuery("#taskName").val()!=""||jQuery("#requestorName").val()!=""||jQuery("#instructions").val()!=""){var e=confirm("Are you sure you want to end the task creation process?");e&&(jQuery("#taskName").val(""),jQuery("#requestorName").val(""),jQuery("#completionURL").val(""),jQuery("#instructions").val(""),Page.hideTask())}else Page.hideTask()},Page.endTaskEdit=function(){var e=confirm("Are you sure you want to end the task editing process?");e&&Page.hideTask()},Page.toggleTabs=function(){TabControl.isHidden()?TabControl.showTabs():TabControl.hideTabs(),Layout.layoutHandler.adjustAfterWindowResize()},Page.showDiagramSyncNeeded=function(e){var t=jQuery("#umpleCanvas"),n='<div id="syncNeededMessage" class="syncNeededMessage unselectable">Diagram is out of synchronization with the text due to selecting Manual Sync or an error in the text that has caused the compiler to produce no output. </div>';e&&!Page.diagramSyncNeededAppend?(t.append(n),Page.diagramSyncNeededAppend=!0,Page.readOnly=!0,UmpleSystem.redrawCanvas()):!e&&Page.diagramSyncNeededAppend&&(jQuery("#syncNeededMessage").remove(),Page.diagramSyncNeededAppend=!1,Page.readOnly=!1,UmpleSystem.redrawCanvas())},Page.hideLoading=function(){var e="#newEditor",t="#bottomTextEditor",n="#"+Page.umpleCanvasId();Page.modelLoadingCount>0&&Page.modelLoadingCount--,Page.layoutLoadingCount>0&&Page.layoutLoadingCount--,Page.canvasLoadingCount>0&&Page.canvasLoadingCount--,Page.modelLoadingCount===0&&jQuery(e).hideLoading(),Page.layoutLoadingCount===0&&jQuery(t).hideLoading(),Page.canvasLoadingCount===0&&jQuery(n).hideLoading(),Page.modelLoadingCount===0&&Page.layoutLoadingCount===0&&Page.canvasLoadingCount===0&&jQuery(".bookmarkableUrl").removeClass("disabled")},Page.showModelLoading=function(){var e=jQuery("#newEditor");Page.modelLoadingCount==0&&(jQuery("#textEditorColumn").is(":visible")&&e.showLoading(),jQuery(".bookmarkableUrl").addClass("disabled")),Page.modelLoadingCount++},Page.showLayoutLoading=function(){var e=jQuery("#bottomTextEditor");Page.layoutLoadingCount==0&&(jQuery(".bookmarkableUrl").addClass("disabled"),e.is(":visible")&&e.showLoading()),Page.layoutLoadingCount++},Page.showCanvasLoading=function(){var e=jQuery("#umpleCanvas");Page.canvasLoadingCount==0&&(jQuery(".bookmarkableUrl").addClass("disabled"),e.is(":visible")&&e.showLoading()),Page.canvasLoadingCount++},Page.resetCanvasSize=function(){Page.setUmpleCanvasSize(Layout.minCanvasSize.width,Layout.minCanvasSize.height)},Page.getSelectedExample=function(){var e="",t=Page.getExampleType(),n=t;if(t.substring(0,5)=="extra"&&(t="cdModels"),t=="cdModels"){var r=!0,o="inputExample";n=="extra1ModelsAD"?(o="inputExample5",r=!0):n=="extra1ModelsEL"?(o="inputExample6",r=!0):n=="extra1ModelsMP"?(o="inputExample7",r=!0):n=="extra1ModelsQZ"&&(o="inputExample8",r=!0),e=jQuery("#"+o+" option:selected").val(),r?Page.useGvClassDiagram||(jQuery("#buttonShowGvClassDiagram").attr("checked",!0),Action.changeDiagramType({type:"GvClass"})):Page.useEditableClassDiagram||Page.useGvClassDiagram||(jQuery("#buttonShowEditableClassDiagram").attr("checked",!0),Action.changeDiagramType({type:"editableClass"}))}else t=="featureModels"?(e=jQuery("#inputExample4 option:selected").val(),Page.useGvFeatureDiagram||(jQuery("#buttonShowGvFeatureDiagram").attr("checked",!0),Action.changeDiagramType({type:"GvFeature"}))):t=="smModels"?(e=jQuery("#inputExample2 option:selected").val(),!Page.useGvStateDiagram&&!Page.useJointJSClassDiagram&&(jQuery("#buttonShowGvStateDiagram").attr("checked",!0),Action.changeDiagramType({type:"GvState"}))):(e=jQuery("#inputExample3 option:selected").val(),Page.useStructureDiagram||(jQuery("#buttonShowStructureDiagram").attr("checked",!0),Action.changeDiagramType({type:"structure"})));return e},Page.getExampleType=function(){var e=jQuery("#exampleType option:selected").val();return e},Page.showCodeDone=function(){var e="#genstatus";jQuery(e).show(),setTimeout(function(){jQuery(e).hide()},2e3)},Page.showViewDone=function(){var e="#buttonViewComplete";jQuery(e).dialog({closeOnEscape:!0,hide:"puff",height:100,width:250}),setTimeout(function(){jQuery(e).dialog("close")},2e3)},Page.showExecutedResponse=function(e){jQuery("#executionMessage").html(e)},Page.showGeneratedCode=function(code,language,tabnumber){typeof tabnumber>"u"&&(tabnumber=""),Action.toggleTabsCheckbox(language),Page.applyGeneratedCodeAreaStyles(language);var errorMarkup=Page.getErrorMarkup(code,language),generatedMarkup=Page.getGeneratedMarkup(code,language);if(tabnumber==""?jQuery("#downloadArea").html(errorMarkup):jQuery("#messageArea").html(errorMarkup),language=="diagramUpdate"){const e=tabnumber==""?jQuery("#downloadArea"):jQuery("#messageArea");if(typeof AiFix<"u"&&AiFix.decorateErrorOutput&&(typeof AiApi<"u"&&AiApi.isVerified?AiApi.isVerified():!1)){const n=typeof Action<"u"&&Action.lastCompilerErrorHtml?Action.lastCompilerErrorHtml:errorMarkup;AiFix.decorateErrorOutput(e.get(0),n)}}if(language=="java"||language=="php"||language=="cpp"||language=="ruby"||language=="python"||language=="xml"||language=="sql"||language=="alloy"||language=="nusmv")jQuery("#innerGeneratedCodeRow"+tabnumber).html(formatOnce('<pre class="brush: {1};">{0}</pre>',generatedMarkup,language)),SyntaxHighlighter.highlight("code"),tabnumber==""&&(jQuery("#innerGeneratedCodeRow").nextAll().remove(),jQuery("#tabRow").html(""),Action.generateTabsCode(code),Action.toggleTabs());else if(language=="structureDiagram"){eval(generatedMarkup);var downloadLink='<div id="diagramLinkContainer"></div>';errorMarkup=downloadLink+errorMarkup,errorMarkup!=""&&jQuery("#messageArea").html(errorMarkup),Page.toggleStructureDiagramLink(!1)}else jQuery("#innerGeneratedCodeRow"+tabnumber).html(generatedMarkup)},Page.applyGeneratedCodeAreaStyles=function(e){var t=jQuery("#generatedCodeRow");t.show(),jQuery("#innerGeneratedCodeRow").show(),e=="diagramUpdate"?(t.removeClass("generatedCode"),t.removeClass("generatedDiagram")):e=="stateDiagram"||e=="classDiagram"||e=="structureDiagram"?(t.removeClass("generatedCode"),t.addClass("generatedDiagram"),e=="structureDiagram"&&jQuery("#innerGeneratedCodeRow").html('<svg id="generatedSVGCanvas"></svg>')):(t.removeClass("generatedDiagram"),t.addClass("generatedCode"))},Page.getErrorMarkup=function(e,t){var n="";if(t=="classDiagram"||t=="stateDiagram")n=e.split("<svg xmlns=")[0],n=n.replace(/&nbsp;\s*$/,"");else if(t=="javadoc"||t=="yumlDiagram")n=e.split("<iframe ")[0];else if(t=="diagramUpdate")n=e.replace(/<p>[\s\S]*/,"");else{var r=e.split("<p>URL_SPLIT");r.length>1&&(n=r[0])}return n},Page.getGeneratedMarkup=function(e,t){var n="";if(t=="classDiagram"||t=="stateDiagram")n=e.split("<svg width=")[1],n="<svg width="+n,n=n.replace(/<\/svg>$/,"");else if(t=="javadoc"||t=="yumlDiagram")n=e.split("<iframe ")[1],n="<iframe "+n;else if(t!="diagramUpdate")if(t=="structureDiagram")n=e.split("<p>URL_SPLIT")[1],n=n.replace(/##CANVAS_ID##/g,"generatedSVGCanvas"),n=jQuery("<div/>").html(n).text();else{var r=e.split("<p>URL_SPLIT");n=r.length>1?r[1]:e}return n},Page.toggleStructureDiagramLink=function(e,t){linkContainer=jQuery("#diagramLinkContainer"),e?(linkContainer.html(format("<a href='{0}' target='_blank' id='structureLink'>Download the SVG for the following</a>",t)),jQuery("#structureLink").on("click",function(n){Page.toggleStructureDiagramLink(!1)})):(linkContainer.html('<div id="buttonStructureLink" value="Generate SVG"></div>'),Page.initJQueryButton("buttonStructureLink"),Page.initAction("buttonStructureLink"))},Page.setFilename=function(e){jQuery("#filename").val(e)},Page.setFeedbackMessage=function(e){document.getElementById("feedbackMessage").innerHTML=e},Page.setExampleMessage=function(e){document.getElementById("exampleMessage").innerHTML=e},Page.getFeedbackMessage=function(){return document.getElementById("feedbackMessage").innerHTML},Page.catFeedbackMessage=function(e){var t=document.getElementById("feedbackMessage").innerHTML;document.getElementById("feedbackMessage").innerHTML=t+e},Page.getFilename=function(){return jQuery("#filename").val()},Page.getAdvancedMode=function(){return document.getElementById("advancedMode").value},Page.getModel=function(){return jQuery("#model").val()},jQuery.fn.selectRange=function(e,t){return this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(e,t);else if(this.createTextRange){var n=this.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select()}})},Page.isBookmarkURL=function(){const e=window.location.href,t=e.substring(e.indexOf("?model=")+1);return!!(e.includes("model")&&t.length!=0)},UmplePositionFactory=new Object,UmplePositionFactory.copy=function(e){return new UmplePosition(e.x,e.y,e.width,e.height)};function UmplePosition(e,t,n,r){this.x=e,this.y=t,this.width=n,this.height=r,this.set=function(o,a){this.x=o,this.y=a},this.subtract=function(o){return new UmplePosition(this.x-o.x,this.y-o.y,this.width-o.width,this.height-o.height)},this.add=function(o){return o==null?UmplePositionFactory.copy(this):new UmplePosition(this.x+o.x,this.y+o.y,this.width+o.width,this.height+o.height)},this.slopeAngle=function(o){return this.slopeAngleAndQuadrant(o)[0]},this.quadrant=function(o){return this.slopeAngleAndQuadrant(o)[1]},this.equalsIgnoreSize=function(o){return!(this.x!=o.x||this.y!=o.y)},this.slopeAngleAndQuadrant=function(o){var a=o.y-this.y,s=this.x-o.x,c=a/s,d=Math.atan(c)*180/3.14159,u=a>=0&&s>=0,f=a>=0&&s<0,v=a<0&&s>=0,h=a<0&&s<0,C=u?"top-right":f?"top-left":v?"bottom-right":"bottom-left";return[d,C]},this.slopeAngle360=function(o){var a;if(this.y==o.y)return this.x>o.x?180:0;var s=o.y-this.y,c=o.x-this.x,d=c/s;return o.y<this.y?a=90+Math.atan(d)*180/3.14159:a=270+Math.atan(d)*180/3.14159,Math.round(a)},this.travelForward=function(o,a){var s=new UmplePosition(0,0,0,0),c=0,d=0;return a>=0&&a<90?(c=Math.cos(a*3.14159/180)*o,d=Math.sin(a*3.14159/180)*o,s.x=this.x+c,s.y=this.y-d):a>=90&&a<180?(a-=90,c=Math.sin(a*3.14159/180)*o,d=Math.cos(a*3.14159/180)*o,s.x=this.x-c,s.y=this.y-d):a>=180&&a<270?(a-=180,c=Math.cos(a*3.14159/180)*o,d=Math.sin(a*3.14159/180)*o,s.x=this.x-c,s.y=this.y+d):(a-=270,c=Math.sin(a*3.14159/180)*o,d=Math.cos(a*3.14159/180)*o,s.x=this.x+c,s.y=this.y+d),s.x=Math.round(s.x),s.y=Math.round(s.y),s},this.wallsAreAdjacent=function(o,a){return!(o==a||o=="West"&&a=="East"||o=="East"&&a=="West"||o=="North"&&a=="South"||o=="South"&&a=="North")},this.areAnglesSimilar=function(o,a){var s=3;return Math.abs(o-a)<=s},this.toString=function(){return"("+this.x+","+this.y+","+this.width+","+this.height+")"}}jQuery(document).ready(function(){var e="filecode=",t="VIEW=",n="DIAGRAM=",r="PREF=",o=document.cookie.split(";"),a=null;jQuery("#restorecode").hide();for(var s=0;s<o.length;s++){var c=o[s].trim();c.indexOf(e)==0?a=c.substring(e.length,c.length):c.indexOf(t)==0?t=c.substring(t.length,c.length):c.indexOf(n)==0?n=c.substring(n.length,c.length):c.indexOf(r)!=-1&&(r=c.substring(r.length,c.length))}r.indexOf("g")!=-1&&Action.hidegdpr(),a!=null&&a.length!=0&&(jQuery("#restorecode").show(),setTimeout(function(){jQuery("#restorecode").hide()},3e4),jQuery("#restorecode").click(function(){jQuery("#restorecode").hide(),Page.setFilename(a),Action.loadFile(),t.indexOf("d")!=-1?jQuery("#buttonShowHideCanvas").prop("checked")||jQuery("#buttonShowHideCanvas").trigger("click"):jQuery("#buttonShowHideCanvas").prop("checked")&&jQuery("#buttonShowHideCanvas").trigger("click"),t.indexOf("t")!=-1?jQuery("#buttonShowHideTextEditor").prop("checked")||jQuery("#buttonShowHideTextEditor").trigger("click"):jQuery("#buttonShowHideTextEditor").prop("checked")&&jQuery("#buttonShowHideTextEditor").trigger("click"),t.indexOf("l")!=-1?jQuery("#buttonShowHideLayoutEditor").prop("checked")||jQuery("#buttonShowHideLayoutEditor").trigger("click"):jQuery("#buttonShowHideLayoutEditor").prop("checked")&&jQuery("#buttonShowHideLayoutEditor").trigger("click"),t.indexOf("a")!=-1?jQuery("#buttonToggleAttributes").prop("checked")||jQuery("#buttonToggleAttributes").trigger("click"):jQuery("#buttonToggleAttributes").prop("checked")&&jQuery("#buttonToggleAttributes").trigger("click"),t.indexOf("m")!=-1?jQuery("#buttonToggleMethods").prop("checked")||jQuery("#buttonToggleMethods").trigger("click"):jQuery("#buttonToggleMethods").prop("checked")&&jQuery("#buttonToggleMethods").trigger("click"),n.indexOf("e")!=-1?jQuery("#buttonShowEditableClassDiagram").prop("checked")||jQuery("#buttonShowEditableClassDiagram").trigger("click"):n.indexOf("c")!=-1?jQuery("#buttonShowGvClassDiagram").prop("checked")||jQuery("#buttonShowGvClassDiagram").trigger("click"):n.indexOf("s")!=-1&&(jQuery("#buttonShowGvStateDiagram").prop("checked")||jQuery("#buttonShowGvStateDiagram").trigger("click")),r.indexOf("p")!=-1?jQuery("#buttonPhotoReady").prop("checked")||jQuery("#buttonPhotoReady").trigger("click"):jQuery("#buttonPhotoReady").prop("checked")&&jQuery("#buttonPhotoReady").trigger("click"),r.indexOf("s")!=-1?jQuery("#buttonManualSync").prop("checked")||jQuery("#buttonManualSync").trigger("click"):jQuery("#buttonManualSync").prop("checked")&&jQuery("#buttonManualSync").trigger("click")}))}),window.onbeforeunload=function(e){var t=new Date;t.setTime(t.getTime()+720*60*60*1e3),Page.getUmpleCode()!=="//$?[End_of_model]$?"&&(document.cookie="filecode="+Page.getFilename()+";expires="+t.toGMTString()+";",cookie_view="VIEW=",jQuery("#buttonShowHideCanvas").prop("checked")&&(cookie_view+="d"),jQuery("#buttonShowHideTextEditor").prop("checked")&&(cookie_view+="t"),jQuery("#buttonShowHideLayoutEditor").prop("checked")&&(cookie_view+="l"),jQuery("#buttonToggleAttributes").prop("checked")&&(cookie_view+="a"),jQuery("#buttonToggleMethods").prop("checked")&&(cookie_view+="m"),jQuery("#buttonToggleTransitionLabel").prop("checked")&&(cookie_view+="r"),jQuery("#buttonToggleGuardLabel").prop("checked")&&(cookie_view+="g"),cookie_view+=";expires="+t.toGMTString()+";",document.cookie=cookie_view,cookie_diagram="DIAGRAM=",jQuery("#buttonShowEditableClassDiagram").prop("checked")?cookie_diagram+="e":jQuery("#buttonShowGvClassDiagram").prop("checked")?cookie_diagram+="c":jQuery("#buttonShowGvStateDiagram").prop("checked")&&(cookie_diagram+="s"),cookie_diagram+=";expires="+t.toGMTString()+";",document.cookie=cookie_diagram),cookie_pref="PREF=",Action.gdprHidden&&(cookie_pref+="g"),jQuery("#buttonPhotoReady").prop("checked")&&(cookie_pref+="p"),jQuery("#buttonManualSync").prop("checked")&&(cookie_pref+="s"),cookie_pref+=";expires="+t.toGMTString()+";",document.cookie=cookie_pref};function existSCookie(e){return document.cookie.match("(^|;)\\s*"+e+"\\s*=\\s*([^;]+)")}function setCookieBeforeClose(e){e=="on"?window.onbeforeunload=function(){window.randomSurveyRoll!=1?setSurveyCookie(60):notToday?setSurveyCookie(1):clickedForMoreSurvey==!1&&clickedStartSurvey==!1?setSurveyCookie(15):clickedForMoreSurvey==!0&&clickedStartSurvey==!1?setSurveyCookie(30):setSurveyCookie(60)}:window.onbeforeunload=function(){}}function groupHideToday(){hideRecruitementMessage(),document.getElementById("surveyMessage")!=null&&(document.getElementById("mainSurveySpan").removeChild(document.getElementById("surveyMessage")),document.getElementById("mainSurveySpan").removeChild(document.getElementById("surveyExtra"))),notToday=!0}var clickedForMoreSurvey=!1,clickedStartSurvey=!1,displayedText=!1,notToday=!1,timeSurveyUp=!1;if(existSCookie("surveyCookie")==null&&window.surveyData!=null){if(window.randomSurveyRoll==1){var surveySeen=window.localStorage.getItem("surveyShown");if(surveySeen==null||surveySeen!=window.surveyData.SurveyURL){timeSurvey&&clearTimeout(timeSurvey);var timeSurvey=setTimeout(function(){timeSurveyUp=!0},window.surveyData.MinutesBeforePrompt*60*1e3),beforeInstance=TabControl.getCurrentHistory().currentIndex;displayedText||document.addEventListener("mouseover",function(){TabControl.getCurrentHistory().currentIndex-beforeInstance>window.surveyData.EditsBeforePrompt&&!displayedText&&timeSurveyUp&&(displaySurvey(),this.removeEventListener("mouseover",arguments.callee))})}}setCookieBeforeClose("on")}function setSurveyCookie(e){let t=new Date(Date.now()+e*24*60*60*1e3);document.cookie="surveyCookie=done; expires="+t.toUTCString()+"; path=/;"}function displaySurvey(){displayedText=!0;var e=document.getElementById("mainSurveySpan");if(!e.contains(document.getElementById("surveyMessage"))){var t=document.createElement("span");t.innerHTML='<span><a href="'+window.surveyData.SurveyURL+'" target="umplesurvey" onmouseover="showRecruitementMessage()">'+window.surveyData.InvitationalMessage+"</a></span><br/>",t.id="surveyMessage",e.appendChild(t);var n=document.createElement("span");n.innerHTML=window.surveyData.RecruitmentText+'<div id="surveyPopUp"><span class="linkToSurvey" onclick="countClicked()"><a href="'+window.surveyData.SurveyURL+'" target="umplesurvey"class="linkToSurvey">Start Survey</a></span><span onclick="groupHideToday()" class="linkToNotSurvey">Not Today</span></div>',n.id="surveyExtra",e.appendChild(n),n.addEventListener("mouseleave",function(){hideRecruitementMessage()}),t.addEventListener("click",function(){countClicked()}),sendToSurveyLog("SurveyRequested")}}function showRecruitementMessage(){clickedForMoreSurvey=!0,document.getElementById("surveyExtra").classList.contains("fade-in")||(document.getElementById("surveyExtra").classList.remove("fade-outInst"),document.getElementById("surveyExtra").classList.add("fade-in"))}function hideRecruitementMessage(){document.getElementById("surveyExtra").classList.contains("fade-outInst")||(document.getElementById("surveyExtra").classList.remove("fade-in"),document.getElementById("surveyExtra").classList.add("fade-outInst"))}function countClicked(){window.localStorage.setItem("surveyShown",window.surveyData.surveyURL),clickedStartSurvey=!0,sendToSurveyLog("SurveyClicked")}function sendToSurveyLog(e){console.log("processing");let t=new Date(Date.now()).toString();e=="SurveyRequested"&&jQuery.ajax({url:"umple.php",method:"POST",data:{surveyLogInfo:`
`+e+" "+t},dataType:"html"}).done(function(){console.log("Success: Files sent!")}).fail(function(){console.log("An error occurred, the files couldn't be sent!")}),e=="SurveyClicked"&&jQuery.ajax({url:"umple.php",method:"POST",data:{surveyLogInfo2:`
`+e+" "+t},dataType:"html"}).done(function(){console.log("Success: Files sent!")}).fail(function(){console.log("An error occurred, the files couldn't be sent!")})}UmpleSystem=new Object,UmpleSystem.umpleClasses=[],UmpleSystem.umpleAssociations=[],UmpleSystem.umpleTransitions=[],UmpleSystem.position=function(){var e=jQuery("#umpleCanvas"),t=Math.ceil(e.offset().left-e.scrollLeft()),n=Math.ceil(e.offset().top-e.scrollTop()),r=new UmplePosition(t,n,0,0);return r},UmpleSystem.findIn=function(e,t){if(e==null)return null;for(var n=0;n<e.length;n++){var r=e[n];if(r.id==t)return r}return null},UmpleSystem.find=function(e){return UmpleSystem.findIn(this.umpleClasses,e)},UmpleSystem.findAssociation=function(e){var t=UmpleSystem.findIn(this.umpleAssociations,e);return t},UmpleSystem.createAssociation=function(e,t,n,r){var o=new UmpleAssociation;return o.id=this.nextAssociationId(),o.setClasses(e,t),o.setOffsetOnePosition(n),o.setOffsetTwoPosition(r),o.setDefaultMultiplicities(),o.setDefaultRoles(),o.setName(o.getName()),e==t?o.adjustReflexiveEndpoints():o.trimOverlap(),this.addAssociation(o)},UmpleSystem.createTransition=function(e,t){var n=new UmpleTransition;return n.id=this.nextTransitionId(),n.setStates(fromStateId,toStateId),n.setDefaultEvent(),n.setName(n.getName()),this.addTransition(n)},UmpleSystem.createGeneralization=function(e,t){var n=UmpleSystem.find(e);n.extendsClass=t,UmpleSystem.updateClass(n)},UmpleSystem.addAssociation=function(e){this.umpleAssociations.push(e);var t=this.redrawAssociation(e);return e},UmpleSystem.addTransition=function(e){this.umpleTransitions.push(e);var t=this.redrawTransition(e);return e},UmpleSystem.createClass=function(e){var t=new UmpleClass;t.id=this.nextId("NewClass"),t.name=t.id,t.position.set(e.x-UmpleSystem.position().x,e.y-UmpleSystem.position().y,UmpleClassFactory.defaultSize.width,UmpleClassFactory.defaultSize.height);var n=this.addClass(t);return UmpleSystem.redrawGeneralizationsTo(n),n},UmpleSystem.addClass=function(e){this.umpleClasses.push(e),this.updateClass(e);var t=jQuery("#"+e.id);return t.click(Action.classClicked),t.mouseover(function(n){Action.classHover(n,!0)}),t.mouseout(function(n){Action.classHover(n,!1)}),t.mousedown(function(n){setTimeout(function(){Action.classMouseDown(n)},400)}),t.mouseup(function(n){Action.classMouseUp(n)}),Page.readOnly||t.draggable({containment:"parent",stop:function(n,r){DiagramEdit.classMoved(n.target)}}),jQuery(".ui-icon-gripsmall-diagonal-se").removeClass("ui-icon-gripsmall-diagonal-se"),e},UmpleSystem.replaceClass=function(e){for(var t=0;t<this.umpleClasses.length;t++){var n=this.umpleClasses[t];if(n.id==e.id){var r="#"+n.id,o=r+"_generalization",a=jQuery(r).get(),s=jQuery(o).get();jQuery(a).attr("id",e.id),s!=null&&(jQuery(s).attr("id",e.id+"_generalization"),jQuery(s).remove()),this.umpleClasses[t]=e,this.updateClass(this.umpleClasses[t]);return}}},UmpleSystem.renameClass=function(e,t,n){var r=UmpleSystem.find(e),o="#"+e,a=o+"_generalization";n=this.nextId(n),r.id=n,r.name=n,r.oldname=t,jQuery(o).attr("id",r.id),jQuery(a).get()!=null&&jQuery(a).attr("id",r.id+"_generalization");for(var s=0;s<this.umpleAssociations.length;s++){var c=this.umpleAssociations[s];c.classOneId==t&&(c.classOneId=r.id),c.classTwoId==t&&(c.classTwoId=r.id)}for(var s=0;s<this.umpleClasses.length;s++){var d=this.umpleClasses[s];d.extendsClass==t&&(d.extendsClass=n,this.updateClass(d))}return UmpleSystem.updateClass(r),r},UmpleSystem.replaceAssociation=function(e){for(var t=0;t<this.umpleAssociations.length;t++){var n=this.umpleAssociations[t];n.id==e.id&&(this.umpleAssociations[t]=e,index=t)}this.redrawAssociation(e)},UmpleSystem.updatePosition=function(e,t,n){e.position.x=t-UmpleSystem.position().x,e.position.y=n-UmpleSystem.position().y,UmpleSystem.redrawAssociationsFor(e),UmpleSystem.redrawGeneralizationsTo(e),UmpleSystem.updateClass(e)},UmpleSystem.updateClass=function(e){var t=e.drawable(),n=t[0],r=t[1],o=jQuery("#"+Page.umpleCanvasId()),a=jQuery("#"+e.id);if(o.append(n),r!=null)for(var s=0;s<r.length;s++)o.append(r[s]);UmpleSystem.redraw(e);var c=2,d=!1;a.width()>e.position.width+c&&(e.position.width=a.width(),d=!0),a.height()>e.position.height+c&&(e.position.height=a.height(),d=!0),d&&UmpleSystem.redraw(e),jQuery(".ui-icon-gripsmall-diagonal-se").removeClass("ui-icon-gripsmall-diagonal-se")},UmpleSystem.redrawAssociationsFor=function(e){for(var t=0;t<this.umpleAssociations.length;t++){var n=this.umpleAssociations[t];n.contains(e)&&UmpleSystem.redrawAssociation(n)}},UmpleSystem.redrawAssociation=function(e){var t="#"+e.id,n="#"+Page.umpleCanvasId(),r=null;return r=e.drawable(),jQuery(n).append(r),Page.isPhotoReady()||(jQuery(t).click(Action.associationClicked),jQuery(t).mouseover(function(o){Action.associationHover(o,!0)}),jQuery(t).mouseout(function(o){Action.associationHover(o,!1)}),UmpleSystem.setDragableAssociationAnchor(e,0),UmpleSystem.setDragableAssociationAnchor(e,1)),r},UmpleSystem.redrawTransition=function(e){var t="#"+e.id,n="#"+Page.umpleCanvasId(),r=null;return r=e.drawable(),jQuery(n).append(r),Page.isPhotoReady()||jQuery(t).click(Action.transitionClicked),r},UmpleSystem.redrawGeneralizationsTo=function(e){for(var t=0;t<this.umpleClasses.length;t++){var n=this.umpleClasses[t];if(n.extendsClass==e.id)this.updateClass(n);else if(n.interfaces.length>0)for(var r=0;r<n.interfaces.length;r++)n.interfaces[r]==e.id&&this.updateClass(n)}},UmpleSystem.update=function(){for(var e=0;e<this.umpleClasses.length;++e){var t=this.umpleClasses[e];t.position.height=28,Page.showAttributes&&(t.position.height+=17*t.attributes.size()),Page.showMethods&&(t.position.height+=17*t.methods.size()),UmpleSystem.updateClass(t)}for(var e=0;e<this.umpleAssociations.length;++e){var n=UmpleSystem.find(this.umpleAssociations[e].classOneId),r=this.umpleAssociations[e].offsetOnePosition.x+n.position.x+UmpleSystem.position().x,o=this.umpleAssociations[e].offsetOnePosition.y+n.position.y+UmpleSystem.position().y,a=Action.associationSnapClassReady(r,o,n),s=UmpleSystem.find(this.umpleAssociations[e].classTwoId);r=this.umpleAssociations[e].offsetTwoPosition.x+s.position.x+UmpleSystem.position().x,o=this.umpleAssociations[e].offsetTwoPosition.y+s.position.y+UmpleSystem.position().y;var c=Action.associationSnapClassReady(r,o,s),d=new UmplePosition(a[0],a[1],0,0),u=new UmplePosition(c[0],c[1],0,0);this.umpleAssociations[e].setOffsetOnePosition(d),this.umpleAssociations[e].setOffsetTwoPosition(u),UmpleSystem.redrawAssociation(this.umpleAssociations[e])}for(var e=0;e<this.umpleClasses.length;++e)UmpleSystem.trimOverlappingAssociations(this.umpleClasses[e])},UmpleSystem.redraw=function(e){var t=e.position.x+UmpleSystem.position().x,n=e.position.y+UmpleSystem.position().y,r="#"+e.id,o=r+"_generalization",a=r+"_width",s=r+"_height",c=new Object;if(c.top=n,c.left=t,jQuery(r).offset(c),jQuery(a).width(e.position.width),jQuery(s).height(e.position.height),!Page.isPhotoReady()){var d=jQuery(o).get();d!=null&&(jQuery(o).click(Action.generalizationClicked),jQuery(o).mouseover(function(u){Action.generalizationHover(u,!0)}),jQuery(o).mouseout(function(u){Action.generalizationHover(u,!1)}))}this.redrawAssociationsFor(e)},UmpleSystem.trimOverlappingAssociations=function(e){Page.showLayoutLoading();for(var t=0;t<UmpleSystem.umpleAssociations.length;t++){var n=UmpleSystem.umpleAssociations[t];if(n.contains(e)){var r=UmplePositionFactory.copy(n.offsetOnePosition),o=UmplePositionFactory.copy(n.offsetTwoPosition);if(n.isReflexive())n.adjustReflexiveEndpoints();else if(!r.equalsIgnoreSize(n.offsetOnePosition)||!o.equalsIgnoreSize(n.offsetTwoPosition)){Page.showLayoutLoading(),UmpleSystem.redrawAssociation(n);var a=Json.toString(n);DiagramEdit.updateUmpleText({actionCode:format("action=editAssociation&actionCode={0}",a),codeChange:!1})}}}UmpleSystem.umpleAssociations.length==0&&Action.setjustUpdatetoSaveLater(!1),Page.hideLoading()},UmpleSystem.updateAnchor=function(e,t){var n="#"+e.id,r=n+"_anchor"+t,o=n+"_hover"+t,a="";switch(t){case 0:a="left top";break;case 1:a="left center";break;case 2:a="left bottom";break;case 3:a="center bottom";break;case 4:a="right bottom";break;case 5:a="right center";break;case 6:a="right top";break;case 7:a="center top";break}jQuery(r).show(),jQuery(o).show(),jQuery(r).position({my:"center",at:a,of:n}),jQuery(o).position({my:"center",at:a,of:n}),jQuery(r).hide(),jQuery(o).hide()},UmpleSystem.setDragableAssociationAnchor=function(e,t){if(!Page.readOnly)if(e.isReflexive()){var n="#"+e.id+"_anchor"+t,r=t==0?e.classOneId:e.classTwoId;jQuery(n).draggable({drag:function(o,a){DiagramEdit.reflexiveAssociationMoving("#"+o.target.id)},stop:function(o,a){DiagramEdit.associationMoved("#"+o.target.id)},cursor:"pointer",snap:"#"+r,snapTolerance:5,containment:"#"+r,zIndex:1})}else{var n="#"+e.id+"_anchor"+t,r=t==0?e.classOneId:e.classTwoId;jQuery(n).draggable({drag:function(s,c){DiagramEdit.regularAssociationMoving("#"+s.target.id)},stop:function(s,c){DiagramEdit.associationMoved("#"+s.target.id)},cursor:"pointer",snap:"#"+r,snapTolerance:5,containment:"#"+r,zIndex:1})}},UmpleSystem.updatingSize=function(e,t,n){e.position.width=t,e.position.height=n,UmpleSystem.redraw(e)},UmpleSystem.removeClass=function(e){for(var t=0;t<this.umpleClasses.length;t++){var n=this.umpleClasses[t];if(n.id==e){this.umpleClasses.splice(t,1);var r="#"+e,o=r+"_generalization";return jQuery(r).remove(),jQuery(o).remove(),n}}return null},UmpleSystem.removeAssociation=function(e){for(var t=0;t<this.umpleAssociations.length;t++){var n=this.umpleAssociations[t];if(n.id==e){this.umpleAssociations.splice(t,1);var r="#"+e;return jQuery(r).remove(),n}}return null},UmpleSystem.removeTransition=function(e){for(var t=0;t<this.umpleAssociations.length;t++){var n=this.umpleAssociations[t];if(n==e){this.umpleTransitions.splice(t,1);var r="#"+e;return jQuery(r).remove(),n}}return null},UmpleSystem.removeGeneralization=function(e){var t="#"+e;jQuery(t).remove();var n=e.replace("_generalization",""),r=UmpleSystem.find(n);r.extendsClass=null;var o=new UmpleGeneralization;return o.childId=r.id,o.parentId=r.extendsClass,o},UmpleSystem.redrawCanvas=function(){UmpleSystem.merge(UmpleSystem)},UmpleSystem.merge=function(e){UmpleSystem.mergeClasses(e),UmpleSystem.mergeAssociations(e)},UmpleSystem.mergeClasses=function(e){if(e==null){for(;this.umpleClasses.length>0;)this.removeClass(this.umpleClasses[0].id);return}for(var t=0;t<this.umpleClasses.length;t++){var n=this.umpleClasses[t],r=this.findIn(e.umpleClasses,n.id);r==null?(t-=1,this.removeClass(n.id)):this.replaceClass(UmpleClassFactory.create(r))}for(var t=0;t<e.umpleClasses.length;t++){var r=e.umpleClasses[t],o=this.find(r.id);o==null&&this.addClass(UmpleClassFactory.create(r))}for(var t=0;t<this.umpleClasses.length;t++){var n=this.umpleClasses[t];(n.extendsClass!=null||n.interfaces.length>0)&&this.updateClass(n)}},UmpleSystem.mergeAssociations=function(e){if(e==null){for(;this.umpleAssociations.length>0;)this.removeAssociation(this.umpleAssociations[0].id);return}for(var t=0;t<this.umpleAssociations.length;t++){var n=this.umpleAssociations[t],r=this.findIn(e.umpleAssociations,n.id);r==null?(t-=1,this.removeAssociation(n.id)):this.replaceAssociation(UmpleAssociationFactory.create(r))}for(var t=0;t<e.umpleAssociations.length;t++){var o=this.findAssociation(e.umpleAssociations[t].id);if(o==null){var r=UmpleAssociationFactory.create(e.umpleAssociations[t]);this.addAssociation(r)}}},UmpleSystem.nextId=function(e){var t="umpleElement_",n=t+"0";typeof e<"u"&&(t=e,n=e);for(var r=!1,o=0;o<100&&!r;){o>0&&(n=t+o),r=!0;for(var a=0;a<this.umpleClasses.length;a++)if(this.umpleClasses[a].id==n){r=!1,o+=1;break}if(r)return n}return""},UmpleSystem.nextAssociationId=function(e){var t="umpleAssociation_",n=t+"0";typeof e<"u"&&(t=e,n=e);for(var r=!1,o=0;o<100&&!r;){o>0&&(n=t+o),r=!0;for(var a=0;a<this.umpleAssociations.length;a++)if(this.umpleAssociations[a].id==n){r=!1,o+=1;break}if(r)return n}return""},UmpleSystem.nextTransitionId=function(e){var t="umpleTransition_",n=t+"0";typeof e<"u"&&(t=e,n=e);for(var r=!1,o=0;o<100&&!r;){o>0&&(n=t+o),r=!0;for(var a=0;a<this.umpleTransitions.length;a++)if(this.umpleTransitions[a].id==n){r=!1,o+=1;break}if(r)return n}return""},TabControl=new Object,TabControl.maxTabs=10,TabControl.maxNameLength=32,TabControl.defaultTabName="Untitled",TabControl.showHideKey="showUmpleTabs",TabControl.requestQueue=[],TabControl.remoteDelim="%NAME:CONTENT:DELIM%",TabControl.illegalNameRegxp=/[\/\?<>\\:\*\|":]/g,TabControl.controlNameRegxp=/[\x00-\x1f\x80-\x9f]/g,TabControl.reservedNameRegxp=/^\.+$/,TabControl.windowsReservedNameRegxp=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,TabControl.windowsTrailingRegxp=/[\. ]+$/,TabControl.nameReplacement="_",TabControl.init=function(){jQuery("#tabs").sortable({axis:"x",helper:"clone",items:"li:not(.unsortable)",update:TabControl.saveActiveTabs}),jQuery.fn.selectText=function(){var e=document,t=this[0];if(e.body.createTextRange){var n=document.body.createTextRange();n.moveToElementText(t),n.select()}else if(window.getSelection){var r=window.getSelection(),n=document.createRange();n.selectNodeContents(t),r.removeAllRanges(),r.addRange(n)}},TabControl.reset(),localStorage[TabControl.showHideKey]||TabControl.hideTabs(),TabControl.loadAllTabs()},TabControl.showTabs=function(){jQuery("#toggleTabsButton").html("Hide Tabs"),jQuery("#tabControl").show(),localStorage[TabControl.showHideKey]=!0},TabControl.hideTabs=function(){jQuery("#toggleTabsButton").html("Show Tabs"),jQuery("#tabControl").hide(),delete localStorage[TabControl.showHideKey]},TabControl.saveActiveTabs=function(){var e=[];jQuery(".tabname").each(function(){e.push(jQuery(this).text())}),TabControl.addToRequestQueue("scripts/tab_control.php",function(t){},format("index=1&&model={0}&&orderedTabNames={1}",Page.getModel(),encodeURIComponent(JSON.stringify(e))))},TabControl.getActiveTabId=function(){return TabControl.activeTab?TabControl.activeTab.id:null},TabControl.isHidden=function(){return jQuery("#tabControl").is(":hidden")},TabControl.reset=function(){TabControl.activeTab=null,TabControl.tabs={},TabControl.nextTabId=1,TabControl.requestQueue=[],TabControl.queuedTabs=0,TabControl.reservedNames={model:!0}},TabControl.sanitizeName=function(e){var t=e.replace(TabControl.illegalNameRegxp,TabControl.nameReplacement).replace(TabControl.controlNameRegxp,TabControl.nameReplacement).replace(TabControl.reservedNameRegxp,TabControl.nameReplacement).replace(TabControl.windowsReservedNameRegxp,TabControl.nameReplacement).replace(TabControl.windowsTrailingNameRegxp,TabControl.nameReplacement);return t},TabControl.findNextAvailableTabName=function(e){for(var t=e,n=2;TabControl.reservedNames.hasOwnProperty(t);)t=e+n++;return t},TabControl.extractNameFromCode=function(e){var t=/class[\s]*([a-zA-Z_$][a-zA-Z_$0-9]*)[\s]*{/g,n=t.exec(e);if(n)return n[1]},TabControl.createTab=function(e,t,n){if(!(Page.readOnly&&e=="afterTabControlInit")&&(e=="afterTabControlInit"&&(e=null),Object.keys(TabControl.tabs).length!=TabControl.maxTabs)){var r=TabControl.nextTabId++,o=e||TabControl.defaultTabName;if(t!=null){if(!e){var a=TabControl.extractNameFromCode(t);a&&(o=a)}}else t=Page.modelDelimiter;var s=TabControl.findNextAvailableTabName(o);TabControl.tabs[r]={name:s,id:r,history:History.getInstance(r),nameIsEphemeral:e==null},TabControl.reservedNames[s]=!0,TabControl.saveTab(r,t);var c=jQuery("#createTabBtn"),d=jQuery('<li id="tab'+r+'" class=""><a class="tabname" title="Double-click to rename tab" id="tabName'+r+`" href="javascript:TabControl.selectTab('`+r+`');">`+s+`</a><button class="tabbtn" onclick="javascript:TabControl.deleteTab('`+r+`');">&times;</button></li>`);d.insertBefore(c),Object.keys(TabControl.tabs).length==TabControl.maxTabs&&c.hide();var u=TabControl.getTabNameDiv(r);handleNameEdit=function(){u.attr("contentEditable",!1),window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty();var f=u.text(),v=TabControl.tabs[r].name;if(f!==v){var h=!1;TabControl.sanitizeName(f)!==f?alert("The name contains invalid characters. Please try again."):f.length===0||f.length>TabControl.maxNameLength?alert("Name must be between 1 and "+TabControl.maxNameLength+" characters long. Please try again."):TabControl.reservedNames.hasOwnProperty(f)?alert("This name is already in use. Please try again."):h=!0,h?(u.text(f),TabControl.renameTab(r,f)):(u.text(v),u.selectText(),u.attr("contentEditable",!0))}},u.bind("dblclick",function(){u.attr("contentEditable",!0),u.focus(),u.selectText()}).blur(handleNameEdit).keypress(function(f){var v=13,h=8;f.which==v&&u.blur(),f.which!=h&&u.text().length>=TabControl.maxNameLength&&f.preventDefault()}),n||TabControl.saveActiveTabs(),TabControl.selectTab(r)}},TabControl.saveTab=function(e,t){var n=TabControl.getTabFilename(TabControl.tabs[e].name),r=Page.getModel();localStorage[n]=t,String(Page.getFilename()).indexOf("tasks")!==-1&&(n="tasks/"+n,r="tasks/"+r);var o=t.replace(/&/g,"%26").replace(/\+/g,"%2B");TabControl.addToRequestQueue("scripts/compiler.php",TabControl.saveTabCallback(e),format("save=1&&lock=1&&model={2}&&umpleCode={0}&&filename={1}",o,n,r))},TabControl.saveTabCallback=function(e){return function(t){TabControl.tabs[e]&&(TabControl.tabs[e].filename=t.responseText)}},TabControl.selectTab=function(e){if(TabControl.activeTab){if(e==TabControl.activeTab.id)return;var t=TabControl.getTabDiv(TabControl.activeTab.id);t.removeClass("selected"),TabControl.saveTab(TabControl.activeTab.id,Page.getUmpleCode())}TabControl.activeTab=TabControl.tabs[e];var n=TabControl.getTabDiv(e);n.addClass("selected"),TabControl.getCurrentHistory().setButtons();var r=TabControl.getTabFilename(TabControl.activeTab.name);Page.setUmpleCode(localStorage[r]),Action.setCaretPosition(0),Action.updateLineNumberDisplay(),Object.keys(TabControl.tabs).length>1&&setTimeout('Action.processTyping("newEditor",false)',Action.waiting_time)},TabControl.loadAllTabs=function(){TabControl.addToRequestQueue("scripts/tab_control.php",TabControl.loadAllTabsCallback,format("list=1&&model={0}",Page.getModel()))},TabControl.loadAllTabsCallback=function(e){var t=e.responseText.split("<br />"),n=!1;t.map(function(r){if(r){var o=r.split(TabControl.remoteDelim),a=o[0],s=o[1];!a||a==="model"||(n||(TabControl.hideTabs(),n=!0),TabControl.createTab(a,s,!0))}}),n?TabControl.showTabs():TabControl.createTab(null,Page.getUmpleCode())},TabControl.deleteTab=function(e){if(!Page.readOnly&&Object.keys(TabControl.tabs).length>1){var r=TabControl.getTabNameDiv(e),t=confirm("Are you sure you want to remove the file "+r.text()+".ump from the model? If you answer OK, the code will be deleted; this cannot be undone, so consider answering Cancel and saving it first.");if(!t)return;var n=e==TabControl.activeTab.id;TabControl.getTabDiv(e).remove();var r=TabControl.tabs[e].name,o=TabControl.tabs[e].filename;delete TabControl.reservedNames[r],delete TabControl.tabs[e],delete localStorage[o];var a=jQuery("#createTabBtn");a.show(),TabControl.addToRequestQueue("scripts/tab_control.php",function(s){},format("delete=1&&model={0}&&name={1}",Page.getModel(),r)),n&&(TabControl.activeTab=null,TabControl.selectTab(Object.keys(TabControl.tabs)[0])),TabControl.saveActiveTabs()}},TabControl.renameTab=function(e,t,n){if(!Page.readOnly&&!TabControl.reservedNames.hasOwnProperty(t)){var r=TabControl.tabs[e].name;if(r!=t){var o=TabControl.getTabFilename(r),a=TabControl.getTabFilename(t);localStorage[a]=localStorage[o],delete localStorage[o],n&&TabControl.getTabNameDiv(e).text(t),TabControl.tabs[e].nameIsEphemeral=!1,TabControl.addToRequestQueue("scripts/tab_control.php",TabControl.renameTabCallback(e,t),format("rename=1&&model={0}&&oldname={1}&&newname={2}",Page.getModel(),r,t)),TabControl.saveActiveTabs()}}},TabControl.renameTabCallback=function(e,t){return function(n){delete TabControl.reservedNames[TabControl.tabs[e].name],TabControl.reservedNames[t]=!0,TabControl.tabs[e].name=t}},TabControl.getTabFilename=function(e){return format("{0}/{1}.ump",Page.getModel(),e)},TabControl.getTabNameDiv=function(e){return jQuery("#tabName"+e)},TabControl.getTabDiv=function(e){return jQuery("#tab"+e)},TabControl.addToRequestQueue=function(e,t,n){var r={endpoint:e,callback:TabControl.getQueuedCallback(t),parameters:n};TabControl.requestQueue.push(r),TabControl.requestQueue.length===1&&(jQuery(".bookmarkableUrl").addClass("disabled"),Ajax.sendRequest(r.endpoint,TabControl.getQueuedHeadCallback(r.callback),r.parameters))},TabControl.getQueuedHeadCallback=function(e){return function(t){TabControl.requestQueue.shift(),e(t)}},TabControl.getQueuedCallback=function(e){return function(t){var n=TabControl.requestQueue.shift();e(t),n?n.hasOwnProperty("endpoint")?Ajax.sendRequest(n.endpoint,n.callback,n.parameters):n.callback():Page.modelLoadingCount===0&&Page.layoutLoadingCount===0&&Page.canvasLoadingCount===0&&jQuery(".bookmarkableUrl").removeClass("disabled")}},TabControl.addCallbackToRequestQueue=function(e){var t={callback:TabControl.getQueuedCallback(e)};TabControl.requestQueue.push(t),TabControl.requestQueue.length===1&&(jQuery(".bookmarkableUrl").addClass("disabled"),TabControl.getQueuedHeadCallback(t.callback()))},TabControl.getCurrentHistory=function(){return TabControl.activeTab?TabControl.tabs[TabControl.activeTab.id].history:History.getInstance()},TabControl.useActiveTabTo=function(e){return TabControl.activeTab?e.bind(null,TabControl.activeTab.id):function(){}};var ToolTips={},undo,redo,toggleTextEditor;navigator.appVersion.indexOf("Mac")!=-1?(undo="cmd-z",redo="cmd-shift-z",toggleTextEditor="ctrl-t"):(undo="ctrl-z",redo="ctrl-y",toggleTextEditor="ctrl-alt-shift-t"),ToolTips.tooltipEntries={ttSaveBookmark:["li","Click to bookmark this model"],ttSaveModel:["li","Click to save this model for ongoing editing.<br/><br/>After clicking this, you will need to use your browser's functionality to copy or bookmark the newly-created semi-permanent URL.<br/><br/>As you make further edits at the new URL, they will be instantly saved. You will be able to come back any time to continue editing.<br/><br/>The URL and its model will continue to be available for up to a year from the last time you edited it.<br/><br/>Do not use the new URL as a safe backup: If you (or anyone else who you give the URL) modifies or deletes the text, then your work would be lost. <br/><br/>The following describes BETA capabilities. Please report any issues:<br/><br/>You can share the URL with others, or open multiple tabs with it by yourself. As you type the text will change simultaneously in all open tabs."],buttonCopyClip:["li","Click to copy the code to the clipboard<br/><br/>After doing this you can paste the result into a .ump file on your computer. Note that this will copy diagram layout information which is normally hidden, as well as the Umple text."],buttonCopy:["li","Click to open a popup showing the current Umple code (including layout), with a timestamp header for reference."],buttonCopyCommandLine:["li","Click to copy a script to execute your model on the Linux or Mac command line.<br/><br/>After doing this, paste the result into a terminal.<br/><br/>The script will create a new directory under ~/tmp, create the umple file there as test.ump. compile the Umple and resulting Java (and suggest for you how to run the Java if there is a main program present).<br/><br/>Before doing this you need to install the Java development environment and an 'umple' script using a tool such as homebrew. The Umple script should run 'java -jar umple.jar' with a .ump file as an argument  </br><b>Shortcut: [ctrl-o]</b>"],buttonCopyEncodedURL:["li","Click to view a URL encoded with this model.<br/><br/>This only works for small models (about 5 classes or less).<br/><br/>This is ideal for embedding small examples directly in presentation slides (e.g., PowerPoint), or for sharing a quick reproducible model link."],buttonCopyLocalBrowser:["li","Click to save the Umple text from the current tab in your browser local storage for later reloading using Load from Browser below.<br/><br/>This can be useful to transfer text to a different browser tab, or temporarily stash some work you may want to come back to. But it should not be used for a permanent backup."],buttonLoadLocalBrowser:["li","Click to load the Umple text from what you had previously saved in this browser (above).<br/><br/>This operation can be undone."],buttonDownloadFiles:["li","Click to download your entire model, one .ump file per Umple tab.<br/><br/>This is a two-step process. After you click this, the zip file will be created and a link will appear below; you must click on that link to actually complete the download.<br/><br/>This is the best way to safely back up your work to your own computer."],buttonCreateTask:["li","Create a modeling task for participants to try.</br>You will be able to give them some instructions. The model currently appearing here will be their starting point. The instructions could be requirements to model, or changes to make. This can be for an experiment or a course assignment."],buttonLoadTask:["li","Load a model and a set of instructions that have been created by someone running an experiment or a teacher of a course. You need to enter the task name that the person gave you."],buttonRequestAllZip:["li","Create a zip file to download, containing all submissions for this task."],ttDropboxSaver:["li","Click to save your model to dropbox"],ttAiStatus:["li","Click to configure AI settings including provider selection, API key, and model selection.<br/><br/>Free models (e.g., on OpenRouter) are shown at the top of the model list. You need to set up your AI provider and verify your API key before using AI features."],ttGenerateFromReq:["li","Generate Umple code from requirements defined in your code editor.<br/><br/>1. Define requirements in your Umple code using <code>req ID { text }</code> syntax.<br/>2. Click to open a dialog showing all parsed requirements.<br/>3. Select which requirements to use for code generation.<br/>4. AI generates Umple code (class diagrams or state machines) with <code>implementsReq</code> tags linking back to your selected requirements.<br/><br/>See https://cruise.umple.org/umple/Requirements.html for syntax details.<br/><br/><b>Estimated Token Usage:</b><br/>\u2022 Initial generation: ~2,000 tokens<br/>\u2022 Each self-correction pass: ~1,800 tokens<br/><br/><i>Note: Actual usage varies with requirement text length and the model you use. Reasoning models (e.g., o1, o3) may consume significantly more tokens due to internal reasoning processes.</i><br/><br/>You must configure your AI settings first."],ttExplain:["li","Get an AI-powered explanation of your current Umple code.<br/><br/><b>Estimated Token Usage:</b><br/>\u2022 Initial explanation: ~600 tokens<br/>\u2022 Each follow-up question: ~700 tokens<br/><br/><i>Note: Actual usage varies with code size and the model you use. Reasoning models (e.g., o1, o3) may consume significantly more tokens due to internal reasoning processes.</i><br/><br/>You must configure your AI settings first."],ttShowRefreshUmpleCompletely:["li","Click to erase your work and completely restart UmpleOnline.<br/><br/>Use this only if UmpleOnline gets into a state where things seem messed up. After doing this you will NOT be able to use the undo command to restore the model. The text and diagrams will be permanently erased. You should select 'Download Files' above first to back up your work.<br/><br/>For safety, this is a two-step process: A confirmation link will appear below that you must click on after you click on this."],ttLoadBlankModel:["li","Click to load a blank model.<br/><br/>This can be undone using the undo command in Tools. This is the best way to start new work, but you may want to download your files first (above) to back them up."],ttDropboxChooser:["li","Click to load an example from dropbox"],buttonAddClass:["li","Click the diagram to add a class </br><b>Shortcut: [c]</b>"],buttonAddAssociation:["li","Click on two classes to create an association </br><b>Shortcut: [a]</b>"],buttonAddGeneralization:["li","Click on two classes to create a generalization </br><b>Shortcut: [g]</b>"],buttonDeleteEntity:["li","Click on a class, association, or generalization to delete that entity </br><b>Shortcut: [DEL]</b>"],buttonUndo:["li","Click to undo the most recent action </br><b>Shortcut: ["+undo+"]</b>"],buttonRedo:["li","Click to redo the most recent undone action </br><b>Shortcut: ["+redo+"]</b>"],buttonReindent:["li","Click this to adjust the text so that blocks marked by { and } have their contents indented by 2 spaces"],buttonSyncDiagram:["li","Click to sync the diagram and the text"],ttGeneratedCodeType:["li","Choose the language or diagram to generate"],ttGenerateCode:["li","Click this button to generate the above code or diagram"],ttExecuteCode:["li","Click this button to execute the above code"],ttShowHideCanvas:["li","Show/Hide the diagram </br><b>Shortcut: [ctrl+d]</b>"],ttShowHideTextEditor:["li","Show/Hide the text editor </br><b>Shortcut: ["+toggleTextEditor+"]"],ttShowHideLayoutEditor:["li","Show/Hide the layout editor"],ttToggleAttributes:["li","Show/Hide attributes in class diagrams </br><b>Shortcut: [shift+ctrl+a]</b>"],ttToggleMethods:["li","Show/Hide methods in class diagrams </br><b>Shortcut: [ctrl+m]</b>"],ttToggleTraits:["li","Show/Hide traits; when selected any traits and their relationships are explicitly shown; when unselected, traits are merged into their client classes </br><b>Shortcut: [ctrl+r]</b>"],ttToggleActions:["li","Show/Hide actions in state diagrams (hide to simplify)"],ttToggleGuards:["li","Show/Hide guards in state diagrams (hide to simplify)"],ttToggleTransitionLabels:["li","Show/Hide transition labels in state diagrams (t1, t2 etc.) to allow reference"],ttToggleGuardLabels:["li","Show/Hide guard labels on the state diagrams (g1, g2 etc.) to allow reference"],SHT_button:["a","Show/Hide the text editor - <b>"+toggleTextEditor+"</b>"],SHD_button:["a","Show/hide diagram pane on right - <b> ctrl-D</b>"],SHA_button:["a","Show/hide attributes in class diagrams - <b>shift-ctrl-A</b>"],SHM_button:["a","Show/hide methods in class diagrams - <b>ctrl-M</b>"],filtervalues:["input","You can choose to display a subset of classes by naming them, separated by spaces.<br/><br/>You can use glob wildcards to specify patterns matching several classes.<br/><br/> So * matches any number of characters in a class name and ? matches any single character.<br/><br/> Preceding a pattern with a ~ indicates to skip classes matching the pattern.<br/><br/> Superclasses of any selected classes will always also appear (even if ~ is used)<br/><br/> The above is a shortcut for including a filter directive in the code.<br/><br/> using the notation filter {include Classpattern;}<br/><br/> Filters in the code will take precedence.<br/><br/> No class pattern starting with 'gv' can be used as these match the suboptions below.<br/><br/>You can also use an integer such as 1 or 2 to also add classees that are connected by an association 1 or 2 (or any number of ) hops away from selected classes.<br/><br/>You can also widen (or narrow) the spacing of nodes by using an expression like gvseparator=1.7 , where 1.0 is the default spacing."],buttonCopyMix:["li","Click on this to add Umple mixset code to the copy buffer that you can then paste into the code. The code will contain instructions to filter and lay out the code with the gv options and the filter text above. The mixset will have a randomly generated name which you should rename to something meaningful. Then you will see the mixset appear in the options above so you can switch it on and off as often as you like."],ttShowEditableClassDiagram:["li","Display a graphically editable class diagram </br><b>Shortcut: [ctrl+e]</b>"],ttShowJointJSClassDiagram:["li","Display a graphically editable class diagram displayed using joint.js </br><b>Shortcut: [ctrl+j]</b>"],ttShowGvClassDiagram:["li","Display a class diagram rendered using GraphViz </br><b>Shortcut: [ctrl+g]</b>"],ttShowGvStateDiagram:["li","Display a state diagram rendered using GraphViz</br><b>Shortcut: [ctrl+s]</b>"],ttShowStructureDiagram:["li","Display a graphically editable composite structure diagram </br><b>Shortcut: [ctrl+l]</b>"],ttShowGvFeatureDiagram:["li","Display a feature diagram rendered using GraphViz </br>"],ECD_button:["a","Class diagram where the user can Edit the layout - <b>ctrl-E</b>"],GCD_button:["a","Graphviz Class diagram, automatically laid out - editable using a contextual menu (double-click or right-click to display it) when pointing to a class, association or attribute - <b>ctrl-G</b>"],SD_button:["a","State diagram - editable using a contextual menu (double-click or right-click to display it) when pointing to  a state or transition  - <b>ctrl-S</b>"],GenJavaButton:["a","Generate Java from this Umple model ... To generate other outputs such as Python, C++, PhP, ER Diagrams and Formal Methods, use the Generate menu in Tools"],topBookmarkable:["a","Click to copy the URL and save it so you can come back to it later.<br/> <br/>You can do this just so you remember the location of your model.<br/><br/>The following describes BETA capabilities. Please report any issues: <br/><br/> You can also share the URL with other people to collaborate in real time on a model.<br/> <br/>When more than one person is working on a model, a collaborator who has stopped editing may time out after a while and would then have to reconnect. Before reconnecting the model would temporarily be read-only for them."],collabDisconnect:["a","You can disconnect from your collaboration session with this button."],ttSaveNCollab:["a","Click to save this model for ongoing editing.<br/><br/>After clicking this, you will need to use your browser's functionality to copy or bookmark the newly-created semi-permanent URL.<br/><br/>As you make further edits at the new URL, they will be instantly saved. You will be able to come back any time to continue editing.<br/><br/>The URL and its model will continue to be available for up to a year from the last time you edited it.<br/><br/>Do not use the new URL as a safe backup: If you (or anyone else who you give the URL) modifies or deletes the text, then your work would be lost. <br/><br/>The following describes BETA capabilities. Please report any issues:  <br/><br/>You can share the URL with others, or open multiple tabs with it by yourself. As you type, the text will change simultaneously in all open browsers or browser tabs."],ttPhotoReady:["li","Remove editing handles from diagram"],ttManualSync:["li","Stop the diagram from syncing automatically"],ttAllowPinch:["li","When active on GraphViz diagrams, this allows two-fingered gestures to zoom the diagram in or out to make it have any desired resolution and size (but prevents the entire browser from being zoomed in this manner)"],ttYumlImage:["li","Generate a class diagram using Yuml in another window"]},ToolTips.dropDownTooltips={exampleType:["li","Choose an example type to load"],itemLoadExamples:["li","Choose a class diagram example to load. * means executable, since it has a main program"],itemLoadExamples2:["li","Choose a state diagram example to load. * means executable, since it has a main program"],itemLoadExamples3:["li","Choose a composite structure diagram example to load"]},ToolTips.dynamicTooltips={ttgvortho:["li","Display class association lines with right-angle junctions rather than spline curves"],ttmixset:["li","Activate the code contained in this named mixset"],ttfilter:["li","Activate the named filter to show only the selected classes"],ttgvmanual:["li","Allow manual editing of Graphviz class diagram layout. You can drag items."],ttgvdot:["li","Lay out the class diagram in the default way, which tries to arrange classes in a hierarchical manner. If gvmanual is also active, this will become the default manual layout"],ttgvsfdp:["li","Lay out the class diagram using a force-directed algorithm. If gvmanual is also active, this will become the default manual layout"],ttgvcirco:["li","Lay out the class diagram using an algorithm that tries to arrange classes in circles. If gvmanual is also active, this will become the default manual layout"]},ToolTips.setATooltip=function(e,t,n,r){var o=document.querySelector(":root"),a=s=e[n];if(typeof a>"u"){console.log("Tooltip ID not defined: "+n);return}var s=a[1],c=Math.max(3.5,s.length/10)+"s";jQuery("#"+t).tooltip({items:a[0],content:s,show:{delay:1e3},open:function(d,u){o.style.setProperty("--tooltipDwellTime",c)},position:r})},ToolTips.setATooltipBasic=function(e,t,n){var r=t;t.substring(0,8)=="ttmixset"?r="ttmixset":t.substring(0,8)=="ttfilter"&&(r="ttfilter");var o;n=="above"?o={my:"center+15% bottom",at:"top",of:"#"+t}:n=="below"?o={my:"left top+10",of:"#"+t}:o={my:"right",at:"left",of:"#"+t},ToolTips.setATooltip(e,t,r,o)},ToolTips.initTooltips=function(){for(var e in this.tooltipEntries)e=="SD_button"||e=="GCD_button"||e=="ECD_button"||e=="SHT_button"||e=="SHD_button"||e=="SHA_button"||e=="SHM_button"||e=="GenJavaButton"||e=="ttSaveNCollab"||e=="collabDisconnect"||e=="topBookmarkable"?ToolTips.setATooltipBasic(this.tooltipEntries,e,"below"):ToolTips.setATooltipBasic(this.tooltipEntries,e,"left");for(e in this.dropDownTooltips)ToolTips.setATooltipBasic(this.dropDownTooltips,e,"above");jQuery(document).tooltip({show:{delay:1e3}})},UmpleTransitionFactory=new Object,UmpleTransitionFactory.create=function(e){var t=new UmpleTransition;return t.id=e.id,t.fromStateId=e.fromStateId,t.toStateId=e.toStateId,t.name=e.name,t.eventName=e.eventName,t};function UmpleTransition(){this.id=null,this.fromStatePosition=null,this.toStatePosition=null,this.fromStateId,this.toStateId,this.name="",this.eventName="",this.color="black",this.setStates=function(e,t){this.fromStateId=e,this.toStateId=t},this.setDefaultEvent=function(){this.eventName="event1"},this.setName=function(e){this.name=e},this.getName=function(){return this.name},this.getElementId=function(){return this.id==null?"newtransition":this.id},this.getState=function(e){return e==0?UmpleSystem.find(this.fromStateId):UmpleSystem.find(this.toStateId)}}const AiConfig={providers:{openai:{name:"OpenAI",baseURL:"https://api.openai.com/v1"},google:{name:"Google Gemini",baseURL:"https://generativelanguage.googleapis.com/v1beta/openai",defaultHeaders:{"x-stainless-arch":null,"x-stainless-lang":null,"x-stainless-os":null,"x-stainless-package-version":null,"x-stainless-retry-count":null,"x-stainless-runtime":null,"x-stainless-runtime-version":null,"x-stainless-timeout":null}},openrouter:{name:"OpenRouter",baseURL:"https://openrouter.ai/api/v1",defaultHeaders:{"HTTP-Referer":typeof window<"u"?window.location.origin:"","X-Title":"UmpleOnline"}}},defaults:{maxTokens:1e4},getProviderConfig(e){return this.providers[e]||null},getGenerationParams(e={}){return{maxTokens:e.maxTokens??this.defaults.maxTokens}}},AiErrors={types:{NETWORK_ERROR:"NETWORK_ERROR",CONFIGURATION_ERROR:"CONFIGURATION_ERROR",API_ERROR:"API_ERROR",VALIDATION_ERROR:"VALIDATION_ERROR",PROMPT_LOAD_ERROR:"PROMPT_LOAD_ERROR"},messages:{NO_PROVIDER:"Please select an AI provider",NO_API_KEY:"Please configure your AI API key",NO_MODEL:"Please select a model",PROVIDER_NOT_CONFIGURED:"Provider not configured",API_KEY_NOT_CONFIGURED:"API key not configured",MODEL_NOT_CONFIGURED:"Model not configured",NETWORK_ERROR:"Network error - please check your connection",PROVIDER_REQUIRED:"Provider is required",VERIFICATION_FAILED:"API key verification failed"},createError(e,t,n={}){const r=new Error(t);return r.type=e,r.details=n,r.isAiError=!0,r},extractErrorMessage(e,t="An error occurred"){return e?.error?typeof e.error=="object"?e.error.message||t:e.error:t},createConfigurationError(e){const t=this.messages[e]||e;return this.createError(this.types.CONFIGURATION_ERROR,t,{messageKey:e})},createNetworkError(e,t=null){return this.createError(this.types.NETWORK_ERROR,e,{originalError:t?.message})},createApiError(e,t,n="API request failed"){const r=this.extractErrorMessage(t,`${n}: ${e?.status||"unknown"}`);return this.createError(this.types.API_ERROR,r,{status:e?.status,errorData:t})},createValidationError(e){return this.createError(this.types.VALIDATION_ERROR,e)},createPromptLoadError(e,t){return this.createError(this.types.PROMPT_LOAD_ERROR,`Failed to load prompt (${t}): ${e}`,{url:e,status:t})},async fromResponse(e,t="API request failed"){const n=await e.json().catch(()=>({}));return this.createApiError(e,n,t)}},AiStorage={STORAGE_KEY_PROVIDER_DATA:"umpleAiProviderData",STORAGE_KEY_PROVIDER:"umpleAiProvider",_withStorage(e,t){try{return typeof Storage>"u"?null:e()}catch(n){return n.name==="QuotaExceededError"||n.name==="NS_ERROR_DOM_QUOTA_REACHED"?console.warn("localStorage quota exceeded:",t):n.name==="SecurityError"||n.code===18||console.error(t,n),null}},_sanitizeProviderDataMap(e){if(!e||typeof e!="object")return{};const t={};return Object.entries(e).forEach(([n,r])=>{if(!n||!r||typeof r!="object")return;const o={};if(r.apiKey&&(o.apiKey=String(r.apiKey).trim()),r.model&&(o.model=String(r.model).trim()),r.verified===!0&&(o.verified=!0),r.usage&&typeof r.usage=="object"){const a={},s=C=>{const A=Number(C);return Number.isFinite(A)?A:null},c=s(r.usage.requests),d=s(r.usage.inputTokens),u=s(r.usage.outputTokens),f=s(r.usage.totalTokens),v=s(r.usage.costUsd),h=r.usage.lastUsedAt?String(r.usage.lastUsedAt):"";c!=null&&(a.requests=Math.max(0,Math.floor(c))),d!=null&&(a.inputTokens=Math.max(0,Math.floor(d))),u!=null&&(a.outputTokens=Math.max(0,Math.floor(u))),f!=null&&(a.totalTokens=Math.max(0,Math.floor(f))),v!=null&&(a.costUsd=Math.max(0,v)),h&&(a.lastUsedAt=h),Object.keys(a).length>0&&(o.usage=a)}(o.apiKey||o.model||o.verified)&&(t[n]=o)}),t},_sanitizeUsageMap(e){if(!e||typeof e!="object")return{};const t={};return Object.entries(e).forEach(([n,r])=>{if(!n||!r||typeof r!="object")return;const o={},a=h=>{const C=Number(h);return Number.isFinite(C)?C:null},s=a(r.requests),c=a(r.inputTokens),d=a(r.outputTokens),u=a(r.totalTokens),f=a(r.costUsd),v=r.lastUsedAt?String(r.lastUsedAt):"";s!=null&&(o.requests=Math.max(0,Math.floor(s))),c!=null&&(o.inputTokens=Math.max(0,Math.floor(c))),d!=null&&(o.outputTokens=Math.max(0,Math.floor(d))),u!=null&&(o.totalTokens=Math.max(0,Math.floor(u))),f!=null&&(o.costUsd=Math.max(0,f)),v&&(o.lastUsedAt=v),Object.keys(o).length>0&&(t[n]=o)}),t},getProviderDataMap(){return this._withStorage(()=>{const e=localStorage.getItem(this.STORAGE_KEY_PROVIDER_DATA);if(e)try{return this._sanitizeProviderDataMap(JSON.parse(e))}catch{return{}}return{}},"Error retrieving provider data map:")??{}},saveProviderDataMap(e){return this._withStorage(()=>{const t=this._sanitizeProviderDataMap(e);return Object.keys(t).length>0?localStorage.setItem(this.STORAGE_KEY_PROVIDER_DATA,JSON.stringify(t)):localStorage.removeItem(this.STORAGE_KEY_PROVIDER_DATA),!0},"Error saving provider data map:")??!1},getUsage(e){return e?this.getProviderDataMap()[e]?.usage||{}:{}},getAllUsage(){const e=this.getProviderDataMap(),t={};return Object.entries(e).forEach(([n,r])=>{r.usage&&(t[n]=r.usage)}),t},recordUsage(e,t={}){if(!e)return!1;const n=t&&typeof t=="object"?t:{},r=C=>{const A=Number(C);return Number.isFinite(A)?A:null},o=this.getProviderDataMap(),a=o[e]||{},s=a.usage||{},c=r(n.requests),d=r(n.inputTokens),u=r(n.outputTokens);let f=r(n.totalTokens);const v=r(n.costUsd);f==null&&Number.isFinite(d)&&Number.isFinite(u)&&(f=d+u),s.requests=Math.max(0,Math.floor((s.requests||0)+(c??1))),d!=null&&(s.inputTokens=Math.max(0,Math.floor((s.inputTokens||0)+d))),u!=null&&(s.outputTokens=Math.max(0,Math.floor((s.outputTokens||0)+u))),f!=null&&(s.totalTokens=Math.max(0,Math.floor((s.totalTokens||0)+f))),v!=null&&(s.costUsd=Math.max(0,(s.costUsd||0)+v)),s.lastUsedAt=new Date().toISOString(),a.usage=s,o[e]=a;const h=this.saveProviderDataMap(o);return h&&typeof window<"u"&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("aiUsageUpdated",{detail:{provider:e}})),h},resetUsage(e=null){const t=this.getProviderDataMap();if(e){const n=t[e];return n&&(delete n.usage,t[e]=n),this.saveProviderDataMap(t)}return Object.keys(t).forEach(n=>{t[n]&&delete t[n].usage}),this.saveProviderDataMap(t)},saveApiKey(e,t){if(!e)throw AiErrors.createValidationError("Provider is required to save API key");const n=t?.trim(),r=this.getProviderDataMap(),o=r[e]||{};return n?o.apiKey=n:delete o.apiKey,r[e]=o,this.saveProviderDataMap(r)},getApiKey(e){return e&&this.getProviderDataMap()[e]?.apiKey||""},saveProvider(e){return this._withStorage(()=>(e?localStorage.setItem(this.STORAGE_KEY_PROVIDER,e):localStorage.removeItem(this.STORAGE_KEY_PROVIDER),!0),"Error saving provider:")??!1},getProvider(){return this._withStorage(()=>localStorage.getItem(this.STORAGE_KEY_PROVIDER)||"","Error retrieving provider:")??""},saveModel(e,t=null){const n=t||this.getProvider();if(!n)throw AiErrors.createValidationError("Provider is required to save model");const r=e?.trim();return this._withStorage(()=>{const o=this.getProviderDataMap(),a=o[n]||{};return r?a.model=r:delete a.model,o[n]=a,this.saveProviderDataMap(o)},"Error saving model:")??!1},getModel(e=null){const t=e||this.getProvider();return t?this._withStorage(()=>this.getProviderDataMap()[t]?.model||"","Error retrieving model:")??"":""},isVerified(e=null){const t=e||this.getProvider();return t?this._withStorage(()=>this.getProviderDataMap()[t]?.verified===!0,"Error checking verification status:")??!1:!1},setVerified(e,t=null){const n=t||this.getProvider();return n?this._withStorage(()=>{const r=this.getProviderDataMap(),o=r[n]||{};return e?o.verified=!0:delete o.verified,r[n]=o,this.saveProviderDataMap(r)},"Error setting verification status:")??!1:!1}},FinishReason={STOP:"stop",LENGTH:"length",TOOL_CALLS:"tool_calls",CONTENT_FILTER:"content_filter",FUNCTION_CALL:"function_call"},AiConstants={FinishReason};window.AiConstants=AiConstants;const AiPromptUtils=(()=>{"use strict";function e(o){return String(o||"").trim().toLowerCase().replace(/[^a-z0-9_-]+/g,"_").replace(/^_+/,"").replace(/_+$/,"")||"section"}function t(o){return o==null?"":Array.isArray(o)?o.filter(Boolean).map(String).join(`
`):String(o)}function n(o,a,{trimContent:s=!0,allowEmpty:c=!1}={}){const d=e(o);let u=t(a);return s&&(u=u.trim()),!c&&!u?"":`<${d}>
${u}
</${d}>`}function r(o,{separator:a=`

`}={}){return(o||[]).filter(Boolean).join(a)}return{normalizeTagName:e,block:n,joinBlocks:r}})();var _aiGlobal=typeof window<"u"?window:globalThis,AiProviderUtils=_aiGlobal.AiProviderUtils||{_compareIntArrays(e,t){const n=Array.isArray(e)?e:[],r=Array.isArray(t)?t:[],o=Math.max(n.length,r.length);for(let a=0;a<o;a++){const s=n[a]??0,c=r[a]??0;if(s!==c)return s-c}return 0},_parseDotVersionAfterPrefix(e,t){const n=String(e||"").toLowerCase();if(!n.startsWith(t))return null;const o=n.slice(t.length).match(/^(\d+(?:\.\d+){0,3})/);return o?o[1].split(".").map(a=>Number.parseInt(a,10)):null},_parseGptCodexVersion(e){const n=String(e||"").toLowerCase().match(/^gpt-([\d.]+)-codex$/);return n?n[1].split(".").map(o=>Number.parseInt(o,10)):null},extractModelProvider(e){if(!e||typeof e!="string")return"unknown";const t=e.split("/");return t.length<2?"unknown":t[0].toLowerCase()},_pickLatestModelId(e,t=null){const n=(e||[]).filter(Boolean);if(n.length===0)return null;const r=n.find(s=>String(s).toLowerCase().endsWith("-latest"));if(r)return r;if(typeof t=="function"){let s=null,c=null;if(n.forEach(d=>{const u=t(d);u&&(!s||this._compareIntArrays(u,c)>0)&&(s=d,c=u)}),s)return s}let o=n[0],a=null;return n.forEach(s=>{const c=String(s).match(/(\d{8})/),d=c?Number.parseInt(c[1],10):null;d&&(!a||d>a)&&(a=d,o=s)}),o},filterModelsForProvider(e,t){if(!Array.isArray(t)||t.length===0)return t;const n=t.map(o=>o.value).filter(Boolean),r=o=>{const a=new Set((o||[]).filter(Boolean)),s=t.filter(c=>a.has(c.value));return s.length>0?s:t};switch(e){case"openai":{const o=n.filter(C=>/^gpt-\d+(?:\.\d+){0,3}$/i.test(C)),a=n.filter(C=>/^gpt-\d+(?:\.\d+){0,3}-mini$/i.test(C)),s=n.filter(C=>/^gpt-\d+(?:\.\d+){0,3}-nano$/i.test(C)),c=n.filter(C=>/^gpt-[\d.]+-codex(?!-mini|-nano|-lite)$/i.test(C)),d=C=>this._parseDotVersionAfterPrefix(C,"gpt-"),u=this._pickLatestModelId(o,d),f=this._pickLatestModelId(a,d),v=this._pickLatestModelId(s,d),h=this._pickLatestModelId(c,C=>this._parseGptCodexVersion(C));return r([u,f,v,h])}case"google":{const o=n.filter(u=>/(^|-)flash($|-)/i.test(u)&&!/(^|-)flash-lite($|-)/i.test(u)),a=n.filter(u=>/(^|-)pro($|-)/i.test(u)),s=u=>this._parseDotVersionAfterPrefix(u,"gemini-"),c=this._pickLatestModelId(o,s),d=this._pickLatestModelId(a,s);return r([c,d])}case"openrouter":return t;default:return t}},contentToText(e){if(e==null)return"";if(typeof e=="string")return e;if(Array.isArray(e))return e.map(t=>typeof t=="string"?t:!t||typeof t!="object"?"":typeof t.text=="string"?t.text:t.text&&typeof t.text=="object"&&typeof t.text.value=="string"?t.text.value:"").join("");if(typeof e=="object"){if(typeof e.text=="string")return e.text;if(e.text&&typeof e.text=="object"&&typeof e.text.value=="string")return e.text.value}return String(e)},usesMaxCompletionTokens(e){if(!e)return!1;const t=String(e).toLowerCase();return/gpt-?5/.test(t)||/\bo[13](-|$)/.test(t)||t.includes("/o1")||t.includes("/o3")||t.includes("/gpt-5")||t.includes("/gpt5")},groupModelsByProvider(e){const t={};return e.forEach(n=>{const r=n.modelProvider||"unknown";t[r]||(t[r]=[]),t[r].push(n)}),t},normalizeUsage(e,t=null){const n=c=>{const d=Number(c);return Number.isFinite(d)?d:null},r=n(e?.prompt_tokens??e?.input_tokens),o=n(e?.completion_tokens??e?.output_tokens);let a=n(e?.total_tokens);a==null&&Number.isFinite(r)&&Number.isFinite(o)&&(a=r+o);const s=n(e?.cost??t?.cost??t?.usage?.cost);return{inputTokens:r,outputTokens:o,totalTokens:a,costUsd:s}}};_aiGlobal.AiProviderUtils=AiProviderUtils;const AiTextUtils={normalizeNewlines(e){return String(e||"").replace(/\r\n/g,`
`)},stripHtmlToText(e){const t=String(e||"").replace(/<script[\s\S]*?<\/script>/gi,"").replace(/<style[\s\S]*?<\/style>/gi,""),n=document.createElement("div");return n.innerHTML=t,(n.textContent||n.innerText||"").trim()},computeLineNumberAtIndex(e,t){const n=Math.max(0,Math.min(Number(t)||0,String(e||"").length));return this.normalizeNewlines(String(e||"").slice(0,n)).split(`
`).length-1},computePrefix(e,t){const r=(this.normalizeNewlines(e.slice(0,t)).match(/\n*$/)||[""])[0].length,o=Math.max(2-r,0);return`
`.repeat(o)},computeSuffix(e,t){const r=(this.normalizeNewlines(e.slice(t)).match(/^\n*/)||[""])[0].length,o=Math.max(2-r,0);return`
`.repeat(o)},escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML},truncate(e,t,n="..."){const r=String(e||"");return r.length<=t?r:r.slice(0,t-n.length)+n},getLinesAround(e,t,n=2){const o=this.normalizeNewlines(String(e||"")).split(`
`),a=Math.max(0,Math.min(Number(t)||0,o.length-1)),s=Math.max(0,a-n),c=Math.min(o.length-1,a+n),d=[];for(let u=s;u<=c;u++){const f=o[u]||"",v=this.truncate(f,80,"...");d.push(`${u+1}: ${v}`)}return d.join(`
`)},extractUmpleCode(e){const t=String(e||""),n=t.match(/```(?:umple)?\s*([\s\S]*?)```/);if(n)return n[1].trim();const r=t.match(/(?:class|interface|trait|association)\s+\w+/);if(r){const o=t.indexOf(r[0]);return t.substring(o).trim()}return t.trim()},parseCodeBlocks(e){const t=String(e||""),n=[],r=/```(\w+)?\s*([\s\S]*?)```/g;let o;for(;(o=r.exec(t))!==null;)n.push({language:(o[1]||"").trim().toLowerCase(),code:o[2].trim()});return n}},AiProviderAdapters={_clients:new Map,_getClient(e,t){const n=AiConfig.getProviderConfig(e);if(!n)throw AiErrors.createConfigurationError("PROVIDER_NOT_CONFIGURED");const r=`${e}:${t}`;if(!this._clients.has(r)){const o={apiKey:t,baseURL:n.baseURL,dangerouslyAllowBrowser:!0};n.defaultHeaders&&(o.defaultHeaders=n.defaultHeaders),this._clients.set(r,new OpenAI(o))}return this._clients.get(r)},async _retryIfEmptyReasoningOnly(e,t,n,r){const o=n?.choices?.[0]?.message?.content,a=n?.choices?.[0]?.finish_reason,s=n?.usage?.completion_tokens,c=n?.usage?.completion_tokens_details?.reasoning_tokens;if(!((o===""||o==null)&&a===AiConstants.FinishReason.LENGTH&&Number.isFinite(s)&&Number.isFinite(c)&&s>0&&c>=s))return n;const u={...t},f=AiProviderUtils.usesMaxCompletionTokens(r),v=Number(f?t.max_completion_tokens:t.max_tokens)||0,h=v>0?v*2:16e3;return f?u.max_completion_tokens=h:u.max_tokens=h,e.chat.completions.create(u)},_recordUsage(e,t,n=null){const r=AiProviderUtils.normalizeUsage(t,n);AiStorage.recordUsage(e,{requests:1,inputTokens:r.inputTokens,outputTokens:r.outputTokens,totalTokens:r.totalTokens,costUsd:r.costUsd})},clearClient(e,t){const n=`${e}:${t}`;this._clients.delete(n)},getEndpoint(e){return AiConfig.getProviderConfig(e)},async verifyKey(e,t){if(!e)return{valid:!1,error:"Provider not selected"};if(!t)return{valid:!1,error:"API key not provided"};try{const n=this._getClient(e,t);if(e==="openrouter"){const r=await fetch("https://openrouter.ai/api/v1/key",{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(!r.ok){const o=await r.json().catch(()=>({}));return{valid:!1,error:AiErrors.extractErrorMessage(o,`Verification failed: ${r.status}`)}}return{valid:!0}}return await n.models.list(),{valid:!0}}catch(n){return console.error("Error verifying API key:",n),{valid:!1,error:n.message||"Verification failed"}}},async fetchModels(e,t){if(!t)throw AiErrors.createConfigurationError("NO_API_KEY");const n=this._getClient(e,t);let r;return e==="openrouter"?r=await n.models.list({category:"programming"}):r=await n.models.list(),{ok:!0,json:()=>Promise.resolve({data:r.data})}},parseModelsResponse(e,t){const n=[];return(t.data||[]).forEach(o=>{if(o.id){const a={value:o.id,label:o.id};e==="openrouter"&&(a.modelProvider=AiProviderUtils.extractModelProvider(o.id)),o.pricing&&(a.pricing={input:o.pricing.prompt*1e6,output:o.pricing.completion*1e6}),n.push(a)}}),AiProviderUtils.filterModelsForProvider(e,n)},async chat(e,t,n,r,o="",a={}){const s=this._getClient(e,t),c=AiConfig.getGenerationParams(a),d=[];o&&d.push({role:"system",content:o}),d.push({role:"user",content:r});const u={model:n,messages:d};AiProviderUtils.usesMaxCompletionTokens(n)?u.max_completion_tokens=c.maxTokens:u.max_tokens=c.maxTokens;let f=await s.chat.completions.create(u);this._recordUsage(e,f?.usage,f);const v=await this._retryIfEmptyReasoningOnly(s,u,f,n);v!==f?(f=v,this._recordUsage(e,f?.usage,f)):f=v;const h=f.choices?.[0]?.message?.content;return AiProviderUtils.contentToText(h)},chatStream(e,t,n,r,o="",a={},s={}){const c=new AbortController,d=this._getClient(e,t),u=AiConfig.getGenerationParams(a),f=s?.onDelta,v=s?.onTruncated,h=(async()=>{const C=[];o&&C.push({role:"system",content:o}),C.push({role:"user",content:r});const A={model:n,messages:C,stream:!0,stream_options:{include_usage:!0}};AiProviderUtils.usesMaxCompletionTokens(n)?A.max_completion_tokens=u.maxTokens:A.max_tokens=u.maxTokens;const T=await d.chat.completions.create(A,{signal:c.signal});let j="",N=null,p=null;for await(const b of T){if(c.signal.aborted)break;const _=b.choices?.[0];_?.finish_reason&&(N=_.finish_reason);const P=_?.delta?.content??"",S=AiProviderUtils.contentToText(P);S&&(j+=S,f?.(S)),b?.usage&&(p=b.usage)}return!c.signal.aborted&&N===AiConstants.FinishReason.LENGTH&&v?.(),c.signal.aborted||(p?this._recordUsage(e,p,null):AiStorage.recordUsage(e,{requests:1})),j})();return{abort:()=>c.abort(),done:h}}},AiApi={STORAGE_KEY_PROVIDER_DATA:AiStorage.STORAGE_KEY_PROVIDER_DATA,STORAGE_KEY_PROVIDER:AiStorage.STORAGE_KEY_PROVIDER,saveApiKey(e,t){return AiStorage.saveApiKey(e,t)},getApiKey(e=null){const t=e||this.getProvider();return t?AiStorage.getApiKey(t):""},saveProvider(e){return AiStorage.saveProvider(e)},getProvider(){return AiStorage.getProvider()},saveModel(e,t=null){return AiStorage.saveModel(e,t)},getModel(e=!1,t=null){const n=t||this.getProvider();return n?AiStorage.getModel(n):""},isVerified(e=null){return AiStorage.isVerified(e)},setVerified(e,t=null){return AiStorage.setVerified(e,t)},async verifyKey(e,t){return AiProviderAdapters.verifyKey(e,t)},async fetchModels(e,t){return AiProviderAdapters.fetchModels(e,t)},parseModelsResponse(e,t){return AiProviderAdapters.parseModelsResponse(e,t)},async chat(e,t="",n={}){const r=this.getProvider(),o=this.getApiKey(r),a=this.getModel();if(!r)throw AiErrors.createConfigurationError("PROVIDER_NOT_CONFIGURED");if(!o)throw AiErrors.createConfigurationError("API_KEY_NOT_CONFIGURED");if(!a)throw AiErrors.createConfigurationError("MODEL_NOT_CONFIGURED");return AiProviderAdapters.chat(r,o,a,e,t,n)},chatStream(e,t="",n={},r={}){const o=this.getProvider(),a=this.getApiKey(o),s=this.getModel();if(!o)throw AiErrors.createConfigurationError("PROVIDER_NOT_CONFIGURED");if(!a)throw AiErrors.createConfigurationError("API_KEY_NOT_CONFIGURED");if(!s)throw AiErrors.createConfigurationError("MODEL_NOT_CONFIGURED");return AiProviderAdapters.chatStream(o,a,s,e,t,n,r)}},AiConfigValidation={checkApiConfig(e={}){const{requireVerified:t=!0}=e,n=AiApi.getProvider();return n?AiApi.getApiKey(n)?AiApi.getModel()?t&&!AiStorage.isVerified(n)?{configured:!1,message:"Please verify your API key first."}:{configured:!0}:{configured:!1,message:"Please verify your API key and select a model in the AI section."}:{configured:!1,message:"Please configure your AI API key in the AI section first."}:{configured:!1,message:"Please select an AI provider in the AI section first."}},checkProvider(){const e=AiApi.getProvider();return e?{ready:!0,provider:e}:{ready:!1,message:"Please select an AI provider."}},checkApiKey(){const e=this.checkProvider();if(!e.ready)return e;const t=e.provider,n=AiApi.getApiKey(t);return n?{ready:!0,apiKey:n}:{ready:!1,message:"Please configure your API key."}},checkModel(){const e=this.checkApiKey();if(!e.ready)return e;const t=AiApi.getModel();return t?{ready:!0,model:t}:{ready:!1,message:"Please select a model."}}},AiCompilerService={getCompilerLanguage(){return"Json"},getSelfCorrectionMaxPasses(){return 10},parseCompilerIssuesFromErrorHtml(e){const t=String(e||"");if(!t.trim())return[];const n=[];try{const s=document.createElement("div");s.innerHTML=t;const c=s.querySelector("#errorRow");if(c){const d=Array.from(c.querySelectorAll("font")),u=f=>{let v=f.nextSibling;for(;v;){if(v.nodeType===1){const h=v.tagName.toLowerCase();if(h==="i"){const C=v.querySelector("a");if(C)return C}if(h==="font")break}v=v.nextSibling}return null};if(d.forEach(f=>{const v=String(f.textContent||"").replace(/\s+/g," ").trim(),h=v.startsWith("Warning")?"Warning":v.startsWith("Error")?"Error":"Unknown",C=f.querySelector("a"),T=String(C?.textContent||"").match(/(\d+)/),j=T?parseInt(T[1],10):null;let N=v;const p=N.indexOf(":");p>=0&&(N=N.slice(p+1).trim()),N=N.replace(/\.$/,"").trim();const b=u(f),L=String(b?.textContent||"").match(/\(([^)]+)\)/),P=L?L[1].trim():"";(h!=="Unknown"||N)&&n.push({severity:h,line:j,message:N,errorCode:P})}),n.length>0)return n}}catch(s){typeof console<"u"&&console.warn&&console.warn("AiCompilerService: HTML parsing failed, falling back to text parsing",s?.message||s)}const r=AiTextUtils.stripHtmlToText(t),o=/\b(Error|Warning)\s+on\s+line\s+(\d+)\s*:\s*([\s\S]*?)\.(?:\s*More information\s*\(([^)]+)\))?/g;let a;for(;(a=o.exec(r))!==null;)n.push({severity:a[1],line:parseInt(a[2],10),message:(a[3]||"").trim(),errorCode:(a[4]||"").trim()});return n.length===0&&/\b(Error|Warning)\b/i.test(r)&&n.push({severity:"Unknown",line:null,message:r,errorCode:""}),n},getIssueKey(e){const t=(e?.severity||"").trim(),n=(e?.errorCode||"").trim(),r=(e?.message||"").trim();return`${t}|${n}|${r}`},formatIssuesForLog(e){return(e||[]).map(t=>{const n=t.errorCode?` (${t.errorCode})`:"",r=Number.isFinite(t.line)?t.line:"?";return`- ${t.severity} on line ${r}${n}: ${t.message}`}).join(`
`)},formatIssuesForPrompt(e){return(e||[]).map(t=>{const n=t.errorCode?` (${t.errorCode})`:"",r=Number.isFinite(t.line)?t.line:"?";return`- ${t.severity}${n} on line ${r}: ${t.message}`}).join(`
`)},async compileUmpleWithServer(e){const t=this.getCompilerLanguage(),n=typeof Page<"u"&&Page.getFilename&&Page.getFilename()||"",r=typeof Action<"u"&&Action.getThemePreference?Action.getThemePreference():"system",o=[`language=${encodeURIComponent(t)}`,"error=true",`umpleCode=${encodeURIComponent(String(e||""))}`,`filename=${encodeURIComponent(n)}`,`theme=${encodeURIComponent(r)}`].join("&");return new Promise((a,s)=>{if(typeof Ajax>"u"||!Ajax.sendRequest){s(new Error("Ajax subsystem not available"));return}Ajax.sendRequest("scripts/compiler.php",c=>{try{const d=String(c?.responseText||""),u=d.indexOf("URL_SPLIT"),f=(u>=0?d.slice(0,u):d).trim(),v=this.parseCompilerIssuesFromErrorHtml(f);a({errorHtml:f,issues:v})}catch(d){s(d)}},o)})}},AiPrompting=(()=>{"use strict";const e=`You are an expert in Umple (https://cruise.umple.org/umple/): its textual modeling syntax for classes, associations, and state machines.

Rules:
- Do not invent Umple syntax or project context.
- If something is ambiguous, choose the simplest valid Umple and note assumptions inside Umple comments.
- Follow the output contract exactly.
- When the user prompt includes tagged sections like <tag> ... </tag>, read each section only from its opening tag to its matching closing tag and do not merge content across blocks.
- Never name attributes identical to the class name.`,t='Umple quick reference (non-exhaustive):\n\n- Classes: `class Name { Type a; Type a = default; method(p){ ... } isA Super, I, Trait; }`\n- Interfaces/Traits: `interface I { Type m(p); }`  `trait T { ... }`  `class C { isA I, T; }`\n- Enums: `enum E { A, B }`\n- Associations: `1 -- * Other;`  `* role -- 0..1 Other otherRole;`  `1 -> * Other;`  `association { 1 A -> * B; }`\n- Multiplicity: `1`  `0..1`  `*`  `1..*`  `m..n`\n- Constraints: `[booleanExpr]` on model/attr/assoc/transition\n- State machines: `sm { S1 { e -> S2; } }`  `state { initial { -> S1; } S1 { e -> S2; } }`  `status { S1 { e(p) [g] / { a; } -> S2; } }`\n- State actions: `entry / { ... }`  `exit / { ... }`  `do { ... }`\n- Auto-transition: `S { -> Next; }`\n- Timed transitions: `after(msExpr) -> Next;`  `afterEvery(msExpr) -> State;`\n- Orthogonal regions: `Composite { R1 { ... } || R2 { ... } }`\n- Reusable SM: `statemachine SM { ... }`  `class C { st as SM; }`\n- Requirements: `req R1 { text }`  `implementsReq R1, R2;`\n- Composition/features: `use "file.ump";`  `use Mixset;`  `use !Mixset;`  `require MixsetA;`  `generate Target;`\n',n=Object.create(null),r=Object.create(null);function o(d){const f=String(d||"").replace(/^\uFEFF/,"").split(/\r?\n/);for(;f.length>0&&!f[f.length-1].trim();)f.pop();for(;f.length>0&&/^```+\s*$/.test(f[f.length-1].trim());)f.pop();return f.join(`
`).trim()}function a(d){const u=String(d||"").trim();return u?typeof fetch=="function"?fetch(u).then(f=>{if(!f.ok)throw AiErrors.createPromptLoadError(u,f.status);return f.text()}).then(o):new Promise((f,v)=>{try{const h=new XMLHttpRequest;h.open("GET",u,!0),h.onreadystatechange=()=>{h.readyState===4&&(h.status>=200&&h.status<300?f(o(h.responseText)):v(AiErrors.createPromptLoadError(u,h.status)))},h.send(null)}catch(h){v(h)}}):Promise.reject(new Error("Prompt URL is empty"))}function s(d){const u=String(d||"").trim();return u?n[u]?Promise.resolve(n[u]):(r[u]||(r[u]=a(u).then(f=>(n[u]=f,delete r[u],f)).catch(f=>{throw delete r[u],f})),r[u]):Promise.reject(new Error("Prompt URL is empty"))}function c(d){return!d||d.length===0?"":d.map(u=>`${u&&u.title?`Example: ${u.title}`:"Example:"}

\`\`\`umple
${u&&u.code?u.code:""}
\`\`\``).join(`

`)}return{getBaseSystemPrompt(){return e},getUmpleCheatSheet(){return t},formatFewShotExamples(d){return c(d)},getPromptText(d){return s(d)}}})(),AiSettingsView={elements:{},modelRestoreInProgress:!1,_getElement(e,t){return this.elements[t]||(this.elements[t]=document.getElementById(e)),this.elements[t]},getElement(e,t){return this._getElement(e,t)},initElements(){return this._getElement("selectAiProvider","providerSelect"),this._getElement("aiProviderLink","providerLink"),this._getElement("selectAiModel","modelSelect"),this._getElement("inputAiApiKey","inputField"),this._getElement("apiKeyStatus","statusDiv"),this._getElement("aiUsageSummary","usageSummary"),this._getElement("buttonResetAiUsage","resetUsageButton"),this.elements},setStatusMessage(e,t=""){const n=this._getElement("apiKeyStatus","statusDiv");if(!n)return;const r=(e??"").toString();if(n.textContent=r,n.className="ai-key-status-message",!r){n.classList.add("is-hidden");return}t&&n.classList.add(`ai-status-message--${t}`)},clearStatus(){const e=this._getElement("apiKeyStatus","statusDiv");e&&(e.textContent="",e.className="ai-key-status-message is-hidden")},showModelSelection(){const e=document.getElementById("ttAiModel");e&&e.classList.remove("is-hidden")},hideModelSelection(){const e=document.getElementById("ttAiModel");e&&e.classList.add("is-hidden")},updateStatusIndicator(e){const t=document.getElementById("aiStatusIndicator"),n=document.getElementById("aiStatusText");if(!t||!n)return;const{provider:r,apiKey:o,model:a,verified:s}=e;r&&o&&a&&s?(t.className="ai-status-indicator ready",t.title=`AI Ready - ${r} - ${a}`,n.textContent=a,n.title=`${r} - ${a}`):r&&o&&s?(t.className="ai-status-indicator ready",t.title="AI configured (select model)",n.textContent="Select model",n.title=r):r&&o?(t.className="ai-status-indicator not-ready",t.title="API key not verified",n.textContent="Verify key",n.title=""):(t.className="ai-status-indicator not-ready",t.title="AI not configured",n.textContent="Not configured",n.title="")},showSettingsModal(){const e=document.getElementById("aiSettingsModal");e&&e.classList.remove("is-hidden")},hideSettingsModal(){const e=document.getElementById("aiSettingsModal");e&&e.classList.add("is-hidden")},setModelsLoading(){const e=this._getElement("selectAiModel","modelSelect");e&&(e.innerHTML='<option value="">Loading models...</option>',e.disabled=!0)},setModelsError(e){const t=this._getElement("selectAiModel","modelSelect");t&&(t.innerHTML=`<option value="">${e}</option>`,t.disabled=!1)},setModelsOptions(e){const t=this._getElement("selectAiModel","modelSelect");if(!t)return;if(e.length===0){t.innerHTML='<option value="">No models available</option>',t.disabled=!1,this.updateModelCostDisplay(null);return}this._modelsData=new Map(e.map(o=>[o.value,o]));const n=e.some(o=>o.modelProvider),r=o=>{if(!o.pricing)return!1;const a=o.pricing.input,s=o.pricing.output;return a===0&&s===0};if(n){const o=e.filter(u=>r(u)),a=e.filter(u=>!r(u));o.sort((u,f)=>u.label.localeCompare(f.label));const s=AiProviderUtils.groupModelsByProvider(a);Object.keys(s).forEach(u=>{s[u].sort((f,v)=>f.label.localeCompare(v.label))});const c=Object.keys(s).sort((u,f)=>u==="unknown"?1:f==="unknown"?-1:u.localeCompare(f));let d="";o.length>0&&(d+=`<optgroup label="\u{1F193} Free Models (${o.length})">`,o.forEach(u=>{d+=`<option value="${u.value}">${u.label}</option>`}),d+="</optgroup>"),c.forEach(u=>{const f=s[u],v=f.length;d+=`<optgroup label="${u} (${v})">`,f.forEach(h=>{d+=`<option value="${h.value}">${h.label}</option>`}),d+="</optgroup>"}),t.innerHTML=d}else{const o=e.filter(c=>r(c)),a=e.filter(c=>!r(c));o.sort((c,d)=>c.label.localeCompare(d.label)),a.sort((c,d)=>c.label.localeCompare(d.label));const s=[...o,...a];t.innerHTML=s.map(c=>{const u=r(c)?`\u{1F193} ${c.label}`:c.label;return`<option value="${c.value}">${u}</option>`}).join("")}t.disabled=!1,this._modelChangeListener||(this._modelChangeListener=!0,t.addEventListener("change",()=>this._onModelChange())),this._onModelChange()},updateModelCostDisplay(e){let t=document.getElementById("aiModelCostDisplay");if(!e){t&&t.remove();return}const r=this._modelsData?.get(e)?.pricing;let o="\u2014",a="\u2014";r&&(o=this._formatPricing(r.input),a=this._formatPricing(r.output));const s=`<div id="aiModelCostDisplay" class="ai-model-cost">$${o}/M input tokens $${a}/M output tokens</div>`;if(t)t.outerHTML=s;else{const c=document.getElementById("ttAiModel");c&&c.insertAdjacentHTML("beforeend",s)}},_formatPricing(e){return Number.isFinite(e)?e.toFixed(2):"\u2014"},_onModelChange(){const e=this._getElement("selectAiModel","modelSelect");e&&this.updateModelCostDisplay(e.value)},restoreSavedModel(e,t,n=0){const r=this._getElement("selectAiModel","modelSelect");if(!r||this.modelRestoreInProgress)return;if(!(r.options.length>0&&r.options[0].value!==""&&!r.options[0].text.includes("Loading")&&!r.options[0].text.includes("Error")&&!r.options[0].text.includes("No models"))){this.modelRestoreInProgress=!0,n<10?setTimeout(()=>{this.modelRestoreInProgress=!1,this.restoreSavedModel(e,t,n+1)},200):this.modelRestoreInProgress=!1;return}const a=e(!1);if(a){if(Array.from(r.options).some(d=>d.value===a)){r.value=a;return}console.warn(`Saved model "${a}" not found in available models`)}const s=r.value||r.options[0]?.value||"";s&&(r.value=s,t(s))},toggleApiKeyVisibility(){const e=this._getElement("inputAiApiKey","inputField"),t=document.getElementById("toggleApiKeyVisibility");if(!e)return;const n=e.type==="password";e.type=n?"text":"password",t&&t.classList.toggle("visible",n)},setProviderValue(e){const t=this._getElement("selectAiProvider","providerSelect");t&&(t.value=e)},setApiKeyValue(e){const t=this._getElement("inputAiApiKey","inputField");t&&(t.value=e)},_formatNumber(e){return Number.isFinite(e)?Math.round(e).toLocaleString():"\u2014"},_formatTokens(e){if(!Number.isFinite(e))return"\u2014";const t=e/1e3;return t<1?`${Math.round(e)} tokens`:t<1e3?`${t.toFixed(1)}K`:`${(t/1e3).toFixed(2)}M`},_formatCost(e){return Number.isFinite(e)?`$${e.toFixed(4)}`:"\u2014"},_getProviderLabel(e){return(typeof AiConfig<"u"?AiConfig.getProviderConfig(e):null)?.name||e},_getProviderLinkInfo(e){const t="Get API Key";return{openai:{label:t,url:"https://platform.openai.com/"},google:{label:t,url:"https://aistudio.google.com/apikey"},openrouter:{label:t,url:"https://openrouter.ai/"}}[e]||null},updateProviderLink(e){const t=this._getElement("aiProviderLink","providerLink");if(!t)return;const n=this._getProviderLinkInfo(e);if(!n){t.classList.add("is-hidden"),t.removeAttribute("href"),t.textContent="",t.setAttribute("tabindex","-1"),t.removeAttribute("title");return}t.textContent=n.label,t.href=n.url,t.title=n.url,t.classList.remove("is-hidden"),t.setAttribute("tabindex","0")},renderUsage(e,t){const n=this._getElement("aiUsageSummary","usageSummary"),r=this._getElement("buttonResetAiUsage","resetUsageButton");if(!n)return;const o=n.closest(".ai-usage-section");if(!t){o&&o.classList.add("is-hidden"),n.innerHTML="",r&&r.classList.add("is-hidden");return}const a=e?.[t]||{},s=Number.isFinite(a.requests)||Number.isFinite(a.totalTokens);if(!Number.isFinite(a.costUsd)){o&&o.classList.add("is-hidden"),n.innerHTML="",r&&r.classList.add("is-hidden");return}if(!s){o&&o.classList.add("is-hidden"),n.innerHTML="",r&&r.classList.add("is-hidden");return}o&&o.classList.remove("is-hidden");const d=this._formatTokens(a.totalTokens),u=this._formatTokens(a.inputTokens),f=this._formatTokens(a.outputTokens),v=this._formatNumber(a.requests),h=this._formatCost(a.costUsd);n.innerHTML=`
      <div class="ai-usage-primary">
        ${d} \xB7 ${v} req \xB7 ${h}
      </div>
      <div class="ai-usage-secondary">
        \u21B3 In: ${u} / Out: ${f}
      </div>
    `}},AiSettings={elements:{},_initialized:!1,_usageListenerBound:!1,_bindOnce(e,t,n,r){e&&(e.dataset[t]||(e.dataset[t]="1",e.addEventListener(n,r)))},checkApiConfig(){return AiConfigValidation.checkApiConfig({requireVerified:!0})},init(){this.elements=AiSettingsView.initElements(),this._initialized||(this._initialized=!0,this.loadPreferences());const e=document.getElementById("buttonAiSettings");if(e){const u=f=>{f.preventDefault(),this.showSettingsModal()};this._bindOnce(e,"aiBoundOpenSettings","click",u),this._bindOnce(e,"aiBoundOpenSettingsKeypress","keypress",f=>{(f.key==="Enter"||f.key===" ")&&u(f)})}const t=document.getElementById("btnCloseAiSettings");if(t){const u=f=>{f.preventDefault(),this.hideSettingsModal()};this._bindOnce(t,"aiBoundCloseSettings","click",u),this._bindOnce(t,"aiBoundCloseSettingsKeypress","keypress",f=>{(f.key==="Enter"||f.key===" ")&&u(f)})}const n=document.getElementById("aiSettingsModal");if(n){const u=n.querySelector(".dialog-overlay");u&&this._bindOnce(u,"aiBoundOverlayClose","click",()=>this.hideSettingsModal())}const r=this.elements.providerSelect;r&&this._bindOnce(r,"aiBoundProviderChange","change",()=>{const u=r.value,f=this.elements.inputField;AiApi.saveProvider(u),this.clearStatus(),AiSettingsView.updateProviderLink(u);const v=AiApi.getApiKey(u);if(f&&(f.value=v,v?(f.placeholder="",f.classList.remove("api-key-empty-hint")):(f.placeholder="Enter your API key",f.classList.add("api-key-empty-hint"))),v&&AiApi.isVerified(u)){this.loadModels(u,v,h=>{h?AiSettingsView.showModelSelection():(AiSettingsView.hideModelSelection(),AiApi.setVerified(!1,u)),this.updateStatusIndicator(),this.refreshUsage()});return}AiSettingsView.hideModelSelection(),AiApi.setVerified(!1,u),this.updateStatusIndicator(),this.refreshUsage()});const o=this.elements.modelSelect;o&&this._bindOnce(o,"aiBoundModelChange","change",()=>{const u=this.elements.providerSelect?.value||AiApi.getProvider(),f=o.value;f?AiApi.saveModel(f,u):AiApi.saveModel("",u),this.clearStatus(),this.updateStatusIndicator()});const a=this.elements.inputField;a&&(this._bindOnce(a,"aiBoundApiKeyBlur","blur",()=>{const u=this.elements.providerSelect?.value||AiApi.getProvider(),f=a.value.trim();u&&f&&(AiApi.saveApiKey(u,f),AiApi.setVerified(!0,u),this.updateStatusIndicator())}),this._bindOnce(a,"aiBoundApiKeyKeypress","keypress",u=>{u.key==="Enter"&&(u.preventDefault(),this.verifyApiKey())}));const s=document.getElementById("buttonVerifyApiKey");if(s){const u=f=>{f.preventDefault(),this.verifyApiKey()};this._bindOnce(s,"aiBoundVerifyClick","click",u),this._bindOnce(s,"aiBoundVerifyKeypress","keypress",f=>{(f.key==="Enter"||f.key===" ")&&u(f)})}const c=document.getElementById("toggleApiKeyVisibility");c&&a&&(this._bindOnce(c,"aiBoundToggleVisibilityClick","click",()=>{this.toggleApiKeyVisibility()}),this._bindOnce(c,"aiBoundToggleVisibilityKeypress","keypress",u=>{(u.key==="Enter"||u.key===" ")&&(u.preventDefault(),this.toggleApiKeyVisibility())}));const d=this.elements.resetUsageButton;if(d){const u=f=>{f.preventDefault(),AiStorage.resetUsage(),this.refreshUsage()};this._bindOnce(d,"aiBoundResetUsage","click",u),this._bindOnce(d,"aiBoundResetUsageKeypress","keypress",f=>{(f.key==="Enter"||f.key===" ")&&u(f)})}!this._usageListenerBound&&typeof window<"u"&&(this._usageListenerBound=!0,window.addEventListener("aiUsageUpdated",()=>{const u=document.getElementById("aiSettingsModal");u&&!u.classList.contains("is-hidden")&&this.refreshUsage()}))},updateStatus(e,t){AiSettingsView.setStatusMessage(e,t)},clearStatus(){AiSettingsView.clearStatus()},showModelSelection(){AiSettingsView.showModelSelection()},hideModelSelection(){AiSettingsView.hideModelSelection()},updateStatusIndicator(){const e=AiApi.getProvider(),t=AiApi.getApiKey(e),n=AiApi.getModel(!1,e),r=AiApi.isVerified(e);AiSettingsView.updateStatusIndicator({provider:e,apiKey:t,model:n,verified:r})},showSettingsModal(){AiSettingsView.showSettingsModal(),this.loadPreferences(),setTimeout(()=>this.restoreSavedModel(),100),this.refreshUsage(),this.updateStatusIndicator()},showDialog(){this.showSettingsModal()},hideSettingsModal(){AiSettingsView.hideSettingsModal(),this.updateStatusIndicator()},restoreSavedModel(e=null){const t=e||AiApi.getProvider();AiSettingsView.restoreSavedModel(()=>AiApi.getModel(!1,t),n=>AiApi.saveModel(n,t))},async loadModels(e,t,n){AiSettingsView.setModelsLoading();const r=e==="openrouter"&&!t?null:t;try{const o=await AiApi.fetchModels(e,r);if(!o.ok){const c=await o.json().catch(()=>({}));if(o.status===401||o.status===403){const d=AiErrors.extractErrorMessage(c,"Enter API key to load models");AiSettingsView.setModelsError(d),n?.(!1);return}throw AiErrors.createApiError(o,c,"Failed to fetch models")}const a=await o.json(),s=AiApi.parseModelsResponse(e,a);AiSettingsView.setModelsOptions(s),this.restoreSavedModel(e),n?.(!0)}catch(o){console.error("Error loading models:",o);const a=o.message?`Error: ${o.message}`:"Error loading models";AiSettingsView.setModelsError(a),n?.(!1)}},loadPreferences(){let e=AiApi.getProvider();e||(e="openrouter",AiApi.saveProvider(e));const t=AiApi.getApiKey(e);AiSettingsView.setProviderValue(e),AiSettingsView.setApiKeyValue(t),AiSettingsView.updateProviderLink(e),AiApi.isVerified(e)&&t&&e?this.loadModels(e,t,r=>{r&&AiSettingsView.showModelSelection(),this.updateStatusIndicator()}):(AiSettingsView.hideModelSelection(),this.updateStatusIndicator()),this.refreshUsage()},async verifyApiKey(){const e=AiSettingsView.getElement("selectAiProvider","providerSelect"),t=AiSettingsView.getElement("inputAiApiKey","inputField");if(!e||!t){this.updateStatus("UI elements not found","error");return}const n=e.value,r=t.value.trim();if(!n){this.updateStatus("Please select a provider first","error");return}if(!r){this.updateStatus("Please enter an API key","error");return}AiApi.saveApiKey(n,r),AiApi.saveProvider(n),this.updateStatus("Verifying API key...","success"),AiSettingsView.hideModelSelection();const o=await AiApi.verifyKey(n,r);o.valid?this.loadModels(n,r,a=>{a?(this.updateStatus("Success!","success"),AiSettingsView.showModelSelection(),AiApi.setVerified(!0,n),setTimeout(()=>this.updateStatusIndicator(),100)):(this.updateStatus("Failed to load models after verification.","error"),AiApi.setVerified(!1,n),this.updateStatusIndicator())}):(this.updateStatus(`API key verification failed: ${o.error}`,"error"),AiApi.setVerified(!1,n),this.updateStatusIndicator())},toggleApiKeyVisibility(){AiSettingsView.toggleApiKeyVisibility()},refreshUsage(){const e=AiStorage.getAllUsage(),t=this.elements.providerSelect?.value||AiApi.getProvider();AiSettingsView.renderUsage(e,t)}};window.AiSettings=AiSettings;const RequirementsPromptBuilder=(()=>{"use strict";const e=typeof AiPromptUtils<"u"?AiPromptUtils:null,t=(D,m,M)=>e&&e.block?e.block(D,m,M):String(m||"").trim(),n=(D,m)=>e&&e.joinBlocks?e.joinBlocks(D,m):(D||[]).filter(Boolean).join(`

`),r={requirements:{url:"scripts/ai/prompts/requirement_guidance_prompt.md",blockTitle:"how_to_use_requirements_in_umple"},statemachine:{url:"scripts/ai/prompts/state_machine_guidance_prompt.md",blockTitle:"how_to_model_state_machines_in_umple"},classdiagram:{url:"scripts/ai/prompts/class_diagram_guidance_prompt.md",blockTitle:"how_to_model_class_diagrams_in_umple"},statemachine_system:{url:"scripts/ai/prompts/state_machine_system_prompt.md",blockTitle:"state_machine_critical_rules"},classdiagram_system:{url:"scripts/ai/prompts/class_diagram_system_prompt.md",blockTitle:"class_diagram_critical_rules"}},o=Object.create(null),a=Object.create(null);function s(D){return String(o[D]||"").trim()}function c(D){return D==="statemachine"?["statemachine"]:D==="classdiagram"?["classdiagram"]:[]}function d(D){return D==="statemachine"?["statemachine_system"]:D==="classdiagram"?["classdiagram_system"]:[]}function u(D){return c(D).map(M=>{const U=r[M];if(!U)return"";const z=s(M);return z?t(U.blockTitle,z):""}).filter(Boolean)}function f(D){return d(D).map(M=>{const U=r[M];if(!U)return"";const z=s(M);return z?t(U.blockTitle,z):""}).filter(Boolean)}function v(D){if(String(o[D]||"").trim())return Promise.resolve(o[D]);if(a[D])return a[D];const m=r[D],M=typeof AiPrompting<"u"&&AiPrompting.getPromptText?AiPrompting.getPromptText:null;return m?M?(a[D]=M(m.url).then(U=>(o[D]=U,delete a[D],U)).catch(U=>{throw delete a[D],U}),a[D]):Promise.reject(new Error("AiPrompting.getPromptText is not available")):Promise.reject(new Error(`Unknown guidance key: ${D}`))}async function h(D){const m=["requirements",...c(D),...d(D)];await Promise.all(m.map(M=>v(M)))}async function C(D){const m=["requirements",...c(D),...d(D)];await Promise.all(m.map(M=>v(M)))}function A(D){return(D||[]).map(m=>`Requirement ${m.id}:
${(m.text||"").trim()}`).join(`

`)}function T(D,m=[]){const M=typeof AiPrompting<"u"&&AiPrompting.getBaseSystemPrompt?AiPrompting.getBaseSystemPrompt():"You are an expert in Umple modeling language.";return n([t("system",M,{allowEmpty:!0}),...f(D),...u(D),t("umple_quick_reference",N(),{allowEmpty:!0}),t("output_contract",k({generationType:D,expectedRequirementIds:m})),t("directive","Your job is to generate ONLY valid Umple code.")])}function j(D){const m=typeof AiPrompting<"u"&&AiPrompting.getBaseSystemPrompt?AiPrompting.getBaseSystemPrompt():"You are an expert in Umple modeling language.";return n([t("system",m,{allowEmpty:!0}),t("role","You are debugging Umple code. Your task is to FIX compiler errors in a generated block so it compiles cleanly when inserted into the user's existing model."),...f(D),...u(D),t("umple_quick_reference",N(),{allowEmpty:!0}),t("repair_strategy",["1. Analyze the compiler error message carefully","2. Identify the root cause of the error in the code block"].join(`
`))])}function N(){return typeof AiPrompting<"u"&&AiPrompting.getUmpleCheatSheet?AiPrompting.getUmpleCheatSheet():""}function p(D){return D==="classdiagram"?"Generate Umple for a class diagram (classes, attributes, associations).":"Generate Umple for a state machine (states, events, transitions, guards/actions if relevant)."}function b(D){return D==="statemachine"?"- Include at least one class with a state machine using Umple syntax (state/status/sm/flow are acceptable if valid).":D==="classdiagram"?"- Include classes/attributes and associations if implied by the requirements.":""}function _(D,m="initial"){const M=(D||[]).join(", ");return m==="repair"&&!M?"- If requirement IDs are provided, include implementsReq for them.":`- You ${m==="repair"?"need to":"MUST"} include implementsReq for: ${M} (on the generated class(es) and/or association/sm as appropriate).`}function L(){return["- Output ONLY Umple code.",'- Output EXACTLY ONE fenced code block with language "umple":',"  ```umple","  ...","  ```","- No prose before or after the code block."]}function P(){return["- Do NOT re-output any req { ... } blocks.","- Do NOT re-output the user's existing model; output ONLY the new model elements to insert.","- Do NOT output position blocks, diagram layout, or @@@skip* directives unless explicitly requested.","- If you must assume something, add a single-line comment inside the code: // Assumption: ..."]}function S(D){return[t("umple_quick_reference",N(),{allowEmpty:!0})]}function k({generationType:D,expectedRequirementIds:m}){return[...L(),_(m,"initial"),b(D),...P()].filter(Boolean).join(`
`)}function O({generationType:D,expectedRequirementIds:m}){return[...L(),_(m,"repair"),b(D),"- Do NOT re-output any req { ... } blocks.","- Do NOT repeat the user's existing code; output ONLY the corrected generated block.","- Do NOT change or reference line-numbered edits in the user's original code; fix only the generated block.","- If you must assume something, add a single-line comment inside the code: // Assumption: ..."].filter(Boolean).join(`
`)}function R(D){const m=String(D||"");if(!m.trim())return["Response is empty"];const M=typeof AiTextUtils<"u"&&AiTextUtils.parseCodeBlocks?AiTextUtils.parseCodeBlocks(m):[],U=M.length>0?M:[],z=[];if(U.length!==1)z.push(`Expected exactly one fenced code block, found ${U.length}.`);else{const ee=U[0].language;(!ee||ee!=="umple")&&z.push(`Code block language must be "umple" (found "${ee||"none"}").`)}return m.replace(/```[\s\S]*?```/g,"").trim()&&z.push("Response contains text outside the code block."),z}function I(D){const m=(D.match(/\{/g)||[]).length,M=(D.match(/\}/g)||[]).length;return m===M}function F(D,m){const M=(m||[]).filter(Boolean);if(M.length===0)return[];const U=[],z=D.split(`
`).filter(q=>q.includes("implementsReq"));return M.forEach(q=>{const ee=new RegExp(`\\b${q.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}\\b`);z.some(Y=>ee.test(Y))||U.push(`Missing implementsReq for requirement ${q}`)}),U}function V(D,m){const M=[];return/\b(class|association)\b/.test(D)||M.push("No class or association definition found"),m==="statemachine"&&(/\b(sm|state|status|flow)\s*\{/.test(D)||M.push("No state machine block found (expected state/status/sm/flow)")),M}return{preloadGuidance(D){return h(D)},preloadRepairGuidance(D){return C(D)},validateGeneratedUmple({code:D,expectedRequirementIds:m=[],generationType:M}={}){const U=[],z=(D||"").trim();return z?(I(z)||U.push("Unbalanced braces in generated code"),U.push(...V(z,M)),U.push(...F(z,m)),{valid:U.length===0,errors:U}):{valid:!1,errors:["Generated code is empty"]}},validateResponseFormat(D){return R(D)},getValidationAsCompilerErrors({code:D,expectedRequirementIds:m=[],generationType:M}={}){const U=this.validateGeneratedUmple({code:D,expectedRequirementIds:m,generationType:M});return U.valid?[]:U.errors.map(z=>({severity:"Error",errorCode:"VALIDATION_ERROR",message:z,line:1,isPseudoError:!0}))},buildGeneration(D,m){const M=(D||[]).map(q=>q.id).filter(Boolean),U=A(D);return{prompt:n([t("task",p(m)),t("requirements",U,{allowEmpty:!0}),t("how_to_use_requirements_in_umple",s("requirements"),{allowEmpty:!0}),t("output_contract",k({generationType:m,expectedRequirementIds:M}))]),systemPrompt:T(m,M),expectedRequirementIds:M}},repair_buildGeneration({generationType:D,requirements:m,originalCode:M,invalidBlock:U,compilerIssuesText:z}={}){const q=(m||[]).map(fe=>fe.id).filter(Boolean),ee=A(m),W=(M||"").trim(),Y=W.length>8e3?`${W.slice(0,8e3)}

// Assumption: Original model truncated for prompt size.`:W,ne=(z||"").trim(),X=ne?`Errors (compiler and validation) with code snippets:
${ne}`:"- (No details provided)";return{prompt:n([t("task",`You are debugging Umple code. Follow this workflow:

1. Read the current_generated_block_to_fix
2. Read the compiler_issues_errors_warnings
3. Read the troubleshooting information
4. Read the requirements and output_contract
5. Generate corrected block that satisfies all constraints`),t("compiler_issues_errors_warnings",X),t("current_generated_block_to_fix",`\`\`\`umple
${(U||"").trim()}
\`\`\``),t("original_model_read_only_context",`\`\`\`umple
${Y}
\`\`\``),t("requirements",ee,{allowEmpty:!0}),t("output_contract",O({generationType:D,expectedRequirementIds:q}))]),systemPrompt:j(D),expectedRequirementIds:q}}}})(),RequirementsDialog={getRequirementsOutputArea(){return document.getElementById("requirementsOutputArea")},clearRequirementsOutput(){const e=this.getRequirementsOutputArea();e&&(e.value="")},appendRequirementsOutput(e){const t=this.getRequirementsOutputArea();if(!t)return;const n=String(e||"");t.value=t.value?`${t.value}
${n}`:n,t.scrollTop=t.scrollHeight},setStatusMessage(e,t,n,r="#3383bb"){if(e)if(e.style.display="block",e.style.color=r,e.textContent="",t){const o=document.createElement("span");o.className="ai-status-label",o.textContent=t,e.appendChild(o),e.appendChild(document.createTextNode(` ${n}`))}else e.textContent=n},createSingleRequirementUI(e){const t=document.createElement("div");t.className="requirement-selection";const n=document.createElement("h4");n.textContent="Requirement:",t.appendChild(n);const r=document.createElement("div");r.className="requirement-display";const o=document.createElement("strong");o.textContent=e.id,r.appendChild(o);const a=document.createElement("div");return a.className="requirement-text",a.textContent=e.text,r.appendChild(a),t.appendChild(r),t},createMultipleRequirementUI(e){const t=document.createElement("div");t.className="requirement-selection";const n=document.createElement("h4");n.textContent="Select Requirements:",t.appendChild(n);const r=document.createElement("div");r.className="requirement-mode";const o=document.createElement("label"),a=document.createElement("input");a.type="radio",a.name="reqMode",a.value="all",a.checked=!0,o.appendChild(a),o.appendChild(document.createTextNode(" All Requirements (recommended for comprehensive generation)")),r.appendChild(o);const s=document.createElement("label"),c=document.createElement("input");c.type="radio",c.name="reqMode",c.value="multiple",s.appendChild(c),s.appendChild(document.createTextNode(" Select Specific Requirements")),r.appendChild(s),t.appendChild(r);const d=document.createElement("div");d.id="multipleReqSelection",d.className="multiple-req-selection",d.style.display="none",e.forEach(h=>{const C=document.createElement("label");C.className="requirement-checkbox";const A=document.createElement("input");A.type="checkbox",A.value=h.id,A.className="req-checkbox",C.appendChild(A);const T=document.createElement("span");T.className="requirement-summary";const j=document.createElement("strong");j.textContent=h.id,T.appendChild(j);const N=h.text.substring(0,100)+(h.text.length>100?"...":"");T.appendChild(document.createTextNode(`: ${N}`)),C.appendChild(T),d.appendChild(C)}),t.appendChild(d);const u=document.createElement("div");u.id="selectedReqDisplay",u.className="selected-req-display";const f=document.createElement("strong");f.textContent="Selected Requirements:",u.appendChild(f);const v=document.createElement("div");return v.id="selectedReqText",v.textContent=`All requirements (${e.length})`,u.appendChild(v),t.appendChild(u),t},updateSelectedDisplay(e,t){const n=document.getElementById("selectedReqText"),r=e.querySelectorAll(".req-checkbox:checked"),o=Array.from(r).map(a=>a.value);if(o.length===0)n.textContent="No requirements selected";else{const a=t.filter(s=>o.includes(s.id));n.textContent=a.map(s=>`${s.id}: ${s.text}`).join(`

`)}},getSelectedRequirements(e,t){if((e.querySelector('input[name="reqMode"]:checked')?.value||"all")==="all")return t;{const r=e.querySelectorAll(".req-checkbox:checked"),o=Array.from(r).map(a=>a.value);return t.filter(a=>o.includes(a.id))}},createDialog(e){const t=document.getElementById("aiRequirementsDialog");t&&t.remove();const n=document.createElement("div");n.id="aiRequirementsDialog",n.className="ai-requirements-dialog";const r=document.createElement("div");r.className="dialog-overlay",n.appendChild(r);const o=document.createElement("div");o.className="dialog-content";const a=document.createElement("h3");a.textContent="Generate from Requirements",o.appendChild(a);const s=e.length===1?this.createSingleRequirementUI(e[0]):this.createMultipleRequirementUI(e);o.appendChild(s);const c=document.createElement("div");c.className="generation-type";const d=document.createElement("h4");d.textContent="Select Generation Type:",c.appendChild(d);const u=document.createElement("label"),f=document.createElement("input");f.type="radio",f.name="genType",f.value="statemachine",f.checked=!0,u.appendChild(f),u.appendChild(document.createTextNode(" State Machine")),c.appendChild(u);const v=document.createElement("label"),h=document.createElement("input");h.type="radio",h.name="genType",h.value="classdiagram",v.appendChild(h),v.appendChild(document.createTextNode(" Class Diagram")),c.appendChild(v),o.appendChild(c);const C=document.createElement("div");C.id="generatedCodeContainer",C.style.display="none";const A=document.createElement("h4");A.textContent="Generated Umple Code:",C.appendChild(A);const T=document.createElement("textarea");T.id="generatedCodeArea",T.readOnly=!0,C.appendChild(T),o.appendChild(C);const j=document.createElement("div");j.id="requirementsOutputContainer",j.style.display="none";const N=document.createElement("h4");N.textContent="Log:",j.appendChild(N);const p=document.createElement("textarea");p.id="requirementsOutputArea",p.readOnly=!0,j.appendChild(p),o.appendChild(j);const b=document.createElement("div");b.className="dialog-buttons";const _=document.createElement("div");_.id="btnGenerate",_.className="jQuery-palette-button unselectable ui-button ui-corner-all ui-widget",_.tabIndex=0,_.setAttribute("role","button"),_.textContent="Generate",b.appendChild(_);const L=document.createElement("div");L.id="btnStop",L.className="jQuery-palette-button unselectable ui-button ui-corner-all ui-widget",L.tabIndex=0,L.setAttribute("role","button"),L.style.display="none",L.textContent="Stop",b.appendChild(L);const P=document.createElement("div");P.id="btnInsert",P.className="jQuery-palette-button unselectable ui-button ui-corner-all ui-widget",P.tabIndex=0,P.setAttribute("role","button"),P.style.display="none",P.textContent="Insert to Editor",b.appendChild(P);const S=document.createElement("div");S.id="btnCancel",S.className="jQuery-palette-button unselectable ui-button ui-corner-all ui-widget",S.tabIndex=0,S.setAttribute("role","button"),S.textContent="Cancel",b.appendChild(S);const k=document.createElement("div");return k.id="statusMessage",k.className="status-message",k.style.display="none",o.appendChild(k),o.appendChild(b),n.appendChild(o),document.body.appendChild(n),n},setupDialogEvents(e,t,n){e.querySelectorAll('input[name="reqMode"]').forEach(A=>{A.addEventListener("change",T=>{const j=T.target.value,N=document.getElementById("multipleReqSelection"),p=document.getElementById("selectedReqText");j==="all"?(N.style.display="none",p.textContent=`All requirements (${t.length})`):j==="multiple"&&(N.style.display="block",this.updateSelectedDisplay(e,t))})}),e.querySelectorAll(".req-checkbox").forEach(A=>{A.addEventListener("change",()=>{this.updateSelectedDisplay(e,t)})});const a=document.getElementById("btnGenerate"),s=A=>{A.preventDefault(),n.onGenerate&&n.onGenerate()};a.addEventListener("click",s),a.addEventListener("keypress",A=>{(A.key==="Enter"||A.key===" ")&&s(A)});const c=document.getElementById("btnStop"),d=A=>{A.preventDefault(),n.onStop&&n.onStop()};c.addEventListener("click",d),c.addEventListener("keypress",A=>{(A.key==="Enter"||A.key===" ")&&d(A)});const u=document.getElementById("btnInsert"),f=A=>{A.preventDefault(),n.onInsert&&n.onInsert()};u.addEventListener("click",f),u.addEventListener("keypress",A=>{(A.key==="Enter"||A.key===" ")&&f(A)});const v=document.getElementById("btnCancel"),h=A=>{A.preventDefault(),n.onCancel&&n.onCancel()};v.addEventListener("click",h),v.addEventListener("keypress",A=>{(A.key==="Enter"||A.key===" ")&&h(A)}),e.querySelector(".dialog-overlay").addEventListener("click",()=>{n.onCancel&&n.onCancel()})}},RequirementsSelfCorrection={getInsertionPos(e){const t=typeof Page<"u"&&Page.modelDelimiter?Page.modelDelimiter:null,n=t?e.indexOf(t):-1,r=n>=0?n:e.length,o=e.slice(0,r),a=/req\s+(\w+(?:[-_]\w+)*)\s*\{[^}]*\}/gs;let s=-1,c;for(;(c=a.exec(o))!==null;)s=c.index+c[0].length;return s>=0?s:r},buildMergedCode(e,t){const n=this.getInsertionPos(e),r=String(t||"").trim(),o=AiTextUtils.computePrefix(e,n),a=AiTextUtils.computeSuffix(e,n),s=o+r+a,c=e.slice(0,n)+s+e.slice(n),d=n+o.length,u=d+r.length;return{insertPos:n,insertText:s,mergedText:c,highlightFrom:d,highlightTo:u,codeText:r}},async run({originalCode:e,generatedBlock:t,requirements:n,generationType:r,systemPrompt:o,dialog:a,statusDiv:s,expectedRequirementIds:c,onStreamDelta:d}={}){const u=AiCompilerService.getSelfCorrectionMaxPasses();let f=String(t||"").trim();if(!f)return{block:f};let v=null;try{v=await AiCompilerService.compileUmpleWithServer(e),v.issues.length>0?(RequirementsDialog.appendRequirementsOutput("Baseline compile: the original model already has issues:"),RequirementsDialog.appendRequirementsOutput(AiCompilerService.formatIssuesForLog(v.issues))):RequirementsDialog.appendRequirementsOutput("Baseline compile: no issues in original model.")}catch(j){RequirementsDialog.appendRequirementsOutput(`Baseline compile failed: ${j.message}`)}const h=new Set,C=String(f||"").trim();C&&h.add(C);let A=null,T=0;if(typeof RequirementsPromptBuilder<"u"&&RequirementsPromptBuilder.preloadRepairGuidance)try{await RequirementsPromptBuilder.preloadRepairGuidance(r)}catch(j){RequirementsDialog.appendRequirementsOutput(`Repair guidance preload failed (continuing anyway): ${j.message}`)}for(let j=1;j<=u;j++){if(a?.stopped){RequirementsDialog.appendRequirementsOutput(`
Self-correction stopped by user at pass ${j}.`);break}RequirementsDialog.setStatusMessage(s,"Compiler",`Self-correction pass ${j}/${u}: compiling...`),RequirementsDialog.appendRequirementsOutput(`
Self-correction pass ${j}: compiling merged model...`);const N=this.buildMergedCode(e,f),p=AiTextUtils.computeLineNumberAtIndex(N.mergedText,N.highlightFrom),b=AiTextUtils.computeLineNumberAtIndex(N.mergedText,N.highlightTo),_=N.mergedText;let L;try{L=await AiCompilerService.compileUmpleWithServer(_)}catch(Y){RequirementsDialog.appendRequirementsOutput(`Compile failed: ${Y.message}`);break}const P=L.issues||[];if(typeof RequirementsPromptBuilder<"u"&&RequirementsPromptBuilder.getValidationAsCompilerErrors){const Y=RequirementsPromptBuilder.getValidationAsCompilerErrors({code:f,expectedRequirementIds:c||[],generationType:r});Y.length>0&&(RequirementsDialog.appendRequirementsOutput(`Validation issues found: ${Y.map(ne=>ne.message).join(", ")}`),P.unshift(...Y))}const S=P.filter(Y=>Y.severity==="Error");if(S.length===0){const Y=P.filter(ne=>ne.severity==="Warning").length;return RequirementsDialog.appendRequirementsOutput(Y>0?`Compiler reports no errors (${Y} warning(s) ignored for self-correction).`:"Compiler reports no errors."),{block:f}}const k=v?.issues||[],O=k.length>0?new Set(k.map(Y=>AiCompilerService.getIssueKey(Y))):new Set,R=O.size>0?S.filter(Y=>!O.has(AiCompilerService.getIssueKey(Y))):S;if(O.size>0&&RequirementsDialog.appendRequirementsOutput(`Baseline issues: ${k.length}`),O.size>0&&R.length===0)return RequirementsDialog.appendRequirementsOutput("Only baseline errors remain; stopping self-correction."),{block:f};const I=R.length>0?R:S,F=I.filter(Y=>Number.isFinite(Y.line)&&Y.line>=p&&Y.line<=b),V=F.length>0?F:I,D=V.map(Y=>AiCompilerService.getIssueKey(Y)).join("||");if(D&&D===A?T+=1:(T=0,A=D),T>=3){RequirementsDialog.appendRequirementsOutput("Compiler issues did not change after 3 repair attempts; stopping self-correction.");break}const m=S.filter(Y=>Y.errorCode==="VALIDATION_ERROR").length,M=S.length-m,U=[];M>0&&U.push(`${M} compiler`),m>0&&U.push(`${m} validation`),RequirementsDialog.appendRequirementsOutput(`Found ${U.join(" + ")} error(s) in merged model.`),F.length>0?RequirementsDialog.appendRequirementsOutput(`Focusing on ${F.length} issue(s) within the inserted block (lines ${p}-${b}).`):RequirementsDialog.appendRequirementsOutput("No issues were located within the inserted block line range; attempting to fix by adjusting the generated block anyway."),RequirementsDialog.appendRequirementsOutput(AiCompilerService.formatIssuesForLog(V));const z=V.map(Y=>{const ne=Y.errorCode?` (${Y.errorCode})`:"",X=Number.isFinite(Y.line)?Y.line:"?",se=Number.isFinite(Y.line)&&Y.line>=p&&Y.line<=b?Y.line-p+1:null,fe=Number.isFinite(se)?` (block line ${se})`:"";let pe=`- ${Y.severity}${ne} on merged line ${X}${fe}: ${Y.message}`;if(Number.isFinite(Y.line)&&_){const me=AiTextUtils.getLinesAround(_,Y.line-1,2);me&&(pe+=`
  snippet:
${me.split(`
`).map(ye=>"  "+ye).join(`
`)}`)}return pe}).join(`
`),q=typeof RequirementsPromptBuilder<"u"&&RequirementsPromptBuilder.repair_buildGeneration?RequirementsPromptBuilder.repair_buildGeneration({generationType:r,requirements:n,originalCode:e,invalidBlock:f,compilerIssuesText:z}):{prompt:`Fix the following Umple block so that it compiles with the original model without errors.

Original model:

\`\`\`umple
${e}
\`\`\`

Block to fix:

\`\`\`umple
${f}
\`\`\`

Compiler issues:
${z}

Output ONLY the corrected block as a single \`\`\`umple\`\`\` code block.`,systemPrompt:o};RequirementsDialog.setStatusMessage(s,"LLM",`Repairing errors (compiler + validation) in block (pass ${j}/${u})...`),RequirementsDialog.appendRequirementsOutput("Asking AI to repair the generated block...");let ee;try{const Y=document.getElementById("generatedCodeArea");let ne="";Y&&(Y.value="",Y.placeholder="Repairing generated block...");const X=AiApi.chatStream(q.prompt,q.systemPrompt,{},{onDelta:se=>{ne+=se,Y&&(Y.value=ne,Y.scrollTop=Y.scrollHeight),d&&d(se)}});if(typeof AiRequirements<"u"&&(AiRequirements.activeStream=X),ee=await X.done,typeof AiRequirements<"u"&&(AiRequirements.activeStream=null),a?.stopped){RequirementsDialog.appendRequirementsOutput(`
Self-correction stopped by user.`);break}}catch(Y){RequirementsDialog.appendRequirementsOutput(`AI repair failed: ${Y.message}`);break}const W=String(AiTextUtils.extractUmpleCode(ee)||"").trim();if(!W){RequirementsDialog.appendRequirementsOutput("AI repair produced empty output; stopping.");break}if(W.trim()===String(f||"").trim()){RequirementsDialog.appendRequirementsOutput("AI repair repeated the current output; stopping.");break}if(h.has(W)){RequirementsDialog.appendRequirementsOutput("AI repair repeated an earlier output; stopping.");break}f=W,h.add(W),RequirementsDialog.appendRequirementsOutput("Retrying compile with repaired block...")}return RequirementsDialog.appendRequirementsOutput("Self-correction stopped before reaching a clean compile."),{block:f}}},AiRequirements={activeStream:null,parseRequirements(e){const t=[],n=/req\s+(\w+(?:[-_]\w+)*)\s*\{([^}]*)\}/gs;let r;for(;(r=n.exec(e))!==null;){const o=r[1].trim(),a=r[2].trim();o&&a&&t.push({id:o,text:a})}return t},abortActiveStream(){try{this.activeStream?.abort?.()}catch{}finally{this.activeStream=null}},checkApiConfig(){return AiConfigValidation.checkApiConfig({requireVerified:!1})},buildPrompt(e,t){if(typeof RequirementsPromptBuilder<"u"&&RequirementsPromptBuilder.buildGeneration)return RequirementsPromptBuilder.buildGeneration(e,t).prompt;const n=e.map(r=>`Requirement ${r.id}:
${r.text}`).join(`

`);return typeof AiPromptUtils<"u"&&AiPromptUtils.block&&AiPromptUtils.joinBlocks?AiPromptUtils.joinBlocks([AiPromptUtils.block("task","Generate ONLY Umple code based on the following requirement(s)."),AiPromptUtils.block("requirements",n,{allowEmpty:!0}),AiPromptUtils.block("output_contract",["- Output ONLY Umple code.",'- Output EXACTLY ONE fenced code block with language "umple":',"  ```umple","  ...","  ```","- No prose before or after the code block."].join(`
`))]):`Generate ONLY Umple code based on the following requirement(s).

Requirements:
${n}

Umple code:`},extractUmpleCode(e){return AiTextUtils.extractUmpleCode(e)},SYSTEM_PROMPT:(()=>{const e=typeof AiPrompting<"u"&&AiPrompting.getBaseSystemPrompt?AiPrompting.getBaseSystemPrompt():"You are an expert in Umple modeling language.",t="Your job is to generate ONLY valid Umple code.";return typeof AiPromptUtils<"u"&&AiPromptUtils.block&&AiPromptUtils.joinBlocks?AiPromptUtils.joinBlocks([AiPromptUtils.block("system",e,{allowEmpty:!0}),AiPromptUtils.block("directive",t)]):`${e}

${t}`})(),showDialog(){const e=Page.codeMirrorEditor6?.state.doc.toString()||"",t=this.parseRequirements(e);if(t.length===0){alert(`No requirements found in your Umple code.

See https://cruise.umple.org/umple/Requirements.html for more information.`);return}const n=this.checkApiConfig();if(!n.configured){typeof AiSettings<"u"&&AiSettings.showSettingsModal&&AiSettings.showSettingsModal(),alert(n.message);return}const r=RequirementsDialog.createDialog(t);RequirementsDialog.setupDialogEvents(r,t,{onGenerate:()=>this.handleGenerate(r,t),onStop:()=>this.handleStop(r),onInsert:()=>this.handleInsert(r),onCancel:()=>{this.abortActiveStream(),r.remove()}})},async handleGenerate(e,t){const n=document.getElementById("statusMessage"),r=document.getElementById("btnGenerate"),o=document.getElementById("btnStop"),a=document.getElementById("btnInsert"),s=document.getElementById("generatedCodeContainer"),c=document.getElementById("generatedCodeArea"),d=document.getElementById("requirementsOutputContainer"),u=RequirementsDialog.getSelectedRequirements(e,t);if(u.length===0){RequirementsDialog.setStatusMessage(n,"Error","Please select at least one requirement","#DD0033");return}const f=e.querySelector('input[name="genType"]:checked')?.value||"statemachine",v=this.checkApiConfig();if(!v.configured){RequirementsDialog.setStatusMessage(n,"Error",v.message,"#DD0033");return}r.classList.add("disabled"),r.textContent="Generating...",o.style.display="inline-block",RequirementsDialog.setStatusMessage(n,"LLM","Generating Umple code from requirements..."),d&&(d.style.display="block"),RequirementsDialog.clearRequirementsOutput(),RequirementsDialog.appendRequirementsOutput(`Generation type: ${f}`),e.generationContext={selectedReqs:u,genType:f,generation:null,umpleCode:""};let h=!1;try{if(typeof RequirementsPromptBuilder<"u"&&RequirementsPromptBuilder.preloadGuidance){const p=f==="classdiagram"?"class diagrams":"state machines";RequirementsDialog.appendRequirementsOutput(`Reading guidance on requirements and ${p}...`),await RequirementsPromptBuilder.preloadGuidance(f)}const C=typeof RequirementsPromptBuilder<"u"&&RequirementsPromptBuilder.buildGeneration?RequirementsPromptBuilder.buildGeneration(u,f):{prompt:this.buildPrompt(u,f),systemPrompt:this.SYSTEM_PROMPT,expectedRequirementIds:u.map(p=>p.id)};e.generationContext.generation=C,RequirementsDialog.setStatusMessage(n,"LLM",`Generating ${f==="classdiagram"?"class diagram":"state machine"}...`),RequirementsDialog.appendRequirementsOutput(`Generating ${f==="classdiagram"?"class diagram":"state machine"}...`);let A="";c.value="",s.style.display="block",a.style.display="none",this.activeStream=AiApi.chatStream(C.prompt,C.systemPrompt,{},{onDelta:p=>{A+=p,c.value=A,c.scrollTop=c.scrollHeight},onTruncated:()=>{h=!0}});const T=await this.activeStream.done;if(this.activeStream=null,RequirementsDialog.appendRequirementsOutput("Generated initial Umple block from AI."),h){e.stopped=!0,RequirementsDialog.setStatusMessage(n,"LLM","Generation stopped: AI output was truncated due to token limit. Try selecting fewer requirements, shortening requirement text, or using a larger model.","#DD0033"),c.value=T||"",s.style.display="block",a.style.display=T&&T.trim()?"inline-block":"none";return}let j=T||"";if(typeof RequirementsPromptBuilder<"u"&&RequirementsPromptBuilder.validateResponseFormat){const p=RequirementsPromptBuilder.validateResponseFormat(j);if(p.length>0&&!e.stopped){RequirementsDialog.appendRequirementsOutput(`Output contract violations: ${p.join("; ")}`),RequirementsDialog.setStatusMessage(n,"LLM","Repairing output format..."),RequirementsDialog.appendRequirementsOutput("Attempting format-only repair..."),c.value="",c.placeholder="Repairing output format...",s.style.display="block";const b=Page.codeMirrorEditor6?.state.doc.toString()||"",_=this.extractUmpleCode(j),L=p.map(O=>`- Validation Error: ${O}`).join(`
`),P=typeof RequirementsPromptBuilder<"u"&&RequirementsPromptBuilder.repair_buildGeneration?RequirementsPromptBuilder.repair_buildGeneration({generationType:f,requirements:u,originalCode:b,invalidBlock:_,compilerIssuesText:L}):{prompt:`Fix the output format: ${L}

Output ONLY a single \`\`\`umple\`\`\` code block with valid Umple code.`,systemPrompt:C.systemPrompt};let S="";this.activeStream=AiApi.chatStream(P.prompt,P.systemPrompt,{},{onDelta:O=>{S+=O,c.value=S,c.scrollTop=c.scrollHeight}}),j=await this.activeStream.done,this.activeStream=null,RequirementsDialog.appendRequirementsOutput("Output format repair completed.");const k=RequirementsPromptBuilder.validateResponseFormat(j);k.length>0&&RequirementsDialog.appendRequirementsOutput(`Output contract still violated: ${k.join("; ")}`)}}e.generationContext.umpleCode=this.extractUmpleCode(j);let N=e.generationContext.umpleCode;if(!e.stopped){RequirementsDialog.setStatusMessage(n,"Compiler","Running self-correction (compiler + validation)..."),RequirementsDialog.appendRequirementsOutput("Running self-correction (compiler + validation)..."),c.value="",c.placeholder="Self-correction in progress...";const p=Page.codeMirrorEditor6?.state.doc.toString()||"";try{const b=await RequirementsSelfCorrection.run({originalCode:p,generatedBlock:N,requirements:u,generationType:f,systemPrompt:C.systemPrompt,dialog:e,statusDiv:n,expectedRequirementIds:C.expectedRequirementIds});b&&typeof b.block=="string"&&b.block.trim()&&(N=b.block.trim(),e.generationContext.umpleCode=N)}catch(b){RequirementsDialog.appendRequirementsOutput(`Self-correction failed: ${b.message}`)}}if(c.placeholder="",c.value=N,s.style.display="block",a.style.display="inline-block",n.style.color!=="#DD0033"){const p=e.stopped?"Generation stopped. Partial code generated! Review and click 'Insert to Editor' to add it to your model.":"Code generated successfully! Review and click 'Insert to Editor' to add it to your model.";RequirementsDialog.setStatusMessage(n,"LLM",p)}}catch(C){if(C?.name==="AbortError"){RequirementsDialog.appendRequirementsOutput(`
Generation stopped by user.`);return}console.error("Error generating code:",C),RequirementsDialog.setStatusMessage(n,"Error",`Error: ${C.message}`,"#DD0033")}finally{r.classList.remove("disabled"),r.textContent="Generate",o.style.display="none",e.stopped=!1,e.generationContext=null}},async handleStop(e){const t=document.getElementById("statusMessage"),n=document.getElementById("btnGenerate"),r=document.getElementById("btnStop"),o=document.getElementById("btnInsert"),a=document.getElementById("generatedCodeContainer"),s=document.getElementById("generatedCodeArea");e.stopped=!0,this.abortActiveStream(),RequirementsDialog.setStatusMessage(t,"LLM","Stopping generation...");try{const c=e.generationContext;if(!c){RequirementsDialog.setStatusMessage(t,"LLM","No generation in progress.","#DD0033");return}let d=c.umpleCode||"";d.trim()?(RequirementsDialog.appendRequirementsOutput("Applying partial generated code..."),s.value=d,a.style.display="block",o.style.display="inline-block",RequirementsDialog.setStatusMessage(t,"LLM","Generation stopped. Partial code generated! Review and click 'Insert to Editor' to add it to your model.")):RequirementsDialog.setStatusMessage(t,"LLM","Generation stopped before any code was generated.","#DD0033")}catch(c){console.error("Error stopping generation:",c),RequirementsDialog.setStatusMessage(t,"Error",`Error stopping: ${c.message}`,"#DD0033")}finally{n.classList.remove("disabled"),n.textContent="Generate",r.style.display="none",e.generationContext=null}},handleInsert(e){const n=document.getElementById("generatedCodeArea").value;if(n){if(!Page.codeMirrorEditor6){alert("Editor not initialized");return}const r=Page.codeMirrorEditor6.state.doc.toString(),o=RequirementsSelfCorrection.buildMergedCode(r,n),a=3e3;Page.codeMirrorEditor6.dispatch({changes:{from:o.insertPos,to:o.insertPos,insert:o.insertText},selection:o.highlightTo>o.highlightFrom?{anchor:o.highlightFrom,head:o.highlightTo}:{anchor:o.insertPos+o.insertText.length},scrollIntoView:!0}),Page.codeMirrorEditor6.focus();const s=Page.codeMirrorEditor6.state.doc.toString();TabControl.getCurrentHistory().save(s,"aiGeneration"),setTimeout(()=>{const c=Page.codeMirrorEditor6;if(!c)return;const d=c.state.selection.main;d.from===o.highlightFrom&&d.to===o.highlightTo&&c.dispatch({selection:{anchor:o.highlightFrom}})},a),e.remove()}}},ExplainPromptBuilder=(()=>{"use strict";const e=typeof AiPromptUtils<"u"?AiPromptUtils:null,t=(d,u,f)=>e&&e.block?e.block(d,u,f):String(u||"").trim(),n=(d,u)=>e&&e.joinBlocks?e.joinBlocks(d,u):(d||[]).filter(Boolean).join(`

`),r=50,o=(()=>{const d=typeof AiPrompting<"u"&&AiPrompting.getBaseSystemPrompt?AiPrompting.getBaseSystemPrompt():"You are an expert in Umple (https://cruise.umple.org/umple/): its textual modeling syntax, class/state-machine/traits/aspects, associations & multiplicities, constraints, generation targets (Java/PHP/\u2026 as supported by Umple), and common Umple patterns.";return n([t("system",d,{allowEmpty:!0}),t("directive","Your job is to explain any Umple snippet (or mixed Umple + generated code) clearly and accurately."),t("goals",["- Preserve correctness: be precise and accurate, do not invent features"]),t("rules",["- Your audience are familiar with modeling and have basic coding background","- Be precise and accurate in your explanations","- Do not assume missing context","- Keep output concise but complete","- Use markdown syntax (level 2 headings `##` for all section titles)","- Only summary-style content should have bullet points; avoid bullet points in most cases"])])})(),a=n([t("task","Explain the following Umple code."),t("response_structure_follow_strictly",["1. ## Summary: A one-sentence summary of what the snippet models/does","2. ## Walkthrough: Explain the Umple code in plain language, and provide a high-level workflow explanation.","3. Use level 2 headings (`## Title`) for all section titles in your response"]),t("code_to_explain","```umple\n{{code}}\n```"),t("your_response","Provide your explanation following the structure above.")]),s=n([t("conversation_history","{{conversationHistory}}",{allowEmpty:!0}),t("user_question","{{userQuestion}}"),t("instructions",["Answer based on the original Umple code and previous explanation. Be precise and accurate. Reference specific code elements."])]),c={codeBlock:/```(\w+)?\s*([\s\S]*?)```/g,inlineCode:/`([^`]+)`/g,bold:/\*\*([^*]+)\*\*/g,italic:/\*([^*]+)\*/g,lineBreak:/\n/g};return{getSystemPrompt(){return o},buildInitialPrompt(d){return a.replace(/\{\{code\}\}/g,d)},buildFollowUpPrompt(d,u){const f=this.formatConversationHistory(d);return s.replace(/\{\{conversationHistory\}\}/g,f).replace(/\{\{userQuestion\}\}/g,u)},formatExplanation(d){let u=this.escapeHtml(d);return u=u.replace(c.codeBlock,"<pre><code>$2</code></pre>").replace(c.inlineCode,"<code>$1</code>").replace(c.bold,"<strong>$1</strong>").replace(c.italic,"<em>$1</em>").replace(c.lineBreak,"<br/>"),u},buildCustomPrompt(d,u,f={}){let v=d.replace(/\{\{code\}\}/g,u);return Object.entries(f).forEach(([h,C])=>{const A=new RegExp(`\\{\\{${h}\\}\\}`,"g");v=v.replace(A,C)}),v},validateExplanation(d){const u=this.collectValidationErrors(d);return{valid:u.length===0,errors:u}},formatConversationHistory(d){return d.map(u=>`${u.role}: ${u.content}`).join(`

`)},escapeHtml(d){return AiTextUtils.escapeHtml(d)},collectValidationErrors(d){const u=[];return!d||d.trim().length===0?(u.push("Explanation is empty"),u):(d.length<r&&u.push("Explanation seems too short to be useful"),u)}}})(),AiExplain={conversationHistory:[],currentExplanation:null,activeStream:null,thinkingInterval:null,checkApiConfig(){return AiConfigValidation.checkApiConfig({requireVerified:!1})},resetConversation(){this.conversationHistory=[],this.currentExplanation=null},abortActiveStream(){try{this.activeStream?.abort?.()}catch{}finally{this.activeStream=null}this.stopThinkingAnimation()},startThinkingAnimation(e){if(!e)return;this.stopThinkingAnimation();let t=0;const n=()=>{t=t%3+1,e.textContent="thinking"+".".repeat(t)};n(),this.thinkingInterval=setInterval(n,500)},stopThinkingAnimation(){this.thinkingInterval&&(clearInterval(this.thinkingInterval),this.thinkingInterval=null)},addToHistory(e,t){this.conversationHistory.push({role:e,content:t}),this.conversationHistory.length>10&&(this.conversationHistory=this.conversationHistory.slice(-10))},async showDialog(){const e=Page.codeMirrorEditor6?.state.doc.toString()||"";if(!e.trim()){alert("No code in the editor to explain. Please enter some Umple code first.");return}const t=this.checkApiConfig();if(!t.configured){typeof AiSettings<"u"&&AiSettings.showSettingsModal&&AiSettings.showSettingsModal(),alert(t.message);return}this.createDialog(),this.resetConversation(),await this.performExplanation(e)},createDialog(){const e=document.getElementById("aiExplainDialog");e&&e.remove();const t=document.createElement("div");t.id="aiExplainDialog",t.className="ai-explain-dialog";const n=document.createElement("div");n.className="dialog-overlay",t.appendChild(n);const r=document.createElement("div");r.className="dialog-content";const o=document.createElement("h3");o.textContent="Explain Code",r.appendChild(o);const a=document.createElement("div");a.id="explainStatusMessage",a.className="status-message",a.textContent="",r.appendChild(a);const s=document.createElement("div");s.id="explanationContainer",s.className="explanation-container";const c=document.createElement("div");c.id="explanationText",c.className="explanation-text",s.appendChild(c),r.appendChild(s);const d=document.createElement("div");d.id="followUpContainer",d.className="followup-container",d.style.display="none";const u=document.createElement("input");u.type="text",u.id="followUpInput",u.className="followup-input",u.placeholder="Ask a follow-up question...",d.appendChild(u),r.appendChild(d);const f=document.createElement("div");f.className="dialog-buttons";const v=document.createElement("div");v.id="btnNewConversation",v.className="jQuery-palette-button unselectable ui-button ui-corner-all ui-widget",v.tabIndex=0,v.setAttribute("role","button"),v.style.display="none",v.textContent="New Conversation",f.appendChild(v);const h=document.createElement("div");h.id="btnAsk",h.className="jQuery-palette-button unselectable ui-button ui-corner-all ui-widget",h.tabIndex=0,h.setAttribute("role","button"),h.style.display="none",h.textContent="Ask",f.appendChild(h);const C=document.createElement("div");C.id="btnCancel",C.className="jQuery-palette-button unselectable ui-button ui-corner-all ui-widget",C.tabIndex=0,C.setAttribute("role","button"),C.textContent="Close",f.appendChild(C),r.appendChild(f),t.appendChild(r),document.body.appendChild(t),this.setupDialogEvents(t)},setupDialogEvents(e){const t=document.getElementById("btnAsk"),n=u=>{u.preventDefault(),this.handleFollowUp(e)};t.addEventListener("click",n),t.addEventListener("keypress",u=>{(u.key==="Enter"||u.key===" ")&&n(u)}),document.getElementById("followUpInput").addEventListener("keypress",u=>{u.key==="Enter"&&(u.preventDefault(),this.handleFollowUp(e))});const o=document.getElementById("btnNewConversation"),a=u=>{u.preventDefault(),this.abortActiveStream(),e.remove(),this.showDialog()};o.addEventListener("click",a),o.addEventListener("keypress",u=>{(u.key==="Enter"||u.key===" ")&&a(u)});const s=document.getElementById("btnCancel"),c=u=>{u.preventDefault(),this.abortActiveStream(),e.remove()};s.addEventListener("click",c),s.addEventListener("keypress",u=>{(u.key==="Enter"||u.key===" ")&&c(u)}),e.querySelector(".dialog-overlay").addEventListener("click",()=>{this.abortActiveStream(),e.remove()})},async performExplanation(e){const t=document.getElementById("explainStatusMessage"),n=document.getElementById("explanationContainer"),r=document.getElementById("explanationText"),o=document.getElementById("followUpContainer"),a=document.getElementById("btnAsk"),s=document.getElementById("btnNewConversation"),c=document.getElementById("followUpInput");t.textContent="Analyzing your code...",t.className="status-message ai-status--info",this.abortActiveStream(),r.textContent="",this.startThinkingAnimation(r);try{const d=ExplainPromptBuilder.buildInitialPrompt(e),u=ExplainPromptBuilder.getSystemPrompt();let f="",v=null;const h=()=>{v||(v=setTimeout(()=>{v=null,r.innerHTML=ExplainPromptBuilder.formatExplanation(f)},120))};this.activeStream=AiApi.chatStream(d,u,{},{onDelta:T=>{f===""&&this.stopThinkingAnimation(),f+=T,h()}});const C=await this.activeStream.done;this.activeStream=null,this.stopThinkingAnimation(),v&&(clearTimeout(v),v=null);const A=ExplainPromptBuilder.validateExplanation(C);A.valid||console.warn("Explanation validation warnings:",A.errors),this.currentExplanation=C,this.addToHistory("assistant",C),r.innerHTML=ExplainPromptBuilder.formatExplanation(C),o.style.display="block",c.style.display="block",a.style.display="inline-block",s.style.display="inline-block",t.textContent="",t.className="status-message",c.focus()}catch(d){if(d?.name==="AbortError")return;console.error("Error explaining code:",d),t.textContent=`Error: ${d.message}`,t.className="status-message ai-status--error"}},async handleFollowUp(e){const t=document.getElementById("explainStatusMessage"),n=document.getElementById("btnAsk"),r=document.getElementById("followUpInput"),o=document.getElementById("explanationText"),a=r.value.trim();if(!a){t.textContent="Please enter a question",t.className="status-message ai-status--error";return}n.classList.add("disabled"),n.textContent="Asking...",r.disabled=!0,t.textContent="Getting answer...",t.className="status-message ai-status--info",this.abortActiveStream();try{this.addToHistory("user",a);const s=ExplainPromptBuilder.buildFollowUpPrompt(this.conversationHistory,a),c=ExplainPromptBuilder.getSystemPrompt(),d=document.createElement("div");d.className="followup-qa";const u=document.createElement("div");u.className="followup-question";const f=document.createElement("strong");f.textContent="You:",u.appendChild(f),u.appendChild(document.createTextNode(` ${a}`));const v=document.createElement("div");v.className="followup-answer";const h=document.createElement("div");h.className="followup-answer-content",h.textContent="",v.appendChild(h),d.appendChild(u),d.appendChild(v),o.appendChild(d),o.appendChild(document.createElement("hr")),o.scrollTop=o.scrollHeight;let C="",A=null;this.startThinkingAnimation(h);const T=()=>{A||(A=setTimeout(()=>{A=null,h.innerHTML=ExplainPromptBuilder.formatExplanation(C),o.scrollTop=o.scrollHeight},120))};this.activeStream=AiApi.chatStream(s,c,{},{onDelta:N=>{C===""&&this.stopThinkingAnimation(),C+=N,T()}});const j=await this.activeStream.done;this.activeStream=null,this.stopThinkingAnimation(),A&&(clearTimeout(A),A=null),this.addToHistory("assistant",j),h.innerHTML=ExplainPromptBuilder.formatExplanation(j),o.scrollTop=o.scrollHeight,r.value="",t.textContent="",t.className="status-message",r.focus()}catch(s){if(s?.name==="AbortError")return;console.error("Error asking follow-up:",s),t.textContent=`Error: ${s.message}`,t.className="status-message ai-status--error"}finally{n.classList.remove("disabled"),n.textContent="Ask",r.disabled=!1}}},FixPromptBuilder=(()=>{"use strict";const e=typeof AiPromptUtils<"u"?AiPromptUtils:null,t=(p,b,_)=>e&&e.block?e.block(p,b,_):String(b||"").trim(),n=(p,b)=>e&&e.joinBlocks?e.joinBlocks(p,b):(p||[]).filter(Boolean).join(`

`),r={url:"scripts/ai/prompts/fix_guidance_prompt.md",blockTitle:"umple_compiler_error_diagnosis_and_fix_guidance"},o=500,a=Object.create(null),s=Object.create(null);function c(){return String(a.fix||"").trim()}function d(){if(String(a.fix||"").trim())return Promise.resolve(a.fix);if(s.fix)return s.fix;const p=typeof AiPrompting<"u"&&AiPrompting.getPromptText?AiPrompting.getPromptText:null;return p?(s.fix=p(r.url).then(b=>(a.fix=b,delete s.fix,b)).catch(b=>{throw delete s.fix,b}),s.fix):Promise.reject(new Error("AiPrompting.getPromptText is not available"))}async function u(){return d()}function f(p){const b=Number.isFinite(p?.line)?p.line:"?";return[`- severity: ${p?.severity||""}`,`- line: ${b}`,`- errorCode: ${p?.errorCode||""}`,`- message: ${p?.message||""}`].join(`
`)}function v(p){return p||"(no context available)"}function h(p,b){const _=f(p),L=v(p?.context||"");return n([t("task",["Provide a short, concise description of how to fix this Umple compiler issue.","First check for simple typos (misspellings, missing punctuation, or incorrect identifiers)."]),t("compiler_issue",_),t("local_context_line_numbers_included",L),t(r.blockTitle,c()),t("umple_quick_reference",A()),t("output_contract_follow_strictly",["- Output 1-2 short sentences, plain text only.","- Do NOT output code or bullet points.","- Do NOT mention that you are an AI model.","- When referencing lines, use only: 'line N' or 'lines N-M' (N/M are numbers).","- If it looks like a typo, mention the likely typo fix first.","- Keep it actionable and specific to the error."])])}function C(){const p=typeof AiPrompting<"u"&&AiPrompting.getBaseSystemPrompt?AiPrompting.getBaseSystemPrompt():"You are an expert in Umple modeling language.";return n([t("system",p,{allowEmpty:!0}),t("directive","Give concise, actionable fix guidance."),t("output_format",["1. Examine the overall REPL correctness (such as typos or similar errors)","2. Scan the issue-related errors, where the issue represents the compiler output errors","",c()])])}function A(){return typeof AiPrompting<"u"&&AiPrompting.getUmpleCheatSheet?AiPrompting.getUmpleCheatSheet():""}function T(p){let b=String(p||"").trim();return b=b.replace(/^[\-*]\s+/g,""),b=b.replace(/```[\s\S]*?```/g,"").trim(),b=b.replace(/\s+/g," "),b}function j(p){return N(p).replace(/\bline(s)?\s+(\d+)(\s*[-]\s*(\d+))?/gi,(_,L,P)=>`<a href="javascript:Action.setCaretPosition(${P});Action.updateLineNumberDisplay();">${_}</a>`)}function N(p){return String(p||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}return{preloadGuidance(){return u()},buildGuidancePrompt(p,b){const _=h(p,b),L=C();return{prompt:_,systemPrompt:L}},getSystemPrompt(){return C()},cleanGuidanceText(p){return T(p)},formatGuidanceHtml(p){return j(p)}}})(),AiFix={activeRequest:null,issueCache:[],highlightEffect:null,highlightField:null,highlightHandler:null,checkApiConfig(){return AiConfigValidation.checkApiConfig({requireVerified:!1})},abortActiveRequest(){try{this.activeRequest?.abort?.()}catch{}finally{this.activeRequest=null}},decorateErrorOutput(e,t){if(!e)return;const n=String(t||"");if(!n.trim())return;const r=e.querySelector("#errorRow");if(!r)return;const o=AiCompilerService.parseCompilerIssuesFromErrorHtml(n);this.issueCache=o||[];const a=this.groupIssueNodes(r);a.length&&(r.innerHTML="",a.forEach((s,c)=>{const d=this.issueCache[c]||null,u=document.createElement("div");u.className="ai-fix-issue",u.dataset.issueIndex=String(c);const f=document.createElement("button");f.type="button",f.className="ai-fix-icon",f.title="AI fix guidance",f.innerHTML='<svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 10h3v-3l-3.5 -3.5a6 6 0 0 1 8 8l6 6a2 2 0 0 1 -3 3l-6 -6a6 6 0 0 1 -8 -8l3.5 3.5" /></svg>',f.addEventListener("click",C=>{C.preventDefault(),C.stopPropagation(),this.handleFixClick(u,d,n)});const v=document.createElement("div");v.className="ai-fix-issue-header";const h=document.createElement("span");h.className="ai-fix-issue-content",s.forEach(C=>h.appendChild(C)),v.appendChild(f),v.appendChild(h),u.appendChild(v),r.appendChild(u)}))},groupIssueNodes(e){const t=Array.from(e.childNodes),n=[];let r=[];return t.forEach(o=>{if(o.nodeType===1&&o.tagName.toLowerCase()==="br"){r.length&&(n.push(r),r=[]);return}o.nodeType===3&&!String(o.textContent||"").trim()||r.push(o)}),r.length&&n.push(r),n},async handleFixClick(e,t,n){if(!e)return;const r=this.checkApiConfig();if(!r.configured){typeof AiSettings<"u"&&AiSettings.showSettingsModal&&AiSettings.showSettingsModal(),alert(r.message);return}this.goToIssue(t);const o=this.ensureSubBulletContainer(e,!0),a=this.runBasicScan(Page.codeMirrorEditor6?.state.doc.toString()||"");a.issues.length>0&&(this.appendSubBullet(o,`Scan: ${a.issues.join("; ")}`),this.appendSubBullet(o,`Stats: lines ${a.stats.lines}, non-empty ${a.stats.nonEmptyLines}, chars ${a.stats.chars}`));const s=this.appendSubBullet(o,"Generating fix guidance\u2026",!0);try{this.abortActiveRequest();const c=t||{};c.context=this.getIssueContext(t),await FixPromptBuilder.preloadGuidance();const{prompt:d,systemPrompt:u}=FixPromptBuilder.buildGuidancePrompt(c,n);let f="";this.activeRequest=AiApi.chatStream(d,u,{maxTokens:500},{onDelta:A=>{f+=A,s.textContent=`- ${f}`}});const v=await this.activeRequest.done,h=FixPromptBuilder.cleanGuidanceText(v),C=FixPromptBuilder.formatGuidanceHtml(h||"No guidance produced.");s.innerHTML=`- ${C}`,s.classList.remove("ai-fix-sub-bullet-pending")}catch(c){if(c?.name==="AbortError"){s.textContent="- Stopped.";return}s.textContent=`- Error: ${c?.message||c}`,s.classList.remove("ai-fix-sub-bullet-pending")}finally{this.activeRequest=null}},ensureSubBulletContainer(e,t=!1){let n=e.querySelector(".ai-fix-sub-bullets");return n&&t&&(n.remove(),n=null),n||(n=document.createElement("div"),n.className="ai-fix-sub-bullets",e.appendChild(n),n)},appendSubBullet(e,t,n=!1){const r=document.createElement("div");return r.className="ai-fix-sub-bullet-item",n&&r.classList.add("ai-fix-sub-bullet-pending"),r.textContent=`- ${t}`,e.appendChild(r),r},runBasicScan(e){const t=[],n={lines:0,nonEmptyLines:0,chars:0},r=String(e||""),o=r.split(/\r?\n/);n.lines=o.length,n.nonEmptyLines=o.filter(v=>v.trim()).length,n.chars=r.length;const a=(r.match(/\{/g)||[]).length-(r.match(/\}/g)||[]).length,s=(r.match(/\(/g)||[]).length-(r.match(/\)/g)||[]).length,c=(r.match(/\[/g)||[]).length-(r.match(/\]/g)||[]).length;return a!==0&&t.push(`Unbalanced braces ({ vs }): ${a>0?"missing }":"missing {"}`),s!==0&&t.push(`Unbalanced parentheses (( vs )): ${s>0?"missing )":"missing ("}`),c!==0&&t.push(`Unbalanced brackets ([ vs ]): ${c>0?"missing ]":"missing ["}`),(r.match(/(?<!\\)"/g)||[]).length%2!==0&&t.push("Unclosed double quote detected"),(r.match(/(?<!\\)'/g)||[]).length%2!==0&&t.push("Unclosed single quote detected"),o.some(v=>/^\s*class\s*(\{|$)/.test(v))&&t.push("Class declaration missing a name"),{issues:t,stats:n}},goToIssue(e){if(!Page.codeMirrorEditor6||!e||!Number.isFinite(e.line))return;this.ensureHighlightExtension();const t=Page.codeMirrorEditor6,n=t.state.doc,r=Math.max(1,Math.min(e.line,n.lines)),o=n.line(r),a=[];typeof cm6<"u"&&cm6.EditorView&&cm6.EditorView.scrollIntoView&&a.push(cm6.EditorView.scrollIntoView(o.from,{y:"center"})),this.highlightEffect&&a.push(this.highlightEffect.of(o.from)),t.dispatch({selection:{anchor:o.from,head:o.to},effects:a}),t.focus()},ensureHighlightExtension(){if(this.highlightEffect||!Page.codeMirrorEditor6||typeof cm6>"u"||!cm6.StateEffect||!cm6.StateField||!cm6.Decoration||!cm6.EditorView)return;const e=cm6.StateEffect.define({map:(n,r)=>n==null?null:r.mapPos(n)}),t=cm6.StateField.define({create(){return null},update(n,r){for(const o of r.effects)o.is(e)&&(n=o.value);return n!=null&&r.docChanged&&(n=r.changes.mapPos(n)),n},provide:n=>cm6.EditorView.decorations.from(n,r=>r==null?cm6.Decoration.none:cm6.Decoration.set([cm6.Decoration.line({class:"ai-fix-highlight-line"}).range(r)]))});Page.codeMirrorEditor6.dispatch({effects:cm6.StateEffect.appendConfig.of([t])}),this.highlightEffect=e,this.highlightField=t,this.highlightHandler||(this.highlightHandler=n=>{const r=Page.codeMirrorEditor6;if(!r||!this.highlightField||!this.highlightEffect)return;const o=r.state.field(this.highlightField,!1);if(o==null)return;const a=r.posAtCoords({x:n.clientX,y:n.clientY});if(a==null)return;r.state.doc.lineAt(a).from===o&&r.dispatch({effects:this.highlightEffect.of(null)})},Page.codeMirrorEditor6.dom.addEventListener("mousedown",this.highlightHandler))},getIssueContext(e){if(!Page.codeMirrorEditor6||!e||!Number.isFinite(e.line))return"";const t=Page.codeMirrorEditor6.state.doc,n=Math.max(1,Math.min(e.line,t.lines)),r=[];for(let o=1;o<=t.lines;o++){const a=t.line(o);r.push(`${o}: ${a.text}`)}return r.join(`
`)}};var ObjectsUtil={objects:{},parentCalls:{},declare:function(e,t,n){if(!ObjectsUtil.objects[e]){this.parentCalls[e]={},ObjectsUtil.objects[e]=function(){ObjectsUtil.objects[e].prototype.constructor.apply(this,arguments)};for(var r=[],o=0;o<t.length;o++)r.push(t[o]);for(var a=[],o=0;o<r.length;o++){var s=r[o],c=ObjectsUtil.get(s);if(typeof c=="function"){var d=c.prototype,u=d.constructor;u&&a.push(u);for(var f in d)if(f!=="constructor"){var v=d[f];typeof v=="function"?(this.parentCalls[e][f]||(this.parentCalls[e][f]=[]),this.parentCalls[e][f].push(v)):ObjectsUtil.objects[e].prototype[f]=v}}}ObjectsUtil.objects[e].prototype.className=e;var h;for(var f in n)f==="constructor"?h=n[f]:ObjectsUtil.objects[e].prototype[f]=n[f];var C=this.parentCalls[e];for(var f in C)if(!ObjectsUtil.objects[e].prototype[f]){var A=C[f];A.length>0&&(ObjectsUtil.objects[e].prototype[f]=A[0])}ObjectsUtil.objects[e].prototype.constructor=function(){for(var T=0;T<a.length;T++)a[T].apply(this,arguments);h&&h.apply(this,arguments)}}},superCall:function(e,t,n){var r=this.parentCalls[r.className];if(r)for(var o=0;o<r.length;o++)r[o].call(e,n)},define:function(e,t){if(!ObjectsUtil.objects[e])return ObjectsUtil.objects[e]=t,t},get:function(e){return ObjectsUtil.objects[e]},newInstance:function(e,t){var n=new ObjectsUtil.objects[e](t);if(typeof t!="string")for(var r in t)n[r]||(n[r]=t[r]);return n},isArray:function(e){return e&&e instanceof Array}};(function(){var e=ObjectsUtil.get("util.core.CoreUtil");ObjectsUtil.declare("util.core.Map",[],{values:null,keys:null,constructor:function(){this.values=[],this.keys=[]},put:function(t,n){var r=this.keys.indexOf(t);r===-1?(this.values.push(n),this.keys.push(t)):this.values[r]=n},get:function(t){return this.values[this.keys.indexOf(t)]},remove:function(t){var n=this.keys.indexOf(t);n<0||(this.values.splice(n,1),this.keys.splice(n,1))},clear:function(){this.values=[],this.keys=[]}})})(),(function(){var e=ObjectsUtil.newInstance("util.core.Map"),t=[];ObjectsUtil.define("util.core.Events",{topics:{},suspend:null,connect:function(n,r,o,a){var s=this,c,d;if(r.addEventListener)c=function(){a.apply(o,arguments)},r.addEventListener(n,c,!1),d=function(){r.removeEventListener(n,c,!1)};else{var u=e.get(r);if(u||(u=[],e.put(r,u)),!u[n]){u[n]={bridged:r[n],connects:[]};var s=this;r[n]=function(){if(u[n].bridged.apply(r,arguments),!s.suspend)for(var h=u[n].connects,C=0,A;A=h[C];C++)A.callback.apply(A.context,arguments)}}u[n].connects.push({callback:a,context:o}),c=a}var f={callback:c,disconnector:d,type:n,object:r,context:o};return t.push(f),f},disconnectAll:function(){for(;t.length>0;)this.disconnect(t[0],e);this.topics={}},disconnect:function(n,r){if(n){if(n.object.removeEventListener)n.disconnector();else{var o=e.get(n.object);if(!o)return;var a=o[n.type];if(!a||(a=a.connects,!a))return;for(var s=0,c;c=a[s];s++)c.callback===n.callback&&(a.splice(a.indexOf(c),1),s=0)}var d=t.indexOf(n);d>-1&&t.splice(d,1)}},subscribe:function(n,r,o){this.topics[n]||(this.topics[n]=[]);var a={handler:r,context:o};return this.topics[n].push(a),a},unsubscribe:function(n,r){if(this.topics[n]){var o=this.topics[n].indexof(r);o>-1&&this.topics[n].splice(o,1)}},publish:function(n){var r=this.topics[n];if(r)for(var o=0,a;a=r[o];o++){var s=Array.prototype.slice.call(arguments,1);a.handler.apply(a.context||this,s)}}})})(),(function(){ObjectsUtil.define("util.core.UUIDGenerator",{generate:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e==="x"?t:t&3|8;return n.toString(16)})}})})(),(function(){ObjectsUtil.define("util.svg.SVGUtil",{SVG:"http://www.w3.org/2000/svg",syncLineBetweenVertices:function(e,t,n){var r=t.getRootNode(),o=parseFloat(r.getAttribute("height")),a=t.focalNode,s=n.focalNode,c=parseFloat(a.getAttribute("x")),d=parseFloat(a.getAttribute("y")),u=parseFloat(a.getAttribute("height")),f=parseFloat(a.getAttribute("width")),v=parseFloat(s.getAttribute("x")),h=parseFloat(s.getAttribute("y")),C=parseFloat(s.getAttribute("height")),A=parseFloat(s.getAttribute("width")),T=c+f/2,j=d+u/2,N={y:j,x:T},p={y:h,x:v+A/2,getRange:function(I,F){var V=v/o,D=A/2*V,m=v+A/2;return Math.abs(I-m)<2?m:I<v+A/2?m-D:I>v+A/2?m+D:m}},b={y:h+C,x:v+A/2,getRange:function(I,F){var V=v/o,D=A/2*V,m=v+A/2;return Math.abs(I-m)<2?m:I<v+A/2?m-D:I>v+A/2?m+D:m}},_={y:h+C/2,x:v,getRange:function(I,F){var V=h/o,D=C/2*V,m=h+C/2;return Math.abs(F-m)<2?m:F<h+C/2?m-D:F>h+C/2?m+D:m}},L={y:h+C/2,x:v+A,getRange:function(I,F){var V=h/o,D=C/2*V,m=h+C/2;return Math.abs(F-m)<2?m:F<h+C/2?m-D:F>h+C/2?m+D:m}},P=function(I,F){return Math.abs(I.x-F.x)+Math.abs(I.y-F.y)},S=P(N,p),k=P(N,b),O=P(N,_),R=P(N,L);S<k&&S<O&&S<R?e.setAttribute("d","M"+T+","+j+" L"+p.getRange(T,j)+" "+p.y):k<S&&k<O&&k<R?e.setAttribute("d","M"+T+","+j+" L"+b.getRange(T,j)+" "+b.y):O<S&&O<k&&O<R?e.setAttribute("d","M"+T+","+j+" L"+_.x+" "+_.getRange(T,j)):R<S&&R<k&&R<O&&e.setAttribute("d","M"+T+","+j+" L"+L.x+" "+L.getRange(T,j)),t.parentNode.refreshChild(e)},syncVertixLines:function(e){for(var t=ObjectsUtil.get("util.svg.SVGUtil"),n=e.getChildren("connector"),r=0;o=n[r];r++){var o=n[r];t.syncLineBetweenVertices(o.focalNode,o.source,o.target)}},getConnector:function(e,t){for(var n=e.getChildren("connector"),r=0;r<n.length;r++){var o=n[r];if(o.target===e){if(o.source===t)return o}else if(o.source===e&&o.target===t)return o}return null}})})(),(function(){var e=ObjectsUtil.get("util.svg.SVGUtil"),t={},n={};ObjectsUtil.define("layout.shapes.ShapesRegistry",{register:function(r,o){t[r]=o},draw:function(r,o,a){var s=ObjectsUtil.newInstance(t[r],o,a);return n[r]||(n[r]={}),n[r][s.id||s.guid]=s,s.draw(o,a),s},get:function(r,o){return o?n[r][o]:n[r]},getAndGroup:function(r,o){var a=this.get(r,o),s={};for(var c in a){var d=a[c];if(d){var u=d.parent;u&&(s[u]||(s[u]={}),s[u][c]=d)}}return s},destroy:function(r){n[r.guid].destroy(),n[r.guid]=void 0},empty:function(){n={}},showMessage:function(r,o){var a=document.getElementById(r);if(a){ObjectsUtil.get("util.core.Events").disconnectAll(),ObjectsUtil.get("layout.shapes.ShapesRegistry").empty(),ObjectsUtil.get("util.core.DomUtil").empty(a);var s=ObjectsUtil.get("util.svg.SVGUtil"),c=a.descriptionMessage||document.createElementNS(s.SVG,"text");c.setAttribute("x",20),c.setAttribute("y",20),c.setAttribute("style","fill: #000000;  font-family:tahoma; font-size: 16;  font-weight:bold"),c.appendChild(document.createTextNode(o)),a.appendChild(c);var d=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(o,c);a.style.width=d.w+120+"px",a.style.height=d.h+5+"px",a.style.border="none",a.descriptionMessage=c}},paint:function(r,o){o&&r.args.container&&(ObjectsUtil.get("util.core.Events").disconnectAll(),ObjectsUtil.get("layout.shapes.ShapesRegistry").empty(),ObjectsUtil.get("util.core.DomUtil").empty(r.args.container)),this._paint(r)},_paint:function(r,o,a){o&&(r.args.parentNode=o),a&&(r.args.container=a),r.args.id||(r.args.id=r.args.name);var s=ShapesRegistry.draw(r.descriptor,r.args,r);return s}})})(),(function(){var e=ObjectsUtil.get("util.svg.SVGUtil"),t=ObjectsUtil.get("layout.shapes.ShapesRegistry"),n=40,r=1e5,o=5e-4;o=5e-4,ObjectsUtil.declare("layout.routers.AutomaticRouter",[],{forcex:null,forcey:null,_layoutInterval:null,graph:null,constructor:function(a){this.graph=a,this.forcex={},this.forcey={}},layout:function(){var a=this;a._doLayout(),this._layoutInterval=setInterval(function(){a._doLayout()},100)},_doLayout:function(){for(var a=this.graph.getChildren("rectangle"),s=0;vertix1=a[s];s++){var c=vertix1.name;this.forcex[c]=0,this.forcey[c]=0;for(var d=0;vertix2=a[d];d++){var u=vertix2.name;if(c!==u){var f=parseFloat(vertix2.getAttribute("x"))-parseFloat(vertix1.getAttribute("x")),v=parseFloat(vertix2.getAttribute("y"))-parseFloat(vertix1.getAttribute("y")),h=Math.pow(f,2)+Math.pow(v,2);if(this.forcex[c]-=r/h*f,this.forcey[c]-=r/h*v,e.getConnector(vertix1,vertix2)){var C=Math.sqrt(h);this.forcex[c]+=(C-n)*f,this.forcey[c]+=(C-n)*v}}}}for(var A=0,s=0;vertix1=a[s];s++){var c=vertix1.name,T=this.forcex[c]*o,j=this.forcey[c]*o;A=A+Math.abs(T)+Math.abs(j),vertix1.setPosition({x:parseFloat(vertix1.getAttribute("x"))+T,y:parseFloat(vertix1.getAttribute("y"))+j})}Math.round(A)<40&&clearInterval(this._layoutInterval)}})})(),(function(){var e=ObjectsUtil.get("util.svg.SVGUtil"),t=ObjectsUtil.get("layout.shapes.ShapesRegistry"),n=40,r=1e5,o=5e-4;o=5e-4,ObjectsUtil.declare("layout.routers.HorizontalTreeRouter",[],{forcex:null,forcey:null,graph:null,constructor:function(a){this.graph=a,this.forcex={},this.forcey={}},layout:function(){var a=this;a._doLayout()},_doLayout:function(){var a=[],s=function(S,k){for(var O=[],R=S.getChildren("connector"),I=0;I<R.length;I++){var F=R[I];if(F.source===S){var V=F.target;if(k&&a.indexOf(V)>-1)continue;O.push(F.target)}else if(F.target===S){var D=F.source;if(k&&a.indexOf(D)>-1)continue;O.push(F.source)}}return O},c=function(S){var k=S.getChildren("connector");if(k.length<1)return 1;for(var O=0,R=0;subChild=k[R];R++)O=O+c(subChild);return O},d=function(S){var k=S.getChildren("connector");if(k.length<1)return 1;for(var O=0,R=0;subChild=k[R];R++){var I;if(subChild.source===S?I=subChild.target:subChild.target===S&&(I=subChild.source),!!I){var F=parseFloat(I.getAttribute("width"));F>O&&(O=F)}}return O},u=function(S,k){k||(k=[]);var O=s(S);if(O.length===1)return 1;for(var R=0,I=0;I<O.length;I++){var F=O[I];k.indexOf(F)>-1||(k.push(O[I]),R=R+u(O[I],k))}return R},f=this.graph.getChildren("rectangle"),v=f;v.sort(function(S,k){return c(k)-c(S)});for(var h=40,C=30,A={x:0,y:0},T=function(S,k,O,R){if(!(a.indexOf(S)>-1)){a.push(S);var I=c(S,!0);R&&I--,S.setPosition({x:k,y:O}),O>A.y&&(A.y=O),k>A.x&&(A.x=k);for(var F=s(S,!0),V=F.length,D=I*h,m=O-D/2,M=0,U=0;U<V;U++){var z=F[U],q=c(z)-1,ee=m;U&&(ee=ee+h),q||(q=1);var W=ee+q*h,Y=(ee+W)/2,ne=k+C+parseFloat(S.getAttribute("width"));z.setPosition({x:ne,y:Y}),Y>A.y&&(A.y=Y),ne>A.x&&(A.x=ne),m=W-h,M=M+(q||1),a.push(z);var X=s(z,!0),se=ne+parseFloat(z.getAttribute("width"))+C;if(X.length===1)T(X[0],se,Y,!0);else if(X.length>=2)for(var fe=ee+h/2,pe=(W-fe)/X.length+h/X.length,me=0;me<X.length;me++)T(X[me],se,fe+pe*me,!0)}}},j=0;j<v.length;j++){var N=v[j];if(!(a.indexOf(N)>-1)){var p=u(N),b=a.length===0?p*h/4:A.y+h;T(N,C,b)}}if(!this.graph.height){var _=parseFloat(this.graph.getAttribute("height")),L=A.y+h;L>_&&this.graph.setAttribute("height",parseFloat(L))}if(!this.graph.width){var P=parseFloat(this.graph.getAttribute("width")),L=A.x+100;L>P&&this.graph.setAttribute("width",parseFloat(L))}for(var j=0;j<a.length;j++){var N=a[j];N.parentNode.refreshChild(N.focalNode),e.syncVertixLines(N)}}})})(),(function(){var e=0,t=ObjectsUtil.get("util.core.Events");ObjectsUtil.declare("layout.shapes.AbstractNode",[],{focalNode:null,guid:null,children:null,type:null,parentNode:null,incremntal:null,_incomplete:null,constructor:function(n){this.children=[],this.id=n.id,this.parentNode=n.parentNode,this.incremntal++},getChildren:function(n){return this.children[n||""]||[]},getPosition:function(){return{x:0,y:0,h:0,w:0}},setPosition:function(n,r){},shiftPosition:function(n,r){var o=this.getPosition();for(var a in n)o[a]=(o[a]||0)+n[a];this.setPosition(o,r)},getSuperContainer:function(){for(var n=this.container;;){var r=n.container;if(r&&r.className)n=r;else break}return n},addChild:function(n){this.removeChild(n);var r=n.type||"";this.children[r]||(this.children[r]=[]),this.children[r].push(n)},removeChild:function(n){var r=n.type||"";if(this.children[r]&&this.children[r]){var o=this.children[r].indexOf(n);o!=-1&&this.children[r].splice(o,1)}},appendChild:function(n){this.focalNode.appendChild(n)},refreshChild:function(n){n.parentNode===this.focalNode&&(this.focalNode.removeChild(n),this.insertBefore(n,this.focalNode.firstChild))},insertBefore:function(n,r){r?this.focalNode.insertBefore(n,r):this.appendChild(n)},draw:function(n){},getAttribute:function(n){return this.focalNode.getAttribute(n)},setAttribute:function(n,r){this.focalNode.setAttribute(n,r)},getRootNode:function(){var n=this.parentNode.focalNode;if(n.tagName==="svg")return n;for(var r=n.parentNode;r;)if(r=r.parentNode,r&&r.tagName==="svg")return r;return n},handleMove:function(n,r){},destroy:function(){}})})(),(function(){var e=ObjectsUtil.get("util.svg.SVGUtil"),t=ObjectsUtil.get("util.core.Events"),n=ObjectsUtil.get("util.core.UUIDGenerator"),r=0,o="#222",a="#fff",s="10px";ObjectsUtil.declare("layout.shapes.RectangleNode",["layout.shapes.AbstractNode"],{focalNode:null,guid:null,name:null,color:null,fontColor:null,rx:null,parentNode:null,strokeWidth:null,_moving:null,type:null,constructor:function(c){this.type="rectangle",this.name=c.name||"Node"+r,this.guid=c.id||this.name,this.color=c.color||o,this.fontColor=c.fontColor||a,this.rx=c.rx||s,this.strokeWidth=c.strokeWidth||1,this.strokeWidth=this.strokeWidth+"px",r++},draw:function(c){var d=parseInt(this.parentNode.getAttribute("width")),u=parseInt(this.parentNode.getAttribute("height"));this.focalNode=document.createElementNS(e.SVG,"rect"),this.focalNode.setAttribute("style","fill: "+this.color+"; stroke-width: "+this.strokeWidth+";"),this.focalNode.setAttribute("rx",this.rx),this.parentNode.appendChild(this.focalNode),this.focalNode.name=this.name,this.focalNode.textLabel=document.createElementNS(e.SVG,"text"),this.focalNode.textLabel.setAttribute("style","fill: "+this.fontColor+"; stroke-width: 1px;"),this.focalNode.textLabel.appendChild(document.createTextNode(this.name)),this.parentNode.appendChild(this.focalNode.textLabel),this.focalNode.h=this.focalNode.textLabel.getBBox().height+10,this.focalNode.w=this.focalNode.textLabel.getBBox().width+10,this.focalNode.setAttribute("height",this.focalNode.h+"px"),this.focalNode.setAttribute("width",this.focalNode.w+"px");var f=t.connect("mousedown",this.focalNode,this,function(C){this.handleMove(this.focalNode,C)}),f=t.connect("mousedown",this.focalNode.textLabel,this,function(C){this.handleMove(this.focalNode,C)}),v=Math.random()*(d*.8)+d*.1,h=Math.random()*(u*.8)+u*.1;this.setPosition({x:v,y:h})},setPosition:function(c){var d=parseFloat(c.x),u=parseFloat(c.y);this.focalNode.setAttribute("x",d),this.focalNode.setAttribute("y",u),this.focalNode.textLabel.setAttribute("x",d+5+"px"),this.focalNode.textLabel.setAttribute("y",u+2*this.focalNode.h/3+"px"),e.syncVertixLines(this)},handleMove:function(c,d){var u=c.parentNode.getScreenCTM(),f=c.parentNode.createSVGPoint();f.x=d.clientX,f.y=d.clientY,f=f.matrixTransform(u.inverse());var v=parseFloat(f.x)-parseFloat(c.getAttribute("x")),h=parseFloat(f.y)-parseFloat(c.getAttribute("y")),C=this.getChildren("rectangle");this._moving=c;var A=t.connect("mousemove",document,this,function(j){var N=c.parentNode.getScreenCTM(),p=c.parentNode.createSVGPoint();p.x=j.clientX,p.y=j.clientY,p=p.matrixTransform(N.inverse()),this.setPosition({x:p.x-v,y:p.y-h}),this.parentNode.updateArrowMarker()}),T=t.connect("mouseup",document,this,function(){t.disconnect(A),t.disconnect(T),this.parentNode.updateArrowMarker()})}})})(),(function(){var e=ObjectsUtil.get("layout.shapes.ShapesRegistry"),t=ObjectsUtil.get("util.svg.SVGUtil"),n="1px",r="#444",o=0;ObjectsUtil.declare("layout.shapes.Connector",["layout.shapes.AbstractNode"],{focalNode:null,source:null,target:null,name:null,color:null,rx:null,strokeWidth:null,type:null,constructor:function(a){this.type="connector",this.setSource(a.source),this.setTarget(a.target),this.name=a.name||"Connector"+o,this.guid=a.id||this.source.guid+"_"+this.target.guid+"_"+o,this.strokeWidth=a.strokeWidth||n,this.color=a.color||r,o++},setSource:function(a){var s=e.get("RectangleNode",a);this.source=s,s.addChild(this)},setTarget:function(a){var s=e.get("RectangleNode",a);this.target=s,s.addChild(this)},draw:function(a){return this.focalNode=document.createElementNS(t.SVG,"path"),this.focalNode.setAttribute("style","stroke: "+this.color+"; stroke-width:"+this.strokeWidth+";"),this.parentNode.insertBefore(this.focalNode,this.parentNode.firstChild),this.focalNode.setAttribute("marker-end","url(#Triangle)"),this.focalNode}})})();var ShapesRegistry=ObjectsUtil.get("layout.shapes.ShapesRegistry");(function(){ShapesRegistry.register("Connector","layout.shapes.Connector"),ShapesRegistry.register("RectangleNode","layout.shapes.RectangleNode"),ShapesRegistry.register("Graph","layout.shape.Graph")})(),(function(){var e=ObjectsUtil.get("layout.routers.HorizontalTreeRouter"),t=ObjectsUtil.get("util.core.Events"),n=ObjectsUtil.get("util.svg.SVGUtil"),r=ObjectsUtil.get("layout.shapes.ShapesRegistry");ObjectsUtil.declare("layout.shape.Graph",["layout.shapes.AbstractNode"],{routingObject:null,height:null,width:null,_layoutInterval:null,_moving:null,_defs:null,constructor:function(o){this.height=o.height,this.width=o.width;var a=o.container,s=o.router;this.router=s||new e(this),this.focalNode=document.getElementById(a),this.updateArrowMarker()},draw:function(o,a){},_paint:function(o){o.args.parentNode=this,o.args.id||(o.args.id=o.args.name),o.args.container=this;var a=r.draw(o.descriptor,o.args,o);return a},updateArrowMarker:function(){if(this._defs)this.focalNode.removeChild(this._defs);else{this._defs=document.createElementNS(n.SVG,"defs");var o=document.createElementNS(n.SVG,"marker");o.setAttribute("id","Triangle"),o.setAttribute("viewBox","0 0 20 20"),o.setAttribute("refX","20"),o.setAttribute("refY","10"),o.setAttribute("markerUnits","strokeWidth"),o.setAttribute("markerWidth","8"),o.setAttribute("markerHeight","6"),o.setAttribute("orient","auto");var a=document.createElementNS(n.SVG,"path");o.appendChild(a),a.setAttribute("d","M 0 0 L 20 10 L 0 20 z"),this._defs.appendChild(o)}this.focalNode.appendChild(this._defs)},addRectNode:function(o){o.parentNode=this;var a=r.draw("RectangleNode",o);this.addChild(a)},drawConnector:function(o){o.parentNode=this;var a=r.draw("Connector",o);this.addChild(a)},layout:function(){this.router.layout()}})})(),(function(){var e=ObjectsUtil.define("util.core.DomUtil",{empty:function(t){if(t.tagName||(t=document.getElementById(t)),!!t){if(t.canHaveChildren)try{t.innerHTML="";return}catch{}for(var n;n=t.lastChild;)this._empty(n,t)}},_empty:function(t,n){t.firstChild&&this.empty(t),n&&(n.removeChild(t),t.removeNode&&t.removeNode(!1))},calculateTextSize:function(t,n){var r=document.createElement("span");r.innerHTML=t,r.style.visibility="hidden";var s=this.position(r);if(typeof n=="object"&&!n.parentNode)for(var o in n)r.style[o]=n[o];else r.style.fontSize=window.getComputedStyle(n,null).getPropertyValue("font-size"),r.style.fontFamily=window.getComputedStyle(n,null).getPropertyValue("font-family"),r.style.fontWeight=window.getComputedStyle(n,null).getPropertyValue("font-weight");var a=document.body;a.appendChild(r);var s=this.position(r);return a.removeChild(r),s},position:function(t,n){var r=ObjectsUtil.get("util.core.CoreUtil");t=this.nodeById(t);var o=this.getFirstParent(t,"body"),a=t.getBoundingClientRect();if(a={x:a.left,y:a.top,w:a.right-a.left,h:a.bottom-a.top},n){var s=this.scrollValue(t);a.x+=s.x,a.y+=s.y}return a},transformValue:function(t){var n=t.getAttribute("transform");if(!n)return{x:0,y:0};n=n.substring(10,n.length-1);var r=n.split(",");return r.length<2&&(r=n.split(" ")),{x:parseFloat(r[0]),y:parseFloat(r[1])}},scrollValue:function(t){for(var n=function(u,f){var v,h=window["page"+u+"Offset"];if(typeof h=="number")v=h;else{var C="scroll"+f;document.body&&document.body[C]?v=document.body[C]:document.documentElement&&document.documentElement[C]&&(v=document.documentElement[C])}return v},r=function(){return n("Y","Top")},o=function(){return n("X","Left")},a=0,s=0,c={x:o(),y:r()},d=t;d;){if(d!==document.body&&d!==document.documentElement){if(d.scrollTop>0){c.y=c.y+d.scrollTop;break}if(d.scrollLeft>0){c.x=c.x+d.scrollLeft;break}}d=d.parentNode}return c},nodeById:function(t,n){var r=ObjectsUtil.get("util.core.CoreUtil");return r.checkBrowser("ie")?(this.nodeById=function(o,a){return typeof o!="string"?o:(a||document).getElementById(o)},this.nodeById(t,n)):(this.nodeById=function(o,a){if(typeof o!="string")return o;n||(n=document);var s=n.getElementById(o);if(s.id==o||s.attributes&&s.attributes.id&&s.attributes.id.value==o)return s;var c=n.all[o];if(c){r.isArray(c)||(c=[c]);for(var d=0,u;u=c[d];d++)if(u.id==o||u.attributes&&u.attributes.id&&u.attributes.id.value==o)return u}},this.nodeById(t,n))},transformPoint:function(t,n){var r=ObjectsUtil.get("util.core.DomUtil").getFirstParent(t,"svg"),o=r.getScreenCTM(),a=r.createSVGPoint();a.x=n.x,a.y=n.y,a=a.matrixTransform(o.inverse()),n.x=a.x,n.y=a.y},getFirstParent:function(t,n){if(!(!t||!n)){if(n=n.toUpperCase(),t.tagName.toUpperCase()===n)return t;for(var r=t.parentNode,o;r;){if(r.tagName&&r.tagName.toUpperCase()===n.toUpperCase()){o=r;break}r=r.parentNode}return o}}})})(),(function(){var e=ObjectsUtil.define("util.core.CoreUtil",{store:{},toString:{}.toString,_browserSettings:null,clone:function(t){var n={};for(var r in t)n[r]=t[r];return n},stopEvent:function(t){t.cancelBubble=!0,t.preventDefault(),t.stopPropagation()},checkBrowser:function(t){var n=this.store[t];return n!==void 0||(n=navigator.userAgent.search(t),this.store[t]=n),n},browserSettings:function(){if(this._browserSettings)return this._browserSettings;var t=navigator.userAgent,n,r=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];if(/trident/i.test(r[1]))return n=/\brv[ :]+(\d+(\.\d+)?)/g.exec(t)||[],this._browserSettings={browser:"ie",version:n[1]||""},this._browserSettings;r=r[2]?[r[1],r[2]]:[navigator.appName,navigator.appVersion,"-?"],(n=t.match(/version\/([\.\d]+)/i))!=null&&(r[2]=n[1]),this._browserSettings={browser:r[0].toLowerCase(),version:r[1]||""}},version:function(t){var n=this.browserSettings();return n.browser===t?parseFloat(n.version):0},isFunction:function(t){return this._is(t,"[object Function]")},isString:function(t){return this._is(t,"[object String]")},isArray:function(t){return this._is(t,"[object Array]")},_is:function(t,n){return this.toString.call(t)===n}})})(),(function(){var SVGUtil=ObjectsUtil.get("util.svg.SVGUtil"),Events=ObjectsUtil.get("util.core.Events"),UUIDGenerator=ObjectsUtil.get("util.core.UUIDGenerator"),incremntal=0,DEFAULT_COLOR="rgb(255,255,255)",DEFAULT_FONT_COLOR="#fff",DEFAULT_ROUND_RATIO="10px",ShapesRegistry=ObjectsUtil.get("layout.shapes.ShapesRegistry");ShapesRegistry.register("StrucutreDiagram","layout.shapes.StrucutreDiagram"),ShapesRegistry.register("Part","layout.shapes.Part"),ShapesRegistry.register("Port","layout.shapes.Port"),ShapesRegistry.register("PartIcon","layout.shapes.PartIcon"),ShapesRegistry.register("PortConnector","layout.shapes.PortConnector"),ObjectsUtil.declare("layout.shapes.StructureDiagramNode",["layout.shapes.AbstractNode"],{_moveHandle:null,constructor:function(e){this._moveHandle=Events.subscribe("structure.diagram.node.move."+this.id,function(t){var n=this,r=[],o=function(a){if(!(r.indexOf(a)>-1)){r.push(a);var s=a.getPrecisePosition?a.getPrecisePosition():a.getPosition();n.parentNode.layoutInformation||(n.parentNode.layoutInformation={});var c={x:s.x,y:s.y,h:s.h,w:s.w};n.parentNode.layoutInformation[a.id]=c;for(var d=a.getChildren(),u=0,f;f=d[u];u++)o(f)}};o(this)},this)},destroy:function(){Events.unsubsribe(this._moveHandle)}});var StructureDiagramUtil=ObjectsUtil.define("layout.shapes.diagram.structure..StructureDiagramUtil",{portToPart:function(e,t,n){var r=ObjectsUtil.get("util.core.CoreUtil"),o=r.isString(e)?ShapesRegistry.get("Port",e):e,a=n||o.container,s=a.getPosition(),c=o.getPosition(),d=parseInt(Math.abs(c.x-(s.x+s.w)+c.w)),u=parseInt(Math.abs(c.x-s.x+c.w)),f=parseInt(Math.abs(c.y-(s.y-c.h))),v=parseInt(Math.abs(c.y-(s.y+s.h)+c.h)),h=function(A,T,j,N){var p=function(b,_){return b<5&&_<5};e.isPrivate&&(j==="right"?(j="left",T=T+2):j==="left"?(j="right",T=T+2,A=A+2):j==="top"?(j="bottom",T=T+(N.h/2+2)):j==="bottom"?(j="top",T=T-(N.h/2+2)):j="right"),t(A,T,j,N,p(v,u)||p(f,u)||p(v,d)||p(f,d),{deltaRight:d,deltaLeft:u,deltaTop:f,deltaBottom:v})},C;if(d<u&&d<=f&&d<=v)return s.y-c.h>c.y?h(c.x+(c.w/2-2),c.y,"top",c):c.y>s.y+s.h+document.body.scrollTop-c.h?h(c.x+(c.w/2-2),c.y+(c.h/2+4),"bottom",c):h(c.x+(c.w-2),c.y+c.h/2,"right",c);if(u<d&&u<=f&&u<=v)return s.y-c.h>c.y?h(c.x+(c.w/2-2),c.y,"top",c):c.y>s.y+s.h+document.body.scrollTop-c.h?h(c.x+(c.w/2-2),c.y+(c.h/2+4),"bottom",c):h(c.x+(c.w-2),c.y+c.h/2,"left",c);if(f<d&&f<u&&f<v)return h(c.x+(c.w/2-2),c.y,"top",c);if(v<d&&v<u&&v<f)return h(c.x+(c.w/2-2),c.y+(c.h/2+4),"bottom",c)}});ObjectsUtil.declare("layout.shapes.StrucutreDiagram",["layout.shape.Graph"],{layoutInformation:null,settings:null,constructor:function(e){this.layoutInformation=e.layout},draw:function(e,t){this.focalNode.style.width="100%",this.focalNode.style.height="3600px",this._incomplete=!0,this.settings=t.args.settings||{};var n=t.args.layout;this.height&&this.setAttribute("height",this.height),this.width&&this.setAttribute("width",this.width);var r=e.nodes;if(r){for(var o={"":{}},a=function(ue){var ae=o[ue||""];return ae||(o[ue]={},o[ue])},s=[],c=function(ue){var ae=ue.args,ge=ae.id||ae.name;if(ge){ue.children={};var Pe=a(ae.parent)[ae.id||ae.name||new Date().getTime()]=ue}else s.indexOf(ue)===-1&&s.push(ue)},d=0,u;u=r[d];d++)c(u);var f=function(ue,ae){for(var ge in ue){if(ge===ae)return ue[ae];var Pe=f(ue[ge].children,ae);if(Pe)return Pe}},v=[],h=function(ue){for(var ae in ue)if(ae){var ge=ue[ae],Pe=f(o[""],ae);if(Pe){var de=v.indexOf(ae);de>-1&&v.splice(de,1);var Te=o[ae];for(var Me in Te)Pe.children[Me]=Te[Me];delete o[ae]}else{var de=v.indexOf(ae);de===-1&&v.push(ae)}for(var Me in ge)h(ge[Me].children)}};for(h(o);v.length>0;)h(o);var C=ObjectsUtil.get("util.core.CoreUtil"),A=o[""],T=[],j=function(ue){for(var ae in ue){var ge=ue[ae];T.indexOf(ge)>-1||(ge.descriptor==="Part"&&!A[ae]&&(A[ae]=C.clone(ge),T.push(A[ae])),j(ge.children))}};j(A);var N={},N=function(ue){for(var ae in ue)if(!N[ae]){N[ae]=ae;var ge=ue[ae];N(ge);var Pe=ge.children;for(var de in Pe){var Te=ue[de];if(Te){N(Te);e:{for(var Me in A[de].children){ge.children[de].children=A[de].children;break e}for(var Me in ge.children[de].children){A[de].children=ge.children[de].children;break e}}}}}};N(A);var p=function(ue,ae,ge,Pe){var de=C.clone(ue,ae,ge);if(de.parent=ge.id,de.parentNode=ae,de.id||(de.id=de.name),Pe&&(de.id=Pe+"_"+de.id),n){var Te=n[de.id];Te&&(de.x=Te.x,de.y=Te.y,de.h=Te.h,de.w=Te.w,de.hasLayoutInformation=!0)}return de.container=ge,de},b=20,_=20,L=30,P=30,S=_,k=b+L,O=!0;for(var R in A){var I=A[R],e=p(I.args,this,this);!e.x||!e.y?(O||(S=S+_+20),e.x=k,e.y=S,O=!0):O=!1,I.descriptor==="Part"&&(e.isStructureDiagram=!0);var F=ShapesRegistry.draw(I.descriptor,e),V=I.children,D=!1,m=!1,v=[];for(var M in V){var U=V[M],z=p(U.args,this,F,R),q=ShapesRegistry.draw(U.descriptor,z);if(q._incomplete=!0,z.hasLayoutInformation?m=!1:(F.addChild(q),m=!0),U.descriptor==="Part"||U.descriptor==="Port"&&(U.args.isPrivate==="true"||U.args.isPrivate===!0)){D||(k=k+b+L,S=S+_+20,D=!0);var ee=U.children;for(var W in ee){var Y=ee[W];if(Y.descriptor==="Port"){var ne=p(Y.args,this,q,R),X=ShapesRegistry.draw(Y.descriptor,ne);ne.hasLayoutInformation?v.push(X):q.addChild(X)}}var se=q.getPosition();if(se.x+k>650){var B=F.getPosition(),J=B.y+B.h-20;S=J+P,k=b+L+b+L}O&&q.shiftPosition({x:k,y:S}),delete q._incomplete;for(var fe=0,pe;pe=v[fe];fe++)q.addChild(pe);v=[],se=q.getPosition();var B=F.getPosition(),me=se.x+se.w,Q=B.x+B.w-40,ye=se.y+se.h,J=B.y+B.h-20,be=me-Q,Ee=ye-J;if(Ee>0||be>0){var Se={};be>0&&(Se.w=be),Ee>0&&(Se.h=Ee),F.shiftPosition(Se)}k=k+se.w+b+b+b+b}v=[],m||F.addChild(q),delete q._incomplete}var B=F.getPosition(),Q=B.x+B.h-40,B=F.getPosition(),J=B.y+B.h-20;S=_+J+P,k=b+L,this.addChild(F)}for(var R in A)for(var te=ShapesRegistry.get("Part",R),G=0,Z;Z=s[G];G++){var e=Z.args,re=e.sources[0],ie=e.targets[0],ce=R+"_"+re;if(ShapesRegistry.get("Port",ce)){var ve=R+"_"+ie;if(ShapesRegistry.get("Port",ve)){var he=C.clone(e);he.sources=[ce],he.part=R,he.targets=[ve],he.parentNode=this,he.container=te,ShapesRegistry.draw(Z.descriptor,he)}}}var Le=ObjectsUtil.get("util.core.DomUtil").position(this.focalNode,!0);this.focalNode.style.height=J+20+"px",this._incomplete=!1,this.refreshBoundaries();var Ae=ShapesRegistry.get("Part"),we=ShapesRegistry.getAndGroup("Part");this.adjustShapes(n||{},we,Ae)}},adjustShapes:function(e,t,n,r){var o=[];for(var a in n){var s=n[a],c=s.getPosition(),d=this._adjustShapes(n[a],e,o,r);if(d&&(d=d-5,s.shiftPosition({x:-(r?d-r:d)})),t){var u=t[s.name];for(var f in u){var v=u[f],h=v.getPosition();for(var C in u)if(C!==f){var A=u[C],T=A.getPosition();if(!(T.x>h.x||Math.abs(T.y-h.y)>50)){for(var j=T.x+T.w,N=0,p;p=A.children[N];N++)if(p.className==="layout.shapes.Port"){var b=parseFloat(p.labelNode.getAttribute("x")),_=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(p.labelNode.childNodes[0].textContent+"...",p.labelNode).w,L=b+_;L>j&&(j=L)}var P=this._adjustShapes(v,e,[],j);P!=h.x&&(P=j-P,v.shiftPosition({x:P}))}}}}}},_adjustShapes:function(e,t,n,r,o){if(!(t[e.id]||n.indexOf(e)>-1)){n.push(e);for(var a=e.getPosition(),s=r||0,c=0,d;d=e.children[c];c++)if(d.className==="layout.shapes.Port"){var u=parseFloat(d.labelNode.getAttribute("x"));u<s&&(s=u)}else if(d.className==="layout.shapes.Part"){var f=this._adjustShapes(d,t,n);if(f<s){var v=d.getPosition();v.x=v.x-f,d.setPosition(v)}}return s}},refreshBoundaries:function(){for(var e=ObjectsUtil.get("util.core.DomUtil").position(this.focalNode,!0),t=e.y+e.h,n=e.x+e.w,r=this.getChildren("partNode"),o=0,a=0,s=0,c;c=r[s];s++)if(c.className==="layout.shapes.Part"){var d=c.getPosition(),n=d.x+d.w;n>a&&(a=n),t=d.y+d.h+20,t>o&&(o=t);var t=d.y+d.h;t>o&&(o=t);for(var u=c.getChildren(),f=0,v;v=u[f];f++){if(v.labelNode){var h=ObjectsUtil.get("util.core.DomUtil").position(v.labelNode);n=h.x+h.w,n>a&&(a=n),t=h.y+h.h,t>o&&(o=t)}for(var C=v.getChildren(),A=0,T;T=C[A];A++)T.labelNode&&(h=ObjectsUtil.get("util.core.DomUtil").position(T.labelNode),n=h.x+h.w,n>a&&(a=n),t=h.y+h.h,t>o&&(o=t))}}var j=parseFloat(this.focalNode.style.height);Math.abs(o-j)>1&&(this.focalNode.style.height=o+10+"px");var N=parseFloat(this.focalNode.style.width);Math.abs(a-N)>1&&(this.focalNode.style.width=a+10+"px")}}),ObjectsUtil.declare("layout.shapes.Part",["layout.shapes.StructureDiagramNode"],{isStructureDiagram:null,multiplicity:null,children:null,focalNode:null,guid:null,iconPart:null,name:null,parent:null,color:null,fontColor:null,rx:null,parentNode:null,strokeWidth:null,height:null,width:null,yCoord:null,xCoord:null,_moving:null,type:null,constructor:function(e){this.isStructureDiagram=e.isStructureDiagram,this.multiplicity=e.multiplicity,this.type="partNode",this.parent=e.parent,this.children=[],this.name=e.name||"Node"+incremntal,this.guid=e.id||this.name,this.color=e.color||DEFAULT_COLOR,this.fontColor=e.fontColor||DEFAULT_FONT_COLOR,this.rx=e.rx||DEFAULT_ROUND_RATIO,this.strokeWidth=e.strokeWidth||1,this.strokeWidth=this.strokeWidth+"px",incremntal++},addChild:function(e){var t=ObjectsUtil.get("util.core.CoreUtil");if(t.isArray(e))for(var n=0,r;r=e[n];n++)this.children.push(r);else this.children.push(e);this.applyConstraints()},getChildren:function(e,t){if(e){for(var n=[],r=0,o;o=this.children[r];r++)if(o.type===e){var a=!0;if(t){for(var s in t)if(t[s]?t[s]!==o[s]:o[s]){a=!1;break}}a&&n.push(o)}return n}return this.children},draw:function(e){var t=this.getSuperContainer().settings;this.part_highlight_color=t.part_highlight_color||"#5DBCD2",this.part_container_highlight_color=t.part_container_highlight_color||"#FFFFFF",this.part_container_label_highlight_color=t.part_container_label_highlight_color||"#e6e6e6";var n=ObjectsUtil.get("util.core.CoreUtil"),r=ObjectsUtil.get("util.core.DomUtil");this.focalNode=document.createElementNS(SVGUtil.SVG,"g");var o=Events.connect("mousemove",this.focalNode,this,function(s){if(!this.__resizeStarted){var c=this,d=function(){delete c.__resizeStarted,Events.disconnect(c._tempResizeMouseUpHandler),Events.disconnect(c._tempResizeMouseDownHandler),Events.disconnect(c._tempResizeMouseMoveHandler),c.focalNode.style.cursor="",delete c._tempResizeMouseDownHandler},u=!1,f=r.position(this.focalNode),v=f.x+f.w,h=s.clientX-v;if(Math.abs(h)<10)this.focalNode.style.cursor="col-resize",u=!0;else{var C=f.y+f.h,A=s.clientY-C;Math.abs(A)<10&&(this.focalNode.style.cursor="row-resize",u=!0)}Events.disconnect(this._tempResizeMouseDownHandler),Events.disconnect(this._tempResizeMouseOutHandler),u?(this._tempResizeMouseDownHandler=Events.connect("mousedown",document,this,function(T){this.__resizeStarted&&d(),Events.disconnect(this._tempResizeMouseOutHandler),n.stopEvent(T),this.__resizeStarted=!0,this._tempResizeMouseUpHandler=Events.connect("mouseup",document,this,function(j){n.stopEvent(j),d(),this.getSuperContainer().refreshBoundaries()}),this._tempResizeMouseMoveHandler=Events.connect("mousemove",document,this,function(j){if(n.stopEvent(j),!this._tempResizeMouseDownHandler){d();return}for(var N=this.getChildren(),p=0,b=0,_=0,L;L=N[_];_++)if(L.className==="layout.shapes.Part"){var P=r.position(L.focalNode),S=P.x+P.w;S>b&&(b=S);var k=P.y+P.h;k>p&&(p=k)}var O={},R=r.position(this.focalNode),I=!1;this._tempResizeMouseDownHandler.verticalDiff?j.clientY>p&&(O.h=j.clientY-R.y,I=!0):this._tempResizeMouseDownHandler.horizontalDiff&&j.clientX>b&&(O.w=j.clientX-R.x,I=!0),I&&this.setPosition(O)})}),this._tempResizeMouseDownHandler.horizontalDiff=h,this._tempResizeMouseDownHandler.verticalDiff=A,this._tempResizeMouseOutHandler=Events.connect("mouseout",this.focalNode,this,function(T){d()})):d()}});this.focalNode.setAttribute("style","fill: "+this.color+"; font-family:'sans-serif';"),this.parentNode.appendChild(this.focalNode),this.rectNode=document.createElementNS(SVGUtil.SVG,"rect"),this.rectNode.setAttribute("style","stroke:#000000;"),this.rectNode.setAttribute("fill","#FFFFFF"),this.focalNode.appendChild(this.rectNode),this.highlightNode=document.createElementNS(SVGUtil.SVG,"rect"),this.highlightNode.setAttribute("style","stroke:#000000;"),this.isStructureDiagram?this.highlightNode.setAttribute("fill",this.part_container_highlight_color):this.highlightNode.setAttribute("fill",this.part_highlight_color),this.focalNode.appendChild(this.highlightNode),this.nameNode=document.createElementNS(SVGUtil.SVG,"text"),this.nameNode.setAttribute("style","fill: #000000;  font-family:tahoma; font-size: 10; font-weight:bold"),this.nameNode.appendChild(document.createTextNode(e.name)),this.focalNode.appendChild(this.nameNode),this.isStructureDiagram||(this.iconPart=ShapesRegistry.draw("PartIcon",{parentNode:this.focalNode})),this.setPosition({x:e.x,y:e.y,h:e.h,w:e.w});var a=Events.connect("mousedown",this.focalNode,this,function(s){this._tempResizeMouseDownHandler||this.handleMove(this.focalNode,s)}),a=Events.connect("mousedown",this.highlightNode,this,function(s){this._tempResizeMouseDownHandler||this.handleMove(this.focalNode,s)})},updatePosition:function(e){var t=ObjectsUtil.get("util.core.DomUtil").transformValue(this.focalNode);if(t.h=parseFloat(this.rectNode.getAttribute("height")),t.w=parseFloat(this.rectNode.getAttribute("width")),e.h&&(t.h=t.h+e.h),e.w){t.w=t.w+e.w;for(var n=this.getChildren("portNode"),r=0,o;o=n[r];r++)StructureDiagramUtil.portToPart(o,function(a,s,c,d){if(c==="right"){var u=o.getPosition();o.shiftPosition({x:e.w},!0)}})}this.setPosition(t,!0)},shiftPosition:function(e,t){var n={x:this.xCoord,y:this.yCoord,h:this.height,w:this.width};for(var r in e)n[r]=(n[r]||0)+e[r];this.setPosition(n,t)},setPosition:function(e,t){var n=ObjectsUtil.get("util.core.CoreUtil"),r=this.getPosition(),o=parseFloat(e.x)||this.xCoord||0,a=parseFloat(e.y)||this.yCoord||0,s=parseFloat(e.h)||this.height||40,c=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(this.nameNode.childNodes[0].textContent+"...",this.nameNode).w,d=parseFloat(e.w)||this.width||c+75;if(s<40&&(s=40),d<c+75&&(d=c+75),this.highlightNode.setAttribute("height",20),this.highlightNode.setAttribute("width",d),this.rectNode.setAttribute("height",s),this.rectNode.setAttribute("width",d),this.isStructureDiagram||this.iconPart.setPosition({x:d-25,y:6}),this.focalNode.setAttribute("transform","translate("+o+","+a+")"),!this.isStructureDiagram&&this.multiplicity==="*"&&(this.shadowNode||(this.shadowNode=document.createElementNS(SVGUtil.SVG,"rect"),this.shadowNode.setAttribute("style","stroke:#000000;"),this.shadowNode.setAttribute("fill","none"),this.focalNode.insertBefore(this.shadowNode,this.focalNode.firstChild)),this.shadowNode.setAttribute("transform","translate(3,-3)"),this.shadowNode.setAttribute("height",s),this.shadowNode.setAttribute("width",d)),this.nameNode.setAttribute("y","15"),this.isStructureDiagram){this.nameNode.setAttribute("x","15"),this.nameNode.highlight?(this.nameNode.parentNode.removeChild(this.nameNode.highlight),this.nameNode.parentNode.insertBefore(this.nameNode.highlight,this.nameNode),this.nameNode.parentNode.removeChild(this.nameNode.highlight.border),this.nameNode.parentNode.insertBefore(this.nameNode.highlight.border,this.nameNode)):(this.nameNode.highlight=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.nameNode.highlight.setAttribute("style","fill:"+this.part_container_label_highlight_color+";"),this.nameNode.parentNode.insertBefore(this.nameNode.highlight,this.nameNode),this.nameNode.highlight.border=document.createElementNS(SVGUtil.SVG,"polygon"),this.nameNode.highlight.border.setAttribute("style","stroke:black;stroke-width:1;"),this.nameNode.parentNode.insertBefore(this.nameNode.highlight.border,this.nameNode)),this.nameNode.highlight.setAttribute("x","1"),this.nameNode.highlight.setAttribute("y","1"),this.nameNode.highlight.setAttribute("width",c+10),this.nameNode.highlight.setAttribute("height",18);var u=0,f=0;!n.browserSettings()||n.browserSettings().browser!=="chrome"?(u=2,f=18):(u=0,f=20),this.nameNode.highlight.border.setAttribute("points",c+11+","+u+" "+(c+11)+","+f)}else this.nameNode.setAttribute("x",d/2-c/2);if(!t){var v=this.getPosition(),h=v.x-r.x,C=v.y-r.y;if(h!==0||C!==0)for(var A=0,T;T=this.children[A];A++)(T.className==="layout.shapes.Port"||T.className==="layout.shapes.Part")&&T.shiftPosition({x:h,y:C});this.applyConstraints()}if(this.xCoord=o,this.yCoord=a,this.height=s,this.width=d,this.container&&this.container.getPrecisePosition){var j=this.container.getPrecisePosition(),N=this.yCoord+this.height,p=this.xCoord+this.width,b=j.y+j.h-20,_=j.x+j.w-20,L=N-b,P=p-_;if(L>0||P>0){var S={},k=!1;L>0&&(S.h=L+20,k=!0),P>10&&(S.w=P+20,k=!0),k&&this.container.shiftPosition(S)}}this.refreshBoundaries()},refreshBoundaries:function(){var e=this.getSuperContainer();e._incomplete||e.refreshBoundaries()},getPosition:function(){var e=ObjectsUtil.get("util.core.DomUtil"),t=e.position(this.focalNode,!0),n=this.focalNode.getBoundingClientRect(),r=this.focalNode.parentNode.parentNode.getBoundingClientRect();t.x=n.left-r.left,t.y=n.top-r.top,t.y=t.y+8-parseInt(window.getComputedStyle(this.focalNode.parentNode.parentNode,null).getPropertyValue("padding-top")),t.x=t.x+8-parseInt(window.getComputedStyle(this.focalNode.parentNode.parentNode,null).getPropertyValue("padding-left"));var o=e.getFirstParent(this.focalNode,"svg").parentNode,a=o.scrollLeft,s=o.scrollTop;return t.x=t.x+(a||0),t.y=t.y+(s||0),this.shadowNode&&(t.w=t.w-3,t.h=t.h-3),t},getPrecisePosition:function(){return{h:this.height,w:this.width,y:this.yCoord,x:this.xCoord}},applyConstraints:function(){if(!this._incomplete){for(var e=this.getPosition(),t=this.getPosition(),n=0,r=0,o;o=this.children[r];r++)o.className==="layout.shapes.Port"?o.applyConstraints():o.className;t.w!==e.w&&this.setPosition(t,!0)}},handleMove:function(e,t){var n=ObjectsUtil.get("util.core.DomUtil"),r=ObjectsUtil.get("util.core.CoreUtil"),o=n.getFirstParent(e,"svg"),a=e.parentNode.getScreenCTM(),s=o.createSVGPoint();s.x=t.clientX,s.y=t.clientY,s=s.matrixTransform(a.inverse());var c=this.getPrecisePosition(),d=parseFloat(s.x)-parseFloat(c.x),u=parseFloat(s.y)-parseFloat(c.y),f;this.container.getPrecisePosition&&(f=this.container.getPrecisePosition()),this._moving=e;var v=Events.connect("onselectstart",document,this,function(A){r.stopEvent(A)}),h=Events.connect("mousemove",document,this,function(A){var T=this,j=e.parentNode.getScreenCTM(),N=o.createSVGPoint();N.x=A.clientX,N.y=A.clientY,N=N.matrixTransform(j.inverse());var p={},b=T.getPrecisePosition();p.y=N.y,p.x=N.x;var _=T.container[T.container.getPrecisePosition?"getPrecisePosition":"getPosition"]();if(!(p.x-d<_.x)&&!(p.y-u<_.y)&&(T.setPosition({x:p.x-d,y:p.y-u}),f)){var _=T.container.getPrecisePosition(),L=T.yCoord+T.height,P=T.xCoord+T.width,S=f.y+f.h,k=f.x+f.w,O=L-S,R=P-k;O<0&&R<0&&T.container.setPosition(f)}}),C=Events.connect("mouseup",document,this,function(){Events.disconnect(h),Events.disconnect(C),Events.disconnect(v),this._moving=void 0,this.getSuperContainer().refreshBoundaries(),Events.publish("structure.diagram.node.move."+this.id)});r.stopEvent(t)}});var ICON_WIDTH=12,ICON_HEIGHT=10;ObjectsUtil.declare("layout.shapes.PartIcon",["layout.shapes.AbstractNode"],{draw:function(e){this.iconNode=document.createElementNS(SVGUtil.SVG,"rect"),this.iconNode.setAttribute("style","stroke:#000000;"),this.iconNode.setAttribute("height",ICON_HEIGHT),this.iconNode.setAttribute("width",ICON_WIDTH),this.iconNode.setAttribute("fill","none"),this.parentNode.appendChild(this.iconNode)},setPosition:function(e){var t=parseFloat(e.x)||0,n=parseFloat(e.y)||0,r=2,o=1,a=2,s=6;this.iconNode.setAttribute("x",t),this.iconNode.setAttribute("y",n),this.iconNodePart1?this.parentNode.removeChild(this.iconNodePart1):this.iconNodePart1=document.createElementNS(SVGUtil.SVG,"rect"),this.iconNodePart1.setAttribute("style","stroke:#000000;"),this.iconNodePart1.setAttribute("height",a),this.iconNodePart1.setAttribute("width",s),this.iconNodePart1.setAttribute("y",n+r),this.iconNodePart1.setAttribute("x",t-s/2),this.iconNodePart1.setAttribute("fill","#5DBCD2"),this.parentNode.appendChild(this.iconNodePart1),this.iconNodePart2?this.parentNode.removeChild(this.iconNodePart2):this.iconNodePart2=document.createElementNS(SVGUtil.SVG,"rect"),this.iconNodePart2.setAttribute("style","stroke:#000000;"),this.iconNodePart2.setAttribute("height",a),this.iconNodePart2.setAttribute("width",s),this.iconNodePart2.setAttribute("y",n+r+a+r),this.iconNodePart2.setAttribute("x",t-s/2),this.iconNodePart2.setAttribute("fill","#5DBCD2"),this.parentNode.appendChild(this.iconNodePart2)}});var PortSymbols=ObjectsUtil.define("layout.shapes.Port.PortSymbols",{right:function(e){e.symbol=document.createElementNS(SVGUtil.SVG,"polygon"),e.symbol.setAttribute("points","8,2 2.5,5 8,8"),e.symbol.setAttribute("style","fill:black;stroke:#000000;stroke-width:1"),e.containerNode.appendChild(e.symbol)},left:function(e){e.symbol=document.createElementNS(SVGUtil.SVG,"polygon"),e.symbol.setAttribute("points","2.5,2 8,5 2.5,8"),e.symbol.setAttribute("style","fill:#000000;stroke:#000000;stroke-width:1"),e.containerNode.appendChild(e.symbol)},twoArrows:function(e){var t=function(n,r,o,a){var s=document.createElementNS(SVGUtil.SVG,"line");s.setAttribute("x1",n),s.setAttribute("y1",r),s.setAttribute("x2",o),s.setAttribute("y2",a),s.setAttribute("style","fill:#000000;stroke:#000000;stroke-width:1"),e.containerNode.appendChild(s)};t("4","2","8.5","4"),t("1.5","4","8.5","4"),t("1.5","6","8.5","6"),t("1.5","6","6","8")},conjugated:function(e){var t=PortSymbols._drawCircleSymbol(e,"Conjucated port");t.setAttribute("style","stroke: black;")},conjugatedReplicated:function(e){var t=PortSymbols._drawCircleSymbol(e,"Conjucated replicated port");t.setAttribute("style","stroke: black;"),e.set3D()},replicatedEndPort:function(e){PortSymbols.endPort(e,"Replicated end port"),e.set3D()},endPort:function(e,t){var n=PortSymbols._drawCircleSymbol(e,t||"End port"),r=e.focalNode.getAttribute("fill");n.setAttribute("style","stroke: "+r+";"),n.setAttribute("fill",r),e.focalNode.setAttribute("fill","#000000")},conjucatedReplicatedRelayPort:function(e){var t=PortSymbols._drawRectSymbol(e,"Conjucated replicated relay port");t.setAttribute("style","stroke: black;"),e.set3D()},conjucatedRelayPort:function(e){var t=PortSymbols._drawRectSymbol(e,"Conjucated relay port");t.setAttribute("style","stroke: black;")},replicatedRelayPort:function(e){PortSymbols.relayPort(e,"Replicated relay port"),e.set3D()},relayPort:function(e,t){var n=PortSymbols._drawRectSymbol(e,t||"Relay port");n.setAttribute("style","stroke: black;");var r=e.focalNode.getAttribute("fill");n.setAttribute("style","stroke: "+r+";"),n.setAttribute("fill",r),e.focalNode.setAttribute("fill","#000000")},_drawCircleSymbol:function(e,t){var n=document.createElementNS(SVGUtil.SVG,"circle");return n.setAttribute("fill","#000000"),n.setAttribute("r",3),n.setAttribute("cx",5),n.setAttribute("cy",5),e.containerNode.appendChild(n),PortSymbols._appendTooltip(t,e,n),n},_drawRectSymbol:function(e,t){var n=document.createElementNS(SVGUtil.SVG,"rect");return n.setAttribute("fill","#000000"),n.setAttribute("height",4),n.setAttribute("width",4),n.setAttribute("x",3),n.setAttribute("y",3),e.containerNode.appendChild(n),PortSymbols._appendTooltip(t,e,n),n},_appendTooltip:function(e,t,n){e&&(n.titleElement=document.createElementNS(SVGUtil.SVG,"title"),t.focalNode.appendChild(n.titleElement),n.titleElement.appendChild(document.createTextNode(e)),n.titleElement=document.createElementNS(SVGUtil.SVG,"title"),n.appendChild(n.titleElement),n.titleElement.appendChild(document.createTextNode(e)))}}),ConnectorSymbols=ObjectsUtil.define("layout.shapes.connector.ConnectorSymbols",{draw:function(e,t,n,r){return ConnectorSymbols._draw(e,t,n,r)},_draw:function(e,t,n,r){if(e.connectorSymbol)e.parentNode.removeChild(e.connectorSymbol),e.parentNode.appendChild(e.connectorSymbol);else{e.connectorSymbol=document.createElementNS(SVGUtil.SVG,"g"),e.connectorSymbol.setAttribute("fill","none");var o=5,a=4,s="";t.indexOf("provide")>-1&&(e.connectorSymbol.path=document.createElementNS(SVGUtil.SVG,"path"),e.connectorSymbol.path.setAttribute("style","stroke: #000000;"),e.connectorSymbol.appendChild(e.connectorSymbol.path),s="Provide"),t.indexOf("require")>-1&&(e.connectorSymbol.circle1=document.createElementNS(SVGUtil.SVG,"circle"),e.connectorSymbol.circle1.setAttribute("style","stroke: black;"),e.connectorSymbol.circle1.setAttribute("r",o),e.connectorSymbol.appendChild(e.connectorSymbol.circle1),e.connectorSymbol.setAttribute("fill","white"),s&&(s=s+"\\"),s=s+"Require"),s&&(e.connectorSymbol.title=document.createElementNS(SVGUtil.SVG,"title"),e.connectorSymbol.appendChild(e.connectorSymbol.title),e.connectorSymbol.title.appendChild(document.createTextNode(s))),e.parentNode.appendChild(e.connectorSymbol)}if(e.connectorSymbol.path){var o=5,a=4,c=o+a,d=c*-1;if(r)if(n==="vertical")var u=d+",0",f=c+",0";else var u="0,"+d,f="0,"+c;else if(n==="vertical")var f=d+",0",u=c+",0";else var f="0,"+d,u="0,"+c;var v="M"+u+(" A"+o+","+o)+" 0 0,1 "+f;e.connectorSymbol.path.setAttribute("d",v)}return e.connectorSymbol}}),LABEL_FONT_SETTINGS={fontSize:10,fontFamily:"arial, serif",fontWeight:"normal"};ObjectsUtil.declare("layout.shapes.Port",["layout.shapes.StructureDiagramNode"],{focalNode:null,guid:null,isPrivate:null,connectors:null,name:null,color:null,fontColor:null,rx:null,parentNode:null,strokeWidth:null,_moving:null,type:null,portType:null,constructor:function(e){this.type="portNode",this.isPrivate=e.isPrivate==="true"||e.isPrivate===!0,this.multiplicity=e.multiplicity,this.connectors={sources:[],targets:[]},this.portType=e.portType,this.name=e.name||"Node"+incremntal,this.guid=e.id||this.name,this.color=e.color||DEFAULT_COLOR,this.fontColor=e.fontColor||DEFAULT_FONT_COLOR,this.rx=e.rx||DEFAULT_ROUND_RATIO,this.strokeWidth=e.strokeWidth||1,this.strokeWidth=this.strokeWidth+"px",incremntal++},addConnector:function(e,t){var n=ObjectsUtil.get("util.core.CoreUtil");if(n.isArray(e))for(var r=0,o;o=e[r];r++)this.connectors[t].indexOf(o)>-1||this.connectors[t].push(o);else this.connectors[t].indexOf(e)==-1&&this.connectors[t].push(e)},draw:function(args){var settings=this.getSuperContainer().settings;this.portFillColor=settings.portFillColor||"#FFFFCC",this.containerNode=document.createElementNS(SVGUtil.SVG,"g"),this.parentNode.appendChild(this.containerNode),this.focalNode=document.createElementNS(SVGUtil.SVG,"rect"),this.focalNode.setAttribute("style","stroke:#000000;"),this.focalNode.setAttribute("height","10"),this.focalNode.setAttribute("width","10"),this.focalNode.setAttribute("fill",this.portFillColor),this.containerNode.appendChild(this.focalNode);var CoreUtil=ObjectsUtil.get("util.core.CoreUtil"),DomUtil=ObjectsUtil.get("util.core.DomUtil"),typeSymbol=args.typeSymbol;if(typeSymbol){if(typeSymbol.indexOf("(function")>-1){var typeSymboleEval=eval(typeSymbol);CoreUtil.isFunction(typeSymboleEval)&&typeSymboleEval(this)}}else{var portType=args.portType,mappedFunction=PortSymbols[portType];mappedFunction&&mappedFunction(this)}this.labelNode=document.createElementNS(SVGUtil.SVG,"text"),this.labelNode.setAttribute("style","fill: #000000;  font-family:"+LABEL_FONT_SETTINGS.fontFamily+"; font-size: "+LABEL_FONT_SETTINGS.fontSize+";  font-weight:"+LABEL_FONT_SETTINGS.fontWeight+";");var portLabelText=args.name;args.multiplicity!==void 0&&(portLabelText=portLabelText+"["+args.multiplicity+"]"),this.labelNode.appendChild(document.createTextNode(portLabelText)),this.parentNode.appendChild(this.labelNode);var partObject=this.container;if(args.x!==void 0&&args.y!==void 0)this.setPosition({x:args.x,y:args.y},!0);else if(!this.isPrivate){for(var x,y,delta,position=partObject.getPosition(),portPosition=this.getPosition(),children=partObject.getChildren("portNode",{isPrivate:void 0}),adjustedLength=children.length,w=this.getPosition().w,direction=children.length%10,partMax=position.x+position.w,index=0,child;child=children[index];index++)StructureDiagramUtil.portToPart(child,function(e,t,n,r){if(!(n==="right"||n==="left")){var o=DomUtil.calculateTextSize(child.labelNode.childNodes[0].textContent,child.labelNode).w,a=child.getPosition(),s=child.getPosition().x,c=s+o/2;if(!(partMax<c+a.w*2||partMax<s+a.w*2)){var d=o/2+w/2,u=position.w/6;d>position.w/5-15&&direction++,d>position.w/4&&direction++}}});var self=this;if(direction<10){var directionFinder=function(e,t){e===0?(delta=position.h/2/2-5,x=position.x-portPosition.w,y=position.y+position.h/2-portPosition.h-delta):e===1?(delta=position.h/2/2,x=position.x-portPosition.w,y=position.y+position.h/2-portPosition.h+delta):e===2?(delta=position.w/2/2,x=position.x-portPosition.w+position.w/2-delta,y=position.y-portPosition.h):e===3?(x=position.x-portPosition.w+position.w/2,y=position.y-portPosition.h):e===4?(delta=position.w/2/2,x=position.x-portPosition.w+position.w/2+delta,y=position.y-portPosition.h):e===5?(delta=position.h/2/2,x=position.x+position.w-portPosition.w,y=position.y+position.h/2-portPosition.h-delta):e===6?(delta=position.h/2/2,x=position.x+position.w-portPosition.w,y=position.y+position.h/2-portPosition.h+delta):e===7?(delta=position.w/2/2,x=position.x-portPosition.w+position.w/2-delta,y=position.y+position.h-portPosition.h):e===8?(x=position.x-portPosition.w+position.w/2,y=position.y+position.h-portPosition.h):e===9&&(delta=position.w/2/2,x=position.x-portPosition.w+position.w/2+delta,y=position.y+position.h-portPosition.h)};directionFinder(direction)}else{var start=children.length-10,direction=start%8,endY=position.y+position.h-20;if(direction<6){var byIndex=(parseFloat(direction/2)+(start-direction+1)/3)*portPosition.h;byIndex||(byIndex=4);var delta=parseInt(start/8)+byIndex+portPosition.h*2,right=direction%2;if(right)var x=position.x-portPosition.w+position.w;else{var x=position.x-portPosition.w,y=position.y+position.h/2-portPosition.h+delta,diff=y-endY;diff>0&&partObject.updatePosition({h:diff})}var updatedPosition=partObject.getPosition(),y=updatedPosition.y+updatedPosition.h-portPosition.h*2+4}else if(direction%2===0){var x=position.x+position.w-portPosition.w/2,y=position.y-portPosition.h;partObject.updatePosition({w:30})}else var x=position.x+position.w-parseFloat(portPosition.w*3),y=position.y+position.h-portPosition.h}for(var childIndex=0,child;child=children[childIndex];childIndex++)child.applyConstraints();this.setPosition({x,y})}this.applyConstraints();var mouseDownHandler=Events.connect("mousedown",this.containerNode,this,function(e){this.handleMove(this.focalNode,e)}),mouseDownHandler=Events.connect("mousedown",this.labelNode,this,function(e){this.handleMove(this.focalNode,e)})},setPosition:function(e,t){xCoord=parseFloat(e.x)||0,yCoord=parseFloat(e.y)||0,this.containerNode.setAttribute("transform","translate("+xCoord+","+yCoord+")"),this.multiplicity==="*"&&this.set3D();var n=this;StructureDiagramUtil.portToPart(this,function(o,a,s,c){if(s==="right")n.labelNode.setAttribute("x",o+2),n.labelNode.setAttribute("y",a-1);else if(s==="top"){var d=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(n.labelNode.childNodes[0].textContent,n.focalNode);n.labelNode.setAttribute("x",o-parseFloat(d.w/2)),n.labelNode.setAttribute("y",a-parseFloat(c.h/2))}else if(s==="left"){var d=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(n.labelNode.childNodes[0].textContent,n.labelNode);n.labelNode.setAttribute("x",parseFloat(o-(d.w+c.w))),n.labelNode.setAttribute("y",a)}else if(s==="bottom"){var d=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(n.labelNode.childNodes[0].textContent,n.focalNode);n.labelNode.setAttribute("x",o-parseFloat(d.w/2)),n.labelNode.setAttribute("y",a+parseFloat(c.h))}t||n.applyConstraints()});var r=n.labelNode.parentNode;r.removeChild(n.labelNode),r.appendChild(n.labelNode)},set3D:function(){this.shadowNode||(this.shadowNode=document.createElementNS(SVGUtil.SVG,"rect"),this.shadowNode.setAttribute("style","stroke:#000000;"),this.shadowNode.setAttribute("fill",this.portFillColor||"#FFFFFF"),this.containerNode.insertBefore(this.shadowNode,this.containerNode.firstChild)),this.shadowNode.setAttribute("transform","translate(1,-2)"),this.shadowNode.setAttribute("height",11),this.shadowNode.setAttribute("width",11)},applyConstraints:function(){var e=this.container;if(!(!e||e._incomplete)){var t=ObjectsUtil.get("util.core.CoreUtil"),n=this.getPosition(),r=e.getPosition();if(this.isPrivate){var o=!1,a=r.x+r.w-n.w-n.w,s=r.x+n.w,c=r.y+r.h-n.h-n.h,d=r.y+n.h,u=t.clone(n);u.x<s?(u.x=s,o=!0):u.x>a&&(u.x=a,o=!0),u.y<d?(u.y=d,o=!0):u.y>c&&(u.y=c,o=!0),o&&this.setPosition(u,!0)}else{var f=!0,u=t.clone(n),v=function(){var _=r.y-n.h,L=r.y+r.h-n.h,P=Math.abs(u.y-_),S=Math.abs(u.y-L);S<=P?u.y=L:u.y=_};if(n.x<r.x-n.w)u.x=r.x-n.w;else if(n.x>r.x+r.w-n.w)u.x=r.x+r.w-n.w;else{var h=r.x+r.w-n.w,C=r.x-n.w,A=u.x;StructureDiagramUtil.portToPart(this,function(_,L,P,S,k,O){k?v():P==="bottom"?Math.abs(O.deltaBottom)>1&&(u.y=u.y+O.deltaBottom):P==="top"?Math.abs(O.deltaTop)>1&&(u.y=u.y-O.deltaTop):P==="right"?Math.abs(O.deltaRight)>1&&(u.x=u.x+O.deltaRight):P==="left"&&Math.abs(O.deltaLeft)>1&&(u.x=u.x-O.deltaLeft)}),f=!1}if(f){var h=r.y+r.h-n.h,C=r.y-n.h,A=n.y-n.h;(A<C||A>h)&&v()}var T=r.x-n.w,j=r.x+r.w-n.w,N=r.y-n.h,p=r.y+r.h-n.h;u.x<T&&(u.x=T),u.x>j&&(u.x=j),u.y<N&&(u.y=N),u.y>p&&(u.y=p),(parseInt(u.x)!==parseInt(n.x)||parseInt(u.y)!==parseInt(n.y)||parseInt(u.h)!==parseInt(n.h)||parseInt(u.w)!==parseInt(n.w))&&this.setPosition(u,!0)}}},getPosition:function(){var e=ObjectsUtil.get("util.core.DomUtil").transformValue(this.containerNode);return e.w=13,e.h=13,e},handleMove:function(e,t){var n=ObjectsUtil.get("util.core.DomUtil"),r=ObjectsUtil.get("util.core.CoreUtil"),o=n.getFirstParent(e,"svg"),a=e.parentNode.getScreenCTM(),s=o.createSVGPoint(),c=n.scrollValue(e);s.x=t.clientX+c.x,s.y=t.clientY+c.y,s=s.matrixTransform(a.inverse());var d=this.getPosition(),u=parseFloat(s.x)-parseFloat(d.x),f=parseFloat(s.y)-parseFloat(d.y);this._moving=e;var v=Events.connect("onselectstart",document,this,function(A){r.stopEvent(A)}),h=Events.connect("mousemove",document,this,function(A){var T=this,j=e.parentNode.getScreenCTM(),N=o.createSVGPoint();N.x=A.clientX,N.y=A.clientY,N=N.matrixTransform(j.inverse());var p={};this.isPrivate?(p.y=N.y,p.x=N.x):StructureDiagramUtil.portToPart(this,function(b,_,L,P,S){S?(p.y=N.y,p.x=N.x):L==="left"||L==="right"?p.y=N.y:p.x=N.x}),T.shiftPosition(p),r.stopEvent(A)}),C=Events.connect("mouseup",document,this,function(){Events.disconnect(h),Events.disconnect(C),Events.disconnect(v),this._moving=void 0,this.getSuperContainer().refreshBoundaries(),Events.publish("structure.diagram.node.move."+this.id)});r.stopEvent(t)}});var Events=ObjectsUtil.get("util.core.Events"),incremntal=0,sources=[];ObjectsUtil.declare("layout.shapes.PortConnector",["layout.shapes.StructureDiagramNode"],{focalNode:null,guid:null,name:null,color:null,fontColor:null,rx:null,parentNode:null,strokeWidth:null,_moving:null,type:null,connectorType:null,constructor:function(e){this.connectorType=e.connectorType,this.type="portConnector",this.name=e.name||"Connector"+incremntal,this.guid=e.id||this.name,this.sources=e.sources,this.targets=e.targets,this.part=e.part,incremntal++,this.points=e.points},draw:function(e){var t=["red","green","blue","brown","black","orange","lime"],t=["black","black","black","black","black","black","black","black"];sources.indexOf(this.sources[0])===-1&&sources.push(this.sources[0]);var n=t[sources.indexOf(this.sources[0])];if(this.focalNode=document.createElementNS(SVGUtil.SVG,"polyline"),this.focalNode.setAttribute("style","fill:none;stroke:"+n+";stroke-width:1px;"),this.parentNode.appendChild(this.focalNode),this.points)this.focalNode.setAttribute("points",this.points);else{this.setPosition();for(var r=0,o;o=["sources","targets"][r];r++)for(var a=0,s;s=this[o][a];a++){var c=ShapesRegistry.get("Port",s);c.addConnector(this,o),Events.connect("setPosition",c,this,function(d){this.setPosition(d)}),this.container.applyConstraints()}}},setPosition:function(e){if(this.sources[0]===this.targets[0])return this.focalNode.setAttribute("points","");var t=[],n=this.targets[0],r=this.sources[0],o=ShapesRegistry.get("Port",n),a=ShapesRegistry.get("Port",r);if(o.getPosition().x<a.getPosition().x){var s=r;r=n,n=s}var c=function(G,Z,re){t.push({x:G,y:Z,direction:re})},d=function(G){G.direction==="left"?(G.x=G.x,G.y=G.y+5):G.direction==="right"?(G.x=G.x+10,G.y=G.y+5):G.direction==="top"?(G.x=G.x+5,G.y=G.y):G.direction==="bottom"&&(G.y=G.y+10,G.x=G.x+5)},u=ShapesRegistry.get("Port",r),f=u.container,v=f.getPosition(),h=u.getPosition();StructureDiagramUtil.portToPart(r,c);var C=ShapesRegistry.get("Port",n),A=C.container,T=A.getPosition(),j=C.getPosition();StructureDiagramUtil.portToPart(n,c);var N=f===A,D=[],p=t[0];if(t[0]){h.direction=p.direction;var b=t[1];if(b){j.direction=b.direction;var _=u.getPosition(),L=C.getPosition(),P=!1,S=this,k=function(G,Z,re,ie){Z.isPrivate?ie.direction==="left"?G.direction="right":ie.direction==="top"?G.direction="bottom":ie.direction==="bottom"?G.direction="top":ie.direction==="right"&&(G.direction="left"):Z.parent===S.part&&(re.isPrivate||re.parent!==S.part)&&(G.direction==="left"?G.direction="right":G.direction==="top"?G.direction="bottom":G.direction==="bottom"?G.direction="top":G.direction==="right"&&(G.direction="left"))};u.isPrivate?(k(j,C,u,h),k(h,u,C,j)):(k(h,u,C,j),k(j,C,u,h));var O=h.direction,R={x:j.x,y:j.y,direction:j.direction};d(R);var I={x:R.x,y:R.y},F={x:h.x,y:h.y,direction:h.direction},V=function(G){var Z={};return G.direction==="left"?(Z.x=G.x-10,Z.y=G.y):G.direction==="right"?(Z.x=G.x+10,Z.y=G.y):G.direction==="top"?(Z.x=G.x,Z.y=G.y-10):G.direction==="bottom"&&(Z.x=G.x,Z.y=G.y+10),Z.direction=G.direction,Z},D=[],m={x:h.x,y:h.y,direction:h.direction};d(m),D.push(m);var M=V(m);D.push(M);var U={x:j.x,y:j.y,direction:j.direction};d(U);var z=V(U);D.push({x:z.x,y:M.y}),D.push(z),D.push(U);var q=function(){for(var G=D.length,Z=0;Z<G-1;Z++){var re=D[Z],ie=D[Z+1],ce=D[Z+2],ve=function(ae){return ce?re[ae]===ie[ae]&&ie[ae]===ce[ae]:!1};if(ve("y")){var he=0;if(h.direction==="left"&&j.direction==="left"){var Le=D[Z+3];if(Le)var Ae=Le.y-re.y;else var Ae=T.y-re.y-h.h*1.5}else if(h.direction==="left"&&j.direction==="bottom"){var Ae=T.y-re.y-h.h*1.5;if(T.x>v.x&&v.y<T.y)var he=T.x-re.x-h.h*1.5}else var Ae=v.y+v.h-ie.y;var we=void 0;ie.x<re.x&&ie.x<ce.x?(we=ie.y+Ae,D.splice(Z+2,0,{x:ie.x+he,y:we})):ce.y<re.y&&ce.y<ie.y&&(we=ie.y-Ae,D.splice(Z+2,0,{x:re.x,y:we})),we&&(ce.y=we)}else if(ve("x")){if(h.direction==="bottom"&&j.direction==="top")var Ae=T.x+T.w-re.x;else if((h.direction==="right"||h.direction==="bottom")&&(ie.direction==="top"||ie.direction==="bottom")||h.direction==="top"&&(ce.direction==="bottom"||ce.direction==="top")){if(A===f&&(C.isPrivate||u.isPrivate))var Ae=j.x-re.x-h.h;else var Ae=T.x-re.x-h.h*1.5;if(h.direction==="bottom"&&j.direction==="bottom"&&h.y<j.y){var ue=D[Z-1];ue&&(ue.y=ie.y,re.y=ie.y)}}else var Ae=T.x+T.w-re.x;var we=void 0;ie.y<re.y&&ie.y<ce.y?D[Z+1].direction===D[Z+2].direction&&!D[Z+3]&&j.direction!=="top"?D.splice(Z+1,1):(we=ie.x+Ae,D.splice(Z+2,0,{x:ce.x,y:ie.y})):ie.y>re.y&&ie.y>ce.y&&(we=ie.x+Ae,D.splice(Z+2,0,{x:ce.x,y:ie.y})),we&&(re.x=we,ie.x=we)}}};q();var ee=function(){for(var G=[],Z=1;Z<D.length-5;Z++){var re=D[Z],ie=D[Z+1],ce=D[Z+2],ve=D[Z+3];if(re.x===ie.x&&ce.x===ve.x&&ve.x>ie.x){D[Z+1].y=ve.y,D.splice(D.indexOf(ce),1),D.splice(D.indexOf(ve),1),Z=1;continue}}},W=function(){for(var G=1;G<D.length-3;G++){var Z=D[G],re=D[G+1],ie=D[G+2];if(!(!((ie.direction==="left"||ie.direction==="top")&&Z.y<ie.y&&Z.direction==="bottom")||ie.direction&&ie.direction===Z.direction)&&Z.y===re.y&&re.x===ie.x){Z.y=ie.y,D[G+3]&&(ie.x=D[G+3].x),D.splice(D.indexOf(re),1),G=1;continue}}};W(),ee();var Y=function(){for(var G={points:[],delta:0},Z=D.length,re=0;re<Z-1;re++){var ie=D[re],ce=D[re+1],ve=Math.abs(ce.x-ie.x),he=Math.abs(ce.y-ie.y),Le=ve>he?ve:he;G.delta<Le&&(G={points:[ie,ce],delta:Le})}return G.points},ne=function(Z){var Z=Y(),re=Z[0],ie=Z[1],ce=Math.abs(ie.x-re.x),ve=Math.abs(ie.y-re.y);if(ce>ve)return{direction:"horiontal",x:re.x+ce/2,y:re.y};var he;return re.y>ie.y?he=re:he=ie,{direction:"vertical",x:ie.x,y:he.y-ve/2}};if(this.connectorType&&this.connectorType.length>0){var X=ne(Y()),se=ShapesRegistry.get("Port",this.targets[0]),fe=ShapesRegistry.get("Port",this.sources[0]),pe;se.getPosition().x>=fe.getPosition().x?(pe=!1,X.direction==="vertical"?X.y=X.y-20:X.x=X.x-20):(pe=!0,X.direction==="vertical"?X.y=X.y+20:X.yx=X.x+20);var me=ConnectorSymbols.draw(this,this.connectorType,X.direction,pe);me.setAttribute("transform","translate("+X.x+","+X.y+")")}var ye=u.focalNode.parentNode,be=C.focalNode.parentNode,Ee=ye.parentNode,Se=be.parentNode;Ee.removeChild(ye),Ee.appendChild(ye),Se.removeChild(be),Se.appendChild(be),this.focalNode.setAttribute("points",this.arrayToPoints(D));for(var Q=[],B=u.connectors.sources.concat(u.connectors.targets).concat(C.connectors.sources).concat(C.connectors.sources),J=0,te;te=B[J];J++)Q[te.name]||(Q[te.name]=te);this.adjustOverlappedConnectors(Q)}}},adjustOverlappedConnectors:function(e){var t=e||ShapesRegistry.get("PortConnector"),n={};for(var r in t){var o=t[r];if(o.getAttribute){var a=[];n[o.name]={connector:o,connectorPoints:a};for(var s=o.getAttribute("points").split(" "),c=0,d;d=s[c];c++){var u=d.split(",");a.push({x:parseFloat(u[0]),y:parseFloat(u[1])})}}}var f=0,v={},h=[],C=ObjectsUtil.newInstance("util.core.Map");for(var r in n){var A=n[r],T=A.connector,a=A.connectorPoints;for(var j in n){f++;var N=n[j],p=N.connector;if(p!==T){var b=N.connectorPoints,_=p.targets[0];v[_]===void 0?v[_]=0:h.indexOf(p)===-1&&v[_]++,h.push(p);var L=C.get(p);L||(L=(v[_]%2?2:-2)*Math.round(v[_]/2),C.put(p,L));for(var P=[b[0],b[1]],S=!1,c=0;c<b.length-1;c++)for(var k=b[c],O=b[c+1],R=[k.x,O.x],I=[k.y,O.y],F,V,D=0;D<a.length-1;D++){var m=a[D],M=a[D+1],U=function(Se,Q){for(var B=1,J=3,te=3,G=b[c][Se]+J*B,Z=!1;!Z;)e:{for(var re in n)for(var ie=n[re],ce=ie.connectorPoints,ve=0,he;he=ce[ve];ve++)if(he[Se]===G&&(Math.abs(he[Q]-b[c][Q])<25||Math.abs(he[Q]-b[c+1][Q])<25)){B<1&&(J<.1?(J=te+1,te++):J=J/2),B=B*-1,G=b[c][Se]+J*B;break e}Z=!0;break}return G},F=m.x===k.x&&M.x===O.x&&m.x===O.x&&(M.y===O.y||Math.abs(k.y-m.y)<=3),V=m.y===k.y&&M.y===O.y&&m.y===O.y&&(M.x===O.x||Math.abs(k.x-m.x)<=3);if(F){var z=U("x","y");N.alteredx=!0,b[c].x=z,b[c+1].x=z,p.movedHorizontally=!0,S=!0}else if(V){var z=U("y","x");N.alteredy=!0,b[c].y=z,b[c+1].y=z,p.movedVertically=!0,S=!0}}for(var c=0;c<b.length-2;c++){var q=b[c],ee=b[c+1],W=b[c+2];(ee.y<q.y&&ee.y<W.y&&q.x===ee.x&&ee.x===W.x||ee.x<q.x&&ee.x<W.x&&q.y===ee.y&&ee.y===W.y)&&(b.splice(c+1,1),c=0)}for(var c=0;c<b.length-1;c++){var q=b[c],ee=b[c+1],W=b[c+2];if(ee.x!=q.x&&Math.abs(ee.x-q.x)<7)ee.x=q.x,c=-1,S=!0;else if(ee.y-q.y&&Math.abs(ee.y-q.y)<7)ee.y=q.y,c=0,S=!0;else if(c>4)break}if(S){for(var P="",Y=0,ne;ne=b[Y];Y++){var X=b[Y-1],se=b[Y-2];P&&(P=P+" ");var fe=ne;X&&se&&ne.x!==X.x&&ne.y!==X.y&&(se.x==X.x?fe.x=se.x:se.y==X.y&&(fe.y=se.y)),P=P+fe.x+","+fe.y}p.setAttribute("points",P)}}}}},arrayToPoints:function(e){for(var t="",n=0,r;r=e[n];n++)t&&(t=t+" "),t=t+r.x+","+r.y;return t},getPosition:function(){return{x:parseFloat(this.focalNode.getAttribute("x")),y:parseFloat(this.focalNode.getAttribute("y")),w:13,h:13}}})})();var StateTree={};function StateNode(e,t){this.parent=e,this.id=t,this.activeColour=null,this.passiveColor=null}StateNode.prototype.getParent=function(){return this.parent},StateNode.prototype.getRoot=function(){for(var e=this,t=null;e!==null;)t=e,e=e.getParent();return t},StateNode.prototype.getId=function(){return this.id},StateNode.prototype.getDepth=function(){for(var e=this,t=0;e!==null;)e=e.getParent(),t++;return t};function StateColourer(e,t){this.numShades=e,this.numColours=t,this.cachedColours=this.baseColours.slice()}StateColourer.prototype.passiveColour="999999",StateColourer.prototype.baseColours=["CC99A2","9AAFAF","FFFF7F","98FB98","9DD6D6","D2AB6F","B19CD9"],StateColourer.prototype.getBasePassiveColour=function(){for(var e=this.passiveColour,t=0;t<5-this.numShades&&t<3;t++)e=this.lighten(e);return e},StateColourer.prototype.getBaseColour=function(e){var t;e<this.cachedColours.length?t=this.cachedColours[e]:(e=e%this.cachedColours.length,t=this.modifyColour(this.cachedColours[e]),this.cachedColours[e]=t);for(var n=0;n<5-this.numShades&&n<3;n++)t=this.lighten(t);return t},StateColourer.prototype.getLightenAmount=function(){return 15},StateColourer.prototype.getModifyAmount=function(){return 20},StateColourer.prototype.modifyColour=function(t){var t=this.createColour(t),n,r;return t.red>t.blue?t.red>t.green?(t.red-=this.getModifyAmount(),t.blue>t.green?t.green+=this.getModifyAmount():t.blue+=this.getModifyAmount()):(t.green-=this.getModifyAmount(),t.blue+=this.getModifyAmount()):t.blue>t.green?(t.blue-=this.getModifyAmount(),t.red>t.green?t.green+=this.getModifyAmount():t.red+=this.getModifyAmount()):(t.blue-=this.getModifyAmount(),t.red+=this.getModifyAmount()),t.toHex()},StateColourer.prototype.lighten=function(t){var t=this.createColour(t),n=this.getLightenAmount();return t.modifyRed(n),t.modifyBlue(n),t.modifyGreen(n),t.toHex()},StateColourer.prototype.createColour=function(e){var t=parseInt(e,16),n=t>>16,r=t>>8&255,o=t&255;return new Colour(n,r,o)};function Colour(e,t,n){this.red=e,this.blue=t,this.green=n}Colour.prototype.modifyRed=function(e){this.red+=e,this.red>255?this.red=255:this.red<0&&(this.red=0)},Colour.prototype.modifyBlue=function(e){this.blue+=e,this.blue>255?this.blue=255:this.blue<0&&(this.blue=0)},Colour.prototype.modifyGreen=function(e){this.green+=e,this.green>255?this.green=255:this.green<0&&(this.green=0)},Colour.prototype.modifyByName=function(e,t){if(e!=="red"&&e!=="blue"&&e!=="green")throw"Not a valid colour name"},Colour.prototype.toHex=function(){var e=this.green|this.blue<<8|this.red<<16;return e.toString(16)};function StateTable(e,t){this.table=e,this.stateTree=t}StateTable.prototype.readTable=function(){for(var e=this.table.find("tr"),t=0,n=1;n<e.length;n++){var r=jQuery(e[n]).find("td")[0];this.stateTree.stateNodes.push(this.stateTree.createState(jQuery(r),t++))}},StateTable.prototype.colour=function(){var e=this.table.find("tr"),t,n,r;if(this.stateTree.type==="state"){t=jQuery(e[0]).find("td");for(var o=1;o<t.length;o++)jQuery(t[o]).css("background-color","#"+this.stateTree.stateNodes[o-1].activeColour)}for(var o=1;o<e.length;o++){n=this.stateTree.stateNodes[o-1],t=jQuery(e[o]).find("td"),r=jQuery(t[0]),r.css("background-color","#"+n.activeColour);for(var a=1;a<t.length;a++)r=jQuery(t[a]),r.text().match(/^\s$/)?r.css("background-color","#"+n.passiveColour):r.css("background-color","#"+n.activeColour)}};function EventSequence(e,t,n){this.headerTable=e,this.bodyTable=t,this.stateTree=n}EventSequence.prototype.readTable=function(){for(var e=jQuery(this.headerTable).find("td"),t=0,n=1;n<e.length;n++)this.stateTree.stateNodes.push(this.stateTree.createState(jQuery(e[n]),t++))},EventSequence.prototype.colour=function(){var e,t,n,r;e=jQuery(this.headerTable).find("td");for(var o=1;o<e.length;o++)n=this.stateTree.stateNodes[o-1],jQuery(e[o]).css("background-color","#"+n.activeColour);e=jQuery(this.bodyTable).find("tr");for(var o=1;o<e.length;o++){n=this.stateTree.stateNodes[o-1],t=jQuery(e[o]).find("td");for(var a=0;a<t.length;a++)r=jQuery(t[a]),r.text().match(/^\s$/)?r.css("background-color","#"+n.passiveColour):r.css("background-color","#"+n.activeColour)}},StateTree.init=function(e,t){StateTree.stateNodes=[],e.hasClass("event-statetable")?(StateTree.type="event",StateTree.handler=new StateTable(e,this)):e.hasClass("state-statetable")?(StateTree.type="state",StateTree.handler=new StateTable(e,this)):e.hasClass("event-sequence-grid")?(StateTree.type="eventSequence",StateTree.handler=new EventSequence(e.find("table")[0],e.find("table")[1],this)):(console.log("Unknown state table type"),StateTree.type="unknown")},StateTree.createState=function(e,t){var n=parseInt(e.attr("data-parent")),r=StateTree.stateNodes[n];return isNaN(n)&&(r=null),new StateNode(r,t)},StateTree.maxDepth=function(){for(var e=0,t,n=0;n<StateTree.stateNodes.length;n++)t=StateTree.stateNodes[n].getDepth(),t>e&&(e=t);return e},StateTree.numStateFamilies=function(){numStateFamilies=0;for(var e=0;e<StateTree.stateNodes.length;e++)StateTree.stateNodes[e].getParent()===null&&numStateFamilies++;return numStateFamilies},StateTree.readTable=function(){StateTree.handler.readTable()},StateTree.assignStateColours=function(){for(var e=new StateColourer(StateTree.maxDepth(),StateTree.numStateFamilies()),t=0,n,r=0;r<StateTree.stateNodes.length;r++)n=StateTree.stateNodes[r],n.getParent()===null?(n.passiveColour=e.getBasePassiveColour(),n.activeColour=e.getBaseColour(t++)):(n.passiveColour=e.lighten(n.getParent().passiveColour),n.activeColour=e.lighten(n.getParent().activeColour))},StateTree.colour=function(){StateTree.assignStateColours(),StateTree.handler.colour()},StateTree.colourStateTables=function(){jQuery(document).ready(function(){jQuery(".statetable").each(function(){StateTree.init(jQuery(this)),StateTree.readTable(),StateTree.colour()})})},StateTree.colourEventSequences=function(){jQuery(document).ready(function(){jQuery(".event-sequence-grid").each(function(){StateTree.init(jQuery(this)),StateTree.readTable(),StateTree.colour()})})};
`+e+" "+t},dataType:"html"}).done(function(){console.log("Success: Files sent!")}).fail(function(){console.log("An error occurred, the files couldn't be sent!")})}UmpleSystem=new Object,UmpleSystem.umpleClasses=[],UmpleSystem.umpleAssociations=[],UmpleSystem.umpleTransitions=[],UmpleSystem.position=function(){var e=jQuery("#umpleCanvas"),t=Math.ceil(e.offset().left-e.scrollLeft()),r=Math.ceil(e.offset().top-e.scrollTop()),a=new UmplePosition(t,r,0,0);return a},UmpleSystem.findIn=function(e,t){if(e==null)return null;for(var r=0;r<e.length;r++){var a=e[r];if(a.id==t)return a}return null},UmpleSystem.find=function(e){return UmpleSystem.findIn(this.umpleClasses,e)},UmpleSystem.findAssociation=function(e){var t=UmpleSystem.findIn(this.umpleAssociations,e);return t},UmpleSystem.createAssociation=function(e,t,r,a){var n=new UmpleAssociation;return n.id=this.nextAssociationId(),n.setClasses(e,t),n.setOffsetOnePosition(r),n.setOffsetTwoPosition(a),n.setDefaultMultiplicities(),n.setDefaultRoles(),n.setName(n.getName()),e==t?n.adjustReflexiveEndpoints():n.trimOverlap(),this.addAssociation(n)},UmpleSystem.createTransition=function(e,t){var r=new UmpleTransition;return r.id=this.nextTransitionId(),r.setStates(fromStateId,toStateId),r.setDefaultEvent(),r.setName(r.getName()),this.addTransition(r)},UmpleSystem.createGeneralization=function(e,t){var r=UmpleSystem.find(e);r.extendsClass=t,UmpleSystem.updateClass(r)},UmpleSystem.addAssociation=function(e){this.umpleAssociations.push(e);var t=this.redrawAssociation(e);return e},UmpleSystem.addTransition=function(e){this.umpleTransitions.push(e);var t=this.redrawTransition(e);return e},UmpleSystem.createClass=function(e){var t=new UmpleClass;t.id=this.nextId("NewClass"),t.name=t.id,t.position.set(e.x-UmpleSystem.position().x,e.y-UmpleSystem.position().y,UmpleClassFactory.defaultSize.width,UmpleClassFactory.defaultSize.height);var r=this.addClass(t);return UmpleSystem.redrawGeneralizationsTo(r),r},UmpleSystem.addClass=function(e){this.umpleClasses.push(e),this.updateClass(e);var t=jQuery("#"+e.id);return t.click(Action.classClicked),t.mouseover(function(r){Action.classHover(r,!0)}),t.mouseout(function(r){Action.classHover(r,!1)}),t.mousedown(function(r){setTimeout(function(){Action.classMouseDown(r)},400)}),t.mouseup(function(r){Action.classMouseUp(r)}),Page.readOnly||t.draggable({containment:"parent",stop:function(r,a){DiagramEdit.classMoved(r.target)}}),jQuery(".ui-icon-gripsmall-diagonal-se").removeClass("ui-icon-gripsmall-diagonal-se"),e},UmpleSystem.replaceClass=function(e){for(var t=0;t<this.umpleClasses.length;t++){var r=this.umpleClasses[t];if(r.id==e.id){var a="#"+r.id,n=a+"_generalization",o=jQuery(a).get(),u=jQuery(n).get();jQuery(o).attr("id",e.id),u!=null&&(jQuery(u).attr("id",e.id+"_generalization"),jQuery(u).remove()),this.umpleClasses[t]=e,this.updateClass(this.umpleClasses[t]);return}}},UmpleSystem.renameClass=function(e,t,r){var a=UmpleSystem.find(e),n="#"+e,o=n+"_generalization";r=this.nextId(r),a.id=r,a.name=r,a.oldname=t,jQuery(n).attr("id",a.id),jQuery(o).get()!=null&&jQuery(o).attr("id",a.id+"_generalization");for(var u=0;u<this.umpleAssociations.length;u++){var s=this.umpleAssociations[u];s.classOneId==t&&(s.classOneId=a.id),s.classTwoId==t&&(s.classTwoId=a.id)}for(var u=0;u<this.umpleClasses.length;u++){var d=this.umpleClasses[u];d.extendsClass==t&&(d.extendsClass=r,this.updateClass(d))}return UmpleSystem.updateClass(a),a},UmpleSystem.replaceAssociation=function(e){for(var t=0;t<this.umpleAssociations.length;t++){var r=this.umpleAssociations[t];r.id==e.id&&(this.umpleAssociations[t]=e,index=t)}this.redrawAssociation(e)},UmpleSystem.updatePosition=function(e,t,r){e.position.x=t-UmpleSystem.position().x,e.position.y=r-UmpleSystem.position().y,UmpleSystem.redrawAssociationsFor(e),UmpleSystem.redrawGeneralizationsTo(e),UmpleSystem.updateClass(e)},UmpleSystem.updateClass=function(e){var t=e.drawable(),r=t[0],a=t[1],n=jQuery("#"+Page.umpleCanvasId()),o=jQuery("#"+e.id);if(n.append(r),a!=null)for(var u=0;u<a.length;u++)n.append(a[u]);UmpleSystem.redraw(e);var s=2,d=!1;o.width()>e.position.width+s&&(e.position.width=o.width(),d=!0),o.height()>e.position.height+s&&(e.position.height=o.height(),d=!0),d&&UmpleSystem.redraw(e),jQuery(".ui-icon-gripsmall-diagonal-se").removeClass("ui-icon-gripsmall-diagonal-se")},UmpleSystem.redrawAssociationsFor=function(e){for(var t=0;t<this.umpleAssociations.length;t++){var r=this.umpleAssociations[t];r.contains(e)&&UmpleSystem.redrawAssociation(r)}},UmpleSystem.redrawAssociation=function(e){var t="#"+e.id,r="#"+Page.umpleCanvasId(),a=null;return a=e.drawable(),jQuery(r).append(a),Page.isPhotoReady()||(jQuery(t).click(Action.associationClicked),jQuery(t).mouseover(function(n){Action.associationHover(n,!0)}),jQuery(t).mouseout(function(n){Action.associationHover(n,!1)}),UmpleSystem.setDragableAssociationAnchor(e,0),UmpleSystem.setDragableAssociationAnchor(e,1)),a},UmpleSystem.redrawTransition=function(e){var t="#"+e.id,r="#"+Page.umpleCanvasId(),a=null;return a=e.drawable(),jQuery(r).append(a),Page.isPhotoReady()||jQuery(t).click(Action.transitionClicked),a},UmpleSystem.redrawGeneralizationsTo=function(e){for(var t=0;t<this.umpleClasses.length;t++){var r=this.umpleClasses[t];if(r.extendsClass==e.id)this.updateClass(r);else if(r.interfaces.length>0)for(var a=0;a<r.interfaces.length;a++)r.interfaces[a]==e.id&&this.updateClass(r)}},UmpleSystem.update=function(){for(var e=0;e<this.umpleClasses.length;++e){var t=this.umpleClasses[e];t.position.height=28,Page.showAttributes&&(t.position.height+=17*t.attributes.size()),Page.showMethods&&(t.position.height+=17*t.methods.size()),UmpleSystem.updateClass(t)}for(var e=0;e<this.umpleAssociations.length;++e){var r=UmpleSystem.find(this.umpleAssociations[e].classOneId),a=this.umpleAssociations[e].offsetOnePosition.x+r.position.x+UmpleSystem.position().x,n=this.umpleAssociations[e].offsetOnePosition.y+r.position.y+UmpleSystem.position().y,o=Action.associationSnapClassReady(a,n,r),u=UmpleSystem.find(this.umpleAssociations[e].classTwoId);a=this.umpleAssociations[e].offsetTwoPosition.x+u.position.x+UmpleSystem.position().x,n=this.umpleAssociations[e].offsetTwoPosition.y+u.position.y+UmpleSystem.position().y;var s=Action.associationSnapClassReady(a,n,u),d=new UmplePosition(o[0],o[1],0,0),c=new UmplePosition(s[0],s[1],0,0);this.umpleAssociations[e].setOffsetOnePosition(d),this.umpleAssociations[e].setOffsetTwoPosition(c),UmpleSystem.redrawAssociation(this.umpleAssociations[e])}for(var e=0;e<this.umpleClasses.length;++e)UmpleSystem.trimOverlappingAssociations(this.umpleClasses[e])},UmpleSystem.redraw=function(e){var t=e.position.x+UmpleSystem.position().x,r=e.position.y+UmpleSystem.position().y,a="#"+e.id,n=a+"_generalization",o=a+"_width",u=a+"_height",s=new Object;if(s.top=r,s.left=t,jQuery(a).offset(s),jQuery(o).width(e.position.width),jQuery(u).height(e.position.height),!Page.isPhotoReady()){var d=jQuery(n).get();d!=null&&(jQuery(n).click(Action.generalizationClicked),jQuery(n).mouseover(function(c){Action.generalizationHover(c,!0)}),jQuery(n).mouseout(function(c){Action.generalizationHover(c,!1)}))}this.redrawAssociationsFor(e)},UmpleSystem.trimOverlappingAssociations=function(e){Page.showLayoutLoading();for(var t=0;t<UmpleSystem.umpleAssociations.length;t++){var r=UmpleSystem.umpleAssociations[t];if(r.contains(e)){var a=UmplePositionFactory.copy(r.offsetOnePosition),n=UmplePositionFactory.copy(r.offsetTwoPosition);if(r.isReflexive())r.adjustReflexiveEndpoints();else if(!a.equalsIgnoreSize(r.offsetOnePosition)||!n.equalsIgnoreSize(r.offsetTwoPosition)){Page.showLayoutLoading(),UmpleSystem.redrawAssociation(r);var o=Json.toString(r);DiagramEdit.updateUmpleText({actionCode:format("action=editAssociation&actionCode={0}",o),codeChange:!1})}}}UmpleSystem.umpleAssociations.length==0&&Action.setjustUpdatetoSaveLater(!1),Page.hideLoading()},UmpleSystem.updateAnchor=function(e,t){var r="#"+e.id,a=r+"_anchor"+t,n=r+"_hover"+t,o="";switch(t){case 0:o="left top";break;case 1:o="left center";break;case 2:o="left bottom";break;case 3:o="center bottom";break;case 4:o="right bottom";break;case 5:o="right center";break;case 6:o="right top";break;case 7:o="center top";break}jQuery(a).show(),jQuery(n).show(),jQuery(a).position({my:"center",at:o,of:r}),jQuery(n).position({my:"center",at:o,of:r}),jQuery(a).hide(),jQuery(n).hide()},UmpleSystem.setDragableAssociationAnchor=function(e,t){if(!Page.readOnly)if(e.isReflexive()){var r="#"+e.id+"_anchor"+t,a=t==0?e.classOneId:e.classTwoId;jQuery(r).draggable({drag:function(n,o){DiagramEdit.reflexiveAssociationMoving("#"+n.target.id)},stop:function(n,o){DiagramEdit.associationMoved("#"+n.target.id)},cursor:"pointer",snap:"#"+a,snapTolerance:5,containment:"#"+a,zIndex:1})}else{var r="#"+e.id+"_anchor"+t,a=t==0?e.classOneId:e.classTwoId;jQuery(r).draggable({drag:function(u,s){DiagramEdit.regularAssociationMoving("#"+u.target.id)},stop:function(u,s){DiagramEdit.associationMoved("#"+u.target.id)},cursor:"pointer",snap:"#"+a,snapTolerance:5,containment:"#"+a,zIndex:1})}},UmpleSystem.updatingSize=function(e,t,r){e.position.width=t,e.position.height=r,UmpleSystem.redraw(e)},UmpleSystem.removeClass=function(e){for(var t=0;t<this.umpleClasses.length;t++){var r=this.umpleClasses[t];if(r.id==e){this.umpleClasses.splice(t,1);var a="#"+e,n=a+"_generalization";return jQuery(a).remove(),jQuery(n).remove(),r}}return null},UmpleSystem.removeAssociation=function(e){for(var t=0;t<this.umpleAssociations.length;t++){var r=this.umpleAssociations[t];if(r.id==e){this.umpleAssociations.splice(t,1);var a="#"+e;return jQuery(a).remove(),r}}return null},UmpleSystem.removeTransition=function(e){for(var t=0;t<this.umpleAssociations.length;t++){var r=this.umpleAssociations[t];if(r==e){this.umpleTransitions.splice(t,1);var a="#"+e;return jQuery(a).remove(),r}}return null},UmpleSystem.removeGeneralization=function(e){var t="#"+e;jQuery(t).remove();var r=e.replace("_generalization",""),a=UmpleSystem.find(r);a.extendsClass=null;var n=new UmpleGeneralization;return n.childId=a.id,n.parentId=a.extendsClass,n},UmpleSystem.redrawCanvas=function(){UmpleSystem.merge(UmpleSystem)},UmpleSystem.merge=function(e){UmpleSystem.mergeClasses(e),UmpleSystem.mergeAssociations(e)},UmpleSystem.mergeClasses=function(e){if(e==null){for(;this.umpleClasses.length>0;)this.removeClass(this.umpleClasses[0].id);return}for(var t=0;t<this.umpleClasses.length;t++){var r=this.umpleClasses[t],a=this.findIn(e.umpleClasses,r.id);a==null?(t-=1,this.removeClass(r.id)):this.replaceClass(UmpleClassFactory.create(a))}for(var t=0;t<e.umpleClasses.length;t++){var a=e.umpleClasses[t],n=this.find(a.id);n==null&&this.addClass(UmpleClassFactory.create(a))}for(var t=0;t<this.umpleClasses.length;t++){var r=this.umpleClasses[t];(r.extendsClass!=null||r.interfaces.length>0)&&this.updateClass(r)}},UmpleSystem.mergeAssociations=function(e){if(e==null){for(;this.umpleAssociations.length>0;)this.removeAssociation(this.umpleAssociations[0].id);return}for(var t=0;t<this.umpleAssociations.length;t++){var r=this.umpleAssociations[t],a=this.findIn(e.umpleAssociations,r.id);a==null?(t-=1,this.removeAssociation(r.id)):this.replaceAssociation(UmpleAssociationFactory.create(a))}for(var t=0;t<e.umpleAssociations.length;t++){var n=this.findAssociation(e.umpleAssociations[t].id);if(n==null){var a=UmpleAssociationFactory.create(e.umpleAssociations[t]);this.addAssociation(a)}}},UmpleSystem.nextId=function(e){var t="umpleElement_",r=t+"0";typeof e<"u"&&(t=e,r=e);for(var a=!1,n=0;n<100&&!a;){n>0&&(r=t+n),a=!0;for(var o=0;o<this.umpleClasses.length;o++)if(this.umpleClasses[o].id==r){a=!1,n+=1;break}if(a)return r}return""},UmpleSystem.nextAssociationId=function(e){var t="umpleAssociation_",r=t+"0";typeof e<"u"&&(t=e,r=e);for(var a=!1,n=0;n<100&&!a;){n>0&&(r=t+n),a=!0;for(var o=0;o<this.umpleAssociations.length;o++)if(this.umpleAssociations[o].id==r){a=!1,n+=1;break}if(a)return r}return""},UmpleSystem.nextTransitionId=function(e){var t="umpleTransition_",r=t+"0";typeof e<"u"&&(t=e,r=e);for(var a=!1,n=0;n<100&&!a;){n>0&&(r=t+n),a=!0;for(var o=0;o<this.umpleTransitions.length;o++)if(this.umpleTransitions[o].id==r){a=!1,n+=1;break}if(a)return r}return""},TabControl=new Object,TabControl.maxTabs=10,TabControl.maxNameLength=32,TabControl.defaultTabName="Untitled",TabControl.showHideKey="showUmpleTabs",TabControl.requestQueue=[],TabControl.remoteDelim="%NAME:CONTENT:DELIM%",TabControl.illegalNameRegxp=/[\/\?<>\\:\*\|":]/g,TabControl.controlNameRegxp=/[\x00-\x1f\x80-\x9f]/g,TabControl.reservedNameRegxp=/^\.+$/,TabControl.windowsReservedNameRegxp=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,TabControl.windowsTrailingRegxp=/[\. ]+$/,TabControl.nameReplacement="_",TabControl.init=function(){jQuery("#tabs").sortable({axis:"x",helper:"clone",items:"li:not(.unsortable)",update:TabControl.saveActiveTabs}),jQuery.fn.selectText=function(){var e=document,t=this[0];if(e.body.createTextRange){var r=document.body.createTextRange();r.moveToElementText(t),r.select()}else if(window.getSelection){var a=window.getSelection(),r=document.createRange();r.selectNodeContents(t),a.removeAllRanges(),a.addRange(r)}},TabControl.reset(),localStorage[TabControl.showHideKey]||TabControl.hideTabs(),TabControl.loadAllTabs()},TabControl.showTabs=function(){jQuery("#toggleTabsButton").html("Hide Tabs"),jQuery("#tabControl").show(),localStorage[TabControl.showHideKey]=!0},TabControl.hideTabs=function(){jQuery("#toggleTabsButton").html("Show Tabs"),jQuery("#tabControl").hide(),delete localStorage[TabControl.showHideKey]},TabControl.saveActiveTabs=function(){var e=[];jQuery(".tabname").each(function(){e.push(jQuery(this).text())}),TabControl.addToRequestQueue("scripts/tab_control.php",function(t){},format("index=1&&model={0}&&orderedTabNames={1}",Page.getModel(),encodeURIComponent(JSON.stringify(e))))},TabControl.getActiveTabId=function(){return TabControl.activeTab?TabControl.activeTab.id:null},TabControl.isHidden=function(){return jQuery("#tabControl").is(":hidden")},TabControl.reset=function(){TabControl.activeTab=null,TabControl.tabs={},TabControl.nextTabId=1,TabControl.requestQueue=[],TabControl.queuedTabs=0,TabControl.reservedNames={model:!0}},TabControl.sanitizeName=function(e){var t=e.replace(TabControl.illegalNameRegxp,TabControl.nameReplacement).replace(TabControl.controlNameRegxp,TabControl.nameReplacement).replace(TabControl.reservedNameRegxp,TabControl.nameReplacement).replace(TabControl.windowsReservedNameRegxp,TabControl.nameReplacement).replace(TabControl.windowsTrailingNameRegxp,TabControl.nameReplacement);return t},TabControl.findNextAvailableTabName=function(e){for(var t=e,r=2;TabControl.reservedNames.hasOwnProperty(t);)t=e+r++;return t},TabControl.extractNameFromCode=function(e){var t=/class[\s]*([a-zA-Z_$][a-zA-Z_$0-9]*)[\s]*{/g,r=t.exec(e);if(r)return r[1]},TabControl.createTab=function(e,t,r){if(!(Page.readOnly&&e=="afterTabControlInit")&&(e=="afterTabControlInit"&&(e=null),Object.keys(TabControl.tabs).length!=TabControl.maxTabs)){var a=TabControl.nextTabId++,n=e||TabControl.defaultTabName;if(t!=null){if(!e){var o=TabControl.extractNameFromCode(t);o&&(n=o)}}else t=Page.modelDelimiter;var u=TabControl.findNextAvailableTabName(n);TabControl.tabs[a]={name:u,id:a,history:History.getInstance(a),nameIsEphemeral:e==null},TabControl.reservedNames[u]=!0,TabControl.saveTab(a,t);var s=jQuery("#createTabBtn"),d=jQuery('<li id="tab'+a+'" class=""><a class="tabname" title="Double-click to rename tab" id="tabName'+a+`" href="javascript:TabControl.selectTab('`+a+`');">`+u+`</a><button class="tabbtn" onclick="javascript:TabControl.deleteTab('`+a+`');">&times;</button></li>`);d.insertBefore(s),Object.keys(TabControl.tabs).length==TabControl.maxTabs&&s.hide();var c=TabControl.getTabNameDiv(a);handleNameEdit=function(){c.attr("contentEditable",!1),window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty();var f=c.text(),C=TabControl.tabs[a].name;if(f!==C){var m=!1;TabControl.sanitizeName(f)!==f?alert("The name contains invalid characters. Please try again."):f.length===0||f.length>TabControl.maxNameLength?alert("Name must be between 1 and "+TabControl.maxNameLength+" characters long. Please try again."):TabControl.reservedNames.hasOwnProperty(f)?alert("This name is already in use. Please try again."):m=!0,m?(c.text(f),TabControl.renameTab(a,f)):(c.text(C),c.selectText(),c.attr("contentEditable",!0))}},c.bind("dblclick",function(){c.attr("contentEditable",!0),c.focus(),c.selectText()}).blur(handleNameEdit).keypress(function(f){var C=13,m=8;f.which==C&&c.blur(),f.which!=m&&c.text().length>=TabControl.maxNameLength&&f.preventDefault()}),r||TabControl.saveActiveTabs(),TabControl.selectTab(a)}},TabControl.saveTab=function(e,t){var r=TabControl.getTabFilename(TabControl.tabs[e].name),a=Page.getModel();localStorage[r]=t,String(Page.getFilename()).indexOf("tasks")!==-1&&(r="tasks/"+r,a="tasks/"+a);var n=t.replace(/&/g,"%26").replace(/\+/g,"%2B");TabControl.addToRequestQueue("scripts/compiler.php",TabControl.saveTabCallback(e),format("save=1&&lock=1&&model={2}&&umpleCode={0}&&filename={1}",n,r,a))},TabControl.saveTabCallback=function(e){return function(t){TabControl.tabs[e]&&(TabControl.tabs[e].filename=t.responseText)}},TabControl.selectTab=function(e){if(TabControl.activeTab){if(e==TabControl.activeTab.id)return;var t=TabControl.getTabDiv(TabControl.activeTab.id);t.removeClass("selected"),TabControl.saveTab(TabControl.activeTab.id,Page.getUmpleCode())}TabControl.activeTab=TabControl.tabs[e];var r=TabControl.getTabDiv(e);r.addClass("selected"),TabControl.getCurrentHistory().setButtons();var a=TabControl.getTabFilename(TabControl.activeTab.name);Page.setUmpleCode(localStorage[a]),Action.setCaretPosition(0),Action.updateLineNumberDisplay(),Object.keys(TabControl.tabs).length>1&&setTimeout('Action.processTyping("newEditor",false)',Action.waiting_time)},TabControl.loadAllTabs=function(){TabControl.addToRequestQueue("scripts/tab_control.php",TabControl.loadAllTabsCallback,format("list=1&&model={0}",Page.getModel()))},TabControl.loadAllTabsCallback=function(e){var t=e.responseText.split("<br />"),r=!1;t.map(function(a){if(a){var n=a.split(TabControl.remoteDelim),o=n[0],u=n[1];!o||o==="model"||(r||(TabControl.hideTabs(),r=!0),TabControl.createTab(o,u,!0))}}),r?TabControl.showTabs():TabControl.createTab(null,Page.getUmpleCode())},TabControl.deleteTab=function(e){if(!Page.readOnly&&Object.keys(TabControl.tabs).length>1){var a=TabControl.getTabNameDiv(e),t=confirm("Are you sure you want to remove the file "+a.text()+".ump from the model? If you answer OK, the code will be deleted; this cannot be undone, so consider answering Cancel and saving it first.");if(!t)return;var r=e==TabControl.activeTab.id;TabControl.getTabDiv(e).remove();var a=TabControl.tabs[e].name,n=TabControl.tabs[e].filename;delete TabControl.reservedNames[a],delete TabControl.tabs[e],delete localStorage[n];var o=jQuery("#createTabBtn");o.show(),TabControl.addToRequestQueue("scripts/tab_control.php",function(u){},format("delete=1&&model={0}&&name={1}",Page.getModel(),a)),r&&(TabControl.activeTab=null,TabControl.selectTab(Object.keys(TabControl.tabs)[0])),TabControl.saveActiveTabs()}},TabControl.renameTab=function(e,t,r){if(!Page.readOnly&&!TabControl.reservedNames.hasOwnProperty(t)){var a=TabControl.tabs[e].name;if(a!=t){var n=TabControl.getTabFilename(a),o=TabControl.getTabFilename(t);localStorage[o]=localStorage[n],delete localStorage[n],r&&TabControl.getTabNameDiv(e).text(t),TabControl.tabs[e].nameIsEphemeral=!1,TabControl.addToRequestQueue("scripts/tab_control.php",TabControl.renameTabCallback(e,t),format("rename=1&&model={0}&&oldname={1}&&newname={2}",Page.getModel(),a,t)),TabControl.saveActiveTabs()}}},TabControl.renameTabCallback=function(e,t){return function(r){delete TabControl.reservedNames[TabControl.tabs[e].name],TabControl.reservedNames[t]=!0,TabControl.tabs[e].name=t}},TabControl.getTabFilename=function(e){return format("{0}/{1}.ump",Page.getModel(),e)},TabControl.getTabNameDiv=function(e){return jQuery("#tabName"+e)},TabControl.getTabDiv=function(e){return jQuery("#tab"+e)},TabControl.addToRequestQueue=function(e,t,r){var a={endpoint:e,callback:TabControl.getQueuedCallback(t),parameters:r};TabControl.requestQueue.push(a),TabControl.requestQueue.length===1&&(jQuery(".bookmarkableUrl").addClass("disabled"),Ajax.sendRequest(a.endpoint,TabControl.getQueuedHeadCallback(a.callback),a.parameters))},TabControl.getQueuedHeadCallback=function(e){return function(t){TabControl.requestQueue.shift(),e(t)}},TabControl.getQueuedCallback=function(e){return function(t){var r=TabControl.requestQueue.shift();e(t),r?r.hasOwnProperty("endpoint")?Ajax.sendRequest(r.endpoint,r.callback,r.parameters):r.callback():Page.modelLoadingCount===0&&Page.layoutLoadingCount===0&&Page.canvasLoadingCount===0&&jQuery(".bookmarkableUrl").removeClass("disabled")}},TabControl.addCallbackToRequestQueue=function(e){var t={callback:TabControl.getQueuedCallback(e)};TabControl.requestQueue.push(t),TabControl.requestQueue.length===1&&(jQuery(".bookmarkableUrl").addClass("disabled"),TabControl.getQueuedHeadCallback(t.callback()))},TabControl.getCurrentHistory=function(){return TabControl.activeTab?TabControl.tabs[TabControl.activeTab.id].history:History.getInstance()},TabControl.useActiveTabTo=function(e){return TabControl.activeTab?e.bind(null,TabControl.activeTab.id):function(){}};var ToolTips={},undo,redo,toggleTextEditor;navigator.appVersion.indexOf("Mac")!=-1?(undo="cmd-z",redo="cmd-shift-z",toggleTextEditor="ctrl-t"):(undo="ctrl-z",redo="ctrl-y",toggleTextEditor="ctrl-alt-shift-t"),ToolTips.tooltipEntries={ttSaveBookmark:["li","Click to bookmark this model"],ttSaveModel:["li","Click to save this model for ongoing editing.<br/><br/>After clicking this, you will need to use your browser's functionality to copy or bookmark the newly-created semi-permanent URL.<br/><br/>As you make further edits at the new URL, they will be instantly saved. You will be able to come back any time to continue editing.<br/><br/>The URL and its model will continue to be available for up to a year from the last time you edited it.<br/><br/>Do not use the new URL as a safe backup: If you (or anyone else who you give the URL) modifies or deletes the text, then your work would be lost. <br/><br/>The following describes BETA capabilities. Please report any issues:<br/><br/>You can share the URL with others, or open multiple tabs with it by yourself. As you type the text will change simultaneously in all open tabs."],buttonCopyClip:["li","Click to copy the code to the clipboard<br/><br/>After doing this you can paste the result into a .ump file on your computer. Note that this will copy diagram layout information which is normally hidden, as well as the Umple text."],buttonCopy:["li","Click to open a popup showing the current Umple code (including layout), with a timestamp header for reference."],buttonCopyCommandLine:["li","Click to copy a script to execute your model on the Linux or Mac command line.<br/><br/>After doing this, paste the result into a terminal.<br/><br/>The script will create a new directory under ~/tmp, create the umple file there as test.ump. compile the Umple and resulting Java (and suggest for you how to run the Java if there is a main program present).<br/><br/>Before doing this you need to install the Java development environment and an 'umple' script using a tool such as homebrew. The Umple script should run 'java -jar umple.jar' with a .ump file as an argument  </br><b>Shortcut: [ctrl-o]</b>"],buttonCopyEncodedURL:["li","Click to view a URL encoded with this model.<br/><br/>This only works for small models (about 5 classes or less).<br/><br/>This is ideal for embedding small examples directly in presentation slides (e.g., PowerPoint), or for sharing a quick reproducible model link."],buttonCopyLocalBrowser:["li","Click to save the Umple text from the current tab in your browser local storage for later reloading using Load from Browser below.<br/><br/>This can be useful to transfer text to a different browser tab, or temporarily stash some work you may want to come back to. But it should not be used for a permanent backup."],buttonLoadLocalBrowser:["li","Click to load the Umple text from what you had previously saved in this browser (above).<br/><br/>This operation can be undone."],buttonDownloadFiles:["li","Click to download your entire model, one .ump file per Umple tab.<br/><br/>This is a two-step process. After you click this, the zip file will be created and a link will appear below; you must click on that link to actually complete the download.<br/><br/>This is the best way to safely back up your work to your own computer."],buttonCreateTask:["li","Create a modeling task for participants to try.</br>You will be able to give them some instructions. The model currently appearing here will be their starting point. The instructions could be requirements to model, or changes to make. This can be for an experiment or a course assignment."],buttonLoadTask:["li","Load a model and a set of instructions that have been created by someone running an experiment or a teacher of a course. You need to enter the task name that the person gave you."],buttonRequestAllZip:["li","Create a zip file to download, containing all submissions for this task."],ttDropboxSaver:["li","Click to save your model to dropbox"],ttShowRefreshUmpleCompletely:["li","Click to erase your work and completely restart UmpleOnline.<br/><br/>Use this only if UmpleOnline gets into a state where things seem messed up. After doing this you will NOT be able to use the undo command to restore the model. The text and diagrams will be permanently erased. You should select 'Download Files' above first to back up your work.<br/><br/>For safety, this is a two-step process: A confirmation link will appear below that you must click on after you click on this."],ttLoadBlankModel:["li","Click to load a blank model.<br/><br/>This can be undone using the undo command in Tools. This is the best way to start new work, but you may want to download your files first (above) to back them up."],ttDropboxChooser:["li","Click to load an example from dropbox"],buttonAddClass:["li","Click the diagram to add a class </br><b>Shortcut: [c]</b>"],buttonAddAssociation:["li","Click on two classes to create an association </br><b>Shortcut: [a]</b>"],buttonAddGeneralization:["li","Click on two classes to create a generalization </br><b>Shortcut: [g]</b>"],buttonDeleteEntity:["li","Click on a class, association, or generalization to delete that entity </br><b>Shortcut: [DEL]</b>"],buttonUndo:["li","Click to undo the most recent action </br><b>Shortcut: ["+undo+"]</b>"],buttonRedo:["li","Click to redo the most recent undone action </br><b>Shortcut: ["+redo+"]</b>"],buttonReindent:["li","Click this to adjust the text so that blocks marked by { and } have their contents indented by 2 spaces"],buttonSyncDiagram:["li","Click to sync the diagram and the text"],ttGeneratedCodeType:["li","Choose the language or diagram to generate"],ttGenerateCode:["li","Click this button to generate the above code or diagram"],ttExecuteCode:["li","Click this button to execute the above code"],ttShowHideCanvas:["li","Show/Hide the diagram </br><b>Shortcut: [ctrl+d]</b>"],ttShowHideTextEditor:["li","Show/Hide the text editor </br><b>Shortcut: ["+toggleTextEditor+"]"],ttShowHideLayoutEditor:["li","Show/Hide the layout editor"],ttToggleAttributes:["li","Show/Hide attributes in class diagrams </br><b>Shortcut: [shift+ctrl+a]</b>"],ttToggleMethods:["li","Show/Hide methods in class diagrams </br><b>Shortcut: [ctrl+m]</b>"],ttToggleTraits:["li","Show/Hide traits; when selected any traits and their relationships are explicitly shown; when unselected, traits are merged into their client classes </br><b>Shortcut: [ctrl+r]</b>"],ttToggleActions:["li","Show/Hide actions in state diagrams (hide to simplify)"],ttToggleGuards:["li","Show/Hide guards in state diagrams (hide to simplify)"],ttToggleTransitionLabels:["li","Show/Hide transition labels in state diagrams (t1, t2 etc.) to allow reference"],ttToggleGuardLabels:["li","Show/Hide guard labels on the state diagrams (g1, g2 etc.) to allow reference"],SHT_button:["a","Show/Hide the text editor - <b>"+toggleTextEditor+"</b>"],SHD_button:["a","Show/hide diagram pane on right - <b> ctrl-D</b>"],SHA_button:["a","Show/hide attributes in class diagrams - <b>shift-ctrl-A</b>"],SHM_button:["a","Show/hide methods in class diagrams - <b>ctrl-M</b>"],filtervalues:["input","You can choose to display a subset of classes by naming them, separated by spaces.<br/><br/>You can use glob wildcards to specify patterns matching several classes.<br/><br/> So * matches any number of characters in a class name and ? matches any single character.<br/><br/> Preceding a pattern with a ~ indicates to skip classes matching the pattern.<br/><br/> Superclasses of any selected classes will always also appear (even if ~ is used)<br/><br/> The above is a shortcut for including a filter directive in the code.<br/><br/> using the notation filter {include Classpattern;}<br/><br/> Filters in the code will take precedence.<br/><br/> No class pattern starting with 'gv' can be used as these match the suboptions below.<br/><br/>You can also use an integer such as 1 or 2 to also add classees that are connected by an association 1 or 2 (or any number of ) hops away from selected classes.<br/><br/>You can also widen (or narrow) the spacing of nodes by using an expression like gvseparator=1.7 , where 1.0 is the default spacing."],buttonCopyMix:["li","Click on this to add Umple mixset code to the copy buffer that you can then paste into the code. The code will contain instructions to filter and lay out the code with the gv options and the filter text above. The mixset will have a randomly generated name which you should rename to something meaningful. Then you will see the mixset appear in the options above so you can switch it on and off as often as you like."],ttShowEditableClassDiagram:["li","Display a graphically editable class diagram </br><b>Shortcut: [ctrl+e]</b>"],ttShowJointJSClassDiagram:["li","Display a graphically editable class diagram displayed using joint.js </br><b>Shortcut: [ctrl+j]</b>"],ttShowGvClassDiagram:["li","Display a class diagram rendered using GraphViz </br><b>Shortcut: [ctrl+g]</b>"],ttShowGvStateDiagram:["li","Display a state diagram rendered using GraphViz</br><b>Shortcut: [ctrl+s]</b>"],ttShowStructureDiagram:["li","Display a graphically editable composite structure diagram </br><b>Shortcut: [ctrl+l]</b>"],ttShowGvFeatureDiagram:["li","Display a feature diagram rendered using GraphViz </br>"],ECD_button:["a","Class diagram where the user can Edit the layout - <b>ctrl-E</b>"],GCD_button:["a","Graphviz Class diagram (the default as of 2026), automatically laid out - editable using a contextual menu (double-click or right-click to display it) when pointing to a class, association or attribute - <b>ctrl-G</b>"],SD_button:["a","State diagram - editable using a contextual menu (double-click or right-click to display it) when pointing to  a state or transition  - <b>ctrl-S</b>"],GenJavaButton:["a","Generate Java from this Umple model ... To generate other outputs such as Python, C++, PhP, ER Diagrams and Formal Methods, use the Generate menu in Tools"],topBookmarkable:["a","Click to copy the URL and save it so you can come back to it later.<br/> <br/>You can do this just so you remember the location of your model.<br/><br/>The following describes BETA capabilities. Please report any issues: <br/><br/> You can also share the URL with other people to collaborate in real time on a model.<br/> <br/>When more than one person is working on a model, a collaborator who has stopped editing may time out after a while and would then have to reconnect. Before reconnecting the model would temporarily be read-only for them."],collabDisconnect:["a","You can disconnect from your collaboration session with this button."],ttSaveNCollab:["a","Click to save this model for ongoing editing.<br/><br/>After clicking this, you will need to use your browser's functionality to copy or bookmark the newly-created semi-permanent URL.<br/><br/>As you make further edits at the new URL, they will be instantly saved. You will be able to come back any time to continue editing.<br/><br/>The URL and its model will continue to be available for up to a year from the last time you edited it.<br/><br/>Do not use the new URL as a safe backup: If you (or anyone else who you give the URL) modifies or deletes the text, then your work would be lost. <br/><br/>The following describes BETA capabilities. Please report any issues:  <br/><br/>You can share the URL with others, or open multiple tabs with it by yourself. As you type, the text will change simultaneously in all open browsers or browser tabs."],ttPhotoReady:["li","Remove editing handles from diagram"],ttManualSync:["li","Stop the diagram from syncing automatically"],ttAllowPinch:["li","When active on GraphViz diagrams, this allows two-fingered gestures to zoom the diagram in or out to make it have any desired resolution and size (but prevents the entire browser from being zoomed in this manner)"],ttYumlImage:["li","Generate a class diagram using Yuml in another window"]},ToolTips.dropDownTooltips={exampleType:["li","Choose an example type to load"],itemLoadExamples:["li","Choose a class diagram example to load. * means executable, since it has a main program"],itemLoadExamples2:["li","Choose a state diagram example to load. * means executable, since it has a main program"],itemLoadExamples3:["li","Choose a composite structure diagram example to load"]},ToolTips.dynamicTooltips={ttgvortho:["li","Display class association lines with right-angle junctions rather than spline curves"],ttmixset:["li","Activate the code contained in this named mixset"],ttfilter:["li","Activate the named filter to show only the selected classes"],ttgvmanual:["li","Allow manual editing of Graphviz class diagram layout. You can drag items."],ttgvdot:["li","Lay out the class diagram in the default way, which tries to arrange classes in a hierarchical manner. If gvmanual is also active, this will become the default manual layout"],ttgvsfdp:["li","Lay out the class diagram using a force-directed algorithm. If gvmanual is also active, this will become the default manual layout"],ttgvcirco:["li","Lay out the class diagram using an algorithm that tries to arrange classes in circles. If gvmanual is also active, this will become the default manual layout"]},ToolTips.setATooltip=function(e,t,r,a){var n=document.querySelector(":root"),o=u=e[r];if(typeof o>"u"){console.log("Tooltip ID not defined: "+r);return}var u=o[1],s=Math.max(3.5,u.length/10)+"s";jQuery("#"+t).tooltip({items:o[0],content:u,show:{delay:1e3},open:function(d,c){n.style.setProperty("--tooltipDwellTime",s)},position:a})},ToolTips.setATooltipBasic=function(e,t,r){var a=t;t.substring(0,8)=="ttmixset"?a="ttmixset":t.substring(0,8)=="ttfilter"&&(a="ttfilter");var n;r=="above"?n={my:"center+15% bottom",at:"top",of:"#"+t}:r=="below"?n={my:"left top+10",of:"#"+t}:n={my:"right",at:"left",of:"#"+t},ToolTips.setATooltip(e,t,a,n)},ToolTips.initTooltips=function(){for(var e in this.tooltipEntries)e=="SD_button"||e=="GCD_button"||e=="ECD_button"||e=="SHT_button"||e=="SHD_button"||e=="SHA_button"||e=="SHM_button"||e=="GenJavaButton"||e=="ttSaveNCollab"||e=="collabDisconnect"||e=="topBookmarkable"?ToolTips.setATooltipBasic(this.tooltipEntries,e,"below"):ToolTips.setATooltipBasic(this.tooltipEntries,e,"left");for(e in this.dropDownTooltips)ToolTips.setATooltipBasic(this.dropDownTooltips,e,"above");jQuery(document).tooltip({show:{delay:1e3}})},UmpleTransitionFactory=new Object,UmpleTransitionFactory.create=function(e){var t=new UmpleTransition;return t.id=e.id,t.fromStateId=e.fromStateId,t.toStateId=e.toStateId,t.name=e.name,t.eventName=e.eventName,t};function UmpleTransition(){this.id=null,this.fromStatePosition=null,this.toStatePosition=null,this.fromStateId,this.toStateId,this.name="",this.eventName="",this.color="black",this.setStates=function(e,t){this.fromStateId=e,this.toStateId=t},this.setDefaultEvent=function(){this.eventName="event1"},this.setName=function(e){this.name=e},this.getName=function(){return this.name},this.getElementId=function(){return this.id==null?"newtransition":this.id},this.getState=function(e){return e==0?UmpleSystem.find(this.fromStateId):UmpleSystem.find(this.toStateId)}}var ObjectsUtil={objects:{},parentCalls:{},declare:function(e,t,r){if(!ObjectsUtil.objects[e]){this.parentCalls[e]={},ObjectsUtil.objects[e]=function(){ObjectsUtil.objects[e].prototype.constructor.apply(this,arguments)};for(var a=[],n=0;n<t.length;n++)a.push(t[n]);for(var o=[],n=0;n<a.length;n++){var u=a[n],s=ObjectsUtil.get(u);if(typeof s=="function"){var d=s.prototype,c=d.constructor;c&&o.push(c);for(var f in d)if(f!=="constructor"){var C=d[f];typeof C=="function"?(this.parentCalls[e][f]||(this.parentCalls[e][f]=[]),this.parentCalls[e][f].push(C)):ObjectsUtil.objects[e].prototype[f]=C}}}ObjectsUtil.objects[e].prototype.className=e;var m;for(var f in r)f==="constructor"?m=r[f]:ObjectsUtil.objects[e].prototype[f]=r[f];var E=this.parentCalls[e];for(var f in E)if(!ObjectsUtil.objects[e].prototype[f]){var S=E[f];S.length>0&&(ObjectsUtil.objects[e].prototype[f]=S[0])}ObjectsUtil.objects[e].prototype.constructor=function(){for(var P=0;P<o.length;P++)o[P].apply(this,arguments);m&&m.apply(this,arguments)}}},superCall:function(e,t,r){var a=this.parentCalls[a.className];if(a)for(var n=0;n<a.length;n++)a[n].call(e,r)},define:function(e,t){if(!ObjectsUtil.objects[e])return ObjectsUtil.objects[e]=t,t},get:function(e){return ObjectsUtil.objects[e]},newInstance:function(e,t){var r=new ObjectsUtil.objects[e](t);if(typeof t!="string")for(var a in t)r[a]||(r[a]=t[a]);return r},isArray:function(e){return e&&e instanceof Array}};(function(){var e=ObjectsUtil.get("util.core.CoreUtil");ObjectsUtil.declare("util.core.Map",[],{values:null,keys:null,constructor:function(){this.values=[],this.keys=[]},put:function(t,r){var a=this.keys.indexOf(t);a===-1?(this.values.push(r),this.keys.push(t)):this.values[a]=r},get:function(t){return this.values[this.keys.indexOf(t)]},remove:function(t){var r=this.keys.indexOf(t);r<0||(this.values.splice(r,1),this.keys.splice(r,1))},clear:function(){this.values=[],this.keys=[]}})})(),(function(){var e=ObjectsUtil.newInstance("util.core.Map"),t=[];ObjectsUtil.define("util.core.Events",{topics:{},suspend:null,connect:function(r,a,n,o){var u=this,s,d;if(a.addEventListener)s=function(){o.apply(n,arguments)},a.addEventListener(r,s,!1),d=function(){a.removeEventListener(r,s,!1)};else{var c=e.get(a);if(c||(c=[],e.put(a,c)),!c[r]){c[r]={bridged:a[r],connects:[]};var u=this;a[r]=function(){if(c[r].bridged.apply(a,arguments),!u.suspend)for(var m=c[r].connects,E=0,S;S=m[E];E++)S.callback.apply(S.context,arguments)}}c[r].connects.push({callback:o,context:n}),s=o}var f={callback:s,disconnector:d,type:r,object:a,context:n};return t.push(f),f},disconnectAll:function(){for(;t.length>0;)this.disconnect(t[0],e);this.topics={}},disconnect:function(r,a){if(r){if(r.object.removeEventListener)r.disconnector();else{var n=e.get(r.object);if(!n)return;var o=n[r.type];if(!o||(o=o.connects,!o))return;for(var u=0,s;s=o[u];u++)s.callback===r.callback&&(o.splice(o.indexOf(s),1),u=0)}var d=t.indexOf(r);d>-1&&t.splice(d,1)}},subscribe:function(r,a,n){this.topics[r]||(this.topics[r]=[]);var o={handler:a,context:n};return this.topics[r].push(o),o},unsubscribe:function(r,a){if(this.topics[r]){var n=this.topics[r].indexof(a);n>-1&&this.topics[r].splice(n,1)}},publish:function(r){var a=this.topics[r];if(a)for(var n=0,o;o=a[n];n++){var u=Array.prototype.slice.call(arguments,1);o.handler.apply(o.context||this,u)}}})})(),(function(){ObjectsUtil.define("util.core.UUIDGenerator",{generate:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,r=e==="x"?t:t&3|8;return r.toString(16)})}})})(),(function(){ObjectsUtil.define("util.svg.SVGUtil",{SVG:"http://www.w3.org/2000/svg",syncLineBetweenVertices:function(e,t,r){var a=t.getRootNode(),n=parseFloat(a.getAttribute("height")),o=t.focalNode,u=r.focalNode,s=parseFloat(o.getAttribute("x")),d=parseFloat(o.getAttribute("y")),c=parseFloat(o.getAttribute("height")),f=parseFloat(o.getAttribute("width")),C=parseFloat(u.getAttribute("x")),m=parseFloat(u.getAttribute("y")),E=parseFloat(u.getAttribute("height")),S=parseFloat(u.getAttribute("width")),P=s+f/2,N=d+c/2,R={y:N,x:P},g={y:m,x:C+S/2,getRange:function(_,Q){var W=C/n,F=S/2*W,p=C+S/2;return Math.abs(_-p)<2?p:_<C+S/2?p-F:_>C+S/2?p+F:p}},v={y:m+E,x:C+S/2,getRange:function(_,Q){var W=C/n,F=S/2*W,p=C+S/2;return Math.abs(_-p)<2?p:_<C+S/2?p-F:_>C+S/2?p+F:p}},M={y:m+E/2,x:C,getRange:function(_,Q){var W=m/n,F=E/2*W,p=m+E/2;return Math.abs(Q-p)<2?p:Q<m+E/2?p-F:Q>m+E/2?p+F:p}},L={y:m+E/2,x:C+S,getRange:function(_,Q){var W=m/n,F=E/2*W,p=m+E/2;return Math.abs(Q-p)<2?p:Q<m+E/2?p-F:Q>m+E/2?p+F:p}},T=function(_,Q){return Math.abs(_.x-Q.x)+Math.abs(_.y-Q.y)},A=T(R,g),j=T(R,v),k=T(R,M),U=T(R,L);A<j&&A<k&&A<U?e.setAttribute("d","M"+P+","+N+" L"+g.getRange(P,N)+" "+g.y):j<A&&j<k&&j<U?e.setAttribute("d","M"+P+","+N+" L"+v.getRange(P,N)+" "+v.y):k<A&&k<j&&k<U?e.setAttribute("d","M"+P+","+N+" L"+M.x+" "+M.getRange(P,N)):U<A&&U<j&&U<k&&e.setAttribute("d","M"+P+","+N+" L"+L.x+" "+L.getRange(P,N)),t.parentNode.refreshChild(e)},syncVertixLines:function(e){for(var t=ObjectsUtil.get("util.svg.SVGUtil"),r=e.getChildren("connector"),a=0;n=r[a];a++){var n=r[a];t.syncLineBetweenVertices(n.focalNode,n.source,n.target)}},getConnector:function(e,t){for(var r=e.getChildren("connector"),a=0;a<r.length;a++){var n=r[a];if(n.target===e){if(n.source===t)return n}else if(n.source===e&&n.target===t)return n}return null}})})(),(function(){var e=ObjectsUtil.get("util.svg.SVGUtil"),t={},r={};ObjectsUtil.define("layout.shapes.ShapesRegistry",{register:function(a,n){t[a]=n},draw:function(a,n,o){var u=ObjectsUtil.newInstance(t[a],n,o);return r[a]||(r[a]={}),r[a][u.id||u.guid]=u,u.draw(n,o),u},get:function(a,n){return n?r[a][n]:r[a]},getAndGroup:function(a,n){var o=this.get(a,n),u={};for(var s in o){var d=o[s];if(d){var c=d.parent;c&&(u[c]||(u[c]={}),u[c][s]=d)}}return u},destroy:function(a){r[a.guid].destroy(),r[a.guid]=void 0},empty:function(){r={}},showMessage:function(a,n){var o=document.getElementById(a);if(o){ObjectsUtil.get("util.core.Events").disconnectAll(),ObjectsUtil.get("layout.shapes.ShapesRegistry").empty(),ObjectsUtil.get("util.core.DomUtil").empty(o);var u=ObjectsUtil.get("util.svg.SVGUtil"),s=o.descriptionMessage||document.createElementNS(u.SVG,"text");s.setAttribute("x",20),s.setAttribute("y",20),s.setAttribute("style","fill: #000000;  font-family:tahoma; font-size: 16;  font-weight:bold"),s.appendChild(document.createTextNode(n)),o.appendChild(s);var d=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(n,s);o.style.width=d.w+120+"px",o.style.height=d.h+5+"px",o.style.border="none",o.descriptionMessage=s}},paint:function(a,n){n&&a.args.container&&(ObjectsUtil.get("util.core.Events").disconnectAll(),ObjectsUtil.get("layout.shapes.ShapesRegistry").empty(),ObjectsUtil.get("util.core.DomUtil").empty(a.args.container)),this._paint(a)},_paint:function(a,n,o){n&&(a.args.parentNode=n),o&&(a.args.container=o),a.args.id||(a.args.id=a.args.name);var u=ShapesRegistry.draw(a.descriptor,a.args,a);return u}})})(),(function(){var e=ObjectsUtil.get("util.svg.SVGUtil"),t=ObjectsUtil.get("layout.shapes.ShapesRegistry"),r=40,a=1e5,n=5e-4;n=5e-4,ObjectsUtil.declare("layout.routers.AutomaticRouter",[],{forcex:null,forcey:null,_layoutInterval:null,graph:null,constructor:function(o){this.graph=o,this.forcex={},this.forcey={}},layout:function(){var o=this;o._doLayout(),this._layoutInterval=setInterval(function(){o._doLayout()},100)},_doLayout:function(){for(var o=this.graph.getChildren("rectangle"),u=0;vertix1=o[u];u++){var s=vertix1.name;this.forcex[s]=0,this.forcey[s]=0;for(var d=0;vertix2=o[d];d++){var c=vertix2.name;if(s!==c){var f=parseFloat(vertix2.getAttribute("x"))-parseFloat(vertix1.getAttribute("x")),C=parseFloat(vertix2.getAttribute("y"))-parseFloat(vertix1.getAttribute("y")),m=Math.pow(f,2)+Math.pow(C,2);if(this.forcex[s]-=a/m*f,this.forcey[s]-=a/m*C,e.getConnector(vertix1,vertix2)){var E=Math.sqrt(m);this.forcex[s]+=(E-r)*f,this.forcey[s]+=(E-r)*C}}}}for(var S=0,u=0;vertix1=o[u];u++){var s=vertix1.name,P=this.forcex[s]*n,N=this.forcey[s]*n;S=S+Math.abs(P)+Math.abs(N),vertix1.setPosition({x:parseFloat(vertix1.getAttribute("x"))+P,y:parseFloat(vertix1.getAttribute("y"))+N})}Math.round(S)<40&&clearInterval(this._layoutInterval)}})})(),(function(){var e=ObjectsUtil.get("util.svg.SVGUtil"),t=ObjectsUtil.get("layout.shapes.ShapesRegistry"),r=40,a=1e5,n=5e-4;n=5e-4,ObjectsUtil.declare("layout.routers.HorizontalTreeRouter",[],{forcex:null,forcey:null,graph:null,constructor:function(o){this.graph=o,this.forcex={},this.forcey={}},layout:function(){var o=this;o._doLayout()},_doLayout:function(){var o=[],u=function(A,j){for(var k=[],U=A.getChildren("connector"),_=0;_<U.length;_++){var Q=U[_];if(Q.source===A){var W=Q.target;if(j&&o.indexOf(W)>-1)continue;k.push(Q.target)}else if(Q.target===A){var F=Q.source;if(j&&o.indexOf(F)>-1)continue;k.push(Q.source)}}return k},s=function(A){var j=A.getChildren("connector");if(j.length<1)return 1;for(var k=0,U=0;subChild=j[U];U++)k=k+s(subChild);return k},d=function(A){var j=A.getChildren("connector");if(j.length<1)return 1;for(var k=0,U=0;subChild=j[U];U++){var _;if(subChild.source===A?_=subChild.target:subChild.target===A&&(_=subChild.source),!!_){var Q=parseFloat(_.getAttribute("width"));Q>k&&(k=Q)}}return k},c=function(A,j){j||(j=[]);var k=u(A);if(k.length===1)return 1;for(var U=0,_=0;_<k.length;_++){var Q=k[_];j.indexOf(Q)>-1||(j.push(k[_]),U=U+c(k[_],j))}return U},f=this.graph.getChildren("rectangle"),C=f;C.sort(function(A,j){return s(j)-s(A)});for(var m=40,E=30,S={x:0,y:0},P=function(A,j,k,U){if(!(o.indexOf(A)>-1)){o.push(A);var _=s(A,!0);U&&_--,A.setPosition({x:j,y:k}),k>S.y&&(S.y=k),j>S.x&&(S.x=j);for(var Q=u(A,!0),W=Q.length,F=_*m,p=k-F/2,D=0,O=0;O<W;O++){var G=Q[O],V=s(G)-1,te=p;O&&(te=te+m),V||(V=1);var J=te+V*m,re=(te+J)/2,ne=j+E+parseFloat(A.getAttribute("width"));G.setPosition({x:ne,y:re}),re>S.y&&(S.y=re),ne>S.x&&(S.x=ne),p=J-m,D=D+(V||1),o.push(G);var K=u(G,!0),ue=ne+parseFloat(G.getAttribute("width"))+E;if(K.length===1)P(K[0],ue,re,!0);else if(K.length>=2)for(var pe=te+m/2,he=(J-pe)/K.length+m/K.length,be=0;be<K.length;be++)P(K[be],ue,pe+he*be,!0)}}},N=0;N<C.length;N++){var R=C[N];if(!(o.indexOf(R)>-1)){var g=c(R),v=o.length===0?g*m/4:S.y+m;P(R,E,v)}}if(!this.graph.height){var M=parseFloat(this.graph.getAttribute("height")),L=S.y+m;L>M&&this.graph.setAttribute("height",parseFloat(L))}if(!this.graph.width){var T=parseFloat(this.graph.getAttribute("width")),L=S.x+100;L>T&&this.graph.setAttribute("width",parseFloat(L))}for(var N=0;N<o.length;N++){var R=o[N];R.parentNode.refreshChild(R.focalNode),e.syncVertixLines(R)}}})})(),(function(){var e=0,t=ObjectsUtil.get("util.core.Events");ObjectsUtil.declare("layout.shapes.AbstractNode",[],{focalNode:null,guid:null,children:null,type:null,parentNode:null,incremntal:null,_incomplete:null,constructor:function(r){this.children=[],this.id=r.id,this.parentNode=r.parentNode,this.incremntal++},getChildren:function(r){return this.children[r||""]||[]},getPosition:function(){return{x:0,y:0,h:0,w:0}},setPosition:function(r,a){},shiftPosition:function(r,a){var n=this.getPosition();for(var o in r)n[o]=(n[o]||0)+r[o];this.setPosition(n,a)},getSuperContainer:function(){for(var r=this.container;;){var a=r.container;if(a&&a.className)r=a;else break}return r},addChild:function(r){this.removeChild(r);var a=r.type||"";this.children[a]||(this.children[a]=[]),this.children[a].push(r)},removeChild:function(r){var a=r.type||"";if(this.children[a]&&this.children[a]){var n=this.children[a].indexOf(r);n!=-1&&this.children[a].splice(n,1)}},appendChild:function(r){this.focalNode.appendChild(r)},refreshChild:function(r){r.parentNode===this.focalNode&&(this.focalNode.removeChild(r),this.insertBefore(r,this.focalNode.firstChild))},insertBefore:function(r,a){a?this.focalNode.insertBefore(r,a):this.appendChild(r)},draw:function(r){},getAttribute:function(r){return this.focalNode.getAttribute(r)},setAttribute:function(r,a){this.focalNode.setAttribute(r,a)},getRootNode:function(){var r=this.parentNode.focalNode;if(r.tagName==="svg")return r;for(var a=r.parentNode;a;)if(a=a.parentNode,a&&a.tagName==="svg")return a;return r},handleMove:function(r,a){},destroy:function(){}})})(),(function(){var e=ObjectsUtil.get("util.svg.SVGUtil"),t=ObjectsUtil.get("util.core.Events"),r=ObjectsUtil.get("util.core.UUIDGenerator"),a=0,n="#222",o="#fff",u="10px";ObjectsUtil.declare("layout.shapes.RectangleNode",["layout.shapes.AbstractNode"],{focalNode:null,guid:null,name:null,color:null,fontColor:null,rx:null,parentNode:null,strokeWidth:null,_moving:null,type:null,constructor:function(s){this.type="rectangle",this.name=s.name||"Node"+a,this.guid=s.id||this.name,this.color=s.color||n,this.fontColor=s.fontColor||o,this.rx=s.rx||u,this.strokeWidth=s.strokeWidth||1,this.strokeWidth=this.strokeWidth+"px",a++},draw:function(s){var d=parseInt(this.parentNode.getAttribute("width")),c=parseInt(this.parentNode.getAttribute("height"));this.focalNode=document.createElementNS(e.SVG,"rect"),this.focalNode.setAttribute("style","fill: "+this.color+"; stroke-width: "+this.strokeWidth+";"),this.focalNode.setAttribute("rx",this.rx),this.parentNode.appendChild(this.focalNode),this.focalNode.name=this.name,this.focalNode.textLabel=document.createElementNS(e.SVG,"text"),this.focalNode.textLabel.setAttribute("style","fill: "+this.fontColor+"; stroke-width: 1px;"),this.focalNode.textLabel.appendChild(document.createTextNode(this.name)),this.parentNode.appendChild(this.focalNode.textLabel),this.focalNode.h=this.focalNode.textLabel.getBBox().height+10,this.focalNode.w=this.focalNode.textLabel.getBBox().width+10,this.focalNode.setAttribute("height",this.focalNode.h+"px"),this.focalNode.setAttribute("width",this.focalNode.w+"px");var f=t.connect("mousedown",this.focalNode,this,function(E){this.handleMove(this.focalNode,E)}),f=t.connect("mousedown",this.focalNode.textLabel,this,function(E){this.handleMove(this.focalNode,E)}),C=Math.random()*(d*.8)+d*.1,m=Math.random()*(c*.8)+c*.1;this.setPosition({x:C,y:m})},setPosition:function(s){var d=parseFloat(s.x),c=parseFloat(s.y);this.focalNode.setAttribute("x",d),this.focalNode.setAttribute("y",c),this.focalNode.textLabel.setAttribute("x",d+5+"px"),this.focalNode.textLabel.setAttribute("y",c+2*this.focalNode.h/3+"px"),e.syncVertixLines(this)},handleMove:function(s,d){var c=s.parentNode.getScreenCTM(),f=s.parentNode.createSVGPoint();f.x=d.clientX,f.y=d.clientY,f=f.matrixTransform(c.inverse());var C=parseFloat(f.x)-parseFloat(s.getAttribute("x")),m=parseFloat(f.y)-parseFloat(s.getAttribute("y")),E=this.getChildren("rectangle");this._moving=s;var S=t.connect("mousemove",document,this,function(N){var R=s.parentNode.getScreenCTM(),g=s.parentNode.createSVGPoint();g.x=N.clientX,g.y=N.clientY,g=g.matrixTransform(R.inverse()),this.setPosition({x:g.x-C,y:g.y-m}),this.parentNode.updateArrowMarker()}),P=t.connect("mouseup",document,this,function(){t.disconnect(S),t.disconnect(P),this.parentNode.updateArrowMarker()})}})})(),(function(){var e=ObjectsUtil.get("layout.shapes.ShapesRegistry"),t=ObjectsUtil.get("util.svg.SVGUtil"),r="1px",a="#444",n=0;ObjectsUtil.declare("layout.shapes.Connector",["layout.shapes.AbstractNode"],{focalNode:null,source:null,target:null,name:null,color:null,rx:null,strokeWidth:null,type:null,constructor:function(o){this.type="connector",this.setSource(o.source),this.setTarget(o.target),this.name=o.name||"Connector"+n,this.guid=o.id||this.source.guid+"_"+this.target.guid+"_"+n,this.strokeWidth=o.strokeWidth||r,this.color=o.color||a,n++},setSource:function(o){var u=e.get("RectangleNode",o);this.source=u,u.addChild(this)},setTarget:function(o){var u=e.get("RectangleNode",o);this.target=u,u.addChild(this)},draw:function(o){return this.focalNode=document.createElementNS(t.SVG,"path"),this.focalNode.setAttribute("style","stroke: "+this.color+"; stroke-width:"+this.strokeWidth+";"),this.parentNode.insertBefore(this.focalNode,this.parentNode.firstChild),this.focalNode.setAttribute("marker-end","url(#Triangle)"),this.focalNode}})})();var ShapesRegistry=ObjectsUtil.get("layout.shapes.ShapesRegistry");(function(){ShapesRegistry.register("Connector","layout.shapes.Connector"),ShapesRegistry.register("RectangleNode","layout.shapes.RectangleNode"),ShapesRegistry.register("Graph","layout.shape.Graph")})(),(function(){var e=ObjectsUtil.get("layout.routers.HorizontalTreeRouter"),t=ObjectsUtil.get("util.core.Events"),r=ObjectsUtil.get("util.svg.SVGUtil"),a=ObjectsUtil.get("layout.shapes.ShapesRegistry");ObjectsUtil.declare("layout.shape.Graph",["layout.shapes.AbstractNode"],{routingObject:null,height:null,width:null,_layoutInterval:null,_moving:null,_defs:null,constructor:function(n){this.height=n.height,this.width=n.width;var o=n.container,u=n.router;this.router=u||new e(this),this.focalNode=document.getElementById(o),this.updateArrowMarker()},draw:function(n,o){},_paint:function(n){n.args.parentNode=this,n.args.id||(n.args.id=n.args.name),n.args.container=this;var o=a.draw(n.descriptor,n.args,n);return o},updateArrowMarker:function(){if(this._defs)this.focalNode.removeChild(this._defs);else{this._defs=document.createElementNS(r.SVG,"defs");var n=document.createElementNS(r.SVG,"marker");n.setAttribute("id","Triangle"),n.setAttribute("viewBox","0 0 20 20"),n.setAttribute("refX","20"),n.setAttribute("refY","10"),n.setAttribute("markerUnits","strokeWidth"),n.setAttribute("markerWidth","8"),n.setAttribute("markerHeight","6"),n.setAttribute("orient","auto");var o=document.createElementNS(r.SVG,"path");n.appendChild(o),o.setAttribute("d","M 0 0 L 20 10 L 0 20 z"),this._defs.appendChild(n)}this.focalNode.appendChild(this._defs)},addRectNode:function(n){n.parentNode=this;var o=a.draw("RectangleNode",n);this.addChild(o)},drawConnector:function(n){n.parentNode=this;var o=a.draw("Connector",n);this.addChild(o)},layout:function(){this.router.layout()}})})(),(function(){var e=ObjectsUtil.define("util.core.DomUtil",{empty:function(t){if(t.tagName||(t=document.getElementById(t)),!!t){if(t.canHaveChildren)try{t.innerHTML="";return}catch{}for(var r;r=t.lastChild;)this._empty(r,t)}},_empty:function(t,r){t.firstChild&&this.empty(t),r&&(r.removeChild(t),t.removeNode&&t.removeNode(!1))},calculateTextSize:function(t,r){var a=document.createElement("span");a.innerHTML=t,a.style.visibility="hidden";var u=this.position(a);if(typeof r=="object"&&!r.parentNode)for(var n in r)a.style[n]=r[n];else a.style.fontSize=window.getComputedStyle(r,null).getPropertyValue("font-size"),a.style.fontFamily=window.getComputedStyle(r,null).getPropertyValue("font-family"),a.style.fontWeight=window.getComputedStyle(r,null).getPropertyValue("font-weight");var o=document.body;o.appendChild(a);var u=this.position(a);return o.removeChild(a),u},position:function(t,r){var a=ObjectsUtil.get("util.core.CoreUtil");t=this.nodeById(t);var n=this.getFirstParent(t,"body"),o=t.getBoundingClientRect();if(o={x:o.left,y:o.top,w:o.right-o.left,h:o.bottom-o.top},r){var u=this.scrollValue(t);o.x+=u.x,o.y+=u.y}return o},transformValue:function(t){var r=t.getAttribute("transform");if(!r)return{x:0,y:0};r=r.substring(10,r.length-1);var a=r.split(",");return a.length<2&&(a=r.split(" ")),{x:parseFloat(a[0]),y:parseFloat(a[1])}},scrollValue:function(t){for(var r=function(c,f){var C,m=window["page"+c+"Offset"];if(typeof m=="number")C=m;else{var E="scroll"+f;document.body&&document.body[E]?C=document.body[E]:document.documentElement&&document.documentElement[E]&&(C=document.documentElement[E])}return C},a=function(){return r("Y","Top")},n=function(){return r("X","Left")},o=0,u=0,s={x:n(),y:a()},d=t;d;){if(d!==document.body&&d!==document.documentElement){if(d.scrollTop>0){s.y=s.y+d.scrollTop;break}if(d.scrollLeft>0){s.x=s.x+d.scrollLeft;break}}d=d.parentNode}return s},nodeById:function(t,r){var a=ObjectsUtil.get("util.core.CoreUtil");return a.checkBrowser("ie")?(this.nodeById=function(n,o){return typeof n!="string"?n:(o||document).getElementById(n)},this.nodeById(t,r)):(this.nodeById=function(n,o){if(typeof n!="string")return n;r||(r=document);var u=r.getElementById(n);if(u.id==n||u.attributes&&u.attributes.id&&u.attributes.id.value==n)return u;var s=r.all[n];if(s){a.isArray(s)||(s=[s]);for(var d=0,c;c=s[d];d++)if(c.id==n||c.attributes&&c.attributes.id&&c.attributes.id.value==n)return c}},this.nodeById(t,r))},transformPoint:function(t,r){var a=ObjectsUtil.get("util.core.DomUtil").getFirstParent(t,"svg"),n=a.getScreenCTM(),o=a.createSVGPoint();o.x=r.x,o.y=r.y,o=o.matrixTransform(n.inverse()),r.x=o.x,r.y=o.y},getFirstParent:function(t,r){if(!(!t||!r)){if(r=r.toUpperCase(),t.tagName.toUpperCase()===r)return t;for(var a=t.parentNode,n;a;){if(a.tagName&&a.tagName.toUpperCase()===r.toUpperCase()){n=a;break}a=a.parentNode}return n}}})})(),(function(){var e=ObjectsUtil.define("util.core.CoreUtil",{store:{},toString:{}.toString,_browserSettings:null,clone:function(t){var r={};for(var a in t)r[a]=t[a];return r},stopEvent:function(t){t.cancelBubble=!0,t.preventDefault(),t.stopPropagation()},checkBrowser:function(t){var r=this.store[t];return r!==void 0||(r=navigator.userAgent.search(t),this.store[t]=r),r},browserSettings:function(){if(this._browserSettings)return this._browserSettings;var t=navigator.userAgent,r,a=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];if(/trident/i.test(a[1]))return r=/\brv[ :]+(\d+(\.\d+)?)/g.exec(t)||[],this._browserSettings={browser:"ie",version:r[1]||""},this._browserSettings;a=a[2]?[a[1],a[2]]:[navigator.appName,navigator.appVersion,"-?"],(r=t.match(/version\/([\.\d]+)/i))!=null&&(a[2]=r[1]),this._browserSettings={browser:a[0].toLowerCase(),version:a[1]||""}},version:function(t){var r=this.browserSettings();return r.browser===t?parseFloat(r.version):0},isFunction:function(t){return this._is(t,"[object Function]")},isString:function(t){return this._is(t,"[object String]")},isArray:function(t){return this._is(t,"[object Array]")},_is:function(t,r){return this.toString.call(t)===r}})})(),(function(){var SVGUtil=ObjectsUtil.get("util.svg.SVGUtil"),Events=ObjectsUtil.get("util.core.Events"),UUIDGenerator=ObjectsUtil.get("util.core.UUIDGenerator"),incremntal=0,DEFAULT_COLOR="rgb(255,255,255)",DEFAULT_FONT_COLOR="#fff",DEFAULT_ROUND_RATIO="10px",ShapesRegistry=ObjectsUtil.get("layout.shapes.ShapesRegistry");ShapesRegistry.register("StrucutreDiagram","layout.shapes.StrucutreDiagram"),ShapesRegistry.register("Part","layout.shapes.Part"),ShapesRegistry.register("Port","layout.shapes.Port"),ShapesRegistry.register("PartIcon","layout.shapes.PartIcon"),ShapesRegistry.register("PortConnector","layout.shapes.PortConnector"),ObjectsUtil.declare("layout.shapes.StructureDiagramNode",["layout.shapes.AbstractNode"],{_moveHandle:null,constructor:function(e){this._moveHandle=Events.subscribe("structure.diagram.node.move."+this.id,function(t){var r=this,a=[],n=function(o){if(!(a.indexOf(o)>-1)){a.push(o);var u=o.getPrecisePosition?o.getPrecisePosition():o.getPosition();r.parentNode.layoutInformation||(r.parentNode.layoutInformation={});var s={x:u.x,y:u.y,h:u.h,w:u.w};r.parentNode.layoutInformation[o.id]=s;for(var d=o.getChildren(),c=0,f;f=d[c];c++)n(f)}};n(this)},this)},destroy:function(){Events.unsubsribe(this._moveHandle)}});var StructureDiagramUtil=ObjectsUtil.define("layout.shapes.diagram.structure..StructureDiagramUtil",{portToPart:function(e,t,r){var a=ObjectsUtil.get("util.core.CoreUtil"),n=a.isString(e)?ShapesRegistry.get("Port",e):e,o=r||n.container,u=o.getPosition(),s=n.getPosition(),d=parseInt(Math.abs(s.x-(u.x+u.w)+s.w)),c=parseInt(Math.abs(s.x-u.x+s.w)),f=parseInt(Math.abs(s.y-(u.y-s.h))),C=parseInt(Math.abs(s.y-(u.y+u.h)+s.h)),m=function(S,P,N,R){var g=function(v,M){return v<5&&M<5};e.isPrivate&&(N==="right"?(N="left",P=P+2):N==="left"?(N="right",P=P+2,S=S+2):N==="top"?(N="bottom",P=P+(R.h/2+2)):N==="bottom"?(N="top",P=P-(R.h/2+2)):N="right"),t(S,P,N,R,g(C,c)||g(f,c)||g(C,d)||g(f,d),{deltaRight:d,deltaLeft:c,deltaTop:f,deltaBottom:C})},E;if(d<c&&d<=f&&d<=C)return u.y-s.h>s.y?m(s.x+(s.w/2-2),s.y,"top",s):s.y>u.y+u.h+document.body.scrollTop-s.h?m(s.x+(s.w/2-2),s.y+(s.h/2+4),"bottom",s):m(s.x+(s.w-2),s.y+s.h/2,"right",s);if(c<d&&c<=f&&c<=C)return u.y-s.h>s.y?m(s.x+(s.w/2-2),s.y,"top",s):s.y>u.y+u.h+document.body.scrollTop-s.h?m(s.x+(s.w/2-2),s.y+(s.h/2+4),"bottom",s):m(s.x+(s.w-2),s.y+s.h/2,"left",s);if(f<d&&f<c&&f<C)return m(s.x+(s.w/2-2),s.y,"top",s);if(C<d&&C<c&&C<f)return m(s.x+(s.w/2-2),s.y+(s.h/2+4),"bottom",s)}});ObjectsUtil.declare("layout.shapes.StrucutreDiagram",["layout.shape.Graph"],{layoutInformation:null,settings:null,constructor:function(e){this.layoutInformation=e.layout},draw:function(e,t){this.focalNode.style.width="100%",this.focalNode.style.height="3600px",this._incomplete=!0,this.settings=t.args.settings||{};var r=t.args.layout;this.height&&this.setAttribute("height",this.height),this.width&&this.setAttribute("width",this.width);var a=e.nodes;if(a){for(var n={"":{}},o=function(ce){var oe=n[ce||""];return oe||(n[ce]={},n[ce])},u=[],s=function(ce){var oe=ce.args,ge=oe.id||oe.name;if(ge){ce.children={};var Te=o(oe.parent)[oe.id||oe.name||new Date().getTime()]=ce}else u.indexOf(ce)===-1&&u.push(ce)},d=0,c;c=a[d];d++)s(c);var f=function(ce,oe){for(var ge in ce){if(ge===oe)return ce[oe];var Te=f(ce[ge].children,oe);if(Te)return Te}},C=[],m=function(ce){for(var oe in ce)if(oe){var ge=ce[oe],Te=f(n[""],oe);if(Te){var de=C.indexOf(oe);de>-1&&C.splice(de,1);var Pe=n[oe];for(var Le in Pe)Te.children[Le]=Pe[Le];delete n[oe]}else{var de=C.indexOf(oe);de===-1&&C.push(oe)}for(var Le in ge)m(ge[Le].children)}};for(m(n);C.length>0;)m(n);var E=ObjectsUtil.get("util.core.CoreUtil"),S=n[""],P=[],N=function(ce){for(var oe in ce){var ge=ce[oe];P.indexOf(ge)>-1||(ge.descriptor==="Part"&&!S[oe]&&(S[oe]=E.clone(ge),P.push(S[oe])),N(ge.children))}};N(S);var R={},R=function(ce){for(var oe in ce)if(!R[oe]){R[oe]=oe;var ge=ce[oe];R(ge);var Te=ge.children;for(var de in Te){var Pe=ce[de];if(Pe){R(Pe);e:{for(var Le in S[de].children){ge.children[de].children=S[de].children;break e}for(var Le in ge.children[de].children){S[de].children=ge.children[de].children;break e}}}}}};R(S);var g=function(ce,oe,ge,Te){var de=E.clone(ce,oe,ge);if(de.parent=ge.id,de.parentNode=oe,de.id||(de.id=de.name),Te&&(de.id=Te+"_"+de.id),r){var Pe=r[de.id];Pe&&(de.x=Pe.x,de.y=Pe.y,de.h=Pe.h,de.w=Pe.w,de.hasLayoutInformation=!0)}return de.container=ge,de},v=20,M=20,L=30,T=30,A=M,j=v+L,k=!0;for(var U in S){var _=S[U],e=g(_.args,this,this);!e.x||!e.y?(k||(A=A+M+20),e.x=j,e.y=A,k=!0):k=!1,_.descriptor==="Part"&&(e.isStructureDiagram=!0);var Q=ShapesRegistry.draw(_.descriptor,e),W=_.children,F=!1,p=!1,C=[];for(var D in W){var O=W[D],G=g(O.args,this,Q,U),V=ShapesRegistry.draw(O.descriptor,G);if(V._incomplete=!0,G.hasLayoutInformation?p=!1:(Q.addChild(V),p=!0),O.descriptor==="Part"||O.descriptor==="Port"&&(O.args.isPrivate==="true"||O.args.isPrivate===!0)){F||(j=j+v+L,A=A+M+20,F=!0);var te=O.children;for(var J in te){var re=te[J];if(re.descriptor==="Port"){var ne=g(re.args,this,V,U),K=ShapesRegistry.draw(re.descriptor,ne);ne.hasLayoutInformation?C.push(K):V.addChild(K)}}var ue=V.getPosition();if(ue.x+j>650){var z=Q.getPosition(),q=z.y+z.h-20;A=q+T,j=v+L+v+L}k&&V.shiftPosition({x:j,y:A}),delete V._incomplete;for(var pe=0,he;he=C[pe];pe++)V.addChild(he);C=[],ue=V.getPosition();var z=Q.getPosition(),be=ue.x+ue.w,H=z.x+z.w-40,Ce=ue.y+ue.h,q=z.y+z.h-20,ve=be-H,Ee=Ce-q;if(Ee>0||ve>0){var Ae={};ve>0&&(Ae.w=ve),Ee>0&&(Ae.h=Ee),Q.shiftPosition(Ae)}j=j+ue.w+v+v+v+v}C=[],p||Q.addChild(V),delete V._incomplete}var z=Q.getPosition(),H=z.x+z.h-40,z=Q.getPosition(),q=z.y+z.h-20;A=M+q+T,j=v+L,this.addChild(Q)}for(var U in S)for(var Z=ShapesRegistry.get("Part",U),B=0,X;X=u[B];B++){var e=X.args,ie=e.sources[0],ee=e.targets[0],le=U+"_"+ie;if(ShapesRegistry.get("Port",le)){var me=U+"_"+ee;if(ShapesRegistry.get("Port",me)){var fe=E.clone(e);fe.sources=[le],fe.part=U,fe.targets=[me],fe.parentNode=this,fe.container=Z,ShapesRegistry.draw(X.descriptor,fe)}}}var ke=ObjectsUtil.get("util.core.DomUtil").position(this.focalNode,!0);this.focalNode.style.height=q+20+"px",this._incomplete=!1,this.refreshBoundaries();var Se=ShapesRegistry.get("Part"),we=ShapesRegistry.getAndGroup("Part");this.adjustShapes(r||{},we,Se)}},adjustShapes:function(e,t,r,a){var n=[];for(var o in r){var u=r[o],s=u.getPosition(),d=this._adjustShapes(r[o],e,n,a);if(d&&(d=d-5,u.shiftPosition({x:-(a?d-a:d)})),t){var c=t[u.name];for(var f in c){var C=c[f],m=C.getPosition();for(var E in c)if(E!==f){var S=c[E],P=S.getPosition();if(!(P.x>m.x||Math.abs(P.y-m.y)>50)){for(var N=P.x+P.w,R=0,g;g=S.children[R];R++)if(g.className==="layout.shapes.Port"){var v=parseFloat(g.labelNode.getAttribute("x")),M=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(g.labelNode.childNodes[0].textContent+"...",g.labelNode).w,L=v+M;L>N&&(N=L)}var T=this._adjustShapes(C,e,[],N);T!=m.x&&(T=N-T,C.shiftPosition({x:T}))}}}}}},_adjustShapes:function(e,t,r,a,n){if(!(t[e.id]||r.indexOf(e)>-1)){r.push(e);for(var o=e.getPosition(),u=a||0,s=0,d;d=e.children[s];s++)if(d.className==="layout.shapes.Port"){var c=parseFloat(d.labelNode.getAttribute("x"));c<u&&(u=c)}else if(d.className==="layout.shapes.Part"){var f=this._adjustShapes(d,t,r);if(f<u){var C=d.getPosition();C.x=C.x-f,d.setPosition(C)}}return u}},refreshBoundaries:function(){for(var e=ObjectsUtil.get("util.core.DomUtil").position(this.focalNode,!0),t=e.y+e.h,r=e.x+e.w,a=this.getChildren("partNode"),n=0,o=0,u=0,s;s=a[u];u++)if(s.className==="layout.shapes.Part"){var d=s.getPosition(),r=d.x+d.w;r>o&&(o=r),t=d.y+d.h+20,t>n&&(n=t);var t=d.y+d.h;t>n&&(n=t);for(var c=s.getChildren(),f=0,C;C=c[f];f++){if(C.labelNode){var m=ObjectsUtil.get("util.core.DomUtil").position(C.labelNode);r=m.x+m.w,r>o&&(o=r),t=m.y+m.h,t>n&&(n=t)}for(var E=C.getChildren(),S=0,P;P=E[S];S++)P.labelNode&&(m=ObjectsUtil.get("util.core.DomUtil").position(P.labelNode),r=m.x+m.w,r>o&&(o=r),t=m.y+m.h,t>n&&(n=t))}}var N=parseFloat(this.focalNode.style.height);Math.abs(n-N)>1&&(this.focalNode.style.height=n+10+"px");var R=parseFloat(this.focalNode.style.width);Math.abs(o-R)>1&&(this.focalNode.style.width=o+10+"px")}}),ObjectsUtil.declare("layout.shapes.Part",["layout.shapes.StructureDiagramNode"],{isStructureDiagram:null,multiplicity:null,children:null,focalNode:null,guid:null,iconPart:null,name:null,parent:null,color:null,fontColor:null,rx:null,parentNode:null,strokeWidth:null,height:null,width:null,yCoord:null,xCoord:null,_moving:null,type:null,constructor:function(e){this.isStructureDiagram=e.isStructureDiagram,this.multiplicity=e.multiplicity,this.type="partNode",this.parent=e.parent,this.children=[],this.name=e.name||"Node"+incremntal,this.guid=e.id||this.name,this.color=e.color||DEFAULT_COLOR,this.fontColor=e.fontColor||DEFAULT_FONT_COLOR,this.rx=e.rx||DEFAULT_ROUND_RATIO,this.strokeWidth=e.strokeWidth||1,this.strokeWidth=this.strokeWidth+"px",incremntal++},addChild:function(e){var t=ObjectsUtil.get("util.core.CoreUtil");if(t.isArray(e))for(var r=0,a;a=e[r];r++)this.children.push(a);else this.children.push(e);this.applyConstraints()},getChildren:function(e,t){if(e){for(var r=[],a=0,n;n=this.children[a];a++)if(n.type===e){var o=!0;if(t){for(var u in t)if(t[u]?t[u]!==n[u]:n[u]){o=!1;break}}o&&r.push(n)}return r}return this.children},draw:function(e){var t=this.getSuperContainer().settings;this.part_highlight_color=t.part_highlight_color||"#5DBCD2",this.part_container_highlight_color=t.part_container_highlight_color||"#FFFFFF",this.part_container_label_highlight_color=t.part_container_label_highlight_color||"#e6e6e6";var r=ObjectsUtil.get("util.core.CoreUtil"),a=ObjectsUtil.get("util.core.DomUtil");this.focalNode=document.createElementNS(SVGUtil.SVG,"g");var n=Events.connect("mousemove",this.focalNode,this,function(u){if(!this.__resizeStarted){var s=this,d=function(){delete s.__resizeStarted,Events.disconnect(s._tempResizeMouseUpHandler),Events.disconnect(s._tempResizeMouseDownHandler),Events.disconnect(s._tempResizeMouseMoveHandler),s.focalNode.style.cursor="",delete s._tempResizeMouseDownHandler},c=!1,f=a.position(this.focalNode),C=f.x+f.w,m=u.clientX-C;if(Math.abs(m)<10)this.focalNode.style.cursor="col-resize",c=!0;else{var E=f.y+f.h,S=u.clientY-E;Math.abs(S)<10&&(this.focalNode.style.cursor="row-resize",c=!0)}Events.disconnect(this._tempResizeMouseDownHandler),Events.disconnect(this._tempResizeMouseOutHandler),c?(this._tempResizeMouseDownHandler=Events.connect("mousedown",document,this,function(P){this.__resizeStarted&&d(),Events.disconnect(this._tempResizeMouseOutHandler),r.stopEvent(P),this.__resizeStarted=!0,this._tempResizeMouseUpHandler=Events.connect("mouseup",document,this,function(N){r.stopEvent(N),d(),this.getSuperContainer().refreshBoundaries()}),this._tempResizeMouseMoveHandler=Events.connect("mousemove",document,this,function(N){if(r.stopEvent(N),!this._tempResizeMouseDownHandler){d();return}for(var R=this.getChildren(),g=0,v=0,M=0,L;L=R[M];M++)if(L.className==="layout.shapes.Part"){var T=a.position(L.focalNode),A=T.x+T.w;A>v&&(v=A);var j=T.y+T.h;j>g&&(g=j)}var k={},U=a.position(this.focalNode),_=!1;this._tempResizeMouseDownHandler.verticalDiff?N.clientY>g&&(k.h=N.clientY-U.y,_=!0):this._tempResizeMouseDownHandler.horizontalDiff&&N.clientX>v&&(k.w=N.clientX-U.x,_=!0),_&&this.setPosition(k)})}),this._tempResizeMouseDownHandler.horizontalDiff=m,this._tempResizeMouseDownHandler.verticalDiff=S,this._tempResizeMouseOutHandler=Events.connect("mouseout",this.focalNode,this,function(P){d()})):d()}});this.focalNode.setAttribute("style","fill: "+this.color+"; font-family:'sans-serif';"),this.parentNode.appendChild(this.focalNode),this.rectNode=document.createElementNS(SVGUtil.SVG,"rect"),this.rectNode.setAttribute("style","stroke:#000000;"),this.rectNode.setAttribute("fill","#FFFFFF"),this.focalNode.appendChild(this.rectNode),this.highlightNode=document.createElementNS(SVGUtil.SVG,"rect"),this.highlightNode.setAttribute("style","stroke:#000000;"),this.isStructureDiagram?this.highlightNode.setAttribute("fill",this.part_container_highlight_color):this.highlightNode.setAttribute("fill",this.part_highlight_color),this.focalNode.appendChild(this.highlightNode),this.nameNode=document.createElementNS(SVGUtil.SVG,"text"),this.nameNode.setAttribute("style","fill: #000000;  font-family:tahoma; font-size: 10; font-weight:bold"),this.nameNode.appendChild(document.createTextNode(e.name)),this.focalNode.appendChild(this.nameNode),this.isStructureDiagram||(this.iconPart=ShapesRegistry.draw("PartIcon",{parentNode:this.focalNode})),this.setPosition({x:e.x,y:e.y,h:e.h,w:e.w});var o=Events.connect("mousedown",this.focalNode,this,function(u){this._tempResizeMouseDownHandler||this.handleMove(this.focalNode,u)}),o=Events.connect("mousedown",this.highlightNode,this,function(u){this._tempResizeMouseDownHandler||this.handleMove(this.focalNode,u)})},updatePosition:function(e){var t=ObjectsUtil.get("util.core.DomUtil").transformValue(this.focalNode);if(t.h=parseFloat(this.rectNode.getAttribute("height")),t.w=parseFloat(this.rectNode.getAttribute("width")),e.h&&(t.h=t.h+e.h),e.w){t.w=t.w+e.w;for(var r=this.getChildren("portNode"),a=0,n;n=r[a];a++)StructureDiagramUtil.portToPart(n,function(o,u,s,d){if(s==="right"){var c=n.getPosition();n.shiftPosition({x:e.w},!0)}})}this.setPosition(t,!0)},shiftPosition:function(e,t){var r={x:this.xCoord,y:this.yCoord,h:this.height,w:this.width};for(var a in e)r[a]=(r[a]||0)+e[a];this.setPosition(r,t)},setPosition:function(e,t){var r=ObjectsUtil.get("util.core.CoreUtil"),a=this.getPosition(),n=parseFloat(e.x)||this.xCoord||0,o=parseFloat(e.y)||this.yCoord||0,u=parseFloat(e.h)||this.height||40,s=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(this.nameNode.childNodes[0].textContent+"...",this.nameNode).w,d=parseFloat(e.w)||this.width||s+75;if(u<40&&(u=40),d<s+75&&(d=s+75),this.highlightNode.setAttribute("height",20),this.highlightNode.setAttribute("width",d),this.rectNode.setAttribute("height",u),this.rectNode.setAttribute("width",d),this.isStructureDiagram||this.iconPart.setPosition({x:d-25,y:6}),this.focalNode.setAttribute("transform","translate("+n+","+o+")"),!this.isStructureDiagram&&this.multiplicity==="*"&&(this.shadowNode||(this.shadowNode=document.createElementNS(SVGUtil.SVG,"rect"),this.shadowNode.setAttribute("style","stroke:#000000;"),this.shadowNode.setAttribute("fill","none"),this.focalNode.insertBefore(this.shadowNode,this.focalNode.firstChild)),this.shadowNode.setAttribute("transform","translate(3,-3)"),this.shadowNode.setAttribute("height",u),this.shadowNode.setAttribute("width",d)),this.nameNode.setAttribute("y","15"),this.isStructureDiagram){this.nameNode.setAttribute("x","15"),this.nameNode.highlight?(this.nameNode.parentNode.removeChild(this.nameNode.highlight),this.nameNode.parentNode.insertBefore(this.nameNode.highlight,this.nameNode),this.nameNode.parentNode.removeChild(this.nameNode.highlight.border),this.nameNode.parentNode.insertBefore(this.nameNode.highlight.border,this.nameNode)):(this.nameNode.highlight=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.nameNode.highlight.setAttribute("style","fill:"+this.part_container_label_highlight_color+";"),this.nameNode.parentNode.insertBefore(this.nameNode.highlight,this.nameNode),this.nameNode.highlight.border=document.createElementNS(SVGUtil.SVG,"polygon"),this.nameNode.highlight.border.setAttribute("style","stroke:black;stroke-width:1;"),this.nameNode.parentNode.insertBefore(this.nameNode.highlight.border,this.nameNode)),this.nameNode.highlight.setAttribute("x","1"),this.nameNode.highlight.setAttribute("y","1"),this.nameNode.highlight.setAttribute("width",s+10),this.nameNode.highlight.setAttribute("height",18);var c=0,f=0;!r.browserSettings()||r.browserSettings().browser!=="chrome"?(c=2,f=18):(c=0,f=20),this.nameNode.highlight.border.setAttribute("points",s+11+","+c+" "+(s+11)+","+f)}else this.nameNode.setAttribute("x",d/2-s/2);if(!t){var C=this.getPosition(),m=C.x-a.x,E=C.y-a.y;if(m!==0||E!==0)for(var S=0,P;P=this.children[S];S++)(P.className==="layout.shapes.Port"||P.className==="layout.shapes.Part")&&P.shiftPosition({x:m,y:E});this.applyConstraints()}if(this.xCoord=n,this.yCoord=o,this.height=u,this.width=d,this.container&&this.container.getPrecisePosition){var N=this.container.getPrecisePosition(),R=this.yCoord+this.height,g=this.xCoord+this.width,v=N.y+N.h-20,M=N.x+N.w-20,L=R-v,T=g-M;if(L>0||T>0){var A={},j=!1;L>0&&(A.h=L+20,j=!0),T>10&&(A.w=T+20,j=!0),j&&this.container.shiftPosition(A)}}this.refreshBoundaries()},refreshBoundaries:function(){var e=this.getSuperContainer();e._incomplete||e.refreshBoundaries()},getPosition:function(){var e=ObjectsUtil.get("util.core.DomUtil"),t=e.position(this.focalNode,!0),r=this.focalNode.getBoundingClientRect(),a=this.focalNode.parentNode.parentNode.getBoundingClientRect();t.x=r.left-a.left,t.y=r.top-a.top,t.y=t.y+8-parseInt(window.getComputedStyle(this.focalNode.parentNode.parentNode,null).getPropertyValue("padding-top")),t.x=t.x+8-parseInt(window.getComputedStyle(this.focalNode.parentNode.parentNode,null).getPropertyValue("padding-left"));var n=e.getFirstParent(this.focalNode,"svg").parentNode,o=n.scrollLeft,u=n.scrollTop;return t.x=t.x+(o||0),t.y=t.y+(u||0),this.shadowNode&&(t.w=t.w-3,t.h=t.h-3),t},getPrecisePosition:function(){return{h:this.height,w:this.width,y:this.yCoord,x:this.xCoord}},applyConstraints:function(){if(!this._incomplete){for(var e=this.getPosition(),t=this.getPosition(),r=0,a=0,n;n=this.children[a];a++)n.className==="layout.shapes.Port"?n.applyConstraints():n.className;t.w!==e.w&&this.setPosition(t,!0)}},handleMove:function(e,t){var r=ObjectsUtil.get("util.core.DomUtil"),a=ObjectsUtil.get("util.core.CoreUtil"),n=r.getFirstParent(e,"svg"),o=e.parentNode.getScreenCTM(),u=n.createSVGPoint();u.x=t.clientX,u.y=t.clientY,u=u.matrixTransform(o.inverse());var s=this.getPrecisePosition(),d=parseFloat(u.x)-parseFloat(s.x),c=parseFloat(u.y)-parseFloat(s.y),f;this.container.getPrecisePosition&&(f=this.container.getPrecisePosition()),this._moving=e;var C=Events.connect("onselectstart",document,this,function(S){a.stopEvent(S)}),m=Events.connect("mousemove",document,this,function(S){var P=this,N=e.parentNode.getScreenCTM(),R=n.createSVGPoint();R.x=S.clientX,R.y=S.clientY,R=R.matrixTransform(N.inverse());var g={},v=P.getPrecisePosition();g.y=R.y,g.x=R.x;var M=P.container[P.container.getPrecisePosition?"getPrecisePosition":"getPosition"]();if(!(g.x-d<M.x)&&!(g.y-c<M.y)&&(P.setPosition({x:g.x-d,y:g.y-c}),f)){var M=P.container.getPrecisePosition(),L=P.yCoord+P.height,T=P.xCoord+P.width,A=f.y+f.h,j=f.x+f.w,k=L-A,U=T-j;k<0&&U<0&&P.container.setPosition(f)}}),E=Events.connect("mouseup",document,this,function(){Events.disconnect(m),Events.disconnect(E),Events.disconnect(C),this._moving=void 0,this.getSuperContainer().refreshBoundaries(),Events.publish("structure.diagram.node.move."+this.id)});a.stopEvent(t)}});var ICON_WIDTH=12,ICON_HEIGHT=10;ObjectsUtil.declare("layout.shapes.PartIcon",["layout.shapes.AbstractNode"],{draw:function(e){this.iconNode=document.createElementNS(SVGUtil.SVG,"rect"),this.iconNode.setAttribute("style","stroke:#000000;"),this.iconNode.setAttribute("height",ICON_HEIGHT),this.iconNode.setAttribute("width",ICON_WIDTH),this.iconNode.setAttribute("fill","none"),this.parentNode.appendChild(this.iconNode)},setPosition:function(e){var t=parseFloat(e.x)||0,r=parseFloat(e.y)||0,a=2,n=1,o=2,u=6;this.iconNode.setAttribute("x",t),this.iconNode.setAttribute("y",r),this.iconNodePart1?this.parentNode.removeChild(this.iconNodePart1):this.iconNodePart1=document.createElementNS(SVGUtil.SVG,"rect"),this.iconNodePart1.setAttribute("style","stroke:#000000;"),this.iconNodePart1.setAttribute("height",o),this.iconNodePart1.setAttribute("width",u),this.iconNodePart1.setAttribute("y",r+a),this.iconNodePart1.setAttribute("x",t-u/2),this.iconNodePart1.setAttribute("fill","#5DBCD2"),this.parentNode.appendChild(this.iconNodePart1),this.iconNodePart2?this.parentNode.removeChild(this.iconNodePart2):this.iconNodePart2=document.createElementNS(SVGUtil.SVG,"rect"),this.iconNodePart2.setAttribute("style","stroke:#000000;"),this.iconNodePart2.setAttribute("height",o),this.iconNodePart2.setAttribute("width",u),this.iconNodePart2.setAttribute("y",r+a+o+a),this.iconNodePart2.setAttribute("x",t-u/2),this.iconNodePart2.setAttribute("fill","#5DBCD2"),this.parentNode.appendChild(this.iconNodePart2)}});var PortSymbols=ObjectsUtil.define("layout.shapes.Port.PortSymbols",{right:function(e){e.symbol=document.createElementNS(SVGUtil.SVG,"polygon"),e.symbol.setAttribute("points","8,2 2.5,5 8,8"),e.symbol.setAttribute("style","fill:black;stroke:#000000;stroke-width:1"),e.containerNode.appendChild(e.symbol)},left:function(e){e.symbol=document.createElementNS(SVGUtil.SVG,"polygon"),e.symbol.setAttribute("points","2.5,2 8,5 2.5,8"),e.symbol.setAttribute("style","fill:#000000;stroke:#000000;stroke-width:1"),e.containerNode.appendChild(e.symbol)},twoArrows:function(e){var t=function(r,a,n,o){var u=document.createElementNS(SVGUtil.SVG,"line");u.setAttribute("x1",r),u.setAttribute("y1",a),u.setAttribute("x2",n),u.setAttribute("y2",o),u.setAttribute("style","fill:#000000;stroke:#000000;stroke-width:1"),e.containerNode.appendChild(u)};t("4","2","8.5","4"),t("1.5","4","8.5","4"),t("1.5","6","8.5","6"),t("1.5","6","6","8")},conjugated:function(e){var t=PortSymbols._drawCircleSymbol(e,"Conjucated port");t.setAttribute("style","stroke: black;")},conjugatedReplicated:function(e){var t=PortSymbols._drawCircleSymbol(e,"Conjucated replicated port");t.setAttribute("style","stroke: black;"),e.set3D()},replicatedEndPort:function(e){PortSymbols.endPort(e,"Replicated end port"),e.set3D()},endPort:function(e,t){var r=PortSymbols._drawCircleSymbol(e,t||"End port"),a=e.focalNode.getAttribute("fill");r.setAttribute("style","stroke: "+a+";"),r.setAttribute("fill",a),e.focalNode.setAttribute("fill","#000000")},conjucatedReplicatedRelayPort:function(e){var t=PortSymbols._drawRectSymbol(e,"Conjucated replicated relay port");t.setAttribute("style","stroke: black;"),e.set3D()},conjucatedRelayPort:function(e){var t=PortSymbols._drawRectSymbol(e,"Conjucated relay port");t.setAttribute("style","stroke: black;")},replicatedRelayPort:function(e){PortSymbols.relayPort(e,"Replicated relay port"),e.set3D()},relayPort:function(e,t){var r=PortSymbols._drawRectSymbol(e,t||"Relay port");r.setAttribute("style","stroke: black;");var a=e.focalNode.getAttribute("fill");r.setAttribute("style","stroke: "+a+";"),r.setAttribute("fill",a),e.focalNode.setAttribute("fill","#000000")},_drawCircleSymbol:function(e,t){var r=document.createElementNS(SVGUtil.SVG,"circle");return r.setAttribute("fill","#000000"),r.setAttribute("r",3),r.setAttribute("cx",5),r.setAttribute("cy",5),e.containerNode.appendChild(r),PortSymbols._appendTooltip(t,e,r),r},_drawRectSymbol:function(e,t){var r=document.createElementNS(SVGUtil.SVG,"rect");return r.setAttribute("fill","#000000"),r.setAttribute("height",4),r.setAttribute("width",4),r.setAttribute("x",3),r.setAttribute("y",3),e.containerNode.appendChild(r),PortSymbols._appendTooltip(t,e,r),r},_appendTooltip:function(e,t,r){e&&(r.titleElement=document.createElementNS(SVGUtil.SVG,"title"),t.focalNode.appendChild(r.titleElement),r.titleElement.appendChild(document.createTextNode(e)),r.titleElement=document.createElementNS(SVGUtil.SVG,"title"),r.appendChild(r.titleElement),r.titleElement.appendChild(document.createTextNode(e)))}}),ConnectorSymbols=ObjectsUtil.define("layout.shapes.connector.ConnectorSymbols",{draw:function(e,t,r,a){return ConnectorSymbols._draw(e,t,r,a)},_draw:function(e,t,r,a){if(e.connectorSymbol)e.parentNode.removeChild(e.connectorSymbol),e.parentNode.appendChild(e.connectorSymbol);else{e.connectorSymbol=document.createElementNS(SVGUtil.SVG,"g"),e.connectorSymbol.setAttribute("fill","none");var n=5,o=4,u="";t.indexOf("provide")>-1&&(e.connectorSymbol.path=document.createElementNS(SVGUtil.SVG,"path"),e.connectorSymbol.path.setAttribute("style","stroke: #000000;"),e.connectorSymbol.appendChild(e.connectorSymbol.path),u="Provide"),t.indexOf("require")>-1&&(e.connectorSymbol.circle1=document.createElementNS(SVGUtil.SVG,"circle"),e.connectorSymbol.circle1.setAttribute("style","stroke: black;"),e.connectorSymbol.circle1.setAttribute("r",n),e.connectorSymbol.appendChild(e.connectorSymbol.circle1),e.connectorSymbol.setAttribute("fill","white"),u&&(u=u+"\\"),u=u+"Require"),u&&(e.connectorSymbol.title=document.createElementNS(SVGUtil.SVG,"title"),e.connectorSymbol.appendChild(e.connectorSymbol.title),e.connectorSymbol.title.appendChild(document.createTextNode(u))),e.parentNode.appendChild(e.connectorSymbol)}if(e.connectorSymbol.path){var n=5,o=4,s=n+o,d=s*-1;if(a)if(r==="vertical")var c=d+",0",f=s+",0";else var c="0,"+d,f="0,"+s;else if(r==="vertical")var f=d+",0",c=s+",0";else var f="0,"+d,c="0,"+s;var C="M"+c+(" A"+n+","+n)+" 0 0,1 "+f;e.connectorSymbol.path.setAttribute("d",C)}return e.connectorSymbol}}),LABEL_FONT_SETTINGS={fontSize:10,fontFamily:"arial, serif",fontWeight:"normal"};ObjectsUtil.declare("layout.shapes.Port",["layout.shapes.StructureDiagramNode"],{focalNode:null,guid:null,isPrivate:null,connectors:null,name:null,color:null,fontColor:null,rx:null,parentNode:null,strokeWidth:null,_moving:null,type:null,portType:null,constructor:function(e){this.type="portNode",this.isPrivate=e.isPrivate==="true"||e.isPrivate===!0,this.multiplicity=e.multiplicity,this.connectors={sources:[],targets:[]},this.portType=e.portType,this.name=e.name||"Node"+incremntal,this.guid=e.id||this.name,this.color=e.color||DEFAULT_COLOR,this.fontColor=e.fontColor||DEFAULT_FONT_COLOR,this.rx=e.rx||DEFAULT_ROUND_RATIO,this.strokeWidth=e.strokeWidth||1,this.strokeWidth=this.strokeWidth+"px",incremntal++},addConnector:function(e,t){var r=ObjectsUtil.get("util.core.CoreUtil");if(r.isArray(e))for(var a=0,n;n=e[a];a++)this.connectors[t].indexOf(n)>-1||this.connectors[t].push(n);else this.connectors[t].indexOf(e)==-1&&this.connectors[t].push(e)},draw:function(args){var settings=this.getSuperContainer().settings;this.portFillColor=settings.portFillColor||"#FFFFCC",this.containerNode=document.createElementNS(SVGUtil.SVG,"g"),this.parentNode.appendChild(this.containerNode),this.focalNode=document.createElementNS(SVGUtil.SVG,"rect"),this.focalNode.setAttribute("style","stroke:#000000;"),this.focalNode.setAttribute("height","10"),this.focalNode.setAttribute("width","10"),this.focalNode.setAttribute("fill",this.portFillColor),this.containerNode.appendChild(this.focalNode);var CoreUtil=ObjectsUtil.get("util.core.CoreUtil"),DomUtil=ObjectsUtil.get("util.core.DomUtil"),typeSymbol=args.typeSymbol;if(typeSymbol){if(typeSymbol.indexOf("(function")>-1){var typeSymboleEval=eval(typeSymbol);CoreUtil.isFunction(typeSymboleEval)&&typeSymboleEval(this)}}else{var portType=args.portType,mappedFunction=PortSymbols[portType];mappedFunction&&mappedFunction(this)}this.labelNode=document.createElementNS(SVGUtil.SVG,"text"),this.labelNode.setAttribute("style","fill: #000000;  font-family:"+LABEL_FONT_SETTINGS.fontFamily+"; font-size: "+LABEL_FONT_SETTINGS.fontSize+";  font-weight:"+LABEL_FONT_SETTINGS.fontWeight+";");var portLabelText=args.name;args.multiplicity!==void 0&&(portLabelText=portLabelText+"["+args.multiplicity+"]"),this.labelNode.appendChild(document.createTextNode(portLabelText)),this.parentNode.appendChild(this.labelNode);var partObject=this.container;if(args.x!==void 0&&args.y!==void 0)this.setPosition({x:args.x,y:args.y},!0);else if(!this.isPrivate){for(var x,y,delta,position=partObject.getPosition(),portPosition=this.getPosition(),children=partObject.getChildren("portNode",{isPrivate:void 0}),adjustedLength=children.length,w=this.getPosition().w,direction=children.length%10,partMax=position.x+position.w,index=0,child;child=children[index];index++)StructureDiagramUtil.portToPart(child,function(e,t,r,a){if(!(r==="right"||r==="left")){var n=DomUtil.calculateTextSize(child.labelNode.childNodes[0].textContent,child.labelNode).w,o=child.getPosition(),u=child.getPosition().x,s=u+n/2;if(!(partMax<s+o.w*2||partMax<u+o.w*2)){var d=n/2+w/2,c=position.w/6;d>position.w/5-15&&direction++,d>position.w/4&&direction++}}});var self=this;if(direction<10){var directionFinder=function(e,t){e===0?(delta=position.h/2/2-5,x=position.x-portPosition.w,y=position.y+position.h/2-portPosition.h-delta):e===1?(delta=position.h/2/2,x=position.x-portPosition.w,y=position.y+position.h/2-portPosition.h+delta):e===2?(delta=position.w/2/2,x=position.x-portPosition.w+position.w/2-delta,y=position.y-portPosition.h):e===3?(x=position.x-portPosition.w+position.w/2,y=position.y-portPosition.h):e===4?(delta=position.w/2/2,x=position.x-portPosition.w+position.w/2+delta,y=position.y-portPosition.h):e===5?(delta=position.h/2/2,x=position.x+position.w-portPosition.w,y=position.y+position.h/2-portPosition.h-delta):e===6?(delta=position.h/2/2,x=position.x+position.w-portPosition.w,y=position.y+position.h/2-portPosition.h+delta):e===7?(delta=position.w/2/2,x=position.x-portPosition.w+position.w/2-delta,y=position.y+position.h-portPosition.h):e===8?(x=position.x-portPosition.w+position.w/2,y=position.y+position.h-portPosition.h):e===9&&(delta=position.w/2/2,x=position.x-portPosition.w+position.w/2+delta,y=position.y+position.h-portPosition.h)};directionFinder(direction)}else{var start=children.length-10,direction=start%8,endY=position.y+position.h-20;if(direction<6){var byIndex=(parseFloat(direction/2)+(start-direction+1)/3)*portPosition.h;byIndex||(byIndex=4);var delta=parseInt(start/8)+byIndex+portPosition.h*2,right=direction%2;if(right)var x=position.x-portPosition.w+position.w;else{var x=position.x-portPosition.w,y=position.y+position.h/2-portPosition.h+delta,diff=y-endY;diff>0&&partObject.updatePosition({h:diff})}var updatedPosition=partObject.getPosition(),y=updatedPosition.y+updatedPosition.h-portPosition.h*2+4}else if(direction%2===0){var x=position.x+position.w-portPosition.w/2,y=position.y-portPosition.h;partObject.updatePosition({w:30})}else var x=position.x+position.w-parseFloat(portPosition.w*3),y=position.y+position.h-portPosition.h}for(var childIndex=0,child;child=children[childIndex];childIndex++)child.applyConstraints();this.setPosition({x,y})}this.applyConstraints();var mouseDownHandler=Events.connect("mousedown",this.containerNode,this,function(e){this.handleMove(this.focalNode,e)}),mouseDownHandler=Events.connect("mousedown",this.labelNode,this,function(e){this.handleMove(this.focalNode,e)})},setPosition:function(e,t){xCoord=parseFloat(e.x)||0,yCoord=parseFloat(e.y)||0,this.containerNode.setAttribute("transform","translate("+xCoord+","+yCoord+")"),this.multiplicity==="*"&&this.set3D();var r=this;StructureDiagramUtil.portToPart(this,function(n,o,u,s){if(u==="right")r.labelNode.setAttribute("x",n+2),r.labelNode.setAttribute("y",o-1);else if(u==="top"){var d=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(r.labelNode.childNodes[0].textContent,r.focalNode);r.labelNode.setAttribute("x",n-parseFloat(d.w/2)),r.labelNode.setAttribute("y",o-parseFloat(s.h/2))}else if(u==="left"){var d=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(r.labelNode.childNodes[0].textContent,r.labelNode);r.labelNode.setAttribute("x",parseFloat(n-(d.w+s.w))),r.labelNode.setAttribute("y",o)}else if(u==="bottom"){var d=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(r.labelNode.childNodes[0].textContent,r.focalNode);r.labelNode.setAttribute("x",n-parseFloat(d.w/2)),r.labelNode.setAttribute("y",o+parseFloat(s.h))}t||r.applyConstraints()});var a=r.labelNode.parentNode;a.removeChild(r.labelNode),a.appendChild(r.labelNode)},set3D:function(){this.shadowNode||(this.shadowNode=document.createElementNS(SVGUtil.SVG,"rect"),this.shadowNode.setAttribute("style","stroke:#000000;"),this.shadowNode.setAttribute("fill",this.portFillColor||"#FFFFFF"),this.containerNode.insertBefore(this.shadowNode,this.containerNode.firstChild)),this.shadowNode.setAttribute("transform","translate(1,-2)"),this.shadowNode.setAttribute("height",11),this.shadowNode.setAttribute("width",11)},applyConstraints:function(){var e=this.container;if(!(!e||e._incomplete)){var t=ObjectsUtil.get("util.core.CoreUtil"),r=this.getPosition(),a=e.getPosition();if(this.isPrivate){var n=!1,o=a.x+a.w-r.w-r.w,u=a.x+r.w,s=a.y+a.h-r.h-r.h,d=a.y+r.h,c=t.clone(r);c.x<u?(c.x=u,n=!0):c.x>o&&(c.x=o,n=!0),c.y<d?(c.y=d,n=!0):c.y>s&&(c.y=s,n=!0),n&&this.setPosition(c,!0)}else{var f=!0,c=t.clone(r),C=function(){var M=a.y-r.h,L=a.y+a.h-r.h,T=Math.abs(c.y-M),A=Math.abs(c.y-L);A<=T?c.y=L:c.y=M};if(r.x<a.x-r.w)c.x=a.x-r.w;else if(r.x>a.x+a.w-r.w)c.x=a.x+a.w-r.w;else{var m=a.x+a.w-r.w,E=a.x-r.w,S=c.x;StructureDiagramUtil.portToPart(this,function(M,L,T,A,j,k){j?C():T==="bottom"?Math.abs(k.deltaBottom)>1&&(c.y=c.y+k.deltaBottom):T==="top"?Math.abs(k.deltaTop)>1&&(c.y=c.y-k.deltaTop):T==="right"?Math.abs(k.deltaRight)>1&&(c.x=c.x+k.deltaRight):T==="left"&&Math.abs(k.deltaLeft)>1&&(c.x=c.x-k.deltaLeft)}),f=!1}if(f){var m=a.y+a.h-r.h,E=a.y-r.h,S=r.y-r.h;(S<E||S>m)&&C()}var P=a.x-r.w,N=a.x+a.w-r.w,R=a.y-r.h,g=a.y+a.h-r.h;c.x<P&&(c.x=P),c.x>N&&(c.x=N),c.y<R&&(c.y=R),c.y>g&&(c.y=g),(parseInt(c.x)!==parseInt(r.x)||parseInt(c.y)!==parseInt(r.y)||parseInt(c.h)!==parseInt(r.h)||parseInt(c.w)!==parseInt(r.w))&&this.setPosition(c,!0)}}},getPosition:function(){var e=ObjectsUtil.get("util.core.DomUtil").transformValue(this.containerNode);return e.w=13,e.h=13,e},handleMove:function(e,t){var r=ObjectsUtil.get("util.core.DomUtil"),a=ObjectsUtil.get("util.core.CoreUtil"),n=r.getFirstParent(e,"svg"),o=e.parentNode.getScreenCTM(),u=n.createSVGPoint(),s=r.scrollValue(e);u.x=t.clientX+s.x,u.y=t.clientY+s.y,u=u.matrixTransform(o.inverse());var d=this.getPosition(),c=parseFloat(u.x)-parseFloat(d.x),f=parseFloat(u.y)-parseFloat(d.y);this._moving=e;var C=Events.connect("onselectstart",document,this,function(S){a.stopEvent(S)}),m=Events.connect("mousemove",document,this,function(S){var P=this,N=e.parentNode.getScreenCTM(),R=n.createSVGPoint();R.x=S.clientX,R.y=S.clientY,R=R.matrixTransform(N.inverse());var g={};this.isPrivate?(g.y=R.y,g.x=R.x):StructureDiagramUtil.portToPart(this,function(v,M,L,T,A){A?(g.y=R.y,g.x=R.x):L==="left"||L==="right"?g.y=R.y:g.x=R.x}),P.shiftPosition(g),a.stopEvent(S)}),E=Events.connect("mouseup",document,this,function(){Events.disconnect(m),Events.disconnect(E),Events.disconnect(C),this._moving=void 0,this.getSuperContainer().refreshBoundaries(),Events.publish("structure.diagram.node.move."+this.id)});a.stopEvent(t)}});var Events=ObjectsUtil.get("util.core.Events"),incremntal=0,sources=[];ObjectsUtil.declare("layout.shapes.PortConnector",["layout.shapes.StructureDiagramNode"],{focalNode:null,guid:null,name:null,color:null,fontColor:null,rx:null,parentNode:null,strokeWidth:null,_moving:null,type:null,connectorType:null,constructor:function(e){this.connectorType=e.connectorType,this.type="portConnector",this.name=e.name||"Connector"+incremntal,this.guid=e.id||this.name,this.sources=e.sources,this.targets=e.targets,this.part=e.part,incremntal++,this.points=e.points},draw:function(e){var t=["red","green","blue","brown","black","orange","lime"],t=["black","black","black","black","black","black","black","black"];sources.indexOf(this.sources[0])===-1&&sources.push(this.sources[0]);var r=t[sources.indexOf(this.sources[0])];if(this.focalNode=document.createElementNS(SVGUtil.SVG,"polyline"),this.focalNode.setAttribute("style","fill:none;stroke:"+r+";stroke-width:1px;"),this.parentNode.appendChild(this.focalNode),this.points)this.focalNode.setAttribute("points",this.points);else{this.setPosition();for(var a=0,n;n=["sources","targets"][a];a++)for(var o=0,u;u=this[n][o];o++){var s=ShapesRegistry.get("Port",u);s.addConnector(this,n),Events.connect("setPosition",s,this,function(d){this.setPosition(d)}),this.container.applyConstraints()}}},setPosition:function(e){if(this.sources[0]===this.targets[0])return this.focalNode.setAttribute("points","");var t=[],r=this.targets[0],a=this.sources[0],n=ShapesRegistry.get("Port",r),o=ShapesRegistry.get("Port",a);if(n.getPosition().x<o.getPosition().x){var u=a;a=r,r=u}var s=function(B,X,ie){t.push({x:B,y:X,direction:ie})},d=function(B){B.direction==="left"?(B.x=B.x,B.y=B.y+5):B.direction==="right"?(B.x=B.x+10,B.y=B.y+5):B.direction==="top"?(B.x=B.x+5,B.y=B.y):B.direction==="bottom"&&(B.y=B.y+10,B.x=B.x+5)},c=ShapesRegistry.get("Port",a),f=c.container,C=f.getPosition(),m=c.getPosition();StructureDiagramUtil.portToPart(a,s);var E=ShapesRegistry.get("Port",r),S=E.container,P=S.getPosition(),N=E.getPosition();StructureDiagramUtil.portToPart(r,s);var R=f===S,F=[],g=t[0];if(t[0]){m.direction=g.direction;var v=t[1];if(v){N.direction=v.direction;var M=c.getPosition(),L=E.getPosition(),T=!1,A=this,j=function(B,X,ie,ee){X.isPrivate?ee.direction==="left"?B.direction="right":ee.direction==="top"?B.direction="bottom":ee.direction==="bottom"?B.direction="top":ee.direction==="right"&&(B.direction="left"):X.parent===A.part&&(ie.isPrivate||ie.parent!==A.part)&&(B.direction==="left"?B.direction="right":B.direction==="top"?B.direction="bottom":B.direction==="bottom"?B.direction="top":B.direction==="right"&&(B.direction="left"))};c.isPrivate?(j(N,E,c,m),j(m,c,E,N)):(j(m,c,E,N),j(N,E,c,m));var k=m.direction,U={x:N.x,y:N.y,direction:N.direction};d(U);var _={x:U.x,y:U.y},Q={x:m.x,y:m.y,direction:m.direction},W=function(B){var X={};return B.direction==="left"?(X.x=B.x-10,X.y=B.y):B.direction==="right"?(X.x=B.x+10,X.y=B.y):B.direction==="top"?(X.x=B.x,X.y=B.y-10):B.direction==="bottom"&&(X.x=B.x,X.y=B.y+10),X.direction=B.direction,X},F=[],p={x:m.x,y:m.y,direction:m.direction};d(p),F.push(p);var D=W(p);F.push(D);var O={x:N.x,y:N.y,direction:N.direction};d(O);var G=W(O);F.push({x:G.x,y:D.y}),F.push(G),F.push(O);var V=function(){for(var B=F.length,X=0;X<B-1;X++){var ie=F[X],ee=F[X+1],le=F[X+2],me=function(oe){return le?ie[oe]===ee[oe]&&ee[oe]===le[oe]:!1};if(me("y")){var fe=0;if(m.direction==="left"&&N.direction==="left"){var ke=F[X+3];if(ke)var Se=ke.y-ie.y;else var Se=P.y-ie.y-m.h*1.5}else if(m.direction==="left"&&N.direction==="bottom"){var Se=P.y-ie.y-m.h*1.5;if(P.x>C.x&&C.y<P.y)var fe=P.x-ie.x-m.h*1.5}else var Se=C.y+C.h-ee.y;var we=void 0;ee.x<ie.x&&ee.x<le.x?(we=ee.y+Se,F.splice(X+2,0,{x:ee.x+fe,y:we})):le.y<ie.y&&le.y<ee.y&&(we=ee.y-Se,F.splice(X+2,0,{x:ie.x,y:we})),we&&(le.y=we)}else if(me("x")){if(m.direction==="bottom"&&N.direction==="top")var Se=P.x+P.w-ie.x;else if((m.direction==="right"||m.direction==="bottom")&&(ee.direction==="top"||ee.direction==="bottom")||m.direction==="top"&&(le.direction==="bottom"||le.direction==="top")){if(S===f&&(E.isPrivate||c.isPrivate))var Se=N.x-ie.x-m.h;else var Se=P.x-ie.x-m.h*1.5;if(m.direction==="bottom"&&N.direction==="bottom"&&m.y<N.y){var ce=F[X-1];ce&&(ce.y=ee.y,ie.y=ee.y)}}else var Se=P.x+P.w-ie.x;var we=void 0;ee.y<ie.y&&ee.y<le.y?F[X+1].direction===F[X+2].direction&&!F[X+3]&&N.direction!=="top"?F.splice(X+1,1):(we=ee.x+Se,F.splice(X+2,0,{x:le.x,y:ee.y})):ee.y>ie.y&&ee.y>le.y&&(we=ee.x+Se,F.splice(X+2,0,{x:le.x,y:ee.y})),we&&(ie.x=we,ee.x=we)}}};V();var te=function(){for(var B=[],X=1;X<F.length-5;X++){var ie=F[X],ee=F[X+1],le=F[X+2],me=F[X+3];if(ie.x===ee.x&&le.x===me.x&&me.x>ee.x){F[X+1].y=me.y,F.splice(F.indexOf(le),1),F.splice(F.indexOf(me),1),X=1;continue}}},J=function(){for(var B=1;B<F.length-3;B++){var X=F[B],ie=F[B+1],ee=F[B+2];if(!(!((ee.direction==="left"||ee.direction==="top")&&X.y<ee.y&&X.direction==="bottom")||ee.direction&&ee.direction===X.direction)&&X.y===ie.y&&ie.x===ee.x){X.y=ee.y,F[B+3]&&(ee.x=F[B+3].x),F.splice(F.indexOf(ie),1),B=1;continue}}};J(),te();var re=function(){for(var B={points:[],delta:0},X=F.length,ie=0;ie<X-1;ie++){var ee=F[ie],le=F[ie+1],me=Math.abs(le.x-ee.x),fe=Math.abs(le.y-ee.y),ke=me>fe?me:fe;B.delta<ke&&(B={points:[ee,le],delta:ke})}return B.points},ne=function(X){var X=re(),ie=X[0],ee=X[1],le=Math.abs(ee.x-ie.x),me=Math.abs(ee.y-ie.y);if(le>me)return{direction:"horiontal",x:ie.x+le/2,y:ie.y};var fe;return ie.y>ee.y?fe=ie:fe=ee,{direction:"vertical",x:ee.x,y:fe.y-me/2}};if(this.connectorType&&this.connectorType.length>0){var K=ne(re()),ue=ShapesRegistry.get("Port",this.targets[0]),pe=ShapesRegistry.get("Port",this.sources[0]),he;ue.getPosition().x>=pe.getPosition().x?(he=!1,K.direction==="vertical"?K.y=K.y-20:K.x=K.x-20):(he=!0,K.direction==="vertical"?K.y=K.y+20:K.yx=K.x+20);var be=ConnectorSymbols.draw(this,this.connectorType,K.direction,he);be.setAttribute("transform","translate("+K.x+","+K.y+")")}var Ce=c.focalNode.parentNode,ve=E.focalNode.parentNode,Ee=Ce.parentNode,Ae=ve.parentNode;Ee.removeChild(Ce),Ee.appendChild(Ce),Ae.removeChild(ve),Ae.appendChild(ve),this.focalNode.setAttribute("points",this.arrayToPoints(F));for(var H=[],z=c.connectors.sources.concat(c.connectors.targets).concat(E.connectors.sources).concat(E.connectors.sources),q=0,Z;Z=z[q];q++)H[Z.name]||(H[Z.name]=Z);this.adjustOverlappedConnectors(H)}}},adjustOverlappedConnectors:function(e){var t=e||ShapesRegistry.get("PortConnector"),r={};for(var a in t){var n=t[a];if(n.getAttribute){var o=[];r[n.name]={connector:n,connectorPoints:o};for(var u=n.getAttribute("points").split(" "),s=0,d;d=u[s];s++){var c=d.split(",");o.push({x:parseFloat(c[0]),y:parseFloat(c[1])})}}}var f=0,C={},m=[],E=ObjectsUtil.newInstance("util.core.Map");for(var a in r){var S=r[a],P=S.connector,o=S.connectorPoints;for(var N in r){f++;var R=r[N],g=R.connector;if(g!==P){var v=R.connectorPoints,M=g.targets[0];C[M]===void 0?C[M]=0:m.indexOf(g)===-1&&C[M]++,m.push(g);var L=E.get(g);L||(L=(C[M]%2?2:-2)*Math.round(C[M]/2),E.put(g,L));for(var T=[v[0],v[1]],A=!1,s=0;s<v.length-1;s++)for(var j=v[s],k=v[s+1],U=[j.x,k.x],_=[j.y,k.y],Q,W,F=0;F<o.length-1;F++){var p=o[F],D=o[F+1],O=function(Ae,H){for(var z=1,q=3,Z=3,B=v[s][Ae]+q*z,X=!1;!X;)e:{for(var ie in r)for(var ee=r[ie],le=ee.connectorPoints,me=0,fe;fe=le[me];me++)if(fe[Ae]===B&&(Math.abs(fe[H]-v[s][H])<25||Math.abs(fe[H]-v[s+1][H])<25)){z<1&&(q<.1?(q=Z+1,Z++):q=q/2),z=z*-1,B=v[s][Ae]+q*z;break e}X=!0;break}return B},Q=p.x===j.x&&D.x===k.x&&p.x===k.x&&(D.y===k.y||Math.abs(j.y-p.y)<=3),W=p.y===j.y&&D.y===k.y&&p.y===k.y&&(D.x===k.x||Math.abs(j.x-p.x)<=3);if(Q){var G=O("x","y");R.alteredx=!0,v[s].x=G,v[s+1].x=G,g.movedHorizontally=!0,A=!0}else if(W){var G=O("y","x");R.alteredy=!0,v[s].y=G,v[s+1].y=G,g.movedVertically=!0,A=!0}}for(var s=0;s<v.length-2;s++){var V=v[s],te=v[s+1],J=v[s+2];(te.y<V.y&&te.y<J.y&&V.x===te.x&&te.x===J.x||te.x<V.x&&te.x<J.x&&V.y===te.y&&te.y===J.y)&&(v.splice(s+1,1),s=0)}for(var s=0;s<v.length-1;s++){var V=v[s],te=v[s+1],J=v[s+2];if(te.x!=V.x&&Math.abs(te.x-V.x)<7)te.x=V.x,s=-1,A=!0;else if(te.y-V.y&&Math.abs(te.y-V.y)<7)te.y=V.y,s=0,A=!0;else if(s>4)break}if(A){for(var T="",re=0,ne;ne=v[re];re++){var K=v[re-1],ue=v[re-2];T&&(T=T+" ");var pe=ne;K&&ue&&ne.x!==K.x&&ne.y!==K.y&&(ue.x==K.x?pe.x=ue.x:ue.y==K.y&&(pe.y=ue.y)),T=T+pe.x+","+pe.y}g.setAttribute("points",T)}}}}},arrayToPoints:function(e){for(var t="",r=0,a;a=e[r];r++)t&&(t=t+" "),t=t+a.x+","+a.y;return t},getPosition:function(){return{x:parseFloat(this.focalNode.getAttribute("x")),y:parseFloat(this.focalNode.getAttribute("y")),w:13,h:13}}})})();var StateTree={};function StateNode(e,t){this.parent=e,this.id=t,this.activeColour=null,this.passiveColor=null}StateNode.prototype.getParent=function(){return this.parent},StateNode.prototype.getRoot=function(){for(var e=this,t=null;e!==null;)t=e,e=e.getParent();return t},StateNode.prototype.getId=function(){return this.id},StateNode.prototype.getDepth=function(){for(var e=this,t=0;e!==null;)e=e.getParent(),t++;return t};function StateColourer(e,t){this.numShades=e,this.numColours=t,this.cachedColours=this.baseColours.slice()}StateColourer.prototype.passiveColour="999999",StateColourer.prototype.baseColours=["CC99A2","9AAFAF","FFFF7F","98FB98","9DD6D6","D2AB6F","B19CD9"],StateColourer.prototype.getBasePassiveColour=function(){for(var e=this.passiveColour,t=0;t<5-this.numShades&&t<3;t++)e=this.lighten(e);return e},StateColourer.prototype.getBaseColour=function(e){var t;e<this.cachedColours.length?t=this.cachedColours[e]:(e=e%this.cachedColours.length,t=this.modifyColour(this.cachedColours[e]),this.cachedColours[e]=t);for(var r=0;r<5-this.numShades&&r<3;r++)t=this.lighten(t);return t},StateColourer.prototype.getLightenAmount=function(){return 15},StateColourer.prototype.getModifyAmount=function(){return 20},StateColourer.prototype.modifyColour=function(t){var t=this.createColour(t),r,a;return t.red>t.blue?t.red>t.green?(t.red-=this.getModifyAmount(),t.blue>t.green?t.green+=this.getModifyAmount():t.blue+=this.getModifyAmount()):(t.green-=this.getModifyAmount(),t.blue+=this.getModifyAmount()):t.blue>t.green?(t.blue-=this.getModifyAmount(),t.red>t.green?t.green+=this.getModifyAmount():t.red+=this.getModifyAmount()):(t.blue-=this.getModifyAmount(),t.red+=this.getModifyAmount()),t.toHex()},StateColourer.prototype.lighten=function(t){var t=this.createColour(t),r=this.getLightenAmount();return t.modifyRed(r),t.modifyBlue(r),t.modifyGreen(r),t.toHex()},StateColourer.prototype.createColour=function(e){var t=parseInt(e,16),r=t>>16,a=t>>8&255,n=t&255;return new Colour(r,a,n)};function Colour(e,t,r){this.red=e,this.blue=t,this.green=r}Colour.prototype.modifyRed=function(e){this.red+=e,this.red>255?this.red=255:this.red<0&&(this.red=0)},Colour.prototype.modifyBlue=function(e){this.blue+=e,this.blue>255?this.blue=255:this.blue<0&&(this.blue=0)},Colour.prototype.modifyGreen=function(e){this.green+=e,this.green>255?this.green=255:this.green<0&&(this.green=0)},Colour.prototype.modifyByName=function(e,t){if(e!=="red"&&e!=="blue"&&e!=="green")throw"Not a valid colour name"},Colour.prototype.toHex=function(){var e=this.green|this.blue<<8|this.red<<16;return e.toString(16)};function StateTable(e,t){this.table=e,this.stateTree=t}StateTable.prototype.readTable=function(){for(var e=this.table.find("tr"),t=0,r=1;r<e.length;r++){var a=jQuery(e[r]).find("td")[0];this.stateTree.stateNodes.push(this.stateTree.createState(jQuery(a),t++))}},StateTable.prototype.colour=function(){var e=this.table.find("tr"),t,r,a;if(this.stateTree.type==="state"){t=jQuery(e[0]).find("td");for(var n=1;n<t.length;n++)jQuery(t[n]).css("background-color","#"+this.stateTree.stateNodes[n-1].activeColour)}for(var n=1;n<e.length;n++){r=this.stateTree.stateNodes[n-1],t=jQuery(e[n]).find("td"),a=jQuery(t[0]),a.css("background-color","#"+r.activeColour);for(var o=1;o<t.length;o++)a=jQuery(t[o]),a.text().match(/^\s$/)?a.css("background-color","#"+r.passiveColour):a.css("background-color","#"+r.activeColour)}};function EventSequence(e,t,r){this.headerTable=e,this.bodyTable=t,this.stateTree=r}EventSequence.prototype.readTable=function(){for(var e=jQuery(this.headerTable).find("td"),t=0,r=1;r<e.length;r++)this.stateTree.stateNodes.push(this.stateTree.createState(jQuery(e[r]),t++))},EventSequence.prototype.colour=function(){var e,t,r,a;e=jQuery(this.headerTable).find("td");for(var n=1;n<e.length;n++)r=this.stateTree.stateNodes[n-1],jQuery(e[n]).css("background-color","#"+r.activeColour);e=jQuery(this.bodyTable).find("tr");for(var n=1;n<e.length;n++){r=this.stateTree.stateNodes[n-1],t=jQuery(e[n]).find("td");for(var o=0;o<t.length;o++)a=jQuery(t[o]),a.text().match(/^\s$/)?a.css("background-color","#"+r.passiveColour):a.css("background-color","#"+r.activeColour)}},StateTree.init=function(e,t){StateTree.stateNodes=[],e.hasClass("event-statetable")?(StateTree.type="event",StateTree.handler=new StateTable(e,this)):e.hasClass("state-statetable")?(StateTree.type="state",StateTree.handler=new StateTable(e,this)):e.hasClass("event-sequence-grid")?(StateTree.type="eventSequence",StateTree.handler=new EventSequence(e.find("table")[0],e.find("table")[1],this)):(console.log("Unknown state table type"),StateTree.type="unknown")},StateTree.createState=function(e,t){var r=parseInt(e.attr("data-parent")),a=StateTree.stateNodes[r];return isNaN(r)&&(a=null),new StateNode(a,t)},StateTree.maxDepth=function(){for(var e=0,t,r=0;r<StateTree.stateNodes.length;r++)t=StateTree.stateNodes[r].getDepth(),t>e&&(e=t);return e},StateTree.numStateFamilies=function(){numStateFamilies=0;for(var e=0;e<StateTree.stateNodes.length;e++)StateTree.stateNodes[e].getParent()===null&&numStateFamilies++;return numStateFamilies},StateTree.readTable=function(){StateTree.handler.readTable()},StateTree.assignStateColours=function(){for(var e=new StateColourer(StateTree.maxDepth(),StateTree.numStateFamilies()),t=0,r,a=0;a<StateTree.stateNodes.length;a++)r=StateTree.stateNodes[a],r.getParent()===null?(r.passiveColour=e.getBasePassiveColour(),r.activeColour=e.getBaseColour(t++)):(r.passiveColour=e.lighten(r.getParent().passiveColour),r.activeColour=e.lighten(r.getParent().activeColour))},StateTree.colour=function(){StateTree.assignStateColours(),StateTree.handler.colour()},StateTree.colourStateTables=function(){jQuery(document).ready(function(){jQuery(".statetable").each(function(){StateTree.init(jQuery(this)),StateTree.readTable(),StateTree.colour()})})},StateTree.colourEventSequences=function(){jQuery(document).ready(function(){jQuery(".event-sequence-grid").each(function(){StateTree.init(jQuery(this)),StateTree.readTable(),StateTree.colour()})})};
