var Prototype={Version:"1.7.1",Browser:(function(){var e=navigator.userAgent,t=Object.prototype.toString.call(window.opera)=="[object Opera]";return{IE:!!window.attachEvent&&!t,Opera:t,WebKit:e.indexOf("AppleWebKit/")>-1,Gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,MobileSafari:/Apple.*Mobile/.test(e)}})(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:(function(){var e=window.Element||window.HTMLElement;return!!(e&&e.prototype)})(),SpecificElementExtensions:(function(){if(typeof window.HTMLDivElement<"u")return!0;var e=document.createElement("div"),t=document.createElement("form"),r=!1;return e.__proto__&&e.__proto__!==t.__proto__&&(r=!0),e=t=null,r})()},ScriptFragment:"<script[^>]*>([\\S\\s]*?)<\/script\\s*>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(e){return e}};Prototype.Browser.MobileSafari&&(Prototype.BrowserFeatures.SpecificElementExtensions=!1);var Class=(function(){var e=(function(){for(var n in{toString:1})if(n==="toString")return!1;return!0})();function t(){}function r(){var n=null,o=$A(arguments);Object.isFunction(o[0])&&(n=o.shift());function u(){this.initialize.apply(this,arguments)}Object.extend(u,Class.Methods),u.superclass=n,u.subclasses=[],n&&(t.prototype=n.prototype,u.prototype=new t,n.subclasses.push(u));for(var s=0,d=o.length;s<d;s++)u.addMethods(o[s]);return u.prototype.initialize||(u.prototype.initialize=Prototype.emptyFunction),u.prototype.constructor=u,u}function a(n){var o=this.superclass&&this.superclass.prototype,u=Object.keys(n);e&&(n.toString!=Object.prototype.toString&&u.push("toString"),n.valueOf!=Object.prototype.valueOf&&u.push("valueOf"));for(var s=0,d=u.length;s<d;s++){var c=u[s],h=n[c];if(o&&Object.isFunction(h)&&h.argumentNames()[0]=="$super"){var C=h;h=(function(m){return function(){return o[m].apply(this,arguments)}})(c).wrap(C),h.valueOf=(function(m){return function(){return m.valueOf.call(m)}})(C),h.toString=(function(m){return function(){return m.toString.call(m)}})(C)}this.prototype[c]=h}return this}return{create:r,Methods:{addMethods:a}}})();(function(){var e=Object.prototype.toString,t=Object.prototype.hasOwnProperty,r="Null",a="Undefined",n="Boolean",o="Number",u="String",s="Object",d="[object Function]",c="[object Boolean]",h="[object Number]",C="[object String]",m="[object Array]",T="[object Date]",S=window.JSON&&typeof JSON.stringify=="function"&&JSON.stringify(0)==="0"&&typeof JSON.stringify(Prototype.K)>"u",P=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],_=(function(){for(var J in{toString:1})if(J==="toString")return!1;return!0})();function F(J){switch(J){case null:return r;case void 0:return a}var re=typeof J;switch(re){case"boolean":return n;case"number":return o;case"string":return u}return s}function g(J,re){for(var ne in re)J[ne]=re[ne];return J}function b(J){try{return te(J)?"undefined":J===null?"null":J.inspect?J.inspect():String(J)}catch(re){if(re instanceof RangeError)return"...";throw re}}function k(J){return L("",{"":J},[])}function L(J,re,ne){var K=re[J];F(K)===s&&typeof K.toJSON=="function"&&(K=K.toJSON(J));var ue=e.call(K);switch(ue){case h:case c:case C:K=K.valueOf()}switch(K){case null:return"null";case!0:return"true";case!1:return"false"}var pe=typeof K;switch(pe){case"string":return K.inspect(!0);case"number":return isFinite(K)?String(K):"null";case"object":for(var he=0,be=ne.length;he<be;he++)if(ne[he]===K)throw new TypeError("Cyclic reference to '"+K+"' in object");ne.push(K);var we=[];if(ue===m){for(var he=0,be=K.length;he<be;he++){var ve=L(he,K,ne);we.push(typeof ve>"u"?"null":ve)}we="["+we.join(",")+"]"}else{for(var Ee=Object.keys(K),he=0,be=Ee.length;he<be;he++){var J=Ee[he],ve=L(J,K,ne);typeof ve<"u"&&we.push(J.inspect(!0)+":"+ve)}we="{"+we.join(",")+"}"}return ne.pop(),we}}function A(J){return JSON.stringify(J)}function E(J){return $H(J).toQueryString()}function j(J){return J&&J.toHTML?J.toHTML():String.interpret(J)}function D(J){if(F(J)!==s)throw new TypeError;var re=[];for(var ne in J)t.call(J,ne)&&re.push(ne);if(_)for(var K=0;ne=P[K];K++)t.call(J,ne)&&re.push(ne);return re}function N(J){var re=[];for(var ne in J)re.push(J[ne]);return re}function I(J){return g({},J)}function R(J){return!!(J&&J.nodeType==1)}function W(J){return e.call(J)===m}var Q=typeof Array.isArray=="function"&&Array.isArray([])&&!Array.isArray({});Q&&(W=Array.isArray);function p(J){return J instanceof Hash}function U(J){return e.call(J)===d}function M(J){return e.call(J)===C}function B(J){return e.call(J)===h}function V(J){return e.call(J)===T}function te(J){return typeof J>"u"}g(Object,{extend:g,inspect:b,toJSON:S?A:k,toQueryString:E,toHTML:j,keys:Object.keys||D,values:N,clone:I,isElement:R,isArray:W,isHash:p,isFunction:U,isString:M,isNumber:B,isDate:V,isUndefined:te})})(),Object.extend(Function.prototype,(function(){var e=Array.prototype.slice;function t(m,T){for(var S=m.length,P=T.length;P--;)m[S+P]=T[P];return m}function r(m,T){return m=e.call(m,0),t(m,T)}function a(){var m=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return m.length==1&&!m[0]?[]:m}function n(m){if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;if(!Object.isFunction(this))throw new TypeError("The object is not callable.");var T=function(){},S=this,P=e.call(arguments,1),_=function(){var F=r(P,arguments),g=m,g=this instanceof _?this:m;return S.apply(g,F)};return T.prototype=this.prototype,_.prototype=new T,_}function o(m){var T=this,S=e.call(arguments,1);return function(P){var _=t([P||window.event],S);return T.apply(m,_)}}function u(){if(!arguments.length)return this;var m=this,T=e.call(arguments,0);return function(){var S=r(T,arguments);return m.apply(this,S)}}function s(m){var T=this,S=e.call(arguments,1);return m=m*1e3,window.setTimeout(function(){return T.apply(T,S)},m)}function d(){var m=t([.01],arguments);return this.delay.apply(this,m)}function c(m){var T=this;return function(){var S=t([T.bind(this)],arguments);return m.apply(this,S)}}function h(){if(this._methodized)return this._methodized;var m=this;return this._methodized=function(){var T=t([this],arguments);return m.apply(null,T)}}var C={argumentNames:a,bindAsEventListener:o,curry:u,delay:s,defer:d,wrap:c,methodize:h};return Function.prototype.bind||(C.bind=n),C})()),(function(e){function t(){return this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+"Z"}function r(){return this.toISOString()}e.toISOString||(e.toISOString=t),e.toJSON||(e.toJSON=r)})(Date.prototype),RegExp.prototype.match=RegExp.prototype.test,RegExp.escape=function(e){return String(e).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};var PeriodicalExecuter=Class.create({initialize:function(e,t){this.callback=e,this.frequency=t,this.currentlyExecuting=!1,this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1e3)},execute:function(){this.callback(this)},stop:function(){this.timer&&(clearInterval(this.timer),this.timer=null)},onTimerEvent:function(){if(!this.currentlyExecuting)try{this.currentlyExecuting=!0,this.execute(),this.currentlyExecuting=!1}catch(e){throw this.currentlyExecuting=!1,e}}});Object.extend(String,{interpret:function(e){return e==null?"":String(e)},specialChar:{"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"}}),Object.extend(String.prototype,(function(){var NATIVE_JSON_PARSE_SUPPORT=window.JSON&&typeof JSON.parse=="function"&&JSON.parse('{"test": true}').test;function prepareReplacement(e){if(Object.isFunction(e))return e;var t=new Template(e);return function(r){return t.evaluate(r)}}function gsub(e,t){var r="",a=this,n;if(t=prepareReplacement(t),Object.isString(e)&&(e=RegExp.escape(e)),!(e.length||e.source))return t=t(""),t+a.split("").join(t)+t;for(;a.length>0;)(n=a.match(e))?(r+=a.slice(0,n.index),r+=String.interpret(t(n)),a=a.slice(n.index+n[0].length)):(r+=a,a="");return r}function sub(e,t,r){return t=prepareReplacement(t),r=Object.isUndefined(r)?1:r,this.gsub(e,function(a){return--r<0?a[0]:t(a)})}function scan(e,t){return this.gsub(e,t),String(this)}function truncate(e,t){return e=e||30,t=Object.isUndefined(t)?"...":t,this.length>e?this.slice(0,e-t.length)+t:String(this)}function strip(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}function stripTags(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")}function stripScripts(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")}function extractScripts(){var e=new RegExp(Prototype.ScriptFragment,"img"),t=new RegExp(Prototype.ScriptFragment,"im");return(this.match(e)||[]).map(function(r){return(r.match(t)||["",""])[1]})}function evalScripts(){return this.extractScripts().map(function(script){return eval(script)})}function escapeHTML(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function unescapeHTML(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}function toQueryParams(e){var t=this.strip().match(/([^?#]*)(#.*)?$/);return t?t[1].split(e||"&").inject({},function(r,a){if((a=a.split("="))[0]){var n=decodeURIComponent(a.shift()),o=a.length>1?a.join("="):a[0];o!=null&&(o=decodeURIComponent(o)),n in r?(Object.isArray(r[n])||(r[n]=[r[n]]),r[n].push(o)):r[n]=o}return r}):{}}function toArray(){return this.split("")}function succ(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)}function times(e){return e<1?"":new Array(e+1).join(this)}function camelize(){return this.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})}function capitalize(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()}function underscore(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()}function dasherize(){return this.replace(/_/g,"-")}function inspect(e){var t=this.replace(/[\x00-\x1f\\]/g,function(r){return r in String.specialChar?String.specialChar[r]:"\\u00"+r.charCodeAt().toPaddedString(2,16)});return e?'"'+t.replace(/"/g,'\\"')+'"':"'"+t.replace(/'/g,"\\'")+"'"}function unfilterJSON(e){return this.replace(e||Prototype.JSONFilter,"$1")}function isJSON(){var e=this;return e.blank()?!1:(e=e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@"),e=e.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]"),e=e.replace(/(?:^|:|,)(?:\s*\[)+/g,""),/^[\],:{}\s]*$/.test(e))}function evalJSON(sanitize){var json=this.unfilterJSON(),cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;cx.test(json)&&(json=json.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));try{if(!sanitize||json.isJSON())return eval("("+json+")")}catch(e){}throw new SyntaxError("Badly formed JSON string: "+this.inspect())}function parseJSON(){var e=this.unfilterJSON();return JSON.parse(e)}function include(e){return this.indexOf(e)>-1}function startsWith(e){return this.lastIndexOf(e,0)===0}function endsWith(e){var t=this.length-e.length;return t>=0&&this.indexOf(e,t)===t}function empty(){return this==""}function blank(){return/^\s*$/.test(this)}function interpolate(e,t){return new Template(this,t).evaluate(e)}return{gsub,sub,scan,truncate,strip:String.prototype.trim||strip,stripTags,stripScripts,extractScripts,evalScripts,escapeHTML,unescapeHTML,toQueryParams,parseQuery:toQueryParams,toArray,succ,times,camelize,capitalize,underscore,dasherize,inspect,unfilterJSON,isJSON,evalJSON:NATIVE_JSON_PARSE_SUPPORT?parseJSON:evalJSON,include,startsWith,endsWith,empty,blank,interpolate}})());var Template=Class.create({initialize:function(e,t){this.template=e.toString(),this.pattern=t||Template.Pattern},evaluate:function(e){return e&&Object.isFunction(e.toTemplateReplacements)&&(e=e.toTemplateReplacements()),this.template.gsub(this.pattern,function(t){if(e==null)return t[1]+"";var r=t[1]||"";if(r=="\\")return t[2];var a=e,n=t[3],o=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;if(t=o.exec(n),t==null)return r;for(;t!=null;){var u=t[1].startsWith("[")?t[2].replace(/\\\\]/g,"]"):t[1];if(a=a[u],a==null||t[3]=="")break;n=n.substring(t[3]=="["?t[1].length:t[0].length),t=o.exec(n)}return r+String.interpret(a)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;var $break={},Enumerable=(function(){function e(A,E){try{this._each(A,E)}catch(j){if(j!=$break)throw j}return this}function t(A,E,j){var D=-A,N=[],I=this.toArray();if(A<1)return I;for(;(D+=A)<I.length;)N.push(I.slice(D,D+A));return N.collect(E,j)}function r(A,E){A=A||Prototype.K;var j=!0;return this.each(function(D,N){if(j=j&&!!A.call(E,D,N,this),!j)throw $break},this),j}function a(A,E){A=A||Prototype.K;var j=!1;return this.each(function(D,N){if(j=!!A.call(E,D,N,this))throw $break},this),j}function n(A,E){A=A||Prototype.K;var j=[];return this.each(function(D,N){j.push(A.call(E,D,N,this))},this),j}function o(A,E){var j;return this.each(function(D,N){if(A.call(E,D,N,this))throw j=D,$break},this),j}function u(A,E){var j=[];return this.each(function(D,N){A.call(E,D,N,this)&&j.push(D)},this),j}function s(A,E,j){E=E||Prototype.K;var D=[];return Object.isString(A)&&(A=new RegExp(RegExp.escape(A))),this.each(function(N,I){A.match(N)&&D.push(E.call(j,N,I,this))},this),D}function d(A){if(Object.isFunction(this.indexOf)&&this.indexOf(A)!=-1)return!0;var E=!1;return this.each(function(j){if(j==A)throw E=!0,$break}),E}function c(A,E){return E=Object.isUndefined(E)?null:E,this.eachSlice(A,function(j){for(;j.length<A;)j.push(E);return j})}function h(A,E,j){return this.each(function(D,N){A=E.call(j,A,D,N,this)},this),A}function C(A){var E=$A(arguments).slice(1);return this.map(function(j){return j[A].apply(j,E)})}function m(A,E){A=A||Prototype.K;var j;return this.each(function(D,N){D=A.call(E,D,N,this),(j==null||D>=j)&&(j=D)},this),j}function T(A,E){A=A||Prototype.K;var j;return this.each(function(D,N){D=A.call(E,D,N,this),(j==null||D<j)&&(j=D)},this),j}function S(A,E){A=A||Prototype.K;var j=[],D=[];return this.each(function(N,I){(A.call(E,N,I,this)?j:D).push(N)},this),[j,D]}function P(A){var E=[];return this.each(function(j){E.push(j[A])}),E}function _(A,E){var j=[];return this.each(function(D,N){A.call(E,D,N,this)||j.push(D)},this),j}function F(A,E){return this.map(function(j,D){return{value:j,criteria:A.call(E,j,D,this)}},this).sort(function(j,D){var N=j.criteria,I=D.criteria;return N<I?-1:N>I?1:0}).pluck("value")}function g(){return this.map()}function b(){var A=Prototype.K,E=$A(arguments);Object.isFunction(E.last())&&(A=E.pop());var j=[this].concat(E).map($A);return this.map(function(D,N){return A(j.pluck(N))})}function k(){return this.toArray().length}function L(){return"#<Enumerable:"+this.toArray().inspect()+">"}return{each:e,eachSlice:t,all:r,every:r,any:a,some:a,collect:n,map:n,detect:o,findAll:u,select:u,filter:u,grep:s,include:d,member:d,inGroupsOf:c,inject:h,invoke:C,max:m,min:T,partition:S,pluck:P,reject:_,sortBy:F,toArray:g,entries:g,zip:b,size:k,inspect:L,find:o}})();function $A(e){if(!e)return[];if("toArray"in Object(e))return e.toArray();for(var t=e.length||0,r=new Array(t);t--;)r[t]=e[t];return r}function $w(e){return Object.isString(e)?(e=e.strip(),e?e.split(/\s+/):[]):[]}Array.from=$A,(function(){var e=Array.prototype,t=e.slice,r=e.forEach;function a(I,R){for(var W=0,Q=this.length>>>0;W<Q;W++)W in this&&I.call(R,this[W],W,this)}r||(r=a);function n(){return this.length=0,this}function o(){return this[0]}function u(){return this[this.length-1]}function s(){return this.select(function(I){return I!=null})}function d(){return this.inject([],function(I,R){return Object.isArray(R)?I.concat(R.flatten()):(I.push(R),I)})}function c(){var I=t.call(arguments,0);return this.select(function(R){return!I.include(R)})}function h(I){return(I===!1?this.toArray():this)._reverse()}function C(I){return this.inject([],function(R,W,Q){return(Q==0||(I?R.last()!=W:!R.include(W)))&&R.push(W),R})}function m(I){return this.uniq().findAll(function(R){return I.indexOf(R)!==-1})}function T(){return t.call(this,0)}function S(){return this.length}function P(){return"["+this.map(Object.inspect).join(", ")+"]"}function _(I,R){if(this==null)throw new TypeError;var W=Object(this),Q=W.length>>>0;if(Q===0||(R=Number(R),isNaN(R)?R=0:R!==0&&isFinite(R)&&(R=(R>0?1:-1)*Math.floor(Math.abs(R))),R>Q))return-1;for(var p=R>=0?R:Math.max(Q-Math.abs(R),0);p<Q;p++)if(p in W&&W[p]===I)return p;return-1}function F(I,R){if(this==null)throw new TypeError;var W=Object(this),Q=W.length>>>0;if(Q===0)return-1;Object.isUndefined(R)?R=Q:(R=Number(R),isNaN(R)?R=0:R!==0&&isFinite(R)&&(R=(R>0?1:-1)*Math.floor(Math.abs(R))));for(var p=R>=0?Math.min(R,Q-1):Q-Math.abs(R);p>=0;p--)if(p in W&&W[p]===I)return p;return-1}function g(I){var R=[],W=t.call(arguments,0),Q,p=0;W.unshift(this);for(var U=0,M=W.length;U<M;U++)if(Q=W[U],Object.isArray(Q)&&!("callee"in Q))for(var B=0,V=Q.length;B<V;B++)B in Q&&(R[p]=Q[B]),p++;else R[p++]=Q;return R.length=p,R}function b(I){return function(){if(arguments.length===0)return I.call(this,Prototype.K);if(arguments[0]===void 0){var R=t.call(arguments,1);return R.unshift(Prototype.K),I.apply(this,R)}else return I.apply(this,arguments)}}function k(I){if(this==null)throw new TypeError;I=I||Prototype.K;for(var R=Object(this),W=[],Q=arguments[1],p=0,U=0,M=R.length>>>0;U<M;U++)U in R&&(W[p]=I.call(Q,R[U],U,R)),p++;return W.length=p,W}e.map&&(k=b(Array.prototype.map));function L(I){if(this==null||!Object.isFunction(I))throw new TypeError;for(var R=Object(this),W=[],Q=arguments[1],p,U=0,M=R.length>>>0;U<M;U++)U in R&&(p=R[U],I.call(Q,p,U,R)&&W.push(p));return W}e.filter&&(L=Array.prototype.filter);function A(I){if(this==null)throw new TypeError;I=I||Prototype.K;for(var R=arguments[1],W=Object(this),Q=0,p=W.length>>>0;Q<p;Q++)if(Q in W&&I.call(R,W[Q],Q,W))return!0;return!1}if(e.some)var A=b(Array.prototype.some);function E(I){if(this==null)throw new TypeError;I=I||Prototype.K;for(var R=arguments[1],W=Object(this),Q=0,p=W.length>>>0;Q<p;Q++)if(Q in W&&!I.call(R,W[Q],Q,W))return!1;return!0}if(e.every)var E=b(Array.prototype.every);var j=e.reduce;function D(I,R){R=R||Prototype.K;var W=arguments[2];return j.call(this,R.bind(W),I)}if(!e.reduce)var D=Enumerable.inject;Object.extend(e,Enumerable),e._reverse||(e._reverse=e.reverse),Object.extend(e,{_each:r,map:k,collect:k,select:L,filter:L,findAll:L,some:A,any:A,every:E,all:E,inject:D,clear:n,first:o,last:u,compact:s,flatten:d,without:c,reverse:h,uniq:C,intersect:m,clone:T,toArray:T,size:S,inspect:P});var N=(function(){return[].concat(arguments)[0][0]!==1})(1,2);N&&(e.concat=g),e.indexOf||(e.indexOf=_),e.lastIndexOf||(e.lastIndexOf=F)})();function $H(e){return new Hash(e)}var Hash=Class.create(Enumerable,(function(){function e(P){this._object=Object.isHash(P)?P.toObject():Object.clone(P)}function t(P,_){for(var F in this._object){var g=this._object[F],b=[F,g];b.key=F,b.value=g,P.call(_,b)}}function r(P,_){return this._object[P]=_}function a(P){if(this._object[P]!==Object.prototype[P])return this._object[P]}function n(P){var _=this._object[P];return delete this._object[P],_}function o(){return Object.clone(this._object)}function u(){return this.pluck("key")}function s(){return this.pluck("value")}function d(P){var _=this.detect(function(F){return F.value===P});return _&&_.key}function c(P){return this.clone().update(P)}function h(P){return new Hash(P).inject(this,function(_,F){return _.set(F.key,F.value),_})}function C(P,F){if(Object.isUndefined(F))return P;var F=String.interpret(F);return F=F.gsub(/(\r)?\n/,`\r
`),F=encodeURIComponent(F),F=F.gsub(/%20/,"+"),P+"="+F}function m(){return this.inject([],function(P,_){var F=encodeURIComponent(_.key),g=_.value;if(g&&typeof g=="object"){if(Object.isArray(g)){for(var b=[],k=0,L=g.length,A;k<L;k++)A=g[k],b.push(C(F,A));return P.concat(b)}}else P.push(C(F,g));return P}).join("&")}function T(){return"#<Hash:{"+this.map(function(P){return P.map(Object.inspect).join(": ")}).join(", ")+"}>"}function S(){return new Hash(this)}return{initialize:e,_each:t,set:r,get:a,unset:n,toObject:o,toTemplateReplacements:o,keys:u,values:s,index:d,merge:c,update:h,toQueryString:m,inspect:T,toJSON:o,clone:S}})());Hash.from=$H,Object.extend(Number.prototype,(function(){function e(){return this.toPaddedString(2,16)}function t(){return this+1}function r(d,c){return $R(0,this,!0).each(d,c),this}function a(d,c){var h=this.toString(c||10);return"0".times(d-h.length)+h}function n(){return Math.abs(this)}function o(){return Math.round(this)}function u(){return Math.ceil(this)}function s(){return Math.floor(this)}return{toColorPart:e,succ:t,times:r,toPaddedString:a,abs:n,round:o,ceil:u,floor:s}})());function $R(e,t,r){return new ObjectRange(e,t,r)}var ObjectRange=Class.create(Enumerable,(function(){function e(a,n,o){this.start=a,this.end=n,this.exclusive=o}function t(a,n){for(var o=this.start;this.include(o);)a.call(n,o),o=o.succ()}function r(a){return a<this.start?!1:this.exclusive?a<this.end:a<=this.end}return{initialize:e,_each:t,include:r}})()),Abstract={},Try={these:function(){for(var e,t=0,r=arguments.length;t<r;t++){var a=arguments[t];try{e=a();break}catch{}}return e}},Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||!1},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(e,t){this.responders._each(e,t)},register:function(e){this.include(e)||this.responders.push(e)},unregister:function(e){this.responders=this.responders.without(e)},dispatch:function(e,t,r,a){this.each(function(n){if(Object.isFunction(n[e]))try{n[e].apply(n,[t,r,a])}catch{}})}},Object.extend(Ajax.Responders,Enumerable),Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}}),Ajax.Base=Class.create({initialize:function(e){this.options={method:"post",asynchronous:!0,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:!0,evalJS:!0},Object.extend(this.options,e||{}),this.options.method=this.options.method.toLowerCase(),Object.isHash(this.options.parameters)&&(this.options.parameters=this.options.parameters.toObject())}}),Ajax.Request=Class.create(Ajax.Base,{_complete:!1,initialize:function(e,t,r){e(r),this.transport=Ajax.getTransport(),this.request(t)},request:function(e){this.url=e,this.method=this.options.method;var t=Object.isString(this.options.parameters)?this.options.parameters:Object.toQueryString(this.options.parameters);["get","post"].include(this.method)||(t+=(t?"&":"")+"_method="+this.method,this.method="post"),t&&this.method==="get"&&(this.url+=(this.url.include("?")?"&":"?")+t),this.parameters=t.toQueryParams();try{var r=new Ajax.Response(this);this.options.onCreate&&this.options.onCreate(r),Ajax.Responders.dispatch("onCreate",this,r),this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous),this.options.asynchronous&&this.respondToReadyState.bind(this).defer(1),this.transport.onreadystatechange=this.onStateChange.bind(this),this.setRequestHeaders(),this.body=this.method=="post"?this.options.postBody||t:null,this.transport.send(this.body),!this.options.asynchronous&&this.transport.overrideMimeType&&this.onStateChange()}catch(a){this.dispatchException(a)}},onStateChange:function(){var e=this.transport.readyState;e>1&&!(e==4&&this._complete)&&this.respondToReadyState(this.transport.readyState)},setRequestHeaders:function(){var e={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if(this.method=="post"&&(e["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:""),this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005&&(e.Connection="close")),typeof this.options.requestHeaders=="object"){var t=this.options.requestHeaders;if(Object.isFunction(t.push))for(var r=0,a=t.length;r<a;r+=2)e[t[r]]=t[r+1];else $H(t).each(function(o){e[o.key]=o.value})}for(var n in e)this.transport.setRequestHeader(n,e[n])},success:function(){var e=this.getStatus();return!e||e>=200&&e<300||e==304},getStatus:function(){try{return this.transport.status===1223?204:this.transport.status||0}catch{return 0}},respondToReadyState:function(e){var t=Ajax.Request.Events[e],r=new Ajax.Response(this);if(t=="Complete"){try{this._complete=!0,(this.options["on"+r.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(r,r.headerJSON)}catch(n){this.dispatchException(n)}var a=r.getHeader("Content-type");(this.options.evalJS=="force"||this.options.evalJS&&this.isSameOrigin()&&a&&a.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))&&this.evalResponse()}try{(this.options["on"+t]||Prototype.emptyFunction)(r,r.headerJSON),Ajax.Responders.dispatch("on"+t,this,r,r.headerJSON)}catch(n){this.dispatchException(n)}t=="Complete"&&(this.transport.onreadystatechange=Prototype.emptyFunction)},isSameOrigin:function(){var e=this.url.match(/^\s*https?:\/\/[^\/]*/);return!e||e[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""})},getHeader:function(e){try{return this.transport.getResponseHeader(e)||null}catch{return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(e){this.dispatchException(e)}},dispatchException:function(e){(this.options.onException||Prototype.emptyFunction)(this,e),Ajax.Responders.dispatch("onException",this,e)}}),Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"],Ajax.Response=Class.create({initialize:function(e){this.request=e;var t=this.transport=e.transport,r=this.readyState=t.readyState;if((r>2&&!Prototype.Browser.IE||r==4)&&(this.status=this.getStatus(),this.statusText=this.getStatusText(),this.responseText=String.interpret(t.responseText),this.headerJSON=this._getHeaderJSON()),r==4){var a=t.responseXML;this.responseXML=Object.isUndefined(a)?null:a,this.responseJSON=this._getResponseJSON()}},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch{return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch{return null}},getResponseHeader:function(e){return this.transport.getResponseHeader(e)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var e=this.getHeader("X-JSON");if(!e)return null;try{e=decodeURIComponent(escape(e))}catch{}try{return e.evalJSON(this.request.options.sanitizeJSON||!this.request.isSameOrigin())}catch(t){this.request.dispatchException(t)}},_getResponseJSON:function(){var e=this.request.options;if(!e.evalJSON||e.evalJSON!="force"&&!(this.getHeader("Content-type")||"").include("application/json")||this.responseText.blank())return null;try{return this.responseText.evalJSON(e.sanitizeJSON||!this.request.isSameOrigin())}catch(t){this.request.dispatchException(t)}}}),Ajax.Updater=Class.create(Ajax.Request,{initialize:function(e,t,r,a){this.container={success:t.success||t,failure:t.failure||(t.success?null:t)},a=Object.clone(a);var n=a.onComplete;a.onComplete=(function(o,u){this.updateContent(o.responseText),Object.isFunction(n)&&n(o,u)}).bind(this),e(r,a)},updateContent:function(e){var t=this.container[this.success()?"success":"failure"],r=this.options;if(r.evalScripts||(e=e.stripScripts()),t=$(t))if(r.insertion)if(Object.isString(r.insertion)){var a={};a[r.insertion]=e,t.insert(a)}else r.insertion(t,e);else t.update(e)}}),Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function(e,t,r,a){e(a),this.onComplete=this.options.onComplete,this.frequency=this.options.frequency||2,this.decay=this.options.decay||1,this.updater={},this.container=t,this.url=r,this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this),this.onTimerEvent()},stop:function(){this.updater.options.onComplete=void 0,clearTimeout(this.timer),(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},updateComplete:function(e){this.options.decay&&(this.decay=e.responseText==this.lastText?this.decay*this.options.decay:1,this.lastText=e.responseText),this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}}),(function(e){var t,r=Array.prototype.slice,a=document.createElement("div");function n(f){if(arguments.length>1){for(var v=0,O=[],Y=arguments.length;v<Y;v++)O.push(n(arguments[v]));return O}return Object.isString(f)&&(f=document.getElementById(f)),c.extend(f)}e.$=n,e.Node||(e.Node={}),e.Node.ELEMENT_NODE||Object.extend(e.Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12});var o={};function u(f,v){return!(f==="select"||"type"in v)}var s=(function(){try{var f=document.createElement('<input name="x">');return f.tagName.toLowerCase()==="input"&&f.name==="x"}catch{return!1}})(),d=e.Element;function c(f,v){if(v=v||{},f=f.toLowerCase(),s&&v.name)return f="<"+f+' name="'+v.name+'">',delete v.name,c.writeAttribute(document.createElement(f),v);o[f]||(o[f]=c.extend(document.createElement(f)));var O=u(f,v)?o[f].cloneNode(!1):document.createElement(f);return c.writeAttribute(O,v)}e.Element=c,Object.extend(e.Element,d||{}),d&&(e.Element.prototype=d.prototype),c.Methods={ByTag:{},Simulated:{}};var h={},C={id:"id",className:"class"};function m(f){f=n(f);var v="<"+f.tagName.toLowerCase(),O,Y;for(var ae in C)O=C[ae],Y=(f[ae]||"").toString(),Y&&(v+=" "+O+"="+Y.inspect(!0));return v+">"}h.inspect=m;function T(f){return n(f).style.display!=="none"}function S(f,v){return f=n(f),Object.isUndefined(v)&&(v=!c.visible(f)),c[v?"show":"hide"](f),f}function P(f){return f=n(f),f.style.display="none",f}function _(f){return f=n(f),f.style.display="",f}Object.extend(h,{visible:T,toggle:S,hide:P,show:_});function F(f){return f=n(f),f.parentNode.removeChild(f),f}var g=(function(){var f=document.createElement("select"),v=!0;return f.innerHTML='<option value="test">test</option>',f.options&&f.options[0]&&(v=f.options[0].nodeName.toUpperCase()!=="OPTION"),f=null,v})(),b=(function(){try{var f=document.createElement("table");if(f&&f.tBodies){f.innerHTML="<tbody><tr><td>test</td></tr></tbody>";var v=typeof f.tBodies[0]>"u";return f=null,v}}catch{return!0}})(),k=(function(){try{var f=document.createElement("div");f.innerHTML="<link />";var v=f.childNodes.length===0;return f=null,v}catch{return!0}})(),L=g||b||k,A=(function(){var f=document.createElement("script"),v=!1;try{f.appendChild(document.createTextNode("")),v=!f.firstChild||f.firstChild&&f.firstChild.nodeType!==3}catch{v=!0}return f=null,v})();function E(f,v){f=n(f);for(var O=f.getElementsByTagName("*"),Y=O.length;Y--;)te(O[Y]);if(v&&v.toElement&&(v=v.toElement()),Object.isElement(v))return f.update().insert(v);v=Object.toHTML(v);var ae=f.tagName.toUpperCase();if(ae==="SCRIPT"&&A)return f.text=v,f;if(L)if(ae in D.tags){for(;f.firstChild;)f.removeChild(f.firstChild);for(var se=B(ae,v.stripScripts()),Y=0,xe;xe=se[Y];Y++)f.appendChild(xe)}else if(k&&Object.isString(v)&&v.indexOf("<link")>-1){for(;f.firstChild;)f.removeChild(f.firstChild);for(var se=B(ae,v.stripScripts(),!0),Y=0,xe;xe=se[Y];Y++)f.appendChild(xe)}else f.innerHTML=v.stripScripts();else f.innerHTML=v.stripScripts();return v.evalScripts.bind(v).defer(),f}function j(f,v){if(f=n(f),v&&v.toElement)v=v.toElement();else if(!Object.isElement(v)){v=Object.toHTML(v);var O=f.ownerDocument.createRange();O.selectNode(f),v.evalScripts.bind(v).defer(),v=O.createContextualFragment(v.stripScripts())}return f.parentNode.replaceChild(v,f),f}var D={before:function(f,v){f.parentNode.insertBefore(v,f)},top:function(f,v){f.insertBefore(v,f.firstChild)},bottom:function(f,v){f.appendChild(v)},after:function(f,v){f.parentNode.insertBefore(v,f.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}},N=D.tags;Object.extend(N,{THEAD:N.TBODY,TFOOT:N.TBODY,TH:N.TD});function I(f,v){if(f=n(f),v&&v.toElement&&(v=v.toElement()),Object.isElement(v))return f.parentNode.replaceChild(v,f),f;v=Object.toHTML(v);var O=f.parentNode,Y=O.tagName.toUpperCase();if(Y in D.tags){var ae=c.next(f),se=B(Y,v.stripScripts());O.removeChild(f);var xe;ae?xe=function(Ne){O.insertBefore(Ne,ae)}:xe=function(Ne){O.appendChild(Ne)},se.each(xe)}else f.outerHTML=v.stripScripts();return v.evalScripts.bind(v).defer(),f}"outerHTML"in document.documentElement&&(j=I);function R(f){return Object.isUndefined(f)||f===null?!1:!!(Object.isString(f)||Object.isNumber(f)||Object.isElement(f)||f.toElement||f.toHTML)}function W(f,v,O){O=O.toLowerCase();var Y=D[O];if(v&&v.toElement&&(v=v.toElement()),Object.isElement(v))return Y(f,v),f;v=Object.toHTML(v);var ae=(O==="before"||O==="after"?f.parentNode:f).tagName.toUpperCase(),se=B(ae,v.stripScripts());(O==="top"||O==="after")&&se.reverse();for(var xe=0,Ne;Ne=se[xe];xe++)Y(f,Ne);v.evalScripts.bind(v).defer()}function Q(f,v){f=n(f),R(v)&&(v={bottom:v});for(var O in v)W(f,v[O],O);return f}function p(f,v,O){return f=n(f),Object.isElement(v)?n(v).writeAttribute(O||{}):Object.isString(v)?v=new c(v,O):v=new c("div",v),f.parentNode&&f.parentNode.replaceChild(v,f),v.appendChild(f),v}function U(f){f=n(f);for(var v=f.firstChild;v;){var O=v.nextSibling;v.nodeType===Node.TEXT_NODE&&!/\S/.test(v.nodeValue)&&f.removeChild(v),v=O}return f}function M(f){return n(f).innerHTML.blank()}function B(f,v,O){var Y=D.tags[f],ae=a,se=!!Y;if(!se&&O&&(se=!0,Y=["","",0]),se){ae.innerHTML="&#160;"+Y[0]+v+Y[1],ae.removeChild(ae.firstChild);for(var xe=Y[2];xe--;)ae=ae.firstChild}else ae.innerHTML=v;return $A(ae.childNodes)}function V(f,v){if(f=n(f)){var O=f.cloneNode(v);if(!Qe&&(O._prototypeUID=t,v))for(var Y=c.select(O,"*"),ae=Y.length;ae--;)Y[ae]._prototypeUID=t;return c.extend(O)}}function te(f){var v=De(f);v&&(c.stopObserving(f),Qe||(f._prototypeUID=t),delete c.Storage[v])}function J(f){for(var v=f.length;v--;)te(f[v])}function re(f){for(var v=f.length,O,Y;v--;)O=f[v],Y=De(O),delete c.Storage[Y],delete Event.cache[Y]}Qe&&(J=re);function ne(f){if(f=n(f)){te(f);for(var v=f.getElementsByTagName("*"),O=v.length;O--;)te(v[O]);return null}}Object.extend(h,{remove:F,update:E,replace:j,insert:Q,wrap:p,cleanWhitespace:U,empty:M,clone:V,purge:ne});function K(f,v,O){f=n(f),O=O||-1;for(var Y=[];(f=f[v])&&(f.nodeType===Node.ELEMENT_NODE&&Y.push(c.extend(f)),Y.length!==O););return Y}function ue(f){return K(f,"parentNode")}function pe(f){return c.select(f,"*")}function he(f){for(f=n(f).firstChild;f&&f.nodeType!==Node.ELEMENT_NODE;)f=f.nextSibling;return n(f)}function be(f){for(var v=[],O=n(f).firstChild;O;)O.nodeType===Node.ELEMENT_NODE&&v.push(c.extend(O)),O=O.nextSibling;return v}function we(f){return K(f,"previousSibling")}function ve(f){return K(f,"nextSibling")}function Ee(f){f=n(f);var v=we(f),O=ve(f);return v.reverse().concat(O)}function Te(f,v){return f=n(f),Object.isString(v)?Prototype.Selector.match(f,v):v.match(f)}function H(f,v,O,Y){for(f=n(f),O=O||0,Y=Y||0,Object.isNumber(O)&&(Y=O,O=null);f=f[v];)if(f.nodeType===1&&!(O&&!Prototype.Selector.match(f,O))&&!(--Y>=0))return c.extend(f)}function z(f,v,O){return f=n(f),arguments.length===1?n(f.parentNode):H(f,"parentNode",v,O)}function q(f,v,O){f=n(f),v=v||0,O=O||0,Object.isNumber(v)&&(O=v,v="*");var Y=Prototype.Selector.select(v,f)[O];return c.extend(Y)}function Z(f,v,O){return H(f,"previousSibling",v,O)}function G(f,v,O){return H(f,"nextSibling",v,O)}function X(f){f=n(f);var v=r.call(arguments,1).join(", ");return Prototype.Selector.select(v,f)}function ie(f){f=n(f);for(var v=r.call(arguments,1).join(", "),O=c.siblings(f),Y=[],ae=0,se;se=O[ae];ae++)Prototype.Selector.match(se,v)&&Y.push(se);return Y}function ee(f,v){for(f=n(f),v=n(v);f=f.parentNode;)if(f===v)return!0;return!1}function le(f,v){return f=n(f),v=n(v),v.contains?v.contains(f)&&v!==f:ee(f,v)}function me(f,v){return f=n(f),v=n(v),(f.compareDocumentPosition(v)&8)===8}var fe;a.compareDocumentPosition?fe=me:a.contains?fe=le:fe=ee,Object.extend(h,{recursivelyCollect:K,ancestors:ue,descendants:pe,firstDescendant:he,immediateDescendants:be,previousSiblings:we,nextSiblings:ve,siblings:Ee,match:Te,up:z,down:q,previous:Z,next:G,select:X,adjacent:ie,descendantOf:fe,getElementsBySelector:X,childElements:be});var ke=1;function Se(f){f=n(f);var v=c.readAttribute(f,"id");if(v)return v;do v="anonymous_element_"+ke++;while(n(v));return c.writeAttribute(f,"id",v),v}function Ce(f,v){return n(f).getAttribute(v)}function ce(f,v){f=n(f);var O=je.read;return O.values[v]?O.values[v](f,v):(O.names[v]&&(v=O.names[v]),v.include(":")?!f.attributes||!f.attributes[v]?null:f.attributes[v].value:f.getAttribute(v))}function oe(f,v){return v==="title"?f.title:f.getAttribute(v)}var ge=(function(){a.setAttribute("onclick",Prototype.emptyFunction);var f=a.getAttribute("onclick"),v=typeof f=="function";return a.removeAttribute("onclick"),v})();ge?Ce=ce:Prototype.Browser.Opera&&(Ce=oe);function Ae(f,v,O){f=n(f);var Y={},ae=je.write;typeof v=="object"?Y=v:Y[v]=Object.isUndefined(O)?!0:O;for(var se in Y)v=ae.names[se]||se,O=Y[se],ae.values[se]&&(v=ae.values[se](f,O)),O===!1||O===null?f.removeAttribute(v):O===!0?f.setAttribute(v,v):f.setAttribute(v,O);return f}function de(f,v){v=je.has[v]||v;var O=n(f).getAttributeNode(v);return!!(O&&O.specified)}e.Element.Methods.Simulated.hasAttribute=de;function Pe(f){return new c.ClassNames(f)}var Le={};function Ye(f){if(Le[f])return Le[f];var v=new RegExp("(^|\\s+)"+f+"(\\s+|$)");return Le[f]=v,v}function ze(f,v){if(f=n(f)){var O=f.className;return O.length===0?!1:O===v?!0:Ye(v).test(O)}}function ot(f,v){if(f=n(f))return ze(f,v)||(f.className+=(f.className?" ":"")+v),f}function st(f,v){if(f=n(f))return f.className=f.className.replace(Ye(v)," ").strip(),f}function lt(f,v,O){if(f=n(f)){Object.isUndefined(O)&&(O=!ze(f,v));var Y=c[O?"addClassName":"removeClassName"];return Y(f,v)}}var je={},Ie="className",He="for";a.setAttribute(Ie,"x"),a.className!=="x"&&(a.setAttribute("class","x"),a.className==="x"&&(Ie="class"));var _e=document.createElement("label");_e.setAttribute(He,"x"),_e.htmlFor!=="x"&&(_e.setAttribute("htmlFor","x"),_e.htmlFor==="x"&&(He="htmlFor")),_e=null;function ut(f,v){return f.getAttribute(v)}function Xe(f,v){return f.getAttribute(v,2)}function ct(f,v){var O=f.getAttributeNode(v);return O?O.value:""}function Re(f,v){return n(f).hasAttribute(v)?v:null}a.onclick=Prototype.emptyFunction;var Ke=a.getAttribute("onclick"),ye;String(Ke).indexOf("{")>-1?ye=function(f,v){var O=f.getAttribute(v);return O?(O=O.toString(),O=O.split("{")[1],O=O.split("}")[0],O.strip()):null}:Ke===""&&(ye=function(f,v){var O=f.getAttribute(v);return O?O.strip():null}),je.read={names:{class:Ie,className:Ie,for:He,htmlFor:He},values:{style:function(f){return f.style.cssText.toLowerCase()},title:function(f){return f.title}}},je.write={names:{className:"class",htmlFor:"for",cellpadding:"cellPadding",cellspacing:"cellSpacing"},values:{checked:function(f,v){f.checked=!!v},style:function(f,v){f.style.cssText=v||""}}},je.has={names:{}},Object.extend(je.write.names,je.read.names);for(var dt=$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc frameBorder"),Ze=0,Me;Me=dt[Ze];Ze++)je.write.names[Me.toLowerCase()]=Me,je.has.names[Me.toLowerCase()]=Me;Object.extend(je.read.values,{href:Xe,src:Xe,type:ut,action:ct,disabled:Re,checked:Re,readonly:Re,multiple:Re,onload:ye,onunload:ye,onclick:ye,ondblclick:ye,onmousedown:ye,onmouseup:ye,onmouseover:ye,onmousemove:ye,onmouseout:ye,onfocus:ye,onblur:ye,onkeypress:ye,onkeydown:ye,onkeyup:ye,onsubmit:ye,onreset:ye,onselect:ye,onchange:ye}),Object.extend(h,{identify:Se,readAttribute:Ce,writeAttribute:Ae,classNames:Pe,hasClassName:ze,addClassName:ot,removeClassName:st,toggleClassName:lt});function ft(f){return f==="float"||f==="styleFloat"?"cssFloat":f.camelize()}function ht(f){return f==="float"||f==="cssFloat"?"styleFloat":f.camelize()}function gt(f,v){f=n(f);var O=f.style,Y;if(Object.isString(v)){if(O.cssText+=";"+v,v.include("opacity")){var ae=v.match(/opacity:\s*(\d?\.?\d*)/)[1];c.setOpacity(f,ae)}return f}for(var se in v)if(se==="opacity")c.setOpacity(f,v[se]);else{var xe=v[se];(se==="float"||se==="cssFloat")&&(se=Object.isUndefined(O.styleFloat)?"cssFloat":"styleFloat"),O[se]=xe}return f}function Be(f,v){f=n(f),v=ft(v);var O=f.style[v];if(!O||O==="auto"){var Y=document.defaultView.getComputedStyle(f,null);O=Y?Y[v]:null}return v==="opacity"?O?parseFloat(O):1:O==="auto"?null:O}function Pt(f,v){switch(v){case"height":case"width":if(!c.visible(f))return null;var O=parseInt(Be(f,v),10);return O!==f["offset"+v.capitalize()]?O+"px":c.measure(f,v);default:return Be(f,v)}}function pt(f,v){f=n(f),v=ht(v);var O=f.style[v];return!O&&f.currentStyle&&(O=f.currentStyle[v]),v==="opacity"&&!Ge?rt(f):O==="auto"?(v==="width"||v==="height")&&c.visible(f)?c.measure(f,v)+"px":null:O}function et(f){return(f||"").replace(/alpha\([^\)]*\)/gi,"")}function mt(f){return f.currentStyle.hasLayout||(f.style.zoom=1),f}var Ge=(function(){return a.style.cssText="opacity:.55",/^0.55/.test(a.style.opacity)})();function tt(f,v){return f=n(f),v==1||v===""?v="":v<1e-5&&(v=0),f.style.opacity=v,f}function vt(f,v){if(Ge)return tt(f,v);f=mt(n(f));var O=c.getStyle(f,"filter"),Y=f.style;return v==1||v===""?(O=et(O),O?Y.filter=O:Y.removeAttribute("filter"),f):(v<1e-5&&(v=0),Y.filter=et(O)+"alpha(opacity="+v*100+")",f)}function it(f){return c.getStyle(f,"opacity")}function rt(f){if(Ge)return it(f);var v=c.getStyle(f,"filter");if(v.length===0)return 1;var O=(v||"").match(/alpha\(opacity=(.*)\)/);return O[1]?parseFloat(O[1])/100:1}Object.extend(h,{setStyle:gt,getStyle:Be,setOpacity:tt,getOpacity:it}),"styleFloat"in a.style&&(h.getStyle=pt,h.setOpacity=vt,h.getOpacity=rt);var jt=0;e.Element.Storage={UID:1};function De(f){return f===window?0:(typeof f._prototypeUID>"u"&&(f._prototypeUID=c.Storage.UID++),f._prototypeUID)}function yt(f){return f===window?0:f==document?1:f.uniqueID}var Qe="uniqueID"in a;Qe&&(De=yt);function We(f){if(f=n(f)){var v=De(f);return c.Storage[v]||(c.Storage[v]=$H()),c.Storage[v]}}function bt(f,v,O){if(f=n(f)){var Y=We(f);return arguments.length===2?Y.update(v):Y.set(v,O),f}}function wt(f,v,O){if(f=n(f)){var Y=We(f),ae=Y.get(v);return Object.isUndefined(ae)&&(Y.set(v,O),ae=O),ae}}Object.extend(h,{getStorage:We,store:bt,retrieve:wt});var Ve={},Ue=c.Methods.ByTag,Oe=Prototype.BrowserFeatures;!Oe.ElementExtensions&&"__proto__"in a&&(e.HTMLElement={},e.HTMLElement.prototype=a.__proto__,Oe.ElementExtensions=!0);function Ct(f){if(typeof window.Element>"u")return!1;var v=window.Element.prototype;if(v){var O="_"+(Math.random()+"").slice(2),Y=document.createElement(f);v[O]="x";var ae=Y[O]!=="x";return delete v[O],Y=null,ae}return!1}var xt=Ct("object");function Fe(f,v){for(var O in v){var Y=v[O];Object.isFunction(Y)&&!(O in f)&&(f[O]=Y.methodize())}}var qe={};function at(f){var v=De(f);return v in qe}function $e(f){if(!f||at(f)||f.nodeType!==Node.ELEMENT_NODE||f==window)return f;var v=Object.clone(Ve),O=f.tagName.toUpperCase();return Ue[O]&&Object.extend(v,Ue[O]),Fe(f,v),qe[De(f)]=!0,f}function St(f){if(!f||at(f))return f;var v=f.tagName;return v&&/^(?:object|applet|embed)$/i.test(v)&&(Fe(f,c.Methods),Fe(f,c.Methods.Simulated),Fe(f,c.Methods.ByTag[v.toUpperCase()])),f}Oe.SpecificElementExtensions&&($e=xt?St:Prototype.K);function nt(f,v){f=f.toUpperCase(),Ue[f]||(Ue[f]={}),Object.extend(Ue[f],v)}function Je(f,v,O){Object.isUndefined(O)&&(O=!1);for(var Y in v){var ae=v[Y];Object.isFunction(ae)&&(!O||!(Y in f))&&(f[Y]=ae.methodize())}}function Et(f){var v,O={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};if(O[f]&&(v="HTML"+O[f]+"Element"),window[v]||(v="HTML"+f+"Element",window[v])||(v="HTML"+f.capitalize()+"Element",window[v]))return window[v];var Y=document.createElement(f),ae=Y.__proto__||Y.constructor.prototype;return Y=null,ae}function Tt(f){if(arguments.length===0&&At(),arguments.length===2){var v=f;f=arguments[1]}if(!v)Object.extend(c.Methods,f||{});else if(Object.isArray(v))for(var O=0,Y;Y=v[O];O++)nt(Y,f);else nt(v,f);var ae=window.HTMLElement?HTMLElement.prototype:c.prototype;if(Oe.ElementExtensions&&(Je(ae,c.Methods),Je(ae,c.Methods.Simulated,!0)),Oe.SpecificElementExtensions)for(var Y in c.Methods.ByTag){var se=Et(Y);Object.isUndefined(se)||Je(se.prototype,Ue[Y])}Object.extend(c,c.Methods),Object.extend(c,c.Methods.Simulated),delete c.ByTag,delete c.Simulated,c.extend.refresh(),o={}}Object.extend(e.Element,{extend:$e,addMethods:Tt}),$e===Prototype.K?e.Element.extend.refresh=Prototype.emptyFunction:e.Element.extend.refresh=function(){Prototype.BrowserFeatures.ElementExtensions||(Object.extend(Ve,c.Methods),Object.extend(Ve,c.Methods.Simulated),qe={})};function At(){Object.extend(Form,Form.Methods),Object.extend(Form.Element,Form.Element.Methods),Object.extend(c.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods),BUTTON:Object.clone(Form.Element.Methods)})}c.addMethods(h)})(this),(function(){function e(p){var U=p.match(/^(\d+)%?$/i);return U?Number(U[1])/100:null}function t(p,U){p=$(p);var M=p.style[U];if(!M||M==="auto"){var B=document.defaultView.getComputedStyle(p,null);M=B?B[U]:null}return U==="opacity"?M?parseFloat(M):1:M==="auto"?null:M}function r(p,U){var M=p.style[U];return!M&&p.currentStyle&&(M=p.currentStyle[U]),M}function a(p,U){var M=p.offsetWidth,B=n(p,"borderLeftWidth",U)||0,V=n(p,"borderRightWidth",U)||0,te=n(p,"paddingLeft",U)||0,J=n(p,"paddingRight",U)||0;return M-B-V-te-J}"currentStyle"in document.documentElement&&(t=r);function n(p,U,M){var B=null;if(Object.isElement(p)&&(B=p,p=t(B,U)),p===null||Object.isUndefined(p))return null;if(/^(?:-)?\d+(\.\d+)?(px)?$/i.test(p))return window.parseFloat(p);var V=p.include("%"),te=M===document.viewport;if(/\d/.test(p)&&B&&B.runtimeStyle&&!(V&&te)){var J=B.style.left,re=B.runtimeStyle.left;return B.runtimeStyle.left=B.currentStyle.left,B.style.left=p||0,p=B.style.pixelLeft,B.style.left=J,B.runtimeStyle.left=re,p}if(B&&V){M=M||B.parentNode;var ne=e(p),K=null,ue=U.include("left")||U.include("right")||U.include("width"),pe=U.include("top")||U.include("bottom")||U.include("height");return M===document.viewport?ue?K=document.viewport.getWidth():pe&&(K=document.viewport.getHeight()):ue?K=$(M).measure("width"):pe&&(K=$(M).measure("height")),K===null?0:K*ne}return 0}function o(p){return Object.isString(p)&&p.endsWith("px")?p:p+"px"}function u(p){for(;p&&p.parentNode;){var U=p.getStyle("display");if(U==="none")return!1;p=$(p.parentNode)}return!0}var s=Prototype.K;"currentStyle"in document.documentElement&&(s=function(p){return p.currentStyle.hasLayout||(p.style.zoom=1),p});function d(p){return p.include("border")&&(p=p+"-width"),p.camelize()}Element.Layout=Class.create(Hash,{initialize:function(p,U,M){p(),this.element=$(U),Element.Layout.PROPERTIES.each(function(B){this._set(B,null)},this),M&&(this._preComputing=!0,this._begin(),Element.Layout.PROPERTIES.each(this._compute,this),this._end(),this._preComputing=!1)},_set:function(p,U){return Hash.prototype.set.call(this,p,U)},set:function(p,U){throw"Properties of Element.Layout are read-only."},get:function(p,U){var M=p(U);return M===null?this._compute(U):M},_begin:function(){if(!this._isPrepared()){var p=this.element;if(u(p)){this._setPrepared(!0);return}var U={position:p.style.position||"",width:p.style.width||"",visibility:p.style.visibility||"",display:p.style.display||""};p.store("prototype_original_styles",U);var M=t(p,"position"),B=p.offsetWidth;(B===0||B===null)&&(p.style.display="block",B=p.offsetWidth);var V=M==="fixed"?document.viewport:p.parentNode,te={visibility:"hidden",display:"block"};M!=="fixed"&&(te.position="absolute"),p.setStyle(te);var J=p.offsetWidth,re;if(B&&J===B)re=a(p,V);else if(M==="absolute"||M==="fixed")re=a(p,V);else{var ne=p.parentNode,K=$(ne).getLayout();re=K.get("width")-this.get("margin-left")-this.get("border-left")-this.get("padding-left")-this.get("padding-right")-this.get("border-right")-this.get("margin-right")}p.setStyle({width:re+"px"}),this._setPrepared(!0)}},_end:function(){var p=this.element,U=p.retrieve("prototype_original_styles");p.store("prototype_original_styles",null),p.setStyle(U),this._setPrepared(!1)},_compute:function(p){var U=Element.Layout.COMPUTATIONS;if(!(p in U))throw"Property not found.";return this._set(p,U[p].call(this,this.element))},_isPrepared:function(){return this.element.retrieve("prototype_element_layout_prepared",!1)},_setPrepared:function(p){return this.element.store("prototype_element_layout_prepared",p)},toObject:function(){var p=$A(arguments),U=p.length===0?Element.Layout.PROPERTIES:p.join(" ").split(" "),M={};return U.each(function(B){if(Element.Layout.PROPERTIES.include(B)){var V=this.get(B);V!=null&&(M[B]=V)}},this),M},toHash:function(){var p=this.toObject.apply(this,arguments);return new Hash(p)},toCSS:function(){var p=$A(arguments),U=p.length===0?Element.Layout.PROPERTIES:p.join(" ").split(" "),M={};return U.each(function(B){if(Element.Layout.PROPERTIES.include(B)&&!Element.Layout.COMPOSITE_PROPERTIES.include(B)){var V=this.get(B);V!=null&&(M[d(B)]=V+"px")}},this),M},inspect:function(){return"#<Element.Layout>"}}),Object.extend(Element.Layout,{PROPERTIES:$w("height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height"),COMPOSITE_PROPERTIES:$w("padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height"),COMPUTATIONS:{height:function(p){this._preComputing||this._begin();var U=this.get("border-box-height");if(U<=0)return this._preComputing||this._end(),0;var M=this.get("border-top"),B=this.get("border-bottom"),V=this.get("padding-top"),te=this.get("padding-bottom");return this._preComputing||this._end(),U-M-B-V-te},width:function(p){this._preComputing||this._begin();var U=this.get("border-box-width");if(U<=0)return this._preComputing||this._end(),0;var M=this.get("border-left"),B=this.get("border-right"),V=this.get("padding-left"),te=this.get("padding-right");return this._preComputing||this._end(),U-M-B-V-te},"padding-box-height":function(p){var U=this.get("height"),M=this.get("padding-top"),B=this.get("padding-bottom");return U+M+B},"padding-box-width":function(p){var U=this.get("width"),M=this.get("padding-left"),B=this.get("padding-right");return U+M+B},"border-box-height":function(p){this._preComputing||this._begin();var U=p.offsetHeight;return this._preComputing||this._end(),U},"border-box-width":function(p){this._preComputing||this._begin();var U=p.offsetWidth;return this._preComputing||this._end(),U},"margin-box-height":function(p){var U=this.get("border-box-height"),M=this.get("margin-top"),B=this.get("margin-bottom");return U<=0?0:U+M+B},"margin-box-width":function(p){var U=this.get("border-box-width"),M=this.get("margin-left"),B=this.get("margin-right");return U<=0?0:U+M+B},top:function(p){var U=p.positionedOffset();return U.top},bottom:function(p){var U=p.positionedOffset(),M=p.getOffsetParent(),B=M.measure("height"),V=this.get("border-box-height");return B-V-U.top},left:function(p){var U=p.positionedOffset();return U.left},right:function(p){var U=p.positionedOffset(),M=p.getOffsetParent(),B=M.measure("width"),V=this.get("border-box-width");return B-V-U.left},"padding-top":function(p){return n(p,"paddingTop")},"padding-bottom":function(p){return n(p,"paddingBottom")},"padding-left":function(p){return n(p,"paddingLeft")},"padding-right":function(p){return n(p,"paddingRight")},"border-top":function(p){return n(p,"borderTopWidth")},"border-bottom":function(p){return n(p,"borderBottomWidth")},"border-left":function(p){return n(p,"borderLeftWidth")},"border-right":function(p){return n(p,"borderRightWidth")},"margin-top":function(p){return n(p,"marginTop")},"margin-bottom":function(p){return n(p,"marginBottom")},"margin-left":function(p){return n(p,"marginLeft")},"margin-right":function(p){return n(p,"marginRight")}}}),"getBoundingClientRect"in document.documentElement&&Object.extend(Element.Layout.COMPUTATIONS,{right:function(p){var U=s(p.getOffsetParent()),M=p.getBoundingClientRect(),B=U.getBoundingClientRect();return(B.right-M.right).round()},bottom:function(p){var U=s(p.getOffsetParent()),M=p.getBoundingClientRect(),B=U.getBoundingClientRect();return(B.bottom-M.bottom).round()}}),Element.Offset=Class.create({initialize:function(p,U){this.left=p.round(),this.top=U.round(),this[0]=this.left,this[1]=this.top},relativeTo:function(p){return new Element.Offset(this.left-p.left,this.top-p.top)},inspect:function(){return"#<Element.Offset left: #{left} top: #{top}>".interpolate(this)},toString:function(){return"[#{left}, #{top}]".interpolate(this)},toArray:function(){return[this.left,this.top]}});function c(p,U){return new Element.Layout(p,U)}function h(p,U){return $(p).getLayout().get(U)}function C(p){return Element.getDimensions(p).height}function m(p){return Element.getDimensions(p).width}function T(p){p=$(p);var U=Element.getStyle(p,"display");if(U&&U!=="none")return{width:p.offsetWidth,height:p.offsetHeight};var M=p.style,B={visibility:M.visibility,position:M.position,display:M.display},V={visibility:"hidden",display:"block"};B.position!=="fixed"&&(V.position="absolute"),Element.setStyle(p,V);var te={width:p.offsetWidth,height:p.offsetHeight};return Element.setStyle(p,B),te}function S(p){if(p=$(p),W(p)||Q(p)||I(p)||R(p))return $(document.body);var U=Element.getStyle(p,"display")==="inline";if(!U&&p.offsetParent)return $(p.offsetParent);for(;(p=p.parentNode)&&p!==document.body;)if(Element.getStyle(p,"position")!=="static")return R(p)?$(document.body):$(p);return $(document.body)}function P(p){p=$(p);var U=0,M=0;if(p.parentNode)do U+=p.offsetTop||0,M+=p.offsetLeft||0,p=p.offsetParent;while(p);return new Element.Offset(M,U)}function _(p){p=$(p);var U=p.getLayout(),M=0,B=0;do if(M+=p.offsetTop||0,B+=p.offsetLeft||0,p=p.offsetParent,p){if(I(p))break;var V=Element.getStyle(p,"position");if(V!=="static")break}while(p);return B-=U.get("margin-top"),M-=U.get("margin-left"),new Element.Offset(B,M)}function F(p){var U=0,M=0;do U+=p.scrollTop||0,M+=p.scrollLeft||0,p=p.parentNode;while(p);return new Element.Offset(M,U)}function g(p){var U=0,M=0,B=document.body,V=$(p);do if(U+=V.offsetTop||0,M+=V.offsetLeft||0,V.offsetParent==B&&Element.getStyle(V,"position")=="absolute")break;while(V=V.offsetParent);V=p;do V!=B&&(U-=V.scrollTop||0,M-=V.scrollLeft||0);while(V=V.parentNode);return new Element.Offset(M,U)}function b(p){if(p=$(p),Element.getStyle(p,"position")==="absolute")return p;var U=S(p),M=p.viewportOffset(),B=U.viewportOffset(),V=M.relativeTo(B),te=p.getLayout();return p.store("prototype_absolutize_original_styles",{left:p.getStyle("left"),top:p.getStyle("top"),width:p.getStyle("width"),height:p.getStyle("height")}),p.setStyle({position:"absolute",top:V.top+"px",left:V.left+"px",width:te.get("width")+"px",height:te.get("height")+"px"}),p}function k(p){if(p=$(p),Element.getStyle(p,"position")==="relative")return p;var U=p.retrieve("prototype_absolutize_original_styles");return U&&p.setStyle(U),p}function L(p){p=$(p);var U=Element.cumulativeOffset(p);return window.scrollTo(U.left,U.top),p}function A(p){p=$(p);var U=Element.getStyle(p,"position"),M={};return(U==="static"||!U)&&(M.position="relative",Prototype.Browser.Opera&&(M.top=0,M.left=0),Element.setStyle(p,M),Element.store(p,"prototype_made_positioned",!0)),p}function E(p){p=$(p);var U=Element.getStorage(p),M=U.get("prototype_made_positioned");return M&&(U.unset("prototype_made_positioned"),Element.setStyle(p,{position:"",top:"",bottom:"",left:"",right:""})),p}function j(p){p=$(p);var U=Element.getStorage(p),M=U.get("prototype_made_clipping");if(Object.isUndefined(M)){var B=Element.getStyle(p,"overflow");U.set("prototype_made_clipping",B),B!=="hidden"&&(p.style.overflow="hidden")}return p}function D(p){p=$(p);var U=Element.getStorage(p),M=U.get("prototype_made_clipping");return Object.isUndefined(M)||(U.unset("prototype_made_clipping"),p.style.overflow=M||""),p}function N(p,U,M){M=Object.extend({setLeft:!0,setTop:!0,setWidth:!0,setHeight:!0,offsetTop:0,offsetLeft:0},M||{}),U=$(U),p=$(p);var B,V,te,J={};if((M.setLeft||M.setTop)&&(B=Element.viewportOffset(U),V=[0,0],Element.getStyle(p,"position")==="absolute")){var re=Element.getOffsetParent(p);re!==document.body&&(V=Element.viewportOffset(re))}return(M.setWidth||M.setHeight)&&(te=Element.getLayout(U)),M.setLeft&&(J.left=B[0]-V[0]+M.offsetLeft+"px"),M.setTop&&(J.top=B[1]-V[1]+M.offsetTop+"px"),M.setWidth&&(J.width=te.get("border-box-width")+"px"),M.setHeight&&(J.height=te.get("border-box-height")+"px"),Element.setStyle(p,J)}Prototype.Browser.IE?(S=S.wrap(function(p,U){if(U=$(U),W(U)||Q(U)||I(U)||R(U))return $(document.body);var M=U.getStyle("position");if(M!=="static")return p(U);U.setStyle({position:"relative"});var B=p(U);return U.setStyle({position:M}),B}),_=_.wrap(function(p,U){if(U=$(U),!U.parentNode)return new Element.Offset(0,0);var M=U.getStyle("position");if(M!=="static")return p(U);var B=U.getOffsetParent();B&&B.getStyle("position")==="fixed"&&s(B),U.setStyle({position:"relative"});var V=p(U);return U.setStyle({position:M}),V})):Prototype.Browser.Webkit&&(P=function(p){p=$(p);var U=0,M=0;do{if(U+=p.offsetTop||0,M+=p.offsetLeft||0,p.offsetParent==document.body&&Element.getStyle(p,"position")=="absolute")break;p=p.offsetParent}while(p);return new Element.Offset(M,U)}),Element.addMethods({getLayout:c,measure:h,getWidth:m,getHeight:C,getDimensions:T,getOffsetParent:S,cumulativeOffset:P,positionedOffset:_,cumulativeScrollOffset:F,viewportOffset:g,absolutize:b,relativize:k,scrollTo:L,makePositioned:A,undoPositioned:E,makeClipping:j,undoClipping:D,clonePosition:N});function I(p){return p.nodeName.toUpperCase()==="BODY"}function R(p){return p.nodeName.toUpperCase()==="HTML"}function W(p){return p.nodeType===Node.DOCUMENT_NODE}function Q(p){return p!==document.body&&!Element.descendantOf(p,document.body)}"getBoundingClientRect"in document.documentElement&&Element.addMethods({viewportOffset:function(p){if(p=$(p),Q(p))return new Element.Offset(0,0);var U=p.getBoundingClientRect(),M=document.documentElement;return new Element.Offset(U.left-M.clientLeft,U.top-M.clientTop)}})})(),(function(){var e=Prototype.Browser.Opera&&window.parseFloat(window.opera.version())<9.5,t=null;function r(){return t||(t=e?document.body:document.documentElement,t)}function a(){return{width:this.getWidth(),height:this.getHeight()}}function n(){return r().clientWidth}function o(){return r().clientHeight}function u(){var s=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,d=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;return new Element.Offset(s,d)}document.viewport={getDimensions:a,getWidth:n,getHeight:o,getScrollOffsets:u}})(),window.$$=function(){var e=$A(arguments).join(", ");return Prototype.Selector.select(e,document)},Prototype.Selector=(function(){function e(){throw new Error('Method "Prototype.Selector.select" must be defined.')}function t(){throw new Error('Method "Prototype.Selector.match" must be defined.')}function r(o,u,s){s=s||0;var d=Prototype.Selector.match,c=o.length,h=0,C;for(C=0;C<c;C++)if(d(o[C],u)&&s==h++)return Element.extend(o[C])}function a(o){for(var u=0,s=o.length;u<s;u++)Element.extend(o[u]);return o}var n=Prototype.K;return{select:e,match:t,find:r,extendElements:Element.extend===n?n:a,extendElement:Element.extend}})();/*!
 * Sizzle CSS Selector Engine
 *  Copyright 2011, The Dojo Foundation
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://sizzlejs.com/
 */(function(){var e=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,t=0,r=Object.prototype.toString,a=!1,n=!0,o=/\\/g,u=/\W/;[0,0].sort(function(){return n=!1,0});var s=function(g,b,k,L){k=k||[],b=b||document;var A=b;if(b.nodeType!==1&&b.nodeType!==9)return[];if(!g||typeof g!="string")return k;var E,j,D,N,I,R,W,Q,p=!0,U=s.isXML(b),M=[],B=g;do if(e.exec(""),E=e.exec(B),E&&(B=E[3],M.push(E[1]),E[2])){N=E[3];break}while(E);if(M.length>1&&c.exec(g))if(M.length===2&&d.relative[M[0]])j=F(M[0]+M[1],b);else for(j=d.relative[M[0]]?[b]:s(M.shift(),b);M.length;)g=M.shift(),d.relative[g]&&(g+=M.shift()),j=F(g,j);else if(!L&&M.length>1&&b.nodeType===9&&!U&&d.match.ID.test(M[0])&&!d.match.ID.test(M[M.length-1])&&(I=s.find(M.shift(),b,U),b=I.expr?s.filter(I.expr,I.set)[0]:I.set[0]),b)for(I=L?{expr:M.pop(),set:m(L)}:s.find(M.pop(),M.length===1&&(M[0]==="~"||M[0]==="+")&&b.parentNode?b.parentNode:b,U),j=I.expr?s.filter(I.expr,I.set):I.set,M.length>0?D=m(j):p=!1;M.length;)R=M.pop(),W=R,d.relative[R]?W=M.pop():R="",W==null&&(W=b),d.relative[R](D,W,U);else D=M=[];if(D||(D=j),D||s.error(R||g),r.call(D)==="[object Array]")if(!p)k.push.apply(k,D);else if(b&&b.nodeType===1)for(Q=0;D[Q]!=null;Q++)D[Q]&&(D[Q]===!0||D[Q].nodeType===1&&s.contains(b,D[Q]))&&k.push(j[Q]);else for(Q=0;D[Q]!=null;Q++)D[Q]&&D[Q].nodeType===1&&k.push(j[Q]);else m(D,k);return N&&(s(N,A,k,L),s.uniqueSort(k)),k};s.uniqueSort=function(g){if(T&&(a=n,g.sort(T),a))for(var b=1;b<g.length;b++)g[b]===g[b-1]&&g.splice(b--,1);return g},s.matches=function(g,b){return s(g,null,null,b)},s.matchesSelector=function(g,b){return s(b,null,null,[g]).length>0},s.find=function(g,b,k){var L;if(!g)return[];for(var A=0,E=d.order.length;A<E;A++){var j,D=d.order[A];if(j=d.leftMatch[D].exec(g)){var N=j[1];if(j.splice(1,1),N.substr(N.length-1)!=="\\"&&(j[1]=(j[1]||"").replace(o,""),L=d.find[D](j,b,k),L!=null)){g=g.replace(d.match[D],"");break}}}return L||(L=typeof b.getElementsByTagName<"u"?b.getElementsByTagName("*"):[]),{set:L,expr:g}},s.filter=function(g,b,k,L){for(var A,E,j=g,D=[],N=b,I=b&&b[0]&&s.isXML(b[0]);g&&b.length;){for(var R in d.filter)if((A=d.leftMatch[R].exec(g))!=null&&A[2]){var W,Q,p=d.filter[R],U=A[1];if(E=!1,A.splice(1,1),U.substr(U.length-1)==="\\")continue;if(N===D&&(D=[]),d.preFilter[R]){if(A=d.preFilter[R](A,N,k,D,L,I),!A)E=W=!0;else if(A===!0)continue}if(A){for(var M=0;(Q=N[M])!=null;M++)if(Q){W=p(Q,A,M,N);var B=L^!!W;k&&W!=null?B?E=!0:N[M]=!1:B&&(D.push(Q),E=!0)}}if(W!==void 0){if(k||(N=D),g=g.replace(d.match[R],""),!E)return[];break}}if(g===j)if(E==null)s.error(g);else break;j=g}return N},s.error=function(g){throw"Syntax error, unrecognized expression: "+g};var d=s.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{class:"className",for:"htmlFor"},attrHandle:{href:function(g){return g.getAttribute("href")},type:function(g){return g.getAttribute("type")}},relative:{"+":function(g,b){var k=typeof b=="string",L=k&&!u.test(b),A=k&&!L;L&&(b=b.toLowerCase());for(var E=0,j=g.length,D;E<j;E++)if(D=g[E]){for(;(D=D.previousSibling)&&D.nodeType!==1;);g[E]=A||D&&D.nodeName.toLowerCase()===b?D||!1:D===b}A&&s.filter(b,g,!0)},">":function(g,b){var k,L=typeof b=="string",A=0,E=g.length;if(L&&!u.test(b)){for(b=b.toLowerCase();A<E;A++)if(k=g[A],k){var j=k.parentNode;g[A]=j.nodeName.toLowerCase()===b?j:!1}}else{for(;A<E;A++)k=g[A],k&&(g[A]=L?k.parentNode:k.parentNode===b);L&&s.filter(b,g,!0)}},"":function(g,b,k){var L,A=t++,E=_;typeof b=="string"&&!u.test(b)&&(b=b.toLowerCase(),L=b,E=P),E("parentNode",b,A,g,L,k)},"~":function(g,b,k){var L,A=t++,E=_;typeof b=="string"&&!u.test(b)&&(b=b.toLowerCase(),L=b,E=P),E("previousSibling",b,A,g,L,k)}},find:{ID:function(g,b,k){if(typeof b.getElementById<"u"&&!k){var L=b.getElementById(g[1]);return L&&L.parentNode?[L]:[]}},NAME:function(g,b){if(typeof b.getElementsByName<"u"){for(var k=[],L=b.getElementsByName(g[1]),A=0,E=L.length;A<E;A++)L[A].getAttribute("name")===g[1]&&k.push(L[A]);return k.length===0?null:k}},TAG:function(g,b){if(typeof b.getElementsByTagName<"u")return b.getElementsByTagName(g[1])}},preFilter:{CLASS:function(g,b,k,L,A,E){if(g=" "+g[1].replace(o,"")+" ",E)return g;for(var j=0,D;(D=b[j])!=null;j++)D&&(A^(D.className&&(" "+D.className+" ").replace(/[\t\n\r]/g," ").indexOf(g)>=0)?k||L.push(D):k&&(b[j]=!1));return!1},ID:function(g){return g[1].replace(o,"")},TAG:function(g,b){return g[1].replace(o,"").toLowerCase()},CHILD:function(g){if(g[1]==="nth"){g[2]||s.error(g[0]),g[2]=g[2].replace(/^\+|\s*/g,"");var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(g[2]==="even"&&"2n"||g[2]==="odd"&&"2n+1"||!/\D/.test(g[2])&&"0n+"+g[2]||g[2]);g[2]=b[1]+(b[2]||1)-0,g[3]=b[3]-0}else g[2]&&s.error(g[0]);return g[0]=t++,g},ATTR:function(g,b,k,L,A,E){var j=g[1]=g[1].replace(o,"");return!E&&d.attrMap[j]&&(g[1]=d.attrMap[j]),g[4]=(g[4]||g[5]||"").replace(o,""),g[2]==="~="&&(g[4]=" "+g[4]+" "),g},PSEUDO:function(g,b,k,L,A){if(g[1]==="not")if((e.exec(g[3])||"").length>1||/^\w/.test(g[3]))g[3]=s(g[3],null,null,b);else{var E=s.filter(g[3],b,k,!0^A);return k||L.push.apply(L,E),!1}else if(d.match.POS.test(g[0])||d.match.CHILD.test(g[0]))return!0;return g},POS:function(g){return g.unshift(!0),g}},filters:{enabled:function(g){return g.disabled===!1&&g.type!=="hidden"},disabled:function(g){return g.disabled===!0},checked:function(g){return g.checked===!0},selected:function(g){return g.parentNode&&g.parentNode.selectedIndex,g.selected===!0},parent:function(g){return!!g.firstChild},empty:function(g){return!g.firstChild},has:function(g,b,k){return!!s(k[3],g).length},header:function(g){return/h\d/i.test(g.nodeName)},text:function(g){var b=g.getAttribute("type"),k=g.type;return g.nodeName.toLowerCase()==="input"&&k==="text"&&(b===k||b===null)},radio:function(g){return g.nodeName.toLowerCase()==="input"&&g.type==="radio"},checkbox:function(g){return g.nodeName.toLowerCase()==="input"&&g.type==="checkbox"},file:function(g){return g.nodeName.toLowerCase()==="input"&&g.type==="file"},password:function(g){return g.nodeName.toLowerCase()==="input"&&g.type==="password"},submit:function(g){var b=g.nodeName.toLowerCase();return(b==="input"||b==="button")&&g.type==="submit"},image:function(g){return g.nodeName.toLowerCase()==="input"&&g.type==="image"},reset:function(g){var b=g.nodeName.toLowerCase();return(b==="input"||b==="button")&&g.type==="reset"},button:function(g){var b=g.nodeName.toLowerCase();return b==="input"&&g.type==="button"||b==="button"},input:function(g){return/input|select|textarea|button/i.test(g.nodeName)},focus:function(g){return g===g.ownerDocument.activeElement}},setFilters:{first:function(g,b){return b===0},last:function(g,b,k,L){return b===L.length-1},even:function(g,b){return b%2===0},odd:function(g,b){return b%2===1},lt:function(g,b,k){return b<k[3]-0},gt:function(g,b,k){return b>k[3]-0},nth:function(g,b,k){return k[3]-0===b},eq:function(g,b,k){return k[3]-0===b}},filter:{PSEUDO:function(g,b,k,L){var A=b[1],E=d.filters[A];if(E)return E(g,k,b,L);if(A==="contains")return(g.textContent||g.innerText||s.getText([g])||"").indexOf(b[3])>=0;if(A==="not"){for(var j=b[3],D=0,N=j.length;D<N;D++)if(j[D]===g)return!1;return!0}else s.error(A)},CHILD:function(g,b){var k=b[1],L=g;switch(k){case"only":case"first":for(;L=L.previousSibling;)if(L.nodeType===1)return!1;if(k==="first")return!0;L=g;case"last":for(;L=L.nextSibling;)if(L.nodeType===1)return!1;return!0;case"nth":var A=b[2],E=b[3];if(A===1&&E===0)return!0;var j=b[0],D=g.parentNode;if(D&&(D.sizcache!==j||!g.nodeIndex)){var N=0;for(L=D.firstChild;L;L=L.nextSibling)L.nodeType===1&&(L.nodeIndex=++N);D.sizcache=j}var I=g.nodeIndex-E;return A===0?I===0:I%A===0&&I/A>=0}},ID:function(g,b){return g.nodeType===1&&g.getAttribute("id")===b},TAG:function(g,b){return b==="*"&&g.nodeType===1||g.nodeName.toLowerCase()===b},CLASS:function(g,b){return(" "+(g.className||g.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(g,b){var k=b[1],L=d.attrHandle[k]?d.attrHandle[k](g):g[k]!=null?g[k]:g.getAttribute(k),A=L+"",E=b[2],j=b[4];return L==null?E==="!=":E==="="?A===j:E==="*="?A.indexOf(j)>=0:E==="~="?(" "+A+" ").indexOf(j)>=0:j?E==="!="?A!==j:E==="^="?A.indexOf(j)===0:E==="$="?A.substr(A.length-j.length)===j:E==="|="?A===j||A.substr(0,j.length+1)===j+"-":!1:A&&L!==!1},POS:function(g,b,k,L){var A=b[2],E=d.setFilters[A];if(E)return E(g,k,b,L)}}},c=d.match.POS,h=function(g,b){return"\\"+(b-0+1)};for(var C in d.match)d.match[C]=new RegExp(d.match[C].source+/(?![^\[]*\])(?![^\(]*\))/.source),d.leftMatch[C]=new RegExp(/(^(?:.|\r|\n)*?)/.source+d.match[C].source.replace(/\\(\d+)/g,h));var m=function(g,b){return g=Array.prototype.slice.call(g,0),b?(b.push.apply(b,g),b):g};try{Array.prototype.slice.call(document.documentElement.childNodes,0)[0].nodeType}catch{m=function(b,k){var L=0,A=k||[];if(r.call(b)==="[object Array]")Array.prototype.push.apply(A,b);else if(typeof b.length=="number")for(var E=b.length;L<E;L++)A.push(b[L]);else for(;b[L];L++)A.push(b[L]);return A}}var T,S;document.documentElement.compareDocumentPosition?T=function(g,b){return g===b?(a=!0,0):!g.compareDocumentPosition||!b.compareDocumentPosition?g.compareDocumentPosition?-1:1:g.compareDocumentPosition(b)&4?-1:1}:(T=function(g,b){if(g===b)return a=!0,0;if(g.sourceIndex&&b.sourceIndex)return g.sourceIndex-b.sourceIndex;var k,L,A=[],E=[],j=g.parentNode,D=b.parentNode,N=j;if(j===D)return S(g,b);if(j){if(!D)return 1}else return-1;for(;N;)A.unshift(N),N=N.parentNode;for(N=D;N;)E.unshift(N),N=N.parentNode;k=A.length,L=E.length;for(var I=0;I<k&&I<L;I++)if(A[I]!==E[I])return S(A[I],E[I]);return I===k?S(g,E[I],-1):S(A[I],b,1)},S=function(g,b,k){if(g===b)return k;for(var L=g.nextSibling;L;){if(L===b)return-1;L=L.nextSibling}return 1}),s.getText=function(g){for(var b="",k,L=0;g[L];L++)k=g[L],k.nodeType===3||k.nodeType===4?b+=k.nodeValue:k.nodeType!==8&&(b+=s.getText(k.childNodes));return b},(function(){var g=document.createElement("div"),b="script"+new Date().getTime(),k=document.documentElement;g.innerHTML="<a name='"+b+"'/>",k.insertBefore(g,k.firstChild),document.getElementById(b)&&(d.find.ID=function(L,A,E){if(typeof A.getElementById<"u"&&!E){var j=A.getElementById(L[1]);return j?j.id===L[1]||typeof j.getAttributeNode<"u"&&j.getAttributeNode("id").nodeValue===L[1]?[j]:void 0:[]}},d.filter.ID=function(L,A){var E=typeof L.getAttributeNode<"u"&&L.getAttributeNode("id");return L.nodeType===1&&E&&E.nodeValue===A}),k.removeChild(g),k=g=null})(),(function(){var g=document.createElement("div");g.appendChild(document.createComment("")),g.getElementsByTagName("*").length>0&&(d.find.TAG=function(b,k){var L=k.getElementsByTagName(b[1]);if(b[1]==="*"){for(var A=[],E=0;L[E];E++)L[E].nodeType===1&&A.push(L[E]);L=A}return L}),g.innerHTML="<a href='#'></a>",g.firstChild&&typeof g.firstChild.getAttribute<"u"&&g.firstChild.getAttribute("href")!=="#"&&(d.attrHandle.href=function(b){return b.getAttribute("href",2)}),g=null})(),document.querySelectorAll&&(function(){var g=s,b=document.createElement("div"),k="__sizzle__";if(b.innerHTML="<p class='TEST'></p>",!(b.querySelectorAll&&b.querySelectorAll(".TEST").length===0)){s=function(A,E,j,D){if(E=E||document,!D&&!s.isXML(E)){var N=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(A);if(N&&(E.nodeType===1||E.nodeType===9)){if(N[1])return m(E.getElementsByTagName(A),j);if(N[2]&&d.find.CLASS&&E.getElementsByClassName)return m(E.getElementsByClassName(N[2]),j)}if(E.nodeType===9){if(A==="body"&&E.body)return m([E.body],j);if(N&&N[3]){var I=E.getElementById(N[3]);if(I&&I.parentNode){if(I.id===N[3])return m([I],j)}else return m([],j)}try{return m(E.querySelectorAll(A),j)}catch{}}else if(E.nodeType===1&&E.nodeName.toLowerCase()!=="object"){var R=E,W=E.getAttribute("id"),Q=W||k,p=E.parentNode,U=/^\s*[+~]/.test(A);W?Q=Q.replace(/'/g,"\\$&"):E.setAttribute("id",Q),U&&p&&(E=E.parentNode);try{if(!U||p)return m(E.querySelectorAll("[id='"+Q+"'] "+A),j)}catch{}finally{W||R.removeAttribute("id")}}}return g(A,E,j,D)};for(var L in g)s[L]=g[L];b=null}})(),(function(){var g=document.documentElement,b=g.matchesSelector||g.mozMatchesSelector||g.webkitMatchesSelector||g.msMatchesSelector;if(b){var k=!b.call(document.createElement("div"),"div"),L=!1;try{b.call(document.documentElement,"[test!='']:sizzle")}catch{L=!0}s.matchesSelector=function(A,E){if(E=E.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']"),!s.isXML(A))try{if(L||!d.match.PSEUDO.test(E)&&!/!=/.test(E)){var j=b.call(A,E);if(j||!k||A.document&&A.document.nodeType!==11)return j}}catch{}return s(E,null,null,[A]).length>0}}})(),(function(){var g=document.createElement("div");g.innerHTML="<div class='test e'></div><div class='test'></div>",!(!g.getElementsByClassName||g.getElementsByClassName("e").length===0)&&(g.lastChild.className="e",g.getElementsByClassName("e").length!==1&&(d.order.splice(1,0,"CLASS"),d.find.CLASS=function(b,k,L){if(typeof k.getElementsByClassName<"u"&&!L)return k.getElementsByClassName(b[1])},g=null))})();function P(g,b,k,L,A,E){for(var j=0,D=L.length;j<D;j++){var N=L[j];if(N){var I=!1;for(N=N[g];N;){if(N.sizcache===k){I=L[N.sizset];break}if(N.nodeType===1&&!E&&(N.sizcache=k,N.sizset=j),N.nodeName.toLowerCase()===b){I=N;break}N=N[g]}L[j]=I}}}function _(g,b,k,L,A,E){for(var j=0,D=L.length;j<D;j++){var N=L[j];if(N){var I=!1;for(N=N[g];N;){if(N.sizcache===k){I=L[N.sizset];break}if(N.nodeType===1){if(E||(N.sizcache=k,N.sizset=j),typeof b!="string"){if(N===b){I=!0;break}}else if(s.filter(b,[N]).length>0){I=N;break}}N=N[g]}L[j]=I}}}document.documentElement.contains?s.contains=function(g,b){return g!==b&&(g.contains?g.contains(b):!0)}:document.documentElement.compareDocumentPosition?s.contains=function(g,b){return!!(g.compareDocumentPosition(b)&16)}:s.contains=function(){return!1},s.isXML=function(g){var b=(g?g.ownerDocument||g:0).documentElement;return b?b.nodeName!=="HTML":!1};var F=function(g,b){for(var k,L=[],A="",E=b.nodeType?[b]:b;k=d.match.PSEUDO.exec(g);)A+=k[0],g=g.replace(d.match.PSEUDO,"");g=d.relative[g]?g+"*":g;for(var j=0,D=E.length;j<D;j++)s(g,E[j],L);return s.filter(A,L)};window.Sizzle=s})(),Prototype._original_property=window.Sizzle,(function(e){var t=Prototype.Selector.extendElements;function r(n,o){return t(e(n,o||document))}function a(n,o){return e.matches(o,[n]).length==1}Prototype.Selector.engine=e,Prototype.Selector.select=r,Prototype.Selector.match=a})(Sizzle),window.Sizzle=Prototype._original_property,delete Prototype._original_property;var Form={reset:function(e){return e=$(e),e.reset(),e},serializeElements:function(e,t){typeof t!="object"?t={hash:!!t}:Object.isUndefined(t.hash)&&(t.hash=!0);var r,a,n=!1,o=t.submit,u,s;return t.hash?(s={},u=function(d,c,h){return c in d?(Object.isArray(d[c])||(d[c]=[d[c]]),d[c].push(h)):d[c]=h,d}):(s="",u=function(d,c,h){return h=h.gsub(/(\r)?\n/,`\r
`),h=encodeURIComponent(h),h=h.gsub(/%20/,"+"),d+(d?"&":"")+encodeURIComponent(c)+"="+h}),e.inject(s,function(d,c){return!c.disabled&&c.name&&(r=c.name,a=$(c).getValue(),a!=null&&c.type!="file"&&(c.type!="submit"||!n&&o!==!1&&(!o||r==o)&&(n=!0))&&(d=u(d,r,a))),d})}};Form.Methods={serialize:function(e,t){return Form.serializeElements(Form.getElements(e),t)},getElements:function(e){for(var t=$(e).getElementsByTagName("*"),r,a=[],n=Form.Element.Serializers,o=0;r=t[o];o++)n[r.tagName.toLowerCase()]&&a.push(Element.extend(r));return a},getInputs:function(e,t,r){e=$(e);var a=e.getElementsByTagName("input");if(!t&&!r)return $A(a).map(Element.extend);for(var n=0,o=[],u=a.length;n<u;n++){var s=a[n];t&&s.type!=t||r&&s.name!=r||o.push(Element.extend(s))}return o},disable:function(e){return e=$(e),Form.getElements(e).invoke("disable"),e},enable:function(e){return e=$(e),Form.getElements(e).invoke("enable"),e},findFirstElement:function(e){var t=$(e).getElements().findAll(function(a){return a.type!="hidden"&&!a.disabled}),r=t.findAll(function(a){return a.hasAttribute("tabIndex")&&a.tabIndex>=0}).sortBy(function(a){return a.tabIndex}).first();return r||t.find(function(a){return/^(?:input|select|textarea)$/i.test(a.tagName)})},focusFirstElement:function(e){e=$(e);var t=e.findFirstElement();return t&&t.activate(),e},request:function(e,t){e=$(e),t=Object.clone(t||{});var r=t.parameters,a=e.readAttribute("action")||"";return a.blank()&&(a=window.location.href),t.parameters=e.serialize(!0),r&&(Object.isString(r)&&(r=r.toQueryParams()),Object.extend(t.parameters,r)),e.hasAttribute("method")&&!t.method&&(t.method=e.method),new Ajax.Request(a,t)}},Form.Element={focus:function(e){return $(e).focus(),e},select:function(e){return $(e).select(),e}},Form.Element.Methods={serialize:function(e){if(e=$(e),!e.disabled&&e.name){var t=e.getValue();if(t!=null){var r={};return r[e.name]=t,Object.toQueryString(r)}}return""},getValue:function(e){e=$(e);var t=e.tagName.toLowerCase();return Form.Element.Serializers[t](e)},setValue:function(e,t){e=$(e);var r=e.tagName.toLowerCase();return Form.Element.Serializers[r](e,t),e},clear:function(e){return $(e).value="",e},present:function(e){return $(e).value!=""},activate:function(e){e=$(e);try{e.focus(),e.select&&(e.tagName.toLowerCase()!="input"||!/^(?:button|reset|submit)$/i.test(e.type))&&e.select()}catch{}return e},disable:function(e){return e=$(e),e.disabled=!0,e},enable:function(e){return e=$(e),e.disabled=!1,e}};var Field=Form.Element,$F=Form.Element.Methods.getValue;Form.Element.Serializers=(function(){function e(s,d){switch(s.type.toLowerCase()){case"checkbox":case"radio":return t(s,d);default:return r(s,d)}}function t(s,d){if(Object.isUndefined(d))return s.checked?s.value:null;s.checked=!!d}function r(s,d){if(Object.isUndefined(d))return s.value;s.value=d}function a(s,d){if(Object.isUndefined(d))return(s.type==="select-one"?n:o)(s);for(var c,h,C=!Object.isArray(d),m=0,T=s.length;m<T;m++)if(c=s.options[m],h=this.optionValue(c),C){if(h==d){c.selected=!0;return}}else c.selected=d.include(h)}function n(s){var d=s.selectedIndex;return d>=0?u(s.options[d]):null}function o(s){var d,c=s.length;if(!c)return null;for(var h=0,d=[];h<c;h++){var C=s.options[h];C.selected&&d.push(u(C))}return d}function u(s){return Element.hasAttribute(s,"value")?s.value:s.text}return{input:e,inputSelector:t,textarea:r,select:a,selectOne:n,selectMany:o,optionValue:u,button:r}})(),Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function(e,t,r,a){e(a,r),this.element=$(t),this.lastValue=this.getValue()},execute:function(){var e=this.getValue();(Object.isString(this.lastValue)&&Object.isString(e)?this.lastValue!=e:String(this.lastValue)!=String(e))&&(this.callback(this.element,e),this.lastValue=e)}}),Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}}),Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}}),Abstract.EventObserver=Class.create({initialize:function(e,t){this.element=$(e),this.callback=t,this.lastValue=this.getValue(),this.element.tagName.toLowerCase()=="form"?this.registerFormCallbacks():this.registerCallback(this.element)},onElementEvent:function(){var e=this.getValue();this.lastValue!=e&&(this.callback(this.element,e),this.lastValue=e)},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(e){if(e.type)switch(e.type.toLowerCase()){case"checkbox":case"radio":Event.observe(e,"click",this.onElementEvent.bind(this));break;default:Event.observe(e,"change",this.onElementEvent.bind(this));break}}}),Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}}),Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}}),(function(e){var t=document.createElement("div"),r=document.documentElement,a="onmouseenter"in r&&"onmouseleave"in r,n={KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45},o=function(H){return!1};window.attachEvent&&(window.addEventListener?o=function(H){return!(H instanceof window.Event)}:o=function(H){return!0});var u;function s(H,z){return H.which?H.which===z+1:H.button===z}var d={0:1,1:4,2:2};function c(H,z){return H.button===d[z]}function h(H,z){switch(z){case 0:return H.which==1&&!H.metaKey;case 1:return H.which==2||H.which==1&&H.metaKey;case 2:return H.which==3;default:return!1}}window.attachEvent?window.addEventListener?u=function(H,z){return o(H)?c(H,z):s(H,z)}:u=c:Prototype.Browser.WebKit?u=h:u=s;function C(H){return u(H,0)}function m(H){return u(H,1)}function T(H){return u(H,2)}function S(H){return Element.extend(P(H))}function P(H){H=n.extend(H);var z=H.target,q=H.type,Z=H.currentTarget;return Z&&Z.tagName&&(q==="load"||q==="error"||q==="click"&&Z.tagName.toLowerCase()==="input"&&Z.type==="radio")&&(z=Z),z.nodeType==Node.TEXT_NODE&&(z=z.parentNode),Element.extend(z)}function _(H,z){var q=P(H),Z=Prototype.Selector.match;if(!z)return Element.extend(q);for(;q;){if(Object.isElement(q)&&Z(q,z))return Element.extend(q);q=q.parentNode}}function F(H){return{x:g(H),y:b(H)}}function g(H){var z=document.documentElement,q=document.body||{scrollLeft:0};return H.pageX||H.clientX+(z.scrollLeft||q.scrollLeft)-(z.clientLeft||0)}function b(H){var z=document.documentElement,q=document.body||{scrollTop:0};return H.pageY||H.clientY+(z.scrollTop||q.scrollTop)-(z.clientTop||0)}function k(H){n.extend(H),H.preventDefault(),H.stopPropagation(),H.stopped=!0}n.Methods={isLeftClick:C,isMiddleClick:m,isRightClick:T,element:S,findElement:_,pointer:F,pointerX:g,pointerY:b,stop:k};var L=Object.keys(n.Methods).inject({},function(H,z){return H[z]=n.Methods[z].methodize(),H});if(window.attachEvent){let H=function(z){var q;switch(z.type){case"mouseover":case"mouseenter":q=z.fromElement;break;case"mouseout":case"mouseleave":q=z.toElement;break;default:return null}return Element.extend(q)};var Te=H,A={stopPropagation:function(){this.cancelBubble=!0},preventDefault:function(){this.returnValue=!1},inspect:function(){return"[object Event]"}};n.extend=function(z,q){if(!z)return!1;if(!o(z)||z._extendedByPrototype)return z;z._extendedByPrototype=Prototype.emptyFunction;var Z=n.pointer(z);return Object.extend(z,{target:z.srcElement||q,relatedTarget:H(z),pageX:Z.x,pageY:Z.y}),Object.extend(z,L),Object.extend(z,A),z}}else n.extend=Prototype.K;window.addEventListener&&(n.prototype=window.Event.prototype||document.createEvent("HTMLEvents").__proto__,Object.extend(n.prototype,L));var E={mouseenter:"mouseover",mouseleave:"mouseout"};function j(H){return E[H]||H}a&&(j=Prototype.K);function D(H){return H===window?0:(typeof H._prototypeUID>"u"&&(H._prototypeUID=Element.Storage.UID++),H._prototypeUID)}function N(H){return H===window?0:H==document?1:H.uniqueID}"uniqueID"in t&&(D=N);function I(H){return H.include(":")}n._isCustomEvent=I;function R(H,z){var q=e.Event.cache;return Object.isUndefined(z)&&(z=D(H)),q[z]||(q[z]={element:H}),q[z]}function W(H,z){Object.isUndefined(z)&&(z=D(H)),delete e.Event.cache[z]}function Q(H,z,q){var Z=R(H);Z[z]||(Z[z]=[]);for(var G=Z[z],X=G.length;X--;)if(G[X].handler===q)return null;var ie=D(H),ee=e.Event._createResponder(ie,z,q),le={responder:ee,handler:q};return G.push(le),le}function p(H,z,q){var Z=R(H),G=Z[z];if(G){for(var X=G.length,ie;X--;)if(G[X].handler===q){ie=G[X];break}if(ie){var ee=G.indexOf(ie);return G.splice(ee,1),ie}}}function U(H,z,q){H=$(H);var Z=Q(H,z,q);if(Z===null)return H;var G=Z.responder;return I(z)?B(H,z,G):M(H,z,G),H}function M(H,z,q){var Z=j(z);H.addEventListener?H.addEventListener(Z,q,!1):H.attachEvent("on"+Z,q)}function B(H,z,q){H.addEventListener?H.addEventListener("dataavailable",q,!1):(H.attachEvent("ondataavailable",q),H.attachEvent("onlosecapture",q))}function V(H,z,q){H=$(H);var Z=!Object.isUndefined(q),G=!Object.isUndefined(z);if(!G&&!Z)return re(H),H;if(!Z)return ne(H,z),H;var X=p(H,z,q);return X&&K(H,z,X.responder),H}function te(H,z,q){var Z=j(z);H.removeEventListener?H.removeEventListener(Z,q,!1):H.detachEvent("on"+Z,q)}function J(H,z,q){H.removeEventListener?H.removeEventListener("dataavailable",q,!1):(H.detachEvent("ondataavailable",q),H.detachEvent("onlosecapture",q))}function re(H){var z=D(H),q=R(H,z);W(H,z);var Z,G;for(var X in q)if(X!=="element")for(Z=q[X],G=Z.length;G--;)K(H,X,Z[G].responder)}function ne(H,z){var q=R(H),Z=q[z];if(Z){delete q[z];for(var G=Z.length;G--;)K(H,z,Z[G].responder)}}function K(H,z,q){I(z)?J(H,z,q):te(H,z,q)}function ue(H){return H!==document?H:document.createEvent&&!H.dispatchEvent?document.documentElement:H}function pe(H,z,q,Z){H=ue($(H)),Object.isUndefined(Z)&&(Z=!0),q=q||{};var G=we(H,z,q,Z);return n.extend(G)}function he(H,z,q,Z){var G=document.createEvent("HTMLEvents");return G.initEvent("dataavailable",Z,!0),G.eventName=z,G.memo=q,H.dispatchEvent(G),G}function be(H,z,q,Z){var G=document.createEventObject();return G.eventType=Z?"ondataavailable":"onlosecapture",G.eventName=z,G.memo=q,H.fireEvent(G.eventType,G),G}var we=document.createEvent?he:be;n.Handler=Class.create({initialize:function(H,z,q,Z){this.element=$(H),this.eventName=z,this.selector=q,this.callback=Z,this.handler=this.handleEvent.bind(this)},start:function(){return n.observe(this.element,this.eventName,this.handler),this},stop:function(){return n.stopObserving(this.element,this.eventName,this.handler),this},handleEvent:function(H){var z=n.findElement(H,this.selector);z&&this.callback.call(this.element,H,z)}});function ve(H,z,q,Z){return H=$(H),Object.isFunction(q)&&Object.isUndefined(Z)&&(Z=q,q=null),new n.Handler(H,z,q,Z).start()}Object.extend(n,n.Methods),Object.extend(n,{fire:pe,observe:U,stopObserving:V,on:ve}),Element.addMethods({fire:pe,observe:U,stopObserving:V,on:ve}),Object.extend(document,{fire:pe.methodize(),observe:U.methodize(),stopObserving:V.methodize(),on:ve.methodize(),loaded:!1}),e.Event?Object.extend(window.Event,n):e.Event=n,e.Event.cache={};function Ee(){e.Event.cache=null}window.attachEvent&&window.attachEvent("onunload",Ee),t=null,r=null})(this),(function(e){var t=document.documentElement,r="onmouseenter"in t&&"onmouseleave"in t;function a(s){return!r&&(s==="mouseenter"||s==="mouseleave")}function n(s,d,c){return Event._isCustomEvent(d)?o(s,d,c):a(d)?u(s,d,c):function(h){var C=Event.cache[s],m=C.element;Event.extend(h,m),c.call(m,h)}}function o(s,d,c){return function(h){var C=Event.cache[s],m=C.element;if(Object.isUndefined(h.eventName)||h.eventName!==d)return!1;Event.extend(h,m),c.call(m,h)}}function u(s,d,c){return function(h){var C=Event.cache[s],m=C.element;Event.extend(h,m);for(var T=h.relatedTarget;T&&T!==m;)try{T=T.parentNode}catch{T=m}T!==m&&c.call(m,h)}}e.Event._createResponder=n,t=null})(this),(function(e){var t;function r(){document.loaded||(t&&window.clearTimeout(t),document.loaded=!0,document.fire("dom:loaded"))}function a(){document.readyState==="complete"&&(document.detachEvent("onreadystatechange",a),r())}function n(){try{document.documentElement.doScroll("left")}catch{t=n.defer();return}r()}document.addEventListener?document.addEventListener("DOMContentLoaded",r,!1):(document.attachEvent("onreadystatechange",a),window==top&&(t=n.defer())),Event.observe(window,"load",r)})(this),Element.addMethods(),Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;var Insertion={Before:function(e,t){return Element.insert(e,{before:t})},Top:function(e,t){return Element.insert(e,{top:t})},Bottom:function(e,t){return Element.insert(e,{bottom:t})},After:function(e,t){return Element.insert(e,{after:t})}},$continue=new Error('"throw $continue" is deprecated, use "return" instead'),Position={includeScrollOffsets:!1,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0,this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},within:function(e,t,r){return this.includeScrollOffsets?this.withinIncludingScrolloffsets(e,t,r):(this.xcomp=t,this.ycomp=r,this.offset=Element.cumulativeOffset(e),r>=this.offset[1]&&r<this.offset[1]+e.offsetHeight&&t>=this.offset[0]&&t<this.offset[0]+e.offsetWidth)},withinIncludingScrolloffsets:function(e,t,r){var a=Element.cumulativeScrollOffset(e);return this.xcomp=t+a[0]-this.deltaX,this.ycomp=r+a[1]-this.deltaY,this.offset=Element.cumulativeOffset(e),this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+e.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+e.offsetWidth},overlap:function(e,t){if(!e)return 0;if(e=="vertical")return(this.offset[1]+t.offsetHeight-this.ycomp)/t.offsetHeight;if(e=="horizontal")return(this.offset[0]+t.offsetWidth-this.xcomp)/t.offsetWidth},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(e){return Position.prepare(),Element.absolutize(e)},relativize:function(e){return Position.prepare(),Element.relativize(e)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(e,t,r){return r=r||{},Element.clonePosition(t,e,r)}};document.getElementsByClassName||(document.getElementsByClassName=(function(e){function t(r){return r.blank()?null:"[contains(concat(' ', @class, ' '), ' "+r+" ')]"}return e.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(r,a){a=a.toString().strip();var n=/\s/.test(a)?$w(a).map(t).join(""):t(a);return n?document._getElementsByXPath(".//*"+n,r):[]}:function(r,a){a=a.toString().strip();var n=[],o=/\s/.test(a)?$w(a):null;if(!o&&!a)return n;var u=$(r).getElementsByTagName("*");a=" "+a+" ";for(var s=0,d,c;d=u[s];s++)d.className&&(c=" "+d.className+" ")&&(c.include(a)||o&&o.all(function(h){return!h.toString().blank()&&c.include(" "+h+" ")}))&&n.push(Element.extend(d));return n},function(r,a){return $(a||document.body).getElementsByClassName(r)}})(Element.Methods)),Element.ClassNames=Class.create(),Element.ClassNames.prototype={initialize:function(e){this.element=$(e)},_each:function(e,t){this.element.className.split(/\s+/).select(function(r){return r.length>0})._each(e,t)},set:function(e){this.element.className=e},add:function(e){this.include(e)||this.set($A(this).concat(e).join(" "))},remove:function(e){this.include(e)&&this.set($A(this).without(e).join(" "))},toString:function(){return $A(this).join(" ")}},Object.extend(Element.ClassNames.prototype,Enumerable),(function(){window.Selector=Class.create({initialize:function(e){this.expression=e.strip()},findElements:function(e){return Prototype.Selector.select(this.expression,e)},match:function(e){return Prototype.Selector.match(e,this.expression)},toString:function(){return this.expression},inspect:function(){return"#<Selector: "+this.expression+">"}}),Object.extend(Selector,{matchElements:function(e,t){for(var r=Prototype.Selector.match,a=[],n=0,o=e.length;n<o;n++){var u=e[n];r(u,t)&&a.push(Element.extend(u))}return a},findElement:function(e,t,r){r=r||0;for(var a=0,n,o=0,u=e.length;o<u;o++)if(n=e[o],Prototype.Selector.match(n,t)&&r===a++)return Element.extend(n)},findChildElements:function(e,t){var r=t.toArray().join(", ");return Prototype.Selector.select(r,e||document)}})})();function Dom(){}Dom.getEvent=function(t){if(!t)var t=window.event;return t},Dom.getObject=function(e){return e.currentTarget?e.currentTarget:event.srcElement},Dom.removeObject=function(e){e?.parentNode.removeChild(e)},Dom.x=function(e){return e.pageX?e.pageX:e.x},Dom.y=function(e){return e.pageY?e.pageY:e.y},Dom.left=function(e){return e.offsetLeft==0&&e.offsetTop==0?e.style.left.substr(0,e.style.left.length-2):e.offsetLeft},Dom.top=function(e){return e.offsetLeft==0&&e.offsetTop==0?e.style.top.substr(0,e.style.top.length-2):e.offsetTop},Dom.cornerX=function(e){return e.layerX?Dom.x(e)-e.layerX:Dom.x(e)-e.offsetX},Dom.cornerY=function(e){return e.layerY?Dom.y(e)-e.layerY:Dom.y(e)-e.offsetY},Dom.setClass=function(e,t){e.setAttribute("class",t),e.setAttribute("className",t)},Dom.setStyle=function(e,t){e.setAttribute("style",t),e.style.cssText=t},Dom.setDisplay=function(e,t){var r=document.getElementById(e);r!=null&&(r.style.display=t)},Dom.attachEvent=function(e,t,r){e.attachEvent?e.attachEvent("on"+t,r):e.addEventListener&&e.addEventListener(t,r,!0)},Dom.getElementsByName=function(e,t){var r=document.getElementsByTagName(e),a=new Array;for(i=0,iarr=0;i<r.length;i++)att=r[i].getAttribute("name"),att==t&&(a[iarr]=r[i],iarr++);return a},Dom.is_child_of=function(e,t){if(t!=null)try{for(;t.parentNode;)if((t=t.parentNode)==e)return!0}catch(r){Debugger.log("Unable to ask is_child_of: "+r)}return!1},Dom.divMouseEvent=function(element,event,JavaScript_code){var current_mouse_target=null;event.toElement?current_mouse_target=event.toElement:event.relatedTarget&&(current_mouse_target=event.relatedTarget),!Dom.is_child_of(element,current_mouse_target)&&element!=current_mouse_target&&eval(JavaScript_code)},Ajax=new Object,Ajax.isSending=!1,Ajax.queue=[],Ajax.waitUntilReady=function(){if(!Ajax.isSending&&Ajax.queue.length>0){Ajax.isSending=!0;var e=Ajax.queue[0];e.go(),Ajax.queue.splice(0,1)}Ajax.queue.length>0&&setTimeout("Ajax.waitUntilReady()",100)},Ajax.createHttp=function(){for(var e=0;e<httpFactories.length;e++)try{return httpFactories[e]()}catch{continue}return!1},Ajax.sendRequest=function(e,t,r){var a=new AjaxSender(e,t,r);Ajax.queue.push(a),Ajax.waitUntilReady()},Ajax.defaultAjaxHandle=function(e){var t=e.responseText;alert(t)};var httpFactories=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];function AjaxSender(e,t,r){this.url=e,this.callback=t,this.postData=r,this.go=function(){var a=this.url,n=this.callback,o=this.postData;if(http=Ajax.createHttp(),!!http){var u=o?"POST":"GET";n=n||Ajax.defaultAjaxHandle,http.open(u,a,!0),o&&http.setRequestHeader("Content-type","application/x-www-form-urlencoded"),http.onreadystatechange=function(){http.readyState==4&&(http.status!=200&&http.status!=304||(n(http),Ajax.isSending=!1))},http.readyState!=4&&http.send(o)}}}function roundTo(e,t){var r=Math.pow(10,t);return t>0,Math.round(e/r)*r}String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.ltrim=function(){return this.replace(/^\s+/,"")},String.prototype.rtrim=function(){return this.replace(/\s+$/,"")};function trim(e){return e.replace(/^\s+|\s+$/g,"")}function format(e){for(var t=e,r="";t!=r;){r=t;for(var a=1;a<arguments.length;a++)t=t.replace("{"+(a-1)+"}",arguments[a])}return t}function formatOnce(e){for(var t=e,r=1;r<arguments.length;r++)t=t.replace("{"+(r-1)+"}",arguments[r]);return t}Json=new Object,Json.toObject=function(jsonText){return jsonText==""?null:(eval(format("var data = {0};",jsonText)),data)},Json.toString=function(e,t,r){typeof t>"u"&&(t=null),typeof r>"u"&&(r=!0);var a="";for(var n in e){var o=e[n];if(!((""+o).startsWith("function")||o==null))if(a.length>0&&(a+=","),Json.isObject(o))a+=Json.toString(o,n,!1);else if(Json.isArray(o)){a+=format('"{0}" : [',n);for(var u=0;u<o.length;u++)u>0&&(a+=","),a+=Json.toString(o[u],null,!0);a+="]"}else a+=format('"{0}" : "{1}"',n,e[n])}return t!=null&&(a=format('"{0}" : {{1}}',t,a)),r&&(a=format("{{0}}",a)),a},Json.isObject=function(e){return typeof e=="object"&&!Json.isArray(e)},Json.isArray=function(e){return e.constructor.toString().indexOf("Array")!=-1},Debugger=new Object,Debugger.inspect=function(e){var t="";for(var r in e)(""+e[r]).startsWith("function")||(t+=typeof e+"."+r+"="+e[r]+`
`);alert(t)},Debugger.log=function(e){console.log(e)};/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */eval((function(e,t,r,a,n,o){if(n=function(u){return(u<t?"":n(parseInt(u/t)))+((u=u%t)>35?String.fromCharCode(u+29):u.toString(36))},!"".replace(/^/,String)){for(;r--;)o[n(r)]=a[r]||n(r);a=[function(u){return o[u]}],n=function(){return"\\w+"},r=1}for(;r--;)a[r]&&(e=e.replace(new RegExp("\\b"+n(r)+"\\b","g"),a[r]));return e})(`f(!1o.31){p 31=h(){p l={5S:{"1e-1c":"","73-2E":1,"2a-1P":u,"1I":u,"6T-6S":U,"1F-1P":4,"5F":O,"5x":U,"1q":U,"5v":O,"6i-6p":U,"6J":O},Q:{5D:u,5i:16,5k:16,7P:O,7I:"5L",1b:{4e:"91 1i",3Y:"92 1i",5l:"93 90 6K",6X:"8Z I 8W 1X 8X 6K 8Y",3u:"3u",6h:"?",1u:"31\\n\\n",5Z:"94't 95 7J C: ",7z:"9b 9c't 9a C 2j-2n 99: ",6B:"<!96 2j 97 \\"-//98//8b 8V 1.0 8U//8I\\" \\"2y://7A.7E.7o/8J/86/8b/86-8K.8H\\"><2j 8G=\\"2y://7A.7E.7o/8D/8E\\"><70><8F 2y-8L=\\"8M-8S\\" 5h=\\"2c/2j; 8T=8R-8\\" /><36>8Q 31</36></70><2R 1f=\\"2a-7T:8N,'7h 8O 8P',7h,7L;9d-53:#9e;53:#9D;2a-1P:9E;2c-8i:85;\\"><z 1f=\\"2c-8i:85;5n-4z:9F;\\"><z 1f=\\"2a-7T:9C,9B,9y,8C-7L;2a-1P:9z-9A;\\">31</z><z 1f=\\"2a-1P:.9G;5n-9H:9N;\\"><z>84 2.0.9O (9M 9L 6H)</z><z><a 2q=\\"2y://6a.4a\\" 9I=\\"4P\\" 1f=\\"53:#9J;2c-9K:9x;\\">2y://6a.4a</a></z></z><z>9w I 9k 9l.</z><z>9m 9j-6H 9i 9f.</z></z></2R></2j>"},7j:O},1p:{59:u,3q:u,3o:u,5j:{}},30:{},8a:{9g:/\\/\\*[\\s\\S]*?\\*\\//4M,9h:/\\/\\/.*$/4M,9n:/#.*$/4M,9o:/"(?:\\.|(\\\\\\")|[^\\""\\n])*"/g,9u:/'(?:\\.|(\\\\\\')|[^\\''\\n])*'/g,9v:/"(?:\\.|(\\\\\\")|[^\\""])*"/g,9t:/'(?:\\.|(\\\\\\')|[^\\''])*'/g,3e:/\\w+:\\/\\/[\\w-.\\/?%&=]*/g,9s:{E:/(&1C;|<)\\?=?/g,17:/\\?(&2m;|>)/g},9p:{E:/(&1C;|<)%=?/g,17:/%(&2m;|>)/g},9q:{E:/(&1C;|<)\\s*2n.*?(&2m;|>)/47,17:/(&1C;|<)\\/\\s*2n\\s*(&2m;|>)/47}},1q:{15:h(32){p 38=J.1t("37"),4L=l.1q.77;38.Y="1q";C(p 2N 1X 4L){p 6j=4L[2N],4G=R 6j(32),22=4G.15();32.5E[2N]=4G;f(22==u){1V}f(9r(22)=="9P"){22=l.1q.6C(22,32.1j,2N)}22.Y+="8w "+2N;38.1z(22)}q 38},6C:h(4v,6O,4w){p a=J.1t("a"),5e=a.1f,4F=l.Q,57=4F.5i,5c=4F.5k;a.2q="#"+4w;a.36=4v;a.5P=6O;a.6c=4w;a.1r=4v;f(5z(57)==O){5e.1N=57+"5H"}f(5z(5c)==O){5e.2u=5c+"5H"}a.8q=h(e){8j{l.1q.6f(c,e||1o.6g,c.5P,c.6c)}8m(e){l.B.1u(e.6F)}q O};q a},6f:h(7i,7a,5T,7O,72){p 4Y=l.1p.5j[5T],45;f(4Y==u||(45=4Y.5E[7O])==u){q u}q 45.2h(7i,7a,72)},77:{4e:h(4p){c.15=h(){f(4p.T("5v")!=U){q}q l.Q.1b.4e};c.2h=h(4q,8v,8B){p z=4p.z;4q.71.51(4q);z.Y=z.Y.D("5t","")}},3Y:h(8g){c.15=h(){q l.Q.1b.3Y};c.2h=h(8p,8o,8t){p 33=l.B.3d(8g.5r).D(/</g,"&1C;"),2b=l.B.4y("","4P",8r,8n,"8x=0, 8k=1, 8s=0, 6n=1");33=l.B.2W(33);2b.J.3t("<5L>"+33+"</5L>");2b.J.4N()}},5l:h(4S){p 3x,8y,5M=4S.1j;c.15=h(){p 2A=l.Q;f(2A.5D==u){q u}h 1L(5C){p 5s="";C(p 5A 1X 5C){5s+="<8z 1c='"+5A+"' 1W='"+5C[5A]+"'/>"}q 5s};h 2p(43){p 5p="";C(p 5o 1X 43){5p+=" "+5o+"='"+43[5o]+"'"}q 5p};p 48={1N:2A.5i,2u:2A.5k,1j:5M+"ai",6z:"bu/x-74-79",36:l.Q.1b.5l},46={bl:"bm",bx:"bA",bz:"5P="+5M,bF:"O"},4t=2A.5D,35;f(/aQ/i.1R(61.6b)){35="<8h"+2p({aT:"bd:bf-b9-b5-b4-b7",b8:"2y://ba.be.4a/bb/74/bc/79/b3.b2#84=9,0,0,0"})+2p(48)+">"+1L(46)+1L({aU:4t})+"</8h>"}F{35="<aS"+2p(48)+2p(46)+2p({aR:4t})+"/>"}3x=J.1t("z");3x.1r=35;q 3x};c.2h=h(aV,aW,4R){p 68=4R.b1;6V(68){2J"7C":p 5d=l.B.2W(l.B.3d(4S.5r).D(/&1C;/g,"<").D(/&2m;/g,">").D(/&b0;/g,"&"));f(1o.6e){1o.6e.aZ("2c",5d)}F{q l.B.2W(5d)}2J"aX":l.B.1u(l.Q.1b.6X);2B;2J"aY":l.B.1u(4R.6F);2B}}},bh:h(4I){c.15=h(){q l.Q.1b.3u};c.2h=h(bg,by,bB){p 25=J.1t("bG"),1J=u;f(l.1p.3o!=u){J.2R.51(l.1p.3o)}l.1p.3o=25;25.1f.bC="bE:bD;1N:6m;2u:6m;E:-6l;4z:-6l;";J.2R.1z(25);1J=25.4J.J;6t(1J,1o.J);1J.3t("<z 1e=\\""+4I.z.Y.D("5t","")+" bn\\">"+4I.z.1r+"</z>");1J.4N();25.4J.4A();25.4J.3u();h 6t(6A,6s){p 2S=6s.7M("4K");C(p i=0;i<2S.v;i++){f(2S[i].6r.bk()=="6q"&&/bi\\.12$/.1R(2S[i].2q)){6A.3t("<4K 6z=\\"2c/12\\" 6r=\\"6q\\" 2q=\\""+2S[i].2q+"\\"></4K>")}}}}},bj:h(bo){c.15=h(){q l.Q.1b.6h};c.2h=h(bv,bt){p 2b=l.B.4y("","4P",bq,bs,"6n=0"),1J=2b.J;1J.3t(l.Q.1b.6B);1J.4N();2b.4A()}}}},B:{5m:h(6R){q 6R+3z.aN(3z.aa()*ab).2f()},5u:h(4E,4x){p 3l={},1S;C(1S 1X 4E){3l[1S]=4E[1S]}C(1S 1X 4x){3l[1S]=4x[1S]}q 3l},7w:h(4u){6V(4u){2J"U":q U;2J"O":q O}q 4u},4y:h(3e,6M,4D,4C,2I){p x=(6N.1N-4D)/2,y=(6N.2u-4C)/2;2I+=", E="+x+", 4z="+y+", 1N="+4D+", 2u="+4C;2I=2I.D(/^,/,"");p 4Q=1o.9Q(3e,6M,2I);4Q.4A();q 4Q},78:h(1A,29,23){f(1A.6D){1A["e"+29+23]=23;1A[29+23]=h(){1A["e"+29+23](1o.6g)};1A.6D("a6"+29,1A[29+23])}F{1A.a7(29,23,O)}},1u:h(A){1u(l.Q.1b.1u+A)},4c:h(5a,5Y){p 2k=l.1p.59,3j=u;f(2k==u){2k={};C(p 55 1X l.30){p 3g=l.30[55].ac;f(3g==u){1V}C(p i=0;i<3g.v;i++){2k[3g[i]]=55}}l.1p.59=2k}3j=l.30[2k[5a]];f(3j==u&&5Y!=O){l.B.1u(l.Q.1b.5Z+5a)}q 3j},42:h(A,60){p 2T=A.21("\\n");C(p i=0;i<2T.v;i++){2T[i]=60(2T[i])}q 2T.4h("\\n")},6x:h(){p z=J.1t("z"),3h=J.1t("z"),6d=10,i=1;28(i<=aO){f(i%6d===0){z.1r+=i;i+=(i+"").v}F{z.1r+="&ah;";i++}}3h.Y="5F 2E";3h.1z(z);q 3h},6U:h(A){q A.D(/^[ ]*[\\n]+|[\\n]*[ ]*$/g,"")},7d:h(A){p 3i,4V={},5b=R M("^\\\\[(?<54>(.*?))\\\\]$"),69=R M("(?<1c>[\\\\w-]+)"+"\\\\s*:\\\\s*"+"(?<1W>"+"[\\\\w-%#]+|"+"\\\\[.*?\\\\]|"+"\\".*?\\"|"+"'.*?'"+")\\\\s*;?","g");28((3i=69.N(A))!=u){p 2g=3i.1W.D(/^['"]|['"]$/g,"");f(2g!=u&&5b.1R(2g)){p m=5b.N(2g);2g=m.54.v>0?m.54.21(/\\s*,\\s*/):[]}4V[3i.1c]=2g}q 4V},80:h(A,12){f(A==u||A.v==0||A=="\\n"){q A}A=A.D(/</g,"&1C;");A=A.D(/ {2,}/g,h(m){p 4U="";C(p i=0;i<m.v-1;i++){4U+="&1O;"}q 4U+" "});f(12!=u){A=l.B.42(A,h(2i){f(2i.v==0){q""}p 3k="";2i=2i.D(/^(&1O;| )+/,h(s){3k=s;q""});f(2i.v==0){q 3k}q 3k+"<I 1e=\\""+12+"\\">"+2i+"</I>"})}q A},7f:h(66,67){p 2Z=66.2f();28(2Z.v<67){2Z="0"+2Z}q 2Z},5y:h(){p 3b=J.1t("z"),3f,3a=0,52=J.2R,1j=l.B.5m("5y"),2O="<z 1e=\\"",2Q="</z>",4W="</1T>";3b.1r=2O+"6L\\">"+2O+"26\\">"+2O+"2E\\">"+2O+"5h"+"\\"><1T 1e=\\"7V\\"><1T 1j=\\""+1j+"\\">&1O;"+4W+4W+2Q+2Q+2Q+2Q;52.1z(3b);3f=J.a5(1j);f(/a4/i.1R(61.6b)){p 5Q=1o.9V(3f,u);3a=7l(5Q.9W("1N"))}F{3a=3f.9U}52.51(3b);q 3a},6Q:h(7R,6Y){p 1F="";C(p i=0;i<6Y;i++){1F+=" "}q 7R.D(/\\t/g,1F)},6P:h(2P,41){p 9T=2P.21("\\n"),1F="\\t",5f="";C(p i=0;i<50;i++){5f+="                    "}h 7X(3c,18,7Z){q 3c.1M(0,18)+5f.1M(0,7Z)+3c.1M(18+1,3c.v)};2P=l.B.42(2P,h(20){f(20.1h(1F)==-1){q 20}p 18=0;28((18=20.1h(1F))!=-1){p 7U=41-18%41;20=7X(20,18,7U)}q 20});q 2P},3d:h(A){q(l.Q.7P==U)?A.D(/<br\\s*\\/?>|&1C;br\\s*\\/?&2m;/47,"\\n"):A},3P:h(A){q A.D(/\\s*$/g,"").D(/^\\s*/,"")},2W:h(A){p 1Q=l.B.3d(A).21("\\n"),9X=R 5B(),7S=/^\\s*/,24=9Y;C(p i=0;i<1Q.v&&24>0;i++){p 3V=1Q[i];f(l.B.3P(3V).v==0){1V}p 3S=7S.N(3V);f(3S==u){q A}24=3z.24(3S[0].v,24)}f(24>0){C(p i=0;i<1Q.v;i++){1Q[i]=1Q[i].1M(24)}}q 1Q.4h("\\n")},7B:h(2L,2K){f(2L.H<2K.H){q-1}F{f(2L.H>2K.H){q 1}F{f(2L.v<2K.v){q-1}F{f(2L.v>2K.v){q 1}}}}q 0},2D:h(8d,2G){h 8e(3W,81){q[R l.4i(3W[0],3W.H,81.12)]};p a2=0,3X=u,3y=[],8c=2G.4m?2G.4m:8e;28((3X=2G.3D.N(8d))!=u){3y=3y.2H(8c(3X,2G))}q 3y},6o:h(8f){q 8f.D(l.8a.3e,h(m){q"<a 2q=\\""+m+"\\">"+m+"</a>"})}},1I:h(7c,4l){h 88(4s){p 49=[];C(p i=0;i<4s.v;i++){49.K(4s[i])}q 49};p 3m=4l?[4l]:88(J.7M(l.Q.7I)),7g="1r",2t=u;f(3m.v===0){q}C(p i=0;i<3m.v;i++){p 2F=3m[i],2s=l.B.7d(2F.Y),2Y;2s=l.B.5u(7c,2s);2Y=2s["7J"];f(2Y==u){1V}f(2s["2j-2n"]=="U"){2t=R l.44(2Y)}F{p 4o=l.B.4c(2Y);f(4o){2t=R 4o()}F{1V}}2t.1I(2F[7g],2s);p 2l=2t.z;f(l.Q.7j){2l=J.1t("a0");2l.1W=2t.z.1r;2l.1f.1N="aj";2l.1f.2u="aE"}2F.71.aF(2l,2F)}},aD:h(76){l.B.78(1o,"aC",h(){l.1I(76)})}};l.4i=h(4j,75,12){c.1W=4j;c.H=75;c.v=4j.v;c.12=12};l.4i.Z.2f=h(){q c.1W};l.44=h(4g){p 1H=l.B.4c(4g),4f=R l.30.aA(),aB=u;f(1H==u){q}1H=R 1H();c.4X=4f;f(1H.3K==u){l.B.1u(l.Q.1b.7z+4g);q}4f.4B.K({3D:1H.3K.I,4m:7F});h 39(4d,7G){C(p j=0;j<4d.v;j++){4d[j].H+=7G}};h 7F(14,aH){p 7x=14.I,1E=[],4k=1H.4B,7p=14.H+14.E.v,2X=1H.3K,1n;C(p i=0;i<4k.v;i++){1n=l.B.2D(7x,4k[i]);39(1n,7p);1E=1E.2H(1n)}f(2X.E!=u&&14.E!=u){1n=l.B.2D(14.E,2X.E);39(1n,14.H);1E=1E.2H(1n)}f(2X.17!=u&&14.17!=u){1n=l.B.2D(14.17,2X.17);39(1n,14.H+14[0].aM(14.17));1E=1E.2H(1n)}q 1E}};l.44.Z.1I=h(7u,7t){c.4X.1I(7u,7t);c.z=c.4X.z};l.87=h(){};l.87.Z={T:h(7v,7n){p 5J=c.1L[7v];q l.B.7w(5J==u?7n:5J)},15:h(7y){q J.1t(7y)},7m:h(5G){C(p i=0;i<c.1Y.v;i++){p 2V=c.1Y[i];f(2V===u){1V}f((5G.H>2V.H)&&(5G.H<2V.H+2V.v)){q U}}q O},6v:h(3v,7D){p 2e=[];f(3v!=u){C(p i=0;i<3v.v;i++){2e=2e.2H(l.B.2D(7D,3v[i]))}}2e=2e.aL(l.B.7B);q 2e},6u:h(){C(p i=0;i<c.1Y.v;i++){f(c.7m(c.1Y[i])){c.1Y[i]=u}}},6k:h(2C){p 3w=2C.21(/\\n/g),3s=7l(c.T("73-2E")),7e=(3s+3w.v).2f().v,89=c.T("1I",[]);2C="";C(p i=0;i<3w.v;i++){p 1s=3w[i],2w=/^(&1O;|\\s)+/.N(1s),5w="2E aK"+(i%2==0?1:2),82=l.B.7f(3s+i,7e),83=89.1h((3s+i).2f())!=-1,1D=u;f(2w!=u){1D=2w[0].2f();1s=1s.1M(1D.v);1D=1D.D(/&1O;/g," ");2w=l.1p.3q*1D.v}F{2w=0}1s=l.B.3P(1s);f(1s.v==0){1s="&1O;"}f(83){5w+=" aI"}2C+="<z 1e=\\""+5w+"\\">"+"<I 1e=\\"aJ\\">"+82+".</I>"+"<1T 1e=\\"5h\\">"+(1D!=u?"<I 1e=\\"az\\">"+1D.D(/\\s/g,"&1O;")+"</I>":"")+"<1T 1e=\\"7V\\" 1f=\\"5n-E: "+2w+"5H !aq;\\">"+1s+"</1T>"+"</1T>"+"</z>"}q 2C},6w:h(5N,5K){p 18=0,3n="",3r=l.B.80;C(p i=0;i<5K.v;i++){p 1y=5K[i];f(1y===u||1y.v===0){1V}3n+=3r(5N.1M(18,1y.H-18),"63")+3r(1y.1W,1y.12);18=1y.H+1y.v}3n+=3r(5N.1M(18),"63");q 3n},1I:h(1g,5R){p am=l.Q,3p=l.1p,z,34;c.1L={};c.z=u;c.26=u;c.I=u;c.2d=u;c.5E={};c.1j=l.B.5m("ar");3p.5j[c.1j]=c;f(1g===u){1g=""}f(3p.3q===u){3p.3q=l.B.5y()}c.1L=l.B.5u(l.5S,5R||{});f(c.T("6J")==U){c.1L.1q=c.1L.5x=O}c.z=z=c.15("37");c.26=c.15("37");c.26.Y="26";z.Y="6L";z.1j=c.1j;f(c.T("5v")){z.Y+=" 5t"}f(c.T("5x")==O){z.Y+=" ax"}z.Y+=" "+c.T("1e-1c");z.1f.av=c.T("2a-1P","");c.5r=1g;c.I=l.B.6U(1g).D(/\\r/g," ");34=c.T("1F-1P");c.I=c.T("6T-6S")==U?l.B.6P(c.I,34):l.B.6Q(c.I,34);c.I=l.B.2W(c.I);f(c.T("1q")){c.2d=c.15("37");c.2d.Y="2d";c.2d.1z(l.1q.15(c));z.1z(c.2d)}f(c.T("5F")){z.1z(l.B.6x())}z.1z(c.26);c.1Y=c.6v(c.4B,c.I);c.6u();1g=c.6w(c.I,c.1Y);1g=c.6k(l.B.3P(1g));f(c.T("6i-6p")){1g=l.B.6o(1g)}c.26.1r=1g},au:h(A){A=A.D(/^\\s+|\\s+$/g,"").D(/\\s+/g,"\\\\b|\\\\b");q"\\\\b"+A+"\\\\b"},at:h(2z){c.3K={E:{3D:2z.E,12:"2n"},17:{3D:2z.17,12:"2n"},I:R M("(?<E>"+2z.E.1i+")"+"(?<I>.*?)"+"(?<17>"+2z.17.1i+")","aw")}}};q l}()}f(!5B.1h){5B.Z.1h=h(5V,3J){3J=3z.as(3J||0,0);C(p i=3J;i<c.v;i++){f(c[i]==5V){q i}}q-1}}f(!1o.M){(h(){p 2v={N:V.Z.N,64:5q.Z.64,D:5q.Z.D,21:5q.Z.21},1G={11:/(?:[^\\\\([#\\s.]+|\\\\(?!k<[\\w$]+>|[65]{[^}]+})[\\S\\s]?|\\((?=\\?(?!#|<[\\w$]+>)))+|(\\()(?:\\?(?:(#)[^)]*\\)|<([$\\w]+)>))?|\\\\(?:k<([\\w$]+)>|[65]{([^}]+)})|(\\[\\^?)|([\\S\\s])/g,al:/(?:[^$]+|\\$(?![1-9$&\`']|{[$\\w]+}))+|\\$(?:([1-9]\\d*|[$&\`'])|{([$\\w]+)})/g,3F:/^(?:\\s+|#.*)+/,3R:/^(?:[?*+]|{\\d+(?:,\\d*)?})/,7H:/&&\\[\\^?/g,7q:/]/g},7N=h(5I,7Y,7K){C(p i=7K||0;i<5I.v;i++){f(5I[i]===7Y){q i}}q-1},7k=/()??/.N("")[1]!==3A,3L={};M=h(1d,1U){f(1d 4T V){f(1U!==3A){3G 62("56't 58 an 6G ao 5X V ap ay")}q 1d.3I()}p 1U=1U||"",7s=1U.1h("s")>-1,7r=1U.1h("x")>-1,4b=O,3C=[],13=[],11=1G.11,G,3N,3O,3E,3B;11.L=0;28(G=2v.N.2x(11,1d)){f(G[2]){f(!1G.3R.1R(1d.19(11.L))){13.K("(?:)")}}F{f(G[1]){3C.K(G[3]||u);f(G[3]){4b=U}13.K("(")}F{f(G[4]){3E=7N(3C,G[4]);13.K(3E>-1?"\\\\"+(3E+1)+(5z(1d.5O(11.L))?"":"(?:)"):G[0])}F{f(G[5]){13.K(3L.6Z?3L.6Z.7C(G[5],G[0].5O(1)==="P"):G[0])}F{f(G[6]){f(1d.5O(11.L)==="]"){13.K(G[6]==="["?"(?!)":"[\\\\S\\\\s]");11.L++}F{3N=M.6E("&&"+1d.19(G.H),1G.7H,1G.7q,"",{5W:"\\\\"})[0];13.K(G[6]+3N+"]");11.L+=3N.v+1}}F{f(G[7]){f(7s&&G[7]==="."){13.K("[\\\\S\\\\s]")}F{f(7r&&1G.3F.1R(G[7])){3O=2v.N.2x(1G.3F,1d.19(11.L-1))[0].v;f(!1G.3R.1R(1d.19(11.L-1+3O))){13.K("(?:)")}11.L+=3O-1}F{13.K(G[7])}}}F{13.K(G[0])}}}}}}}3B=V(13.4h(""),2v.D.2x(1U,/[aG]+/g,""));3B.1v={1i:1d,2o:4b?3C:u};q 3B};M.ak=h(1c,o){3L[1c]=o};V.Z.N=h(A){p 1a=2v.N.2x(c,A),1c,i,5g;f(1a){f(7k&&1a.v>1){5g=R V("^"+c.1i+"$(?!\\\\s)",c.3U());2v.D.2x(1a[0],5g,h(){C(i=1;i<7b.v-2;i++){f(7b[i]===3A){1a[i]=3A}}})}f(c.1v&&c.1v.2o){C(i=1;i<1a.v;i++){1c=c.1v.2o[i-1];f(1c){1a[1c]=1a[i]}}}f(c.3H&&c.L>(1a.H+1a[0].v)){c.L--}}q 1a}})()}V.Z.3U=h(){q(c.3H?"g":"")+(c.9Z?"i":"")+(c.6W?"m":"")+(c.3F?"x":"")+(c.a1?"y":"")};V.Z.3I=h(7Q){p 3T=R M(c.1i,(7Q||"")+c.3U());f(c.1v){3T.1v={1i:c.1v.1i,2o:c.1v.2o?c.1v.2o.19(0):u}}q 3T};V.Z.2x=h(a3,A){q c.N(A)};V.Z.9S=h(9R,7W){q c.N(7W[0])};M.3Z=h(4r,4Z){p 40="/"+4r+"/"+(4Z||"");q M.3Z[40]||(M.3Z[40]=R M(4r,4Z))};M.3M=h(A){q A.D(/[-[\\]{}()*+?.\\\\^$|,#\\s]/g,"\\\\$&")};M.6E=h(A,E,W,1k,2M){p 2M=2M||{},2U=2M.5W,X=2M.af,1k=1k||"",4O=1k.1h("g")>-1,6y=1k.1h("i")>-1,5U=1k.1h("m")>-1,4H=1k.1h("y")>-1,1k=1k.D(/y/g,""),E=E 4T V?(E.3H?E:E.3I("g")):R M(E,"g"+1k),W=W 4T V?(W.3H?W:W.3I("g")):R M(W,"g"+1k),1K=[],2r=0,1m=0,1l=0,1x=0,27,1Z,1w,1B,3Q,4n;f(2U){f(2U.v>1){3G ae("56't 58 ag ad 5X 3M 6I")}f(5U){3G 62("56't 58 3M 6I 6G a8 a9 6W aP")}3Q=M.3M(2U);4n=R V("^(?:"+3Q+"[\\\\S\\\\s]|(?:(?!"+E.1i+"|"+W.1i+")[^"+3Q+"])+)+",6y?"i":"")}28(U){E.L=W.L=1l+(2U?(4n.N(A.19(1l))||[""])[0].v:0);1w=E.N(A);1B=W.N(A);f(1w&&1B){f(1w.H<=1B.H){1B=u}F{1w=u}}f(1w||1B){1m=(1w||1B).H;1l=(1w?E:W).L}F{f(!2r){2B}}f(4H&&!2r&&1m>1x){2B}f(1w){f(!2r++){27=1m;1Z=1l}}F{f(1B&&2r){f(!--2r){f(X){f(X[0]&&27>1x){1K.K([X[0],A.19(1x,27),1x,27])}f(X[1]){1K.K([X[1],A.19(27,1Z),27,1Z])}f(X[2]){1K.K([X[2],A.19(1Z,1m),1Z,1m])}f(X[3]){1K.K([X[3],A.19(1m,1l),1m,1l])}}F{1K.K(A.19(1Z,1m))}1x=1l;f(!4O){2B}}}F{E.L=W.L=0;3G b6("bw bp 8l 8u 8A")}}f(1m===1l){1l++}}f(4O&&!4H&&X&&X[0]&&A.v>1x){1K.K([X[0],A.19(1x),1x,A.v])}E.L=W.L=0;q 1K};`,62,725,"||||||||||||this|||if||function||||sh||||var|return||||null|length||||div|str|utils|for|replace|left|else|_109|index|code|document|push|lastIndex|XRegExp|exec|false||config|new||getParam|true|RegExp|_121|vN|className|prototype||part|css|_107|_c3|create||right|pos|slice|_111|strings|name|_101|class|style|_ed|indexOf|source|id|_122|_12d|_12c|_ca|window|vars|toolbar|innerHTML|_e0|createElement|alert|_x|_131|_12e|_ec|appendChild|obj|_132|lt|_e5|_c6|tab|lib|_bd|highlight|doc|_12a|params|substr|width|nbsp|size|_97|test|_4b|span|_102|continue|value|in|matches|_130|_91|split|_8|_57|min|_3c|lines|_12f|while|_56|font|wnd|text|bar|_d7|toString|_6e|execute|_75|html|_5b|_b7|gt|script|captureNames|attributes|href|_12b|_b4|_b1|height|_f8|_e1|call|http|_f4|_28|break|_da|getMatches|line|_b3|_a1|concat|_51|case|m2|m1|_123|_5|_80|_88|_81|body|_40|_62|_124|_d4|unindent|_c9|_b5|_7a|brushes|SyntaxHighlighter|_2|_22|_f2|_32|title|DIV|_3|offsetMatches|_7d|_7b|_8e|fixForBlogger|url|_7c|_5e|_65|_6a|_5c|_76|_4a|_af|_e9|printFrame|_f0|spaceWidth|_ea|_dc|write|print|_d5|_db|_25|_a6|Math|undefined|_10d|_106|regex|_10c|extended|throw|global|addFlags|_f6|htmlScript|_100|escape|cc|len|trim|_133|quantifier|_9d|_116|getNativeFlags|_9c|_a2|_a5|viewSource|cache|key|_89|eachLine|_2c|HtmlScript|_18|_30|gi|_2f|_ad|com|_105|findBrush|_c0|expandSource|_be|_bc|join|Match|_b9|_c7|_ab|func|esc|_b6|_19|_1a|_11b|_ac|swf|_4c|_9|_b|_49|popup|top|focus|regexList|_50|_4f|_48|_e|_7|_129|_38|contentWindow|link|_4|gm|close|_126|_blank|win|_35|_24|instanceof|_73|_6b|_82|xmlBrush|_17|_11c||removeChild|_7e|color|values|_5d|can|_f|supply|discoveredBrushes|_59|_6c|_10|_37|_d|_8c|r2|content|toolbarItemWidth|highlighters|toolbarItemHeight|copyToClipboard|guid|margin|_2e|_2d|String|originalCode|_2a|collapsed|merge|collapse|_e2|gutter|measureSpace|isNaN|_2b|Array|_29|clipboardSwf|toolbarCommands|ruler|_d2|px|_fb|_d0|_e7|pre|_27|_e6|charAt|highlighterId|_83|_ee|defaults|_14|_128|_f5|escapeChar|one|_5a|noBrush|_61|navigator|TypeError|plain|match|pP|_78|_79|_36|_6d|alexgorbatchev|userAgent|commandName|_66|clipboardData|executeCommand|event|help|auto|_6|createDisplayLines|500px|0px|scrollbars|processUrls|links|stylesheet|rel|_3f|copyStyles|removeNestedMatches|findMatches|processMatches|createRuler|_127|type|_3e|aboutDialog|createButton|attachEvent|matchRecursive|message|when|2009|character|light|clipboard|syntaxhighlighter|_4e|screen|_a|processSmartTabs|processTabs|_47|tabs|smart|trimFirstAndLastLines|switch|multiline|copyToClipboardConfirmation|_85|unicode|head|parentNode|_16|first|shockwave|_ba|_b8|items|addEvent|flash|_13|arguments|_aa|parseParams|_dd|padNumber|_b0|Times|_12|debug|_ff|parseInt|isMatchNested|_cf|org|_c8|classRight|_104|_103|_cd|_cc|_ce|toBoolean|_c5|_d1|brushNotHtmlScript|www|matchesSortCallback|get|_d6|w3|process|_c1|classLeft|tagName|brush|_fd|serif|getElementsByTagName|_fa|_15|bloggerMode|_115|_84|_99|family|_93|block|args|insertSpaces|_fc|_90|decorate|_a3|_e3|_e4|version|center|xhtml1|Highlighter|toArray|_de|regexLib|DTD|_a7|_a0|defaultAdd|_a8|_1e|object|align|try|resizable|contains|catch|400|_20|_1f|onclick|750|menubar|_21|unbalanced|_1b|item|location|_26|param|delimiters|_1c|sans|1999|xhtml|meta|xmlns|dtd|EN|TR|transitional|equiv|Content|Georgia|New|Roman|About|utf|Type|charset|Transitional|XHTML|is|your|now|The|to|expand|view|copy|Can|find|DOCTYPE|PUBLIC|W3C|option|configured|Brush|wasn|background|fff|Gorbatchev|multiLineCComments|singleLineCComments|Alex|2004|syntax|highlighter|Copyright|singleLinePerlComments|doubleQuotedString|aspScriptTags|scriptScriptTags|typeof|phpScriptTags|multiLineSingleQuotedString|singleQuotedString|multiLineDoubleQuotedString|JavaScript|none|Helvetica|xx|large|Arial|Geneva|000|1em|3em|75em|bottom|target|0099FF|decoration|01|March|4em|296|string|open|_119|apply|_8a|offsetWidth|getComputedStyle|getPropertyValue|_98|1000|ignoreCase|textarea|sticky|_a4|_117|opera|getElementById|on|addEventListener|using|the|random|1000000|aliases|than|SyntaxError|valueNames|more|middot|_clipboard|70em|addPlugin|replaceVar|_ef|flags|constructing|from|important|highlighter_|max|forHtmlScript|getKeywords|fontSize|sgi|nogutter|another|spaces|Xml|_bf|load|all|30em|replaceChild|sx|_c4|highlighted|number|alt|sort|lastIndexOf|round|150|flag|msie|src|embed|classid|movie|_33|_34|ok|error|setData|amp|command|cab|swflash|96b8|11cf|Error|444553540000|codebase|ae6d|download|pub|cabs|clsid|macromedia|d27cdb6e|_39|printSource|shCore|about|toLowerCase|allowScriptAccess|always|printing|_42|data|500||250|_44|application|_43|subject|wmode|_3a|flashVars|transparent|_3b|cssText|absolute|position|menu|IFRAME".split("|"),0,{}));/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */SyntaxHighlighter.brushes.Alloy=function(){var e="abstract assert assert fact in all else extends module sig String Int one some lone set no ";this.regexList=[{regex:SyntaxHighlighter.regexLib.singleLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.multiLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.doubleQuotedString,css:"string"},{regex:SyntaxHighlighter.regexLib.singleQuotedString,css:"string"},{regex:/\b([\d]+(\.[\d]+)?|0x[a-f0-9]+)\b/gi,css:"value"},{regex:/(?!\@interface\b)\@[\$\w]+\b/g,css:"color1"},{regex:/\@interface\b/g,css:"color2"},{regex:new RegExp(this.getKeywords(e),"gm"),css:"keyword"}],this.forHtmlScript(SyntaxHighlighter.regexLib.aspScriptTags)},SyntaxHighlighter.brushes.Alloy.prototype=new SyntaxHighlighter.Highlighter,SyntaxHighlighter.brushes.Alloy.aliases=["Alloy","alloy","als"];/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */SyntaxHighlighter.brushes.Cpp=function(){var e="ATOM BOOL BOOLEAN BYTE CHAR COLORREF DWORD DWORDLONG DWORD_PTR DWORD32 DWORD64 FLOAT HACCEL HALF_PTR HANDLE HBITMAP HBRUSH HCOLORSPACE HCONV HCONVLIST HCURSOR HDC HDDEDATA HDESK HDROP HDWP HENHMETAFILE HFILE HFONT HGDIOBJ HGLOBAL HHOOK HICON HINSTANCE HKEY HKL HLOCAL HMENU HMETAFILE HMODULE HMONITOR HPALETTE HPEN HRESULT HRGN HRSRC HSZ HWINSTA HWND INT INT_PTR INT32 INT64 LANGID LCID LCTYPE LGRPID LONG LONGLONG LONG_PTR LONG32 LONG64 LPARAM LPBOOL LPBYTE LPCOLORREF LPCSTR LPCTSTR LPCVOID LPCWSTR LPDWORD LPHANDLE LPINT LPLONG LPSTR LPTSTR LPVOID LPWORD LPWSTR LRESULT PBOOL PBOOLEAN PBYTE PCHAR PCSTR PCTSTR PCWSTR PDWORDLONG PDWORD_PTR PDWORD32 PDWORD64 PFLOAT PHALF_PTR PHANDLE PHKEY PINT PINT_PTR PINT32 PINT64 PLCID PLONG PLONGLONG PLONG_PTR PLONG32 PLONG64 POINTER_32 POINTER_64 PSHORT PSIZE_T PSSIZE_T PSTR PTBYTE PTCHAR PTSTR PUCHAR PUHALF_PTR PUINT PUINT_PTR PUINT32 PUINT64 PULONG PULONGLONG PULONG_PTR PULONG32 PULONG64 PUSHORT PVOID PWCHAR PWORD PWSTR SC_HANDLE SC_LOCK SERVICE_STATUS_HANDLE SHORT SIZE_T SSIZE_T TBYTE TCHAR UCHAR UHALF_PTR UINT UINT_PTR UINT32 UINT64 ULONG ULONGLONG ULONG_PTR ULONG32 ULONG64 USHORT USN VOID WCHAR WORD WPARAM WPARAM WPARAM char bool short int __int32 __int64 __int8 __int16 long float double __wchar_t clock_t _complex _dev_t _diskfree_t div_t ldiv_t _exception _EXCEPTION_POINTERS FILE _finddata_t _finddatai64_t _wfinddata_t _wfinddatai64_t __finddata64_t __wfinddata64_t _FPIEEE_RECORD fpos_t _HEAPINFO _HFILE lconv intptr_t jmp_buf mbstate_t _off_t _onexit_t _PNH ptrdiff_t _purecall_handler sig_atomic_t size_t _stat __stat64 _stati64 terminate_function time_t __time64_t _timeb __timeb64 tm uintptr_t _utimbuf va_list wchar_t wctrans_t wctype_t wint_t signed",t="break case catch class const __finally __exception __try const_cast continue private public protected __declspec default delete deprecated dllexport dllimport do dynamic_cast else enum explicit extern if for friend goto inline mutable naked namespace new noinline noreturn nothrow register reinterpret_cast return selectany sizeof static static_cast struct switch template this thread throw true false try typedef typeid typename union using uuid virtual void volatile whcar_t while",r="assert isalnum isalpha iscntrl isdigit isgraph islower isprintispunct isspace isupper isxdigit tolower toupper errno localeconv setlocale acos asin atan atan2 ceil cos cosh exp fabs floor fmod frexp ldexp log log10 modf pow sin sinh sqrt tan tanh jmp_buf longjmp setjmp raise signal sig_atomic_t va_arg va_end va_start clearerr fclose feof ferror fflush fgetc fgetpos fgets fopen fprintf fputc fputs fread freopen fscanf fseek fsetpos ftell fwrite getc getchar gets perror printf putc putchar puts remove rename rewind scanf setbuf setvbuf sprintf sscanf tmpfile tmpnam ungetc vfprintf vprintf vsprintf abort abs atexit atof atoi atol bsearch calloc div exit free getenv labs ldiv malloc mblen mbstowcs mbtowc qsort rand realloc srand strtod strtol strtoul system wcstombs wctomb memchr memcmp memcpy memmove memset strcat strchr strcmp strcoll strcpy strcspn strerror strlen strncat strncmp strncpy strpbrk strrchr strspn strstr strtok strxfrm asctime clock ctime difftime gmtime localtime mktime strftime time";this.regexList=[{regex:SyntaxHighlighter.regexLib.singleLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.multiLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.doubleQuotedString,css:"string"},{regex:SyntaxHighlighter.regexLib.singleQuotedString,css:"string"},{regex:/^ *#.*/gm,css:"preprocessor"},{regex:new RegExp(this.getKeywords(e),"gm"),css:"color1 bold"},{regex:new RegExp(this.getKeywords(r),"gm"),css:"functions bold"},{regex:new RegExp(this.getKeywords(t),"gm"),css:"keyword bold"}]},SyntaxHighlighter.brushes.Cpp.prototype=new SyntaxHighlighter.Highlighter,SyntaxHighlighter.brushes.Cpp.aliases=["cpp","c"];/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */SyntaxHighlighter.brushes.Java=function(){var e="abstract assert boolean break byte case catch char class const continue default do double else enum extends false final finally float for goto if implements import instanceof int interface long native new null package private protected public return short static strictfp super switch synchronized this throw throws true transient try void volatile while";this.regexList=[{regex:SyntaxHighlighter.regexLib.singleLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.multiLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.doubleQuotedString,css:"string"},{regex:SyntaxHighlighter.regexLib.singleQuotedString,css:"string"},{regex:/\b([\d]+(\.[\d]+)?|0x[a-f0-9]+)\b/gi,css:"value"},{regex:/(?!\@interface\b)\@[\$\w]+\b/g,css:"color1"},{regex:/\@interface\b/g,css:"color2"},{regex:new RegExp(this.getKeywords(e),"gm"),css:"keyword"}],this.forHtmlScript(SyntaxHighlighter.regexLib.aspScriptTags)},SyntaxHighlighter.brushes.Java.prototype=new SyntaxHighlighter.Highlighter,SyntaxHighlighter.brushes.Java.aliases=["java"];/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */SyntaxHighlighter.brushes.NuSMV=function(){var e="MODULE IVAR VAR ASSIGN DEFINE TRANS INVARSPEC SPEC CTLSPEC LTLSPEC next init esac case TRUE FALSE main EF AG AX AF EX EG U A E ";this.regexList=[{regex:SyntaxHighlighter.regexLib.singleLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.multiLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.doubleQuotedString,css:"string"},{regex:SyntaxHighlighter.regexLib.singleQuotedString,css:"string"},{regex:/\b([\d]+(\.[\d]+)?|0x[a-f0-9]+)\b/gi,css:"value"},{regex:/(?!\@interface\b)\@[\$\w]+\b/g,css:"color1"},{regex:/\@interface\b/g,css:"color2"},{regex:new RegExp(this.getKeywords(e),"gm"),css:"keyword"}],this.forHtmlScript(SyntaxHighlighter.regexLib.aspScriptTags)},SyntaxHighlighter.brushes.NuSMV.prototype=new SyntaxHighlighter.Highlighter,SyntaxHighlighter.brushes.NuSMV.aliases=["NuSMV","nusmv","smv"];/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */SyntaxHighlighter.brushes.Php=function(){var e="abs acos acosh addcslashes addslashes array_change_key_case array_chunk array_combine array_count_values array_diff array_diff_assoc array_diff_key array_diff_uassoc array_diff_ukey array_fill array_filter array_flip array_intersect array_intersect_assoc array_intersect_key array_intersect_uassoc array_intersect_ukey array_key_exists array_keys array_map array_merge array_merge_recursive array_multisort array_pad array_pop array_product array_push array_rand array_reduce array_reverse array_search array_shift array_slice array_splice array_sum array_udiff array_udiff_assoc array_udiff_uassoc array_uintersect array_uintersect_assoc array_uintersect_uassoc array_unique array_unshift array_values array_walk array_walk_recursive atan atan2 atanh base64_decode base64_encode base_convert basename bcadd bccomp bcdiv bcmod bcmul bindec bindtextdomain bzclose bzcompress bzdecompress bzerrno bzerror bzerrstr bzflush bzopen bzread bzwrite ceil chdir checkdate checkdnsrr chgrp chmod chop chown chr chroot chunk_split class_exists closedir closelog copy cos cosh count count_chars date decbin dechex decoct deg2rad delete ebcdic2ascii echo empty end ereg ereg_replace eregi eregi_replace error_log error_reporting escapeshellarg escapeshellcmd eval exec exit exp explode extension_loaded feof fflush fgetc fgetcsv fgets fgetss file_exists file_get_contents file_put_contents fileatime filectime filegroup fileinode filemtime fileowner fileperms filesize filetype floatval flock floor flush fmod fnmatch fopen fpassthru fprintf fputcsv fputs fread fscanf fseek fsockopen fstat ftell ftok getallheaders getcwd getdate getenv gethostbyaddr gethostbyname gethostbynamel getimagesize getlastmod getmxrr getmygid getmyinode getmypid getmyuid getopt getprotobyname getprotobynumber getrandmax getrusage getservbyname getservbyport gettext gettimeofday gettype glob gmdate gmmktime ini_alter ini_get ini_get_all ini_restore ini_set interface_exists intval ip2long is_a is_array is_bool is_callable is_dir is_double is_executable is_file is_finite is_float is_infinite is_int is_integer is_link is_long is_nan is_null is_numeric is_object is_readable is_real is_resource is_scalar is_soap_fault is_string is_subclass_of is_uploaded_file is_writable is_writeable mkdir mktime nl2br parse_ini_file parse_str parse_url passthru pathinfo readlink realpath rewind rewinddir rmdir round str_ireplace str_pad str_repeat str_replace str_rot13 str_shuffle str_split str_word_count strcasecmp strchr strcmp strcoll strcspn strftime strip_tags stripcslashes stripos stripslashes stristr strlen strnatcasecmp strnatcmp strncasecmp strncmp strpbrk strpos strptime strrchr strrev strripos strrpos strspn strstr strtok strtolower strtotime strtoupper strtr strval substr substr_compare",t="and or xor array as break case cfunction class const continue declare default die do else elseif enddeclare endfor endforeach endif endswitch endwhile extends for foreach function include include_once global if new old_function return static switch use require require_once var while abstract interface public implements extends private protected throw",r="__FILE__ __LINE__ __METHOD__ __FUNCTION__ __CLASS__";this.regexList=[{regex:SyntaxHighlighter.regexLib.singleLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.multiLineCComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.doubleQuotedString,css:"string"},{regex:SyntaxHighlighter.regexLib.singleQuotedString,css:"string"},{regex:/\$\w+/g,css:"variable"},{regex:new RegExp(this.getKeywords(e),"gmi"),css:"functions"},{regex:new RegExp(this.getKeywords(r),"gmi"),css:"constants"},{regex:new RegExp(this.getKeywords(t),"gm"),css:"keyword"}],this.forHtmlScript(SyntaxHighlighter.regexLib.phpScriptTags)},SyntaxHighlighter.brushes.Php.prototype=new SyntaxHighlighter.Highlighter,SyntaxHighlighter.brushes.Php.aliases=["php"];/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */SyntaxHighlighter.brushes.Python=function(){var e="and assert break class continue def del elif else except exec finally for from global if import in is lambda not or pass raise return try yield while",t="__import__ abs all any apply basestring bin bool buffer callable chr classmethod cmp coerce compile complex delattr dict dir divmod enumerate eval execfile file filter float format frozenset getattr globals hasattr hash help hex id input int intern isinstance issubclass iter len list locals long map max min next object oct open ord pow print property range raw_input reduce reload repr reversed round set setattr slice sorted staticmethod str sum super tuple type type unichr unicode vars xrange zip",r="None True False self cls class_";this.regexList=[{regex:SyntaxHighlighter.regexLib.singleLinePerlComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.singleLineCComments,css:"comments"},{regex:/^\s*@\w+/gm,css:"decorator"},{regex:/(['\"]{3})([^\1])*?\1/gm,css:"comments"},{regex:/"(?!")(?:\.|\\\"|[^\""\n])*"/gm,css:"string"},{regex:/'(?!')(?:\.|(\\\')|[^\''\n])*'/gm,css:"string"},{regex:/\+|\-|\*|\/|\%|=|==/gm,css:"keyword"},{regex:/\b\d+\.?\w*/g,css:"value"},{regex:new RegExp(this.getKeywords(t),"gm"),css:"functions"},{regex:new RegExp(this.getKeywords(e),"gm"),css:"keyword"},{regex:new RegExp(this.getKeywords(r),"gm"),css:"color1"}],this.forHtmlScript(SyntaxHighlighter.regexLib.aspScriptTags)},SyntaxHighlighter.brushes.Python.prototype=new SyntaxHighlighter.Highlighter,SyntaxHighlighter.brushes.Python.aliases=["py","python"];/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */SyntaxHighlighter.brushes.Ruby=function(){var e="alias and BEGIN begin break case class def define_method defined do each else elsif END end ensure false for if in module new next nil not or raise redo rescue retry return self super then throw true undef unless until when while yield",t="Array Bignum Binding Class Continuation Dir Exception FalseClass File::Stat File Fixnum Fload Hash Integer IO MatchData Method Module NilClass Numeric Object Proc Range Regexp String Struct::TMS Symbol ThreadGroup Thread Time TrueClass";this.regexList=[{regex:SyntaxHighlighter.regexLib.singleLinePerlComments,css:"comments"},{regex:SyntaxHighlighter.regexLib.doubleQuotedString,css:"string"},{regex:SyntaxHighlighter.regexLib.singleQuotedString,css:"string"},{regex:/\b[A-Z0-9_]+\b/g,css:"constants"},{regex:/:[a-z][A-Za-z0-9_]*/g,css:"color2"},{regex:/(\$|@@|@)\w+/g,css:"variable bold"},{regex:new RegExp(this.getKeywords(e),"gm"),css:"keyword"},{regex:new RegExp(this.getKeywords(t),"gm"),css:"color1"}],this.forHtmlScript(SyntaxHighlighter.regexLib.aspScriptTags)},SyntaxHighlighter.brushes.Ruby.prototype=new SyntaxHighlighter.Highlighter,SyntaxHighlighter.brushes.Ruby.aliases=["ruby","rails","ror"];/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */SyntaxHighlighter.brushes.Sql=function(){var e="abs avg case cast coalesce convert count current_timestamp current_user day isnull left lower month nullif replace right session_user space substring sum system_user upper user year",t="absolute action add after alter as asc at authorization begin bigint binary bit by cascade char character check checkpoint close collate column commit committed connect connection constraint contains continue create cube current current_date current_time cursor database date deallocate dec decimal declare default delete desc distinct double drop dynamic else end end-exec escape except exec execute false fetch first float for force foreign forward free from full function global goto grant group grouping having hour ignore index inner insensitive insert instead int integer intersect into is isolation key last level load local max min minute modify move name national nchar next no numeric of off on only open option order out output partial password precision prepare primary prior privileges procedure public read real references relative repeatable restrict return returns revoke rollback rollup rows rule schema scroll second section select sequence serializable set size smallint static statistics table temp temporary then time timestamp to top transaction translation trigger true truncate uncommitted union unique update values varchar varying view when where with work",r="all and any between cross in join like not null or outer some";this.regexList=[{regex:/--(.*)$/gm,css:"comments"},{regex:SyntaxHighlighter.regexLib.multiLineDoubleQuotedString,css:"string"},{regex:SyntaxHighlighter.regexLib.multiLineSingleQuotedString,css:"string"},{regex:new RegExp(this.getKeywords(e),"gmi"),css:"color2"},{regex:new RegExp(this.getKeywords(r),"gmi"),css:"color1"},{regex:new RegExp(this.getKeywords(t),"gmi"),css:"keyword"}]},SyntaxHighlighter.brushes.Sql.prototype=new SyntaxHighlighter.Highlighter,SyntaxHighlighter.brushes.Sql.aliases=["sql"];/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/wiki/SyntaxHighlighter:Donate
 *
 * @version
 * 2.0.296 (March 01 2009)
 * 
 * @copyright
 * Copyright (C) 2004-2009 Alex Gorbatchev.
 *
 * @license
 * This file is part of SyntaxHighlighter.
 * 
 * SyntaxHighlighter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * SyntaxHighlighter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SyntaxHighlighter.  If not, see <http://www.gnu.org/licenses/>.
 */SyntaxHighlighter.brushes.Xml=function(){function e(t,r){var a=SyntaxHighlighter.Match,n=t[0],o=new XRegExp("(&lt;|<)[\\s\\/\\?]*(?<name>[:\\w-\\.]+)","xg").exec(n),u=[];if(t.attributes!=null)for(var s,d=new XRegExp(`(?<name> [\\w:\\-\\.]+)\\s*=\\s*(?<value> ".*?"|'.*?'|\\w+)`,"xg");(s=d.exec(n))!=null;)u.push(new a(s.name,t.index+s.index,"color1")),u.push(new a(s.value,t.index+s.index+s[0].indexOf(s.value),"string"));return o!=null&&u.push(new a(o.name,t.index+o[0].indexOf(o.name),"keyword")),u}this.regexList=[{regex:new XRegExp("(\\&lt;|<)\\!\\[[\\w\\s]*?\\[(.|\\s)*?\\]\\](\\&gt;|>)","gm"),css:"color2"},{regex:new XRegExp("(\\&lt;|<)!--\\s*.*?\\s*--(\\&gt;|>)","gm"),css:"comments"},{regex:new XRegExp("(&lt;|<)[\\s\\/\\?]*(\\w+)(?<attributes>.*?)[\\s\\/\\?]*(&gt;|>)","sg"),func:e}]},SyntaxHighlighter.brushes.Xml.prototype=new SyntaxHighlighter.Highlighter,SyntaxHighlighter.brushes.Xml.aliases=["xml","xhtml","xslt","html","xhtml"];var inlineeditor_isIE=navigator.userAgent.toLowerCase().search("msie")!=-1&&navigator.userAgent.toLowerCase().search("opera")==-1,InlineEditor={alreadyInited:!1,addClass:function(e,t){return InlineEditor.jscss("add",e,t)},removeClass:function(e,t){return InlineEditor.jscss("remove",e,t)},checkClass:function(e,t){return InlineEditor.jscss("check",e,t)},swapClass:function(e,t,r){return InlineEditor.jscss("swap",e,t,r)},customEditor:function(e){var t=jQuery("<input/>");return t.attr("id",e.attr("id")+"_editor"),t.val(e.html()=="-- Add More --"?"":e.html()),t.width(e.parent().width()-30),t.height(e.offset().height),t},handleOnClick:function(t){var t=InlineEditor.fixEvent(t),r=jQuery(InlineEditor.findEditableTarget(t.target));if(!(r.hasClass("uneditable")||r.hasClass("editing"))){var a=r.html(),n=null;InlineEditor.elementValue&&(n=InlineEditor.elementValue(r)),n||(n=r.html());var o=null;return InlineEditor.customEditor&&(o=InlineEditor.customEditor(r)),o.focusout(function(u){InlineEditor.handleInputBlur(o,n,a)}),o.keypress(function(u){var s=13;if(u.which==s&&(o.blur(),n=="-- Add More --"&&o.val()!="")){var d=r.attr("id");jQuery("#"+d).click()}}),r.addClass("editing"),r.html(""),r.append(o),o.focusin(),o.select(),!1}},handleInputBlur:function(e,t,r){var a=e.parent(),n=null;if(InlineEditor.editorValue&&(n=InlineEditor.editorValue(e)),n||(n=e.val()==""?t:e.val()),t==n){a.html(r),a.removeClass("editing");return}a.html(n),InlineEditor.elementChanged&&InlineEditor.elementChanged(a,t,n)},jscss:function(e,t,r,a){switch(e){case"swap":t.className=InlineEditor.jscss("check",t,r)?t.className.replace(r,a):t.className.replace(a,r);break;case"add":InlineEditor.jscss("check",t,r)||(t.className+=t.className?" "+r:r);break;case"remove":var n=t.className.match(" "+r)?" "+r:r;t.className=t.className.replace(n,"");break;case"check":return new RegExp("\\b"+r+"\\b").test(t.className)}},fixEvent:function(e){var t=e||window.event;return t.target&&t.target.nodeType==3&&(t.target=t.target.parentNode),inlineeditor_isIE&&t.srcElement&&(t.target=t.srcElement),t},findEditableTarget:function(e){return e.nodeType==1&&e.tagName=="TD"||InlineEditor.checkClass(e,"editable")?e:e.parentNode?InlineEditor.findEditableTarget(e.parentNode):null},addEvent:function(e,t,r,a){if(e.addEventListener)return e.addEventListener(t,r,a),!0;if(e.attachEvent)return e.attachEvent("on"+t,r)},removeEvent:function(e,t,r,a){if(e.removeEventListener)return e.removeEventListener(t,r,a),!0;if(e.detachEvent)return e.detachEvent("on"+t,r)}};DropboxChooser={},DropboxChooser.init=function(){jQuery(".dropbox-button-chooser").each(function(){this.setAttribute("data-link-type","direct"),this.setAttribute("data-extensions",".ump");var e=this;this.addEventListener("DbxChooserSuccess",function(t){DropboxChooser.load(t.files[0].link)},!1)})},DropboxChooser.load=function(e){UmpleSystem.merge(null),Page.showCanvasLoading(!0),Page.showModelLoading(!0),Page.showLayoutLoading(!0),jQuery.get(e).done(function(t){Action.freshLoad=!0,Page.setUmpleCode(t),Page.hideLoading(),TabControl.getCurrentHistory().save(t,"dropboxLoad"),Action.updateUmpleDiagram(),Action.setCaretPosition("0"),Action.updateLineNumberDisplay()}).fail(function(){Page.setFeedbackMessage("Cannot load from the chosen Dropbox file."),Page.hideLoading()})};var DropboxInitializer={};DropboxInitializer.initializeDropbox=function(){jQuery(".dropbox-add-saver").addClass("dropbox-option").append('<li id="ttDropboxSaver"><span class="dropbox-button-saver"></span></li>'),jQuery(".dropbox-add-chooser").addClass("dropbox-option").append('<li id="ttDropboxChooser"><input type="dropbox-chooser" class="dropbox-button-chooser"/></li>'),DropboxChooser.init(),DropboxSaver.init()},DropboxMaster={resetTimeout:2e3},DropboxSaver={},DropboxSaver.init=function(){jQuery(".dropbox-button-saver").each(function(){DropboxSaver.createSaverIn(this)})},DropboxSaver.createSaverIn=function(e){var t=DropboxSaver.getAbsoluteLink(Page.getFilename()),r=Dropbox.createSaveButton({files:[{url:t}],success:function(){window.setTimeout(function(){jQuery(e).children(".dropbox-dropin-btn").remove(),DropboxSaver.createSaverIn(e)},DropboxMaster.resetTimeout)},error:function(a){console.log(a),Page.setFeedbackMessage("Cannot save to the chosen Dropbox location.")}});jQuery(e).append(r)},DropboxSaver.getAbsoluteLink=function(e){var t=document.createElement("a");return t.href=e.replace(/^\.\.\//,""),t.href};var Action=new Object;Action.waiting_time=1500,Action.oldTimeout=null,Action.elementClicked=!1,Action.canCreateByDrag=!0,Action.manualSync=!1,Action.diagramInSync=!0,Action.freshLoad=!1,Action.gentime=new Date().getTime(),Action.savedCanonical="",Action.gdprHidden=!1,Action.update="";const clientDebuggerFlag=!1;let justUpdatetoSaveLater=!1;Action.setjustUpdatetoSaveLater=function(e){justUpdatetoSaveLater=e};let justUpdatetoSaveLaterForTextCallback=!1;Action.setjustUpdatetoSaveLaterForTextCallback=function(e){justUpdatetoSaveLaterForTextCallback=e},Action.clicked=function(e){Page.clickCount+=1;var t=e.currentTarget,r=t.id.substring(6);if(r=="PhpCode")Action.generateCode("php","Php");else if(r=="RubyCode")Action.generateCode("ruby","Ruby");else if(r=="JavaCode")Action.generateCode("java","Java");else if(r=="RTCppCode")Action.generateCode("rtcpp","RTCpp");else if(r=="AlloyCode")Action.generateCode("alloy","Alloy");else if(r=="NuSMVCode")Action.generateCode("nusmv","NuSMV");else if(r=="CppCode")Action.generateCode("cpp","Cpp");else if(r=="SQLCode")Action.generateCode("sql","Sql");else if(r=="JavaAPIDoc")Action.generateCode("javadoc","javadoc");else if(r=="StateDiagram")Action.generateCode("stateDiagram","stateDiagram");else if(r=="StructureDiagram")Action.generateCode("structureDiagram","structureDiagram");else if(r=="FeatureDiagram")Action.generateCode("featureDiagram","featureDiagram");else if(r=="classDiagram")Action.generateCode("classDiagram","classDiagram");else if(r=="instanceDiagram")Action.generateCode("instanceDiagram","instanceDiagram");else if(r=="entityRelationshipDiagram")Action.generateCode("entityRelationshipDiagram","entityRelationshipDiagram");else if(r=="EcoreCode")Action.generateCode("xml","Ecore");else if(r=="GenerateCode"){var a=$("inputGenerateCode").value.split(":");Action.generateCode(a[0],a[1])}else if(r=="ExecuteCode"){var n=$("inputGenerateCode").value.split(":");Action.executeCode(n[0],n[1])}else if(r=="SimulateCode")Action.simulateCode();else if(r=="StartOver")Action.startOver();else if(r=="ShowRefreshUmpleOnlineCompletely")Action.showRefreshUmpleOnlineCompletely();else if(r=="LoadBlankModel")Action.loadBlankModel();else if(r=="PngImage")Action.pngImage();else if(r=="YumlImage")Action.yumlImage();else if(r=="Jsf")Action.uigu();else if(r=="CopyClip")Action.copyClipboardCode();else if(r=="Copy")Action.showCodeInSeparateWindow();else if(r=="CopyCommandLine")Action.copyCommandLineCode();else if(r=="CopyEncodedURL")Action.showEncodedURLCodeInSeparateWindow();else if(r=="CopyLocalBrowser")typeof Storage<"u"?(localStorage.setItem("umpleLocalStorage1",Page.getUmpleCode()),Page.setFeedbackMessage("Model saved. Use Load From Browser later to restore.")):Page.setFeedbackMessage("Unable to copy the model to browser storage. An error occurred.");else if(r=="LoadLocalBrowser"){if(typeof Storage<"u"){var o=localStorage.getItem("umpleLocalStorage1");o!=null&&Page.setUmpleCode(o)}}else if(r=="CreateTask")jQuery("#taskArea").css("display","block"),jQuery("#labelTaskName").css("display","block"),jQuery("#taskNameCell").css("display","block"),jQuery("#instructions").css("display","block"),jQuery("#isExperimentCell").css("display","block"),Layout.zoomResize();else if(r=="LoadTask")jQuery("#loadTaskNameArea").css("display","block");else if(r=="LoadThisTask")Action.loadTask(Page.getModel().split("-")[1],!1);else if(r=="RequestLoadTaskURL"){var u=Page.getModel().split("-")[1];Action.copyToClp(window.location.hostname+"/bookmark.php?loadTaskWithURL=1&taskname="+u+"&model="+u)}else if(r=="RequestAllZip"){if(document.getElementById("downloadTaskDirLink")===null){var s=document.createElement("a");s.setAttribute("href","scripts/tab_control.php?downloadTaskUserDir=1&taskid="+Page.getModel()),s.setAttribute("id","downloadTaskDirLink");var d=document.createTextNode("Download ZIP File From Here");s.appendChild(d);var c=document.createElement("LI");c.appendChild(s),document.getElementById("taskSubmenu").appendChild(c)}else document.getElementById("downloadTaskDirLink").setAttribute("href","scripts/tab_control.php?downloadTaskUserDir=1&taskid="+Page.getModel());setTimeout(function(){document.getElementById("downloadTaskDirLink").remove()},3e4)}else if(r=="DownloadFiles"){if(TabControl.useActiveTabTo(TabControl.saveTab)(Page.getUmpleCode()),document.getElementById("downloadLink")===null){var s=document.createElement("a");s.setAttribute("href","scripts/tab_control.php?download=1&&model="+Page.getModel()),s.setAttribute("id","downloadLink");var d=document.createTextNode("Download ZIP File From Here");s.appendChild(d);var c=document.createElement("LI");c.appendChild(s),document.getElementById("saveLoad").appendChild(c)}else document.getElementById("downloadLink").setAttribute("href","scripts/tab_control.php?download=1&&model="+Page.getModel());setTimeout(function(){document.getElementById("downloadLink").remove()},3e4)}else if(r=="Undo")Action.undo();else if(r=="Redo")Action.redo();else if(r=="Reindent"){var h=Page.getRawUmpleCodeCM6().split(`
`),C=Page.codeMirrorEditor6.state.selection.main.head,m=Page.codeMirrorEditor6.state.doc.lineAt(C).number;clientDebuggerFlag&&console.log(m);var T=h[m].match(/^\s*/)[0].length,S=C.ch-T;C.ch=S,Action.reindent(h,C)}else r=="ShowHideTextEditor"?(Layout.showHideTextEditor(),Page.showText=!Page.showText,Page.setShowHideIconState("SHT_button")):r=="ShowHideCanvas"?(Layout.showHideCanvas(),Page.showCanvas=!Page.showCanvas,Page.setShowHideIconState("SHD_button")):r=="ShowEditableClassDiagram"?Action.changeDiagramType({type:"editableClass"}):r=="ShowJointJSClassDiagram"?Action.changeDiagramType({type:"JointJSClass"}):r=="ShowGvClassDiagram"?Action.changeDiagramType({type:"GvClass"}):r=="ShowGvFeatureDiagram"?Action.changeDiagramType({type:"GvFeature"}):r=="ShowGvStateDiagram"?Action.changeDiagramType({type:"GvState"}):r=="ShowStructureDiagram"?Action.changeDiagramType({type:"structure"}):r=="ShowHideLayoutEditor"?Layout.showHideLayoutEditor():r=="ManualSync"?Action.enableManualSync():r=="SyncDiagram"?(Action.processTyping("codeMirrorEditor",!0),Page.codeMirrorEditor6.focus()):r=="PhotoReady"?Action.photoReady():r=="ToggleAttributes"?(Action.toggleAttributes(),Page.setShowHideIconState("SHA_button")):r=="ToggleMethods"?(Action.toggleMethods(),Page.setShowHideIconState("SHM_button")):r=="ToggleActions"?Action.toggleActions():r=="ToggleTraits"?Action.toggleTraits():r=="ToggleTransitionLabels"?Action.toggleTransitionLabels():r=="ToggleGuards"?Action.toggleGuards():r=="ToggleGuardLabels"?Action.toggleGuardLabels():r=="AllowPinch"?Action.allowPinch():r=="ToggleFeatureDependency"?Action.toggleFeatureDependency():r=="StructureLink"?Action.generateStructureDiagramFile():r=="TabsCheckbox"&&Action.toggleTabs()},Action.focusOn=function(e,t){var r="#"+e,a=e=="umpleModelEditorText"||e=="umpleLayoutEditorText"||e=="CodeMirror";e=="CodeMirror"&&(r=".CodeMirror-scroll"),t?(!Page.isPhotoReady()||a)&&(jQuery(r).parent().addClass("focus"),jQuery(r).addClass("visibleFocus"),a&&(Page.shortcutsEnabled=!1,Page.selectedItem!=null&&Page.unselectAllToggleTools(),Action.unselectAll())):(jQuery(r).parent().removeClass("focus"),jQuery(r).removeClass("visibleFocus"),(a||e=="CodeMirror")&&(Page.shortcutsEnabled=!0))},Action.startOver=function(){Page.setUmpleCode(""),UmpleSystem.merge(null),window.location="umple.php"},Action.showRefreshUmpleOnlineCompletely=function(){jQuery("#buttonStartOver").show()},Action.loadBlankModel=function(){UmpleSystem.merge(null),Page.showCanvasLoading(!0),Page.showModelLoading(!0),Page.showLayoutLoading(!0),Ajax.sendRequest("scripts/compiler.php",Action.loadExampleCallback,"exampleCode=")},Action.undo=function(){jQuery("#buttonUndo").hasClass("disabled")||Action.redoOrUndo(!0)},Action.redo=function(){jQuery("#buttonRedo").hasClass("disabled")||Action.redoOrUndo(!1)},Action.dropHandler=function(e){if(Page.setFeedbackMessage("File will be dropped"),e.preventDefault(),e.dataTransfer.items){for(var t=0;t<e.dataTransfer.items.length;t++)if(e.dataTransfer.items[t].kind==="file"){var r=e.dataTransfer.items[t].getAsFile();r.text().then(function(a){Page.setUmpleCode(a)})}}else for(var t=0;t<e.dataTransfer.files.length;t++)e.dataTransfer.files[t].text().then(function(n){Page.setUmpleCode(n)})},Action.dragOverHandler=function(e){e.preventDefault()},Action.getThemePreference=function(){try{var e=document.getElementById("themeModeSelect"),t=localStorage.getItem("umple-theme"),r=e&&/^(light|dark|system)$/.test(e.value)?e.value:/(light|dark|system)$/.test(t)?t:"system";return r==="system"?window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":r}catch{return"light"}},Action.redoOrUndo=function(e){var t="";Action.manualSync&&Action.diagramInSync&&(Action.diagramInSync=!1,Page.enablePaletteItem("buttonSyncDiagram",!0),Page.enableDiagram(!1)),e?t=TabControl.getCurrentHistory().getPreviousVersion():t=TabControl.getCurrentHistory().getNextVersion(),t==History.noChange&&(t="");var r=t.indexOf(Page.modelDelimiter),a="";r==-1?a=t:a=t.substring(0,r);var n=Page.getRawUmpleCodeCM6().replace(Page.modelDelimiter,""),o=Action.findDiff(n,a),u=Action.getCaretPosition();Action.freshLoad=!0,Page.setUmpleCode(t),Action.manualSync||Action.updateLayoutEditorAndDiagram(),Action.setjustUpdatetoSaveLater(!0),setTimeout(function(){o[1]==o[2]?Action.setCaretPosition(u):Action.setCaretPosition(o[3])},300)},Action.findDiff=function(e,t){var r=0,a=e.length,n=t.length,o=a;n<o&&(o=n);for(var u=0;u<o&&e.charAt(u)===t.charAt(u);)u++,e.charAt(u)===`
`&&t.charAt(u)===`
`&&r++;var s=t.substring(u,1);return[a,n,u,r+1]},Action.loadFile=function(){var e=Page.getFilename();e!=""?(Action.setjustUpdatetoSaveLater(!0),Page.getModel().substring(0,8)=="taskroot"?Ajax.sendRequest("scripts/compiler.php",Action.loadFileCallback,format("load=1&isTask=1&filename={0}",e)):Ajax.sendRequest("scripts/compiler.php",Action.loadFileCallback,format("load=1&filename={0}",e))):Action.saveNewFile()},Action.loadFileCallback=function(e){if(Action.freshLoad=!0,!(Object.keys(TabControl.tabs).length>1)){if(Page.setUmpleCode(e.responseText,!0),TabControl.getCurrentHistory().save(e.responseText,"loadFileCallback"),Action.setjustUpdatetoSaveLater(!0),TabControl.tabs[TabControl.getActiveTabId()].nameIsEphemeral){var t=TabControl.extractNameFromCode(e.responseText);t&&TabControl.useActiveTabTo(TabControl.renameTab)(t,!0)}Action.manualSync||(Action.updateUmpleDiagram(),Action.freshLoad=!1)}},Action.loadTask=function(e,t){jQuery("#showInstrcutionsArea").css("display","block"),t?Page.getModel().split("-")[0]=="task"?Ajax.sendRequest("scripts/compiler.php",Action.loadTaskExceptCodeCallback,format("loadTask=1&loadInstructionAsHTML=1&filename={0}",e)):Ajax.sendRequest("scripts/compiler.php",Action.loadTaskExceptCodeCallback,format("loadTask=1&filename={0}",e)):Ajax.sendRequest("bookmark.php",Action.loadTaskBookmark,format("taskname={0}&model={0}",e))},Action.loadTaskBookmark=function(e){e.responseText.split(" ")[0]=="Task"?window.alert("Load Task Failed! "+e.responseText):window.location.href="umple.php?model="+e.responseText},Action.loadTaskCallback=function(e){if(Action.freshLoad=!0,!(Object.keys(TabControl.tabs).length>1)){Action.setjustUpdatetoSaveLater(!0),TabControl.getCurrentHistory().save(e.responseText,"loadTaskCallback");var t=e.responseText.split("task delimiter");if(Page.setUmpleCode(t[0]),TabControl.tabs[TabControl.getActiveTabId()].nameIsEphemeral){var r=TabControl.extractNameFromCode(t[0]);r&&TabControl.useActiveTabTo(TabControl.renameTab)(r,!0)}Action.manualSync||Action.updateUmpleDiagram(),TabControl.useActiveTabTo(TabControl.saveTab)(Page.getUmpleCode()),TabControl.saveActiveTabs(),window.location.href="bookmark.php?taskname="+t[2]+"&model="+t[3]}},Action.loadTaskExceptCodeCallback=function(e){Action.freshLoad=!0,justUpdatetoSaveLater||(TabControl.getCurrentHistory().save(e.responseText,"loadTaskExceptCodeCallback"),Action.setjustUpdatetoSaveLater(!0));var t=e.responseText.split("task delimiter");if(jQuery("#labelInstructions").text('Instructions for task "'+t[2]+'":'),jQuery("#requestorName").val(t[4]),jQuery("#labelInstructions").css("display","block"),jQuery("#taskArea").css("display","block"),Page.getModel().split("-")[0]=="task"?(jQuery("#labelInstructions").text('Instructions for task "'+t[2]+'":               Requestor Name:'+t[4]),jQuery("#labelCompletionURL").css("display","none"),jQuery("#completionURLCell").css("display","none"),jQuery("#labelRequestorName").css("display","none"),jQuery("#requestorName").css("display","none"),jQuery("#instructionsHTML").html(t[1])):(jQuery("#instructions").val(t[1]),jQuery("#instructions").css("display","block"),jQuery("#completionURL").val(t[5]),jQuery("#isExperimentCell").css("display","inline"),jQuery("#isExperiment").prop("checked",t[6]=="true"),jQuery("#instructions").each(function(){this.setAttribute("style","height:"+this.scrollHeight+"px;overflow-y:hidden;")}).on("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"})),TabControl.tabs[TabControl.getActiveTabId()].nameIsEphemeral){var r=TabControl.extractNameFromCode(t[0]);r&&TabControl.useActiveTabTo(TabControl.renameTab)(r,!0)}Layout.zoomResize()},Action.submitLoadTask=function(){var e=jQuery("#inputLoadTaskName").val();if(!/^(\w|\.)+$/.test(e)){window.alert("Task Name can only contain letters(case insensitive), underscores, dots, and digits!");return}Action.loadTask(e,!1)},Action.submitTaskWork=function(){Ajax.sendRequest("task.php",Action.submitTaskWorkCallback,format("submitTaskWork=1&model={0}&responseURL={1}",Page.getModel(),window.location.href))},Action.submitTaskWorkCallback=function(e){window.alert("Successfully submitted Task!");var t=e.responseText.split("task submit delimiter");t[0]==""?window.location.href=t[2]:window.location.href=t[0]+"?task="+t[1]+"&url="+t[2]},Action.launchParticipantURL=function(){var e=Page.getModel().split("-")[1];window.open("bookmark.php?loadTaskWithURL=1&taskname="+e+"&model="+e)},Action.copyParticipantURL=function(){var e=Page.getModel().split("-")[1],t=window.location.hostname+window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/"))+"/bookmark.php?loadTaskWithURL=1&taskname="+e+"&model="+e;Action.copyToClp(t),Page.setFeedbackMessage("Participant URL is in copy buffer: "+t)},Action.openStartFreshWork=function(){var e=confirm("Are you sure to start from fresh?");e&&(window.location.href="/umpleonline/umple.php")},Action.copyToClp=function(e){prenode=document.createElement("PRE"),e=document.createTextNode(e),prenode.appendChild(e);var t=document,r=window,a=t.body;if(a.appendChild(prenode),a.createTextRange){var n=a.createTextRange();n.moveToElementText(e),n.select(),t.execCommand("copy")}else{var n=t.createRange(),o=r.getSelection;n.selectNodeContents(e),o().removeAllRanges(),o().addRange(n),t.execCommand("copy"),o().removeAllRanges()}prenode.remove()},Action.openInstructionInNewTab=function(){jQuery("#buttonReshowInstructions").css("display","inline");var e=window.open("about:blank","_blank");e.document.write(jQuery("#instructionsHTML").html()),e.document.close(),jQuery("#instructionsHTML").css("display","none"),jQuery("#labelInstructions").css("display","none"),jQuery("#buttonHideInstructions").css("display","none"),Layout.zoomResize()},Action.reshowInstructions=function(){jQuery("#instructionsHTML").css("display","block"),jQuery("#labelInstructions").css("display","inline"),jQuery("#buttonReshowInstructions").css("display","none"),jQuery("#buttonHideInstructions").css("display","inline"),Layout.zoomResize()},Action.hideInstructions=function(){jQuery("#instructionsHTML").css("display","none"),jQuery("#labelInstructions").css("display","none"),jQuery("#buttonHideInstructions").css("display","none"),jQuery("#buttonReshowInstructions").css("display","inline"),Layout.zoomResize()},Action.saveNewFile=function(){var e=Page.getUmpleCode(),t=Page.getFilename();t==""&&Ajax.sendRequest("scripts/compiler.php",Action.saveNewFileCallback,format("save=1&&umpleCode={0}",e))},Action.saveNewFileCallback=function(e){Page.setFilename(e.responseText)},Action.changeDiagramType=function(e){var t=!1;if(jQuery(".layoutListItem").hide(),e.type=="editableClass"){if(Page.useEditableClassDiagram)return;Page.useEditableClassDiagram=!0,Page.useJointJSClassDiagram=!1,Page.useGvClassDiagram=!1,Page.useGvStateDiagram=!1,Page.useGvFeatureDiagram=!1,Page.useStructureDiagram=!1,t=!0,jQuery("#buttonShowEditableClassDiagram").prop("checked","checked"),Page.setDiagramTypeIconState("editableClass"),jQuery(".view_opt_class").show(),jQuery(".view_opt_class_palette").show()}else if(e.type=="JointJSClass"){if(Page.useJointJSClassDiagram)return;Page.useEditableClassDiagram=!1,Page.useJointJSClassDiagram=!0,Page.useGvClassDiagram=!1,Page.useGvStateDiagram=!1,Page.useGvFeatureDiagram=!1,Page.useStructureDiagram=!1,t=!0,jQuery("#buttonShowJointJSClassDiagram").prop("checked","checked"),Page.setDiagramTypeIconState("JointJSClass"),jQuery(".view_opt_class").show(),jQuery(".view_opt_class_palette").show()}else if(e.type=="GvClass"){if(Page.useGvClassDiagram)return;Page.useEditableClassDiagram=!1,Page.useJointJSClassDiagram=!1,Page.useGvClassDiagram=!0,Page.useGvStateDiagram=!1,Page.useGvFeatureDiagram=!1,Page.useStructureDiagram=!1,t=!0,jQuery("#buttonShowGvClassDiagram").prop("checked","checked"),Page.setDiagramTypeIconState("GvClass"),jQuery(".view_opt_class").show()}else if(e.type=="GvState"){if(Page.useGvStateDiagram)return;Page.useEditableClassDiagram=!1,Page.useJointJSClassDiagram=!1,Page.useGvClassDiagram=!1,Page.useGvStateDiagram=!0,Page.useStructureDiagram=!1,Page.useGvFeatureDiagram=!1,t=!0,jQuery("#buttonShowGvStateDiagram").prop("checked","checked"),Page.setDiagramTypeIconState("GvState"),jQuery(".view_opt_state").show()}else if(e.type=="GvFeature"){if(Page.useGvFeatureDiagram)return;Page.useEditableClassDiagram=!1,Page.useJointJSClassDiagram=!1,Page.useGvClassDiagram=!1,Page.useGvStateDiagram=!1,Page.useStructureDiagram=!1,Page.useGvFeatureDiagram=!0,t=!0,jQuery("#buttonShowGvFeatureDiagram").prop("checked","checked"),Page.setDiagramTypeIconState("GvFeature"),jQuery(".view_opt_feature").show()}else if(e.type=="structure"){if(Page.useGvStructureDiagram)return;Page.useEditableClassDiagram=!1,Page.useJointJSClassDiagram=!1,Page.useGvClassDiagram=!1,Page.useGvStateDiagram=!1,Page.useStructureDiagram=!0,Page.useGvFeatureDiagram=!1,t=!0,jQuery("#buttonShowStructureDiagram").prop("checked","checked"),Page.setDiagramTypeIconState("structure")}t&&Action.redrawDiagram()},Action.pngImage=function(){var e=Json.toString(UmpleSystem),t=encodeURIComponent(e);window.open("scripts/compiler.php?asImage="+t,"UMLClassDiagram")},Action.yumlImage=function(){var e="#buttonYumlImage";jQuery(e).showLoading(),Action.ajax(Action.yumlImageCallback,"save=1")},Action.yumlImageCallback=function(e){var t=e.responseText,r="#buttonYumlImage";jQuery(r).hideLoading(),window.open("scripts/compiler.php?asYuml="+t,"yumlClassDiagram"),Page.showViewDone()},Action.uigu=function(){var e="#buttonUigu";jQuery(e).showLoading(),Action.ajax(Action.uiguCallback,"save=1")},Action.uiguCallback=function(e){var t=e.responseText,r="#buttonUigu";jQuery(r).hideLoading(),window.open("scripts/compiler.php?asUI="+t,"showUserInterface"),Page.showViewDone()},Action.copyClipboardCode=function(){Action.copyToClp(Page.getUmpleCode()),Page.setFeedbackMessage("Code has been copied to the clipboard")},Action.copyCommandLineCode=function(){var e=`sh
`;e+=`echo Will compile umple file. Requires umple command to be installed
`,e+=`cd ~/tmp
`,e+=`mkdir testump-$$
`,e+=`cd testump-$$
`,e+=`cat >> test.ump <<ENDUMP
`;var t=`
ENDUMP
`;t+=`umple test.ump -c -
`,t+=`echo Use ctrl-D to exit back to the original shell

`,Action.copyToClp(e+Page.getUmpleCode()+t),Page.setFeedbackMessage("Shell code to compile on command line was copied to clipboard")},Action.showCodeInSeparateWindow=function(){codeWindow=window.open("","UmpleCode"+Math.random()*1e4,"height=700, width=400, left=100, top=100, location=no, status=no, scrollbars=yes"),codeWindow.document.write('<code><pre id="umpleCode">'+Page.getUmpleCode()+"</pre></code>"),codeWindow.document.title="Umple raw code",codeWindow.document.close()},Action.showEncodedURLCodeInSeparateWindow=function(){codeWindow=window.open("","UmpleEncodedURL"+Math.random()*1e4,"height=500, width=400, left=100, top=100, location=no, status=no, scrollbars=yes"),codeWindow.document.write('<code><pre id="umpleCode">'+Page.getEncodedURL()+"</pre></code>"),codeWindow.document.title="Umple encoded URL",codeWindow.document.close()},Action.simulateCode=function(){simulateButtonSelector="#buttonSimulateCode",jQuery(simulateButtonSelector).showLoading(),Action.ajax(Action.simulateCodeCallback,"language=Simulate")},Action.simulateCodeCallback=function(e){simulateButtonSelector="#buttonSimulateCode",jQuery(simulateButtonSelector).hideLoading();var t=e.responseText;window.open("../umpleonline/simulate.php?model="+t,"umpleSimulator"),Page.showViewDone()},Action.drawInputState=function(e,t,r){var a=document.createElement("div");a.style.zIndex="1000",a.style.border="1px solid #ccc",a.style.backgroundColor="#f8f8f8",a.style.padding="5px",a.style.position="fixed",a.id="promptBox";var n=a.getBoundingClientRect();event.clientX+n.width>window.innerWidth?a.style.right=window.innerWidth-event.clientX+"px":a.style.left=event.clientX+"px",event.clientY+n.height>window.innerHeight?a.style.bottom=window.innerHieght-event.clientY+"px":a.style.top=event.clientY+"px";var o=document.createElement("input");o.type="text",o.style.padding="5px",o.style.borderRadius="3px",o.style.border="1px solid #ccc",o.style.width="200px",o.style.marginLeft="5px";var u=document.createElement("label");u.type="label",u.textContent="Error - Please enter an alphanumeric name beginning with a non-numeric character.",u.style.color="red";var s=function h(C){document.contains(a)&&C.target!=a&&!a.contains(C.target)&&(document.removeEventListener("mousedown",h),a.remove())},d=t.replaceAll("&#10",`
`).replaceAll("&#$quot",'"'),c=document.createElement("label");c.htmlFor="inputLabel",c.style.marginRight="5px",document.addEventListener("mousedown",s),e=="rename"?(clientDebuggerFlag&&console.log("Renaming State ..."),c.appendChild(document.createTextNode("New name for '"+r+"'?")),o.value=r,o.addEventListener("keydown",function(h){if(h.key==="Enter")if(Action.validateAttributeName(o.value)){clientDebuggerFlag&&console.log("Getting code from codemirror editor ...");let C=Page.codeMirrorEditor6.state.doc.toString(),m=new RegExp("(\\W+)("+r+")(\\W+)"),T;for(;(T=C.match(m))!=null;)C=C.substr(0,T.index+T[1].length)+o.value.trim()+C.substr(T.index+T[1].length+T[2].length,C.length-(T.index+T[1].length+T[2].length));clientDebuggerFlag&&console.log("Setting updated code to codemirror editor ..."),Page.setCodeMirror6Text(C),setTimeout('Action.processTyping("newEditor",false)',Action.waiting_time),document.removeEventListener("mousedown",s),clientDebuggerFlag&&console.log("Removing mousedown event ..."),a.remove(),Action.removeContextMenu(),TabControl.getCurrentHistory().save(C,"menuUpdate")}else document.contains(u)||a.appendChild(u)})):e=="substate"?(clientDebuggerFlag&&console.log("Substating state ..."),c.appendChild(document.createTextNode("Name of new substate?")),o.addEventListener("keydown",function(h){if(h.key==="Enter")if(Action.validateAttributeName(o.value)){let C=d.substr(0,d.length-1)+"  "+o.value+"{}}";clientDebuggerFlag&&console.log("Getting original code and adding substate ..."),C=Page.codeMirrorEditor6.state.doc.toString().replace(d,C),clientDebuggerFlag&&console.log("Setting updated code with substate into codemirror editor ..."),Page.setCodeMirror6Text(C),setTimeout('Action.processTyping("newEditor",false)',Action.waiting_time),document.removeEventListener("mousedown",s),clientDebuggerFlag&&console.log("Removing mousedown event ..."),a.remove(),Action.removeContextMenu(),TabControl.getCurrentHistory().save(C,"menuUpdate")}else document.contains(u)||a.appendChild(u)})):e=="transition"&&(clientDebuggerFlag&&console.log("Adding Transition ..."),c.appendChild(document.createTextNode("Condition for new transition?")),o.addEventListener("keydown",function(h){if(h.key==="Enter")if(Action.validateAttributeName(o.value)){var C=t.replaceAll("&#10",`
`).replaceAll("&#$quot",'"');document.removeEventListener("mousedown",s),a.remove(),Action.removeContextMenu(),clientDebuggerFlag&&console.log("Waiting to select target state for transition ...");var m=function(S){let P=S.target;for(;P.parentElement.id!="graph0";)P=P.parentNode;let _=P.outerHTML.substr(P.outerHTML.indexOf("stateClicked(&quot;")+19,P.outerHTML.indexOf('&quot;)"')-(P.outerHTML.indexOf("stateClicked(&quot;")+19));_=_.split("^*^");let F="  "+o.value+" -> "+_[2]+`;
}`,g=C.substr(0,C.length-1)+F;clientDebuggerFlag&&(console.log("New state created ..."),console.log("Replacing original state with new state in the code ...")),Page.setCodeMirror6Text(Page.codeMirrorEditor6.state.doc.toString().replace(C,g)),setTimeout('Action.processTyping("newEditor",false)',Action.waiting_time),TabControl.getCurrentHistory().save(Page.codeMirrorEditor6.state.doc.toString(),"menuUpdate");let b=document.getElementsByClassName("node");for(let k=0;k<b.length;k++)b[k].removeEventListener("mousedown",m);T=document.getElementsByClassName("cluster");for(let k=0;k<b.length;k++)b[k].removeEventListener("mousedown",m)},T=document.getElementsByClassName("node");for(let S=0;S<T.length;S++)T[S].addEventListener("mousedown",m);T=document.getElementsByClassName("cluster");for(let S=0;S<T.length;S++)T[S].addEventListener("mousedown",m)}else document.contains(u)||a.appendChild(u)})),a.appendChild(c),a.appendChild(o),document.body.appendChild(a),o.focus()},Action.deleteState=function(e,t,r,a){let n=a.split(",");clientDebuggerFlag&&console.log("Getting code from codemirror editor ...");let o=Page.codeMirrorEditor6.state.doc.toString();clientDebuggerFlag&&console.log("Deleting State: ",a);let u=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"');o=o.replace(u,"");let s=new RegExp("[^{};]*->\\s*([^\\S\\s]*|\\s*)(\\/\\s*{[^}]*})*([^\\S\\s]*|\\s*)("+n[n.length-1]+")(\\s+\\w+)*\\s*;"),d;for(;(d=o.match(s))!=null;)o=o.substr(0,d.index)+o.substr(d.index+d[0].length,o.length-(d.index+d[0].length));clientDebuggerFlag&&console.log("Setting updated code to codemirror editor ..."),Page.setCodeMirror6Text(o),setTimeout('Action.processTyping("newEditor",false)',Action.waiting_time),TabControl.getCurrentHistory().save(o,"menuUpdate"),Action.removeContextMenu()},Action.drawStateMenu=function(){if(Action.diagramInSync){Action.removeContextMenu();for(var e=event.target;e.parentElement.id!="graph0";)e=e.parentNode;var t=e.outerHTML.substr(e.outerHTML.indexOf("stateClicked(&quot;")+19,e.outerHTML.indexOf('&quot;)"')-(e.outerHTML.indexOf("stateClicked(&quot;")+19));t=t.split("^*^"),t[2]=t[2].split(".");var r=Page.codeMirrorEditor6.state.doc.toString(),a=Action.selectStateInClassCM6(t[0],t[1],t[2][0]);for(let m=1;m<t[2].length;m++)a=Action.selectStateInStateCM6(a.startIndex,a.endIndex,t[2][m]);var n=r.substr(a.startIndex,a.endIndex-a.startIndex);if(typeof n=="string"){var o=document.createElement("customContextMenu"),u=["Rename State","Delete State","Add Substate","Add Transition"],s=n.replaceAll(`
`,"&#10").replaceAll('"',"&#$quot"),d=['Action.drawInputState("rename","'+s+'","'+t[2][t[2].length-1]+'")','Action.deleteState("'+s+'","'+t[0]+'","'+t[1]+'","'+t[2]+'")','Action.drawInputState("substate","'+s+'","'+t[2][t[2].length-1]+'")','Action.drawInputState("transition","'+s+'","'+t[2][t[2].length-1]+'")'];o.style.zIndex="1000",o.style.border="1px solid #ccc",o.style.backgroundColor="#f8f8f8",o.style.padding="5px",o.style.position="fixed";for(var c=0;c<u.length;c++){var h=document.createElement("div");h.style.padding="5px",h.style.borderRadius="3px",h.style.cursor="pointer",h.style.transition="background-color 0.3s",h.textContent=u[c],h.setAttribute("onclick","javascript:"+d[c]),h.addEventListener("mouseover",function(){this.style.backgroundColor="#ddd"}),h.addEventListener("mouseout",function(){this.style.backgroundColor="transparent"}),o.appendChild(h)}var C=o.getBoundingClientRect();event.clientX+C.width>window.innerWidth?o.style.right=window.innerWidth-event.clientX+"px":o.style.left=event.clientX+"px",event.clientY+C.height>window.innerHeight?o.style.bottom=window.innerHieght-event.clientY+"px":o.style.top=event.clientY+"px",document.addEventListener("mousedown",function m(T){var S=document.getElementById("promptBox");T.target!=o&&!o.contains(T.target)&&(S!=null&&T.target!=S&&S.contains(T.target),document.removeEventListener("mousedown",m),Action.removeContextMenu())}),document.body.appendChild(o)}}},Action.displayTransitionMenu=function(e){if(!Action.diagramInSync)return;Action.removeContextMenu();for(var t=e.target;t.parentElement.id!="graph0";)t=t.parentNode;var r=t.outerHTML.substr(t.outerHTML.indexOf("transitionClicked(&quot;")+24,t.outerHTML.indexOf('&quot;)"')-(t.outerHTML.indexOf("transitionClicked(&quot;")+24));r=r.replaceAll("&amp;","&");let a=r.split("*^*"),n=a[3].split(".");dest=a[4].split(".");for(var o=Action.selectStateInClassCM6(a[0],a[1],n[0]),u=1;u<n.length;u++)o=Action.selectStateInStateCM6(o.startIndex,o.endIndex,n[u]);let s=a[2].replaceAll("+","\\+").replaceAll("-","\\-").replaceAll("*","\\*").replaceAll("?","\\?").replaceAll("|","\\|");if(s=s.replace("after","after~`~?:Every`~`?"),a[5]!=""){let D=a[5].trim().replaceAll("+","\\+").replaceAll("-","\\-").replaceAll("*","\\*").replaceAll("?","\\?").replaceAll("|","\\|");s=s+"\\s*[\\s*"+D.trim().slice(1,D.trim().length-1)+"\\s*]"}s=s.replaceAll("]","\\]").replaceAll("[","\\[").replaceAll(")","\\)?").replaceAll("(","\\(?").replaceAll("~`~","(").replaceAll("`~`",")").replaceAll(" ","\\s*").replaceAll(",","\\s*,\\s*").replaceAll("!","\\s*!\\s*").replaceAll("/","\\s*/\\s*"),s=s.replaceAll("&&","&{1,2}");let d=new RegExp(s+".*->","s"),c=Page.codeMirrorEditor6.state.doc.toString().substr(o.startIndex,o.endIndex-o.startIndex).search(d)+o.startIndex,h=Page.codeMirrorEditor6.state.doc.toString().substr(c),C=Action.findEOL(h);if(C.split("->").length-1!==1){Page.setFeedbackMessage(" Please edit this complex transition in the textual code.");return}let m=c+C.length,T=Page.codeMirrorEditor6.state.doc.toString().substring(c,m),S=new RegExp("^(.*?)(\\s*\\[(.*?)\\])?(\\s*\\/\\s*\\{(.*?)\\})?\\s*->\\s*(\\[(.*?)\\])?(\\s*\\/\\s*\\{(.*?)\\})?\\s*(\\w+);?$","s");const P=T.trim().match(S);let _=P[1].trim(),F=P[3]?P[3].trim():P[7]?P[7].trim():null,g=P[5]?P[5].trim():P[9]?P[9].trim():null,b=P[10].trim();F===null&&(F=""),g===null&&(g="");var k=document.createElement("customContextMenu"),L=["Change or Add Event Name","Change or Add Guard","Change or Add Action","Change Destination State","Delete Transition"],A=['Action.modifyTransitionEventName("'+c+'","'+m+'")','Action.modifyTransitionGuard("'+c+'","'+m+'")','Action.modifyTransitionAction("'+c+'","'+m+'")','Action.changeTransition("'+b+'","'+c+'","'+m+'")','Action.deleteTransition("'+c+'","'+m+'")'];k.style.zIndex="1000",k.style.border="1px solid #ccc",k.style.backgroundColor="#f8f8f8",k.style.padding="5px",k.style.position="fixed";for(var u=0;u<L.length;u++){var E=document.createElement("div");E.style.padding="5px",E.style.borderRadius="3px",E.style.cursor="pointer",E.style.transition="background-color 0.3s",E.textContent=L[u],E.setAttribute("onclick","javascript:"+A[u]),E.addEventListener("mouseover",function(){this.style.backgroundColor="#ddd"}),E.addEventListener("mouseout",function(){this.style.backgroundColor="transparent"}),k.appendChild(E)}var j=k.getBoundingClientRect();e.clientX+j.width>window.innerWidth?k.style.right=window.innerWidth-e.clientX+"px":k.style.left=e.clientX+"px",e.clientY+j.height>window.innerHeight?k.style.bottom=window.innerHieght-e.clientY+"px":k.style.top=e.clientY+"px",document.addEventListener("mousedown",function D(N){var I=document.getElementById("promptBox");N.target!=k&&!k.contains(N.target)&&(I!=null&&N.target!=I&&I.contains(N.target),document.removeEventListener("mousedown",D),Action.removeContextMenu())}),document.addEventListener("keydown",function D(N){var I=document.getElementById("promptBox");N.target!=k&&!k.contains(N.target)&&N.key==="Escape"&&(I!=null&&N.target!=I&&I.contains(N.target),document.removeEventListener("keydown",D),Action.removeContextMenu())}),document.body.appendChild(k)},Action.changeTransition=function(e,t,r){let o=Page.codeMirrorEditor6.state.doc.toString().substring(t,r).trim().replace(/;$/,"").split("->");if(o[0]=o[0].trim(),o[1]=o[1].trim(),o.length!=2){console.log("Invalid transition format.");return}var u=document.createElement("div");u.style.zIndex="1000",u.style.border="1px solid #ccc",u.style.backgroundColor="#f8f8f8",u.style.padding="5px",u.style.position="absolute",u.style.left="50%",u.style.top="50%",u.style.transform="translate(-50%, -50%)",u.id="promptBox";var s=document.createElement("input");s.type="text",s.value=o[1],s.style.padding="5px",s.style.margin="5px",s.style.width="200px";var d=document.createElement("button");d.textContent="Change Destination",d.style.padding="5px",d.style.marginLeft="5px",u.appendChild(s),u.appendChild(d),document.body.appendChild(u),s.focus();var c=function h(C){document.contains(u)&&C.target!=u&&!u.contains(C.target)&&(document.removeEventListener("mousedown",h),u.remove())};document.addEventListener("mousedown",c),document.addEventListener("keydown",function(h){h.key==="Escape"&&(u.remove(),document.removeEventListener("keydown",arguments.callee))}),d.addEventListener("click",function(){if(s.value.trim()===""){console.log("Input for new destination state is empty.");return}let h=o[0]+" -> "+o[1].replace(e,s.value.trim())+";",C=Page.codeMirrorEditor6.state.doc.toString(),m=C.substring(0,t),T=C.substring(r),S=m+h+T;Page.setCodeMirror6Text(S),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"changeTransitionDestination"),document.removeEventListener("mousedown",c),u.remove(),Action.selectMatchingText(h)}),s.addEventListener("keydown",function(h){h.key==="Enter"&&(h.preventDefault(),h.stopPropagation(),d.click())})},Action.deleteTransition=function(e,t){let r=Page.codeMirrorEditor6.state.doc.toString().substring(e,t),a=Page.codeMirrorEditor6.state.doc.toString();a=a.replace(r,""),Page.setCodeMirror6Text(a),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate")},Action.modifyTransitionGuard=function(e,t){let r=new RegExp("^(.*?)(\\s*\\[(.*?)\\])?(\\s*\\/\\s*\\{(.*?)\\})?\\s*->\\s*(\\[(.*?)\\])?(\\s*\\/\\s*\\{(.*?)\\})?\\s*(\\w+);?$","s"),a=Page.codeMirrorEditor6.state.doc.toString().substring(e,t);const n=a.trim().match(r);let o=n[1].trim(),u=n[3]?n[3].trim():n[7]?n[7].trim():null,s=n[5]?n[5].trim():n[9]?n[9].trim():null,d=n[10].trim();u===null&&(u=""),s===null&&(s="");var c=document.createElement("div");c.style.zIndex="1000",c.style.border="1px solid #ccc",c.style.backgroundColor="#f8f8f8",c.style.padding="5px",c.style.position="absolute",c.style.left="50%",c.style.top="50%",c.style.transform="translate(-50%, -50%)",c.id="promptBox";var h=document.createElement("input");h.type="text",h.value=u,h.style.padding="5px",h.style.margin="5px",h.style.width="200px";var C=document.createElement("button");C.textContent="Change/Add Guard",C.style.padding="5px",C.style.marginLeft="5px",c.appendChild(h),c.appendChild(C),document.body.appendChild(c),h.focus();var m=function T(S){document.contains(c)&&S.target!=c&&!c.contains(S.target)&&(document.removeEventListener("mousedown",T),c.remove())};document.addEventListener("mousedown",m),document.addEventListener("keydown",function(T){T.key==="Escape"&&(c.remove(),document.removeEventListener("keydown",arguments.callee))}),C.addEventListener("click",function(){let S=a.trim().split("->");if(S[0]=S[0].trim(),S[1]=S[1].trim(),S.length!=2){console.log("Invalid transition format.");return}let P="";if(h.value.trim()===""){if(u===null||u==="")return;pattern=new RegExp("\\[\\s*(.*?)\\s*\\]","g"),P=a.replace(pattern,"")}else u===null||u===""?(s==null||s===""||S[1].includes(s)?S[0]=o+" ["+h.value.trim()+"]":S[0]=o+" ["+h.value.trim()+"] /{"+s+"}",P=S[0]+" -> "+S[1]):P=a.replace(u,h.value.trim());let _=Page.codeMirrorEditor6.state.doc.toString(),F=_.substring(0,e),g=_.substring(t),b=F+P+g;Page.setCodeMirror6Text(b),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"modifyGuard"),document.removeEventListener("mousedown",m),c.remove(),Action.selectMatchingText(P)}),h.addEventListener("keydown",function(T){T.key==="Enter"&&(T.preventDefault(),T.stopPropagation(),C.click())})},Action.modifyTransitionAction=function(e,t){let r=new RegExp("^(.*?)(\\s*\\[(.*?)\\])?(\\s*\\/\\s*\\{(.*?)\\})?\\s*->\\s*(\\[(.*?)\\])?(\\s*\\/\\s*\\{(.*?)\\})?\\s*(\\w+);?$","s"),a=Page.codeMirrorEditor6.state.doc.toString().substring(e,t);const n=a.trim().match(r);let o=n[3]?n[3].trim():n[7]?n[7].trim():null,u=n[5]?n[5].trim():n[9]?n[9].trim():null;o===null&&(o=""),u===null&&(u="");var s=document.createElement("div");s.style.zIndex="1000",s.style.border="1px solid #ccc",s.style.backgroundColor="#f8f8f8",s.style.padding="5px",s.style.position="absolute",s.style.left="50%",s.style.top="50%",s.style.transform="translate(-50%, -50%)",s.id="promptBox";var d=document.createElement("textarea");d.style.width="300px",d.style.height="100px",d.value=u||"";var c=document.createElement("button");c.textContent="Change/Add Action",c.style.padding="5px",c.style.marginLeft="5px",s.appendChild(d),s.appendChild(c),document.body.appendChild(s),d.focus();var h=function C(m){document.contains(s)&&m.target!=s&&!s.contains(m.target)&&(document.removeEventListener("mousedown",C),s.remove())};document.addEventListener("mousedown",h),document.addEventListener("keydown",function(C){C.key==="Escape"&&(s.remove(),document.removeEventListener("keydown",arguments.callee))}),c.addEventListener("click",function(){let m=a.trim().split("->");if(m[0]=m[0].trim(),m[1]=m[1].trim(),m.length!=2){console.log("Invalid transition format.");return}let T="";if(d.value.trim()===""){if(u===null||u==="")return;pattern=new RegExp("/\\s*\\{.*?\\}\\s*->","g"),T=a.replace(pattern," ->")}else u===null||u===""?T=m[0]+"/{"+d.value.trim()+"} -> "+m[1]:T=a.replace(u,d.value.trim());let S=Page.codeMirrorEditor6.state.doc.toString(),P=S.substring(0,e),_=S.substring(t),F=P+T+_;Page.setCodeMirror6Text(F),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"modifyAction"),document.removeEventListener("mousedown",h),s.remove(),Action.selectMatchingText(T)}),input.addEventListener("keydown",function(C){C.key==="Enter"&&(C.preventDefault(),C.stopPropagation(),c.click())})},Action.modifyTransitionEventName=function(e,t){let r=Page.codeMirrorEditor6.state.doc.toString().substring(e,t),a=new RegExp("^(.*?)\\s*(\\[(.*?)\\])?\\s*(\\/\\s*\\{(.*?)\\})?\\s*->\\s*(\\w+);?$","s");const n=r.match(a);let o=n[1].trim(),u=n[3]?n[3].trim():null,s=n[5]?n[5].trim():null,d=n[6].trim();var c=document.createElement("div");c.style.zIndex="1000",c.style.border="1px solid #ccc",c.style.backgroundColor="#f8f8f8",c.style.padding="5px",c.style.position="absolute",c.style.left="50%",c.style.top="50%",c.style.transform="translate(-50%, -50%)",c.id="promptBox";var h=document.createElement("input");h.type="text",h.value=o,h.style.padding="5px",h.style.margin="5px",h.style.width="200px";var C=document.createElement("button");C.textContent="Change/Add Event Name",C.style.padding="5px",C.style.marginLeft="5px",c.appendChild(h),c.appendChild(C),document.body.appendChild(c),h.focus();var m=function T(S){document.contains(c)&&S.target!=c&&!c.contains(S.target)&&(document.removeEventListener("mousedown",T),c.remove())};document.addEventListener("mousedown",m),document.addEventListener("keydown",function(T){T.key==="Escape"&&(c.remove(),document.removeEventListener("keydown",arguments.callee))}),C.addEventListener("click",function(){if(h.value.trim()===""){console.log("Input for new transition condition is empty.");return}let T=r.replace(o,h.value.trim()),S=Page.codeMirrorEditor6.state.doc.toString(),P=S.substring(0,e),_=S.substring(t),F=P+T+_;Page.setCodeMirror6Text(F),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"renameTransition"),document.removeEventListener("mousedown",m),c.remove(),Action.selectMatchingText(T)}),h.addEventListener("keydown",function(T){T.key==="Enter"&&(T.preventDefault(),T.stopPropagation(),C.click())})},Action.removeContextMenu=function(){var e=document.getElementsByTagName("customContextMenu");e.length!=0&&e.item(0).remove()},Action.setColor=function(e,t,r){let a=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"');if(a.includes("displayColor")){let n="displayColor "+r+";",o=new RegExp("displayColor\\s+.*;");n=a.replace(o,n),Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:Page.codeMirrorEditor6.state.doc.toString().replace(a,n)}}),setTimeout(function(){TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate")},100)}else{let n="{  displayColor "+r+`;
`;n=a.substr(0,a.indexOf("{"))+n+a.substr(a.indexOf("{")+1,a.length-a.indexOf("{")-1),Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:Page.codeMirrorEditor6.state.doc.toString().replace(a,n)}})}},Action.drawInput=function(e,t,r){var a=document.createElement("div");a.style.zIndex="1000",a.style.border="1px solid #ccc",a.style.backgroundColor="#f8f8f8",a.style.padding="5px",a.style.position="fixed",a.id="promptBox";var n=a.getBoundingClientRect();event.clientX+n.width>window.innerWidth?a.style.right=window.innerWidth-event.clientX+"px":a.style.left=event.clientX+"px",event.clientY+n.height>window.innerHeight?a.style.bottom=window.innerHieght-event.clientY+"px":a.style.top=event.clientY+"px";var o=document.createElement("input");o.type="text",o.style.padding="5px",o.style.borderRadius="3px",o.style.border="1px solid #ccc",o.style.width="200px",o.style.marginLeft="5px";var u=document.createElement("label");u.type="label",u.textContent="Error - Please enter an alphanumeric name.",u.style.color="red";var s=function k(L){document.contains(a)&&L.target!=a&&!a.contains(L.target)&&(document.removeEventListener("mousedown",k),a.remove())};if(document.addEventListener("mousedown",s),e=="attri"){var d=document.createElement("select"),c=document.createElement("option");c.value="String",c.text="String";var h=document.createElement("option");h.value="Integer",h.text="Integer";var C=document.createElement("option");C.value="Double",C.text="Double";var m=document.createElement("option");m.value="Float",m.text="Float";var T=document.createElement("option");T.value="Boolean",T.text="Boolean";var S=document.createElement("option");S.value="Date",S.text="Date";var P=document.createElement("option");P.value="Time",P.text="Time",d.add(c),d.add(h),d.add(C),d.add(m),d.add(T),d.add(S),d.add(P),a.appendChild(d);var o=document.createElement("input");o.type="text",o.style.padding="5px",o.style.borderRadius="3px",o.style.border="1px solid #ccc",o.style.width="200px",o.style.marginLeft="5px",o.addEventListener("keydown",function(L){if(L.key==="Enter")if(Action.validateAttributeName(o.value)){let A=t.replaceAll("&#10",`
`).replaceAll("&#$quot",'"'),E;if(o.value.includes(":")){let N=o.value.split(":");E=A.substr(0,A.length-1)+"  "+N[1].trim()+" "+N[0].trim()+`;
}`}else E=A.substr(0,A.length-1)+"  "+d.value+" "+o.value+`;
}`;const j=Page.codeMirrorEditor6.state.doc.length,D=Page.codeMirrorEditor6.state.doc.toString().replace(A,E);Page.codeMirrorEditor6.dispatch({changes:{from:0,to:j,insert:D}}),document.removeEventListener("mousedown",s),a.remove(),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate")}else document.contains(u)||a.appendChild(u)}),a.appendChild(o)}else if(e=="rename"){var _=document.createElement("label");_.htmlFor="replace-all-checkbox",_.style.marginRight="5px",_.appendChild(document.createTextNode("New name for '"+r+"'?")),o.value=r,o.addEventListener("keydown",function(k){if(k.key==="Enter")if(Action.validateAttributeName(o.value)){let L=Page.codeMirrorEditor6.state.doc.toString(),A=new RegExp("(\\W+)("+r+")(\\W+)"),E;for(;(E=L.match(A))!=null;)L=L.substr(0,E.index+E[1].length)+o.value.trim()+L.substr(E.index+E[1].length+E[2].length,L.length-(E.index+E[1].length+E[2].length));Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:L}}),document.removeEventListener("mousedown",s),a.remove(),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate")}else document.contains(u)||a.appendChild(u)}),a.appendChild(_),a.appendChild(o)}else if(e=="subclass")o.addEventListener("keydown",function(k){if(k.key==="Enter")if(Action.validateAttributeName(o.value)){let L=`
class `+o.value+`
{
  isA `+r+`;
}
`;Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:Page.codeMirrorEditor6.state.doc.toString()+L}}),document.removeEventListener("mousedown",s),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate"),a.remove(),Action.removeContextMenu()}else document.contains(u)||a.appendChild(u)}),a.appendChild(o);else if(e=="color"){var F=document.createElement("label");F.textContent="Color - ";var g=document.createElement("span");g.innerHTML="&#8594;",g.style.cursor="pointer",g.fontSize="20px",g.style.paddingLeft="5px",o.style.width="30px",o.style.height="30px",o.type="color";var b=function k(L){L.key==="Enter"&&(document.removeEventListener("keydown",k),Action.setColor(t,r,o.value),a.remove(),Action.removeContextMenu())};document.addEventListener("keydown",b),g.addEventListener("click",function(){Action.setColor(t,r,o.value),document.removeEventListener("keydown",b),a.remove(),Action.removeContextMenu()}),g.addEventListener("mouseover",function(){g.style.color="blue"}),g.addEventListener("mouseout",function(){g.style.color="black"}),a.appendChild(F),a.appendChild(o),a.appendChild(g)}document.body.appendChild(a),o.focus()},Action.deleteClass=function(e,t){let r=Page.codeMirrorEditor6.state.doc.toString();r=r.replace(e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"'),"");let a=new RegExp(".*\\s*(-|<)(>|-)\\s*.*\\s*"+t+"(\\s+\\w+)*\\s*;"),n;for(;(n=r.match(a))!=null;)r=r.substr(0,n.index)+r.substr(n.index+n[0].length,r.length-(n.index+n[0].length));for(a=new RegExp(".*"+t+"\\s*(<|-)(>|-)\\s*.*\\s+\\w+;");(n=r.match(a))!=null;)r=r.substr(0,n.index)+r.substr(n.index+n[0].length,r.length-(n.index+n[0].length));if(a=new RegExp("isA\\s+"+t),r.match(a)!=null){let o=new RegExp("isA\\s+(\\w+);"),u;if((u=e.match(o))!=null){let s="isA "+u[1]+";";for(;(n=r.match(a))!=null;)r=r.substr(0,n.index)+s+r.substr(n.index+n[0].length+1,r.length-(n.index+n[0].length+1))}else for(;(n=r.match(a))!=null;)r=r.substr(0,n.index)+r.substr(n.index+n[0].length+1,r.length-(n.index+n[0].length+1))}for(a=new RegExp("associationClass\\s+\\w+\\s*\\n*{(\\n*\\W*\\w*;)*(\\s*CRUD_Value\\s*{(\\s*\\w*\\s*,*)*}\\s*\\n*)*(\\n*\\W*\\w*;)*([\\s|\\t]*[*]\\s+"+t+";)(\\n*\\W*\\w*;)*(\\s*CRUD_Value\\s*{(\\s*\\w*\\s*,*)*}\\s*\\n*)*(\\n*\\W*\\w*)*?}"),n=null;(n=r.match(a))!=null;)r=r.substr(0,n.index)+r.substr(n.index+n[0].length,r.length-(n.index+n[0].length));Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:r}}),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate")},Action.addAssociationGv=function(e,t){var r=document.getElementsByClassName("node"),a=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"');Action.removeContextMenu();for(let n=0;n<r.length;n++)r[n].addEventListener("mousedown",function o(u){for(var s=u.target;s.parentElement.id!="graph0";)s=s.parentNode;s=s.outerHTML.substr(s.outerHTML.indexOf("&nbsp;"),s.outerHTML.indexOf("</text>")-s.outerHTML.indexOf("&nbsp;")).replaceAll("&nbsp;","").trim();let d="  * -> 1 "+s+`;
}
`,c=a.substr(0,a.length-1)+d;Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:Page.codeMirrorEditor6.state.doc.toString().replace(a,c)}}),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate");let h=document.getElementsByClassName("node");for(let C=0;C<h.length;C++)h[C].removeEventListener("mousedown",o)})},Action.displayMenu=function(e){if(Action.diagramInSync){Action.removeContextMenu();for(var t=e.target;t.parentElement.id!="graph0";)t=t.parentNode;t=t.outerHTML.substr(t.outerHTML.indexOf("&nbsp;"),t.outerHTML.indexOf("</text>")-t.outerHTML.indexOf("&nbsp;")).replaceAll("&nbsp;","").trim();var r=Page.codeMirrorEditor6.state.doc.toString(),a=Action.splitStates(r);for(let C=0;C<a.length;C++)(a[C].startsWith("class "+t+"{")||a[C].startsWith("class "+t+" ")||a[C].startsWith("class "+t+`
`))&&(a=a[C]);if(typeof a=="string"){var n=document.createElement("customContextMenu"),o=["Add Attribute","Rename Class","Delete Class","Add Subclass","Add Association","Change Color"],u=a.replaceAll(`
`,"&#10").replaceAll('"',"&#$quot"),s=['Action.drawInput("attri","'+u+'","'+t+'")','Action.drawInput("rename","'+u+'","'+t+'")','Action.deleteClass("'+u+'","'+t+'")','Action.drawInput("subclass","'+u+'","'+t+'")','Action.addAssociationGv("'+u+'","'+t+'")','Action.drawInput("color","'+u+'","'+t+'")'];n.style.zIndex="1000",n.style.border="1px solid #ccc",n.style.backgroundColor="#f8f8f8",n.style.padding="5px",n.style.position="fixed";for(var d=0;d<o.length;d++){var c=document.createElement("div");c.style.padding="5px",c.style.borderRadius="3px",c.style.cursor="pointer",c.style.transition="background-color 0.3s",c.textContent=o[d],c.setAttribute("onclick","javascript:"+s[d]),c.addEventListener("mouseover",function(){this.style.backgroundColor="#ddd"}),c.addEventListener("mouseout",function(){this.style.backgroundColor="transparent"}),n.appendChild(c)}var h=n.getBoundingClientRect();e.clientX+h.width>window.innerWidth?n.style.right=window.innerWidth-e.clientX+"px":n.style.left=e.clientX+"px",e.clientY+h.height>window.innerHeight?n.style.bottom=window.innerHieght-e.clientY+"px":n.style.top=e.clientY+"px",document.addEventListener("mousedown",function C(m){var T=document.getElementById("promptBox");m.target!=n&&!n.contains(m.target)&&(T!=null&&m.target!=T&&T.contains(m.target),document.removeEventListener("mousedown",C),Action.removeContextMenu())}),document.body.appendChild(n)}}},Action.displayAssociMenu=function(e,t){const r=/Action\.selectAssociation\('([^']+)'\)/,a=t.match(r);let n=Action.selectAssociation(a[1]);var o=a[1].split(",");if(o.length==4)var u=o[1].trim(),s=o[0].trim(),d=o[2].split(" "),c=o[3].split(" ");else var u=o[1].trim(),d=o[2].split(" "),c=o[2].split(" "),s=o[0].trim();var h=new RegExp("(associationClass|class|interface|trait) "+s+"($|\\s|[{])"),C=new RegExp("(class|interface|trait) [A-Za-z]");if(Page.codeMirrorOn){var m=Action.selectItemCM6(h),T=Page.codeMirrorEditor6.state.sliceDoc(m.startIndex,m.endIndex);clientDebuggerFlag&&console.warn("classCode: "+T)}var S=T.replaceAll(`
`,"&#10").replaceAll('"',"&#$quot");let P=1,_=n.startIndex,F=n.endIndex;var g=Page.codeMirrorEditor6.state.sliceDoc(_,F);clientDebuggerFlag&&console.warn("selectedText: "+g),g.includes(d[0].trim())==!1&&(P=3);var b=document.createElement("customContextMenu"),k=P===3?["Alter "+s+" multiplicity","Alter "+s+" role name","Alter "+u+" role name"]:["Alter "+s+" multiplicity","Alter "+s+" role name","Alter "+u+" multiplicity","Alter "+u+" role name","Delete the association"],L=P===3?['Action.modifyMultiplicity("'+S+'","'+g+'","'+c[0]+'","0")','Action.modifyRoleName("'+S+'","'+g+'","'+c[1]+'","'+c[0]+'","0")','Action.modifyRoleName("'+S+'","'+g+'","'+d[1]+'","'+c[0]+'","1")']:['Action.modifyMultiplicity("'+S+'","'+g+'","'+c[0]+'","0")','Action.modifyRoleName("'+S+'","'+g+'","'+c[1]+'","'+c[0]+'","0")','Action.modifyMultiplicity("'+S+'","'+g+'","'+d[0]+'","'+P+'")','Action.modifyRoleName("'+S+'","'+g+'","'+d[1]+'","'+c[0]+'","1")','Action.deleteAssociation("'+S+'","'+g+'")'];b.style.zIndex="1000",b.style.border="1px solid #ccc",b.style.backgroundColor="#f8f8f8",b.style.padding="5px",b.style.position="fixed";for(var A=0;A<k.length;A++){var E=document.createElement("div");E.style.padding="5px",E.style.borderRadius="3px",E.style.cursor="pointer",E.style.transition="background-color 0.3s",E.textContent=k[A],E.setAttribute("onclick","javascript:"+L[A]),E.addEventListener("mouseover",function(){this.style.backgroundColor="#ddd"}),E.addEventListener("mouseout",function(){this.style.backgroundColor="transparent"}),b.appendChild(E)}var j=b.getBoundingClientRect();e.clientX+j.width>window.innerWidth?b.style.right=window.innerWidth-e.clientX+"px":b.style.left=e.clientX+"px",e.clientY+j.height>window.innerHeight?b.style.bottom=window.innerHieght-e.clientY+"px":b.style.top=e.clientY+"px",document.addEventListener("keydown",function D(N){var I=document.getElementById("promptBox");N.target!=b&&!b.contains(N.target)&&N.key==="Escape"&&(I!=null&&N.target!=I&&I.contains(N.target),document.removeEventListener("keydown",D),Action.removeContextMenu())}),document.addEventListener("mousedown",function D(N){var I=document.getElementById("promptBox");N.target!=b&&!b.contains(N.target)&&(I!=null&&N.target!=I&&I.contains(N.target),document.removeEventListener("mousedown",D),Action.removeContextMenu())}),document.body.appendChild(b)},Action.validateMultiplicity=function(e){if(!e)return!1;if(e==="*"||e.match(/^\d+$/))return!0;if(e.match(/^(\d+|\*)\.\.(\d+|\*)$/)){const t=e.split(".."),r=t[0],a=t[1];if(r==="*"||a==="*"){if(r==="0"||r.match(/^\d+$/)&&r!=="0")return!0}else{const n=parseInt(r,10),o=parseInt(a,10);if(n<=o)return!0}}return!1},Action.modifyMultiplicity=function(e,t,r,a){let n=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"');if(a==1)var o=!0;else if(a==3){Page.setFeedbackMessage(" unable to change end multiplicity for associationClass ");return}else var o=!1;var u=document.createElement("div");u.style.zIndex="1000",u.style.border="1px solid #ccc",u.style.backgroundColor="#f8f8f8",u.style.padding="5px",u.style.position="absolute",u.style.left="50%",u.style.top="50%",u.style.transform="translate(-50%, -50%)",u.id="promptBox";var s=document.createElement("input");s.type="text",s.value=r,s.style.padding="5px",s.style.margin="5px",s.style.width="200px";var d=document.createElement("button");d.textContent="Change",d.style.padding="5px",d.style.marginLeft="5px";var c=document.createElement("label");c.type="label",c.style.color="red",c.textContent="Please enter a valid multiplicity format (e.g., '*', '1', '0..1', '1..*', '2..5').",u.appendChild(s),u.appendChild(d),document.body.appendChild(u),s.focus();var h=function C(m){document.contains(u)&&m.target!=u&&!u.contains(m.target)&&(document.removeEventListener("mousedown",C),u.remove())};document.addEventListener("mousedown",h),document.addEventListener("keydown",function(C){C.key==="Escape"&&(u.remove(),document.removeEventListener("keydown",arguments.callee))}),d.addEventListener("click",function(){if(Action.validateMultiplicity(s.value.trim())){var C=r.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&");let m;if(o){const S=t.split(new RegExp(C));S.length===3?m=S[0]+r.trim()+S[1]+s.value.trim()+S[2]:S.length===2&&(m=S[0]+s.value.trim()+S[1])}else m=t.replace(new RegExp(C),s.value.trim());let T=Page.codeMirrorEditor6.state.doc.toString();if(n.includes(t)==!1)T=T.replace(t,m);else{let S=n;S=S.replace(t,m),T=T.replace(n,S)}Page.setCodeMirror6Text(T),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate"),u.remove(),Action.selectMatchingText(m)}else s.focus(),u.appendChild(c)}),s.addEventListener("keydown",function(C){C.key==="Enter"&&(C.preventDefault(),C.stopPropagation(),d.click())})},Action.modifyRoleName=function(e,t,r,a,n){let o=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"');if(n==1)var u=!0;else var u=!1;var s=document.createElement("div");s.style.zIndex="1000",s.style.border="1px solid #ccc",s.style.backgroundColor="#f8f8f8",s.style.padding="5px",s.style.position="absolute",s.style.left="50%",s.style.top="50%",s.style.transform="translate(-50%, -50%)",s.id="promptBox";var d=document.createElement("input");d.type="text",d.value=r,d.style.padding="5px",d.style.margin="5px",d.style.width="200px";var c=document.createElement("button");c.textContent="Change",c.style.padding="5px",c.style.marginLeft="5px";var h=document.createElement("label");h.type="label",h.style.color="red",h.textContent="To add a role name at this end there must be a role name at the other end first",s.appendChild(d),s.appendChild(c),document.body.appendChild(s),d.focus();var C=function m(T){document.contains(s)&&T.target!=s&&!s.contains(T.target)&&(document.removeEventListener("mousedown",m),s.remove())};document.addEventListener("mousedown",C),document.addEventListener("keydown",function(m){m.key==="Escape"&&(s.remove(),document.removeEventListener("keydown",arguments.callee))}),c.addEventListener("click",function(){var m=d.value.trim();if(r==""){var T=/(\s*<-\s*|\s*><\s*|\s*--\s*|\s*->\s*|\s*<@>-\s*|\s*-\s*<@>\s*)/,S=t.split(T),P=S[0].trim(),_,F,g;if(S.length>2){var b=S[2].trim();if(u)if(b.includes("sorted")){var k=b.split("sorted"),L=b.split(";");F=k[0].trim()+" "+m+"sorted"+k[1]}else{var L=b.split(";");F=L[0].trim()+" "+m+";"}else if(o.includes(t)==!1?_=P.trim()+" "+m:_=a.trim()+" "+m,P.includes("sorted")){var A=P.split("sorted");_=a.trim()+" "+m+"sorted"+A[1]}g=u?P+S[1]+F:_+S[1]+b}else if(S=t.split(";")[0].split(" "),u==!1)if(_=a.trim()+" "+m,S.length>2)g=_+" "+S[1].trim()+" "+S[2].trim()+";";else{d.focus(),s.appendChild(h);return}else L=t.split(";"),g=L[0].trim()+" "+m+";"}else g=t.replace(r,m);let E=Page.codeMirrorEditor6.state.doc.toString();if(o.includes(t)==!1)E=E.replace(t,g);else{let j=o;j=j.replace(t,g),E=E.replace(o,j)}Page.setCodeMirror6Text(E),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate"),s.remove(),Action.selectMatchingText(g)}),d.addEventListener("keydown",function(m){m.key==="Enter"&&(m.preventDefault(),m.stopPropagation(),c.click())})},Action.deleteAssociation=function(e,t){let r=Page.codeMirrorEditor6.state.doc.toString(),a=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"');if(a.includes(t)==!1)r=r.replace(t,"");else{let n=a;n=n.replace(t,""),r=r.replace(a,n)}Page.setCodeMirror6Text(r),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate")},Action.displayAttributeMenu=function(e,t,r){if(Action.diagramInSync){Action.removeContextMenu();var a=e.target;for(t=t.trim();a.parentElement.id!="graph0";)a=a.parentNode;a=a.outerHTML.substr(a.outerHTML.indexOf("&nbsp;"),a.outerHTML.indexOf("</text>")-a.outerHTML.indexOf("&nbsp;")).replaceAll("&nbsp;","").trim();var n=Page.codeMirrorEditor6.state.doc.toString(),o=Action.splitStates(n);for(let S=0;S<o.length;S++)(o[S].startsWith("class "+a+"{")||o[S].startsWith("class "+a+" ")||o[S].startsWith("class "+a+`
`))&&(o=o[S]);if(typeof o=="string"){var u=document.createElement("customContextMenu"),s=document.createElement("div");s.textContent="Attribute: "+t+"Type: "+r,s.style.padding="5px",s.style.borderBottom="1px solid #ccc",s.style.fontWeight="bold",u.appendChild(s);var d=["Rename Attribute","Change Type","Delete Attribute"],c=o.replaceAll(`
`,"&#10").replaceAll('"',"&#$quot"),h=['Action.renameAttribute("'+c+'","'+a+'","'+t+'","'+r+'")','Action.changeAttributeType("'+c+'","'+a+'","'+t+'","'+r+'")','Action.deleteAttribute("'+c+'","'+a+'","'+t+'","'+r+'")'];u.style.zIndex="1000",u.style.border="1px solid #ccc",u.style.backgroundColor="#f8f8f8",u.style.padding="5px",u.style.position="fixed";for(var C=0;C<d.length;C++){var m=document.createElement("div");m.style.padding="5px",m.style.borderRadius="3px",m.style.cursor="pointer",m.style.transition="background-color 0.3s",m.textContent=d[C],m.setAttribute("onclick","javascript:"+h[C]),m.addEventListener("mouseover",function(){this.style.backgroundColor="#ddd"}),m.addEventListener("mouseout",function(){this.style.backgroundColor="transparent"}),u.appendChild(m)}var T=u.getBoundingClientRect();e.clientX+T.width>window.innerWidth?u.style.right=window.innerWidth-e.clientX+"px":u.style.left=e.clientX+"px",e.clientY+T.height>window.innerHeight?u.style.bottom=window.innerHeight-e.clientY+"px":u.style.top=e.clientY+"px",document.addEventListener("keydown",function S(P){var _=document.getElementById("promptBox");P.target!=u&&!u.contains(P.target)&&P.key==="Escape"&&(_!=null&&P.target!=_&&_.contains(P.target),document.removeEventListener("keydown",S),Action.removeContextMenu())}),document.addEventListener("mousedown",function S(P){P.target!=u&&!u.contains(P.target)&&(document.removeEventListener("mousedown",S),Action.removeContextMenu())}),document.body.appendChild(u)}}},Action.renameAttribute=function(e,t,r,a){var n=document.createElement("div");n.style.zIndex="1000",n.style.border="1px solid #ccc",n.style.backgroundColor="#f8f8f8",n.style.padding="5px",n.style.position="absolute",n.style.left="50%",n.style.top="50%",n.style.transform="translate(-50%, -50%)",n.id="promptBox";var o=document.createElement("input");o.type="text",o.value=r,o.style.padding="5px",o.style.margin="5px",o.style.width="200px";var u=document.createElement("button");u.textContent="Rename",u.style.padding="5px",u.style.marginLeft="5px",n.appendChild(o),n.appendChild(u),document.body.appendChild(n),o.focus();var s=function d(c){document.contains(n)&&c.target!=n&&!n.contains(c.target)&&(document.removeEventListener("mousedown",d),n.remove())};document.addEventListener("mousedown",s),u.addEventListener("click",function(){if(Action.validateAttributeName(o.value.trim())){let d=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"'),c=d.includes(r+" :"),h=new RegExp("\\b"+r+"\\s*:\\s*\\w+\\s*;\\n?","g"),C=new RegExp("\\b"+r+"\\s*;\\n?","g"),m=c?a+" "+o.value.trim()+`;
`:o.value.trim()+`;
`,T=d;T=T.replace(h,m),T=T.replace(C,m);let S=new RegExp("\\b"+r+"\\b","g");T=T.replace(S,o.value.trim());let P=Page.codeMirrorEditor6.state.doc.toString();P=P.replace(d,T),Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:P}}),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate"),document.removeEventListener("mousedown",s),n.remove()}})},Action.changeAttributeType=function(e,t,r,a){var n=document.createElement("div");n.style.zIndex="1000",n.style.border="1px solid #ccc",n.style.backgroundColor="#f8f8f8",n.style.padding="5px",n.style.position="absolute",n.style.left="50%",n.style.top="50%",n.style.transform="translate(-50%, -50%)",n.id="promptBox";var o=document.createElement("select");["String","Integer","Double","Float","Boolean","Date","Time"].forEach(function(d){var c=document.createElement("option");c.value=d,c.text=d,d===a&&(c.selected=!0),o.appendChild(c)});var u=document.createElement("button");u.textContent="Change Type",u.style.padding="5px",u.style.margin="5px",n.appendChild(o),n.appendChild(u),document.body.appendChild(n),o.focus();var s=function d(c){document.contains(n)&&c.target!=n&&!n.contains(c.target)&&(document.removeEventListener("mousedown",d),n.remove())};document.addEventListener("mousedown",s),u.addEventListener("click",function(){var d=o.options[o.selectedIndex].value;if(d!==a){let c=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"'),h=c;if(a!="String"){let m=new RegExp("\\b"+a+"\\s"+r,"g");h=h.replace(m,d+" "+r)}else{let m=new RegExp("\\b"+a+"\\s"+r,"g"),T=new RegExp("\\b"+r,"g");h=h.replace(m,d+" "+r),h=h.replace(T,d+" "+r)}let C=Page.codeMirrorEditor6.state.doc.toString();C=C.replace(c,h),Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:C}}),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate"),document.removeEventListener("mousedown",s),n.remove()}else document.removeEventListener("mousedown",s),n.remove()})},Action.deleteAttribute=function(e,t,r,a){let n=e.replaceAll("&#10",`
`).replaceAll("&#$quot",'"'),o=new RegExp("\\b"+a+"\\s"+r+"\\s*;","g"),u=new RegExp("\\b"+r+"\\s*;\\n?","g"),s=n;s=s.replace(o,""),s=s.replace(u,"");let d=Page.codeMirrorEditor6.state.doc.toString();d=d.replace(n,s),Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:d}}),Action.removeContextMenu(),TabControl.getCurrentHistory().save(Page.getUmpleCode(),"menuUpdate")},Action.classSelected=function(e){var t=Page.selectedClass,r=e;if(t!=null){Page.selectedClass=null,jQuery("#"+t.id).css("background-color","white");for(var a="#"+t.id+"_anchor",n=0;n<8;n++)jQuery(a+n).hide()}if(r!=null){jQuery("#umpleCanvas").addClass("unscrollable"),Page.selectedClass=UmpleSystem.find(r.id),jQuery("#"+r.id).css("background-color","#F3F6FB");for(var a="#"+r.id+"_anchor",o="#"+r.id+"_hover",n=0;n<8;n++)jQuery(a+n).show(),jQuery(o+n).hide()}else jQuery("#umpleCanvas").removeClass("unscrollable")},Action.classHover=function(e,t){var r=e.currentTarget;if(Action.diagramInSync&&!(Page.selectedClass!=null&&Page.selectedClass.id==r.id)){var a=t?"block":"none",n=jQuery("#"+r.id);if(t?n.css("background-color","#F3F6FB"):n.css("background-color","white"),Page.canShowHovers())for(var o=8,u="#"+r.id+"_hover",s=0;s<o;s++)t?jQuery(u+s).show():jQuery(u+s).hide()}},Action.unselectAll=function(){Action.classSelected(null),Action.associationSelected(null),Action.generalizationSelected(null),Action.transitionSelected(null)},Action.classClicked=function(e){if(Action.diagramInSync){Action.focusOn("umpleCanvas",!0),Action.focusOn("umpleModelEditorText",!1),Action.unselectAll(),Action.elementClicked=!0;var t=e.currentTarget;if(Action.selectClass(t.id),Page.selectedItem=="DeleteEntity")DiagramEdit.classDeleted(t.id);else if(Page.selectedItem=="AddAssociation")DiagramEdit.newAssociation==null?(Action.canCreateByDrag=!1,DiagramEdit.createAssociationPartOne(e)):(DiagramEdit.createAssociationPartTwo(e),setTimeout(function(){Action.canCreateByDrag=!0},500));else if(Page.selectedItem=="AddGeneralization")if(DiagramEdit.newGeneralization==null){var r=DiagramEdit.createGeneralizationPartOne(e);r&&(Action.canCreateByDrag=!1)}else DiagramEdit.createGeneralizationPartTwo(e),setTimeout(function(){Action.canCreateByDrag=!0},500);else Action.classSelected(t)}},Action.stateClicked=function(e){if(Action.diagramInSync){Action.focusOn("umpleCanvas",!0),Action.focusOn("umpleModelEditorText",!1);var t=e.split("^*^"),r=t[0],a=t[1],n=t[2].replace("Entry:","").replace("Exit:","");n=n.replace("Exit:",""),Action.unselectAll(),Action.elementClicked=!0;var o=null,u=null;if(n.includes(".")){clientDebuggerFlag&&console.log("stateClicked - nested state case"),n=n.split("."),u=Action.selectStateInClassCM6(r,a,n[0]);for(let s=1;s<n.length;s++)clientDebuggerFlag&&console.log("Iterating states within Identified state ..."),u=Action.selectStateInStateCM6(u.startIndex,u.endIndex,n[s])}else clientDebuggerFlag&&console.log("stateClicked - else - base case"),u=Action.selectStateInClassCM6(r,a,n),clientDebuggerFlag&&console.log("selectionIndiciesCM6: ",u);Action.highlightByIndexCM6(u.startIndex,u.endIndex),Page.selectedItem=="AddTransition"&&(DiagramEdit.newTransition==null?(Action.canCreateByDrag=!1,DiagramEdit.createTransitionPartOne(event)):(DiagramEdit.createTransitionPartTwo(event),setTimeout(function(){Action.canCreateByDrag=!0},500)))}},Action.associationClicked=function(e){if(Action.diagramInSync){Action.elementClicked=!0,Action.unselectAll();var t=e.currentTarget;Action.associationSelected(t)}},Action.transitionClicked=function(e){if(!Action.diagramInSync||typeof e=="string"&&e===null)return;Action.elementClicked=!0,Action.unselectAll();let t=e.split("*^*"),r=t[3].split(".");dest=t[4];var a=Action.selectStateInClassCM6(t[0],t[1],r[0]);dest=t[4].split(".");for(var n=1;n<r.length;n++)a=Action.selectStateInStateCM6(a.startIndex,a.endIndex,r[n]);let o=t[2].replaceAll("+","\\+").replaceAll("-","\\-").replaceAll("*","\\*").replaceAll("?","\\?").replaceAll("|","\\|");if(o=o.replace("after","after~`~?:Every`~`?"),t[5]!=""){let C=t[5].trim().replaceAll("+","\\+").replaceAll("-","\\-").replaceAll("*","\\*").replaceAll("?","\\?").replaceAll("|","\\|");o=o+"\\s*[\\s*"+C.trim().slice(1,C.trim().length-1)+"\\s*]"}o=o.replaceAll("]","\\]").replaceAll("[","\\[").replaceAll(")","\\)?").replaceAll("(","\\(?").replaceAll("~`~","(").replaceAll("`~`",")").replaceAll(" ","\\s*").replaceAll(",","\\s*,\\s*").replaceAll("!","\\s*!\\s*").replaceAll("/","\\s*/\\s*"),o=o.replaceAll("&&","&{1,2}");let u=new RegExp(o+".*->","s"),s=Page.codeMirrorEditor6.state.doc.toString().substr(a.startIndex,a.endIndex-a.startIndex).search(u)+a.startIndex,d=Page.codeMirrorEditor6.state.doc.toString().substr(s),c=Action.findEOL(d),h=s+c.length;Action.highlightByIndexCM6(s,h),c.split("->").length-1!==1&&Page.setFeedbackMessage("Please edit this complex transition in the textual code."),Action.highlightByIndexCM6(s,h)},Action.generalizationClicked=function(e){if(Action.diagramInSync){Action.elementClicked=!0,Action.unselectAll();var t=e.currentTarget;Action.generalizationSelected(t)}},Action.associationHover=function(e,t){if(Action.diagramInSync){var r=e.currentTarget,a=UmpleSystem.findAssociation(r.id);if(r!=null&&Page.canShowHovers())for(var n=2,o="#"+r.id+"_hover",u=0;u<n;u++)t?jQuery(o+u).show():jQuery(o+u).hide()}},Action.transitionHover=function(e,t){if(Action.diagramInSync){var r=e.currentTarget,a=UmpleSystem.findTransition(r.id);if(updateAssociation!=null&&Page.canShowHovers())for(var n=2,o="#"+updateAssociation.id+"_hover",u=0;u<n;u++)t?jQuery(o+u).show():jQuery(o+u).hide()}},Action.generalizationHover=function(e,t){if(Action.diagramInSync){var r=e.currentTarget;if(r!=null&&Page.canShowHovers())for(var a="#"+r.id+"_hover",n=0;n<3;n++)t?jQuery(a+n).show():jQuery(a+n).hide()}},Action.associationSelected=function(e){var t=e!=null,r=null;if(Page.selectedItem=="DeleteEntity"&&e!=null){var a=!1;DiagramEdit.associationDeleted(e.id,a);return}if(e!=null)Page.selectedAssociation=e,r=e;else if(Page.selectedAssociation!=null)r=Page.selectedAssociation,Page.selectedAssociation=null;else return;for(var n=2,o="#"+r.id+"_anchor",u=0;u<n;u++)t?jQuery(o+u).show():jQuery(o+u).hide()},Action.transitionSelected=function(e){var t=e!=null,r=null;if(Page.selectedItem=="DeleteEntity"&&e!=null){var a=!1;DiagramEdit.transitionDeleted(e.id,a);return}if(e!=null)Page.selectedTransition=e,r=e;else if(Page.selectedTransition!=null)r=Page.selectedTransition,Page.selectedTransition=null;else return;for(var n=2,o="#"+r.id+"_anchor",u=0;u<n;u++)t?jQuery(o+u).show():jQuery(o+u).hide()},Action.generalizationSelected=function(e){var t=e!=null,r=null;if(Page.selectedItem=="DeleteEntity"&&e!=null){var a=!1;DiagramEdit.generalizationDeleted(e.id,a);return}if(e!=null)Page.selectedGeneralization=e,r=e;else if(Page.selectedGeneralization!=null)r=Page.selectedGeneralization,Page.selectedGeneralization=null;else return;for(var n=3,o="#"+r.id+"_anchor",u=0;u<n;u++)t?jQuery(o+u).show():jQuery(o+u).hide()},Action.executeCode=function(e,t){var r="#buttonExecuteCode",a=t;jQuery(r).showLoading(),Action.ajax(function(n){Action.executeCodeCallback(n)},format("execute=true&language={0}&languageStyle={1}&model={2}",a,e,Page.getModel()),"true")},Action.generateCode=function(e,t){var r="#buttonGenerateCode",a=t,n;Page.getAdvancedMode()==0&&t==="Cpp"&&(a="Experimental-"+t),t==="StateTables"&&(n=StateTree.colourStateTables),t==="EventSequence"&&(n=StateTree.colourEventSequences),t==="stateDiagram"&&(a=t+"."+$("inputGenerateCode").value.split(":")[1]),jQuery(r).showLoading(),Action.ajax(function(o){Action.generateCodeCallback(o,e,n)},format("language={0}&languageStyle={1}",a,e),"true")},Action.photoReady=function(){var e="#"+Page.umpleCanvasId();Page.isPhotoReady()?jQuery(e).addClass("photoReady"):jQuery(e).removeClass("photoReady"),UmpleSystem.redrawCanvas()},Action.executeCodeCallback=function(e){var t="#buttonExecuteCode";jQuery(t).hideLoading(),Page.showExecutionArea(),Page.hideGeneratedCodeOnly(),Page.showExecutedResponse(e.responseText),window.location.href="#codeExecutionArea"},Action.generateCodeCallback=function(e,t,r){Page.showGeneratedCode(e.responseText,t),Page.hideExecutionArea(),Action.gentime=new Date().getTime(),r!==void 0&&r();var a="#buttonGenerateCode";jQuery(a).hideLoading(),Page.showCodeDone(),window.location.href="#genArea"},Action.classMouseDown=function(e){Action.canCreateByDrag&&(Page.selectedItem=="AddAssociation"&&DiagramEdit.newAssociation==null?DiagramEdit.createAssociationPartOne(e):Page.selectedItem=="AddGeneralization"&&DiagramEdit.newGeneralization==null?DiagramEdit.createGeneralizationPartOne(e):Page.selectedItem=="AddTransition"&&DiagramEdit.newTransition==null&&DiagramEdit.createTransitionPartOne(e))},Action.classMouseUp=function(e){Action.canCreateByDrag&&(Page.selectedItem=="AddAssociation"&&DiagramEdit.newAssociation!=null?DiagramEdit.createAssociationPartTwo(e):Page.selectedItem=="AddGeneralization"&&DiagramEdit.newGeneralization!=null?DiagramEdit.createGeneralizationPartTwo(e):Page.selectedItem=="AddTransition"&&DiagramEdit.newTransition!=null&&DiagramEdit.createTransitionPartTwo(e))},Action.mouseMove=function(e){Page.clickCount=0,Page.selectedItem=="AddClass"&&(DiagramEdit.newClass==null&&(DiagramEdit.newClass=new UmpleClass,DiagramEdit.newClass.name="",DiagramEdit.newClass.id="tempClass"),Action.drawClassOutline(e,DiagramEdit.newClass)),DiagramEdit.newAssociation!=null&&Page.selectedItem=="AddAssociation"&&Action.drawAssociationLine(e,DiagramEdit.newAssociation),DiagramEdit.newTransition!=null&&Page.selectedItem=="AddTransition"&&Action.drawTransitionLine(e,Diagramedit.newTransition),DiagramEdit.newGeneralization!=null&&Page.selectedItem=="AddGeneralization"&&Action.drawGeneralizationLine(e,DiagramEdit.newGeneralization)},Action.drawClassOutline=function(e,t){var r="#"+Page.umpleCanvasId(),a=new UmplePosition(e.pageX,e.pageY+1,0,0),n=a.subtract(UmpleSystem.position());t.position=new UmplePosition(n.x,n.y,UmpleClassFactory.defaultSize.width,UmpleClassFactory.defaultSize.height);var o=t.drawableClassOutline();jQuery(r).append(o);var u="#"+t.id,s=u+"_width",d=u+"_height",c=new Object;c.left=a.x,c.top=a.y,jQuery(u).offset(c),jQuery(s).width(t.position.width),jQuery(d).height(t.position.height)},Action.drawAssociationLine=function(e,t){var r="#"+Page.umpleCanvasId(),a=new UmplePosition(e.pageX,e.pageY,0,0);t.classTwoPosition=a.subtract(UmpleSystem.position()),jQuery(r).append(t.drawable())},Action.drawTransitionLine=function(e,t){var r="#"+Page.umpleCanvasId(),a=new UmplePosition(e.pageX,e.pageY,0,0);t.toStatePosition=a.subtract(UmpleSystem.position()),jQuery(r).append(t.drawable())},Action.drawGeneralizationLine=function(e,t){var r="#"+Page.umpleCanvasId(),a="#"+t.getElementId(),n=UmpleSystem.position(),o=e.pageX-5-n.x,u=e.pageY+5-n.y;t.parentPosition=new UmplePosition(o,u,0,0),jQuery(a).remove(),jQuery(r).append(t.drawable(!1))},Action.umpleCanvasClicked=function(e){if(Action.elementClicked){Action.elementClicked=!1;return}if(Page.selectedItem=="AddClass"){var t=new UmplePosition(Math.floor(e.pageX),Math.floor(e.pageY),0,0);DiagramEdit.addClass(t)}else Page.selectedItem=="AddAssociation"&&DiagramEdit.newAssociation!=null?Page.clickCount>1&&DiagramEdit.removeNewAssociation():Page.selectedItem=="AddTransition"&&DiagramEdit.newTransition!=null?Page.clickCount>1&&DiagramEdit.removeNewTransition():Page.selectedItem=="AddGeneralization"&&DiagramEdit.newGeneralization!=null?Page.clickCount>1&&DiagramEdit.removeNewGeneralization():Action.unselectAll()},Action.directUpdateCommandCallback=function(e){Action.updateUmpleTextCallback(e),Action.redrawDiagram()},Action.updateUmpleTextCallback=function(e){!justUpdatetoSaveLater&&!justUpdatetoSaveLaterForTextCallback&&(TabControl.getCurrentHistory().save(e.responseText,"TextCallback"),Page.setExampleMessage("")),Action.freshLoad=!0,Page.setUmpleCode(e.responseText,Action.update.codeChange),Page.hideLoading(),DiagramEdit.textChangeQueue.length==0?(Action.freshLoad=!1,DiagramEdit.pendingChanges=!1,Action.setjustUpdatetoSaveLater(!1),Action.setjustUpdatetoSaveLaterForTextCallback(!1)):(Action.setjustUpdatetoSaveLater(!0),Action.setjustUpdatetoSaveLaterForTextCallback(!0),DiagramEdit.doTextUpdate())},Action.setExampleType=function e(){jQuery("#itemLoadExamples").hide(),jQuery("#itemLoadExamples2").hide(),jQuery("#itemLoadExamples3").hide(),jQuery("#itemLoadExamples4").hide(),Page.getExampleType()=="cdModels"?(jQuery("#itemLoadExamples").show(),jQuery("#defaultExampleOption").prop("selected",!0)):Page.getExampleType()=="smModels"?(jQuery("#itemLoadExamples2").show(),jQuery("#defaultExampleOption2").prop("selected",!0)):Page.getExampleType()=="featureModels"?(jQuery("#itemLoadExamples4").show(),jQuery("#defaultExampleOption4").prop("selected",!0)):(jQuery("#itemLoadExamples3").show(),jQuery("#defaultExampleOption3").prop("selected",!0))},Action.loadExample=function e(){var a=this.dataset.diagramType,t=jQuery(" option:selected",this);if(t.hasClass("openUmprOption")){location.href="http://umple.org/umpr?diagram-type="+a;return}UmpleSystem.merge(null),Page.showCanvasLoading(!0),Page.showModelLoading(!0),Page.showLayoutLoading(!0),Ajax.sendRequest("scripts/compiler.php",Action.loadExampleCallback,"exampleCode="+Page.getSelectedExample());var r=Page.getSelectedExample().slice(0,-4),a="";Page.useGvStateDiagram?a="&diagramtype=state":Page.useGvFeatureDiagram?a="&diagramtype=GvFeature":Page.useStructureDiagram&&(a="&diagramtype=structure&generateDefault=cpp");var n="#buttonLarger",o="#buttonSmaller",u="#"+Page.umpleCanvasId();umpleCanvasWidth=jQuery(u).width(),umpleCanvasHeight=jQuery(u).height();var s=Page.getSelectedExample();if(r.startsWith("https"))var d=r.split("/").pop(),c="?filename="+r.substr(8)+".ump"+a;else var d=r,c="?example="+d+a;Page.setExampleMessage('<a href="'+c+'">URL for '+d+" example</a>"),jQuery("#inputExample").blur()},Action.loadExampleCallback=function(e){Action.freshLoad=!0,Action.setjustUpdatetoSaveLater(!0),Page.setUmpleCode(e.responseText,function(){Page.hideLoading(),Action.updateUmpleDiagram()}),Action.setCaretPosition("0"),Action.updateLineNumberDisplay(),TabControl.getCurrentHistory().save(e.responseText,"loadExampleCallback")},Action.customSizeTyped=function(){Action.oldTimeout!=null&&clearTimeout(Action.oldTimeout);var e=jQuery("#widthField").val(),t=jQuery("#heightField").val();Action.oldTimeout=setTimeout(function(){Page.setUmpleCanvasSize(e,t)},Action.waiting_time)},Action.moveSelectedClass=function(e,t){e!=null&&(e.position=e.position.add(t),UmpleSystem.updateClass(e),Action.classSelected(e),Action.oldTimeout!=null&&clearTimeout(Action.oldTimeout),Action.oldTimeout=setTimeout(function(){DiagramEdit.classMoved(Page.selectedClass)},1e3))},Action.keyboardShortcut=function(e){if(Page.shortcutsEnabled){var t=e.which;if(t==27){var r=Page.unselectAllToggleTools();r||jQuery(".visibleFocus").blur()}else(t==8||t==46)&&jQuery("#umpleCanvasColumn").hasClass("focus")?Page.selectedClass&&jQuery("#"+Page.selectedClass.id).find("input").length==0?(DiagramEdit.classDeleted(Page.selectedClass.id),e.preventDefault()):Page.selectedAssociation?(DiagramEdit.associationDeleted(Page.selectedAssociation.id),e.preventDefault()):Page.selectedGeneralization&&(DiagramEdit.generalizationDeleted(Page.selectedGeneralization.id),e.preventDefault()):(t==8||t==46)&&jQuery(".umpleClass").is(":focus")?(DiagramEdit.classDeleted(document.activeElement.id),e.preventDefault()):(t==8||t==46)&&(jQuery(".untracedAssociation").is(":focus")||jQuery(".redTracedAssociation").is(":focus"))?(DiagramEdit.associationDeleted(document.activeElement.id),e.preventDefault()):(t==8||t==46)&&jQuery(".umpleGeneralization").is(":focus")&&(DiagramEdit.generalizationDeleted(document.activeElement.id),e.preventDefault())}},Action.getCaretPosition=function(){return Page.codeMirrorEditor6.state.doc.lineAt(Page.codeMirrorEditor6.state.selection.main.head).number},Action.getInputSelectionStart=function(e){var t=0,r,a,n,o,u;return typeof e.selectionStart=="number"&&typeof e.selectionEnd=="number"?(t=e.selectionStart,Page.getAdvancedMode()==2&&Page.setFeedbackMessage("Non-IE browser ")):(Page.getAdvancedMode()==2&&Page.setFeedbackMessage("IE-type browser "),a=document.selection.createRange(),a&&a.parentElement()==e&&(o=e.value.length,r=e.value.replace(/\r\n/g,`
`),n=e.createTextRange(),n.moveToBookmark(a.getBookmark()),u=e.createTextRange(),u.collapse(!1),n.compareEndPoints("StartToEnd",u)>-1?t=o:(t=-n.moveStart("character",-o),t+=r.slice(0,t).split(`
`).length-1))),t},Action.setCaretPosition=function(e){if(isNaN(e-0)){if(e=="gd"&&(jQuery("#gdprtext").show(),Action.gdprHidden=!1),e=="av"){document.getElementById("advancedMode").value=1,Page.setFeedbackMessage("");return}if(e=="db"){document.getElementById("advancedMode").value=2,Page.setFeedbackMessage("Debug Mode");return}if(e.substr(0,4)=="clws"){e.substr(4,1)=="+"?(Page.setFeedbackMessage("Collaboration logging Enabled"),Collab.websocketLogging(0)):e.substr(4,1)=="-"?(Page.setFeedbackMessage("Collaboration logging disabled"),Collab.websocketLogging(-1)):e.substr(4,2)=="tq"?(Page.setFeedbackMessage("Ten seconds to timeout the client"),Collab.clientSetTimeout(10)):e.substr(4,2)=="tn"?(Page.setFeedbackMessage("Turn the timeout back to normal"),Collab.clientSetTimeout(-1)):e.substr(4,2)=="tx"&&(Page.setFeedbackMessage("Disabled the timeout"),Collab.clientSetTimeout(0));return}if(e=="sp"&&existSCookie("surveyCookie")==null&&window.localStorage.getItem("surveyShown")==null&&(document.getElementById("styleTip")!=null&&(document.getElementById("styleTip").innerHTML=""),window.randomSurveyRoll=1,window.surveyData.EditsBeforePrompt=1,timeSurveyUp=!1,clearTimeout(timeSurvey),timeSurvey=setTimeout(function(){timeSurveyUp=!0},1e4),displayedText=!1,displayedText||(beforeInstance=TabControl.getCurrentHistory().currentIndex,document.addEventListener("mouseover",function(){TabControl.getCurrentHistory().currentIndex-beforeInstance>=1&&!displayedText&&timeSurveyUp&&(displaySurvey(),this.removeEventListener("mouseover",arguments.callee))}))),e=="sc"){let s=new Date;s.setTime(s.getTime()-1e3),document.cookie="surveyCookie=done; expires="+s.toUTCString()+"; path=/;",window.localStorage.removeItem("surveyShown"),document.addEventListener("mouseover",function(){}),setCookieBeforeClose("off")}if(e=="tc"){Page.setFeedbackMessage("Clearing tip cookies");let s=new Date;s.setTime(s.getTime()-1e3),window.localStorage.removeItem("first_time"),document.cookie="tipCookie=done; expires="+s.toUTCString()+"; path=/;"}if(e.substr(0,2)=="cm"){e.substr(2,1)=="0"&&Page.codeMirrorOn?(Page.setFeedbackMessage("Turning code mirroring off"),Page.codeMirrorEditor.toTextArea(),Page.codeMirrorOn=!1,jQuery("#linenum").val("0")):e.substr(2,1)=="1"&&!Page.codeMirrorOn&&(Page.initCodeMirrorEditor(),jQuery("#linenum").val("0"));return}if(e.substr(0,2)=="bp"){Action.promptAndExecuteTest();return}else{Action.selectMatchingText(e)||(Page.setFeedbackMessage('Line number or word "'+e+'" not located'),setTimeout(function(){Page.setFeedbackMessage("")},3e3));return}}if(Page.codeMirrorOn){if(Page.codeMirrorEditor6.focus(),e>=1){const s=Page.codeMirrorEditor6.state.doc.line(e).from;Page.codeMirrorEditor6.dispatch({selection:{anchor:s},scrollIntoView:!0})}return}var t=document.getElementById("umpleModelEditorText"),r=0,a=-1;if(e<1)a=0;else{for(var n=Page.getRawUmpleCodeCM6(),o=0;o<n.length;o++)if(n.charAt(o)==`
`&&(e--,e==1&&(r=o+1),e==0)){a=o;break}a==-1&&(a=n.length,e!=1&&(r=a))}if(t.setSelectionRange)t.focus(),t.setSelectionRange(r,a);else if(t.createTextRange){var u=t.createTextRange();u.collapse(!0),u.moveEnd("character",a),u.moveStart("character",r),u.select()}},Action.promptAndExecuteTest=function(){var e=prompt("Umpleonline test prompt. Enter command e.g. 'ac Classname' to add a class",""),t=e.substr(2,99).strip().split(" ");if(e.substr(0,1)=="a"){if(e.substr(1,1)=="c"){if(t.length>=1){Action.directAddClass(t[0]);return}}else if(e.substr(1,1)=="a"){if(t.length>=2){Action.directAddAttribute(t[0],t[1]);return}}else Page.setFeedbackMessage("Syntax error in test add command");Page.setFeedbackMessage("Syntax error in test command")}},Action.directAddClass=function(e){var t=Json.toString({position:{x:"10",y:"10",width:"109",height:"41"},name:e});Page.setFeedbackMessage("Adding class "+e),Action.setjustUpdatetoSaveLater(!1),Action.ajax(Action.directUpdateCommandCallback,format("action=addClass&actionCode={0}",t))},Action.directAddAttribute=function(e,t){Page.setFeedbackMessage("((when written) Adding to class "+e+" attribute "+t)},Action.selectMatchingText=function(e){if(Page.codeMirrorOn){const t=new cm6.SearchCursor(Page.codeMirrorEditor6.state.doc,e);return t.next()?(Page.codeMirrorEditor6.dispatch({selection:{anchor:t.value.from,head:t.value.to}}),!0):!1}return!1},Action.selectItemCM6=function(e){if(Page.codeMirrorOn){var t=Page.codeMirrorEditor6.state.doc.toString();let a=Action.splitStates(t),n=null;for(let s=0;s<a.length;s++)if(a[s].search(e)==0){n=a[s];break}let o=0,u=0;try{o=t.indexOf(n),u=o+n.length}catch{console.log("Please wait a little more for diagram updates, and try again.")}var r={startIndex:o,endIndex:u};return r}},Action.selectMethod=function(e,t,r){var a=new RegExp(r+" "+t+" "+e+"(\\s|[(])"),n=new RegExp("(public|protected|private|class) [A-Za-z]"),o=Action.selectItemCM6(a);Action.highlightByIndexCM6(o.startIndex,o.endIndex)},Action.selectAssociation=function(e){var t=e.split(","),r=t[0],a=new RegExp("(associationClass|class|interface|trait) "+r+"($|\\s|[{])"),n=new RegExp("(class|interface|trait) [A-Za-z]");if(Page.codeMirrorOn)var o=Action.selectItemCM6(a),u=Page.codeMirrorEditor6.state.sliceDoc(o.startIndex,o.endIndex);var s,d;if(t.length>3){if(t[2].trim().includes(" ")){var c=t[2].split(" ");s=t[3].trim(),c.length==2?d=c[0].trim()+" "+t[1].trim()+" "+c[1].trim():d=c[0].trim()+" "+t[1].trim()}else s=t[3].trim(),d=t[2].trim()+" "+t[1].trim();var h=s.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),C=d.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),m=h+"(?:\\s+sorted\\s+{.*?})?(\\s*<-\\s*|\\s*><\\s*|\\s*--\\s*|\\s*->\\s*|\\s*<@>\\-\\s*|\\s*-\\<@>\\s*)"+C+"(?:\\s+sorted\\s+{.*?})?\\s*;",T=new RegExp(m,"g"),S=Page.codeMirrorEditor6.state.doc.toString(),P=u.match(T);if(P)return startIndex=S.indexOf(u)+u.indexOf(P[0]),endIndex=startIndex+P[0].length,Action.highlightByIndexCM6(startIndex,endIndex),{startIndex,endIndex};if(C.startsWith("1")){d=C.substring(2).trim(),C=d.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),m=h+"\\s+"+C+"\\s*;",T=new RegExp(m,"g"),P=u.match(T),P==null&&(m=h+"\\s+.*?"+C+"\\s*;",T=new RegExp(m,"g"),P=u.match(T));try{startIndex=S.indexOf(u)+u.indexOf(P[0]),endIndex=startIndex+P[0].length}catch{console.log("Please wait a little more for diagram updates, and try again.")}return Action.highlightByIndexCM6(startIndex,endIndex),{startIndex,endIndex}}else{if(h.trim().includes(" ")){var _=h.split(" ");h=_[0].trim()+" "+r+" "+_[1].trim()}else h+=" "+r;m=h+"(\\s*<-\\s*|\\s*><\\s*|\\s*--\\s*|\\s*->\\s*|\\s*<@>\\-\\s*|\\s*-\\<@>\\s*)"+C+"\\s*;",T=new RegExp(m,"g"),P=S.match(T),P==null&&(m=h+"\\s+.*?"+C+"\\s*;",T=new RegExp(m,"g"),P=S.match(T));try{startIndex=S.indexOf(P[0]),endIndex=startIndex+P[0].length}catch{console.log("Please wait a little more for diagram updates, and try again.")}return Action.highlightByIndexCM6(startIndex,endIndex),{startIndex,endIndex}}}else{var c=t[2].split(" ");s=c[0].trim(),d=c[1].trim();var h=s.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),C=d.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),m=h+".*?"+C+"\\s*;",T=new RegExp(m,"g"),S=Page.codeMirrorEditor6.state.doc.toString(),P=u.match(T);if(P)return startIndex=S.indexOf(u)+u.indexOf(P[0]),endIndex=startIndex+P[0].length,Action.highlightByIndexCM6(startIndex,endIndex),{startIndex,endIndex}}},Action.selectClass=function(e){var t=new RegExp("(associationClass|class|interface|trait) "+e+"($|\\s|[{])"),r=new RegExp("(class|interface|trait) [A-Za-z]"),a=Action.selectItemCM6(t);Action.highlightByIndexCM6(a.startIndex,a.endIndex)},Action.selectState=function(e){var t=new RegExp("(class|interface|trait) "+e+"($|\\s|[{])"),r=new RegExp("(class|interface|trait) [A-Za-z]"),a=Action.selectItemCM6(t);Action.highlightByIndexCM6(a.startIndex,a.endIndex)},Action.splitStates=function(e){let t=[],r="",a=0,n=!1,o=!1;for(var u in e){let s=e.charAt(u);o&&s!=`
`&&s!=" "&&(o=!1,s!="{"&&(r="")),s=="/"&&e.charAt(parseInt(u)+1)=="/"&&(n=!0),s==`
`&&n&&(n=!1),s=="{"&&!n?(r=r+s,a++):s=="}"&&!n?(r=r+s,a--,a==0&&(t.push(r.trim()),r="")):s==`
`&&a==0?(o=!0,r=r+`
`):s==" "&&a==0&&r==""||(r=r+s)}return t},Action.indexToPos=function(e,t){for(var r=0,a=0,n="",o=0;o<e;o++){let u=t.charAt(o);u==`
`?(a++,n=""):n=n+u}return r=n.length,output={line:a,ch:r},output},Action.selectStateInClassCM6=function(e,t,r){if(Page.codeMirrorOn){var a=Page.codeMirrorEditor6.state.doc.toString();let o=Action.splitStates(a),u=null,s=new RegExp("(?:class|queued)\\s+"+e,"");for(let c=0;c<o.length;c++)if(o[c].search(s)==0){u=o[c];break}o=Action.splitStates(u.substr(u.indexOf("{")+1));let d=null;for(let c=0;c<o.length;c++){let h=new RegExp("(?:queued\\s*)?"+t);if(o[c].search(h)==0){d=o[c];break}}if(o=Action.splitStates(d.substr(d.indexOf("{")+1)),o!=null){let c=o,h=null;for(let T=0;T<c.length;T++)if(c[T].search(r)==0){h=c[T];break}let C=a.indexOf(u),m=C+u.length;C=a.substr(C,m).indexOf(d)+C,m=C+d.length,C=a.substr(C,m).indexOf(h)+C,m=C+h.length;var n={startIndex:C,endIndex:C+h.length};return n}else console.log("No matching state found with regex:"+s)}else console.log("No matching class and state machine found for class: "+e+" and sm "+t);return null},Action.selectStateInStateCM6=function(e,t,r){var a=Page.codeMirrorEditor6.state.doc.toString().substr(e,t-e);let n=Action.splitStates(a.substr(a.indexOf("{")+1));var o=null;for(let c=0;c<n.length;c++)if(n[c].startsWith(r)){o=n[c];break}let u=a.indexOf(o)+e,s=u+o.length;return{startIndex:u,endIndex:s}},Action.highlightByIndex=function(e,t){Page.codeMirrorEditor.setSelection(Action.indexToPos(e,Page.codeMirrorEditor.getValue()),Action.indexToPos(t,Page.codeMirrorEditor.getValue()))},Action.highlightByIndexCM6=function(e,t){let r=Action.indexToPos(e,Page.codeMirrorEditor6.state.doc.toString()),a=Page.codeMirrorEditor6.state.doc.line(r.line+1).from,n=Action.indexToPos(t,Page.codeMirrorEditor6.state.doc.toString()),o=Page.codeMirrorEditor6.state.doc.line(n.line+2).from;Page.codeMirrorEditor6.dispatch({selection:cm6.EditorSelection.create([cm6.EditorSelection.range(o,a)]),scrollIntoView:!0})},Action.findEOL=function(e){let t="",r="",a=0,n=!1;for(var o in e){let u=e.charAt(o);if(u=="{")a++,r=r+u;else if(u=="}")a--,r=r+u;else if(u==";"&&a==0){t=r+";";break}else r=r+u}return t},Action.delayedFocus=function(e){var t=document.getElementById("umpleModelEditorText");setTimeout(function(){t.focus()},e)},Action.updateLineNumberDisplay=function(){jQuery("#linenum").val(Action.getCaretPosition())},Action.umpleTyped=function(e){clientDebuggerFlag&&console.log("Inside Action.umpleTyped()..."),Page.getAdvancedMode()=="2"&&Page.catFeedbackMessage("["+e.keyCode+"] "),Action.updateLineNumberDisplay();var t=e.keyCode;if(!(t>=33&&t<=40)){var r=e.target.id;Action.umpleTypingActivity(r)}},Action.umpleCodeMirrorCursorActivity=function(){var e=Page.codeMirrorEditor6.state.selection.main.head,t=Page.codeMirrorEditor6.state.doc.lineAt(e);jQuery("#linenum").val(t.number)},Action.umpleCodeMirrorTypingActivity=function(e){clientDebuggerFlag&&console.log("Inside Action.umpleCodeMirrorTypingActivity..."),Action.freshLoad==!1?(Action.umpleTypingActivity(e),e=="codeMirrorEditor"&&Page.codeMirrorEditor.save()):(Action.freshLoad=!1,Action.setjustUpdatetoSaveLaterForTextCallback(!1))},Action.trimMultipleNonPrintingAndComments=function(e){return e=Action.removeComments(e),e=e.replace(/[^\x21-\x7E]+/g," "),e=e.replace(/^\s+|\s+$/g,""),e},Action.removeComments=function(e){var t="_"+ +new Date,r=[],a=0;return e.replace(/(['"])(\\\1|.)+?\1/g,function(n){return r[a]=n,t+""+a++}).replace(/([^\/])(\/(?!\*|\/)(\\\/|.)+?\/[gim]{0,3})/g,function(n,o,u){return r[a]=u,o+(t+"")+a++}).replace(/\/\/.*?\/?\*.+?(?=\n|\r|$)|\/\*[\s\S]*?\/\/[\s\S]*?\*\//g," ").replace(/\/\/.+?(?=\n|\r|$)|\/\*[\s\S]+?\*\//g," ").replace(RegExp("\\/\\*[\\s\\S]+"+t+"\\d+","g")," ").replace(RegExp(t+"(\\d+)","g"),function(n,o){return r[o]})},Action.umpleTypingActivity=function(e){clientDebuggerFlag&&console.log("Inside Action.umpleTypingActivity()..."),Action.manualSync&&Action.diagramInSync&&(jQuery("#umpleCanvasColumn").is(":visible")&&Page.enablePaletteItem("buttonSyncDiagram",!0),Action.diagramInSync=!1,Page.enableDiagram(!1)),Action.oldTimeout!=null&&clearTimeout(Action.oldTimeout),e=="diagramEdit"?Action.oldTimeout=setTimeout('Action.processTyping("'+e+'",false)',500):Action.oldTimeout=setTimeout('Action.processTyping("'+e+'",false)',Action.waiting_time)};var checkComplexityCooldown=3e5,checkComplexityLastUsage=0,checkComplexityFeedbackMessage='Suggestion: Since there are so many classes, <a href="javascript:Page.clickShowGvClassDiagram()">switch to automated layout</a> (G).',checkComplexityDisplayTime=12e4;Action.checkComplexity=function(){if(!(Date.now()-checkComplexityCooldown<checkComplexityLastUsage)){var e=jQuery("#newEditor").val(),t=e.match(/class( |\n)((.|\n)*?){/g);if(t!=null){var r=t.length;r>10&&(Page.setFeedbackMessage(checkComplexityFeedbackMessage),checkComplexityLastUsage=Date.now(),setTimeout(Action.removeCheckComplexityWarning,checkComplexityDisplayTime))}}},Action.removeCheckComplexityWarning=function(){Page.getFeedbackMessage()==checkComplexityFeedbackMessage&&Page.setFeedbackMessage("")},Action.processTyping=function(e,t,r){if(clientDebuggerFlag&&console.log("Inside Action.processTyping ...",e),document.getElementById("newEditor").value=Page.codeMirrorEditor6.state.doc.toString(),e!="diagramEdit"?Action.setjustUpdatetoSaveLaterForTextCallback(!0):Action.setjustUpdatetoSaveLaterForTextCallback(!1),!Action.manualSync||t)if(Action.diagramInSync=!0,e=="umpleModelEditorText"||e=="codeMirrorEditor"||e=="newEditor"){Action.updateLayoutEditorAndDiagram(e);var a=document.getElementById("downloadLink");a!==null&&a.remove(),Page.enablePaletteItem("buttonSyncDiagram",!1)}else e=="diagramEdit"&&Action.ajax(Action.updateFromDiagramCallback,Action.getLanguage());e!="diagramEdit"&&(justUpdatetoSaveLater?(e=="umpleModelEditorText"||e=="codeMirrorEditor"||e=="newEditor")&&Action.setjustUpdatetoSaveLater(!1):TabControl.getCurrentHistory().save(Page.getUmpleCode(),"processTyping"),Page.setExampleMessage("")),setTimeout(Action.checkComplexity,1e4)},Action.updateCurrentUmpleTextBeingEdited=function(e){Page.currentUmpleTextBeingEdited=e,jQuery("#umpleModelEditorText").val(e),Page.setCodeMirror6Text(e)},Action.updateLayoutEditorAndDiagram=function(e){Action.ajax(Action.updateUmpleLayoutEditor,"language=Json",e)},Action.updateUmpleLayoutEditor=function(e){var t=e.responseText.split("URL_SPLIT"),r=t[0],a=t[1];(a==null||a==null)&&(a=e.responseText),Page.showLayoutLoading(),Action.ajax(Action.updateUmpleLayoutEditorCallback,format("action=addPositioning&actionCode={0}",a))},Action.updateUmpleLayoutEditorCallback=function(e){var t=e.responseText,r=Page.splitUmpleCode(t)[1];Page.setUmplePositioningCode(r),Page.hideLoading(),Action.updateUmpleDiagramForce(!0)},Action.updateUmpleDiagram=function(){return Action.updateUmpleDiagramForce(!0)},Action.updateUmpleDiagramForce=function(e){var t=Action.trimMultipleNonPrintingAndComments(Page.getUmpleCode());!e&&t==Action.savedCanonical||(Action.savedCanonical=t,Page.showCanvasLoading(),Action.ajax(Action.updateUmpleDiagramCallback,Action.getLanguage()))},Action.updateUmpleDiagramCallback=function(response){var diagramCode="",errorMessage="";if(diagramCode=Action.getDiagramCode(response.responseText),errorMessage=Action.getErrorCode(response.responseText),Page.hideExecutionArea(),diagramCode==null||diagramCode==""||diagramCode=="null")Page.enableDiagram(!1),Action.diagramInSync=!1,Page.setFeedbackMessage('<a href="#errorClick">See message.</a> To fix: edit model or click undo');else if(Page.enableDiagram(!0),Action.diagramInSync||(Action.diagramInSync=!0),Page.setFeedbackMessage(""),Page.hideGeneratedCode(),Page.useEditableClassDiagram){var newSystem=Json.toObject(diagramCode);UmpleSystem.merge(newSystem),UmpleSystem.update(),Page.readOnly&&jQuery("span.editable").addClass("uneditable")}else if(Page.useJointJSClassDiagram){var model=JSON.parse(diagramCode.replace(new RegExp('} { "name": "',"gi"),'}, { "name": "')),umpleCanvas=jQuery("#umpleCanvas"),paper=JJSdiagram.initJJSDiagram(umpleCanvas,model),MouseWheelHandler=function(e){var t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));if(e.altKey===!0){var r=paper.options.height,a=paper.options.width,n=1+Math.abs(t)/(t*10);paper.setDimensions(a*n,r*n),JJSdiagram.paper&&JJSdiagram.paper.setDimensions(jQuery("#umpleCanvas")[0].clientWidth,jQuery("#umpleCanvas")[0].clientHeight)}},paperHolder=document.getElementById("umpleCanvas");paperHolder.addEventListener?(paperHolder.addEventListener("mousewheel",MouseWheelHandler,!1),paperHolder.addEventListener("DOMMouseScroll",MouseWheelHandler,!1)):paperHolder.attachEvent("onmousewheel",MouseWheelHandler),jQuery("#jjsPaper").click(function(){Action.focusOn(Page.umpleCanvasId(),!0)})}else Page.useGvClassDiagram||Page.useGvStateDiagram||Page.useGvFeatureDiagram?(jQuery("#umpleCanvas").html(format("{0}",diagramCode)),jQuery("#umpleCanvas").children().first().attr("id","svgCanvas"),Action.setupPinch()):Page.useStructureDiagram&&(jQuery("#umpleCanvas").html('<svg id="svgCanvas"></svg>'),eval(diagramCode));if(errorMessage!=""&&Page.showGeneratedCode(errorMessage,"diagramUpdate"),Page.hideLoading(),Page.useGvClassDiagram){var elems=document.getElementsByClassName("node");for(let e=0;e<elems.length;e++){elems[e].addEventListener("contextmenu",function(t){t.preventDefault(),Action.displayMenu(t)}),elems[e].addEventListener("dblclick",function(t){t.preventDefault(),Action.displayMenu(t)});var attributeAnchors=elems[e].getElementsByTagName("a");for(let t=1;t<attributeAnchors.length;t++){let r=attributeAnchors[t].getAttribute("xlink:title"),[a,n]=r.split(" ");attributeAnchors[t].addEventListener("dblclick",function(o){o.preventDefault(),Action.displayAttributeMenu(o,n,a)}),attributeAnchors[t].addEventListener("contextmenu",function(o){o.preventDefault(),o.stopPropagation(),Action.displayAttributeMenu(o,n,a)})}}var associationElems=document.getElementsByClassName("edge");for(let e=0;e<associationElems.length;e++){var associationAnchors=associationElems[e].getElementsByTagName("a");for(let t=0;t<associationAnchors.length;t++){let r=associationAnchors[t].getAttribute("xlink:href");associationAnchors[t].addEventListener("dblclick",function(a){a.preventDefault(),Action.displayAssociMenu(a,r)}),associationAnchors[t].addEventListener("contextmenu",function(a){a.preventDefault(),Action.displayAssociMenu(a,r)})}}}if(Page.useGvStateDiagram){var elems=document.getElementsByClassName("node");for(let t=0;t<elems.length;t++)elems[t].addEventListener("contextmenu",function(r){r.preventDefault(),Action.drawStateMenu(r)}),elems[t].addEventListener("dblclick",function(r){r.preventDefault(),Action.drawStateMenu(r)});elems=document.getElementsByClassName("cluster");for(let t=0;t<elems.length;t++)elems[t].addEventListener("contextmenu",function(r){r.preventDefault(),Action.drawStateMenu(r)}),elems[t].addEventListener("dblclick",function(r){r.preventDefault(),Action.drawStateMenu(r)});var transitionElems=document.getElementsByClassName("edge");for(let t=0;t<transitionElems.length;t++)transitionElems[t].addEventListener("dblclick",function(r){r.preventDefault(),Action.displayTransitionMenu(r)}),transitionElems[t].addEventListener("contextmenu",function(r){r.preventDefault(),Action.displayTransitionMenu(r)})}},Action.updateFromDiagramCallback=function(e){var t="",r="";t=Action.getDiagramCode(e.responseText),r=Action.getErrorCode(e.responseText),(t==null||t==""||t=="null")&&Action.diagramInSync?(Page.enableDiagram(!1),Action.diagramInSync=!1,Page.setFeedbackMessage('<a href="#errorClick">See message.</a> To fix: edit model or click undo')):(Page.enableDiagram(!0),Action.diagramInSync=!0),r!=""&&Page.showGeneratedCode(r,"diagramUpdate")},Action.getDiagramCode=function(e){var t="";if(Page.useEditableClassDiagram||Page.useJointJSClassDiagram)t=e.split("URL_SPLIT")[1],t=="null"&&(t="");else if(Page.useGvClassDiagram||Page.useGvStateDiagram||Page.useGvFeatureDiagram){var r=e.split("<svg width=");r.length>1&&r[1].length>100&&(t="<svg width="+r[1],t=t.replace(/<\/svg>$/,""))}else Page.useStructureDiagram&&(t=e.split("<p>URL_SPLIT")[1],t=t.replace(/##CANVAS_ID##/g,"svgCanvas"),t=jQuery("<div/>").html(t).text());return t},Action.getErrorCode=function(e){var t="";if(Page.useEditableClassDiagram||Page.useStructureDiagram)t=e.split("URL_SPLIT")[0],t=="<p>"&&(t="");else if(Page.useGvClassDiagram||Page.useGvStateDiagram||Page.useGvFeatureDiagram){var r=e.split("<svg width=")[0],a=r.split("errorRow");a.length>1&&(t=r.split("<\/script>&nbsp;")[0])}return t},Action.classResizing=function(e,t){var r=e.target.id,a=UmpleSystem.find(r),n="#"+r,o=Math.round(jQuery(n).width()),u=Math.round(jQuery(n).height());UmpleSystem.updatingSize(a,o,u)},Action.associationSnap=function(e,t,r){var a=jQuery(r).prop("id"),n=a.substr(0,a.lastIndexOf("_")),o=a.substr(a.lastIndexOf("_")+6+1),u=UmpleSystem.findAssociation(n),s=u.getClass(o),d=UmpleClassFactory.perimeterPosition(s,new UmplePosition(e,t,0,0),UmpleSystem.position());return[d.x,d.y]},Action.associationSnapClassReady=function(e,t,r){var a=UmpleClassFactory.perimeterPosition(r,new UmplePosition(e,t,0,0),UmpleSystem.position());return[a.x,a.y]},Action.updateMovedAssociation=function(e,t){jQuery(e).show();var r=jQuery(e).offset(),a=jQuery(e).prop("id");jQuery(e).hide();var n=Math.round(r.left),o=Math.round(r.top),u=Action.associationSnap(n,o,e),s=new UmplePosition(u[0],u[1],0,0);a.endsWith("_anchor0")?t.setOffsetOnePosition(s):t.setOffsetTwoPosition(s),UmpleSystem.redrawAssociation(t),Action.associationSelected(null)},Action.validateAttributeName=function(e){return e.length!=0&&(e.match(/^[_a-zA-Z0-9]+$/)||e.match(/^[_a-zA-Z0-9]+[\u0020]*:[\u0020]*[_a-zA-Z0-9]+(\[\])?$/))},Action.validateMethodName=function(e){return e.length!=0&&e.match(/^[-+#]?\s*[_a-zA-Z0-9]+\s*\(([_a-zA-Z0-9]+(\[\])?(,\s*[_a-zA-Z0-9]+(\[\])?)*)?\)(\s*:\s*[_a-zA-Z0-9]+(\[\])?)?$/)},Action.toggleAttributes=function(){Page.showAttributes=!Page.showAttributes,Action.redrawDiagram()},Action.toggleMethods=function(){Page.showMethods=!Page.showMethods,Action.redrawDiagram()},Action.toggleActions=function(){Page.showActions=!Page.showActions,Action.redrawDiagram()},Action.toggleTransitionLabels=function(){Page.showTransitionLabels=!Page.showTransitionLabels,Action.redrawDiagram()},Action.toggleGuards=function(){Page.showGuards=!Page.showGuards,Action.redrawDiagram()},Action.toggleGuardLabels=function(){Page.showGuardLabels=!Page.showGuardLabels,Action.redrawDiagram()},Action.allowPinch=function(){Page.allowPinch=!Page.allowPinch,Action.redrawDiagram()},Action.toggleFeatureDependency=function(){Page.showFeatureDependency=!Page.showFeatureDependency,Action.redrawDiagram()},Action.toggleTraits=function(){Page.showTraits=!Page.showTraits,Action.redrawDiagram()},Action.redrawDiagram=function(){UmpleSystem.merge(null);var e=jQuery("#umpleCanvas");e.html(""),Action.manualSync||(Action.updateUmpleDiagram(),Action.diagramInSync=!0),Action.manualSync&&!Action.diagramInSync&&Page.enablePaletteItem("buttonSyncDiagram",!0),(!Action.manualSync||Action.diagramInSync)&&(Page.enableCheckBoxItem("buttonPhotoReady","ttPhotoReady",!0),Page.enableCheckBoxItem("buttonManualSync","ttManualSync",!0),Page.enablePaletteItem("buttonAddClass",!0),Page.enablePaletteItem("buttonAddAssociation",!0),Page.enablePaletteItem("buttonAddTransition",!0),Page.enablePaletteItem("buttonAddGeneralization",!0),Page.enablePaletteItem("buttonDeleteEntity",!0),Page.initToggleTool("buttonAddClass"),Page.initToggleTool("buttonAddAssociation"),Page.initToggleTool("buttonAddTransition"),Page.initToggleTool("buttonAddGeneralization"),Page.initToggleTool("buttonDeleteEntity"))},InlineEditor.elementChanged=function(e,t,r){var a=e.attr("name"),n=e.attr("id");if(a=="className"){var o=n.substr(0,n.length-5);DiagramEdit.classNameChanged(o,t,r)}else if(a=="attributeEdit"){var u=n.substr(n.lastIndexOf("_")+1),o=n.substr(0,n.length-11-u.length);DiagramEdit.attributeNameChanged(o,u,t,r)}else if(a=="methodEdit"){var u=n.substr(n.lastIndexOf("_")+1),o=n.substr(0,n.length-8-u.length);DiagramEdit.methodChanged(o,u,t,r)}else if(a=="attributeNew"){var o=n.substr(0,n.length-13);DiagramEdit.attributeNew(o,r)}else if(a=="methodNew"){var o=n.substr(0,n.length-10);DiagramEdit.methodNew(o,r)}},Action.enableManualSync=function(e){var t=jQuery("#buttonManualSync"),r=jQuery("#buttonSyncDiagram");e==null&&(e=t.is(":checked")),e?Action.manualSync=!0:(Action.manualSync=!1,Action.processTyping("umpleModelEditorText",!0),Page.enablePaletteItem("buttonSyncDiagram",!1))},Action.generateStructureDiagramFile=function(){var e=Page.getFilename().slice(0,-9)+"structureDiagram.svg",t=jQuery("#innerGeneratedCodeRow").html().slice(4,-1);t=format('<svg xmlns="http://www.w3.org/2000/svg" {0}>',t),jQuery("#buttonStructureLink").showLoading(),Ajax.sendRequest("scripts/compiler.php",Action.generateStructureDiagramFileCallback,format("save=1&filename={0}&svgContent={1}",e,t))},Action.generateStructureDiagramFileCallback=function(e){jQuery("#buttonStructureLink").hideLoading(),Page.toggleStructureDiagramLink(!0,e.responseText)},Action.ajax=function(e,t,r,d,n){var o=null;o=Page.getUmpleCode();var u=encodeURIComponent(o),s=Page.getFilename(),d="true";TabControl.useActiveTabTo(TabControl.saveTab)(u),t=t+"&theme="+Action.getThemePreference();var c=TabControl.getActiveTabId(),h=n?e:function(C){var m=TabControl.getActiveTabId();if(m!==c){Page.hideLoading();return}e(C)};Ajax.sendRequest("scripts/compiler.php",h,format("{0}&error={3}&umpleCode={1}&filename={2}",t,u,s,d))},navigator.appVersion.indexOf("Mac")!=-1?(jQuery(document).ready(function(){jQuery("#undosmall").html("[cmd+z]"),jQuery("#redosmall").html("[cmd+shift+z]")}),Mousetrap.bind(["command+z"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Action.undo(),e.preventDefault()}),Mousetrap.bind(["command+shift+z"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Action.redo(),e.preventDefault()})):(jQuery(document).ready(function(){jQuery("#undosmall").html("[ctrl+z]"),jQuery("#redosmall").html("[ctrl+y]")}),Mousetrap.bind(["ctrl+z"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Action.undo(),e.preventDefault()}),Mousetrap.bind(["ctrl+y"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Action.redo(),e.preventDefault()})),Mousetrap.bind(["up"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(0,-5,0,0)),!1}),Mousetrap.bind(["shift+up"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(0,-1,0,0)),!1}),Mousetrap.bind(["down"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(0,5,0,0)),!1}),Mousetrap.bind(["shift+down"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(0,1,0,0)),!1}),Mousetrap.bind(["left"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(-5,0,0,0)),!1}),Mousetrap.bind(["shift+left"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(-1,0,0,0)),!1}),Mousetrap.bind(["right"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(5,0,0,0)),!1}),Mousetrap.bind(["shift+right"],function(e){if(jQuery("#umpleCanvasColumn").hasClass("focus"))return Action.moveSelectedClass(Page.selectedClass,new UmplePosition(1,0,0,0)),!1}),Mousetrap.bind(["ctrl+e"],function(e){return Page.clickShowEditableClassDiagram(),!1}),Mousetrap.bind(["ctrl+j"],function(e){return Page.clickShowJointJSClassDiagram(),!1}),Mousetrap.bind(["ctrl+g"],function(e){return Page.clickShowGvClassDiagram(),!1}),Mousetrap.bind(["ctrl+s"],function(e){return Page.clickShowGvStateDiagram(),!1}),Mousetrap.bind(["ctrl+l"],function(e){return Page.clickShowStructureDiagram(),!1}),Mousetrap.bind(["ctrl+t","ctrl+alt+shift+t"],function(e){return Page.clickShowHideText(),!1}),Mousetrap.bind(["ctrl+d"],function(e){return Page.clickShowHideCanvas(),!1}),Mousetrap.bind(["ctrl+n","ctrl+alt+n"],function(e){return Page.clickShowHideMenu(),!1}),Mousetrap.bind(["shift+ctrl+a"],function(e){return Page.clickToggleAttributes(),!1}),Mousetrap.bind(["ctrl+m"],function(e){return Page.clickToggleMethods(),!1}),Mousetrap.bind(["ctrl+r"],function(e){return Page.clickToggleTraits(),!1}),Mousetrap.bind(["ctrl+i"],function(e){return Page.clickToggleTransitionLabels(),!1}),Mousetrap.bind(["ctrl+k"],function(e){return Page.clickToggleGuardLabels(),!1}),Mousetrap.bind(["ctrl+b"],function(e){return Action.promptAndExecuteTest(),!1}),Mousetrap.bind(["ctrl+o"],function(e){return Action.copyCommandLineCode(),!1}),Mousetrap.bind(["g"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Page.selectedAssociation==null&&Page.selectedGeneralization==null&&(Page.selectedClass==null||Page.selectedClass&&jQuery("#"+Page.selectedClass.id).find("input").length==0)&&jQuery("#buttonAddGeneralization").click()}),Mousetrap.bind(["a"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Page.selectedAssociation==null&&Page.selectedGeneralization==null&&(Page.selectedClass==null||Page.selectedClass&&jQuery("#"+Page.selectedClass.id).find("input").length==0)&&jQuery("#buttonAddAssociation").click()}),Mousetrap.bind(["c"],function(e){jQuery("#umpleCanvasColumn").hasClass("focus")&&Page.selectedAssociation==null&&Page.selectedGeneralization==null&&(Page.selectedClass==null||Page.selectedClass&&jQuery("#"+Page.selectedClass.id).find("input").length==0)&&jQuery("#buttonAddClass").click()}),Action.toggleTabsCheckbox=function(e){$("inputGenerateCode").value.split(":")[1]=="TextUml"&&(e="TextUml"),e=="java"||e=="php"||e=="cpp"||e=="python"||e=="ruby"||e=="sql"?(jQuery("#ttTabsCheckbox").show(),jQuery("#tabRow").show(),($("inputGenerateCode").value.split(":")[1]=="USE"||$("inputGenerateCode").value.split(":")[1]=="UmpleSelf"||$("inputGenerateCode").value.split(":")[1]=="Json")&&(jQuery("#ttTabsCheckbox").hide(),jQuery("#tabRow").hide())):(jQuery("#ttTabsCheckbox").hide(),jQuery("#tabRow").hide(),jQuery("#buttonTabsCheckbox").is(":checked")&&jQuery("#buttonTabsCheckbox").click())},Action.toggleTabs=function(){jQuery("#buttonTabsCheckbox").is(":checked")?(jQuery("#tabRow").show(),jQuery("#innerGeneratedCodeRow").hide(),jQuery("#tabButton1").click()):(jQuery("#tabRow").hide(),jQuery("#innerGeneratedCodeRow").show(),jQuery("#innerGeneratedCodeRow").nextAll().hide())},Action.generateTabsCode=function(e){var t=[],r=0,a="",n=[],o="",u=!1;for(e.split("URL_SPLIT")[1].split(`
`).forEach(function(s){s.indexOf("//%%")>=0||s.indexOf("# %%")>=0?(r++,strFileName=s.slice(14),strFileName=strFileName.substr(0,strFileName.indexOf(" ")),n[r]=strFileName,jQuery("#generatedCodeRow").append("<div id='innerGeneratedCodeRow"+r+"'></div>"),t[r]="",u=!0):u?u=!1:t[r]+=s+`
`}),i=1;i<=r;i++)jQuery("#tabRow").append("<button type='button' id='tabButton"+i+"'>"+n[i]+"</button>"),jQuery("#tabButton"+i).click({code:t[i],tabnumber:i},showTab)},Action.getLanguage=function(){var e="";return Page.useEditableClassDiagram?e="language=Json":Page.useJointJSClassDiagram?e="language=JsonMixed":Page.useGvClassDiagram?Page.showTraits?e="language=traitDiagram":e="language=classDiagram":Page.useGvStateDiagram?e="language=stateDiagram":Page.useStructureDiagram&&(e="language=StructureDiagram"),Page.useGvStateDiagram&&(Page.showActions||(e=e+".hideactions"),Page.showTransitionLabels&&(e=e+".showtransitionlabels"),Page.showGuards||(e=e+".hideguards"),Page.showGuardLabels&&(e=e+".showguardlabels"),e=e+"."+$("inputGenerateCode").value.split(":")[1]),Page.useGvClassDiagram&&(Page.showMethods&&(e=e+".showmethods"),Page.showAttributes||(e=e+".hideattributes")),Page.useGvFeatureDiagram&&(e="language=featureDiagram",Page.showFeatureDependency&&(e=e+".showFeatureDependency")),e};function showTab(e){jQuery("#innerGeneratedCodeRow").nextAll().hide(),jQuery("#innerGeneratedCodeRow"+e.data.tabnumber).show(),Page.showGeneratedCode(e.data.code,$("inputGenerateCode").value.split(":")[0],e.data.tabnumber),jQuery("#innerGeneratedCodeRow").hide()}Action.hidegdpr=function(){jQuery("#gdprtext").hide(),Action.gdprHidden=!0},Action.reindent=function(e,t){for(var r="",a="",n=e.length,o=!1,u=!0,s=0,d=-1,c=0;c<n;c++){for(var h=e[c].trim(),C=h.indexOf('"'),m=h.indexOf('"',C+1);C!=-1&&m!=-1;)h=h.slice(0,C)+h.slice(m+1,h.length),C=h.indexOf('"'),m=h.indexOf('"',C+1);if(h.indexOf("//")!=-1&&(h=h.substr(0,h.indexOf("//")).trim()),o)if(h.indexOf("*/")!=-1)h=h.substr(h.indexOf("*/")+2).trim(),o=!1;else{c!=e.length-1?a+=e[c]+`
`:a+=e[c];continue}else h.indexOf("/*")!=-1&&(h.indexOf("*/")==-1?(o=!0,h=h.substr(0,h.indexOf("/*")).trim()):h=h.substr(0,h.indexOf("/*"))+h.substr(h.indexOf("*/")+2).trim());var T=h.indexOf("{"),S=h.indexOf("}"),P=h.indexOf(";");if(P!=-1&&P!=h.length-1&&h.substr(P+1).trim().charAt(0)!="}"){e.splice(c+1,0,h.substr(P+1)),c<=t.line&&t.line++,e[c]=e[c].substr(0,e[c].match(/^\s*/)[0].length+P+1),Action.reindent(e,t);return}var _=T!=-1&&S!=-1&&S-T<40&&h.substr(0,S).indexOf("{",T+1)==-1;if(_){if(S!=h.length-1){e.splice(c+1,0,h.substr(S+1)),c<=t.line&&t.line++,e[c]=e[c].substr(0,e[c].match(/^\s*/)[0].length+S+1),Action.reindent(e,t);return}u?e[c]=r+e[c].trim():h.slice(-1)=="{"?u=!0:(e[c]=r+e[c].match(/^\s*/)[0].substr(s)+e[c].trim(),h.indexOf(";")==h.length-1&&(u=!0))}else{if(T!=-1&&T!=h.length-1){e.splice(c+1,0,h.substr(T+1)),e[c]=e[c].substr(0,e[c].match(/^\s*/)[0].length+T+1),c<=t.line&&t.line++,Action.reindent(e,t);return}if(S!=-1&&h.length>1){S==0?(e.splice(c+1,0,h.substr(1)),e[c]="}",c<=t.line&&t.line++):(e.splice(c+1,0,"}"),c<=t.line&&t.line++,S!=h.length-1&&(e.splice(c+2,0,h.substr(S+1)),c<=t.line&&t.line++),e[c]=e[c].substr(0,e[c].match(/^\s*/)[0].length+S)),Action.reindent(e,t);return}u&&h.indexOf(";")!=h.length-1&&h.slice(-1)!="{"&&h.slice(-1)!="}"&&h.slice(-2)!="||"&&(u=!1,s=e[c].match(/^\s*/)[0].length),S!=-1&&(r=r.substr(2)),u?e[c]=r+e[c].trim():h.slice(-1)=="{"||h.slice(-2)=="||"&&h.slice(-1)=="}"?(u=!0,e[c]=r+e[c].trim()):(e[c]=r+e[c].match(/^\s*/)[0].substr(s)+e[c].trim(),h.indexOf(";")==h.length-1&&(u=!0)),T!=-1&&(r+="  ")}c!=e.length-1?a+=e[c]+`
`:a+=e[c]}Page.codeMirrorOn&&Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:a}}),Action.updateCurrentUmpleTextBeingEdited(a);var F=Page.getRawUmpleCodeCM6().split(`
`)[Page.codeMirrorEditor6.state.doc.lineAt(Page.codeMirrorEditor6.state.selection.main.head).number],g=F.match(/^\s*/)[0].length;if(t.ch>=F.trim().length)Page.codeMirrorEditor6.dispatch({selection:{anchor:t.line,head:F.trim().length+g}});else if(t.ch>=0)Page.codeMirrorEditor6.dispatch({selection:{anchor:t.line,head:t.ch+g}});else{const b=Page.codeMirrorEditor6.state.selection.main.head;Page.codeMirrorEditor6.dispatch({selection:{anchor:b,head:b}})}Page.codeMirrorEditor6.focus()},DiagramEdit=new Object,DiagramEdit.textChangeQueue=[],DiagramEdit.pendingChanges=!1,DiagramEdit.newClass=null,DiagramEdit.newAssociation=null,DiagramEdit.newTransition=null,DiagramEdit.newGeneralization=null,DiagramEdit.updateUmpleText=function(e){DiagramEdit.textChangeQueue.length==0&&!DiagramEdit.pendingChanges?(DiagramEdit.pendingChanges=!0,DiagramEdit.textChangeQueue.push(e),DiagramEdit.doTextUpdate()):DiagramEdit.textChangeQueue.push(e),Action.umpleTypingActivity("diagramEdit")},DiagramEdit.doTextUpdate=function(){update=DiagramEdit.textChangeQueue.shift(),Action.update=update,update.codeChange&&Page.hideGeneratedCode(),Action.ajax(Action.updateUmpleTextCallback,update.actionCode)},DiagramEdit.addClass=function(e){Action.setjustUpdatetoSaveLater(!1),DiagramEdit.removeNewClass();var t=UmpleSystem.createClass(e),r=Json.toString(t);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=addClass&actionCode={0}",r),codeChange:!0})},DiagramEdit.addAssociation=function(e){Action.setjustUpdatetoSaveLater(!1),DiagramEdit.removeNewAssociation();var t=UmpleSystem.createAssociation(e.classOneId,e.classTwoId,e.classOnePosition.add(UmpleSystem.position()),e.classTwoPosition.add(UmpleSystem.position())),r=Json.toString(t);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=addAssociation&actionCode={0}",r),codeChange:!0})},DiagramEdit.addTransition=function(e){Action.setjustUpdatetoSaveLater(!1),DiagramEdit.removeNewTransition();var t=UmpleSystem.createTransition(e.fromStateId,e.toStateId),r=Json.toString(t);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=addTransition&actionCode={0}",r),codeChange:!0})},DiagramEdit.addGeneralization=function(e){Action.setjustUpdatetoSaveLater(!1),DiagramEdit.removeNewGeneralization(),UmpleSystem.createGeneralization(e.childId,e.parentId);var t=Json.toString(e);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=addGeneralization&actionCode={0}",t),codeChange:!0})},DiagramEdit.createAssociationPartOne=function(e){var t=new UmplePosition(e.pageX,e.pageY,0,0),r=UmpleSystem.position(),a=t.x-r.x,n=t.y-r.y;Action.classSelected(e.currentTarget),DiagramEdit.newAssociation=new UmpleAssociation,DiagramEdit.newAssociation.classOneId=e.currentTarget.id,DiagramEdit.newAssociation.classOnePosition=new UmplePosition(a,n,0,0)},DiagramEdit.createAssociationPartTwo=function(e){var t=new UmplePosition(e.pageX,e.pageY,0,0);Action.classSelected(e.currentTarget),DiagramEdit.newAssociation.classOneId<=e.currentTarget.id?(DiagramEdit.newAssociation.classTwoId=e.currentTarget.id,DiagramEdit.newAssociation.classTwoPosition=t.subtract(UmpleSystem.position())):(DiagramEdit.newAssociation.classTwoId=DiagramEdit.newAssociation.classOneId,DiagramEdit.newAssociation.classTwoPosition=DiagramEdit.newAssociation.classOnePosition,DiagramEdit.newAssociation.classOneId=e.currentTarget.id,DiagramEdit.newAssociation.classOnePosition=t.subtract(UmpleSystem.position())),DiagramEdit.addAssociation(DiagramEdit.newAssociation)},DiagramEdit.createTransitionPartOne=function(e){var t=new UmplePosition(e.pageX,e.pageY,0,0),r=UmpleSystem.position(),a=t.x-r.x,n=t.y-r.y;Action.classSelected(e.currentTarget),DiagramEdit.newTransition=new UmpleTransition,DiagramEdit.newTransition.fromStatePosition=e.currentTarget.id,DiagramEdit.newTransition.toStatePosition=new UmplePosition(a,n,0,0),DiagramEdit.newTransition.eventName="event1"},DiagramEdit.createTransitionPartTwo=function(e){var t=new UmplePosition(e.pageX,e.pageY,0,0);Action.classSelected(e.currentTarget),DiagramEdit.newTransition.toStateId=e.currentTarget.id,DiagramEdit.newTransition.toStatePosition=t.subtract(UmpleSystem.position()),DiagramEdit.addTransition(DiagramEdit.newTransition)},DiagramEdit.createGeneralizationPartOne=function(e){var t=UmpleSystem.find(e.currentTarget.id);if(t.extendsClass!=null)return!1;Action.classSelected(e.currentTarget),DiagramEdit.newGeneralization=new UmpleGeneralization,DiagramEdit.newGeneralization.childId=e.currentTarget.id,umpleSystem=UmpleSystem.position(),childPositionX=Dom.x(e)-umpleSystem.x,childPositionY=Dom.y(e)-umpleSystem.y,DiagramEdit.newGeneralization.childPosition=new UmplePosition(childPositionX,childPositionY,0,0)},DiagramEdit.createGeneralizationPartTwo=function(e){Action.classSelected(e.currentTarget),DiagramEdit.newGeneralization.parentId=e.currentTarget.id,DiagramEdit.newGeneralization.parentPosition=new UmplePosition(Dom.x(e),Dom.y(e),0,0),DiagramEdit.addGeneralization(DiagramEdit.newGeneralization)},DiagramEdit.classMoved=function(e){Action.setjustUpdatetoSaveLater(!1);var t=UmpleSystem.find(e.id),r=jQuery("#"+t.id);newPositionX=Math.floor(r.offset().left),newPositionY=Math.floor(r.offset().top),UmpleSystem.updatePosition(t,newPositionX,newPositionY);var a=Json.toString(t),n=Page.getUmpleCode();Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",a),codeChange:!1}),Action.classSelected(e),UmpleSystem.trimOverlappingAssociations(t)},DiagramEdit.classResized=function(e,t){Action.setjustUpdatetoSaveLater(!1);var r=e.target,a=r.id,n=UmpleSystem.find(a);UmpleSystem.updateClass(n),UmpleSystem.redrawGeneralizationsTo(n,C);for(var o=0;o<UmpleSystem.umpleAssociations.length;o++){var u=UmpleSystem.umpleAssociations[o];if(u.contains(n)){var s=u.classOneId==n.id,d=s?u.offsetOnePosition:u.offsetTwoPosition,c=s?"_anchor0":"_anchor1",h="#"+u.id+c,C=!0;DiagramEdit.associationMoved(h,C)}}var m=Json.toString(n),T=Page.getUmpleCode();Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",m),codeChange:!1}),Action.classSelected(r)},DiagramEdit.associationMoved=function(e,t){Action.setjustUpdatetoSaveLater(!1),DiagramEdit.newAssociation!=null&&DiagramEdit.removeNewAssociation(),t==null&&(t=!1);var r=jQuery(e).attr("id"),a=r.substr(0,r.length-8),n=UmpleSystem.findAssociation(a);Action.updateMovedAssociation(e,n);var o=Json.toString(n);Page.showLayoutLoading(),DiagramEdit.updateUmpleText({codeChange:!1,actionCode:format("action=editAssociation&actionCode={0}",o)})},DiagramEdit.regularAssociationMoving=function(e){if(DiagramEdit.newAssociation==null){var t=jQuery(e).attr("id"),r=t.substr(0,t.length-8),a=UmpleSystem.findAssociation(r),n=new UmpleAssociation;t.endsWith("_anchor0")?(n.classOneId=a.classTwoId,n.classOnePosition=a.classTwoPosition,n.offsetOnePosition=a.offsetTwoPosition):(n.classOneId=a.classOneId,n.classOnePosition=a.classOnePosition,n.offsetOnePosition=a.offsetOnePosition),DiagramEdit.newAssociation=n}var o=jQuery(e).offset(),u=Action.associationSnap(Math.round(o.left),Math.round(o.top),e),s=new UmplePosition(u[0],u[1]);DiagramEdit.newAssociation.classTwoPosition=s.subtract(UmpleSystem.position()),DiagramEdit.newAssociation.offsetTwoPosition=new UmplePosition(0,0,0,0);var d="#"+Page.umpleCanvasId();jQuery(d).append(DiagramEdit.newAssociation.drawable())},DiagramEdit.reflexiveAssociationMoving=function(e){var t=jQuery(e).attr("id"),r=t.substr(0,t.length-8),a=UmpleSystem.findAssociation(r);DiagramEdit.newAssociation==null&&(DiagramEdit.newAssociation=new UmpleAssociation,DiagramEdit.newAssociation.classOneId=a.classOneId,DiagramEdit.newAssociation.classTwoId=a.classTwoId,DiagramEdit.newAssociation.classOnePosition=a.classOnePosition,DiagramEdit.newAssociation.classTwoPosition=a.classTwoPosition,DiagramEdit.newAssociation.offsetOnePosition=a.offsetOnePosition,DiagramEdit.newAssociation.offsetTwoPosition=a.offsetTwoPosition,DiagramEdit.newAssociation.id=DiagramEdit.newAssociation.getElementId());var n=jQuery(e).offset(),o=Action.associationSnap(Math.round(n.left),Math.round(n.top),e),u=new UmplePosition(o[0],o[1],0,0),s=u.subtract(UmpleSystem.position());s.x=s.x-DiagramEdit.newAssociation.classOnePosition.x,s.y=s.y-DiagramEdit.newAssociation.classOnePosition.y,t.endsWith("_anchor0")?DiagramEdit.newAssociation.offsetOnePosition=s:DiagramEdit.newAssociation.offsetTwoPosition=s;var d="#"+Page.umpleCanvasId();jQuery(d).append(DiagramEdit.newAssociation.drawableReflexive())},DiagramEdit.classNameChanged=function(e,t,r){if(Action.setjustUpdatetoSaveLater(!1),r.length=!r.match(/^[_a-zA-Z0-9]+$/)){Action.updateUmpleDiagram();var a="Class names must be alphanumeric. &lt;"+r.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")+"&gt is not valid.";setTimeout(function(){Page.setFeedbackMessage(a)},2e3),setTimeout(function(){Page.setFeedbackMessage("")},1e4)}else{var n=UmpleSystem.renameClass(e,t,r);n.position.width=UmpleClassFactory.defaultSize.width;var o=Json.toString(n);delete n.oldname,Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",o),codeChange:!0})}},DiagramEdit.attributeNameChanged=function(e,t,r,a){if(Action.setjustUpdatetoSaveLater(!1),!Action.validateAttributeName(a))Action.updateUmpleDiagram(),setTimeout(function(){Page.setFeedbackMessage("UML Attributes must be alphanumeric with an optional type after a colon. &lt;"+a.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")+"&gt is not valid.")},2e3),setTimeout(function(){Page.setFeedbackMessage("")},1e4);else{var n=UmpleSystem.find(e);n.attributes[t].set(a),UmpleSystem.redraw(n);var o=Json.toString(n);Page.showModelLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",o),codeChange:!0}),n.resetAttribute(t)}},DiagramEdit.attributeNew=function(e,t){if(Action.setjustUpdatetoSaveLater(!1),!Action.validateAttributeName(t))Action.updateUmpleDiagram(),setTimeout(function(){Page.setFeedbackMessage("UML Attributes must be alphanumeric with an optional type after a colon. &lt;"+t.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")+"&gt is not valid.")},2e3),setTimeout(function(){Page.setFeedbackMessage("")},1e4);else{var r=UmpleSystem.find(e),a=r.addAttribute(t),n=Json.toString(r);Page.showModelLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",n),codeChange:!0}),r.resetAttribute(a),UmpleSystem.updateClass(r),UmpleSystem.redrawGeneralizationsTo(r),UmpleSystem.trimOverlappingAssociations(r),UmpleSystem.update()}},DiagramEdit.classDeleted=function(e){Action.setjustUpdatetoSaveLater(!1);for(var t=!0,r=UmpleSystem.find(e),a=[],n=[],o=0;o<UmpleSystem.umpleAssociations.length;o++){var u=UmpleSystem.umpleAssociations[o];u.contains(r)&&a.push(u.id)}for(var o=0;o<UmpleSystem.umpleClasses.length;o++){var s=UmpleSystem.umpleClasses[o];s.extendsClass==r.id&&n.push(s.id+"_generalization")}for(var o=0;o<a.length;o++)DiagramEdit.associationDeleted(a[o],t);for(var o=0;o<n.length;o++)DiagramEdit.generalizationDeleted(n[o],t);var d=UmpleSystem.removeClass(e),c=Json.toString(d);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=removeClass&actionCode={0}",c),codeChange:!0})},DiagramEdit.methodNew=function(e,t){if(Action.setjustUpdatetoSaveLater(!1),!Action.validateMethodName(t))Action.updateUmpleDiagram(),setTimeout(function(){Page.setFeedbackMessage("Invalid UML Method. &lt;"+t.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")+"&gt is not valid.")},2e3),setTimeout(function(){Page.setFeedbackMessage("")},1e4);else{var r=UmpleSystem.find(e),a=r.addMethod(t),n=Json.toString(r);Page.showModelLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",n),codeChange:!0}),r.resetMethod(a),UmpleSystem.updateClass(r),UmpleSystem.redrawGeneralizationsTo(r),UmpleSystem.trimOverlappingAssociations(r),UmpleSystem.update()}},DiagramEdit.methodChanged=function(e,t,r,a){if(Action.setjustUpdatetoSaveLater(!1),!Action.validateMethodName(a))Action.updateUmpleDiagram(),setTimeout(function(){Page.setFeedbackMessage("Invalid UML Method. &lt;"+a.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")+"&gt is not valid.")},2e3),setTimeout(function(){Page.setFeedbackMessage("")},1e4);else{var n=UmpleSystem.find(e);n.methods[t].set(a),UmpleSystem.redraw(n);var o=Json.toString(n);Page.showModelLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",o),codeChange:!0}),n.resetMethod(t)}},DiagramEdit.methodDelete=function(e,t){Action.setjustUpdatetoSaveLater(!1);var r=UmpleSystem.find(e);r.removeMethod(t);var a=jQuery("#"+r.id);r.position.width=UmpleClassFactory.defaultSize.width;var n=Json.toString(r);Page.showModelLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",n),codeChange:!0}),r.resetMethod(t),UmpleSystem.updateClass(r),UmpleSystem.redrawGeneralizationsTo(r),UmpleSystem.trimOverlappingAssociations(r),UmpleSystem.update()},DiagramEdit.attributeDelete=function(e,t){Action.setjustUpdatetoSaveLater(!1);var r=UmpleSystem.find(e);r.removeAttribute(t);var a=jQuery("#"+r.id);r.position.width=UmpleClassFactory.defaultSize.width;var n=Json.toString(r);Page.showModelLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=editClass&actionCode={0}",n),codeChange:!0}),r.resetAttribute(t),UmpleSystem.updateClass(r),UmpleSystem.redrawGeneralizationsTo(r),UmpleSystem.trimOverlappingAssociations(r),UmpleSystem.update()},DiagramEdit.associationDeleted=function(e,t){Action.setjustUpdatetoSaveLater(!1),t==null&&(t=!1);var r=UmpleSystem.removeAssociation(e),a=Json.toString(r);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=removeAssociation&actionCode={0}",a),codeChange:!0})},DiagramEdit.transitionDeleted=function(e,t){Action.setjustUpdatetoSaveLater(!1),t==null&&(t=!1);var r=UmpleSystem.removeTransition(e),a=Json.toString(r);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=removeTransition&actionCode={0}",a),codeChange:!0})},DiagramEdit.generalizationDeleted=function(e,t){Action.setjustUpdatetoSaveLater(!1),t==null&&(t=!1);var r=UmpleSystem.removeGeneralization(e),a=Json.toString(r);Page.repeatToolItem||Page.unselectAllToggleTools(),Page.showModelLoading(),Page.showLayoutLoading(),DiagramEdit.updateUmpleText({actionCode:format("action=removeGeneralization&actionCode={0}",a),codeChange:!0})},DiagramEdit.removeNewClass=function(){if(DiagramEdit.newClass!=null){var e="#"+DiagramEdit.newClass.id;return DiagramEdit.newClass=null,jQuery(e).remove(),!0}return!1},DiagramEdit.removeNewAssociation=function(){if(DiagramEdit.newAssociation!=null){var e="#"+DiagramEdit.newAssociation.getElementId();return jQuery(e).remove(),DiagramEdit.newAssociation=null,!0}return!1},DiagramEdit.removeNewTransition=function(){if(DiagramEdit.newTransition!=null){var e="#"+DiagramEdit.newTransition.getElementId();return jQuery(e).remove(),DiagramEdit.newTransition=null,!0}return!1},DiagramEdit.removeNewGeneralization=function(){if(DiagramEdit.newGeneralization!=null){var e="#"+DiagramEdit.newGeneralization.getElementId();return jQuery(e).remove(),DiagramEdit.newGeneralization=null,!0}return!1},UmpleAssociationFactory=new Object,UmpleAssociationFactory.create=function(e){var t=new UmpleAssociation;return t.id=e.id,t.classOneId=e.classOneId,t.classTwoId=e.classTwoId,t.offsetOnePosition=UmplePositionFactory.copy(e.offsetOnePosition),t.offsetTwoPosition=UmplePositionFactory.copy(e.offsetTwoPosition),t.multiplicityOne=e.multiplicityOne,t.multiplicityTwo=e.multiplicityTwo,t.name=e.name,t.roleOne=e.roleOne,t.roleTwo=e.roleTwo,t.isSymmetricReflexive=e.isSymmetricReflexive=="true"||e.isSymmetricReflexive==!0,t.isLeftNavigable=e.isLeftNavigable=="true"||e.isLeftNavigable==!0,t.isRightNavigable=e.isRightNavigable=="true"||e.isRightNavigable==!0,t.isLeftComposition=e.isLeftComposition=="true"||e.isLeftComposition==!0,t.isRightComposition=e.isRightComposition=="true"||e.isRightComposition==!0,t.color=e.isTraced,t};function UmpleAssociation(){this.id,this.classOneId,this.classTwoId,this.classOnePosition=null,this.classTwoPosition=null,this.offsetOnePosition=null,this.offsetTwoPosition=null,this.multiplicityOne="",this.multiplicityTwo="",this.name="",this.roleOne="",this.roleTwo="",this.isSymmetricReflexive=!1,this.isLeftNavigable=!0,this.isRightNavigable=!0,this.isLeftComposition=!1,this.isRightComposition=!1,this.color="black",this.setClasses=function(e,t){this.classOneId=e,this.classTwoId=t},this.setDefaultMultiplicities=function(){this.multiplicityOne="*",this.multiplicityTwo="*"},this.setDefaultRoles=function(){this.classOneId==this.classTwoId&&(this.roleTwo="roleName")},this.setRoles=function(e,t){this.roleOne=e,this.roleTwo=t},this.setName=function(e){this.name=e},this.getName=function(){return this.name==null||this.name==""?this.deriveName():this.name},this.deriveName=function(){var e="",t=this.classOneId,r=this.classTwoId;return this.roleOne==null||this.roleOne===""||(t=this.classOneId+":"+this.roleOne),this.roleTwo==null||this.roleTwo===""||(r=this.classTwoId+":"+this.roleTwo),this.classOneId<=this.classTwoId?e=t+"__"+r:e=r+"__"+t,e},this.getElementId=function(){return this.id==null?"newassociation":this.id},this.getClass=function(e){return e==0?UmpleSystem.find(this.classOneId):UmpleSystem.find(this.classTwoId)},this.setOffsetOnePosition=function(e){var t=UmpleSystem.find(this.classOneId);this.classOnePosition=t.position,this.offsetOnePosition=e.subtract(t.position).subtract(UmpleSystem.position()),this.offsetOnePosition.width=0,this.offsetOnePosition.height=0},this.setOffsetTwoPosition=function(e){var t=UmpleSystem.find(this.classTwoId);this.classTwoPosition=t.position,this.offsetTwoPosition=e.subtract(t.position).subtract(UmpleSystem.position()),this.offsetTwoPosition.width=0,this.offsetTwoPosition.height=0},this.trimOverlap=function(){for(var e=new UmpleLine(this.offsetOnePosition.add(this.classOnePosition),this.offsetTwoPosition.add(this.classTwoPosition)),t=UmpleSystem.find(this.classOneId).borderLines(),r=UmpleSystem.find(this.classTwoId).borderLines(),a=this.offsetOnePosition.add(this.classOnePosition),n=this.offsetTwoPosition.add(this.classTwoPosition),o=[],u=[],s=0;s<t.length;s++)intersection=e.intersection(t[s]),intersection!=null&&o.push(intersection);for(var s=0;s<r.length;s++)intersection=e.intersection(r[s]),intersection!=null&&u.push(intersection);for(var d=new UmpleLine(a,n),c=new UmpleLine(d.pointOne,d.pointTwo),s=0;s<o.length;s++)c.pointOne=o[s],c.length()<d.length()&&(d=new UmpleLine(c.pointOne,c.pointTwo));for(var c=new UmpleLine(d.pointOne,d.pointTwo),s=0;s<u.length;s++)c.pointTwo=u[s],c.length()<d.length()&&(d=new UmpleLine(c.pointOne,c.pointTwo));this.setOffsetOnePosition(d.pointOne.add(UmpleSystem.position())),this.setOffsetTwoPosition(d.pointTwo.add(UmpleSystem.position()))},this.adjustReflexiveEndpoints=function(){var e=this.offsetOnePosition,t=this.offsetTwoPosition,r=UmpleSystem.find(this.classOneId).borderLines();this.snapToClosestEdge(e,r),this.snapToClosestEdge(t,r)},this.snapToClosestEdge=function(e,t){var r=!0,a=!0,n=e.x+this.classOnePosition.x,o=e.y+this.classOnePosition.y,u=o-t[0].pointOne.y,s=n-t[1].pointOne.x;u>t[2].pointOne.y-o&&(r=!1,u=t[2].pointOne.y-o),s>t[3].pointOne.x-n&&(a=!1,s=t[3].pointOne.x-n),u<=s?r?e.y=0:e.y=this.classOnePosition.height:a?e.x=0:e.x=this.classOnePosition.width},this.drawable=function(){return this.id==null?associationDiv=this.drawableTemp():this.isReflexive()?associationDiv=this.drawableReflexive():this.isComposition()?associationDiv=this.drawableComposition():this.isBidirectional()?associationDiv=this.drawableBidirectional():associationDiv=this.drawableUnidirectional(),associationDiv},this.drawableTemp=function(){var e="#"+this.getElementId();jQuery(e).remove();var t=this.createBaseJQueryObject();t.addClass("umpleAssociationTemp"),t.attr("id","newassociation");var r=new UmpleLine(this.classOnePosition.add(this.offsetOnePosition),this.classTwoPosition.add(this.offsetTwoPosition));return t.append(r.drawable()),t},this.drawableBidirectional=function(){var e="#"+this.id;jQuery(e).remove();var t=this.createBaseJQueryObject();this.color=="red"?t.addClass("redTracedAssociation"):t.addClass("untracedAssociation"),t.attr("id",this.id),t.attr("tabindex",2);var r=UmpleSystem.find(this.classOneId),a=UmpleSystem.find(this.classTwoId);if(r==null||r==null||a==null||a==null)return t;this.classOnePosition=r.position,this.classTwoPosition=a.position;var n=this.classOnePosition.add(this.offsetOnePosition),o=this.classTwoPosition.add(this.offsetTwoPosition),u=new UmpleLine(n.add(UmpleClassFactory.offsetError),o.add(UmpleClassFactory.offsetError));this.isComposition()||t.append(u.drawable());var s="",d=-3;s+=this.anchorDivHtml("hover",0,n.x+d,n.y+d),s+=this.anchorDivHtml("anchor",0,n.x+d,n.y+d),s+=this.anchorDivHtml("hover",1,o.x+d,o.y+d),s+=this.anchorDivHtml("anchor",1,o.x+d,o.y+d);var c=n.slopeAngle(o),h=this.multiplicityPosition(!0),C=this.multiplicityPosition(!1),m=this.multiplicityDivHtml("one",this.multiplicityOne,h.x,h.y),T=this.multiplicityDivHtml("two",this.multiplicityTwo,C.x,C.y);if(this.roleOne!=""){roleOnePosition=this.rolePosition(!0);var S=this.roleDivHtml("one",this.roleOne,roleOnePosition.x,roleOnePosition.y)}else S="";if(this.roleTwo!=""){roleTwoPosition=this.rolePosition(!1);var P=this.roleDivHtml("two",this.roleTwo,roleTwoPosition.x,roleTwoPosition.y)}else P="";return currentHtml=t.html(),t.html(m+T+S+P+s+currentHtml),t},this.drawableUnidirectional=function(){var e=this.drawableBidirectional(),t=null;this.isLeftNavigable?(t=this.classOnePosition.add(this.offsetOnePosition),otherEnd=this.classTwoPosition.add(this.offsetTwoPosition)):(t=this.classTwoPosition.add(this.offsetTwoPosition),otherEnd=this.classOnePosition.add(this.offsetOnePosition));var r=t.slopeAngle360(otherEnd),a=r+30,n=r-30,o=10,u=t.travelForward(o,a),s=t.travelForward(o,n),d=new UmpleLine(t.add(UmpleClassFactory.offsetError),u.add(UmpleClassFactory.offsetError)),c=new UmpleLine(t.add(UmpleClassFactory.offsetError),s.add(UmpleClassFactory.offsetError));return e.append(d.drawable()),e.append(c.drawable()),e},this.drawableComposition=function(){var e=this.drawableBidirectional(),t=null;this.isLeftComposition?(t=this.classOnePosition.add(this.offsetOnePosition),otherEnd=this.classTwoPosition.add(this.offsetTwoPosition)):(t=this.classTwoPosition.add(this.offsetTwoPosition),otherEnd=this.classOnePosition.add(this.offsetOnePosition));var r=t.slopeAngle360(otherEnd),a=r+30,n=r-30,o=8,u=t.travelForward(o,a),s=t.travelForward(o,n),d=u.travelForward(o,n),c=new UmpleLine(t.add(UmpleClassFactory.offsetError),u.add(UmpleClassFactory.offsetError)),h=new UmpleLine(t.add(UmpleClassFactory.offsetError),s.add(UmpleClassFactory.offsetError)),C=new UmpleLine(u.add(UmpleClassFactory.offsetError),d.add(UmpleClassFactory.offsetError)),m=new UmpleLine(s.add(UmpleClassFactory.offsetError),d.add(UmpleClassFactory.offsetError));e.append(c.drawable()),e.append(h.drawable()),e.append(C.drawable()),e.append(m.drawable());var T=new UmpleLine(d.add(UmpleClassFactory.offsetError),otherEnd.add(UmpleClassFactory.offsetError));e.append(T.drawable());var S=4,P=t.travelForward(S,a),_=t.travelForward(S,n),F=u.travelForward(S,n),g=s.travelForward(S,a),b=new UmpleLine(t.add(UmpleClassFactory.offsetError),F.add(UmpleClassFactory.offsetError)),k=new UmpleLine(t.add(UmpleClassFactory.offsetError),g.add(UmpleClassFactory.offsetError)),L=new UmpleLine(t.add(UmpleClassFactory.offsetError),d.add(UmpleClassFactory.offsetError)),A=new UmpleLine(u.add(UmpleClassFactory.offsetError),g.add(UmpleClassFactory.offsetError)),E=new UmpleLine(u.add(UmpleClassFactory.offsetError),_.add(UmpleClassFactory.offsetError)),j=new UmpleLine(u.add(UmpleClassFactory.offsetError),s.add(UmpleClassFactory.offsetError)),D=new UmpleLine(s.add(UmpleClassFactory.offsetError),P.add(UmpleClassFactory.offsetError)),N=new UmpleLine(s.add(UmpleClassFactory.offsetError),F.add(UmpleClassFactory.offsetError)),I=new UmpleLine(d.add(UmpleClassFactory.offsetError),P.add(UmpleClassFactory.offsetError)),R=new UmpleLine(d.add(UmpleClassFactory.offsetError),_.add(UmpleClassFactory.offsetError)),W=new UmpleLine(P.add(UmpleClassFactory.offsetError),_.add(UmpleClassFactory.offsetError)),Q=new UmpleLine(P.add(UmpleClassFactory.offsetError),F.add(UmpleClassFactory.offsetError)),p=new UmpleLine(P.add(UmpleClassFactory.offsetError),g.add(UmpleClassFactory.offsetError)),U=new UmpleLine(_.add(UmpleClassFactory.offsetError),F.add(UmpleClassFactory.offsetError)),M=new UmpleLine(_.add(UmpleClassFactory.offsetError),g.add(UmpleClassFactory.offsetError)),B=new UmpleLine(F.add(UmpleClassFactory.offsetError),g.add(UmpleClassFactory.offsetError));return e.append(b.drawable()),e.append(k.drawable()),e.append(L.drawable()),e.append(A.drawable()),e.append(E.drawable()),e.append(j.drawable()),e.append(D.drawable()),e.append(N.drawable()),e.append(I.drawable()),e.append(R.drawable()),e.append(W.drawable()),e.append(Q.drawable()),e.append(p.drawable()),e.append(U.drawable()),e.append(M.drawable()),e.append(B.drawable()),e},this.drawableReflexive=function(){var e="#"+this.id;jQuery(e).remove();var t=this.createBaseJQueryObject();this.color=="red"?t.addClass("redTracedAssociation"):t.addClass("untracedAssociation"),t.attr("id",this.id),t.attr("tabindex",2);var r=UmpleSystem.find(this.classOneId);this.classOnePosition=r.position,this.classTwoPosition=r.position;var a=r.position.height,n=r.position.width,o=15,u=this.whichWall(!0);factorX=u=="West"?-1:u=="South"?0:u=="East"?1:0,factorY=u=="West"?0:u=="South"?1:u=="East"?0:-1;var s=this.offsetOnePosition.add(this.classOnePosition),d=this.offsetOnePosition.add(this.classOnePosition).add(new UmplePosition(o*factorX,o*factorY,0,0));u=="South"&&(s.y=s.y-1);var c=new UmpleLine(s,d),h=this.whichWall(!1);factorX=h=="West"?-1:h=="South"?0:h=="East"?1:0,factorY=h=="West"?0:h=="South"?1:h=="East"?0:-1;var C=this.offsetTwoPosition.add(this.classTwoPosition),m=this.offsetTwoPosition.add(this.classTwoPosition).add(new UmplePosition(o*factorX,o*factorY,0,0)),T=new UmpleLine(C,m);t.append(c.drawable()),t.append(T.drawable());var S=new UmplePosition(0,0,0,0);if(u==h){var P=new UmpleLine(d,m);u=="North"||u=="South"?this.isSymmetricReflexive&&(S.x=(d.x+m.x)/2,S.y=d.y):this.isSymmetricReflexive&&(S.x=d.x,S.y=(d.y+m.y)/2),t.append(P.drawable())}else if(this.offsetOnePosition.wallsAreAdjacent(u,h)){var _=new UmplePosition(0,0,0,0),F=u=="West"||h=="West",g=u=="North"||h=="North";F?_.x=this.classOnePosition.x-o:_.x=this.classOnePosition.x+n+o,g?_.y=this.classOnePosition.y-o:_.y=this.classOnePosition.y+a+o;var b=new UmpleLine(d,_),k=new UmpleLine(m,_);t.append(b.drawable()),t.append(k.drawable()),this.isSymmetricReflexive&&S.set(_.x,_.y)}else{var L=new UmplePosition(0,0,0,0),A=new UmplePosition(0,0,0,0),E,j,D,N,I;u=="South"||h=="South"?(L.x=this.classOnePosition.x-o,L.y=this.classOnePosition.y-o,A.x=L.x,A.y=this.classOnePosition.y+a+o,h=="South"?(N=d,I=m):(N=m,I=d),this.isSymmetricReflexive&&(S.x=L.x,S.y=(L.y+A.y)/2)):(L.x=this.classOnePosition.x-o,L.y=this.classOnePosition.y+a+o,A.x=this.classOnePosition.x+n+o,A.y=L.y,h=="East"?(N=d,I=m):(N=m,I=d),this.isSymmetricReflexive&&(S.x=(L.x+A.x)/2,S.y=L.y)),E=new UmpleLine(N,L),j=new UmpleLine(L,A),D=new UmpleLine(A,I),t.append(E.drawable()),t.append(j.drawable()),t.append(D.drawable())}if(!this.isSymmetricReflexive){var R=new UmplePosition(0,0,0,0);u=="North"||u=="South"?(S.x=d.x,S.y=(s.y+d.y)/2):(S.x=(s.x+d.x)/2,S.y=d.y),h=="North"||h=="South"?(R.x=m.x,R.y=(C.y+m.y)/2):(R.x=(C.x+m.x)/2,R.y=m.y)}var W="",Q=s,p=C,U=3;if(W+=this.anchorDivHtml("hover",0,Q.x-U,Q.y-U),W+=this.anchorDivHtml("anchor",0,Q.x-U,Q.y-U),W+=this.anchorDivHtml("hover",1,p.x-U,p.y-U),W+=this.anchorDivHtml("anchor",1,p.x-U,p.y-U),this.isSymmetricReflexive)var M=UmplePositionFactory.copy(this.centerMultiplicityPosition(S)),B=this.adjustRolePosition(S,!0),V=this.roleDivHtml("center",this.roleOne,B.x,B.y),te=this.multiplicityDivHtml("center",this.multiplicityOne,M.x,M.y);else var J=UmplePositionFactory.copy(this.reflexiveMultiplicityPosition(S,R,!0)),re=UmplePositionFactory.copy(this.reflexiveMultiplicityPosition(R,S,!1)),ne=this.adjustRolePosition(S,!0),K=this.adjustRolePosition(R,!1),V=this.roleDivHtml("one",this.roleOne,ne.x,ne.y)+this.roleDivHtml("two",this.roleTwo,K.x,K.y),te=this.multiplicityDivHtml("one",this.multiplicityOne,J.x,J.y)+this.multiplicityDivHtml("two",this.multiplicityTwo,re.x,re.y);if(this.id==null)return t.attr("id","newassociation"),t;var ue=t.html();return t.html(te+V+W+ue),t},this.isReflexive=function(){return this.classOneId==this.classTwoId||this.isSymmetricReflexive},this.isBidirectional=function(){return this.isRightNavigable==null||this.isLeftNavigable==null?!0:this.isRightNavigable&&this.isLeftNavigable},this.isComposition=function(){return this.isRightComposition||this.isLeftComposition},this.endHasArrow=function(e){return e?this.isLeftNavigable:this.isRightNavigable},this.contains=function(e){return e.id==this.classOneId||e.id==this.classTwoId},this.anchorDivHtml=function(e,t,r,a){return format('<div id="{0}_{1}{2}" class="{1}" name="{1}" style="left: {3}px; top: {4}px; cursor: pointer; display: none;"><img name="image" src="./scripts/_.gif"/></div>',this.id,e,t,r,a)},this.multiplicityDivHtml=function(e,t,r,a,n){return(n==null||n=="undefined")&&(n=""),format('<div id="{0}_{1}" class="multiplicity" name="{1}" style="left: {2}px; top: {3}px; cursor: pointer;">{4}&nbsp;&nbsp;{5}</div>',this.id,e,r,a,t,n)},this.roleDivHtml=function(e,t,r,a){return e=="one"?idExtension="roleOne":e=="two"?idExtension="roleTwo":e=="center"?idExtension="role":idExtension="",format('<div id="{0}_{1}" class="role" name="{1}" style="left: {2}px; top: {3}px; cursor: pointer;">{4}</div>',this.id,idExtension,r,a,t)},this.whichWall=function(e){if(e)var t=this.classOnePosition,r=this.offsetOnePosition;else var t=this.classTwoPosition,r=this.offsetTwoPosition;var a=1;return r.x==0?"West":r.y==0?"North":Math.abs(r.x-t.width)<=a?"East":"South"},this.multiplicityPosition=function(e){if(e)var t=this.classOnePosition.add(this.offsetOnePosition),r=this.classTwoPosition.add(this.offsetTwoPosition),a=this.multiplicityOne;else var t=this.classTwoPosition.add(this.offsetTwoPosition),r=this.classOnePosition.add(this.offsetOnePosition),a=this.multiplicityTwo;var n=this.whichWall(e),o=a=="*"?new UmplePosition(0,10,0,0):new UmplePosition(0,16,0,0),u=new UmplePosition(5*a.length+1,0,0,0),s=3;(!this.isBidirectional()&&this.endHasArrow(e)||this.isComposition())&&(s+=5);var d=t.slopeAngle360(r);if(n=="North")if(d<90){var c=(180-d)/2+d,h=t.travelForward(s,c);h=h.subtract(u),h=h.subtract(o)}else{var c=d/2,h=t.travelForward(s,c);h=h.subtract(o)}else if(n=="East")if(d>=0&&d<=90)var c=(d+90)/2+270,h=t.travelForward(s,c);else{var c=((360-d+90)/2+d)%360,h=t.travelForward(s,c);h=h.subtract(o)}else if(n=="South")if(d<=270)var c=(360-d)/2+d,h=t.travelForward(s,c),C=h;else{var c=(d-180)/2+180,h=t.travelForward(s,c),C=h;h=h.subtract(u)}else if(d<=180){var c=(270-d)/2+d,h=t.travelForward(s,c);h=h.subtract(u)}else{var c=(d-90)/2+90,h=t.travelForward(s,c);h=h.subtract(o),h=h.subtract(u)}return h},this.centerMultiplicityPosition=function(e){var t=this.whichWall(!0),r=this.whichWall(!1),a=1,n=5;return e.width=5*this.multiplicityOne.length+n+6*this.roleOne.length,e.height=16,t=="West"&&r=="West"||t=="North"&&r=="South"||t=="South"&&r=="North"?(e.x-=e.width+a,e.y-=e.height/2):t=="East"&&r=="East"?(e.x+=a,e.y-=e.height/2):t=="North"||r=="North"?(e.y-=a+e.height,e.x-=e.width/2):(e.y+=a,e.x-=e.width/2),e},this.reflexiveMultiplicityPosition=function(e,t,r){var a=5,n=1;if(r)var o=this.whichWall(!0),u=this.whichWall(!1),s=this.multiplicityOne.length,d=this.roleOne.length;else var o=this.whichWall(!1),u=this.whichWall(!0),s=this.multiplicityTwo.length,d=this.roleTwo.length;return e.width=5*s+a+6*d,e.height=16,o=="North"?(e.y-=e.height/2,u=="North"&&e.x<t.x||u=="East"?e.x-=e.width+n:e.x+=n):o=="East"?u=="East"&&e.y<t.y||u=="South"||u=="West"?e.y-=e.height:e.y+=n:o=="South"?(e.y-=e.height/2,u=="South"&&e.x<t.x||u=="East"?e.x-=e.width+n:e.x+=n):o=="West"&&(e.x-=e.width,u=="West"&&e.y<t.y||u=="East"||u=="South"?e.y-=e.height:e.y+=n),e},this.rolePosition=function(e){var t=e?this.multiplicityOne:this.multiplicityTwo,r=e?this.roleOne:this.roleTwo,a=e?this.classOnePosition.add(this.offsetOnePosition):this.classTwoPosition.add(this.offsetTwoPosition),n=e?this.classTwoPosition.add(this.offsetTwoPosition):this.classOnePosition.add(this.offsetOnePosition),o=new UmplePosition(5*t.length,0,0,0),u=new UmplePosition(6*r.length,0,0,0,0),s=new UmplePosition(0,16,0,0),d=s,c=new UmplePosition(5,0,0,0),h=this.multiplicityPosition(e),C=this.whichWall(e),m=a.slopeAngle360(n);return C=="North"?(m<90?rolePosition=h.subtract(u).subtract(o):rolePosition=h.add(o).add(c),t=="*"&&(rolePosition=rolePosition.subtract(new UmplePosition(0,6,0,0)))):C=="East"||C=="South"&&m<=270?rolePosition=h.add(o).add(c):rolePosition=h.subtract(u).subtract(o),rolePosition},this.adjustRolePosition=function(e,t){var r=t?this.multiplicityOne.length:this.multiplicityTwo.length;return e.x+=5*r+6,e},this.createBaseJQueryObject=function(){return jQuery(format("<div class='{0}'></div>",this.getName()))}}UmpleAttributeFactory=new Object,UmpleAttributeFactory.create=function(e){var t=e.type,r=e.name,a=e.traceColor;a==""&&(a="black");var n=new UmpleAttribute(t,r,a);return n};function UmpleAttribute(e,t,r){this.type=e,this.name=t,this.textColor=r,(this.aColor===""||this.aColor===void 0)&&(this.aColor="black"),this.set=function(a){this.textColor="black";var n=this.type!=""&&this.name!="";n&&(this.oldType=this.type,this.oldName=this.name);var o=a.split(":");o.length<2?(this.type="String",this.name=a):(this.name=o[0].trim(),this.type=o[1].trim()),n||(this.newType=this.type,this.newName=this.name)},this.copy=function(){return new UmpleAttribute(this.type,this.name,this.textColor)}}UmpleClassFactory=new Object,UmpleClassFactory.defaultSize=new UmplePosition(0,0,109,41),UmpleClassFactory.offsetError=new UmplePosition(0,0,0,0),UmpleClassFactory.create=function(e){var t=new UmpleClass;t.id=e.id,t.name=e.name,t.isInterface=e.isInterface,t.isAbstract=e.isAbstract,t.displayColor=e.displayColor,t.displayColor==""&&(t.displayColor="transparent"),t.position.x=e.position.x,t.position.y=e.position.y,t.position.width=e.position.width,t.position.height=e.position.height,t.extendsClass=e.extendsClass;for(var r=0;r<e.attributes.length;r++)e.attributes[r].modifier!="const"&&t.attributes.push(UmpleAttributeFactory.create(e.attributes[r]));for(var r=0;r<e.methods.length;r++)t.methods.push(UmpleMethodFactory.create(e.methods[r]));if(e.implementedInterfaces!=null)for(var r=0;r<e.implementedInterfaces.length;r++)t.interfaces[r]=e.implementedInterfaces[r].interfacesName+"";return t},UmpleClassFactory.perimeterPosition=function(e,t,r){typeof r>"u"&&(r=new UmplePosition(0,0,0,0));var a=t.x,n=t.y,o=0,u=r.x+e.position.x+o,s=u+e.position.width,d=r.y+e.position.y+o,c=d+e.position.height,h=a<u?u:a>s?s:a,C=n<d?d:n>c?c:n,m=a-u,T=s-a,S=n-d,P=c-n,_=Math.min(m,T),F=Math.min(S,P);return _<F?h=m<T?u:s:F<_&&(C=S<P?d:c),new UmplePosition(Math.round(h),Math.round(C),0,0)};function UmpleClass(){this.id,this.name,this.isInterface,this.isAbstract,this.displayColor="transparent",this.position=new UmplePosition(0,0,109,41),this.attributes=[],this.methods=[],this.interfaces=[],this.extendsClass,this.addAttribute=function(e){var t=new UmpleAttribute("","","");return t.set(e),this.attributes.push(t),this.attributes.length-1},this.removeAttribute=function(e){var t=this.attributes[e];t.deleteType=t.type,t.deleteName=t.name},this.resetAttribute=function(e){this.attributes[e].deleteName!=null?this.attributes.splice(e,1):this.attributes[e]=this.attributes[e].copy()},this.resetMethod=function(e){this.methods[e].deleteName!=null?this.methods.splice(e,1):this.methods[e]=this.methods[e].copy()},this.addMethod=function(e){var t=new UmpleMethod("","","","");return t.set(e),this.methods.push(t),this.methods.length-1},this.removeMethod=function(e){var t=this.methods[e];t.deleteType=t.type,t.deleteVisibility=t.visibility,t.deleteName=t.name,t.deleteParameters=t.parameters},this.setExtendsClass=function(e){this.extendsClass=e},this.removeExtendsClass=function(){this.extendsClass=null},this.borderLines=function(){var e=jQuery("#"+this.id),t=e.width(),r=e.height(),a=this.position,n=this.position.add(new UmplePosition(t,0,0,0)),o=this.position.add(new UmplePosition(0,r,0,0)),u=this.position.add(new UmplePosition(t,r,0,0));return borders=[],borders.push(new UmpleLine(a,n)),borders.push(new UmpleLine(a,o)),borders.push(new UmpleLine(o,u)),borders.push(new UmpleLine(n,u)),borders},this.drawable=function(){var e=this.drawClass(),t=this.drawGeneralization(),r=[e,t];return r},this.drawClass=function(){var e="#"+this.id,t=jQuery(e).get();t==null||t==null||t==""?(classDiv=jQuery("<div></div>"),classDiv.addClass("umpleClass"),classDiv.attr("tabindex",2)):(classDiv=jQuery(t),removalSel=format("div#{0} .classTable,div#{0} .umpleAttribute,div#{0} .umpleAttributeNew,div#{0} .anchor, div#{0} .hover",this.id),jQuery(removalSel).remove()),classDiv.attr("id",this.id);var r=-3.5,a=-3,n="",o="",u="";if(this.attributes.length>0)for(var s=0;s<this.attributes.length;s++){var d=this.attributes[s],c="";d.textColor!="black"&&(c=format("style='color:{0}'",d.textColor)),Page.isPhotoReady()?n+=format('<div class="umpleAttribute" {3}>{0} : {1}</div>',d.name,d.type,c):n+=format('<div class="umpleAttribute" {5}><span id="{2}_attribute_{3}" name="attributeEdit" class="editable editableDoubleClick">{0} : {1}</span> <img src="scripts/delete2.jpg" onclick="DiagramEdit.attributeDelete({4}{2}{4},{4}{3}{4})" /></div>',d.name,d.type,this.id,s,"'",c)}if(this.methods.length>0)for(var s=0;s<this.methods.length;s++){var h=this.methods[s],C="";h.visibility=="public"?C="+ ":h.visibility=="private"?C="- ":h.visibility=="protected"?C="# ":C="+ ";var m=h.type==""?"void":h.type;Page.isPhotoReady()?h.isAbstract=="true"?o+=format('<div class="umpleMethod">{3}<span style="font-style:italic">{1}({2}) </span> : {0} </div>',m,h.name,h.parameters,C):o+=format('<div class="umpleMethod">{3}{1}({2}) : {0} </div>',m,h.name,h.parameters,C):h.isAbstract=="true"?o+=format('<div class="umpleMethod"><span id="{4}_method_{5}" name="methodEdit" class="editable editableDoubleClick">{3}<span style="font-style:italic">{1}({2})</span> : {0} </span> <img src="scripts/delete2.jpg" onclick="DiagramEdit.methodDelete({6}{4}{6},{6}{5}{6})" /></div>',m,h.name,h.parameters,C,this.id,s,"'"):o+=format('<div class="umpleMethod"><span id="{4}_method_{5}" name="methodEdit" class="editable editableDoubleClick">{3}{1}({2}) : {0} </span> <img src="scripts/delete2.jpg" onclick="DiagramEdit.methodDelete({6}{4}{6},{6}{5}{6})" /></div>',m,h.name,h.parameters,C,this.id,s,"'")}n+=format('<div class="umpleAttributeNew"><span id="{0}_newAttribute" name="attributeNew" class="editable editableSingleClick">{1}</span></div>',this.id,Page.isPhotoReady()?"&nbsp;":"-- Add More --"),o+=format('<div class="umpleMethodNew"><span id="{0}_newMethod" name="methodNew" class="editable editableSingleClick">{1}</span></div>',this.id,Page.isPhotoReady()?"&nbsp;":"-- Add More --"),Page.isPhotoReady(),rowspan=3,Page.showAttributes&&(rowspan+=1),Page.showMethods&&(rowspan+=1),u+=format('<table bgcolor="'+this.displayColor+'" class="classTable" border="0">',this.id)+format('  <tr class="height">    <td rowspan="{2}"> <img id="{0}_height" src="scripts/_.gif" style="width:0px;height:{1}px;display:block;"  />    </td>  </tr>',this.id,this.position.height,rowspan)+'  <tr class="classArea">    <td > <img src="scripts/class.png" title="Class" /> ',Page.isPhotoReady()?this.isInterface=="true"?u+=format('<span>&#171interface&#187<span><br><span id="{0}_name" name="className">{1}</span>',this.id,this.name):this.isAbstract=="true"?u+=format('<span>&#171abstract&#187<span><br><span id="{0}_name" name="className">{1}</span>',this.id,this.name):u+=format('<span id="{0}_name" name="className">{1}</span>',this.id,this.name):this.isInterface=="true"?u+=format('<span>&#171interface&#187<span><br><span id="{0}_name" name="className" class="editable editableDoubleClick">{1}</span>',this.id,this.name):this.isAbstract=="true"?u+=format('<span>&#171abstract&#187<span><br><span id="{0}_name" name="className" class="editable editableDoubleClick">{1}</span>',this.id,this.name):u+=format('<span id="{0}_name" name="className" class="editable editableDoubleClick" >{1}</span>',this.id,this.name),u+="</td> </tr>",Page.showAttributes==!0&&(u+=format('  <tr class="attributeArea">    <td class="attributes">{0}    </td>  </tr>',n)),Page.showMethods==!0&&(u+=format('  <tr class="methodArea">    <td class="methods">{0}    </td>  </tr>',o)),u+=format('  <tr class="width">    <td> <img id="{0}_width" src="scripts/_.gif" style="width:{1}px;height:0px;display:block;"  />    </td>  </tr>',this.id,this.position.width),u+="</table>";var T=classDiv.html();return classDiv.html(u+T),classDiv},this.drawableClassOutline=function(){var e="#tempClass",t=jQuery(e).get();t==null||t==null||t==""?(t=jQuery("<div></div>"),t.addClass("umpleClass"),t.attr("id",this.id)):t=jQuery(e);var r='<table class="classTable" "border="0">'+format('  <tr class="height">    <td rowspan="4"> <img id="{0}_height" src="scripts/_.gif" style="width:0px;height:{1}px;display:block;"  />    </td>  </tr>',this.id,this.position.height)+'  <tr class="classArea">    <td> <img src="scripts/class.png" title="Class" /> '+format('      <span id="{0}_name" name="className" >{1}</span>',this.id,this.name)+'    </td>  </tr>  <tr class="attributeArea">    <td class="attributes">    </td>  </tr>  <tr class="width">'+format('    <td> <img id="{0}_width" src="scripts/_.gif" style="width:{1}px;height:0px;display:block;"  />    </td>  </tr>',this.id,this.position.width)+"</table>";return t.html(r),t},this.drawGeneralization=function(){var e=null,t=[],r=UmpleSystem.find(this.extendsClass);if(r==null&&this.interfaces.length==0)return null;if(r!=null&&(e=new UmpleGeneralization,e.childId=this.id,e.parentId=r.id,e.childPosition=this.position,e.parentPosition=r.position,t[0]=e.drawable()),this.interfaces.length>0)for(var a=null,n=0;n<this.interfaces.length;n++)a=UmpleSystem.find(this.interfaces[n]),a!=null&&(e=new UmpleGeneralization,e.childId=this.id,e.parentId=a.id,e.childPosition=this.position,e.parentPosition=a.position,t[n+1]=e.drawable());return t},this.anchorDivHtml=function(e,t){return format('<div id="{0}_{1}{2}" class="{3}" name="{4}" style="top: 0px; left: 0px; cursor:{5}; display: none;"><img name="image" src="./scripts/_.gif"/></div>',this.id,e,t,e,e,"move")}}function UmpleGeneralization(){this.parentId=null,this.childId=null,this.parentPosition=null,this.childPosition=null,this.id=null,this.setClasses=function(e,t){this.childId=e,this.parentId=t},this.setChildId=function(e){this.childId=e},this.setParentId=function(e){this.parentId=e},this.getElementId=function(){return this.id==null?"newgeneralization":this.id},this.getChildId=function(){return this.childId},this.getParentId=function(){return this.parentId},this.drawable=function(e){if(e==null&&(e=!0),this.childId==null||this.childId==null)return null;var t="#"+this.childId+"_generalization";jQuery(t).remove();var r=jQuery("<div></div>"),a=e?this.childId+"_generalization":"newgeneralization",n="umpleGeneralization";r.attr("id",a),r.attr("tabindex",2),r.addClass(n);var o=new UmplePosition(0,10,0,0),D=new UmplePosition(15,0,0,0),u=new UmplePosition(0,22,0,0),s=this.childPosition,d=new UmplePosition(this.childPosition.width/2,0,0,0),c=this.parentPosition,h=new UmplePosition(this.parentPosition.width/2,this.parentPosition.height,0,0);h=h.add(o).add(u),c=c.add(h),s=s.add(d);var C=this.childPosition.x,m=this.childPosition.x+this.childPosition.width,T=this.childPosition.y+this.childPosition.height,S=this.childPosition.y,P=!0;c.y>S&&(c.y<T?Math.abs(c.x-m)<Math.abs(c.x-C)?(s=s.add(new UmplePosition(this.childPosition.width/2,0,0,0)),s.y=c.y,P=!1):(s=s.subtract(new UmplePosition(this.childPosition.width/2,0,0,0)),s.y=c.y,P=!1):s=s.add(new UmplePosition(0,this.childPosition.height,0,0)));var _=new UmplePosition(s.x,c.y);if(P){var F=new UmpleLine(_.add(UmpleClassFactory.offsetError),c.add(UmpleClassFactory.offsetError)),g=new UmpleLine(s.add(UmpleClassFactory.offsetError),_.add(UmpleClassFactory.offsetError));r.append(F.drawable())}else var g=new UmpleLine(s.add(UmpleClassFactory.offsetError),c.add(UmpleClassFactory.offsetError));r.append(g.drawable());var b=c,k=c.subtract(u),L=new UmpleLine(b.add(UmpleClassFactory.offsetError),k.add(UmpleClassFactory.offsetError));r.append(L.drawable());var A=k.subtract(new UmplePosition(D.x/2,0,0,0)),E=A.add(D),j=k.subtract(o),D=new UmpleLine(A.add(UmpleClassFactory.offsetError),E.add(UmpleClassFactory.offsetError)),N=new UmpleLine(A.add(UmpleClassFactory.offsetError),j.add(UmpleClassFactory.offsetError)),I=new UmpleLine(E.add(UmpleClassFactory.offsetError),j.add(UmpleClassFactory.offsetError));r.append(D.drawable()),r.append(I.drawable()),r.append(N.drawable());var R="",W=r.html();return r.html(R+W),r},this.anchorDivHtml=function(e,t,r,a){return format('<div id="{0}_{1}{2}" class="{1}" name="{1}" style="left: {3}px; top: {4}px; cursor: pointer; display: none;"><img name="image" src="./scripts/_.gif"/></div>',this.childId+"_generalization",e,t,r,a)}}History=new Object,History.versionCount=9999,History.noChange="//$?[No_Change]$?",History.getInstance=function(e){var t=new Object;return t.id=e,t.currentIndex=-1,t.oldestAvailableIndex=0,t.newestAvailableIndex=0,t.firstSave=!0,t.undoButton=!1,t.redoButton=!1,t.getNextVersion=function(){return History.getNextVersion(t)},t.getPreviousVersion=function(){return History.getPreviousVersion(t)},t.save=function(r,a){return History.save(t,r,a)},t.distanceBetween=function(r,a){return History.distanceBetween(t,r,a)},t.setButtons=function(){return History.setButtons(t)},t.getVersion=function(r){return History.getVersion(t,r)},t.setVersion=function(r,a){return History.setVersion(t,r,a)},t},History.setButtons=function(e){History.enableButtonUndo(e,e.undoButton),History.enableButtonRedo(e,e.redoButton)},History.enableButtonUndo=function(e,t){e.undoButton=t,Page.enablePaletteItem("buttonUndo",t)},History.enableButtonRedo=function(e,t){e.redoButton=t,Page.enablePaletteItem("buttonRedo",t)},History.getNextVersion=function(e){History.enableButtonUndo(e,!0);var t;return!e.FirstSave&&e.newestAvailableIndex!=e.currentIndex?(e.currentIndex=History.incrementIndex(e.currentIndex),t=e.getVersion(e.currentIndex),t==null&&(t=History.noChange)):t=History.noChange,e.newestAvailableIndex==e.currentIndex&&History.enableButtonRedo(e,!1),t},History.getPreviousVersion=function(e){var t;return!e.FirstSave&&e.oldestAvailableIndex!=e.currentIndex?(e.currentIndex=History.decrementIndex(e.currentIndex),t=e.getVersion(e.currentIndex),t==null?t=History.noChange:History.enableButtonRedo(e,!0)):t=History.noChange,e.oldestAvailableIndex==e.currentIndex&&History.enableButtonUndo(e,!1),t},History.save=function(e,t,r){if(e.getVersion(e.currentIndex)!=t){e.firstSave||(History.enableButtonRedo(e,!1),History.enableButtonUndo(e,!0));var a=e.distanceBetween(e.oldestAvailableIndex,e.currentIndex);a==e.versionCount-1&&(e.oldestAvailableIndex=History.incrementIndex(e.oldestAvailableIndex)),e.currentIndex=History.incrementIndex(e.currentIndex),e.newestAvailableIndex=e.currentIndex,e.setVersion(e.currentIndex,t),e.firstSave&&(e.firstSave=!1)}},History.decrementIndex=function(e){var t;return e==0?t=History.versionCount-1:t=e-1,t},History.incrementIndex=function(e){var t=(e+1)%History.versionCount;return t},History.getVersion=function(e,t){var r="#textEditorColumn",a=e.id+"version"+t;return jQuery(r).data(a)},History.setVersion=function(e,t,r){var a="#textEditorColumn",n=e.id+"version"+t;return jQuery(a).data(n,r)},History.distanceBetween=function(e,t,r){if(e.currentIndex==-1)return 0;for(var a=0,n=t;n!=r;)n=History.incrementIndex(n),a+=1;return a};var Layout={};Layout.isTextVisible=!0,Layout.isDiagramVisible=!0,Layout.isPaletteVisible=!0,Layout.isLayoutVisible=!1,Layout.layoutHandler=null,Layout.isInSmallScreenMode=!1,Layout.screenThresholdWidth=945;var canvasHandle="#umpleCanvasColumn",editorHandle="#textEditorColumn",modelEditorHandle="#newEditor",paletteHandle="#paletteColumn",layoutEditorHandle="#bottomTextEditor";Layout.init=function(){Layout.errorMessageSpace=jQuery(".spacer").outerHeight(),Layout.errorMessageSpace===null&&(Layout.errorMessageSpace=0);var e=this.checkLayoutNeeded();e.layoutType==="large"?(this.layoutHandler=new LargeScreenManager,this.isInSmallScreenMode=!1):e.layoutType==="small"&&(this.layoutHandler=new SmallScreenManager,this.isInSmallScreenMode=!0),this.layoutHandler.transition(!0),jQuery(window).bind("resize",function(t){jQuery(t.target).hasClass("ui-resizable")||Layout.zoomResize()})},Layout.checkLayoutNeeded=function(){return jQuery(window).innerWidth()>jQuery(window).innerHeight()&&!(jQuery("body").innerWidth()<580&&jQuery("body").innerHeight()<580)?{layoutType:"large"}:{layoutType:"small"}},Layout.initPaletteSize=function(){this.layoutHandler.initPaletteSize()},Layout.initUmpleCanvasSize=function(){this.layoutHandler.initUmpleCanvasSize()},Layout.initUmpleTextAreaSize=function(){this.layoutHandler.initUmpleTextAreaSize()},Layout.setTextEditorSize=function(e,t){this.layoutHandler.setTextEditorSize(e,t)},Layout.setUmpleCanvasSize=function(e,t){this.layoutHandler.setUmpleCanvasSize(e,t)},Layout.adjustTextEditorHeight=function(e){this.isLayoutVisible?(jQuery(modelEditorHandle).outerHeight(e*.7),Page.codeMirrorOn&&this.resizeCodeMirrorEditor(e*.7),jQuery(layoutEditorHandle).outerHeight(e*.3)):(jQuery(modelEditorHandle).outerHeight(e),Page.codeMirrorOn&&this.resizeCodeMirrorEditor(e)),jQuery(editorHandle).height(e)},Layout.resizeCodeMirrorEditor=function(e){Page.codeMirrorOn&&(Page.codeMirrorEditor6.dom.style.height=e+"px")},Layout.showHideLayoutEditor=function(e){var t=jQuery(layoutEditorHandle),r=jQuery(editorHandle).height();e==null&&(e=!this.isLayoutVisible),e?(Layout.isLayoutVisible=!0,t.show()):(Layout.isLayoutVisible=!1,t.hide()),this.adjustTextEditorHeight(r)},Layout.showHideTextEditor=function(e){var t=jQuery(editorHandle),r=jQuery("#buttonShowHideLayoutEditor"),a=jQuery(".layoutListItem");e==null&&(e=!this.isTextVisible),e?(t.show(),this.isTextVisible=!0,r.prop("disabled",!1),r.css("cursor","pointer"),a.css("color","Black"),jQuery("#linetext").show(),Page.setUmpleCode(Page.getUmpleCode())):(t.hide(),this.isTextVisible=!1,r.prop("disabled",!0),r.css("cursor","not-allowed"),a.css("color","DimGray"),jQuery("#linetext").hide()),this.layoutHandler.showHideResizableAdjustment(),this.layoutHandler.showHideResize()},Layout.showHideCanvas=function(e){var t=jQuery(canvasHandle);e==null&&(e=!this.isDiagramVisible),e?(t.show(),this.isDiagramVisible=!0,Action.manualSync=jQuery("#buttonManualSync").prop("checked"),jQuery("#buttonShowHideCanvas").prop("checked",!0),Action.manualSync||(Action.updateUmpleDiagram(),Action.diagramInSync=!0,Page.enableDiagram(!0)),Action.manualSync&&!Action.diagramInSync&&Page.enablePaletteItem("buttonSyncDiagram",!0),(!Action.manualSync||Action.diagramInSync)&&(Page.enableCheckBoxItem("buttonPhotoReady","ttPhotoReady",!0),Page.enableCheckBoxItem("buttonManualSync","ttManualSync",!0),Page.enablePaletteItem("buttonAddClass",!0),Page.enablePaletteItem("buttonAddAssociation",!0),Page.enablePaletteItem("buttonAddTransition",!0),Page.enablePaletteItem("buttonAddGeneralization",!0),Page.enablePaletteItem("buttonDeleteEntity",!0),Page.initToggleTool("buttonAddClass"),Page.initToggleTool("buttonAddAssociation"),Page.initToggleTool("buttonAddTransition"),Page.initToggleTool("buttonAddGeneralization"),Page.initToggleTool("buttonDeleteEntity"))):(t.hide(),this.isDiagramVisible=!1,Action.manualSync=!0,jQuery("#buttonShowHideCanvas").prop("checked",!1),Page.enableCheckBoxItem("buttonPhotoReady","ttPhotoReady",!1),Page.enableCheckBoxItem("buttonManualSync","ttManualSync",!1),Page.enablePaletteItem("buttonAddClass",!1),Page.enablePaletteItem("buttonAddAssociation",!1),Page.enablePaletteItem("buttonAddTransition",!1),Page.enablePaletteItem("buttonAddGeneralization",!1),Page.enablePaletteItem("buttonDeleteEntity",!1),Page.enablePaletteItem("buttonSyncDiagram",!1),Page.removeToggleTool("buttonAddClass"),Page.removeToggleTool("buttonAddAssociation"),Page.removeToggleTool("buttonAddTransition"),Page.removeToggleTool("buttonAddGeneralization"),Page.removeToggleTool("buttonDeleteEntity")),this.layoutHandler.showHideResizableAdjustment(),this.layoutHandler.showHideResize()},Layout.showHideMenu=function(e){var t=jQuery("#paletteColumn");e==null&&(e=!this.isPaletteVisible),e?(Layout.isPaletteVisible=!0,t.show()):(Layout.isPaletteVisible=!1,t.hide()),this.layoutHandler.showHideResizableAdjustment(),this.layoutHandler.showHideResize()},Layout.zoomResize=function(){var e=this.checkLayoutNeeded();e.layoutType==="large"?this.isInSmallScreenMode&&this.toggleSmallScreenMode():e.layoutType==="small"&&(this.isInSmallScreenMode||this.toggleSmallScreenMode()),this.layoutHandler.adjustAfterWindowResize()},Layout.toggleSmallScreenMode=function(){this.isInSmallScreenMode?(this.isInSmallScreenMode=!1,this.layoutHandler=new LargeScreenManager):(this.isInSmallScreenMode=!0,this.layoutHandler=new SmallScreenManager),this.layoutHandler.transition(!1)},Layout.verticallyResizing=function(e,t){this.layoutHandler.verticallyResizing(e,t)},Layout.verticallyResized=function(e,t){this.layoutHandler.verticallyResized(e,t)},Layout.editorResizing=function(e,t){this.layoutHandler.editorResizing(e,t)},Layout.editorResized=function(e,t){this.layoutHandler.editorResized(e,t)},Layout.canvasResizing=function(e,t){this.layoutHandler.canvasResizing(e,t)},Layout.canvasResized=function(e,t){this.layoutHandler.canvasResized(e,t)},Layout.calculateMainHeight=function(){return jQuery(paletteHandle).outerHeight()};function LargeScreenManager(){this.transition=function(e){if(!e){try{jQuery(editorHandle).resizable("destroy")}catch{}try{jQuery(paletteHandle).resizable("destroy")}catch{}try{jQuery(canvasHandle).resizable("destroy")}catch{}jQuery(editorHandle).removeClass("smallScreenEditor smallScreenEditorNoMargin"),jQuery(canvasHandle).removeClass("smallScreenCanvas smallScreenCanvasNoEditor smallScreenCanvasNoEditorNoPalette")}this.adjustMarginSpace(),this.heightFactor=1,this.minCanvasSize=new UmplePosition(0,0,420,50),this.minEditorSize=new UmplePosition(0,0,284,0);var t=jQuery("body").outerWidth(!0)-this.marginSpace-jQuery(paletteHandle).outerWidth()-this.minCanvasSize.width,r=jQuery("body").outerWidth(!0)-this.marginSpace-jQuery(paletteHandle).outerWidth()-this.minEditorSize.width;this.maxEditorSize=new UmplePosition(0,0,t,0),this.maxCanvasSize=new UmplePosition(0,0,r,0),this.initEditorResizable(),this.initCanvasResizable(),this.initVerticalResizable()},this.initUmpleCanvasSize=function(){this.initCanvasResizable(),this.setUmpleCanvasSize(this.minCanvasSize.width)},this.initUmpleTextAreaSize=function(){this.initEditorResizable(),this.setTextEditorSize(508,void 0),this.adjustAfterWindowResize()},this.initPaletteSize=function(){jQuery("#paletteColumn").height(this.calculateHeight()),jQuery("#palette").accordion("refresh"),this.initVerticalResizable()},this.setTextEditorSize=function(e,t){var r=jQuery(editorHandle);e==null&&(e=r.outerWidth()),t==null&&(t=Layout.calculateMainHeight()),e<this.minEditorSize.width?e=this.minEditorSize.width:Layout.isDiagramVisible||(e=e),r.outerWidth(e),Layout.adjustTextEditorHeight(t),Layout.isDiagramVisible&&this.setUmpleCanvasSize(this.calculateLeftoverWidth()+jQuery(canvasHandle).outerWidth(),void 0)},this.setUmpleCanvasSize=function(e,t){var r=jQuery(canvasHandle);e==null&&(e=r.outerWidth()),t==null&&(t=Layout.calculateMainHeight()),e<this.minCanvasSize.width&&(e=this.minCanvasSize.width),t<this.minCanvasSize.height&&(t=this.minCanvasSize.height),e>this.maxCanvasSize.width&&Layout.isTextVisible&&(e=this.maxCanvasSize.width),r.outerWidth(e),r.height(t),jQuery("#palette").accordion("refresh")},this.showHideResize=function(){this.adjustMarginSpace(),this.adjustMaxSizes(),Layout.isDiagramVisible&&!Layout.isTextVisible?this.setUmpleCanvasSize(this.calculateLeftoverWidth()+jQuery(canvasHandle).outerWidth(),void 0):Layout.isTextVisible&&this.setTextEditorSize(this.calculateLeftoverWidth()+jQuery(editorHandle).outerWidth(),void 0)},this.showHideResizableAdjustment=function(){if(!Layout.isDiagramVisible||!Layout.isTextVisible){try{jQuery(canvasHandle).resizable("destroy")}catch{}try{jQuery(editorHandle).resizable("destroy")}catch{}}else Layout.isDiagramVisible&&Layout.isTextVisible&&(this.initCanvasResizable(),this.initEditorResizable());if(jQuery(editorHandle).outerWidth()<this.minEditorSize.width||jQuery(canvasHandle).outerWidth()<this.minCanvasSize.width){try{jQuery(canvasHandle).resizable("destroy")}catch{}try{jQuery(editorHandle).resizable("destroy")}catch{}}else this.initCanvasResizable(),this.initEditorResizable();this.adjustMaxSizes()},this.adjustMaxSizes=function(){if(Layout.isDiagramVisible&&Layout.isTextVisible){var e=jQuery("body").outerWidth(!0)-this.marginSpace;Layout.isDiagramVisible&&(e-=this.minCanvasSize.width),Layout.isPaletteVisible&&(e-=jQuery(paletteHandle).outerWidth());var t=jQuery("body").outerWidth(!0)-this.marginSpace;Layout.isTextVisible&&(t-=this.minEditorSize.width),Layout.isPaletteVisible&&(t-=jQuery(paletteHandle).outerWidth()),this.maxEditorSize=new UmplePosition(0,0,e,0),this.maxCanvasSize=new UmplePosition(0,0,t,0),jQuery(editorHandle).outerWidth()>this.minEditorSize.width&&jQuery(canvasHandle).outerWidth()>this.minCanvasSize.width&&(jQuery(editorHandle).resizable("option","maxWidth",this.maxEditorSize.width),jQuery(canvasHandle).resizable("option","maxWidth",this.maxCanvasSize.width))}Action.setupPinch()},this.adjustAfterWindowResize=function(){this.adjustMaxSizes(),jQuery("#paletteColumn").height(this.calculateHeight()),jQuery("#palette").accordion("refresh");var e=this.calculateLeftoverWidth();jQuery(canvasHandle).outerWidth()<this.minCanvasSize.width&&jQuery(canvasHandle).outerWidth()+e>=this.minCanvasSize.width&&e>0||jQuery(canvasHandle).outerWidth()+e<=this.minCanvasSize.width&&e>0?this.setTextEditorSize(jQuery(editorHandle).outerWidth(),void 0):this.setTextEditorSize(e+jQuery(editorHandle).outerWidth(),void 0),this.showHideResizableAdjustment()},this.initVerticalResizable=function(){jQuery("#mainApplication").resizable({resize:function(e,t){Layout.verticallyResizing(e,t)},stop:function(e,t){Layout.verticallyResized(e,t)},autoHide:!0,minHeight:this.minCanvasSize.height,handles:"s"})},this.initEditorResizable=function(){!Layout.isTextVisible||!Layout.isDiagramVisible||jQuery(editorHandle).resizable({start:function(e,t){Layout.savedStartingWidth=jQuery(canvasHandle).outerWidth()},resize:function(e,t){Layout.editorResizing(e,t)},stop:function(e,t){Layout.editorResized(e,t)},autoHide:!0,minWidth:this.minEditorSize.width,maxWidth:this.maxEditorSize.width,handles:"e"})},this.initCanvasResizable=function(){if(!(!Layout.isTextVisible||!Layout.isDiagramVisible)){var e=jQuery(canvasHandle);e.resizable({start:function(t,r){Layout.savedStartingWidth=jQuery(editorHandle).outerWidth()},resize:function(t,r){Layout.canvasResizing(t,r)},stop:function(t,r){Layout.canvasResized(t,r)},autoHide:!0,minWidth:this.minCanvasSize.width,maxWidth:this.maxCanvasSize.width,handles:"w"})}},this.verticallyResizing=function(e,t){var r=t.size.height;jQuery(paletteHandle).outerHeight(r),jQuery(editorHandle).outerHeight(r),jQuery(canvasHandle).outerHeight(r),Layout.adjustTextEditorHeight(r),jQuery("#palette").accordion("refresh")},this.verticallyResized=function(e,t){this.heightFactor=jQuery("#mainApplication").outerHeight()/(jQuery(window).innerHeight()-jQuery("#header").outerHeight()-jQuery("#topLine").outerHeight()-parseInt(jQuery("body").css("marginBottom"))-parseInt(jQuery("body").css("marginTop"))),this.setTextEditorSize(void 0,t.size.height),jQuery("#mainApplication").css("height","auto")},this.editorResizing=function(e,t){var r=t.size.width,a=t.originalSize.width-r;jQuery(canvasHandle).outerWidth(Layout.savedStartingWidth+a),jQuery(modelEditorHandle).width(r),jQuery(layoutEditorHandle).width(r)},this.editorResized=function(e,t){var r=t.size.width;jQuery(modelEditorHandle).css("width","auto"),jQuery(layoutEditorHandle).css("width","auto"),this.setTextEditorSize(r,void 0),delete Layout.savedStartingWidth},this.canvasResizing=function(e,t){var r=t.size.width;jQuery(canvasHandle).outerWidth(r);var a=r-t.originalSize.width;jQuery(editorHandle).width(Layout.savedStartingWidth-a),jQuery(modelEditorHandle).width(Layout.savedStartingWidth-a),jQuery(layoutEditorHandle).width(Layout.savedStartingWidth-a),jQuery(canvasHandle).css("left","0px"),Action.setupPinch()},this.canvasResized=function(e,t){var r=t.size.width;jQuery(modelEditorHandle).css("width","auto"),jQuery(layoutEditorHandle).css("width","auto"),this.setTextEditorSize(this.calculateLeftoverWidth()+jQuery(editorHandle).outerWidth(),void 0),delete this.savedStartingWidth},this.adjustMarginSpace=function(){jQuery(editorHandle).removeClass("largeScreenEditor largeScreenEditorNoMargin"),jQuery(canvasHandle).removeClass("largeScreenCanvas largeScreenCanvasNoMargin"),Layout.isTextVisible?Layout.isDiagramVisible&&Layout.isPaletteVisible?(jQuery(editorHandle).addClass("largeScreenEditor"),jQuery(canvasHandle).addClass("largeScreenCanvas")):Layout.isDiagramVisible||Layout.isPaletteVisible?(jQuery(editorHandle).addClass("largeScreenEditor"),jQuery(canvasHandle).addClass("largeScreenCanvasNoMargin")):(jQuery(editorHandle).addClass("largeScreenEditorNoMargin"),jQuery(canvasHandle).addClass("largeScreenCanvasNoMargin")):(jQuery(editorHandle).addClass("largeScreenEditorNoMargin"),Layout.isDiagramVisible&&Layout.isPaletteVisible?jQuery(canvasHandle).addClass("largeScreenCanvas"):jQuery(canvasHandle).addClass("largeScreenCanvasNoMargin")),this.marginSpace=parseInt(jQuery("body").css("marginLeft"))+parseInt(jQuery("body").css("marginRight"))+1+parseInt(jQuery(canvasHandle).css("marginLeft"))+parseInt(jQuery(editorHandle).css("marginRight"))},this.calculateLeftoverWidth=function(){var e=jQuery("body").outerWidth(!0)-this.marginSpace;return Layout.isTextVisible&&(e-=jQuery(editorHandle).outerWidth()),Layout.isDiagramVisible&&(e-=jQuery(canvasHandle).outerWidth()),Layout.isPaletteVisible&&(e-=jQuery(paletteHandle).outerWidth()),e},this.calculateHeight=function(){var e=TabControl.isHidden()?0:jQuery("#tabControl").outerHeight(),t=jQuery("#taskArea").css("display")=="none"?0:jQuery("#taskArea").outerHeight();t>jQuery(window).innerHeight()/2&&(t=0);var r=(jQuery(window).innerHeight()-jQuery("#header").outerHeight()-jQuery("#topLine").outerHeight()-e-parseInt(jQuery("body").css("marginBottom"))-parseInt(jQuery("body").css("marginTop"))-Layout.errorMessageSpace)*this.heightFactor-t;return r<this.minCanvasSize.height?this.minCanvasSize.height:r}}function SmallScreenManager(){this.transition=function(e){if(!e){try{jQuery(editorHandle).resizable("destroy")}catch{}try{jQuery(canvasHandle).resizable("destroy")}catch{}try{jQuery("#mainApplication").resizable("destroy")}catch{}jQuery(editorHandle).removeClass("largeScreenEditor largeScreenEditorNoMargin"),jQuery(canvasHandle).removeClass("largeScreenCanvas largeScreenCanvasNoMargin")}this.adjustMarginSpace(),this.minCanvasSize=new UmplePosition(0,0,420,50),this.minEditorSize=new UmplePosition(0,0,284,0),this.initEditorResizable(),this.initCanvasResizable(),this.initPaletteResizable()},this.initUmpleCanvasSize=function(){this.setUmpleCanvasSize(void 0,this.calculateHeight()),this.initCanvasResizable(),this.initPaletteResizable(),Layout.isDiagramVisible==!1&&Layout.showHideCanvas(!1)},this.initUmpleTextAreaSize=function(){this.setTextEditorSize(),this.initEditorResizable()},this.initPaletteSize=function(){jQuery("#paletteColumn").outerHeight(this.calculateHeight()),jQuery("#palette").accordion("refresh")},this.setTextEditorSize=function(r,t){var r=this.calculateLeftoverWidth();Layout.isPaletteVisible,jQuery(editorHandle).outerWidth(r),t!=null?Layout.adjustTextEditorHeight(t):Layout.adjustTextEditorHeight(this.calculateHeight())},this.setUmpleCanvasSize=function(e,t){Layout.isTextVisible?jQuery(canvasHandle).outerWidth(jQuery("body").width()):jQuery(canvasHandle).outerWidth(this.calculateLeftoverWidth()),t!=null&&jQuery(canvasHandle).outerHeight(t)},this.showHideResize=function(){var e=void 0;this.adjustMarginSpace(),Layout.isTextVisible?this.setTextEditorSize(void 0,jQuery(paletteHandle).outerHeight()):e=jQuery(paletteHandle).outerHeight(),jQuery("#palette").accordion("refresh"),this.pairResizables(),this.setUmpleCanvasSize(void 0,e)},this.showHideResizableAdjustment=function(){},this.adjustAfterWindowResize=function(){jQuery("#paletteColumn").outerHeight(this.calculateHeight()),jQuery("#palette").accordion("refresh"),this.setTextEditorSize(),this.setUmpleCanvasSize(void 0,this.calculateHeight())},this.initEditorResizable=function(){jQuery(editorHandle).resizable({autoHide:!0,minHeight:30,handles:"s"}),this.pairResizables()},this.initPaletteResizable=function(){jQuery(paletteHandle).resizable({autoHide:!0,minHeight:30,handles:"s"}),this.pairResizables()},this.initCanvasResizable=function(){jQuery(canvasHandle).resizable({autoHide:!0,minHeight:30,handles:"s"}),this.pairResizables()},this.verticallyResizing=function(e,t){jQuery(paletteHandle).outerHeight(t.size.height),jQuery("#palette").accordion("refresh")},this.verticallyResized=function(e,t){},this.editorResizing=function(e,t){Layout.adjustTextEditorHeight(t.size.height)},this.editorResized=function(e,t){},this.canvasResizing=function(e,t){jQuery(canvasHandle).outerHeight(t.size.height)},this.canvasResized=function(e,t){},this.adjustMarginSpace=function(){jQuery(canvasHandle).removeClass("smallScreenCanvas smallScreenCanvasNoEditor smallScreenCanvasNoEditorNoPalette"),jQuery(editorHandle).removeClass("smallScreenEditor smallScreenEditorNoMargin"),Layout.isTextVisible?(jQuery(canvasHandle).addClass("smallScreenCanvas"),Layout.isPaletteVisible?jQuery(editorHandle).addClass("smallScreenEditor"):jQuery(editorHandle).addClass("smallScreenEditorNoMargin")):(jQuery(editorHandle).addClass("smallScreenEditorNoMargin"),Layout.isPaletteVisible&&Layout.isDiagramVisible?jQuery(canvasHandle).addClass("smallScreenCanvasNoEditor"):jQuery(canvasHandle).addClass("smallScreenCanvasNoEditorNoPalette")),this.marginSpace=parseInt(jQuery("body").css("marginLeft"))+parseInt(jQuery("body").css("marginRight"))+1+parseInt(jQuery(editorHandle).css("marginRight"))+parseInt(jQuery(canvasHandle).css("marginLeft"))},this.calculateLeftoverWidth=function(){return Layout.isPaletteVisible?jQuery("body").outerWidth(!0)-this.marginSpace-jQuery(paletteHandle).outerWidth():jQuery("body").outerWidth(!0)-this.marginSpace},this.calculateHeight=function(){var e=TabControl.isHidden()?0:jQuery("#tabControl").outerHeight(),t=jQuery("#taskArea").css("display")=="none"?0:jQuery("#taskArea").outerHeight();t>jQuery(window).innerHeight()/2&&(t=0);var r=(jQuery(window).innerHeight()-jQuery("#header").outerHeight(!0)-2*jQuery("#topLine").outerHeight(!0)-e-Layout.errorMessageSpace)/2-t;return r},this.pairResizables=function(){if(!(!jQuery(editorHandle).is(".ui-resizable")||!jQuery(paletteHandle).is(".ui-resizable")||!jQuery(canvasHandle).is(".ui-resizable"))){if(Layout.isTextVisible)var e=function(u,s){Layout.editorResizing(u,s),Layout.verticallyResizing(u,s)},t=e,r=function(u,s){Layout.canvasResizing(u,s)},a=function(u,s){Layout.editorResized(u,s),Layout.verticallyResized(u,s)},n=a,o=function(u,s){Layout.canvasResized(u,s)};else var e=function(m,T){Layout.editorResizing(m,T)},r=function(m,T){Layout.canvasResizing(m,T),Layout.verticallyResizing(m,T)},t=r,a=function(m,T){Layout.editorResized(m,T)},o=function(m,T){Layout.canvasResized(m,T),Layout.verticallyResized(m,T)},n=o;jQuery(editorHandle).resizable("option","resize",e),jQuery(editorHandle).resizable("option","stop",a),jQuery(paletteHandle).resizable("option","resize",t),jQuery(paletteHandle).resizable("option","stop",n),jQuery(canvasHandle).resizable("option","resize",r),jQuery(canvasHandle).resizable("option","stop",o)}}}function UmpleLine(e,t){this.pointOne=e,this.pointTwo=t,this.drawable=function(r){var a=jQuery("<div class='umpleLine'></div>"),n=UmplePositionFactory.copy(this.pointOne),o=UmplePositionFactory.copy(this.pointTwo);typeof r<"u"&&(n.x=n.x+r.x,n.y=n.y+r.y,o.x=o.x+r.x,o.y=o.y+r.y);var u=0;if(n.y==o.y){var s=n.x<o.x?n:o,d=Math.abs(o.x-n.x);return a.append(this.createConnector(s.x,s.y,d,1)),a.append(this.createSelector(s.x,s.y,d,6)),a}else if(n.x==o.x){var s=n.y<o.y?n:o,c=Math.abs(o.y-n.y);return a.append(this.createConnector(s.x,s.y,1,c)),a.append(this.createSelector(s.x,s.y,6,c)),a}var h=this.slope(),C=o.x>n.x?1:-1,m=C*h;Math.abs(h)>1&&(m=o.y>n.y?1:-1,C=m*(1/h));for(var T=0,S=n.y,P=n.x;(P<=o.x&&C>0||P>=o.x&&C<0)&&!(T++>1e3);P+=C)a.append(this.createConnector(P,S,1,1)),a.append(this.createSelector(P,S,6,6)),S+=m,u++;return a},this.slope=function(){return slope=(this.pointTwo.y-this.pointOne.y)/(this.pointTwo.x-this.pointOne.x),slope},this.length=function(){var r=this.pointTwo.x-this.pointOne.x,a=this.pointTwo.y-this.pointOne.y,n=Math.sqrt(Math.pow(r,2)+Math.pow(a,2));return Math.round(n)},this.createConnector=function(r,a,n,o){var u=jQuery("<div></div>");return u.addClass("umpleAssociation"),u.attr("name",this.startId),u.css({position:"absolute",left:r,top:a,width:n,height:o}),u},this.createSelector=function(r,a,n,o){var u=jQuery("<div></div>");return u.addClass("umpleAssociationSelector"),u.attr("name",this.startId),u.css({position:"absolute",left:r,top:a,width:n,height:o}),u},this.intersection=function(r){var a=this.pointOne.x,n=this.pointOne.y,o=this.pointTwo.x,u=this.pointTwo.y,s=r.pointOne.x,d=r.pointOne.y,c=r.pointTwo.x,h=r.pointTwo.y,C=this.slope(),m=r.slope(),T=null,S=null,P=null,_=null,F=!1;if(C==m)return null;C==1/0||C==-1/0?(_=d-m*s,T=a,S=m*T+_,F=!0):(m==1/0||m==-1/0)&&(P=n-C*a,T=s,S=C*T+P,F=!0),F||(P=n-C*a,_=d-m*s,T=(_-P)/(C-m),S=C*T+P);var g=o>a?o:a,b=c>s?c:s,k=u>n?u:n,L=h>d?h:d,A=g==o?a:o,E=b==c?s:c,j=k==u?n:u,D=L==h?d:h;return T<A||T<E||T>g||T>b||S<j||S<D||S>k||S>L?null:(T=Math.round(T),S=Math.round(S),new UmplePosition(T,S,0,0))}}UmpleMethodFactory=new Object,UmpleMethodFactory.create=function(e){var t=new UmpleMethod(e.visibility,e.isAbstract,e.type,e.name,e.parameters);return t};function UmpleMethod(e,t,r,a,n){this.visibility=e,this.isAbstract=t,this.type=r,this.name=a,this.parameters=typeof n=="string"?n.split(","):n,this.set=function(o){var u=this.name!="";u&&(this.oldVisibility=this.visibility,this.oldType=this.type,this.oldName=this.name,this.oldParameters=this.parameters),o=o.trim();var s=o.charAt(0);s=="+"?(this.visibility="public",o=o.substr(1)):s=="-"?(this.visibility="private",o=o.substr(1)):s=="#"?(this.visibility="protected",o=o.substr(1)):this.visibility="public";var d=o.split(":");if(d.length<2)this.type="void",this.name=o.substring(0,o.indexOf("(")).trim(),this.parameters=o.match("\\((.*)\\)")[1].replace(/\s+/g,"").split(",");else{var c=d[0].trim();this.type=d[1].trim(),this.name=c.substring(0,c.indexOf("(")).trim(),this.parameters=c.match("\\((.*)\\)")[1].replace(/\s+/g,"").split(",")}u||(this.newVisibility=this.visibility,this.newType=this.type,this.newName=this.name,this.newParameters=this.parameters)},this.copy=function(){return new UmpleMethod(this.visibility,this.type,this.name,this.parameters)}}Page=new Object,Page.currentUmpleTextBeingEdited="",Page.selectedItem=null,Page.selectedClass=null,Page.selectedAssociation=null,Page.selectedTransition=null,Page.selectedGeneralization=null,Page.canEditTask=!1,Page.canCreateTask=!0,Page.codeEffect=null,Page.clickCount=0,Page.repeatToolItem=!1,Page.shortcutsEnabled=!0,Page.diagramSyncNeededAppend=!1,Page.modelDelimiter="//$?[End_of_model]$?",Page.codeMirrorOn=!1,Page.codeMirrorEditor=null,Page.codeMirrorEditor6=null,Page.hLine=null,Page.modelLoadingCount=0,Page.layoutLoadingCount=0,Page.canvasLoadingCount=0,Page.onLoadingCompleteCallbacks=[],Page.readOnly=!1,Page.useEditableClassDiagram=!0,Page.useGvClassDiagram=!1,Page.useGvStateDiagram=!1,Page.useGvFeatureDiagram=!1,Page.showFeatureDependency=!1,Page.useStructureDiagram=!1,Page.useFeatureDiagram=!1,Page.showAttributes=!0,Page.showMethods=!1,Page.showActions=!0,Page.showText=!0,Page.showCanvas=!0,Page.showTraits=!1,Page.showTransitionLabels=!1,Page.showGuardLabels=!1,Page.showGuards=!0,Page.modifiedDiagrams=!1,Page.allowPinch=!1,Page.blahblah=function(e){console.log("In blah blah "+e)},Page.init=function(e,t,r,a,n,o,u,s,d,c){performance.navigation.type==2&&location.reload(!0),Page.canEditTask=d,Page.canCreateTask=c,Layout.isDiagramVisible=e,Layout.isTextVisible=t,Layout.isPaletteVisible=r,Layout.isLayoutVisible=n,Page.readOnly=a,TabControl.init(),jQuery(".layoutListItem").hide(),o=="GvState"?(Page.useGvStateDiagram=!0,Page.useEditableClassDiagram=!1,Page.setDiagramTypeIconState("GvState"),Page.useGvFeatureDiagram=!1,jQuery(".view_opt_state").show()):o=="GvClass"?(Page.useGvClassDiagram=!0,Page.useEditableClassDiagram=!1,Page.setDiagramTypeIconState("GvClass"),Page.useGvFeatureDiagram=!1,jQuery(".view_opt_class").show()):o=="GvClassTrait"?(Page.useGvClassDiagram=!0,Page.useEditableClassDiagram=!1,Page.setDiagramTypeIconState("GvClass"),Page.useGvFeatureDiagram=!1,Page.showTraits=!0,jQuery(".view_opt_class").show()):o=="GvFeature"?(Page.useGvFeatureDiagram=!0,Page.useEditableClassDiagram=!1,Page.useGvStateDiagram=!1,Page.useStructureDiagram=!1,Page.setDiagramTypeIconState("GvFeature"),jQuery(".view_opt_feature").show()):o=="structureDiagram"?(Page.useStructureDiagram=!0,Page.useEditableClassDiagram=!1,Page.setDiagramTypeIconState("structureDiagram"),Page.useGvFeatureDiagram=!1):(jQuery(".view_opt_class").show(),jQuery(".view_opt_class_palette").show()),jQuery.noConflict(),jQuery(document).keydown(function(h){Action.keyboardShortcut(h)}),Layout.init(),Page.initPaletteArea(),Page.initCanvasArea(),Page.initUmpleTextArea(),Page.initSourceCodeArea(),Page.initCodeExecutionArea(),jQuery(document).ready(function(){DropboxInitializer.initializeDropbox(),ToolTips.initTooltips()}),Page.readOnly&&jQuery("#"+Page.umpleCanvasId()).addClass("photoReady"),Action.loadFile(),s&&Action.loadTask(jQuery("#model").val().split("-")[1],!0),jQuery(u).prop("selected",!0)},Page.initPaletteArea=function(){var e="#palette",t=e+" *";jQuery(e).accordion({heightStyle:"fill",fillSpace:!0,active:1,collapsible:!0}),jQuery(t).addClass("unselectable"),Layout.initPaletteSize(),Page.initJQueryButton("buttonGenerateCode"),Page.initJQueryButton("buttonExecuteCode"),Page.initJQueryButton("buttonStartOver"),Page.initJQueryButton("buttonShowRefreshUmpleOnlineCompletely"),Page.initJQueryButton("buttonLoadBlankModel"),Page.initHighlighter("buttonAddClass"),Page.initHighlighter("buttonAddAssociation"),Page.initHighlighter("buttonAddTransition"),Page.initHighlighter("buttonAddGeneralization"),Page.initHighlighter("buttonDeleteEntity"),Page.initHighlighter("buttonPngImage"),Page.initHighlighter("buttonYumlImage"),Page.initHighlighter("buttonSimulateCode"),Page.initHighlighter("buttonUigu"),Page.initHighlighter("buttonCopyClip"),Page.initHighlighter("buttonCollabFork"),Page.initHighlighter("buttonCopy"),Page.initHighlighter("buttonCopyEncodedURL"),Page.initHighlighter("buttonCopyCommandLine"),Page.initHighlighter("buttonCopyLocalBrowser"),Page.initHighlighter("buttonLoadLocalBrowser"),Page.canEditTask&&(Page.initHighlighter("buttonRequestAllZip"),Page.initHighlighter("buttonRequestLoadTaskURL")),Page.canCreateTask&&Page.initHighlighter("buttonCreateTask"),Page.initHighlighter("buttonLoadTask"),Page.initHighlighter("buttonDownloadFiles"),Page.initHighlighter("buttonSmaller"),Page.initHighlighter("buttonLarger"),Page.initHighlighter("buttonSyncCode"),Page.initHighlighter("buttonSyncDiagram"),Page.initHighlighter("buttonToggleMethods"),Page.initHighlighter("buttonToggleAttributes"),Page.initHighlighter("buttonToggleActions"),Page.initHighlighter("buttonToggleTransitionLabels"),Page.initHighlighter("buttonToggleGuards"),Page.initHighlighter("buttonToggleGuardLabels"),Page.initHighlighter("buttonToggleTraits"),Page.initHighlighter("buttonToggleFeatureDependency"),Page.initHighlighter("buttonallowPinch"),Page.initHighlighter("buttonReindent"),Page.initToggleTool("buttonAddClass"),Page.initToggleTool("buttonAddAssociation"),Page.initToggleTool("buttonAddTransition"),Page.initToggleTool("buttonAddGeneralization"),Page.initToggleTool("buttonDeleteEntity"),Page.initAction("buttonPngImage"),Page.initAction("buttonYumlImage"),Page.initAction("buttonPhpCode"),Page.initAction("buttonEcoreCode"),Page.initAction("buttonJavaCode"),Page.initAction("buttonJavaAPIDoc"),Page.initAction("buttonRubyCode"),Page.initAction("buttonAlloyCode"),Page.initAction("buttonNuSMVCode"),Page.initAction("buttonSqlCode"),Page.initAction("buttonCppCode"),Page.initAction("buttonPhotoReady"),Page.initAction("buttonSimulateCode"),Page.initAction("buttonShowHideTextEditor"),Page.initAction("buttonShowHideCanvas"),Page.initAction("buttonShowEditableClassDiagram"),Page.initAction("buttonShowJointJSClassDiagram"),Page.initAction("buttonShowGvClassDiagram"),Page.initAction("buttonShowGvStateDiagram"),Page.initAction("buttonShowGvFeatureDiagram"),Page.initAction("buttonShowStructureDiagram"),Page.initAction("buttonShowHideLayoutEditor"),Page.initAction("buttonManualSync"),Page.initAction("buttonCopyClip"),Page.initAction("buttonCollabFork"),Page.initAction("buttonCopy"),Page.initAction("buttonCopyEncodedURL"),Page.initAction("buttonCopyCommandLine"),Page.initAction("buttonCopyLocalBrowser"),Page.initAction("buttonLoadLocalBrowser"),Page.canEditTask&&(Page.initAction("buttonRequestAllZip"),Page.initAction("buttonRequestLoadTaskURL")),Page.canCreateTask&&Page.initAction("buttonCreateTask"),Page.initAction("buttonLoadTask"),Page.initAction("buttonDownloadFiles"),Page.initAction("buttonUndo"),Page.initAction("buttonRedo"),Page.initAction("buttonReindent"),Page.initAction("buttonUigu"),Page.initAction("buttonStartOver"),Page.initAction("buttonShowRefreshUmpleOnlineCompletely"),Page.initAction("buttonLoadBlankModel"),Page.initAction("buttonGenerateCode"),Page.initAction("buttonExecuteCode"),Page.initAction("buttonTabsCheckbox"),Page.initAction("buttonSmaller"),Page.initAction("buttonLarger"),Page.initAction("buttonSyncCode"),Page.initAction("buttonSyncDiagram"),Page.initAction("buttonToggleMethods"),Page.initAction("buttonToggleAttributes"),Page.initAction("buttonToggleActions"),Page.initAction("buttonToggleTraits"),Page.initAction("buttonToggleFeatureDependency"),Page.initAction("buttonToggleTransitionLabels"),Page.initAction("buttonToggleGuards"),Page.initAction("buttonToggleGuardLabels"),Page.initAction("buttonAllowPinch"),Page.initLabels(),Page.enablePaletteItem("buttonUndo",!1),Page.enablePaletteItem("buttonRedo",!1),Page.enablePaletteItem("buttonSyncDiagram",!1),Page.enablePaletteItem("buttonAddTransition",!1),jQuery("#genstatus").hide(),jQuery("#buttonViewComplete").hide(),Page.initExamples(),Page.initOptions(),Page.readOnly&&(jQuery("#mainDrawMenu").hide(),jQuery(".layoutListItem").hide(),jQuery("#preferencesTitle").hide(),jQuery("#ttPhotoReady").hide(),jQuery("#ttManualSync").hide(),jQuery("#canvasSizeTitle").hide(),jQuery("#buttonSmaller").hide(),jQuery("#buttonLarger").hide(),jQuery("#menuBookmarkable").hide()),(Page.readOnly||!Layout.isPaletteVisible)&&jQuery("#topBookmarkable").hide(),Layout.isPaletteVisible||jQuery("#paletteColumn").hide(),Layout.isTextVisible||(Page.readOnly?jQuery("#topLine").hide():jQuery("#linetext").hide()),jQuery("#inputGenerateCode").on("change",function(){this.value.split(":")[1]==="Java"||this.value.split(":")[1]==="Python"?jQuery("#buttonExecuteCode").show():jQuery("#buttonExecuteCode").hide()})},Page.initOptions=function(){jQuery("#buttonShowHideLayoutEditor").prop("checked",Layout.isLayoutVisible),jQuery("#buttonShowHideTextEditor").prop("checked",Layout.isTextVisible),jQuery("#buttonShowHideCanvas").prop("checked",Layout.isDiagramVisible),jQuery("#buttonTabsCheckbox").prop("checked",!1),jQuery("#tabRow").hide(),jQuery("#ttTabsCheckbox").hide(),jQuery("#buttonToggleAttributes").prop("checked",!0),jQuery("#buttonToggleActions").prop("checked",!0),jQuery("#buttonToggleTransitionLabels").prop("checked",!1),jQuery("#buttonToggleGuards").prop("checked",!0),jQuery("#buttonToggleGuardLabels").prop("checked",!1),jQuery("#buttonToggleTraits").prop("checked",Page.showTraits),jQuery("#buttonToggleFeatureDependency").prop("checked",!1),jQuery("#buttonAllowPinch").prop("checked",!1),Page.useEditableClassDiagram&&jQuery("#buttonShowEditableClassDiagram").prop("checked",!0),Page.useJointJSClassDiagram&&jQuery("#buttonShowJointJSClassDiagram").prop("checked",!0),Page.useGvClassDiagram&&jQuery("#buttonShowGvClassDiagram").prop("checked",!0),Page.useGvFeatureDiagram&&jQuery("#buttonShowGvFeatureDiagram").prop("checked",!0),Page.useGvStateDiagram&&jQuery("#buttonShowGvStateDiagram").prop("checked",!0),Page.useStructureDiagram&&jQuery("#buttonShowStructureDiagram").prop("checked",!0),jQuery("#buttonPhotoReady").prop("checked",!1),jQuery("#buttonManualSync").prop("checked",!1),jQuery("#buttonShowHideTextEditor").prop("disabled",!1),jQuery("#buttonShowHideCanvas").prop("disabled",!1),jQuery("#buttonPhotoReady").prop("disabled",!1),jQuery("#buttonManualSync").prop("disabled",!1)},Page.initHighlighter=function(e){var t="#"+e;jQuery(t).mouseover(function(){Page.highlightItem(e)}),jQuery(t).mouseout(function(){Page.unhighlightItem(e)})},Page.removeHighlighter=function(e){var t="#"+e;jQuery(t).unbind("mouseover"),jQuery(t).unbind("mouseout")},Page.enableCheckBoxItem=function(e,t,r){var a=jQuery("#"+t),n=jQuery("#"+e);r?(n.prop("disabled",!1),n.css("cursor","pointer"),a.css("color","Black")):(n.prop("disabled",!0),n.css("cursor","not-allowed"),a.css("color","Silver"))},Page.enablePaletteItem=function(e,t){var r=jQuery("#"+e),a=!r.hasClass("disabled");a!=t&&(t?(r.removeClass(),r.prop("disabled",!0),Page.initHighlighter(e)):(r.removeClass(),r.addClass("disabled"),r.prop("disabled",!1),Page.removeHighlighter(e)))},Page.initToggleTool=function(e){var t=jQuery("#"+e);t.unbind().click(function(){Page.toggleToolItem(e,!1)}),t.dblclick(function(){Page.toggleToolItem(e,!0)})},Page.removeToggleTool=function(e){var t=jQuery("#"+e);t.unbind("click"),t.unbind("dblclick")},Page.initJQueryButton=function(e){var t="#"+e,r=jQuery(t).attr("value");jQuery(t).button({label:r,className:"jQuery-palette-button"})},Page.initAction=function(e){var t="#"+e;jQuery(t).click(Action.clicked)},Page.initLabels=function(){for(var e=jQuery(".buttonExtend"),t=0,r=e.length;t<r;t++){var a="#"+jQuery(e[t]).prop("id");jQuery(a).click((function(n){return function(){jQuery("#"+jQuery(n).prop("id").replace("label","button")).trigger("click")}})(a))}},Page.initUmpleTextArea=function(){var e=jQuery("#newEditor"),t=jQuery("#umpleLayoutEditorText");e.keyup(function(r){Action.freshLoad=!1,Action.umpleTyped(r)}),e.mousedown(function(){setTimeout('jQuery("#linenum").val(Action.getCaretPosition())',25)}),t.keyup(function(r){Action.freshLoad=!1,Action.setjustUpdateNowtoSaveLater(!1),Action.umpleCodeMirrorTypingActivity("layoutEditor")}),e.focusin(function(){Action.focusOn("umpleModelEditorText",!0)}),t.focus(function(){Action.focusOn("umpleLayoutEditorText",!0)}),e.focusout(function(){Action.focusOn("umpleModelEditorText",!1)}),t.blur(function(){Action.focusOn("umpleLayoutEditorText",!1)}),Page.initCodeMirrorEditor(),Layout.initUmpleTextAreaSize(),Layout.isTextVisible||Layout.showHideTextEditor(!1),Layout.isLayoutVisible||Layout.showHideLayoutEditor(!1)},Page.initCodeMirrorEditor=function(){const e=[{key:"Ctrl-E",run:function(){Page.clickShowEditableClassDiagram()}},{key:"Ctrl-J",run:function(){Page.clickShowJointJSClassDiagram()}},{key:"Ctrl-G",run:function(){Page.clickShowGvClassDiagram()}},{key:"Ctrl-S",run:function(){Page.clickShowGvStateDiagram()}},{key:"Ctrl-L",run:function(){Page.clickShowStructureDiagram()}},{key:"Ctrl-T",run:function(){Page.clickShowHideText()}},{key:"Shift-Ctrl-Alt-T",run:function(){Page.clickShowHideText()}},{key:"Ctrl-D",run:function(){Page.clickShowHideCanvas()}},{key:"Ctrl-N",run:function(){Page.clickShowHideMenu()}},{key:"trl-Alt-N",run:function(){Page.clickShowHideMenu()}},{key:"Ctrl-Shift-=",run:function(){Page.clickButtonlarger()}},{key:"Ctrl-Shift--",run:function(){Page.clickButtonSmaller()}},{key:"Shift-Ctrl-A",run:function(){Page.clickToggleAttributes()}},{key:"Ctrl-M",run:function(){Page.clickToggleMethods()}},{key:"Ctrl-R",run:function(){Page.clickToggleTraits()}},{key:"Ctrl-I",run:function(){Page.clickToggleTransitionLabels()}},{key:"Ctrl-K",run:function(){Page.clickToggleGuardLabels()}},{key:"Ctrl-O",run:function(){Page.copyCommandLineCode()}},{key:"Ctrl-B",run:function(){Page.promptAndExecuteTest()}},{key:"Esc",run:function(r){r.getInputField().blur()}}],t=cm6.createEditorState(document.getElementById("newEditor").value,{extensions:[]});Page.codeMirrorEditor6=cm6.createEditorView(t,document.getElementById("newEditor")),Page.codeMirrorEditor6.dispatch({effects:cm6.StateEffect.appendConfig.of(cm6.changeListenerPlugin)}),Page.readOnly&&Page.codeMirrorEditor6.dispatch({effects:cm6.editableCompartment.reconfigure(cm6.EditorView.editable.of(!1))}),Page.setCodeMirror6Text=function(r){Page.codeMirrorEditor6.dispatch({changes:{from:0,to:Page.codeMirrorEditor6.state.doc.length,insert:r}})},Page.codeMirrorEditor6.dom.addEventListener("mousedown",function(){Action.umpleCodeMirrorCursorActivity()}),Page.codeMirrorOn=!0},Page.setDiagramTypeIconState=function(e){for(buttonList=["ECD_button","GCD_button","SD_button"],i=0,l=buttonList.length;i<l;++i)document.getElementById(buttonList[i]).className="button2";switch(e){case"editableClass":document.getElementById("ECD_button").className="button2 active";break;case"GvClass":document.getElementById("GCD_button").className="button2 active";break;case"GvState":document.getElementById("SD_button").className="button2 active";break}},Page.setShowHideIconState=function(e){switch(e){case"SHT_button":Page.showText?document.getElementById(e).className="button2 active":document.getElementById(e).className="button2";break;case"SHD_button":Page.showCanvas?document.getElementById(e).className="button2 active":document.getElementById(e).className="button2";break;case"SHA_button":Page.showAttributes?document.getElementById(e).className="button2 active":document.getElementById(e).className="button2";break;case"SHM_button":Page.showMethods?document.getElementById(e).className="button2 active":document.getElementById(e).className="button2";break}},Page.clickShowEditableClassDiagram=function(){jQuery("#buttonShowEditableClassDiagram").trigger("click")},Page.clickShowJointJSClassDiagram=function(){jQuery("#buttonShowJointJSClassDiagram").trigger("click")},Page.clickShowGvClassDiagram=function(){jQuery("#buttonShowGvClassDiagram").trigger("click")},Page.clickShowGvStateDiagram=function(){jQuery("#buttonShowGvStateDiagram").trigger("click")},Page.clickShowGvFeatureDiagram=function(){jQuery("#buttonShowGvFeatureDiagram").trigger("click")},Page.clickShowStructureDiagram=function(){jQuery("#buttonShowStructureDiagram").trigger("click")},Page.clickShowHideText=function(){jQuery("#buttonShowHideTextEditor").trigger("click")},Page.clickShowHideCanvas=function(){jQuery("#buttonShowHideCanvas").trigger("click")},Page.clickShowHideMenu=function(){Layout.showHideMenu()},Page.clickButtonlarger=function(){jQuery("#buttonLarger").trigger("click")},Page.clickButtonSmaller=function(){jQuery("#buttonSmaller").trigger("click")},Page.clickToggleAttributes=function(){jQuery("#buttonToggleAttributes").trigger("click")},Page.clickToggleMethods=function(){jQuery("#buttonToggleMethods").trigger("click")},Page.clickToggleTraits=function(){jQuery("#buttonToggleTraits").trigger("click")},Page.clickToggleFeatureDependency=function(){jQuery("#buttonToggleFeatureDependency").trigger("click")},Page.clickToggleTransitionLabels=function(){jQuery("#buttonToggleTransitionLabels").trigger("click")},Page.clickToggleGuardLabels=function(){jQuery("#buttonToggleGuards").trigger("click")},Page.clickToggleGuardLabels=function(){jQuery("#buttonToggleGuardLabels").trigger("click")},Page.clickAllowPinch=function(){jQuery("#buttonAllowPinch").trigger("click")},Page.isPhotoReady=function(){if(Page.readOnly)return!0;var e="#buttonPhotoReady";return jQuery(e).prop("checked")},Page.initSourceCodeArea=function(){SyntaxHighlighter.config.clipboardSwf="scripts/clipboard.swf";var e="#generatedCodeRow";jQuery(e).hide()},Page.initCodeExecutionArea=function(){var e="#codeExecutionArea";jQuery(e).hide()},Page.showExecutionArea=function(){var e="#codeExecutionArea";jQuery(e).show()},Page.hideExecutionArea=function(){var e="#codeExecutionArea";jQuery(e).hide()},Page.hideGeneratedCode=function(){jQuery("#generatedCodeRow").hide(),jQuery("#innerGeneratedCodeRow").hide(),Page.useStructureDiagram||jQuery("#svgCanvas").hide()},Page.hideGeneratedCodeOnly=function(){jQuery("#generatedCodeRow").hide(),jQuery("#innerGeneratedCodeRow").hide()},Page.initCanvasArea=function(){var e=jQuery("#umpleCanvas");Layout.initUmpleCanvasSize(),e.click(function(t){Action.umpleCanvasClicked(t)}),e.mousemove(Action.mouseMove),e.focus(function(){Action.focusOn(Page.umpleCanvasId(),!0)}),e.blur(function(){Action.focusOn(Page.umpleCanvasId(),!1)}),e.delegate("[class$='editableDoubleClick']","dblclick",InlineEditor.handleOnClick),e.delegate("[class$='editableSingleClick']","click",InlineEditor.handleOnClick),Layout.isDiagramVisible||Layout.showHideCanvas(!1)},Page.setExamples=function(e){var t=e+".ump";jQuery("#inputExample").change(Action.loadExample),jQuery("#inputExample option").each(function(){if(this.value==t||this.value.startsWith("http")&&this.value.endsWith(t)){jQuery('#inputExample option[value = "'+t+'"]').attr("selected",!0);return}}),jQuery("#inputExampleType").change(Action.setExampleType),jQuery("#inputExample2").change(Action.loadExample),jQuery("#inputExample2 option").each(function(){if(this.value==t||this.value.startsWith("http")&&this.value.endsWith(t)){jQuery('#inputExample2 option[value = "'+t+'"]').attr("selected",!0);return}}),jQuery("#inputExample3").change(Action.loadExample),jQuery("#inputExample3 option").each(function(){if(this.value==t||this.value.startsWith("http")&&this.value.endsWith(t)){jQuery('#inputExample3 option[value = "'+t+'"]').attr("selected",!0);return}}),jQuery("#inputExample4").change(Action.loadExample),jQuery("#inputExample4 option").each(function(){if(this.value==t||this.value.startsWith("http")&&this.value.endsWith(t)){jQuery('#inputExample4 option[value = "'+t+'"]').attr("selected",!0);return}})},Page.initExamples=function(){jQuery("#inputExample").change(Action.loadExample),jQuery("#defaultExampleOption").attr("selected",!0),jQuery("#inputExampleType").change(Action.setExampleType),jQuery("#inputExample2").change(Action.loadExample),jQuery("#defaultExampleOption2").attr("selected",!0),jQuery("#inputExample3").change(Action.loadExample),jQuery("#defaultExampleOption3").attr("selected",!0),jQuery("#inputExample4").change(Action.loadExample),jQuery("#defaultExampleOption4").attr("selected",!0),Page.useStructureDiagram?(jQuery("#structureModels").prop("selected",!0),jQuery("#itemLoadExamples").hide(),jQuery("#itemLoadExamples2").hide(),jQuery("#itemLoadExamples4").hide()):Page.useGvStateDiagram?(jQuery("#smModels").prop("selected",!0),jQuery("#itemLoadExamples").hide(),jQuery("#itemLoadExamples3").hide(),jQuery("#itemLoadExamples4").hide()):Page.useGvFeatureDiagram?(jQuery("#featureModels").prop("selected",!0),jQuery("#itemLoadExamples").hide(),jQuery("#itemLoadExamples2").hide(),jQuery("#itemLoadExamples3").hide()):(jQuery("#cdModels").prop("selected",!0),jQuery("#itemLoadExamples2").hide(),jQuery("#itemLoadExamples3").hide(),jQuery("#itemLoadExamples4").hide())},Page.highlightItem=function(e){var t="#"+e;jQuery(t).addClass("highlight")},Page.unhighlightItem=function(e){var t="#"+e;jQuery(t).removeClass("highlight")},Page.enableDiagram=function(e){Page.enableEditDragAndResize(e),Page.enablePaletteItem("buttonAddClass",e),Page.enablePaletteItem("buttonAddAssociation",e),Page.enablePaletteItem("buttonAddGeneralization",e),Page.enablePaletteItem("buttonDeleteEntity",e),Page.showDiagramSyncNeeded(!e)},Page.enableTransition=function(e){Page.enablePaletteItem("buttonAddTransition",e),Page.enablePaletteItem("buttonAddAssociation",!e)},Page.enableEditDragAndResize=function(e){e?(jQuery("span.editable").removeClass("uneditable"),jQuery("div.umpleClass").removeClass("unselectable"),jQuery("div.umpleClass.ui-draggable").draggable({disabled:!1})):(jQuery("span.editable").addClass("uneditable"),jQuery("div.umpleClass").addClass("unselectable"),jQuery("div.umpleClass.ui-draggable").draggable({disabled:!0}),jQuery(":text").blur())},Page.toggleToolItem=function(e,t){t==null&&(t=!1),Page.repeatToolItem=t;var r=e.substring(6),a=r!=Page.selectedItem;a?Page.selectToggleTool(r):Page.unselectAllToggleTools()},Page.unselectAllToggleTools=function(){var e=!1,t=!1;t=DiagramEdit.removeNewClass(),t&&(e=!0),t=DiagramEdit.removeNewAssociation(),t&&(e=!0),t=DiagramEdit.removeNewTransition(),t&&(e=!0),t=DiagramEdit.removeNewGeneralization(),t&&(e=!0);var r="ul.toggle li.selected";return jQuery(r).removeClass("selected highlight"),setTimeout("Page.enableEditDragAndResize(true);",500),Page.selectedItem=null,Page.repeatToolItem=!1,e},Page.selectToggleTool=function(e){Page.selectedItem!=null&&(DiagramEdit.removeNewClass(),DiagramEdit.removeNewAssociation(),DiagramEdit.removeNewTransition(),DiagramEdit.removeNewGeneralization()),Page.enableEditDragAndResize(!1),Page.selectedItem=e,Action.unselectAll();var t=format("ul.toggle li.selected"),r="#button"+e;jQuery(t).removeClass("selected highlight"),jQuery(r).addClass("selected")},Page.canShowHovers=function(){return Page.selectedItem==null||Page.selectedItem=="DeleteEntity"},Page.getRawUmpleCode=function(){return document.getElementById("umpleModelEditorText").value},Page.getRawUmpleCodeCM6=function(){return Page.codeMirrorEditor6.state.doc.toString()},Page.getUmpleCode=function(){var e=Page.getRawUmpleCodeCM6().replace(Page.modelDelimiter,""),t=jQuery("#umpleLayoutEditorText").val().replace(Page.modelDelimiter,"");t!==""&&!t.includes("namespace -;")&&(t=`

namespace -;
`+t);var r=e+Page.modelDelimiter+t;return r},Page.getEncodedURL=function(){var e=window.location.href.split("?")[0];return e.substr(0,37)=="https://cruise.umple.org/umpleonline/"&&(e="http://try.umple.org/"),e+"?text="+encodeURIComponent(Page.getUmpleCode())},Page.splitUmpleCode=function(e){var t=e.indexOf(Page.modelDelimiter);if(t==-1)r=e,a="";else{e=e.replace(Page.modelDelimiter,"");var r=e.substr(0,t),a=e.substr(t,e.length)}var n=[r,a];return n},Page.setUmpleCode=function(e,t){var r=Page.splitUmpleCode(e);jQuery("#umpleLayoutEditorText").val(r[1]),Page.codeMirrorOn&&(typeof t=="boolean"&&t==!1||Page.setCodeMirror6Text(r[0])),Action.updateCurrentUmpleTextBeingEdited(r[0]),typeof t=="function"&&t()},Page.setUmplePositioningCode=function(e){jQuery("#umpleLayoutEditorText").val(e)},Page.umpleCanvasId=function(){return"umpleCanvas"},Page.createBookmark=function(){TabControl.useActiveTabTo(TabControl.saveTab)(Page.getUmpleCode()),TabControl.saveActiveTabs(),window.location.href="bookmark.php?model="+Page.getModel()},Page.createBookmarkFork=function(){TabControl.useActiveTabTo(TabControl.saveTab)(Page.getUmpleCode()),TabControl.saveActiveTabs(),window.location.href="bookmark.php?model="+Page.getModel()+"&forkSoMakeTmpOnly"},Page.createTask=function(){var e=jQuery("#taskName").val();if(!/^(\w|\.)+$/.test(e)){window.alert("Task Name can only contain letters(case insensitive), underscores, dots, and digits!");return}var r=jQuery("#requestorName").val(),a=jQuery("#instructions"),n=jQuery("#completionURL").val(),o=jQuery("#isExperiment").is(":checked");TabControl.useActiveTabTo(TabControl.saveTab)(Page.getUmpleCode()),TabControl.saveActiveTabs(),Ajax.sendRequest("task.php",Page.createTaskCallback,format("taskName={0}&instructions={1}&model={2}&requestorName={3}&completionURL={4}&isExperiment={5}",e,a.val(),Page.getModel(),r,n,o))},Page.createTaskCallback=function(e){e.responseText.split(" ")[0]=="Task"?window.alert("Not able to create a task with that name. "+e.responseText):window.location.href="umple.php?task=1&model="+e.responseText},Page.editTask=function(){var e=jQuery("#instructions"),t=jQuery("#model").val().split("-")[1],r=jQuery("#requestorName").val(),a=jQuery("#completionURL").val(),n=jQuery("#isExperiment").is(":checked");TabControl.useActiveTabTo(TabControl.saveTab)(Page.getUmpleCode()),TabControl.saveActiveTabs(),Ajax.sendRequest("task.php",Page.editTaskCallback,"edit=1&taskName="+t+"&instructions="+e.val()+"&model="+Page.getModel()+"&requestorName="+r+"&completionURL="+a+"&isExperiment="+n)},Page.editTaskCallback=function(e){Page.setFeedbackMessage("Changes saved")},Page.cancelTaskResponse=function(){var e=confirm("Are you sure to cancel this task response?");e&&(window.location.href="task.php?cancelTaskResponse=1&model="+Page.getModel())},Page.hideTask=function(){jQuery("#taskArea").css("display","none"),jQuery("#labelTaskName").css("display","none"),jQuery("#taskNameCell").css("display","none"),jQuery("#instructions").css("display","none"),jQuery("#isExperimentCell").css("display","none"),jQuery("#isExperiment").attr("checked",!1),Layout.zoomResize()},Page.cancelTask=function(){if(jQuery("#completionURL").val()!=""||jQuery("#taskName").val()!=""||jQuery("#requestorName").val()!=""||jQuery("#instructions").val()!=""){var e=confirm("Are you sure you want to end the task creation process?");e&&(jQuery("#taskName").val(""),jQuery("#requestorName").val(""),jQuery("#completionURL").val(""),jQuery("#instructions").val(""),Page.hideTask())}else Page.hideTask()},Page.endTaskEdit=function(){var e=confirm("Are you sure you want to end the task editing process?");e&&Page.hideTask()},Page.toggleTabs=function(){TabControl.isHidden()?TabControl.showTabs():TabControl.hideTabs(),Layout.layoutHandler.adjustAfterWindowResize()},Page.showDiagramSyncNeeded=function(e){var t=jQuery("#umpleCanvas"),r='<div id="syncNeededMessage" class="syncNeededMessage unselectable">Diagram is out of synchronization with the text due to selecting Manual Sync or an error in the text that has caused the compiler to produce no output. </div>';e&&!Page.diagramSyncNeededAppend?(t.append(r),Page.diagramSyncNeededAppend=!0,Page.readOnly=!0,UmpleSystem.redrawCanvas()):!e&&Page.diagramSyncNeededAppend&&(jQuery("#syncNeededMessage").remove(),Page.diagramSyncNeededAppend=!1,Page.readOnly=!1,UmpleSystem.redrawCanvas())},Page.hideLoading=function(){var e="#newEditor",t="#bottomTextEditor",r="#"+Page.umpleCanvasId();Page.modelLoadingCount>0&&Page.modelLoadingCount--,Page.layoutLoadingCount>0&&Page.layoutLoadingCount--,Page.canvasLoadingCount>0&&Page.canvasLoadingCount--,Page.modelLoadingCount===0&&jQuery(e).hideLoading(),Page.layoutLoadingCount===0&&jQuery(t).hideLoading(),Page.canvasLoadingCount===0&&jQuery(r).hideLoading(),Page.modelLoadingCount===0&&Page.layoutLoadingCount===0&&Page.canvasLoadingCount===0&&jQuery(".bookmarkableUrl").removeClass("disabled")},Page.showModelLoading=function(){var e=jQuery("#newEditor");Page.modelLoadingCount==0&&(jQuery("#textEditorColumn").is(":visible")&&e.showLoading(),jQuery(".bookmarkableUrl").addClass("disabled")),Page.modelLoadingCount++},Page.showLayoutLoading=function(){var e=jQuery("#bottomTextEditor");Page.layoutLoadingCount==0&&(jQuery(".bookmarkableUrl").addClass("disabled"),e.is(":visible")&&e.showLoading()),Page.layoutLoadingCount++},Page.showCanvasLoading=function(){var e=jQuery("#umpleCanvas");Page.canvasLoadingCount==0&&(jQuery(".bookmarkableUrl").addClass("disabled"),e.is(":visible")&&e.showLoading()),Page.canvasLoadingCount++},Page.resetCanvasSize=function(){Page.setUmpleCanvasSize(Layout.minCanvasSize.width,Layout.minCanvasSize.height)},Page.getSelectedExample=function(){var e="",t=Page.getExampleType();if(t=="cdModels"){var r=!1;e=jQuery("#inputExample option:selected").val(),e=="GeometricSystem.ump"&&(r=!0),r?Page.useGvClassDiagram||(jQuery("#buttonShowGvClassDiagram").attr("checked",!0),Action.changeDiagramType({type:"GvClass"})):Page.useEditableClassDiagram||Page.useGvClassDiagram||(jQuery("#buttonShowEditableClassDiagram").attr("checked",!0),Action.changeDiagramType({type:"editableClass"}))}else t=="featureModels"?(e=jQuery("#inputExample4 option:selected").val(),Page.useGvFeatureDiagram||(jQuery("#buttonShowGvFeatureDiagram").attr("checked",!0),Action.changeDiagramType({type:"GvFeature"}))):t=="smModels"?(e=jQuery("#inputExample2 option:selected").val(),!Page.useGvStateDiagram&&!Page.useJointJSClassDiagram&&(jQuery("#buttonShowGvStateDiagram").attr("checked",!0),Action.changeDiagramType({type:"GvState"}))):(e=jQuery("#inputExample3 option:selected").val(),Page.useStructureDiagram||(jQuery("#buttonShowStructureDiagram").attr("checked",!0),Action.changeDiagramType({type:"structure"})));return e},Page.getExampleType=function(){var e=jQuery("#exampleType option:selected").val();return e},Page.showCodeDone=function(){var e="#genstatus";jQuery(e).show(),setTimeout(function(){jQuery(e).hide()},2e3)},Page.showViewDone=function(){var e="#buttonViewComplete";jQuery(e).dialog({closeOnEscape:!0,hide:"puff",height:100,width:250}),setTimeout(function(){jQuery(e).dialog("close")},2e3)},Page.showExecutedResponse=function(e){jQuery("#executionMessage").html(e)},Page.showGeneratedCode=function(code,language,tabnumber){typeof tabnumber>"u"&&(tabnumber=""),Action.toggleTabsCheckbox(language),Page.applyGeneratedCodeAreaStyles(language);var errorMarkup=Page.getErrorMarkup(code,language),generatedMarkup=Page.getGeneratedMarkup(code,language);if(tabnumber==""?jQuery("#downloadArea").html(errorMarkup):jQuery("#messageArea").html(errorMarkup),language=="java"||language=="php"||language=="cpp"||language=="ruby"||language=="python"||language=="xml"||language=="sql"||language=="alloy"||language=="nusmv")jQuery("#innerGeneratedCodeRow"+tabnumber).html(formatOnce('<pre class="brush: {1};">{0}</pre>',generatedMarkup,language)),SyntaxHighlighter.highlight("code"),tabnumber==""&&(jQuery("#innerGeneratedCodeRow").nextAll().remove(),jQuery("#tabRow").html(""),Action.generateTabsCode(code),Action.toggleTabs());else if(language=="structureDiagram"){eval(generatedMarkup);var downloadLink='<div id="diagramLinkContainer"></div>';errorMarkup=downloadLink+errorMarkup,errorMarkup!=""&&jQuery("#messageArea").html(errorMarkup),Page.toggleStructureDiagramLink(!1)}else jQuery("#innerGeneratedCodeRow"+tabnumber).html(generatedMarkup)},Page.applyGeneratedCodeAreaStyles=function(e){var t=jQuery("#generatedCodeRow");t.show(),jQuery("#innerGeneratedCodeRow").show(),e=="diagramUpdate"?(t.removeClass("generatedCode"),t.removeClass("generatedDiagram")):e=="stateDiagram"||e=="classDiagram"||e=="structureDiagram"?(t.removeClass("generatedCode"),t.addClass("generatedDiagram"),e=="structureDiagram"&&jQuery("#innerGeneratedCodeRow").html('<svg id="generatedSVGCanvas"></svg>')):(t.removeClass("generatedDiagram"),t.addClass("generatedCode"))},Page.getErrorMarkup=function(e,t){var r="";if(t=="classDiagram"||t=="stateDiagram")r=e.split("<svg xmlns=")[0],r=r.replace(/&nbsp;\s*$/,"");else if(t=="javadoc"||t=="yumlDiagram")r=e.split("<iframe ")[0];else if(t=="diagramUpdate")r=e.replace(/<p>[\s\S]*/,"");else{var a=e.split("<p>URL_SPLIT");a.length>1&&(r=a[0])}return r},Page.getGeneratedMarkup=function(e,t){var r="";if(t=="classDiagram"||t=="stateDiagram")r=e.split("<svg width=")[1],r="<svg width="+r,r=r.replace(/<\/svg>$/,"");else if(t=="javadoc"||t=="yumlDiagram")r=e.split("<iframe ")[1],r="<iframe "+r;else if(t!="diagramUpdate")if(t=="structureDiagram")r=e.split("<p>URL_SPLIT")[1],r=r.replace(/##CANVAS_ID##/g,"generatedSVGCanvas"),r=jQuery("<div/>").html(r).text();else{var a=e.split("<p>URL_SPLIT");r=a.length>1?a[1]:e}return r},Page.toggleStructureDiagramLink=function(e,t){linkContainer=jQuery("#diagramLinkContainer"),e?(linkContainer.html(format("<a href='{0}' target='_blank' id='structureLink'>Download the SVG for the following</a>",t)),jQuery("#structureLink").on("click",function(r){Page.toggleStructureDiagramLink(!1)})):(linkContainer.html('<div id="buttonStructureLink" value="Generate SVG"></div>'),Page.initJQueryButton("buttonStructureLink"),Page.initAction("buttonStructureLink"))},Page.setFilename=function(e){jQuery("#filename").val(e)},Page.setFeedbackMessage=function(e){document.getElementById("feedbackMessage").innerHTML=e},Page.setExampleMessage=function(e){document.getElementById("exampleMessage").innerHTML=e},Page.getFeedbackMessage=function(){return document.getElementById("feedbackMessage").innerHTML},Page.catFeedbackMessage=function(e){var t=document.getElementById("feedbackMessage").innerHTML;document.getElementById("feedbackMessage").innerHTML=t+e},Page.getFilename=function(){return jQuery("#filename").val()},Page.getAdvancedMode=function(){return document.getElementById("advancedMode").value},Page.getModel=function(){return jQuery("#model").val()},jQuery.fn.selectRange=function(e,t){return this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(e,t);else if(this.createTextRange){var r=this.createTextRange();r.collapse(!0),r.moveEnd("character",t),r.moveStart("character",e),r.select()}})},Page.isBookmarkURL=function(){const e=window.location.href,t=e.substring(e.indexOf("?model=")+1);return!!(e.includes("model")&&t.length!=0)},UmplePositionFactory=new Object,UmplePositionFactory.copy=function(e){return new UmplePosition(e.x,e.y,e.width,e.height)};function UmplePosition(e,t,r,a){this.x=e,this.y=t,this.width=r,this.height=a,this.set=function(n,o){this.x=n,this.y=o},this.subtract=function(n){return new UmplePosition(this.x-n.x,this.y-n.y,this.width-n.width,this.height-n.height)},this.add=function(n){return n==null?UmplePositionFactory.copy(this):new UmplePosition(this.x+n.x,this.y+n.y,this.width+n.width,this.height+n.height)},this.slopeAngle=function(n){return this.slopeAngleAndQuadrant(n)[0]},this.quadrant=function(n){return this.slopeAngleAndQuadrant(n)[1]},this.equalsIgnoreSize=function(n){return!(this.x!=n.x||this.y!=n.y)},this.slopeAngleAndQuadrant=function(n){var o=n.y-this.y,u=this.x-n.x,s=o/u,d=Math.atan(s)*180/3.14159,c=o>=0&&u>=0,h=o>=0&&u<0,C=o<0&&u>=0,m=o<0&&u<0,T=c?"top-right":h?"top-left":C?"bottom-right":"bottom-left";return[d,T]},this.slopeAngle360=function(n){var o;if(this.y==n.y)return this.x>n.x?180:0;var u=n.y-this.y,s=n.x-this.x,d=s/u;return n.y<this.y?o=90+Math.atan(d)*180/3.14159:o=270+Math.atan(d)*180/3.14159,Math.round(o)},this.travelForward=function(n,o){var u=new UmplePosition(0,0,0,0),s=0,d=0;return o>=0&&o<90?(s=Math.cos(o*3.14159/180)*n,d=Math.sin(o*3.14159/180)*n,u.x=this.x+s,u.y=this.y-d):o>=90&&o<180?(o-=90,s=Math.sin(o*3.14159/180)*n,d=Math.cos(o*3.14159/180)*n,u.x=this.x-s,u.y=this.y-d):o>=180&&o<270?(o-=180,s=Math.cos(o*3.14159/180)*n,d=Math.sin(o*3.14159/180)*n,u.x=this.x-s,u.y=this.y+d):(o-=270,s=Math.sin(o*3.14159/180)*n,d=Math.cos(o*3.14159/180)*n,u.x=this.x+s,u.y=this.y+d),u.x=Math.round(u.x),u.y=Math.round(u.y),u},this.wallsAreAdjacent=function(n,o){return!(n==o||n=="West"&&o=="East"||n=="East"&&o=="West"||n=="North"&&o=="South"||n=="South"&&o=="North")},this.areAnglesSimilar=function(n,o){var u=3;return Math.abs(n-o)<=u},this.toString=function(){return"("+this.x+","+this.y+","+this.width+","+this.height+")"}}jQuery(document).ready(function(){var e="filecode=",t="VIEW=",r="DIAGRAM=",a="PREF=",n=document.cookie.split(";"),o=null;jQuery("#restorecode").hide();for(var u=0;u<n.length;u++){var s=n[u].trim();s.indexOf(e)==0?o=s.substring(e.length,s.length):s.indexOf(t)==0?t=s.substring(t.length,s.length):s.indexOf(r)==0?r=s.substring(r.length,s.length):s.indexOf(a)!=-1&&(a=s.substring(a.length,s.length))}a.indexOf("g")!=-1&&Action.hidegdpr(),o!=null&&o.length!=0&&(jQuery("#restorecode").show(),setTimeout(function(){jQuery("#restorecode").hide()},3e4),jQuery("#restorecode").click(function(){jQuery("#restorecode").hide(),Page.setFilename(o),Action.loadFile(),t.indexOf("d")!=-1?jQuery("#buttonShowHideCanvas").prop("checked")||jQuery("#buttonShowHideCanvas").trigger("click"):jQuery("#buttonShowHideCanvas").prop("checked")&&jQuery("#buttonShowHideCanvas").trigger("click"),t.indexOf("t")!=-1?jQuery("#buttonShowHideTextEditor").prop("checked")||jQuery("#buttonShowHideTextEditor").trigger("click"):jQuery("#buttonShowHideTextEditor").prop("checked")&&jQuery("#buttonShowHideTextEditor").trigger("click"),t.indexOf("l")!=-1?jQuery("#buttonShowHideLayoutEditor").prop("checked")||jQuery("#buttonShowHideLayoutEditor").trigger("click"):jQuery("#buttonShowHideLayoutEditor").prop("checked")&&jQuery("#buttonShowHideLayoutEditor").trigger("click"),t.indexOf("a")!=-1?jQuery("#buttonToggleAttributes").prop("checked")||jQuery("#buttonToggleAttributes").trigger("click"):jQuery("#buttonToggleAttributes").prop("checked")&&jQuery("#buttonToggleAttributes").trigger("click"),t.indexOf("m")!=-1?jQuery("#buttonToggleMethods").prop("checked")||jQuery("#buttonToggleMethods").trigger("click"):jQuery("#buttonToggleMethods").prop("checked")&&jQuery("#buttonToggleMethods").trigger("click"),r.indexOf("e")!=-1?jQuery("#buttonShowEditableClassDiagram").prop("checked")||jQuery("#buttonShowEditableClassDiagram").trigger("click"):r.indexOf("c")!=-1?jQuery("#buttonShowGvClassDiagram").prop("checked")||jQuery("#buttonShowGvClassDiagram").trigger("click"):r.indexOf("s")!=-1&&(jQuery("#buttonShowGvStateDiagram").prop("checked")||jQuery("#buttonShowGvStateDiagram").trigger("click")),a.indexOf("p")!=-1?jQuery("#buttonPhotoReady").prop("checked")||jQuery("#buttonPhotoReady").trigger("click"):jQuery("#buttonPhotoReady").prop("checked")&&jQuery("#buttonPhotoReady").trigger("click"),a.indexOf("s")!=-1?jQuery("#buttonManualSync").prop("checked")||jQuery("#buttonManualSync").trigger("click"):jQuery("#buttonManualSync").prop("checked")&&jQuery("#buttonManualSync").trigger("click")}))}),window.onbeforeunload=function(e){var t=new Date;t.setTime(t.getTime()+720*60*60*1e3),Page.getUmpleCode()!=="//$?[End_of_model]$?"&&(document.cookie="filecode="+Page.getFilename()+";expires="+t.toGMTString()+";",cookie_view="VIEW=",jQuery("#buttonShowHideCanvas").prop("checked")&&(cookie_view+="d"),jQuery("#buttonShowHideTextEditor").prop("checked")&&(cookie_view+="t"),jQuery("#buttonShowHideLayoutEditor").prop("checked")&&(cookie_view+="l"),jQuery("#buttonToggleAttributes").prop("checked")&&(cookie_view+="a"),jQuery("#buttonToggleMethods").prop("checked")&&(cookie_view+="m"),jQuery("#buttonToggleTransitionLabel").prop("checked")&&(cookie_view+="r"),jQuery("#buttonToggleGuardLabel").prop("checked")&&(cookie_view+="g"),cookie_view+=";expires="+t.toGMTString()+";",document.cookie=cookie_view,cookie_diagram="DIAGRAM=",jQuery("#buttonShowEditableClassDiagram").prop("checked")?cookie_diagram+="e":jQuery("#buttonShowGvClassDiagram").prop("checked")?cookie_diagram+="c":jQuery("#buttonShowGvStateDiagram").prop("checked")&&(cookie_diagram+="s"),cookie_diagram+=";expires="+t.toGMTString()+";",document.cookie=cookie_diagram),cookie_pref="PREF=",Action.gdprHidden&&(cookie_pref+="g"),jQuery("#buttonPhotoReady").prop("checked")&&(cookie_pref+="p"),jQuery("#buttonManualSync").prop("checked")&&(cookie_pref+="s"),cookie_pref+=";expires="+t.toGMTString()+";",document.cookie=cookie_pref};function existSCookie(e){return document.cookie.match("(^|;)\\s*"+e+"\\s*=\\s*([^;]+)")}function setCookieBeforeClose(e){e=="on"?window.onbeforeunload=function(){window.randomSurveyRoll!=1?setSurveyCookie(60):notToday?setSurveyCookie(1):clickedForMoreSurvey==!1&&clickedStartSurvey==!1?setSurveyCookie(15):clickedForMoreSurvey==!0&&clickedStartSurvey==!1?setSurveyCookie(30):setSurveyCookie(60)}:window.onbeforeunload=function(){}}function groupHideToday(){hideRecruitementMessage(),document.getElementById("surveyMessage")!=null&&(document.getElementById("mainSurveySpan").removeChild(document.getElementById("surveyMessage")),document.getElementById("mainSurveySpan").removeChild(document.getElementById("surveyExtra"))),notToday=!0}var clickedForMoreSurvey=!1,clickedStartSurvey=!1,displayedText=!1,notToday=!1,timeSurveyUp=!1;if(existSCookie("surveyCookie")==null&&window.surveyData!=null){if(window.randomSurveyRoll==1){var surveySeen=window.localStorage.getItem("surveyShown");if(surveySeen==null||surveySeen!=window.surveyData.SurveyURL){timeSurvey&&clearTimeout(timeSurvey);var timeSurvey=setTimeout(function(){timeSurveyUp=!0},window.surveyData.MinutesBeforePrompt*60*1e3),beforeInstance=TabControl.getCurrentHistory().currentIndex;displayedText||document.addEventListener("mouseover",function(){TabControl.getCurrentHistory().currentIndex-beforeInstance>window.surveyData.EditsBeforePrompt&&!displayedText&&timeSurveyUp&&(displaySurvey(),this.removeEventListener("mouseover",arguments.callee))})}}setCookieBeforeClose("on")}function setSurveyCookie(e){let t=new Date(Date.now()+e*24*60*60*1e3);document.cookie="surveyCookie=done; expires="+t.toUTCString()+"; path=/;"}function displaySurvey(){displayedText=!0;var e=document.getElementById("mainSurveySpan");if(!e.contains(document.getElementById("surveyMessage"))){var t=document.createElement("span");t.innerHTML='<span><a href="'+window.surveyData.SurveyURL+'" target="umplesurvey" onmouseover="showRecruitementMessage()">'+window.surveyData.InvitationalMessage+"</a></span><br/>",t.id="surveyMessage",e.appendChild(t);var r=document.createElement("span");r.innerHTML=window.surveyData.RecruitmentText+'<div id="surveyPopUp"><span class="linkToSurvey" onclick="countClicked()"><a href="'+window.surveyData.SurveyURL+'" target="umplesurvey"class="linkToSurvey">Start Survey</a></span><span onclick="groupHideToday()" class="linkToNotSurvey">Not Today</span></div>',r.id="surveyExtra",e.appendChild(r),r.addEventListener("mouseleave",function(){hideRecruitementMessage()}),t.addEventListener("click",function(){countClicked()}),sendToSurveyLog("SurveyRequested")}}function showRecruitementMessage(){clickedForMoreSurvey=!0,document.getElementById("surveyExtra").classList.contains("fade-in")||(document.getElementById("surveyExtra").classList.remove("fade-outInst"),document.getElementById("surveyExtra").classList.add("fade-in"))}function hideRecruitementMessage(){document.getElementById("surveyExtra").classList.contains("fade-outInst")||(document.getElementById("surveyExtra").classList.remove("fade-in"),document.getElementById("surveyExtra").classList.add("fade-outInst"))}function countClicked(){window.localStorage.setItem("surveyShown",window.surveyData.surveyURL),clickedStartSurvey=!0,sendToSurveyLog("SurveyClicked")}function sendToSurveyLog(e){console.log("processing");let t=new Date(Date.now()).toString();e=="SurveyRequested"&&jQuery.ajax({url:"umple.php",method:"POST",data:{surveyLogInfo:`
`+e+" "+t},dataType:"html"}).done(function(){console.log("Success: Files sent!")}).fail(function(){console.log("An error occurred, the files couldn't be sent!")}),e=="SurveyClicked"&&jQuery.ajax({url:"umple.php",method:"POST",data:{surveyLogInfo2:`
`+e+" "+t},dataType:"html"}).done(function(){console.log("Success: Files sent!")}).fail(function(){console.log("An error occurred, the files couldn't be sent!")})}UmpleSystem=new Object,UmpleSystem.umpleClasses=[],UmpleSystem.umpleAssociations=[],UmpleSystem.umpleTransitions=[],UmpleSystem.position=function(){var e=jQuery("#umpleCanvas"),t=Math.ceil(e.offset().left-e.scrollLeft()),r=Math.ceil(e.offset().top-e.scrollTop()),a=new UmplePosition(t,r,0,0);return a},UmpleSystem.findIn=function(e,t){if(e==null)return null;for(var r=0;r<e.length;r++){var a=e[r];if(a.id==t)return a}return null},UmpleSystem.find=function(e){return UmpleSystem.findIn(this.umpleClasses,e)},UmpleSystem.findAssociation=function(e){var t=UmpleSystem.findIn(this.umpleAssociations,e);return t},UmpleSystem.createAssociation=function(e,t,r,a){var n=new UmpleAssociation;return n.id=this.nextAssociationId(),n.setClasses(e,t),n.setOffsetOnePosition(r),n.setOffsetTwoPosition(a),n.setDefaultMultiplicities(),n.setDefaultRoles(),n.setName(n.getName()),e==t?n.adjustReflexiveEndpoints():n.trimOverlap(),this.addAssociation(n)},UmpleSystem.createTransition=function(e,t){var r=new UmpleTransition;return r.id=this.nextTransitionId(),r.setStates(fromStateId,toStateId),r.setDefaultEvent(),r.setName(r.getName()),this.addTransition(r)},UmpleSystem.createGeneralization=function(e,t){var r=UmpleSystem.find(e);r.extendsClass=t,UmpleSystem.updateClass(r)},UmpleSystem.addAssociation=function(e){this.umpleAssociations.push(e);var t=this.redrawAssociation(e);return e},UmpleSystem.addTransition=function(e){this.umpleTransitions.push(e);var t=this.redrawTransition(e);return e},UmpleSystem.createClass=function(e){var t=new UmpleClass;t.id=this.nextId("NewClass"),t.name=t.id,t.position.set(e.x-UmpleSystem.position().x,e.y-UmpleSystem.position().y,UmpleClassFactory.defaultSize.width,UmpleClassFactory.defaultSize.height);var r=this.addClass(t);return UmpleSystem.redrawGeneralizationsTo(r),r},UmpleSystem.addClass=function(e){this.umpleClasses.push(e),this.updateClass(e);var t=jQuery("#"+e.id);return t.click(Action.classClicked),t.mouseover(function(r){Action.classHover(r,!0)}),t.mouseout(function(r){Action.classHover(r,!1)}),t.mousedown(function(r){setTimeout(function(){Action.classMouseDown(r)},400)}),t.mouseup(function(r){Action.classMouseUp(r)}),Page.readOnly||t.draggable({containment:"parent",stop:function(r,a){DiagramEdit.classMoved(r.target)}}),jQuery(".ui-icon-gripsmall-diagonal-se").removeClass("ui-icon-gripsmall-diagonal-se"),e},UmpleSystem.replaceClass=function(e){for(var t=0;t<this.umpleClasses.length;t++){var r=this.umpleClasses[t];if(r.id==e.id){var a="#"+r.id,n=a+"_generalization",o=jQuery(a).get(),u=jQuery(n).get();jQuery(o).attr("id",e.id),u!=null&&(jQuery(u).attr("id",e.id+"_generalization"),jQuery(u).remove()),this.umpleClasses[t]=e,this.updateClass(this.umpleClasses[t]);return}}},UmpleSystem.renameClass=function(e,t,r){var a=UmpleSystem.find(e),n="#"+e,o=n+"_generalization";r=this.nextId(r),a.id=r,a.name=r,a.oldname=t,jQuery(n).attr("id",a.id),jQuery(o).get()!=null&&jQuery(o).attr("id",a.id+"_generalization");for(var u=0;u<this.umpleAssociations.length;u++){var s=this.umpleAssociations[u];s.classOneId==t&&(s.classOneId=a.id),s.classTwoId==t&&(s.classTwoId=a.id)}for(var u=0;u<this.umpleClasses.length;u++){var d=this.umpleClasses[u];d.extendsClass==t&&(d.extendsClass=r,this.updateClass(d))}return UmpleSystem.updateClass(a),a},UmpleSystem.replaceAssociation=function(e){for(var t=0;t<this.umpleAssociations.length;t++){var r=this.umpleAssociations[t];r.id==e.id&&(this.umpleAssociations[t]=e,index=t)}this.redrawAssociation(e)},UmpleSystem.updatePosition=function(e,t,r){e.position.x=t-UmpleSystem.position().x,e.position.y=r-UmpleSystem.position().y,UmpleSystem.redrawAssociationsFor(e),UmpleSystem.redrawGeneralizationsTo(e),UmpleSystem.updateClass(e)},UmpleSystem.updateClass=function(e){var t=e.drawable(),r=t[0],a=t[1],n=jQuery("#"+Page.umpleCanvasId()),o=jQuery("#"+e.id);if(n.append(r),a!=null)for(var u=0;u<a.length;u++)n.append(a[u]);UmpleSystem.redraw(e);var s=2,d=!1;o.width()>e.position.width+s&&(e.position.width=o.width(),d=!0),o.height()>e.position.height+s&&(e.position.height=o.height(),d=!0),d&&UmpleSystem.redraw(e),jQuery(".ui-icon-gripsmall-diagonal-se").removeClass("ui-icon-gripsmall-diagonal-se")},UmpleSystem.redrawAssociationsFor=function(e){for(var t=0;t<this.umpleAssociations.length;t++){var r=this.umpleAssociations[t];r.contains(e)&&UmpleSystem.redrawAssociation(r)}},UmpleSystem.redrawAssociation=function(e){var t="#"+e.id,r="#"+Page.umpleCanvasId(),a=null;return a=e.drawable(),jQuery(r).append(a),Page.isPhotoReady()||(jQuery(t).click(Action.associationClicked),jQuery(t).mouseover(function(n){Action.associationHover(n,!0)}),jQuery(t).mouseout(function(n){Action.associationHover(n,!1)}),UmpleSystem.setDragableAssociationAnchor(e,0),UmpleSystem.setDragableAssociationAnchor(e,1)),a},UmpleSystem.redrawTransition=function(e){var t="#"+e.id,r="#"+Page.umpleCanvasId(),a=null;return a=e.drawable(),jQuery(r).append(a),Page.isPhotoReady()||jQuery(t).click(Action.transitionClicked),a},UmpleSystem.redrawGeneralizationsTo=function(e){for(var t=0;t<this.umpleClasses.length;t++){var r=this.umpleClasses[t];if(r.extendsClass==e.id)this.updateClass(r);else if(r.interfaces.length>0)for(var a=0;a<r.interfaces.length;a++)r.interfaces[a]==e.id&&this.updateClass(r)}},UmpleSystem.update=function(){for(var e=0;e<this.umpleClasses.length;++e){var t=this.umpleClasses[e];t.position.height=28,Page.showAttributes&&(t.position.height+=17*t.attributes.size()),Page.showMethods&&(t.position.height+=17*t.methods.size()),UmpleSystem.updateClass(t)}for(var e=0;e<this.umpleAssociations.length;++e){var r=UmpleSystem.find(this.umpleAssociations[e].classOneId),a=this.umpleAssociations[e].offsetOnePosition.x+r.position.x+UmpleSystem.position().x,n=this.umpleAssociations[e].offsetOnePosition.y+r.position.y+UmpleSystem.position().y,o=Action.associationSnapClassReady(a,n,r),u=UmpleSystem.find(this.umpleAssociations[e].classTwoId);a=this.umpleAssociations[e].offsetTwoPosition.x+u.position.x+UmpleSystem.position().x,n=this.umpleAssociations[e].offsetTwoPosition.y+u.position.y+UmpleSystem.position().y;var s=Action.associationSnapClassReady(a,n,u),d=new UmplePosition(o[0],o[1],0,0),c=new UmplePosition(s[0],s[1],0,0);this.umpleAssociations[e].setOffsetOnePosition(d),this.umpleAssociations[e].setOffsetTwoPosition(c),UmpleSystem.redrawAssociation(this.umpleAssociations[e])}for(var e=0;e<this.umpleClasses.length;++e)UmpleSystem.trimOverlappingAssociations(this.umpleClasses[e])},UmpleSystem.redraw=function(e){var t=e.position.x+UmpleSystem.position().x,r=e.position.y+UmpleSystem.position().y,a="#"+e.id,n=a+"_generalization",o=a+"_width",u=a+"_height",s=new Object;if(s.top=r,s.left=t,jQuery(a).offset(s),jQuery(o).width(e.position.width),jQuery(u).height(e.position.height),!Page.isPhotoReady()){var d=jQuery(n).get();d!=null&&(jQuery(n).click(Action.generalizationClicked),jQuery(n).mouseover(function(c){Action.generalizationHover(c,!0)}),jQuery(n).mouseout(function(c){Action.generalizationHover(c,!1)}))}this.redrawAssociationsFor(e)},UmpleSystem.trimOverlappingAssociations=function(e){Page.showLayoutLoading();for(var t=0;t<UmpleSystem.umpleAssociations.length;t++){var r=UmpleSystem.umpleAssociations[t];if(r.contains(e)){var a=UmplePositionFactory.copy(r.offsetOnePosition),n=UmplePositionFactory.copy(r.offsetTwoPosition);if(r.isReflexive())r.adjustReflexiveEndpoints();else if(!a.equalsIgnoreSize(r.offsetOnePosition)||!n.equalsIgnoreSize(r.offsetTwoPosition)){Page.showLayoutLoading(),UmpleSystem.redrawAssociation(r);var o=Json.toString(r);DiagramEdit.updateUmpleText({actionCode:format("action=editAssociation&actionCode={0}",o),codeChange:!1})}}}UmpleSystem.umpleAssociations.length==0&&Action.setjustUpdatetoSaveLater(!1),Page.hideLoading()},UmpleSystem.updateAnchor=function(e,t){var r="#"+e.id,a=r+"_anchor"+t,n=r+"_hover"+t,o="";switch(t){case 0:o="left top";break;case 1:o="left center";break;case 2:o="left bottom";break;case 3:o="center bottom";break;case 4:o="right bottom";break;case 5:o="right center";break;case 6:o="right top";break;case 7:o="center top";break}jQuery(a).show(),jQuery(n).show(),jQuery(a).position({my:"center",at:o,of:r}),jQuery(n).position({my:"center",at:o,of:r}),jQuery(a).hide(),jQuery(n).hide()},UmpleSystem.setDragableAssociationAnchor=function(e,t){if(!Page.readOnly)if(e.isReflexive()){var r="#"+e.id+"_anchor"+t,a=t==0?e.classOneId:e.classTwoId;jQuery(r).draggable({drag:function(n,o){DiagramEdit.reflexiveAssociationMoving("#"+n.target.id)},stop:function(n,o){DiagramEdit.associationMoved("#"+n.target.id)},cursor:"pointer",snap:"#"+a,snapTolerance:5,containment:"#"+a,zIndex:1})}else{var r="#"+e.id+"_anchor"+t,a=t==0?e.classOneId:e.classTwoId;jQuery(r).draggable({drag:function(u,s){DiagramEdit.regularAssociationMoving("#"+u.target.id)},stop:function(u,s){DiagramEdit.associationMoved("#"+u.target.id)},cursor:"pointer",snap:"#"+a,snapTolerance:5,containment:"#"+a,zIndex:1})}},UmpleSystem.updatingSize=function(e,t,r){e.position.width=t,e.position.height=r,UmpleSystem.redraw(e)},UmpleSystem.removeClass=function(e){for(var t=0;t<this.umpleClasses.length;t++){var r=this.umpleClasses[t];if(r.id==e){this.umpleClasses.splice(t,1);var a="#"+e,n=a+"_generalization";return jQuery(a).remove(),jQuery(n).remove(),r}}return null},UmpleSystem.removeAssociation=function(e){for(var t=0;t<this.umpleAssociations.length;t++){var r=this.umpleAssociations[t];if(r.id==e){this.umpleAssociations.splice(t,1);var a="#"+e;return jQuery(a).remove(),r}}return null},UmpleSystem.removeTransition=function(e){for(var t=0;t<this.umpleAssociations.length;t++){var r=this.umpleAssociations[t];if(r==e){this.umpleTransitions.splice(t,1);var a="#"+e;return jQuery(a).remove(),r}}return null},UmpleSystem.removeGeneralization=function(e){var t="#"+e;jQuery(t).remove();var r=e.replace("_generalization",""),a=UmpleSystem.find(r);a.extendsClass=null;var n=new UmpleGeneralization;return n.childId=a.id,n.parentId=a.extendsClass,n},UmpleSystem.redrawCanvas=function(){UmpleSystem.merge(UmpleSystem)},UmpleSystem.merge=function(e){UmpleSystem.mergeClasses(e),UmpleSystem.mergeAssociations(e)},UmpleSystem.mergeClasses=function(e){if(e==null){for(;this.umpleClasses.length>0;)this.removeClass(this.umpleClasses[0].id);return}for(var t=0;t<this.umpleClasses.length;t++){var r=this.umpleClasses[t],a=this.findIn(e.umpleClasses,r.id);a==null?(t-=1,this.removeClass(r.id)):this.replaceClass(UmpleClassFactory.create(a))}for(var t=0;t<e.umpleClasses.length;t++){var a=e.umpleClasses[t],n=this.find(a.id);n==null&&this.addClass(UmpleClassFactory.create(a))}for(var t=0;t<this.umpleClasses.length;t++){var r=this.umpleClasses[t];(r.extendsClass!=null||r.interfaces.length>0)&&this.updateClass(r)}},UmpleSystem.mergeAssociations=function(e){if(e==null){for(;this.umpleAssociations.length>0;)this.removeAssociation(this.umpleAssociations[0].id);return}for(var t=0;t<this.umpleAssociations.length;t++){var r=this.umpleAssociations[t],a=this.findIn(e.umpleAssociations,r.id);a==null?(t-=1,this.removeAssociation(r.id)):this.replaceAssociation(UmpleAssociationFactory.create(a))}for(var t=0;t<e.umpleAssociations.length;t++){var n=this.findAssociation(e.umpleAssociations[t].id);if(n==null){var a=UmpleAssociationFactory.create(e.umpleAssociations[t]);this.addAssociation(a)}}},UmpleSystem.nextId=function(e){var t="umpleElement_",r=t+"0";typeof e<"u"&&(t=e,r=e);for(var a=!1,n=0;n<100&&!a;){n>0&&(r=t+n),a=!0;for(var o=0;o<this.umpleClasses.length;o++)if(this.umpleClasses[o].id==r){a=!1,n+=1;break}if(a)return r}return""},UmpleSystem.nextAssociationId=function(e){var t="umpleAssociation_",r=t+"0";typeof e<"u"&&(t=e,r=e);for(var a=!1,n=0;n<100&&!a;){n>0&&(r=t+n),a=!0;for(var o=0;o<this.umpleAssociations.length;o++)if(this.umpleAssociations[o].id==r){a=!1,n+=1;break}if(a)return r}return""},UmpleSystem.nextTransitionId=function(e){var t="umpleTransition_",r=t+"0";typeof e<"u"&&(t=e,r=e);for(var a=!1,n=0;n<100&&!a;){n>0&&(r=t+n),a=!0;for(var o=0;o<this.umpleTransitions.length;o++)if(this.umpleTransitions[o].id==r){a=!1,n+=1;break}if(a)return r}return""},TabControl=new Object,TabControl.maxTabs=10,TabControl.maxNameLength=32,TabControl.defaultTabName="Untitled",TabControl.showHideKey="showUmpleTabs",TabControl.requestQueue=[],TabControl.remoteDelim="%NAME:CONTENT:DELIM%",TabControl.illegalNameRegxp=/[\/\?<>\\:\*\|":]/g,TabControl.controlNameRegxp=/[\x00-\x1f\x80-\x9f]/g,TabControl.reservedNameRegxp=/^\.+$/,TabControl.windowsReservedNameRegxp=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,TabControl.windowsTrailingRegxp=/[\. ]+$/,TabControl.nameReplacement="_",TabControl.init=function(){jQuery("#tabs").sortable({axis:"x",helper:"clone",items:"li:not(.unsortable)",update:TabControl.saveActiveTabs}),jQuery.fn.selectText=function(){var e=document,t=this[0];if(e.body.createTextRange){var r=document.body.createTextRange();r.moveToElementText(t),r.select()}else if(window.getSelection){var a=window.getSelection(),r=document.createRange();r.selectNodeContents(t),a.removeAllRanges(),a.addRange(r)}},TabControl.reset(),localStorage[TabControl.showHideKey]||TabControl.hideTabs(),TabControl.loadAllTabs()},TabControl.showTabs=function(){jQuery("#toggleTabsButton").html("Hide Tabs"),jQuery("#tabControl").show(),localStorage[TabControl.showHideKey]=!0},TabControl.hideTabs=function(){jQuery("#toggleTabsButton").html("Show Tabs"),jQuery("#tabControl").hide(),delete localStorage[TabControl.showHideKey]},TabControl.saveActiveTabs=function(){var e=[];jQuery(".tabname").each(function(){e.push(jQuery(this).text())}),TabControl.addToRequestQueue("scripts/tab_control.php",function(t){},format("index=1&&model={0}&&orderedTabNames={1}",Page.getModel(),encodeURIComponent(JSON.stringify(e))))},TabControl.getActiveTabId=function(){return TabControl.activeTab?TabControl.activeTab.id:null},TabControl.isHidden=function(){return jQuery("#tabControl").is(":hidden")},TabControl.reset=function(){TabControl.activeTab=null,TabControl.tabs={},TabControl.nextTabId=1,TabControl.requestQueue=[],TabControl.queuedTabs=0,TabControl.reservedNames={model:!0}},TabControl.sanitizeName=function(e){var t=e.replace(TabControl.illegalNameRegxp,TabControl.nameReplacement).replace(TabControl.controlNameRegxp,TabControl.nameReplacement).replace(TabControl.reservedNameRegxp,TabControl.nameReplacement).replace(TabControl.windowsReservedNameRegxp,TabControl.nameReplacement).replace(TabControl.windowsTrailingNameRegxp,TabControl.nameReplacement);return t},TabControl.findNextAvailableTabName=function(e){for(var t=e,r=2;TabControl.reservedNames.hasOwnProperty(t);)t=e+r++;return t},TabControl.extractNameFromCode=function(e){var t=/class[\s]*([a-zA-Z_$][a-zA-Z_$0-9]*)[\s]*{/g,r=t.exec(e);if(r)return r[1]},TabControl.createTab=function(e,t,r){if(!(Page.readOnly&&e=="afterTabControlInit")&&(e=="afterTabControlInit"&&(e=null),Object.keys(TabControl.tabs).length!=TabControl.maxTabs)){var a=TabControl.nextTabId++,n=e||TabControl.defaultTabName;if(t!=null){if(!e){var o=TabControl.extractNameFromCode(t);o&&(n=o)}}else t=Page.modelDelimiter;var u=TabControl.findNextAvailableTabName(n);TabControl.tabs[a]={name:u,id:a,history:History.getInstance(a),nameIsEphemeral:e==null},TabControl.reservedNames[u]=!0,TabControl.saveTab(a,t);var s=jQuery("#createTabBtn"),d=jQuery('<li id="tab'+a+'" class=""><a class="tabname" title="Double-click to rename tab" id="tabName'+a+`" href="javascript:TabControl.selectTab('`+a+`');">`+u+`</a><button class="tabbtn" onclick="javascript:TabControl.deleteTab('`+a+`');">&times;</button></li>`);d.insertBefore(s),Object.keys(TabControl.tabs).length==TabControl.maxTabs&&s.hide();var c=TabControl.getTabNameDiv(a);handleNameEdit=function(){c.attr("contentEditable",!1),window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty();var h=c.text(),C=TabControl.tabs[a].name;if(h!==C){var m=!1;TabControl.sanitizeName(h)!==h?alert("The name contains invalid characters. Please try again."):h.length===0||h.length>TabControl.maxNameLength?alert("Name must be between 1 and "+TabControl.maxNameLength+" characters long. Please try again."):TabControl.reservedNames.hasOwnProperty(h)?alert("This name is already in use. Please try again."):m=!0,m?(c.text(h),TabControl.renameTab(a,h)):(c.text(C),c.selectText(),c.attr("contentEditable",!0))}},c.bind("dblclick",function(){c.attr("contentEditable",!0),c.focus(),c.selectText()}).blur(handleNameEdit).keypress(function(h){var C=13,m=8;h.which==C&&c.blur(),h.which!=m&&c.text().length>=TabControl.maxNameLength&&h.preventDefault()}),r||TabControl.saveActiveTabs(),TabControl.selectTab(a)}},TabControl.saveTab=function(e,t){var r=TabControl.getTabFilename(TabControl.tabs[e].name),a=Page.getModel();localStorage[r]=t,String(Page.getFilename()).indexOf("tasks")!==-1&&(r="tasks/"+r,a="tasks/"+a);var n=t.replace(/&/g,"%26").replace(/\+/g,"%2B");TabControl.addToRequestQueue("scripts/compiler.php",TabControl.saveTabCallback(e),format("save=1&&lock=1&&model={2}&&umpleCode={0}&&filename={1}",n,r,a))},TabControl.saveTabCallback=function(e){return function(t){TabControl.tabs[e]&&(TabControl.tabs[e].filename=t.responseText)}},TabControl.selectTab=function(e){if(TabControl.activeTab){if(e==TabControl.activeTab.id)return;var t=TabControl.getTabDiv(TabControl.activeTab.id);t.removeClass("selected"),TabControl.saveTab(TabControl.activeTab.id,Page.getUmpleCode())}TabControl.activeTab=TabControl.tabs[e];var r=TabControl.getTabDiv(e);r.addClass("selected"),TabControl.getCurrentHistory().setButtons();var a=TabControl.getTabFilename(TabControl.activeTab.name);Page.setUmpleCode(localStorage[a]),Action.setCaretPosition(0),Action.updateLineNumberDisplay(),Object.keys(TabControl.tabs).length>1&&setTimeout('Action.processTyping("newEditor",false)',Action.waiting_time)},TabControl.loadAllTabs=function(){TabControl.addToRequestQueue("scripts/tab_control.php",TabControl.loadAllTabsCallback,format("list=1&&model={0}",Page.getModel()))},TabControl.loadAllTabsCallback=function(e){var t=e.responseText.split("<br />"),r=!1;t.map(function(a){if(a){var n=a.split(TabControl.remoteDelim),o=n[0],u=n[1];!o||o==="model"||(r||(TabControl.hideTabs(),r=!0),TabControl.createTab(o,u,!0))}}),r?TabControl.showTabs():TabControl.createTab(null,Page.getUmpleCode())},TabControl.deleteTab=function(e){if(!Page.readOnly&&Object.keys(TabControl.tabs).length>1){var a=TabControl.getTabNameDiv(e),t=confirm("Are you sure you want to remove the file "+a.text()+".ump from the model? If you answer OK, the code will be deleted; this cannot be undone, so consider answering Cancel and saving it first.");if(!t)return;var r=e==TabControl.activeTab.id;TabControl.getTabDiv(e).remove();var a=TabControl.tabs[e].name,n=TabControl.tabs[e].filename;delete TabControl.reservedNames[a],delete TabControl.tabs[e],delete localStorage[n];var o=jQuery("#createTabBtn");o.show(),TabControl.addToRequestQueue("scripts/tab_control.php",function(u){},format("delete=1&&model={0}&&name={1}",Page.getModel(),a)),r&&(TabControl.activeTab=null,TabControl.selectTab(Object.keys(TabControl.tabs)[0])),TabControl.saveActiveTabs()}},TabControl.renameTab=function(e,t,r){if(!Page.readOnly&&!TabControl.reservedNames.hasOwnProperty(t)){var a=TabControl.tabs[e].name;if(a!=t){var n=TabControl.getTabFilename(a),o=TabControl.getTabFilename(t);localStorage[o]=localStorage[n],delete localStorage[n],r&&TabControl.getTabNameDiv(e).text(t),TabControl.tabs[e].nameIsEphemeral=!1,TabControl.addToRequestQueue("scripts/tab_control.php",TabControl.renameTabCallback(e,t),format("rename=1&&model={0}&&oldname={1}&&newname={2}",Page.getModel(),a,t)),TabControl.saveActiveTabs()}}},TabControl.renameTabCallback=function(e,t){return function(r){delete TabControl.reservedNames[TabControl.tabs[e].name],TabControl.reservedNames[t]=!0,TabControl.tabs[e].name=t}},TabControl.getTabFilename=function(e){return format("{0}/{1}.ump",Page.getModel(),e)},TabControl.getTabNameDiv=function(e){return jQuery("#tabName"+e)},TabControl.getTabDiv=function(e){return jQuery("#tab"+e)},TabControl.addToRequestQueue=function(e,t,r){var a={endpoint:e,callback:TabControl.getQueuedCallback(t),parameters:r};TabControl.requestQueue.push(a),TabControl.requestQueue.length===1&&(jQuery(".bookmarkableUrl").addClass("disabled"),Ajax.sendRequest(a.endpoint,TabControl.getQueuedHeadCallback(a.callback),a.parameters))},TabControl.getQueuedHeadCallback=function(e){return function(t){TabControl.requestQueue.shift(),e(t)}},TabControl.getQueuedCallback=function(e){return function(t){var r=TabControl.requestQueue.shift();e(t),r?r.hasOwnProperty("endpoint")?Ajax.sendRequest(r.endpoint,r.callback,r.parameters):r.callback():Page.modelLoadingCount===0&&Page.layoutLoadingCount===0&&Page.canvasLoadingCount===0&&jQuery(".bookmarkableUrl").removeClass("disabled")}},TabControl.addCallbackToRequestQueue=function(e){var t={callback:TabControl.getQueuedCallback(e)};TabControl.requestQueue.push(t),TabControl.requestQueue.length===1&&(jQuery(".bookmarkableUrl").addClass("disabled"),TabControl.getQueuedHeadCallback(t.callback()))},TabControl.getCurrentHistory=function(){return TabControl.activeTab?TabControl.tabs[TabControl.activeTab.id].history:History.getInstance()},TabControl.useActiveTabTo=function(e){return TabControl.activeTab?e.bind(null,TabControl.activeTab.id):function(){}};var ToolTips={},undo,redo,toggleTextEditor;navigator.appVersion.indexOf("Mac")!=-1?(undo="cmd-z",redo="cmd-shift-z",toggleTextEditor="ctrl-t"):(undo="ctrl-z",redo="ctrl-y",toggleTextEditor="ctrl-alt-shift-t"),ToolTips.tooltipEntries={ttSaveBookmark:["li","Click to bookmark this model"],ttSaveModel:["li","Click to save this model for ongoing editing.<br/><br/>After clicking this, you will need to use your browser's functionality to copy or bookmark the newly-created semi-permanent URL.<br/><br/>As you make further edits at the new URL, they will be instantly saved. You will be able to come back any time to continue editing.<br/><br/>The URL and its model will continue to be available for up to a year from the last time you edited it.<br/><br/>Do not use the new URL as a safe backup: If you (or anyone else who you give the URL) modifies or deletes the text, then your work would be lost. <br/><br/>The following describes BETA capabilities. Please report any issues:<br/><br/>You can share the URL with others, or open multiple tabs with it by yourself. As you type the text will change simultaneously in all open tabs."],buttonCopyClip:["li","Click to copy the code to the clipboard<br/><br/>After doing this you can paste the result into a .ump file on your computer. Note that this will copy diagram layout information which is normally hidden, as well as the Umple text."],buttonCopy:["li","Click to open a window containing the plain source for this model"],buttonCopyCommandLine:["li","Click to copy a script to execute your model on the Linux or Mac command line.<br/><br/>After doing this, paste the result into a terminal.<br/><br/>The script will create a new directory under ~/tmp, create the umple file there as test.ump. compile the Umple and resulting Java (and suggest for you how to run the Java if there is a main program present).<br/><br/>Before doing this you need to install the Java development environment and an 'umple' script using a tool such as homebrew. The Umple script should run 'java -jar umple.jar' with a .ump file as an argument  </br><b>Shortcut: [ctrl-o]</b>"],buttonCopyEncodedURL:["li","Click to view a url encoded with this model.<br/><br/>This only works for small models with about 5 classes or less.<br/><br/>You can send people that URL so they can recreate your model in their browser, or you can use this to embed a small example in a presentation file (such as PowerPoint)."],buttonCopyLocalBrowser:["li","Click to save the Umple text from the current tab in your browser local storage for later reloading using Load from Browser below.<br/><br/>This can be useful to transfer text to a different browser tab, or temporarily stash some work you may want to come back to. But it should not be used for a permanent backup."],buttonLoadLocalBrowser:["li","Click to load the Umple text from what you had previously saved in this browser (above).<br/><br/>This operation can be undone."],buttonDownloadFiles:["li","Click to download your entire model, one .ump file per Umple tab.<br/><br/>This is a two-step process. After you click this, the zip file will be created and a link will appear below; you must click on that link to actually complete the download.<br/><br/>This is the best way to safely back up your work to your own computer."],buttonCreateTask:["li","Create a modeling task for participants to try.</br>You will be able to give them some instructions. The model currently appearing here will be their starting point. The instructions could be requirements to model, or changes to make. This can be for an experiment or a course assignment."],buttonLoadTask:["li","Load a model and a set of instructions that have been created by someone running an experiment or a teacher of a course. You need to enter the task name that the person gave you."],buttonRequestAllZip:["li","Create a zip file to download, containing all submissions for this task."],ttDropboxSaver:["li","Click to save your model to dropbox"],ttShowRefreshUmpleCompletely:["li","Click to erase your work and completely restart UmpleOnline.<br/><br/>Use this only if UmpleOnline gets into a state where things seem messed up. After doing this you will NOT be able to use the undo command to restore the model. The text and diagrams will be permanently erased. You should select 'Download Files' above first to back up your work.<br/><br/>For safety, this is a two-step process: A confirmation link will appear below that you must click on after you click on this."],ttLoadBlankModel:["li","Click to load a blank model.<br/><br/>This can be undone using the undo command in Tools. This is the best way to start new work, but you may want to download your files first (above) to back them up."],ttDropboxChooser:["li","Click to load an example from dropbox"],buttonAddClass:["li","Click the diagram to add a class </br><b>Shortcut: [c]</b>"],buttonAddAssociation:["li","Click on two classes to create an association </br><b>Shortcut: [a]</b>"],buttonAddGeneralization:["li","Click on two classes to create a generalization </br><b>Shortcut: [g]</b>"],buttonDeleteEntity:["li","Click on a class, association, or generalization to delete that entity </br><b>Shortcut: [DEL]</b>"],buttonUndo:["li","Click to undo the most recent action </br><b>Shortcut: ["+undo+"]</b>"],buttonRedo:["li","Click to redo the most recent undone action </br><b>Shortcut: ["+redo+"]</b>"],buttonReindent:["li","Click this to adjust the text so that blocks marked by { and } have their contents indented by 2 spaces"],buttonSyncDiagram:["li","Click to sync the diagram and the text"],ttGeneratedCodeType:["li","Choose the language or diagram to generate"],ttGenerateCode:["li","Click this button to generate the above code or diagram"],ttExecuteCode:["li","Click this button to execute the above code"],ttShowHideCanvas:["li","Show/Hide the diagram </br><b>Shortcut: [ctrl+d]</b>"],ttShowHideTextEditor:["li","Show/Hide the text editor </br><b>Shortcut: ["+toggleTextEditor+"]"],ttShowHideLayoutEditor:["li","Show/Hide the layout editor"],ttToggleAttributes:["li","Show/Hide attributes in class diagrams </br><b>Shortcut: [shift+ctrl+a]</b>"],ttToggleMethods:["li","Show/Hide methods in class diagrams </br><b>Shortcut: [ctrl+m]</b>"],ttToggleTraits:["li","Show/Hide traits; when selected any traits and their relationships are explicitly shown; when unselected, traits are merged into their client classes </br><b>Shortcut: [ctrl+r]</b>"],ttToggleActions:["li","Show/Hide actions in state diagrams (hide to simplify)"],ttToggleGuards:["li","Show/Hide guards in state diagrams (hide to simplify)"],ttToggleTransitionLabels:["li","Show/Hide transition labels in state diagrams (t1, t2 etc.) to allow reference"],ttToggleGuardLabels:["li","Show/Hide guard labels on the state diagrams (g1, g2 etc.) to allow reference"],SHT_button:["a","Show/Hide the text editor - <b>"+toggleTextEditor+"</b>"],SHD_button:["a","Show/hide diagram pane on right - <b> ctrl-D</b>"],SHA_button:["a","Show/hide attributes in class diagrams - <b>shift-ctrl-A</b>"],SHM_button:["a","Show/hide methods in class diagrams - <b>ctrl-M</b>"],ttShowEditableClassDiagram:["li","Display a graphically editable class diagram </br><b>Shortcut: [ctrl+e]</b>"],ttShowJointJSClassDiagram:["li","Display a graphically editable class diagram displayed using joint.js </br><b>Shortcut: [ctrl+j]</b>"],ttShowGvClassDiagram:["li","Display a class diagram rendered using GraphViz </br><b>Shortcut: [ctrl+g]</b>"],ttShowGvStateDiagram:["li","Display a state diagram rendered using GraphViz</br><b>Shortcut: [ctrl+s]</b>"],ttShowStructureDiagram:["li","Display a graphically editable composite structure diagram </br><b>Shortcut: [ctrl+l]</b>"],ttShowGvFeatureDiagram:["li","Display a feature diagram rendered using GraphViz </br>"],ECD_button:["a","Class diagram where the user can Edit the layout - <b>ctrl-E</b>"],GCD_button:["a","Graphviz Class diagram, automatically laid out - editable using a contextual menu when pointing to a class, association or attribute - <b>ctrl-G</b>"],SD_button:["a","State diagram - editable using a contextual menu when pointing to  a state or transition  - <b>ctrl-S</b>"],GenJavaButton:["a","Generate Java from this Umple model ... To generate other outputs such as Python, C++, PhP, ER Diagrams and Formal Methods, use the Generate menu in Tools"],topBookmarkable:["a","Click to copy the URL and save it so you can come back to it later.<br/> <br/>You can do this just so you remember the location of your model.<br/><br/>The following describes BETA capabilities. Please report any issues: <br/><br/> You can also share the URL with other people to collaborate in real time on a model.<br/> <br/>When more than one person is working on a model, a collaborator who has stopped editing may time out after a while and would have to then reconnect."],collabDisconnect:["a","You can disconnect from your collaboration session with this button."],ttSaveNCollab:["a","Click to save this model for ongoing editing.<br/><br/>After clicking this, you will need to use your browser's functionality to copy or bookmark the newly-created semi-permanent URL.<br/><br/>As you make further edits at the new URL, they will be instantly saved. You will be able to come back any time to continue editing.<br/><br/>The URL and its model will continue to be available for up to a year from the last time you edited it.<br/><br/>Do not use the new URL as a safe backup: If you (or anyone else who you give the URL) modifies or deletes the text, then your work would be lost. <br/><br/>The following describes BETA capabilities. Please report any issues:  <br/><br/>You can share the URL with others, or open multiple tabs with it by yourself. As you type, the text will change simultaneously in all open browsers or browser tabs."],ttPhotoReady:["li","Remove editing handles from diagram"],ttManualSync:["li","Stop the diagram from syncing automatically"],ttAllowPinch:["li","When active on GraphViz diagrams, this allows two-fingered gestures to zoom the diagram in or out to make it have any desired resolution and size (but prevents the entire browser from being zoomed in this manner)"],ttYumlImage:["li","Generate a class diagram using Yuml in another window"]},ToolTips.dropDownTooltips={exampleType:["li","Choose an example type to load"],itemLoadExamples:["li","Choose a class diagram example to load. * means executable, since it has a main program"],itemLoadExamples2:["li","Choose a state diagram example to load. * means executable, since it has a main program"],itemLoadExamples3:["li","Choose a composite structure diagram example to load"]},ToolTips.setATooltip=function(e,t,r){var a=document.querySelector(":root"),n=e[t][1],o=Math.max(3.5,n.length/10)+"s";jQuery("#"+t).tooltip({items:e[t][0],content:n,show:{delay:1e3},open:function(u,s){a.style.setProperty("--tooltipDwellTime",o)},position:r})},ToolTips.initTooltips=function(){for(var e in this.tooltipEntries)e=="SD_button"||e=="GCD_button"||e=="ECD_button"||e=="SHT_button"||e=="SHD_button"||e=="SHA_button"||e=="SHM_button"||e=="GenJavaButton"||e=="ttSaveNCollab"||e=="collabDisconnect"||e=="topBookmarkable"?ToolTips.setATooltip(this.tooltipEntries,e,{my:"left top+10",of:"#"+e}):ToolTips.setATooltip(this.tooltipEntries,e,{my:"right",at:"left",of:"#"+e});for(e in this.dropDownTooltips)ToolTips.setATooltip(this.dropDownTooltips,e,{my:"center+15% bottom",at:"top",of:"#"+e});jQuery(document).tooltip({show:{delay:1e3}})},UmpleTransitionFactory=new Object,UmpleTransitionFactory.create=function(e){var t=new UmpleTransition;return t.id=e.id,t.fromStateId=e.fromStateId,t.toStateId=e.toStateId,t.name=e.name,t.eventName=e.eventName,t};function UmpleTransition(){this.id=null,this.fromStatePosition=null,this.toStatePosition=null,this.fromStateId,this.toStateId,this.name="",this.eventName="",this.color="black",this.setStates=function(e,t){this.fromStateId=e,this.toStateId=t},this.setDefaultEvent=function(){this.eventName="event1"},this.setName=function(e){this.name=e},this.getName=function(){return this.name},this.getElementId=function(){return this.id==null?"newtransition":this.id},this.getState=function(e){return e==0?UmpleSystem.find(this.fromStateId):UmpleSystem.find(this.toStateId)}}var ObjectsUtil={objects:{},parentCalls:{},declare:function(e,t,r){if(!ObjectsUtil.objects[e]){this.parentCalls[e]={},ObjectsUtil.objects[e]=function(){ObjectsUtil.objects[e].prototype.constructor.apply(this,arguments)};for(var a=[],n=0;n<t.length;n++)a.push(t[n]);for(var o=[],n=0;n<a.length;n++){var u=a[n],s=ObjectsUtil.get(u);if(typeof s=="function"){var d=s.prototype,c=d.constructor;c&&o.push(c);for(var h in d)if(h!=="constructor"){var C=d[h];typeof C=="function"?(this.parentCalls[e][h]||(this.parentCalls[e][h]=[]),this.parentCalls[e][h].push(C)):ObjectsUtil.objects[e].prototype[h]=C}}}ObjectsUtil.objects[e].prototype.className=e;var m;for(var h in r)h==="constructor"?m=r[h]:ObjectsUtil.objects[e].prototype[h]=r[h];var T=this.parentCalls[e];for(var h in T)if(!ObjectsUtil.objects[e].prototype[h]){var S=T[h];S.length>0&&(ObjectsUtil.objects[e].prototype[h]=S[0])}ObjectsUtil.objects[e].prototype.constructor=function(){for(var P=0;P<o.length;P++)o[P].apply(this,arguments);m&&m.apply(this,arguments)}}},superCall:function(e,t,r){var a=this.parentCalls[a.className];if(a)for(var n=0;n<a.length;n++)a[n].call(e,r)},define:function(e,t){if(!ObjectsUtil.objects[e])return ObjectsUtil.objects[e]=t,t},get:function(e){return ObjectsUtil.objects[e]},newInstance:function(e,t){var r=new ObjectsUtil.objects[e](t);if(typeof t!="string")for(var a in t)r[a]||(r[a]=t[a]);return r},isArray:function(e){return e&&e instanceof Array}};(function(){var e=ObjectsUtil.get("util.core.CoreUtil");ObjectsUtil.declare("util.core.Map",[],{values:null,keys:null,constructor:function(){this.values=[],this.keys=[]},put:function(t,r){var a=this.keys.indexOf(t);a===-1?(this.values.push(r),this.keys.push(t)):this.values[a]=r},get:function(t){return this.values[this.keys.indexOf(t)]},remove:function(t){var r=this.keys.indexOf(t);r<0||(this.values.splice(r,1),this.keys.splice(r,1))},clear:function(){this.values=[],this.keys=[]}})})(),(function(){var e=ObjectsUtil.newInstance("util.core.Map"),t=[];ObjectsUtil.define("util.core.Events",{topics:{},suspend:null,connect:function(r,a,n,o){var u=this,s,d;if(a.addEventListener)s=function(){o.apply(n,arguments)},a.addEventListener(r,s,!1),d=function(){a.removeEventListener(r,s,!1)};else{var c=e.get(a);if(c||(c=[],e.put(a,c)),!c[r]){c[r]={bridged:a[r],connects:[]};var u=this;a[r]=function(){if(c[r].bridged.apply(a,arguments),!u.suspend)for(var m=c[r].connects,T=0,S;S=m[T];T++)S.callback.apply(S.context,arguments)}}c[r].connects.push({callback:o,context:n}),s=o}var h={callback:s,disconnector:d,type:r,object:a,context:n};return t.push(h),h},disconnectAll:function(){for(;t.length>0;)this.disconnect(t[0],e);this.topics={}},disconnect:function(r,a){if(r){if(r.object.removeEventListener)r.disconnector();else{var n=e.get(r.object);if(!n)return;var o=n[r.type];if(!o||(o=o.connects,!o))return;for(var u=0,s;s=o[u];u++)s.callback===r.callback&&(o.splice(o.indexOf(s),1),u=0)}var d=t.indexOf(r);d>-1&&t.splice(d,1)}},subscribe:function(r,a,n){this.topics[r]||(this.topics[r]=[]);var o={handler:a,context:n};return this.topics[r].push(o),o},unsubscribe:function(r,a){if(this.topics[r]){var n=this.topics[r].indexof(a);n>-1&&this.topics[r].splice(n,1)}},publish:function(r){var a=this.topics[r];if(a)for(var n=0,o;o=a[n];n++){var u=Array.prototype.slice.call(arguments,1);o.handler.apply(o.context||this,u)}}})})(),(function(){ObjectsUtil.define("util.core.UUIDGenerator",{generate:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,r=e==="x"?t:t&3|8;return r.toString(16)})}})})(),(function(){ObjectsUtil.define("util.svg.SVGUtil",{SVG:"http://www.w3.org/2000/svg",syncLineBetweenVertices:function(e,t,r){var a=t.getRootNode(),n=parseFloat(a.getAttribute("height")),o=t.focalNode,u=r.focalNode,s=parseFloat(o.getAttribute("x")),d=parseFloat(o.getAttribute("y")),c=parseFloat(o.getAttribute("height")),h=parseFloat(o.getAttribute("width")),C=parseFloat(u.getAttribute("x")),m=parseFloat(u.getAttribute("y")),T=parseFloat(u.getAttribute("height")),S=parseFloat(u.getAttribute("width")),P=s+h/2,_=d+c/2,F={y:_,x:P},g={y:m,x:C+S/2,getRange:function(I,R){var W=C/n,Q=S/2*W,p=C+S/2;return Math.abs(I-p)<2?p:I<C+S/2?p-Q:I>C+S/2?p+Q:p}},b={y:m+T,x:C+S/2,getRange:function(I,R){var W=C/n,Q=S/2*W,p=C+S/2;return Math.abs(I-p)<2?p:I<C+S/2?p-Q:I>C+S/2?p+Q:p}},k={y:m+T/2,x:C,getRange:function(I,R){var W=m/n,Q=T/2*W,p=m+T/2;return Math.abs(R-p)<2?p:R<m+T/2?p-Q:R>m+T/2?p+Q:p}},L={y:m+T/2,x:C+S,getRange:function(I,R){var W=m/n,Q=T/2*W,p=m+T/2;return Math.abs(R-p)<2?p:R<m+T/2?p-Q:R>m+T/2?p+Q:p}},A=function(I,R){return Math.abs(I.x-R.x)+Math.abs(I.y-R.y)},E=A(F,g),j=A(F,b),D=A(F,k),N=A(F,L);E<j&&E<D&&E<N?e.setAttribute("d","M"+P+","+_+" L"+g.getRange(P,_)+" "+g.y):j<E&&j<D&&j<N?e.setAttribute("d","M"+P+","+_+" L"+b.getRange(P,_)+" "+b.y):D<E&&D<j&&D<N?e.setAttribute("d","M"+P+","+_+" L"+k.x+" "+k.getRange(P,_)):N<E&&N<j&&N<D&&e.setAttribute("d","M"+P+","+_+" L"+L.x+" "+L.getRange(P,_)),t.parentNode.refreshChild(e)},syncVertixLines:function(e){for(var t=ObjectsUtil.get("util.svg.SVGUtil"),r=e.getChildren("connector"),a=0;n=r[a];a++){var n=r[a];t.syncLineBetweenVertices(n.focalNode,n.source,n.target)}},getConnector:function(e,t){for(var r=e.getChildren("connector"),a=0;a<r.length;a++){var n=r[a];if(n.target===e){if(n.source===t)return n}else if(n.source===e&&n.target===t)return n}return null}})})(),(function(){var e=ObjectsUtil.get("util.svg.SVGUtil"),t={},r={};ObjectsUtil.define("layout.shapes.ShapesRegistry",{register:function(a,n){t[a]=n},draw:function(a,n,o){var u=ObjectsUtil.newInstance(t[a],n,o);return r[a]||(r[a]={}),r[a][u.id||u.guid]=u,u.draw(n,o),u},get:function(a,n){return n?r[a][n]:r[a]},getAndGroup:function(a,n){var o=this.get(a,n),u={};for(var s in o){var d=o[s];if(d){var c=d.parent;c&&(u[c]||(u[c]={}),u[c][s]=d)}}return u},destroy:function(a){r[a.guid].destroy(),r[a.guid]=void 0},empty:function(){r={}},showMessage:function(a,n){var o=document.getElementById(a);if(o){ObjectsUtil.get("util.core.Events").disconnectAll(),ObjectsUtil.get("layout.shapes.ShapesRegistry").empty(),ObjectsUtil.get("util.core.DomUtil").empty(o);var u=ObjectsUtil.get("util.svg.SVGUtil"),s=o.descriptionMessage||document.createElementNS(u.SVG,"text");s.setAttribute("x",20),s.setAttribute("y",20),s.setAttribute("style","fill: #000000;  font-family:tahoma; font-size: 16;  font-weight:bold"),s.appendChild(document.createTextNode(n)),o.appendChild(s);var d=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(n,s);o.style.width=d.w+120+"px",o.style.height=d.h+5+"px",o.style.border="none",o.descriptionMessage=s}},paint:function(a,n){n&&a.args.container&&(ObjectsUtil.get("util.core.Events").disconnectAll(),ObjectsUtil.get("layout.shapes.ShapesRegistry").empty(),ObjectsUtil.get("util.core.DomUtil").empty(a.args.container)),this._paint(a)},_paint:function(a,n,o){n&&(a.args.parentNode=n),o&&(a.args.container=o),a.args.id||(a.args.id=a.args.name);var u=ShapesRegistry.draw(a.descriptor,a.args,a);return u}})})(),(function(){var e=ObjectsUtil.get("util.svg.SVGUtil"),t=ObjectsUtil.get("layout.shapes.ShapesRegistry"),r=40,a=1e5,n=5e-4;n=5e-4,ObjectsUtil.declare("layout.routers.AutomaticRouter",[],{forcex:null,forcey:null,_layoutInterval:null,graph:null,constructor:function(o){this.graph=o,this.forcex={},this.forcey={}},layout:function(){var o=this;o._doLayout(),this._layoutInterval=setInterval(function(){o._doLayout()},100)},_doLayout:function(){for(var o=this.graph.getChildren("rectangle"),u=0;vertix1=o[u];u++){var s=vertix1.name;this.forcex[s]=0,this.forcey[s]=0;for(var d=0;vertix2=o[d];d++){var c=vertix2.name;if(s!==c){var h=parseFloat(vertix2.getAttribute("x"))-parseFloat(vertix1.getAttribute("x")),C=parseFloat(vertix2.getAttribute("y"))-parseFloat(vertix1.getAttribute("y")),m=Math.pow(h,2)+Math.pow(C,2);if(this.forcex[s]-=a/m*h,this.forcey[s]-=a/m*C,e.getConnector(vertix1,vertix2)){var T=Math.sqrt(m);this.forcex[s]+=(T-r)*h,this.forcey[s]+=(T-r)*C}}}}for(var S=0,u=0;vertix1=o[u];u++){var s=vertix1.name,P=this.forcex[s]*n,_=this.forcey[s]*n;S=S+Math.abs(P)+Math.abs(_),vertix1.setPosition({x:parseFloat(vertix1.getAttribute("x"))+P,y:parseFloat(vertix1.getAttribute("y"))+_})}Math.round(S)<40&&clearInterval(this._layoutInterval)}})})(),(function(){var e=ObjectsUtil.get("util.svg.SVGUtil"),t=ObjectsUtil.get("layout.shapes.ShapesRegistry"),r=40,a=1e5,n=5e-4;n=5e-4,ObjectsUtil.declare("layout.routers.HorizontalTreeRouter",[],{forcex:null,forcey:null,graph:null,constructor:function(o){this.graph=o,this.forcex={},this.forcey={}},layout:function(){var o=this;o._doLayout()},_doLayout:function(){var o=[],u=function(E,j){for(var D=[],N=E.getChildren("connector"),I=0;I<N.length;I++){var R=N[I];if(R.source===E){var W=R.target;if(j&&o.indexOf(W)>-1)continue;D.push(R.target)}else if(R.target===E){var Q=R.source;if(j&&o.indexOf(Q)>-1)continue;D.push(R.source)}}return D},s=function(E){var j=E.getChildren("connector");if(j.length<1)return 1;for(var D=0,N=0;subChild=j[N];N++)D=D+s(subChild);return D},d=function(E){var j=E.getChildren("connector");if(j.length<1)return 1;for(var D=0,N=0;subChild=j[N];N++){var I;if(subChild.source===E?I=subChild.target:subChild.target===E&&(I=subChild.source),!!I){var R=parseFloat(I.getAttribute("width"));R>D&&(D=R)}}return D},c=function(E,j){j||(j=[]);var D=u(E);if(D.length===1)return 1;for(var N=0,I=0;I<D.length;I++){var R=D[I];j.indexOf(R)>-1||(j.push(D[I]),N=N+c(D[I],j))}return N},h=this.graph.getChildren("rectangle"),C=h;C.sort(function(E,j){return s(j)-s(E)});for(var m=40,T=30,S={x:0,y:0},P=function(E,j,D,N){if(!(o.indexOf(E)>-1)){o.push(E);var I=s(E,!0);N&&I--,E.setPosition({x:j,y:D}),D>S.y&&(S.y=D),j>S.x&&(S.x=j);for(var R=u(E,!0),W=R.length,Q=I*m,p=D-Q/2,U=0,M=0;M<W;M++){var B=R[M],V=s(B)-1,te=p;M&&(te=te+m),V||(V=1);var J=te+V*m,re=(te+J)/2,ne=j+T+parseFloat(E.getAttribute("width"));B.setPosition({x:ne,y:re}),re>S.y&&(S.y=re),ne>S.x&&(S.x=ne),p=J-m,U=U+(V||1),o.push(B);var K=u(B,!0),ue=ne+parseFloat(B.getAttribute("width"))+T;if(K.length===1)P(K[0],ue,re,!0);else if(K.length>=2)for(var pe=te+m/2,he=(J-pe)/K.length+m/K.length,be=0;be<K.length;be++)P(K[be],ue,pe+he*be,!0)}}},_=0;_<C.length;_++){var F=C[_];if(!(o.indexOf(F)>-1)){var g=c(F),b=o.length===0?g*m/4:S.y+m;P(F,T,b)}}if(!this.graph.height){var k=parseFloat(this.graph.getAttribute("height")),L=S.y+m;L>k&&this.graph.setAttribute("height",parseFloat(L))}if(!this.graph.width){var A=parseFloat(this.graph.getAttribute("width")),L=S.x+100;L>A&&this.graph.setAttribute("width",parseFloat(L))}for(var _=0;_<o.length;_++){var F=o[_];F.parentNode.refreshChild(F.focalNode),e.syncVertixLines(F)}}})})(),(function(){var e=0,t=ObjectsUtil.get("util.core.Events");ObjectsUtil.declare("layout.shapes.AbstractNode",[],{focalNode:null,guid:null,children:null,type:null,parentNode:null,incremntal:null,_incomplete:null,constructor:function(r){this.children=[],this.id=r.id,this.parentNode=r.parentNode,this.incremntal++},getChildren:function(r){return this.children[r||""]||[]},getPosition:function(){return{x:0,y:0,h:0,w:0}},setPosition:function(r,a){},shiftPosition:function(r,a){var n=this.getPosition();for(var o in r)n[o]=(n[o]||0)+r[o];this.setPosition(n,a)},getSuperContainer:function(){for(var r=this.container;;){var a=r.container;if(a&&a.className)r=a;else break}return r},addChild:function(r){this.removeChild(r);var a=r.type||"";this.children[a]||(this.children[a]=[]),this.children[a].push(r)},removeChild:function(r){var a=r.type||"";if(this.children[a]&&this.children[a]){var n=this.children[a].indexOf(r);n!=-1&&this.children[a].splice(n,1)}},appendChild:function(r){this.focalNode.appendChild(r)},refreshChild:function(r){r.parentNode===this.focalNode&&(this.focalNode.removeChild(r),this.insertBefore(r,this.focalNode.firstChild))},insertBefore:function(r,a){a?this.focalNode.insertBefore(r,a):this.appendChild(r)},draw:function(r){},getAttribute:function(r){return this.focalNode.getAttribute(r)},setAttribute:function(r,a){this.focalNode.setAttribute(r,a)},getRootNode:function(){var r=this.parentNode.focalNode;if(r.tagName==="svg")return r;for(var a=r.parentNode;a;)if(a=a.parentNode,a&&a.tagName==="svg")return a;return r},handleMove:function(r,a){},destroy:function(){}})})(),(function(){var e=ObjectsUtil.get("util.svg.SVGUtil"),t=ObjectsUtil.get("util.core.Events"),r=ObjectsUtil.get("util.core.UUIDGenerator"),a=0,n="#222",o="#fff",u="10px";ObjectsUtil.declare("layout.shapes.RectangleNode",["layout.shapes.AbstractNode"],{focalNode:null,guid:null,name:null,color:null,fontColor:null,rx:null,parentNode:null,strokeWidth:null,_moving:null,type:null,constructor:function(s){this.type="rectangle",this.name=s.name||"Node"+a,this.guid=s.id||this.name,this.color=s.color||n,this.fontColor=s.fontColor||o,this.rx=s.rx||u,this.strokeWidth=s.strokeWidth||1,this.strokeWidth=this.strokeWidth+"px",a++},draw:function(s){var d=parseInt(this.parentNode.getAttribute("width")),c=parseInt(this.parentNode.getAttribute("height"));this.focalNode=document.createElementNS(e.SVG,"rect"),this.focalNode.setAttribute("style","fill: "+this.color+"; stroke-width: "+this.strokeWidth+";"),this.focalNode.setAttribute("rx",this.rx),this.parentNode.appendChild(this.focalNode),this.focalNode.name=this.name,this.focalNode.textLabel=document.createElementNS(e.SVG,"text"),this.focalNode.textLabel.setAttribute("style","fill: "+this.fontColor+"; stroke-width: 1px;"),this.focalNode.textLabel.appendChild(document.createTextNode(this.name)),this.parentNode.appendChild(this.focalNode.textLabel),this.focalNode.h=this.focalNode.textLabel.getBBox().height+10,this.focalNode.w=this.focalNode.textLabel.getBBox().width+10,this.focalNode.setAttribute("height",this.focalNode.h+"px"),this.focalNode.setAttribute("width",this.focalNode.w+"px");var h=t.connect("mousedown",this.focalNode,this,function(T){this.handleMove(this.focalNode,T)}),h=t.connect("mousedown",this.focalNode.textLabel,this,function(T){this.handleMove(this.focalNode,T)}),C=Math.random()*(d*.8)+d*.1,m=Math.random()*(c*.8)+c*.1;this.setPosition({x:C,y:m})},setPosition:function(s){var d=parseFloat(s.x),c=parseFloat(s.y);this.focalNode.setAttribute("x",d),this.focalNode.setAttribute("y",c),this.focalNode.textLabel.setAttribute("x",d+5+"px"),this.focalNode.textLabel.setAttribute("y",c+2*this.focalNode.h/3+"px"),e.syncVertixLines(this)},handleMove:function(s,d){var c=s.parentNode.getScreenCTM(),h=s.parentNode.createSVGPoint();h.x=d.clientX,h.y=d.clientY,h=h.matrixTransform(c.inverse());var C=parseFloat(h.x)-parseFloat(s.getAttribute("x")),m=parseFloat(h.y)-parseFloat(s.getAttribute("y")),T=this.getChildren("rectangle");this._moving=s;var S=t.connect("mousemove",document,this,function(_){var F=s.parentNode.getScreenCTM(),g=s.parentNode.createSVGPoint();g.x=_.clientX,g.y=_.clientY,g=g.matrixTransform(F.inverse()),this.setPosition({x:g.x-C,y:g.y-m}),this.parentNode.updateArrowMarker()}),P=t.connect("mouseup",document,this,function(){t.disconnect(S),t.disconnect(P),this.parentNode.updateArrowMarker()})}})})(),(function(){var e=ObjectsUtil.get("layout.shapes.ShapesRegistry"),t=ObjectsUtil.get("util.svg.SVGUtil"),r="1px",a="#444",n=0;ObjectsUtil.declare("layout.shapes.Connector",["layout.shapes.AbstractNode"],{focalNode:null,source:null,target:null,name:null,color:null,rx:null,strokeWidth:null,type:null,constructor:function(o){this.type="connector",this.setSource(o.source),this.setTarget(o.target),this.name=o.name||"Connector"+n,this.guid=o.id||this.source.guid+"_"+this.target.guid+"_"+n,this.strokeWidth=o.strokeWidth||r,this.color=o.color||a,n++},setSource:function(o){var u=e.get("RectangleNode",o);this.source=u,u.addChild(this)},setTarget:function(o){var u=e.get("RectangleNode",o);this.target=u,u.addChild(this)},draw:function(o){return this.focalNode=document.createElementNS(t.SVG,"path"),this.focalNode.setAttribute("style","stroke: "+this.color+"; stroke-width:"+this.strokeWidth+";"),this.parentNode.insertBefore(this.focalNode,this.parentNode.firstChild),this.focalNode.setAttribute("marker-end","url(#Triangle)"),this.focalNode}})})();var ShapesRegistry=ObjectsUtil.get("layout.shapes.ShapesRegistry");(function(){ShapesRegistry.register("Connector","layout.shapes.Connector"),ShapesRegistry.register("RectangleNode","layout.shapes.RectangleNode"),ShapesRegistry.register("Graph","layout.shape.Graph")})(),(function(){var e=ObjectsUtil.get("layout.routers.HorizontalTreeRouter"),t=ObjectsUtil.get("util.core.Events"),r=ObjectsUtil.get("util.svg.SVGUtil"),a=ObjectsUtil.get("layout.shapes.ShapesRegistry");ObjectsUtil.declare("layout.shape.Graph",["layout.shapes.AbstractNode"],{routingObject:null,height:null,width:null,_layoutInterval:null,_moving:null,_defs:null,constructor:function(n){this.height=n.height,this.width=n.width;var o=n.container,u=n.router;this.router=u||new e(this),this.focalNode=document.getElementById(o),this.updateArrowMarker()},draw:function(n,o){},_paint:function(n){n.args.parentNode=this,n.args.id||(n.args.id=n.args.name),n.args.container=this;var o=a.draw(n.descriptor,n.args,n);return o},updateArrowMarker:function(){if(this._defs)this.focalNode.removeChild(this._defs);else{this._defs=document.createElementNS(r.SVG,"defs");var n=document.createElementNS(r.SVG,"marker");n.setAttribute("id","Triangle"),n.setAttribute("viewBox","0 0 20 20"),n.setAttribute("refX","20"),n.setAttribute("refY","10"),n.setAttribute("markerUnits","strokeWidth"),n.setAttribute("markerWidth","8"),n.setAttribute("markerHeight","6"),n.setAttribute("orient","auto");var o=document.createElementNS(r.SVG,"path");n.appendChild(o),o.setAttribute("d","M 0 0 L 20 10 L 0 20 z"),this._defs.appendChild(n)}this.focalNode.appendChild(this._defs)},addRectNode:function(n){n.parentNode=this;var o=a.draw("RectangleNode",n);this.addChild(o)},drawConnector:function(n){n.parentNode=this;var o=a.draw("Connector",n);this.addChild(o)},layout:function(){this.router.layout()}})})(),(function(){var e=ObjectsUtil.define("util.core.DomUtil",{empty:function(t){if(t.tagName||(t=document.getElementById(t)),!!t){if(t.canHaveChildren)try{t.innerHTML="";return}catch{}for(var r;r=t.lastChild;)this._empty(r,t)}},_empty:function(t,r){t.firstChild&&this.empty(t),r&&(r.removeChild(t),t.removeNode&&t.removeNode(!1))},calculateTextSize:function(t,r){var a=document.createElement("span");a.innerHTML=t,a.style.visibility="hidden";var u=this.position(a);if(typeof r=="object"&&!r.parentNode)for(var n in r)a.style[n]=r[n];else a.style.fontSize=window.getComputedStyle(r,null).getPropertyValue("font-size"),a.style.fontFamily=window.getComputedStyle(r,null).getPropertyValue("font-family"),a.style.fontWeight=window.getComputedStyle(r,null).getPropertyValue("font-weight");var o=document.body;o.appendChild(a);var u=this.position(a);return o.removeChild(a),u},position:function(t,r){var a=ObjectsUtil.get("util.core.CoreUtil");t=this.nodeById(t);var n=this.getFirstParent(t,"body"),o=t.getBoundingClientRect();if(o={x:o.left,y:o.top,w:o.right-o.left,h:o.bottom-o.top},r){var u=this.scrollValue(t);o.x+=u.x,o.y+=u.y}return o},transformValue:function(t){var r=t.getAttribute("transform");if(!r)return{x:0,y:0};r=r.substring(10,r.length-1);var a=r.split(",");return a.length<2&&(a=r.split(" ")),{x:parseFloat(a[0]),y:parseFloat(a[1])}},scrollValue:function(t){for(var r=function(c,h){var C,m=window["page"+c+"Offset"];if(typeof m=="number")C=m;else{var T="scroll"+h;document.body&&document.body[T]?C=document.body[T]:document.documentElement&&document.documentElement[T]&&(C=document.documentElement[T])}return C},a=function(){return r("Y","Top")},n=function(){return r("X","Left")},o=0,u=0,s={x:n(),y:a()},d=t;d;){if(d!==document.body&&d!==document.documentElement){if(d.scrollTop>0){s.y=s.y+d.scrollTop;break}if(d.scrollLeft>0){s.x=s.x+d.scrollLeft;break}}d=d.parentNode}return s},nodeById:function(t,r){var a=ObjectsUtil.get("util.core.CoreUtil");return a.checkBrowser("ie")?(this.nodeById=function(n,o){return typeof n!="string"?n:(o||document).getElementById(n)},this.nodeById(t,r)):(this.nodeById=function(n,o){if(typeof n!="string")return n;r||(r=document);var u=r.getElementById(n);if(u.id==n||u.attributes&&u.attributes.id&&u.attributes.id.value==n)return u;var s=r.all[n];if(s){a.isArray(s)||(s=[s]);for(var d=0,c;c=s[d];d++)if(c.id==n||c.attributes&&c.attributes.id&&c.attributes.id.value==n)return c}},this.nodeById(t,r))},transformPoint:function(t,r){var a=ObjectsUtil.get("util.core.DomUtil").getFirstParent(t,"svg"),n=a.getScreenCTM(),o=a.createSVGPoint();o.x=r.x,o.y=r.y,o=o.matrixTransform(n.inverse()),r.x=o.x,r.y=o.y},getFirstParent:function(t,r){if(!(!t||!r)){if(r=r.toUpperCase(),t.tagName.toUpperCase()===r)return t;for(var a=t.parentNode,n;a;){if(a.tagName&&a.tagName.toUpperCase()===r.toUpperCase()){n=a;break}a=a.parentNode}return n}}})})(),(function(){var e=ObjectsUtil.define("util.core.CoreUtil",{store:{},toString:{}.toString,_browserSettings:null,clone:function(t){var r={};for(var a in t)r[a]=t[a];return r},stopEvent:function(t){t.cancelBubble=!0,t.preventDefault(),t.stopPropagation()},checkBrowser:function(t){var r=this.store[t];return r!==void 0||(r=navigator.userAgent.search(t),this.store[t]=r),r},browserSettings:function(){if(this._browserSettings)return this._browserSettings;var t=navigator.userAgent,r,a=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];if(/trident/i.test(a[1]))return r=/\brv[ :]+(\d+(\.\d+)?)/g.exec(t)||[],this._browserSettings={browser:"ie",version:r[1]||""},this._browserSettings;a=a[2]?[a[1],a[2]]:[navigator.appName,navigator.appVersion,"-?"],(r=t.match(/version\/([\.\d]+)/i))!=null&&(a[2]=r[1]),this._browserSettings={browser:a[0].toLowerCase(),version:a[1]||""}},version:function(t){var r=this.browserSettings();return r.browser===t?parseFloat(r.version):0},isFunction:function(t){return this._is(t,"[object Function]")},isString:function(t){return this._is(t,"[object String]")},isArray:function(t){return this._is(t,"[object Array]")},_is:function(t,r){return this.toString.call(t)===r}})})(),(function(){var SVGUtil=ObjectsUtil.get("util.svg.SVGUtil"),Events=ObjectsUtil.get("util.core.Events"),UUIDGenerator=ObjectsUtil.get("util.core.UUIDGenerator"),incremntal=0,DEFAULT_COLOR="rgb(255,255,255)",DEFAULT_FONT_COLOR="#fff",DEFAULT_ROUND_RATIO="10px",ShapesRegistry=ObjectsUtil.get("layout.shapes.ShapesRegistry");ShapesRegistry.register("StrucutreDiagram","layout.shapes.StrucutreDiagram"),ShapesRegistry.register("Part","layout.shapes.Part"),ShapesRegistry.register("Port","layout.shapes.Port"),ShapesRegistry.register("PartIcon","layout.shapes.PartIcon"),ShapesRegistry.register("PortConnector","layout.shapes.PortConnector"),ObjectsUtil.declare("layout.shapes.StructureDiagramNode",["layout.shapes.AbstractNode"],{_moveHandle:null,constructor:function(e){this._moveHandle=Events.subscribe("structure.diagram.node.move."+this.id,function(t){var r=this,a=[],n=function(o){if(!(a.indexOf(o)>-1)){a.push(o);var u=o.getPrecisePosition?o.getPrecisePosition():o.getPosition();r.parentNode.layoutInformation||(r.parentNode.layoutInformation={});var s={x:u.x,y:u.y,h:u.h,w:u.w};r.parentNode.layoutInformation[o.id]=s;for(var d=o.getChildren(),c=0,h;h=d[c];c++)n(h)}};n(this)},this)},destroy:function(){Events.unsubsribe(this._moveHandle)}});var StructureDiagramUtil=ObjectsUtil.define("layout.shapes.diagram.structure..StructureDiagramUtil",{portToPart:function(e,t,r){var a=ObjectsUtil.get("util.core.CoreUtil"),n=a.isString(e)?ShapesRegistry.get("Port",e):e,o=r||n.container,u=o.getPosition(),s=n.getPosition(),d=parseInt(Math.abs(s.x-(u.x+u.w)+s.w)),c=parseInt(Math.abs(s.x-u.x+s.w)),h=parseInt(Math.abs(s.y-(u.y-s.h))),C=parseInt(Math.abs(s.y-(u.y+u.h)+s.h)),m=function(S,P,_,F){var g=function(b,k){return b<5&&k<5};e.isPrivate&&(_==="right"?(_="left",P=P+2):_==="left"?(_="right",P=P+2,S=S+2):_==="top"?(_="bottom",P=P+(F.h/2+2)):_==="bottom"?(_="top",P=P-(F.h/2+2)):_="right"),t(S,P,_,F,g(C,c)||g(h,c)||g(C,d)||g(h,d),{deltaRight:d,deltaLeft:c,deltaTop:h,deltaBottom:C})},T;if(d<c&&d<=h&&d<=C)return u.y-s.h>s.y?m(s.x+(s.w/2-2),s.y,"top",s):s.y>u.y+u.h+document.body.scrollTop-s.h?m(s.x+(s.w/2-2),s.y+(s.h/2+4),"bottom",s):m(s.x+(s.w-2),s.y+s.h/2,"right",s);if(c<d&&c<=h&&c<=C)return u.y-s.h>s.y?m(s.x+(s.w/2-2),s.y,"top",s):s.y>u.y+u.h+document.body.scrollTop-s.h?m(s.x+(s.w/2-2),s.y+(s.h/2+4),"bottom",s):m(s.x+(s.w-2),s.y+s.h/2,"left",s);if(h<d&&h<c&&h<C)return m(s.x+(s.w/2-2),s.y,"top",s);if(C<d&&C<c&&C<h)return m(s.x+(s.w/2-2),s.y+(s.h/2+4),"bottom",s)}});ObjectsUtil.declare("layout.shapes.StrucutreDiagram",["layout.shape.Graph"],{layoutInformation:null,settings:null,constructor:function(e){this.layoutInformation=e.layout},draw:function(e,t){this.focalNode.style.width="100%",this.focalNode.style.height="3600px",this._incomplete=!0,this.settings=t.args.settings||{};var r=t.args.layout;this.height&&this.setAttribute("height",this.height),this.width&&this.setAttribute("width",this.width);var a=e.nodes;if(a){for(var n={"":{}},o=function(ce){var oe=n[ce||""];return oe||(n[ce]={},n[ce])},u=[],s=function(ce){var oe=ce.args,ge=oe.id||oe.name;if(ge){ce.children={};var Ae=o(oe.parent)[oe.id||oe.name||new Date().getTime()]=ce}else u.indexOf(ce)===-1&&u.push(ce)},d=0,c;c=a[d];d++)s(c);var h=function(ce,oe){for(var ge in ce){if(ge===oe)return ce[oe];var Ae=h(ce[ge].children,oe);if(Ae)return Ae}},C=[],m=function(ce){for(var oe in ce)if(oe){var ge=ce[oe],Ae=h(n[""],oe);if(Ae){var de=C.indexOf(oe);de>-1&&C.splice(de,1);var Pe=n[oe];for(var Le in Pe)Ae.children[Le]=Pe[Le];delete n[oe]}else{var de=C.indexOf(oe);de===-1&&C.push(oe)}for(var Le in ge)m(ge[Le].children)}};for(m(n);C.length>0;)m(n);var T=ObjectsUtil.get("util.core.CoreUtil"),S=n[""],P=[],_=function(ce){for(var oe in ce){var ge=ce[oe];P.indexOf(ge)>-1||(ge.descriptor==="Part"&&!S[oe]&&(S[oe]=T.clone(ge),P.push(S[oe])),_(ge.children))}};_(S);var F={},F=function(ce){for(var oe in ce)if(!F[oe]){F[oe]=oe;var ge=ce[oe];F(ge);var Ae=ge.children;for(var de in Ae){var Pe=ce[de];if(Pe){F(Pe);e:{for(var Le in S[de].children){ge.children[de].children=S[de].children;break e}for(var Le in ge.children[de].children){S[de].children=ge.children[de].children;break e}}}}}};F(S);var g=function(ce,oe,ge,Ae){var de=T.clone(ce,oe,ge);if(de.parent=ge.id,de.parentNode=oe,de.id||(de.id=de.name),Ae&&(de.id=Ae+"_"+de.id),r){var Pe=r[de.id];Pe&&(de.x=Pe.x,de.y=Pe.y,de.h=Pe.h,de.w=Pe.w,de.hasLayoutInformation=!0)}return de.container=ge,de},b=20,k=20,L=30,A=30,E=k,j=b+L,D=!0;for(var N in S){var I=S[N],e=g(I.args,this,this);!e.x||!e.y?(D||(E=E+k+20),e.x=j,e.y=E,D=!0):D=!1,I.descriptor==="Part"&&(e.isStructureDiagram=!0);var R=ShapesRegistry.draw(I.descriptor,e),W=I.children,Q=!1,p=!1,C=[];for(var U in W){var M=W[U],B=g(M.args,this,R,N),V=ShapesRegistry.draw(M.descriptor,B);if(V._incomplete=!0,B.hasLayoutInformation?p=!1:(R.addChild(V),p=!0),M.descriptor==="Part"||M.descriptor==="Port"&&(M.args.isPrivate==="true"||M.args.isPrivate===!0)){Q||(j=j+b+L,E=E+k+20,Q=!0);var te=M.children;for(var J in te){var re=te[J];if(re.descriptor==="Port"){var ne=g(re.args,this,V,N),K=ShapesRegistry.draw(re.descriptor,ne);ne.hasLayoutInformation?C.push(K):V.addChild(K)}}var ue=V.getPosition();if(ue.x+j>650){var z=R.getPosition(),q=z.y+z.h-20;E=q+A,j=b+L+b+L}D&&V.shiftPosition({x:j,y:E}),delete V._incomplete;for(var pe=0,he;he=C[pe];pe++)V.addChild(he);C=[],ue=V.getPosition();var z=R.getPosition(),be=ue.x+ue.w,H=z.x+z.w-40,we=ue.y+ue.h,q=z.y+z.h-20,ve=be-H,Ee=we-q;if(Ee>0||ve>0){var Te={};ve>0&&(Te.w=ve),Ee>0&&(Te.h=Ee),R.shiftPosition(Te)}j=j+ue.w+b+b+b+b}C=[],p||R.addChild(V),delete V._incomplete}var z=R.getPosition(),H=z.x+z.h-40,z=R.getPosition(),q=z.y+z.h-20;E=k+q+A,j=b+L,this.addChild(R)}for(var N in S)for(var Z=ShapesRegistry.get("Part",N),G=0,X;X=u[G];G++){var e=X.args,ie=e.sources[0],ee=e.targets[0],le=N+"_"+ie;if(ShapesRegistry.get("Port",le)){var me=N+"_"+ee;if(ShapesRegistry.get("Port",me)){var fe=T.clone(e);fe.sources=[le],fe.part=N,fe.targets=[me],fe.parentNode=this,fe.container=Z,ShapesRegistry.draw(X.descriptor,fe)}}}var ke=ObjectsUtil.get("util.core.DomUtil").position(this.focalNode,!0);this.focalNode.style.height=q+20+"px",this._incomplete=!1,this.refreshBoundaries();var Se=ShapesRegistry.get("Part"),Ce=ShapesRegistry.getAndGroup("Part");this.adjustShapes(r||{},Ce,Se)}},adjustShapes:function(e,t,r,a){var n=[];for(var o in r){var u=r[o],s=u.getPosition(),d=this._adjustShapes(r[o],e,n,a);if(d&&(d=d-5,u.shiftPosition({x:-(a?d-a:d)})),t){var c=t[u.name];for(var h in c){var C=c[h],m=C.getPosition();for(var T in c)if(T!==h){var S=c[T],P=S.getPosition();if(!(P.x>m.x||Math.abs(P.y-m.y)>50)){for(var _=P.x+P.w,F=0,g;g=S.children[F];F++)if(g.className==="layout.shapes.Port"){var b=parseFloat(g.labelNode.getAttribute("x")),k=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(g.labelNode.childNodes[0].textContent+"...",g.labelNode).w,L=b+k;L>_&&(_=L)}var A=this._adjustShapes(C,e,[],_);A!=m.x&&(A=_-A,C.shiftPosition({x:A}))}}}}}},_adjustShapes:function(e,t,r,a,n){if(!(t[e.id]||r.indexOf(e)>-1)){r.push(e);for(var o=e.getPosition(),u=a||0,s=0,d;d=e.children[s];s++)if(d.className==="layout.shapes.Port"){var c=parseFloat(d.labelNode.getAttribute("x"));c<u&&(u=c)}else if(d.className==="layout.shapes.Part"){var h=this._adjustShapes(d,t,r);if(h<u){var C=d.getPosition();C.x=C.x-h,d.setPosition(C)}}return u}},refreshBoundaries:function(){for(var e=ObjectsUtil.get("util.core.DomUtil").position(this.focalNode,!0),t=e.y+e.h,r=e.x+e.w,a=this.getChildren("partNode"),n=0,o=0,u=0,s;s=a[u];u++)if(s.className==="layout.shapes.Part"){var d=s.getPosition(),r=d.x+d.w;r>o&&(o=r),t=d.y+d.h+20,t>n&&(n=t);var t=d.y+d.h;t>n&&(n=t);for(var c=s.getChildren(),h=0,C;C=c[h];h++){if(C.labelNode){var m=ObjectsUtil.get("util.core.DomUtil").position(C.labelNode);r=m.x+m.w,r>o&&(o=r),t=m.y+m.h,t>n&&(n=t)}for(var T=C.getChildren(),S=0,P;P=T[S];S++)P.labelNode&&(m=ObjectsUtil.get("util.core.DomUtil").position(P.labelNode),r=m.x+m.w,r>o&&(o=r),t=m.y+m.h,t>n&&(n=t))}}var _=parseFloat(this.focalNode.style.height);Math.abs(n-_)>1&&(this.focalNode.style.height=n+10+"px");var F=parseFloat(this.focalNode.style.width);Math.abs(o-F)>1&&(this.focalNode.style.width=o+10+"px")}}),ObjectsUtil.declare("layout.shapes.Part",["layout.shapes.StructureDiagramNode"],{isStructureDiagram:null,multiplicity:null,children:null,focalNode:null,guid:null,iconPart:null,name:null,parent:null,color:null,fontColor:null,rx:null,parentNode:null,strokeWidth:null,height:null,width:null,yCoord:null,xCoord:null,_moving:null,type:null,constructor:function(e){this.isStructureDiagram=e.isStructureDiagram,this.multiplicity=e.multiplicity,this.type="partNode",this.parent=e.parent,this.children=[],this.name=e.name||"Node"+incremntal,this.guid=e.id||this.name,this.color=e.color||DEFAULT_COLOR,this.fontColor=e.fontColor||DEFAULT_FONT_COLOR,this.rx=e.rx||DEFAULT_ROUND_RATIO,this.strokeWidth=e.strokeWidth||1,this.strokeWidth=this.strokeWidth+"px",incremntal++},addChild:function(e){var t=ObjectsUtil.get("util.core.CoreUtil");if(t.isArray(e))for(var r=0,a;a=e[r];r++)this.children.push(a);else this.children.push(e);this.applyConstraints()},getChildren:function(e,t){if(e){for(var r=[],a=0,n;n=this.children[a];a++)if(n.type===e){var o=!0;if(t){for(var u in t)if(t[u]?t[u]!==n[u]:n[u]){o=!1;break}}o&&r.push(n)}return r}return this.children},draw:function(e){var t=this.getSuperContainer().settings;this.part_highlight_color=t.part_highlight_color||"#5DBCD2",this.part_container_highlight_color=t.part_container_highlight_color||"#FFFFFF",this.part_container_label_highlight_color=t.part_container_label_highlight_color||"#e6e6e6";var r=ObjectsUtil.get("util.core.CoreUtil"),a=ObjectsUtil.get("util.core.DomUtil");this.focalNode=document.createElementNS(SVGUtil.SVG,"g");var n=Events.connect("mousemove",this.focalNode,this,function(u){if(!this.__resizeStarted){var s=this,d=function(){delete s.__resizeStarted,Events.disconnect(s._tempResizeMouseUpHandler),Events.disconnect(s._tempResizeMouseDownHandler),Events.disconnect(s._tempResizeMouseMoveHandler),s.focalNode.style.cursor="",delete s._tempResizeMouseDownHandler},c=!1,h=a.position(this.focalNode),C=h.x+h.w,m=u.clientX-C;if(Math.abs(m)<10)this.focalNode.style.cursor="col-resize",c=!0;else{var T=h.y+h.h,S=u.clientY-T;Math.abs(S)<10&&(this.focalNode.style.cursor="row-resize",c=!0)}Events.disconnect(this._tempResizeMouseDownHandler),Events.disconnect(this._tempResizeMouseOutHandler),c?(this._tempResizeMouseDownHandler=Events.connect("mousedown",document,this,function(P){this.__resizeStarted&&d(),Events.disconnect(this._tempResizeMouseOutHandler),r.stopEvent(P),this.__resizeStarted=!0,this._tempResizeMouseUpHandler=Events.connect("mouseup",document,this,function(_){r.stopEvent(_),d(),this.getSuperContainer().refreshBoundaries()}),this._tempResizeMouseMoveHandler=Events.connect("mousemove",document,this,function(_){if(r.stopEvent(_),!this._tempResizeMouseDownHandler){d();return}for(var F=this.getChildren(),g=0,b=0,k=0,L;L=F[k];k++)if(L.className==="layout.shapes.Part"){var A=a.position(L.focalNode),E=A.x+A.w;E>b&&(b=E);var j=A.y+A.h;j>g&&(g=j)}var D={},N=a.position(this.focalNode),I=!1;this._tempResizeMouseDownHandler.verticalDiff?_.clientY>g&&(D.h=_.clientY-N.y,I=!0):this._tempResizeMouseDownHandler.horizontalDiff&&_.clientX>b&&(D.w=_.clientX-N.x,I=!0),I&&this.setPosition(D)})}),this._tempResizeMouseDownHandler.horizontalDiff=m,this._tempResizeMouseDownHandler.verticalDiff=S,this._tempResizeMouseOutHandler=Events.connect("mouseout",this.focalNode,this,function(P){d()})):d()}});this.focalNode.setAttribute("style","fill: "+this.color+"; font-family:'sans-serif';"),this.parentNode.appendChild(this.focalNode),this.rectNode=document.createElementNS(SVGUtil.SVG,"rect"),this.rectNode.setAttribute("style","stroke:#000000;"),this.rectNode.setAttribute("fill","#FFFFFF"),this.focalNode.appendChild(this.rectNode),this.highlightNode=document.createElementNS(SVGUtil.SVG,"rect"),this.highlightNode.setAttribute("style","stroke:#000000;"),this.isStructureDiagram?this.highlightNode.setAttribute("fill",this.part_container_highlight_color):this.highlightNode.setAttribute("fill",this.part_highlight_color),this.focalNode.appendChild(this.highlightNode),this.nameNode=document.createElementNS(SVGUtil.SVG,"text"),this.nameNode.setAttribute("style","fill: #000000;  font-family:tahoma; font-size: 10; font-weight:bold"),this.nameNode.appendChild(document.createTextNode(e.name)),this.focalNode.appendChild(this.nameNode),this.isStructureDiagram||(this.iconPart=ShapesRegistry.draw("PartIcon",{parentNode:this.focalNode})),this.setPosition({x:e.x,y:e.y,h:e.h,w:e.w});var o=Events.connect("mousedown",this.focalNode,this,function(u){this._tempResizeMouseDownHandler||this.handleMove(this.focalNode,u)}),o=Events.connect("mousedown",this.highlightNode,this,function(u){this._tempResizeMouseDownHandler||this.handleMove(this.focalNode,u)})},updatePosition:function(e){var t=ObjectsUtil.get("util.core.DomUtil").transformValue(this.focalNode);if(t.h=parseFloat(this.rectNode.getAttribute("height")),t.w=parseFloat(this.rectNode.getAttribute("width")),e.h&&(t.h=t.h+e.h),e.w){t.w=t.w+e.w;for(var r=this.getChildren("portNode"),a=0,n;n=r[a];a++)StructureDiagramUtil.portToPart(n,function(o,u,s,d){if(s==="right"){var c=n.getPosition();n.shiftPosition({x:e.w},!0)}})}this.setPosition(t,!0)},shiftPosition:function(e,t){var r={x:this.xCoord,y:this.yCoord,h:this.height,w:this.width};for(var a in e)r[a]=(r[a]||0)+e[a];this.setPosition(r,t)},setPosition:function(e,t){var r=ObjectsUtil.get("util.core.CoreUtil"),a=this.getPosition(),n=parseFloat(e.x)||this.xCoord||0,o=parseFloat(e.y)||this.yCoord||0,u=parseFloat(e.h)||this.height||40,s=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(this.nameNode.childNodes[0].textContent+"...",this.nameNode).w,d=parseFloat(e.w)||this.width||s+75;if(u<40&&(u=40),d<s+75&&(d=s+75),this.highlightNode.setAttribute("height",20),this.highlightNode.setAttribute("width",d),this.rectNode.setAttribute("height",u),this.rectNode.setAttribute("width",d),this.isStructureDiagram||this.iconPart.setPosition({x:d-25,y:6}),this.focalNode.setAttribute("transform","translate("+n+","+o+")"),!this.isStructureDiagram&&this.multiplicity==="*"&&(this.shadowNode||(this.shadowNode=document.createElementNS(SVGUtil.SVG,"rect"),this.shadowNode.setAttribute("style","stroke:#000000;"),this.shadowNode.setAttribute("fill","none"),this.focalNode.insertBefore(this.shadowNode,this.focalNode.firstChild)),this.shadowNode.setAttribute("transform","translate(3,-3)"),this.shadowNode.setAttribute("height",u),this.shadowNode.setAttribute("width",d)),this.nameNode.setAttribute("y","15"),this.isStructureDiagram){this.nameNode.setAttribute("x","15"),this.nameNode.highlight?(this.nameNode.parentNode.removeChild(this.nameNode.highlight),this.nameNode.parentNode.insertBefore(this.nameNode.highlight,this.nameNode),this.nameNode.parentNode.removeChild(this.nameNode.highlight.border),this.nameNode.parentNode.insertBefore(this.nameNode.highlight.border,this.nameNode)):(this.nameNode.highlight=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.nameNode.highlight.setAttribute("style","fill:"+this.part_container_label_highlight_color+";"),this.nameNode.parentNode.insertBefore(this.nameNode.highlight,this.nameNode),this.nameNode.highlight.border=document.createElementNS(SVGUtil.SVG,"polygon"),this.nameNode.highlight.border.setAttribute("style","stroke:black;stroke-width:1;"),this.nameNode.parentNode.insertBefore(this.nameNode.highlight.border,this.nameNode)),this.nameNode.highlight.setAttribute("x","1"),this.nameNode.highlight.setAttribute("y","1"),this.nameNode.highlight.setAttribute("width",s+10),this.nameNode.highlight.setAttribute("height",18);var c=0,h=0;!r.browserSettings()||r.browserSettings().browser!=="chrome"?(c=2,h=18):(c=0,h=20),this.nameNode.highlight.border.setAttribute("points",s+11+","+c+" "+(s+11)+","+h)}else this.nameNode.setAttribute("x",d/2-s/2);if(!t){var C=this.getPosition(),m=C.x-a.x,T=C.y-a.y;if(m!==0||T!==0)for(var S=0,P;P=this.children[S];S++)(P.className==="layout.shapes.Port"||P.className==="layout.shapes.Part")&&P.shiftPosition({x:m,y:T});this.applyConstraints()}if(this.xCoord=n,this.yCoord=o,this.height=u,this.width=d,this.container&&this.container.getPrecisePosition){var _=this.container.getPrecisePosition(),F=this.yCoord+this.height,g=this.xCoord+this.width,b=_.y+_.h-20,k=_.x+_.w-20,L=F-b,A=g-k;if(L>0||A>0){var E={},j=!1;L>0&&(E.h=L+20,j=!0),A>10&&(E.w=A+20,j=!0),j&&this.container.shiftPosition(E)}}this.refreshBoundaries()},refreshBoundaries:function(){var e=this.getSuperContainer();e._incomplete||e.refreshBoundaries()},getPosition:function(){var e=ObjectsUtil.get("util.core.DomUtil"),t=e.position(this.focalNode,!0),r=this.focalNode.getBoundingClientRect(),a=this.focalNode.parentNode.parentNode.getBoundingClientRect();t.x=r.left-a.left,t.y=r.top-a.top,t.y=t.y+8-parseInt(window.getComputedStyle(this.focalNode.parentNode.parentNode,null).getPropertyValue("padding-top")),t.x=t.x+8-parseInt(window.getComputedStyle(this.focalNode.parentNode.parentNode,null).getPropertyValue("padding-left"));var n=e.getFirstParent(this.focalNode,"svg").parentNode,o=n.scrollLeft,u=n.scrollTop;return t.x=t.x+(o||0),t.y=t.y+(u||0),this.shadowNode&&(t.w=t.w-3,t.h=t.h-3),t},getPrecisePosition:function(){return{h:this.height,w:this.width,y:this.yCoord,x:this.xCoord}},applyConstraints:function(){if(!this._incomplete){for(var e=this.getPosition(),t=this.getPosition(),r=0,a=0,n;n=this.children[a];a++)n.className==="layout.shapes.Port"?n.applyConstraints():n.className;t.w!==e.w&&this.setPosition(t,!0)}},handleMove:function(e,t){var r=ObjectsUtil.get("util.core.DomUtil"),a=ObjectsUtil.get("util.core.CoreUtil"),n=r.getFirstParent(e,"svg"),o=e.parentNode.getScreenCTM(),u=n.createSVGPoint();u.x=t.clientX,u.y=t.clientY,u=u.matrixTransform(o.inverse());var s=this.getPrecisePosition(),d=parseFloat(u.x)-parseFloat(s.x),c=parseFloat(u.y)-parseFloat(s.y),h;this.container.getPrecisePosition&&(h=this.container.getPrecisePosition()),this._moving=e;var C=Events.connect("onselectstart",document,this,function(S){a.stopEvent(S)}),m=Events.connect("mousemove",document,this,function(S){var P=this,_=e.parentNode.getScreenCTM(),F=n.createSVGPoint();F.x=S.clientX,F.y=S.clientY,F=F.matrixTransform(_.inverse());var g={},b=P.getPrecisePosition();g.y=F.y,g.x=F.x;var k=P.container[P.container.getPrecisePosition?"getPrecisePosition":"getPosition"]();if(!(g.x-d<k.x)&&!(g.y-c<k.y)&&(P.setPosition({x:g.x-d,y:g.y-c}),h)){var k=P.container.getPrecisePosition(),L=P.yCoord+P.height,A=P.xCoord+P.width,E=h.y+h.h,j=h.x+h.w,D=L-E,N=A-j;D<0&&N<0&&P.container.setPosition(h)}}),T=Events.connect("mouseup",document,this,function(){Events.disconnect(m),Events.disconnect(T),Events.disconnect(C),this._moving=void 0,this.getSuperContainer().refreshBoundaries(),Events.publish("structure.diagram.node.move."+this.id)});a.stopEvent(t)}});var ICON_WIDTH=12,ICON_HEIGHT=10;ObjectsUtil.declare("layout.shapes.PartIcon",["layout.shapes.AbstractNode"],{draw:function(e){this.iconNode=document.createElementNS(SVGUtil.SVG,"rect"),this.iconNode.setAttribute("style","stroke:#000000;"),this.iconNode.setAttribute("height",ICON_HEIGHT),this.iconNode.setAttribute("width",ICON_WIDTH),this.iconNode.setAttribute("fill","none"),this.parentNode.appendChild(this.iconNode)},setPosition:function(e){var t=parseFloat(e.x)||0,r=parseFloat(e.y)||0,a=2,n=1,o=2,u=6;this.iconNode.setAttribute("x",t),this.iconNode.setAttribute("y",r),this.iconNodePart1?this.parentNode.removeChild(this.iconNodePart1):this.iconNodePart1=document.createElementNS(SVGUtil.SVG,"rect"),this.iconNodePart1.setAttribute("style","stroke:#000000;"),this.iconNodePart1.setAttribute("height",o),this.iconNodePart1.setAttribute("width",u),this.iconNodePart1.setAttribute("y",r+a),this.iconNodePart1.setAttribute("x",t-u/2),this.iconNodePart1.setAttribute("fill","#5DBCD2"),this.parentNode.appendChild(this.iconNodePart1),this.iconNodePart2?this.parentNode.removeChild(this.iconNodePart2):this.iconNodePart2=document.createElementNS(SVGUtil.SVG,"rect"),this.iconNodePart2.setAttribute("style","stroke:#000000;"),this.iconNodePart2.setAttribute("height",o),this.iconNodePart2.setAttribute("width",u),this.iconNodePart2.setAttribute("y",r+a+o+a),this.iconNodePart2.setAttribute("x",t-u/2),this.iconNodePart2.setAttribute("fill","#5DBCD2"),this.parentNode.appendChild(this.iconNodePart2)}});var PortSymbols=ObjectsUtil.define("layout.shapes.Port.PortSymbols",{right:function(e){e.symbol=document.createElementNS(SVGUtil.SVG,"polygon"),e.symbol.setAttribute("points","8,2 2.5,5 8,8"),e.symbol.setAttribute("style","fill:black;stroke:#000000;stroke-width:1"),e.containerNode.appendChild(e.symbol)},left:function(e){e.symbol=document.createElementNS(SVGUtil.SVG,"polygon"),e.symbol.setAttribute("points","2.5,2 8,5 2.5,8"),e.symbol.setAttribute("style","fill:#000000;stroke:#000000;stroke-width:1"),e.containerNode.appendChild(e.symbol)},twoArrows:function(e){var t=function(r,a,n,o){var u=document.createElementNS(SVGUtil.SVG,"line");u.setAttribute("x1",r),u.setAttribute("y1",a),u.setAttribute("x2",n),u.setAttribute("y2",o),u.setAttribute("style","fill:#000000;stroke:#000000;stroke-width:1"),e.containerNode.appendChild(u)};t("4","2","8.5","4"),t("1.5","4","8.5","4"),t("1.5","6","8.5","6"),t("1.5","6","6","8")},conjugated:function(e){var t=PortSymbols._drawCircleSymbol(e,"Conjucated port");t.setAttribute("style","stroke: black;")},conjugatedReplicated:function(e){var t=PortSymbols._drawCircleSymbol(e,"Conjucated replicated port");t.setAttribute("style","stroke: black;"),e.set3D()},replicatedEndPort:function(e){PortSymbols.endPort(e,"Replicated end port"),e.set3D()},endPort:function(e,t){var r=PortSymbols._drawCircleSymbol(e,t||"End port"),a=e.focalNode.getAttribute("fill");r.setAttribute("style","stroke: "+a+";"),r.setAttribute("fill",a),e.focalNode.setAttribute("fill","#000000")},conjucatedReplicatedRelayPort:function(e){var t=PortSymbols._drawRectSymbol(e,"Conjucated replicated relay port");t.setAttribute("style","stroke: black;"),e.set3D()},conjucatedRelayPort:function(e){var t=PortSymbols._drawRectSymbol(e,"Conjucated relay port");t.setAttribute("style","stroke: black;")},replicatedRelayPort:function(e){PortSymbols.relayPort(e,"Replicated relay port"),e.set3D()},relayPort:function(e,t){var r=PortSymbols._drawRectSymbol(e,t||"Relay port");r.setAttribute("style","stroke: black;");var a=e.focalNode.getAttribute("fill");r.setAttribute("style","stroke: "+a+";"),r.setAttribute("fill",a),e.focalNode.setAttribute("fill","#000000")},_drawCircleSymbol:function(e,t){var r=document.createElementNS(SVGUtil.SVG,"circle");return r.setAttribute("fill","#000000"),r.setAttribute("r",3),r.setAttribute("cx",5),r.setAttribute("cy",5),e.containerNode.appendChild(r),PortSymbols._appendTooltip(t,e,r),r},_drawRectSymbol:function(e,t){var r=document.createElementNS(SVGUtil.SVG,"rect");return r.setAttribute("fill","#000000"),r.setAttribute("height",4),r.setAttribute("width",4),r.setAttribute("x",3),r.setAttribute("y",3),e.containerNode.appendChild(r),PortSymbols._appendTooltip(t,e,r),r},_appendTooltip:function(e,t,r){e&&(r.titleElement=document.createElementNS(SVGUtil.SVG,"title"),t.focalNode.appendChild(r.titleElement),r.titleElement.appendChild(document.createTextNode(e)),r.titleElement=document.createElementNS(SVGUtil.SVG,"title"),r.appendChild(r.titleElement),r.titleElement.appendChild(document.createTextNode(e)))}}),ConnectorSymbols=ObjectsUtil.define("layout.shapes.connector.ConnectorSymbols",{draw:function(e,t,r,a){return ConnectorSymbols._draw(e,t,r,a)},_draw:function(e,t,r,a){if(e.connectorSymbol)e.parentNode.removeChild(e.connectorSymbol),e.parentNode.appendChild(e.connectorSymbol);else{e.connectorSymbol=document.createElementNS(SVGUtil.SVG,"g"),e.connectorSymbol.setAttribute("fill","none");var n=5,o=4,u="";t.indexOf("provide")>-1&&(e.connectorSymbol.path=document.createElementNS(SVGUtil.SVG,"path"),e.connectorSymbol.path.setAttribute("style","stroke: #000000;"),e.connectorSymbol.appendChild(e.connectorSymbol.path),u="Provide"),t.indexOf("require")>-1&&(e.connectorSymbol.circle1=document.createElementNS(SVGUtil.SVG,"circle"),e.connectorSymbol.circle1.setAttribute("style","stroke: black;"),e.connectorSymbol.circle1.setAttribute("r",n),e.connectorSymbol.appendChild(e.connectorSymbol.circle1),e.connectorSymbol.setAttribute("fill","white"),u&&(u=u+"\\"),u=u+"Require"),u&&(e.connectorSymbol.title=document.createElementNS(SVGUtil.SVG,"title"),e.connectorSymbol.appendChild(e.connectorSymbol.title),e.connectorSymbol.title.appendChild(document.createTextNode(u))),e.parentNode.appendChild(e.connectorSymbol)}if(e.connectorSymbol.path){var n=5,o=4,s=n+o,d=s*-1;if(a)if(r==="vertical")var c=d+",0",h=s+",0";else var c="0,"+d,h="0,"+s;else if(r==="vertical")var h=d+",0",c=s+",0";else var h="0,"+d,c="0,"+s;var C="M"+c+(" A"+n+","+n)+" 0 0,1 "+h;e.connectorSymbol.path.setAttribute("d",C)}return e.connectorSymbol}}),LABEL_FONT_SETTINGS={fontSize:10,fontFamily:"arial, serif",fontWeight:"normal"};ObjectsUtil.declare("layout.shapes.Port",["layout.shapes.StructureDiagramNode"],{focalNode:null,guid:null,isPrivate:null,connectors:null,name:null,color:null,fontColor:null,rx:null,parentNode:null,strokeWidth:null,_moving:null,type:null,portType:null,constructor:function(e){this.type="portNode",this.isPrivate=e.isPrivate==="true"||e.isPrivate===!0,this.multiplicity=e.multiplicity,this.connectors={sources:[],targets:[]},this.portType=e.portType,this.name=e.name||"Node"+incremntal,this.guid=e.id||this.name,this.color=e.color||DEFAULT_COLOR,this.fontColor=e.fontColor||DEFAULT_FONT_COLOR,this.rx=e.rx||DEFAULT_ROUND_RATIO,this.strokeWidth=e.strokeWidth||1,this.strokeWidth=this.strokeWidth+"px",incremntal++},addConnector:function(e,t){var r=ObjectsUtil.get("util.core.CoreUtil");if(r.isArray(e))for(var a=0,n;n=e[a];a++)this.connectors[t].indexOf(n)>-1||this.connectors[t].push(n);else this.connectors[t].indexOf(e)==-1&&this.connectors[t].push(e)},draw:function(args){var settings=this.getSuperContainer().settings;this.portFillColor=settings.portFillColor||"#FFFFCC",this.containerNode=document.createElementNS(SVGUtil.SVG,"g"),this.parentNode.appendChild(this.containerNode),this.focalNode=document.createElementNS(SVGUtil.SVG,"rect"),this.focalNode.setAttribute("style","stroke:#000000;"),this.focalNode.setAttribute("height","10"),this.focalNode.setAttribute("width","10"),this.focalNode.setAttribute("fill",this.portFillColor),this.containerNode.appendChild(this.focalNode);var CoreUtil=ObjectsUtil.get("util.core.CoreUtil"),DomUtil=ObjectsUtil.get("util.core.DomUtil"),typeSymbol=args.typeSymbol;if(typeSymbol){if(typeSymbol.indexOf("(function")>-1){var typeSymboleEval=eval(typeSymbol);CoreUtil.isFunction(typeSymboleEval)&&typeSymboleEval(this)}}else{var portType=args.portType,mappedFunction=PortSymbols[portType];mappedFunction&&mappedFunction(this)}this.labelNode=document.createElementNS(SVGUtil.SVG,"text"),this.labelNode.setAttribute("style","fill: #000000;  font-family:"+LABEL_FONT_SETTINGS.fontFamily+"; font-size: "+LABEL_FONT_SETTINGS.fontSize+";  font-weight:"+LABEL_FONT_SETTINGS.fontWeight+";");var portLabelText=args.name;args.multiplicity!==void 0&&(portLabelText=portLabelText+"["+args.multiplicity+"]"),this.labelNode.appendChild(document.createTextNode(portLabelText)),this.parentNode.appendChild(this.labelNode);var partObject=this.container;if(args.x!==void 0&&args.y!==void 0)this.setPosition({x:args.x,y:args.y},!0);else if(!this.isPrivate){for(var x,y,delta,position=partObject.getPosition(),portPosition=this.getPosition(),children=partObject.getChildren("portNode",{isPrivate:void 0}),adjustedLength=children.length,w=this.getPosition().w,direction=children.length%10,partMax=position.x+position.w,index=0,child;child=children[index];index++)StructureDiagramUtil.portToPart(child,function(e,t,r,a){if(!(r==="right"||r==="left")){var n=DomUtil.calculateTextSize(child.labelNode.childNodes[0].textContent,child.labelNode).w,o=child.getPosition(),u=child.getPosition().x,s=u+n/2;if(!(partMax<s+o.w*2||partMax<u+o.w*2)){var d=n/2+w/2,c=position.w/6;d>position.w/5-15&&direction++,d>position.w/4&&direction++}}});var self=this;if(direction<10){var directionFinder=function(e,t){e===0?(delta=position.h/2/2-5,x=position.x-portPosition.w,y=position.y+position.h/2-portPosition.h-delta):e===1?(delta=position.h/2/2,x=position.x-portPosition.w,y=position.y+position.h/2-portPosition.h+delta):e===2?(delta=position.w/2/2,x=position.x-portPosition.w+position.w/2-delta,y=position.y-portPosition.h):e===3?(x=position.x-portPosition.w+position.w/2,y=position.y-portPosition.h):e===4?(delta=position.w/2/2,x=position.x-portPosition.w+position.w/2+delta,y=position.y-portPosition.h):e===5?(delta=position.h/2/2,x=position.x+position.w-portPosition.w,y=position.y+position.h/2-portPosition.h-delta):e===6?(delta=position.h/2/2,x=position.x+position.w-portPosition.w,y=position.y+position.h/2-portPosition.h+delta):e===7?(delta=position.w/2/2,x=position.x-portPosition.w+position.w/2-delta,y=position.y+position.h-portPosition.h):e===8?(x=position.x-portPosition.w+position.w/2,y=position.y+position.h-portPosition.h):e===9&&(delta=position.w/2/2,x=position.x-portPosition.w+position.w/2+delta,y=position.y+position.h-portPosition.h)};directionFinder(direction)}else{var start=children.length-10,direction=start%8,endY=position.y+position.h-20;if(direction<6){var byIndex=(parseFloat(direction/2)+(start-direction+1)/3)*portPosition.h;byIndex||(byIndex=4);var delta=parseInt(start/8)+byIndex+portPosition.h*2,right=direction%2;if(right)var x=position.x-portPosition.w+position.w;else{var x=position.x-portPosition.w,y=position.y+position.h/2-portPosition.h+delta,diff=y-endY;diff>0&&partObject.updatePosition({h:diff})}var updatedPosition=partObject.getPosition(),y=updatedPosition.y+updatedPosition.h-portPosition.h*2+4}else if(direction%2===0){var x=position.x+position.w-portPosition.w/2,y=position.y-portPosition.h;partObject.updatePosition({w:30})}else var x=position.x+position.w-parseFloat(portPosition.w*3),y=position.y+position.h-portPosition.h}for(var childIndex=0,child;child=children[childIndex];childIndex++)child.applyConstraints();this.setPosition({x,y})}this.applyConstraints();var mouseDownHandler=Events.connect("mousedown",this.containerNode,this,function(e){this.handleMove(this.focalNode,e)}),mouseDownHandler=Events.connect("mousedown",this.labelNode,this,function(e){this.handleMove(this.focalNode,e)})},setPosition:function(e,t){xCoord=parseFloat(e.x)||0,yCoord=parseFloat(e.y)||0,this.containerNode.setAttribute("transform","translate("+xCoord+","+yCoord+")"),this.multiplicity==="*"&&this.set3D();var r=this;StructureDiagramUtil.portToPart(this,function(n,o,u,s){if(u==="right")r.labelNode.setAttribute("x",n+2),r.labelNode.setAttribute("y",o-1);else if(u==="top"){var d=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(r.labelNode.childNodes[0].textContent,r.focalNode);r.labelNode.setAttribute("x",n-parseFloat(d.w/2)),r.labelNode.setAttribute("y",o-parseFloat(s.h/2))}else if(u==="left"){var d=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(r.labelNode.childNodes[0].textContent,r.labelNode);r.labelNode.setAttribute("x",parseFloat(n-(d.w+s.w))),r.labelNode.setAttribute("y",o)}else if(u==="bottom"){var d=ObjectsUtil.get("util.core.DomUtil").calculateTextSize(r.labelNode.childNodes[0].textContent,r.focalNode);r.labelNode.setAttribute("x",n-parseFloat(d.w/2)),r.labelNode.setAttribute("y",o+parseFloat(s.h))}t||r.applyConstraints()});var a=r.labelNode.parentNode;a.removeChild(r.labelNode),a.appendChild(r.labelNode)},set3D:function(){this.shadowNode||(this.shadowNode=document.createElementNS(SVGUtil.SVG,"rect"),this.shadowNode.setAttribute("style","stroke:#000000;"),this.shadowNode.setAttribute("fill",this.portFillColor||"#FFFFFF"),this.containerNode.insertBefore(this.shadowNode,this.containerNode.firstChild)),this.shadowNode.setAttribute("transform","translate(1,-2)"),this.shadowNode.setAttribute("height",11),this.shadowNode.setAttribute("width",11)},applyConstraints:function(){var e=this.container;if(!(!e||e._incomplete)){var t=ObjectsUtil.get("util.core.CoreUtil"),r=this.getPosition(),a=e.getPosition();if(this.isPrivate){var n=!1,o=a.x+a.w-r.w-r.w,u=a.x+r.w,s=a.y+a.h-r.h-r.h,d=a.y+r.h,c=t.clone(r);c.x<u?(c.x=u,n=!0):c.x>o&&(c.x=o,n=!0),c.y<d?(c.y=d,n=!0):c.y>s&&(c.y=s,n=!0),n&&this.setPosition(c,!0)}else{var h=!0,c=t.clone(r),C=function(){var k=a.y-r.h,L=a.y+a.h-r.h,A=Math.abs(c.y-k),E=Math.abs(c.y-L);E<=A?c.y=L:c.y=k};if(r.x<a.x-r.w)c.x=a.x-r.w;else if(r.x>a.x+a.w-r.w)c.x=a.x+a.w-r.w;else{var m=a.x+a.w-r.w,T=a.x-r.w,S=c.x;StructureDiagramUtil.portToPart(this,function(k,L,A,E,j,D){j?C():A==="bottom"?Math.abs(D.deltaBottom)>1&&(c.y=c.y+D.deltaBottom):A==="top"?Math.abs(D.deltaTop)>1&&(c.y=c.y-D.deltaTop):A==="right"?Math.abs(D.deltaRight)>1&&(c.x=c.x+D.deltaRight):A==="left"&&Math.abs(D.deltaLeft)>1&&(c.x=c.x-D.deltaLeft)}),h=!1}if(h){var m=a.y+a.h-r.h,T=a.y-r.h,S=r.y-r.h;(S<T||S>m)&&C()}var P=a.x-r.w,_=a.x+a.w-r.w,F=a.y-r.h,g=a.y+a.h-r.h;c.x<P&&(c.x=P),c.x>_&&(c.x=_),c.y<F&&(c.y=F),c.y>g&&(c.y=g),(parseInt(c.x)!==parseInt(r.x)||parseInt(c.y)!==parseInt(r.y)||parseInt(c.h)!==parseInt(r.h)||parseInt(c.w)!==parseInt(r.w))&&this.setPosition(c,!0)}}},getPosition:function(){var e=ObjectsUtil.get("util.core.DomUtil").transformValue(this.containerNode);return e.w=13,e.h=13,e},handleMove:function(e,t){var r=ObjectsUtil.get("util.core.DomUtil"),a=ObjectsUtil.get("util.core.CoreUtil"),n=r.getFirstParent(e,"svg"),o=e.parentNode.getScreenCTM(),u=n.createSVGPoint(),s=r.scrollValue(e);u.x=t.clientX+s.x,u.y=t.clientY+s.y,u=u.matrixTransform(o.inverse());var d=this.getPosition(),c=parseFloat(u.x)-parseFloat(d.x),h=parseFloat(u.y)-parseFloat(d.y);this._moving=e;var C=Events.connect("onselectstart",document,this,function(S){a.stopEvent(S)}),m=Events.connect("mousemove",document,this,function(S){var P=this,_=e.parentNode.getScreenCTM(),F=n.createSVGPoint();F.x=S.clientX,F.y=S.clientY,F=F.matrixTransform(_.inverse());var g={};this.isPrivate?(g.y=F.y,g.x=F.x):StructureDiagramUtil.portToPart(this,function(b,k,L,A,E){E?(g.y=F.y,g.x=F.x):L==="left"||L==="right"?g.y=F.y:g.x=F.x}),P.shiftPosition(g),a.stopEvent(S)}),T=Events.connect("mouseup",document,this,function(){Events.disconnect(m),Events.disconnect(T),Events.disconnect(C),this._moving=void 0,this.getSuperContainer().refreshBoundaries(),Events.publish("structure.diagram.node.move."+this.id)});a.stopEvent(t)}});var Events=ObjectsUtil.get("util.core.Events"),incremntal=0,sources=[];ObjectsUtil.declare("layout.shapes.PortConnector",["layout.shapes.StructureDiagramNode"],{focalNode:null,guid:null,name:null,color:null,fontColor:null,rx:null,parentNode:null,strokeWidth:null,_moving:null,type:null,connectorType:null,constructor:function(e){this.connectorType=e.connectorType,this.type="portConnector",this.name=e.name||"Connector"+incremntal,this.guid=e.id||this.name,this.sources=e.sources,this.targets=e.targets,this.part=e.part,incremntal++,this.points=e.points},draw:function(e){var t=["red","green","blue","brown","black","orange","lime"],t=["black","black","black","black","black","black","black","black"];sources.indexOf(this.sources[0])===-1&&sources.push(this.sources[0]);var r=t[sources.indexOf(this.sources[0])];if(this.focalNode=document.createElementNS(SVGUtil.SVG,"polyline"),this.focalNode.setAttribute("style","fill:none;stroke:"+r+";stroke-width:1px;"),this.parentNode.appendChild(this.focalNode),this.points)this.focalNode.setAttribute("points",this.points);else{this.setPosition();for(var a=0,n;n=["sources","targets"][a];a++)for(var o=0,u;u=this[n][o];o++){var s=ShapesRegistry.get("Port",u);s.addConnector(this,n),Events.connect("setPosition",s,this,function(d){this.setPosition(d)}),this.container.applyConstraints()}}},setPosition:function(e){if(this.sources[0]===this.targets[0])return this.focalNode.setAttribute("points","");var t=[],r=this.targets[0],a=this.sources[0],n=ShapesRegistry.get("Port",r),o=ShapesRegistry.get("Port",a);if(n.getPosition().x<o.getPosition().x){var u=a;a=r,r=u}var s=function(G,X,ie){t.push({x:G,y:X,direction:ie})},d=function(G){G.direction==="left"?(G.x=G.x,G.y=G.y+5):G.direction==="right"?(G.x=G.x+10,G.y=G.y+5):G.direction==="top"?(G.x=G.x+5,G.y=G.y):G.direction==="bottom"&&(G.y=G.y+10,G.x=G.x+5)},c=ShapesRegistry.get("Port",a),h=c.container,C=h.getPosition(),m=c.getPosition();StructureDiagramUtil.portToPart(a,s);var T=ShapesRegistry.get("Port",r),S=T.container,P=S.getPosition(),_=T.getPosition();StructureDiagramUtil.portToPart(r,s);var F=h===S,Q=[],g=t[0];if(t[0]){m.direction=g.direction;var b=t[1];if(b){_.direction=b.direction;var k=c.getPosition(),L=T.getPosition(),A=!1,E=this,j=function(G,X,ie,ee){X.isPrivate?ee.direction==="left"?G.direction="right":ee.direction==="top"?G.direction="bottom":ee.direction==="bottom"?G.direction="top":ee.direction==="right"&&(G.direction="left"):X.parent===E.part&&(ie.isPrivate||ie.parent!==E.part)&&(G.direction==="left"?G.direction="right":G.direction==="top"?G.direction="bottom":G.direction==="bottom"?G.direction="top":G.direction==="right"&&(G.direction="left"))};c.isPrivate?(j(_,T,c,m),j(m,c,T,_)):(j(m,c,T,_),j(_,T,c,m));var D=m.direction,N={x:_.x,y:_.y,direction:_.direction};d(N);var I={x:N.x,y:N.y},R={x:m.x,y:m.y,direction:m.direction},W=function(G){var X={};return G.direction==="left"?(X.x=G.x-10,X.y=G.y):G.direction==="right"?(X.x=G.x+10,X.y=G.y):G.direction==="top"?(X.x=G.x,X.y=G.y-10):G.direction==="bottom"&&(X.x=G.x,X.y=G.y+10),X.direction=G.direction,X},Q=[],p={x:m.x,y:m.y,direction:m.direction};d(p),Q.push(p);var U=W(p);Q.push(U);var M={x:_.x,y:_.y,direction:_.direction};d(M);var B=W(M);Q.push({x:B.x,y:U.y}),Q.push(B),Q.push(M);var V=function(){for(var G=Q.length,X=0;X<G-1;X++){var ie=Q[X],ee=Q[X+1],le=Q[X+2],me=function(oe){return le?ie[oe]===ee[oe]&&ee[oe]===le[oe]:!1};if(me("y")){var fe=0;if(m.direction==="left"&&_.direction==="left"){var ke=Q[X+3];if(ke)var Se=ke.y-ie.y;else var Se=P.y-ie.y-m.h*1.5}else if(m.direction==="left"&&_.direction==="bottom"){var Se=P.y-ie.y-m.h*1.5;if(P.x>C.x&&C.y<P.y)var fe=P.x-ie.x-m.h*1.5}else var Se=C.y+C.h-ee.y;var Ce=void 0;ee.x<ie.x&&ee.x<le.x?(Ce=ee.y+Se,Q.splice(X+2,0,{x:ee.x+fe,y:Ce})):le.y<ie.y&&le.y<ee.y&&(Ce=ee.y-Se,Q.splice(X+2,0,{x:ie.x,y:Ce})),Ce&&(le.y=Ce)}else if(me("x")){if(m.direction==="bottom"&&_.direction==="top")var Se=P.x+P.w-ie.x;else if((m.direction==="right"||m.direction==="bottom")&&(ee.direction==="top"||ee.direction==="bottom")||m.direction==="top"&&(le.direction==="bottom"||le.direction==="top")){if(S===h&&(T.isPrivate||c.isPrivate))var Se=_.x-ie.x-m.h;else var Se=P.x-ie.x-m.h*1.5;if(m.direction==="bottom"&&_.direction==="bottom"&&m.y<_.y){var ce=Q[X-1];ce&&(ce.y=ee.y,ie.y=ee.y)}}else var Se=P.x+P.w-ie.x;var Ce=void 0;ee.y<ie.y&&ee.y<le.y?Q[X+1].direction===Q[X+2].direction&&!Q[X+3]&&_.direction!=="top"?Q.splice(X+1,1):(Ce=ee.x+Se,Q.splice(X+2,0,{x:le.x,y:ee.y})):ee.y>ie.y&&ee.y>le.y&&(Ce=ee.x+Se,Q.splice(X+2,0,{x:le.x,y:ee.y})),Ce&&(ie.x=Ce,ee.x=Ce)}}};V();var te=function(){for(var G=[],X=1;X<Q.length-5;X++){var ie=Q[X],ee=Q[X+1],le=Q[X+2],me=Q[X+3];if(ie.x===ee.x&&le.x===me.x&&me.x>ee.x){Q[X+1].y=me.y,Q.splice(Q.indexOf(le),1),Q.splice(Q.indexOf(me),1),X=1;continue}}},J=function(){for(var G=1;G<Q.length-3;G++){var X=Q[G],ie=Q[G+1],ee=Q[G+2];if(!(!((ee.direction==="left"||ee.direction==="top")&&X.y<ee.y&&X.direction==="bottom")||ee.direction&&ee.direction===X.direction)&&X.y===ie.y&&ie.x===ee.x){X.y=ee.y,Q[G+3]&&(ee.x=Q[G+3].x),Q.splice(Q.indexOf(ie),1),G=1;continue}}};J(),te();var re=function(){for(var G={points:[],delta:0},X=Q.length,ie=0;ie<X-1;ie++){var ee=Q[ie],le=Q[ie+1],me=Math.abs(le.x-ee.x),fe=Math.abs(le.y-ee.y),ke=me>fe?me:fe;G.delta<ke&&(G={points:[ee,le],delta:ke})}return G.points},ne=function(X){var X=re(),ie=X[0],ee=X[1],le=Math.abs(ee.x-ie.x),me=Math.abs(ee.y-ie.y);if(le>me)return{direction:"horiontal",x:ie.x+le/2,y:ie.y};var fe;return ie.y>ee.y?fe=ie:fe=ee,{direction:"vertical",x:ee.x,y:fe.y-me/2}};if(this.connectorType&&this.connectorType.length>0){var K=ne(re()),ue=ShapesRegistry.get("Port",this.targets[0]),pe=ShapesRegistry.get("Port",this.sources[0]),he;ue.getPosition().x>=pe.getPosition().x?(he=!1,K.direction==="vertical"?K.y=K.y-20:K.x=K.x-20):(he=!0,K.direction==="vertical"?K.y=K.y+20:K.yx=K.x+20);var be=ConnectorSymbols.draw(this,this.connectorType,K.direction,he);be.setAttribute("transform","translate("+K.x+","+K.y+")")}var we=c.focalNode.parentNode,ve=T.focalNode.parentNode,Ee=we.parentNode,Te=ve.parentNode;Ee.removeChild(we),Ee.appendChild(we),Te.removeChild(ve),Te.appendChild(ve),this.focalNode.setAttribute("points",this.arrayToPoints(Q));for(var H=[],z=c.connectors.sources.concat(c.connectors.targets).concat(T.connectors.sources).concat(T.connectors.sources),q=0,Z;Z=z[q];q++)H[Z.name]||(H[Z.name]=Z);this.adjustOverlappedConnectors(H)}}},adjustOverlappedConnectors:function(e){var t=e||ShapesRegistry.get("PortConnector"),r={};for(var a in t){var n=t[a];if(n.getAttribute){var o=[];r[n.name]={connector:n,connectorPoints:o};for(var u=n.getAttribute("points").split(" "),s=0,d;d=u[s];s++){var c=d.split(",");o.push({x:parseFloat(c[0]),y:parseFloat(c[1])})}}}var h=0,C={},m=[],T=ObjectsUtil.newInstance("util.core.Map");for(var a in r){var S=r[a],P=S.connector,o=S.connectorPoints;for(var _ in r){h++;var F=r[_],g=F.connector;if(g!==P){var b=F.connectorPoints,k=g.targets[0];C[k]===void 0?C[k]=0:m.indexOf(g)===-1&&C[k]++,m.push(g);var L=T.get(g);L||(L=(C[k]%2?2:-2)*Math.round(C[k]/2),T.put(g,L));for(var A=[b[0],b[1]],E=!1,s=0;s<b.length-1;s++)for(var j=b[s],D=b[s+1],N=[j.x,D.x],I=[j.y,D.y],R,W,Q=0;Q<o.length-1;Q++){var p=o[Q],U=o[Q+1],M=function(Te,H){for(var z=1,q=3,Z=3,G=b[s][Te]+q*z,X=!1;!X;)e:{for(var ie in r)for(var ee=r[ie],le=ee.connectorPoints,me=0,fe;fe=le[me];me++)if(fe[Te]===G&&(Math.abs(fe[H]-b[s][H])<25||Math.abs(fe[H]-b[s+1][H])<25)){z<1&&(q<.1?(q=Z+1,Z++):q=q/2),z=z*-1,G=b[s][Te]+q*z;break e}X=!0;break}return G},R=p.x===j.x&&U.x===D.x&&p.x===D.x&&(U.y===D.y||Math.abs(j.y-p.y)<=3),W=p.y===j.y&&U.y===D.y&&p.y===D.y&&(U.x===D.x||Math.abs(j.x-p.x)<=3);if(R){var B=M("x","y");F.alteredx=!0,b[s].x=B,b[s+1].x=B,g.movedHorizontally=!0,E=!0}else if(W){var B=M("y","x");F.alteredy=!0,b[s].y=B,b[s+1].y=B,g.movedVertically=!0,E=!0}}for(var s=0;s<b.length-2;s++){var V=b[s],te=b[s+1],J=b[s+2];(te.y<V.y&&te.y<J.y&&V.x===te.x&&te.x===J.x||te.x<V.x&&te.x<J.x&&V.y===te.y&&te.y===J.y)&&(b.splice(s+1,1),s=0)}for(var s=0;s<b.length-1;s++){var V=b[s],te=b[s+1],J=b[s+2];if(te.x!=V.x&&Math.abs(te.x-V.x)<7)te.x=V.x,s=-1,E=!0;else if(te.y-V.y&&Math.abs(te.y-V.y)<7)te.y=V.y,s=0,E=!0;else if(s>4)break}if(E){for(var A="",re=0,ne;ne=b[re];re++){var K=b[re-1],ue=b[re-2];A&&(A=A+" ");var pe=ne;K&&ue&&ne.x!==K.x&&ne.y!==K.y&&(ue.x==K.x?pe.x=ue.x:ue.y==K.y&&(pe.y=ue.y)),A=A+pe.x+","+pe.y}g.setAttribute("points",A)}}}}},arrayToPoints:function(e){for(var t="",r=0,a;a=e[r];r++)t&&(t=t+" "),t=t+a.x+","+a.y;return t},getPosition:function(){return{x:parseFloat(this.focalNode.getAttribute("x")),y:parseFloat(this.focalNode.getAttribute("y")),w:13,h:13}}})})();var StateTree={};function StateNode(e,t){this.parent=e,this.id=t,this.activeColour=null,this.passiveColor=null}StateNode.prototype.getParent=function(){return this.parent},StateNode.prototype.getRoot=function(){for(var e=this,t=null;e!==null;)t=e,e=e.getParent();return t},StateNode.prototype.getId=function(){return this.id},StateNode.prototype.getDepth=function(){for(var e=this,t=0;e!==null;)e=e.getParent(),t++;return t};function StateColourer(e,t){this.numShades=e,this.numColours=t,this.cachedColours=this.baseColours.slice()}StateColourer.prototype.passiveColour="999999",StateColourer.prototype.baseColours=["CC99A2","9AAFAF","FFFF7F","98FB98","9DD6D6","D2AB6F","B19CD9"],StateColourer.prototype.getBasePassiveColour=function(){for(var e=this.passiveColour,t=0;t<5-this.numShades&&t<3;t++)e=this.lighten(e);return e},StateColourer.prototype.getBaseColour=function(e){var t;e<this.cachedColours.length?t=this.cachedColours[e]:(e=e%this.cachedColours.length,t=this.modifyColour(this.cachedColours[e]),this.cachedColours[e]=t);for(var r=0;r<5-this.numShades&&r<3;r++)t=this.lighten(t);return t},StateColourer.prototype.getLightenAmount=function(){return 15},StateColourer.prototype.getModifyAmount=function(){return 20},StateColourer.prototype.modifyColour=function(t){var t=this.createColour(t),r,a;return t.red>t.blue?t.red>t.green?(t.red-=this.getModifyAmount(),t.blue>t.green?t.green+=this.getModifyAmount():t.blue+=this.getModifyAmount()):(t.green-=this.getModifyAmount(),t.blue+=this.getModifyAmount()):t.blue>t.green?(t.blue-=this.getModifyAmount(),t.red>t.green?t.green+=this.getModifyAmount():t.red+=this.getModifyAmount()):(t.blue-=this.getModifyAmount(),t.red+=this.getModifyAmount()),t.toHex()},StateColourer.prototype.lighten=function(t){var t=this.createColour(t),r=this.getLightenAmount();return t.modifyRed(r),t.modifyBlue(r),t.modifyGreen(r),t.toHex()},StateColourer.prototype.createColour=function(e){var t=parseInt(e,16),r=t>>16,a=t>>8&255,n=t&255;return new Colour(r,a,n)};function Colour(e,t,r){this.red=e,this.blue=t,this.green=r}Colour.prototype.modifyRed=function(e){this.red+=e,this.red>255?this.red=255:this.red<0&&(this.red=0)},Colour.prototype.modifyBlue=function(e){this.blue+=e,this.blue>255?this.blue=255:this.blue<0&&(this.blue=0)},Colour.prototype.modifyGreen=function(e){this.green+=e,this.green>255?this.green=255:this.green<0&&(this.green=0)},Colour.prototype.modifyByName=function(e,t){if(e!=="red"&&e!=="blue"&&e!=="green")throw"Not a valid colour name"},Colour.prototype.toHex=function(){var e=this.green|this.blue<<8|this.red<<16;return e.toString(16)};function StateTable(e,t){this.table=e,this.stateTree=t}StateTable.prototype.readTable=function(){for(var e=this.table.find("tr"),t=0,r=1;r<e.length;r++){var a=jQuery(e[r]).find("td")[0];this.stateTree.stateNodes.push(this.stateTree.createState(jQuery(a),t++))}},StateTable.prototype.colour=function(){var e=this.table.find("tr"),t,r,a;if(this.stateTree.type==="state"){t=jQuery(e[0]).find("td");for(var n=1;n<t.length;n++)jQuery(t[n]).css("background-color","#"+this.stateTree.stateNodes[n-1].activeColour)}for(var n=1;n<e.length;n++){r=this.stateTree.stateNodes[n-1],t=jQuery(e[n]).find("td"),a=jQuery(t[0]),a.css("background-color","#"+r.activeColour);for(var o=1;o<t.length;o++)a=jQuery(t[o]),a.text().match(/^\s$/)?a.css("background-color","#"+r.passiveColour):a.css("background-color","#"+r.activeColour)}};function EventSequence(e,t,r){this.headerTable=e,this.bodyTable=t,this.stateTree=r}EventSequence.prototype.readTable=function(){for(var e=jQuery(this.headerTable).find("td"),t=0,r=1;r<e.length;r++)this.stateTree.stateNodes.push(this.stateTree.createState(jQuery(e[r]),t++))},EventSequence.prototype.colour=function(){var e,t,r,a;e=jQuery(this.headerTable).find("td");for(var n=1;n<e.length;n++)r=this.stateTree.stateNodes[n-1],jQuery(e[n]).css("background-color","#"+r.activeColour);e=jQuery(this.bodyTable).find("tr");for(var n=1;n<e.length;n++){r=this.stateTree.stateNodes[n-1],t=jQuery(e[n]).find("td");for(var o=0;o<t.length;o++)a=jQuery(t[o]),a.text().match(/^\s$/)?a.css("background-color","#"+r.passiveColour):a.css("background-color","#"+r.activeColour)}},StateTree.init=function(e,t){StateTree.stateNodes=[],e.hasClass("event-statetable")?(StateTree.type="event",StateTree.handler=new StateTable(e,this)):e.hasClass("state-statetable")?(StateTree.type="state",StateTree.handler=new StateTable(e,this)):e.hasClass("event-sequence-grid")?(StateTree.type="eventSequence",StateTree.handler=new EventSequence(e.find("table")[0],e.find("table")[1],this)):(console.log("Unknown state table type"),StateTree.type="unknown")},StateTree.createState=function(e,t){var r=parseInt(e.attr("data-parent")),a=StateTree.stateNodes[r];return isNaN(r)&&(a=null),new StateNode(a,t)},StateTree.maxDepth=function(){for(var e=0,t,r=0;r<StateTree.stateNodes.length;r++)t=StateTree.stateNodes[r].getDepth(),t>e&&(e=t);return e},StateTree.numStateFamilies=function(){numStateFamilies=0;for(var e=0;e<StateTree.stateNodes.length;e++)StateTree.stateNodes[e].getParent()===null&&numStateFamilies++;return numStateFamilies},StateTree.readTable=function(){StateTree.handler.readTable()},StateTree.assignStateColours=function(){for(var e=new StateColourer(StateTree.maxDepth(),StateTree.numStateFamilies()),t=0,r,a=0;a<StateTree.stateNodes.length;a++)r=StateTree.stateNodes[a],r.getParent()===null?(r.passiveColour=e.getBasePassiveColour(),r.activeColour=e.getBaseColour(t++)):(r.passiveColour=e.lighten(r.getParent().passiveColour),r.activeColour=e.lighten(r.getParent().activeColour))},StateTree.colour=function(){StateTree.assignStateColours(),StateTree.handler.colour()},StateTree.colourStateTables=function(){jQuery(document).ready(function(){jQuery(".statetable").each(function(){StateTree.init(jQuery(this)),StateTree.readTable(),StateTree.colour()})})},StateTree.colourEventSequences=function(){jQuery(document).ready(function(){jQuery(".event-sequence-grid").each(function(){StateTree.init(jQuery(this)),StateTree.readTable(),StateTree.colour()})})};
